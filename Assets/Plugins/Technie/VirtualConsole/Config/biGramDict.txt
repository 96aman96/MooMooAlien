of the:2043,in the:974,to the:816,on the:656,and the:519,to be:502,for the:414,display memory:413,that the:397,can be:374,with the:366,the same:345,from the:332,is the:322,is a:314,in a:312,of a:278,is that:271,at the:259,by the:235,the next:231,the screen:229,the VGA:218,shown in:217,the code:209,in Listing:209,with a:193,all the:192,as the:191,on a:190,in this:182,to do:180,it is:180,for a:179,as a:177,a single:177,is to:174,in Figure:174,scan line:173,as shown:167,into the:165,to a:164,more than:164,number of:163,the first:160,is not:159,so that:156,the other:153,used to:152,at a:152,way to:151,if you:141,would be:141,rather than:139,the polygon:139,the CPU:137,that is:136,in which:135,for each:134,such as:133,the start:133,write mode:132,than the:130,the DAC:130,be used:129,you can:128,assembly language:128,to use:127,this chapter:127,Mode X:127,going to:125,Zen timer:124,want to:122,the two:121,one of:121,of this:120,the line:117,split screen:117,because the:116,This is:115,as well:115,have to:115,the world:114,to draw:114,the time:113,the 8088:113,if the:111,that it:110,a good:108,this is:105,the 486:105,part of:104,we can:104,the split:104,which is:102,through the:102,to get:100,and a:100,of display:99,could be:98,order to:97,need to:96,look at:95,and then:95,must be:94,to display:94,a lot:93,faster than:93,when the:93,In the:92,the current:92,which the:92,For example:92,256-color mode:92,to make:91,should be:91,the VGA’s:91,out of:90,a few:90,between the:90,there are:90,at least:90,in order:90,that are:89,able to:88,the Zen:88,the last:88,up to:87,the PC:87,code in:87,possible to:87,Mask register:87,a time:86,a given:86,but the:86,the Pentium:85,along the:85,the end:84,of each:84,the 286:84,BSP tree:84,this book:83,is in:83,that I:83,there is:83,execution time:83,the way:82,the 386:82,I was:81,at all:81,as fast:81,the BIOS:81,the plane:81,a bit:79,use of:79,a little:79,in fact:79,that we:79,will be:79,use the:78,it was:77,that you:77,the number:77,is an:77,prefetch queue:77,page flipping:77,so the:76,a polygon:76,mode 3:75,each of:75,about the:74,back to:73,for example:73,in Chapter:73,fast as:71,In fact:71,the performance:71,version of:71,start address:71,have been:70,be a:70,but it:70,to perform:70,up the:70,the display:70,the palette:70,up with:69,to set:69,of course:68,lot of:68,the right:68,less than:68,the program:68,from a:68,sort of:68,register is:68,end of:67,code is:67,code that:67,the prefetch:67,palette RAM:67,the previous:66,There are:66,the best:66,the data:66,be drawn:66,is used:66,to see:65,by a:65,of all:65,texture mapping:65,how to:64,performance of:64,mode 13H:64,the result:63,wait states:63,start of:63,set the:63,written to:63,and that:62,time to:62,as possible:62,used in:62,means that:62,set to:62,to have:61,the source:61,your code:61,of Listing:61,have a:61,code to:61,as it:61,each pixel:61,code and:60,If you:60,and I:59,to write:59,there’s no:59,than a:59,DRAM refresh:59,the bit:59,the latches:59,because it:58,to find:58,into a:58,is no:58,that it’s:58,only one:58,memory is:58,Map Mask:58,as much:57,the process:57,that a:57,we have:56,then the:56,to 1:56,memory accesses:56,memory and:55,and in:55,it’s not:55,bit mask:55,polygon is:55,most of:54,over the:54,does not:54,On the:54,the four:54,only the:54,the most:53,of those:53,or the:53,around the:53,can do:53,of that:53,that can:53,and is:53,in that:53,the new:53,and so:53,it can:52,a great:52,but not:52,it would:52,the value:52,I had:52,dot product:52,the only:51,it’s a:51,used for:51,the case:51,not to:51,the loop:51,display adapter:51,you have:50,to read:50,be able:50,the EGA:50,was a:50,not a:50,some of:50,set of:50,the entire:50,other hand:50,stored in:50,byte of:50,the rest:49,the original:49,until the:49,the desired:49,using the:49,to 0:49,memory access:49,from one:49,bits of:49,BSP trees:49,like to:48,you want:48,In this:48,to work:48,bit of:48,would have:48,required to:48,for all:48,register to:48,the surface:48,enough to:47,Note that:47,is set:47,the stack:47,the edge:47,sample program:47,vertical sync:47,the normal:47,in any:46,next chapter:46,VGA memory:46,four planes:46,the Map:46,for that:45,where the:45,at any:45,cycles per:45,the use:45,twice as:45,286 and:45,the left:45,OUT s:45,the PVS:45,much as:44,all of:44,not only:44,capable of:44,other words:44,it does:44,you might:44,the following:44,to generate:44,the byte:44,easy to:44,and it’s:44,the buffer:44,has been:44,exactly the:44,has a:44,4 cycles:44,the destination:44,Bit Mask:44,are drawn:44,CPU data:44,the color:44,the BSP:44,a new:43,in one:43,just as:43,take a:43,In other:43,approach is:43,of time:43,while the:43,slower than:43,it to:43,we need:43,in all:43,as in:43,system memory:43,draw the:43,a byte:43,advantage of:43,the background:43,a BSP:43,of my:42,rest of:42,of code:42,have the:42,of your:42,for this:42,a word:42,time and:42,mode 2:42,that if:42,setting the:42,the viewpoint:42,we’ll see:41,point is:41,you could:41,out to:41,to look:41,to take:41,to execute:41,after the:41,think of:41,in display:41,the edges:41,the top:41,the pattern:41,the whole:40,as I:40,there’s a:40,the point:40,As a:40,is done:40,not the:40,0 and:40,may be:40,If the:40,1 and:40,so on:40,to address:40,across the:40,scan lines:40,the V-pipe:40,to handle:39,you should:39,when you:39,nature of:39,makes it:39,as many:39,the second:39,a different:39,Index register:39,the pixel:39,is drawn:39,Y coordinate:39,Gouraud shading:39,hard to:38,I don’t:38,quite a:38,to load:38,the x86:38,set up:38,and that’s:38,this case:38,are not:38,much more:38,process of:38,are the:38,the fastest:38,point to:38,the timer:38,and 386:38,with no:38,depending on:38,example of:38,in each:38,each plane:38,the viewer:38,I have:37,get a:37,and all:37,both the:37,when it:37,amount of:37,be the:37,and it:37,this point:37,is more:37,line is:37,tend to:37,a simple:37,necessary to:37,mode 0:37,to keep:36,ability to:36,do that:36,down to:36,to understand:36,to implement:36,C code:36,optimization is:36,that in:36,way of:36,previous chapter:36,of an:36,protected mode:36,The first:36,is very:36,due to:36,to go:36,percent of:36,it in:36,the sample:36,you may:36,of two:36,VGA is:36,edge list:36,the Bit:36,the image:36,the dot:36,At the:35,of it:35,do the:35,when a:35,get the:35,By the:35,matter of:35,of which:35,the corresponding:35,nothing more:35,the more:35,each time:35,the memory:35,access to:35,cycles to:35,adapter cycle-eater:35,color cycling:35,the polygons:35,assembly code:34,was the:34,but it’s:34,the above:34,you know:34,in turn:34,has to:34,more complex:34,that this:34,ways to:34,to run:34,the instructions:34,portion of:34,since the:34,instructions that:34,if we:34,and can:34,inner loop:34,out the:34,starting at:34,at each:34,line segment:34,when I:33,what the:33,contents of:33,they are:33,make the:33,great deal:33,to know:33,other than:33,make it:33,the C:33,all that:33,much faster:33,a result:33,to produce:33,to point:33,Of course:33,are in:33,2 cycles:33,we could:33,try to:33,the pixels:33,value of:33,from Chapter:33,in my:33,a register:33,be set:33,drawing the:33,the Y:33,the X:33,polygons are:33,each polygon:33,time of:32,to say:32,a very:32,needed to:32,performance is:32,the file:32,load the:32,order of:32,than it:32,that they:32,of instructions:32,to speed:32,or not:32,as we:32,you to:32,instruction bytes:32,that would:32,memory to:32,text mode:32,mode 10H:32,REPNZ SCASB:32,to this:32,line of:32,plane 0:32,pixel is:32,320x400 256-color:32,polygons in:32,a number:31,well as:31,pretty much:31,with each:31,a 486:31,if you’re:31,on an:31,portions of:31,might be:31,all four:31,speed up:31,I’m going:31,at this:31,the one:31,of any:31,is also:31,is one:31,any given:31,change the:31,in an:31,is 0:31,to calculate:31,as we’ll:31,to memory:31,only a:31,registers are:31,and more:31,I’ll discuss:31,couple of:31,in front:31,which are:31,a line:31,one cycle:31,at offset:31,side of:31,the U-pipe:31,mode 1:31,as you:30,the ability:30,had to:30,be done:30,key to:30,memory in:30,this approach:30,no longer:30,may not:30,code for:30,given that:30,instructions and:30,at that:30,of one:30,a second:30,timer 0:30,I’d like:30,simply by:30,Execution Unit:30,of these:30,the major:30,of memory:30,into two:30,address memory:30,to select:30,3 cycles:30,top of:30,down the:30,one pixel:30,X coordinate:30,any of:29,I can:29,the contents:29,be in:29,the like:29,What’s more:29,In short:29,the speed:29,speed of:29,wait for:29,you need:29,you must:29,so we:29,is 1:29,0 is:29,in mode:29,mode and:29,the problem:29,are used:29,the instruction:29,outside the:29,instructions are:29,for which:29,can see:29,bytes of:29,pixels in:29,1 cycle:29,are a:29,polygons that:29,of polygons:29,the vertices:29,the frustum:29,of what:28,a couple:28,not going:28,byte at:28,implementation of:28,execution times:28,code from:28,that Listing:28,longer than:28,deal of:28,than Listing:28,the cache:28,it will:28,variety of:28,list of:28,but in:28,long as:28,The problem:28,turns out:28,whether the:28,the standard:28,program is:28,accesses to:28,sorts of:28,in general:28,added to:28,based on:28,out that:28,operation of:28,of pixels:28,the cell:28,The VGA:28,mode set:28,a pixel:28,read mode:28,360x480 256-color:28,3-D animation:28,the error:28,the AET:28,a surface:28,the texture:28,in Quake:28,and you:27,even though:27,that when:27,how the:27,use a:27,in assembly:27,in mind:27,a 16-bit:27,The code:27,trying to:27,because of:27,relative to:27,When I:27,level of:27,When the:27,per second:27,it possible:27,to allow:27,the results:27,as an:27,within the:27,is actually:27,the appropriate:27,problem is:27,to avoid:27,As it:27,I know:27,is only:27,a problem:27,the 8-bit:27,8-bit bus:27,at which:27,and one:27,There is:27,or more:27,This means:27,to move:27,However the:27,loading the:27,front of:27,the final:27,discussed in:27,edges of:27,a plane:27,the Pentium’s:27,in write:27,Set/Reset register:27,the Color:27,he had:26,is on:26,to that:26,see that:26,a program:26,read from:26,times faster:26,in C:26,way the:26,the vertical:26,difficult to:26,rate of:26,point of:26,during the:26,a full:26,to an:26,the maximum:26,that there:26,last chapter:26,come up:26,screen start:26,start scan:26,the nearest:26,animation is:26,and for:25,was to:25,before the:25,you do:25,many of:25,a better:25,program that:25,four times:25,and no:25,at once:25,us to:25,a small:25,registers and:25,according to:25,also be:25,the inner:25,can only:25,time the:25,to determine:25,486 and:25,we want:25,one thing:25,edge of:25,a memory:25,an instruction:25,no way:25,can’t be:25,come to:25,that’s not:25,to store:25,controlled by:25,I didn’t:25,to assembly:25,to support:25,two cycles:25,to add:25,solution is:25,for one:25,byte is:25,this code:25,2 and:25,line and:25,the drawing:25,pixel to:25,error term:25,surface caching:25,same time:24,You can:24,me to:24,for an:24,end up:24,lines of:24,but also:24,is just:24,to one:24,to it:24,In a:24,just a:24,parts of:24,in action:24,read the:24,shows the:24,time is:24,difference between:24,same as:24,time for:24,and because:24,I’m not:24,code performance:24,which to:24,the need:24,to which:24,presented in:24,the system:24,0 to:24,that all:24,it has:24,effect of:24,cycle-eater is:24,the difference:24,as Listing:24,queue cycle-eater:24,an extra:24,only in:24,is less:24,any one:24,register and:24,and only:24,has the:24,linked list:24,0 1:24,get to:24,to copy:24,the register:24,each node:24,video data:24,screen is:24,drawn with:24,drawn in:24,line drawing:24,each scan:24,do it:23,and even:23,be written:23,and which:23,it as:23,so I:23,make a:23,I could:23,how much:23,The key:23,understand the:23,the overall:23,this chapter’s:23,x86 family:23,read and:23,but rather:23,and as:23,a set:23,greater than:23,that of:23,in real:23,386 and:23,and write:23,instead of:23,with an:23,it and:23,the timing:23,timer is:23,mode is:23,by one:23,long-period Zen:23,to start:23,on to:23,designed to:23,in your:23,the long-period:23,The only:23,it takes:23,so it:23,can execute:23,be more:23,is as:23,it comes:23,bits in:23,far more:23,the eye:23,be performed:23,off the:23,see the:23,followed by:23,Start Address:23,pixels at:23,all planes:23,the set/reset:23,Read Map:23,page 0:23,palette registers:23,green and:23,of 3-D:23,edge is:23,the view:23,we were:22,we had:22,I would:22,and if:22,likely to:22,to me:22,a look:22,that will:22,what I:22,on my:22,to my:22,think that:22,the bytes:22,is written:22,of bytes:22,There’s a:22,the assembly:22,the listings:22,the total:22,a more:22,time in:22,tends to:22,of assembly:22,matter how:22,performance and:22,what you:22,you don’t:22,be made:22,not be:22,the overhead:22,and to:22,match the:22,used by:22,In order:22,it turns:22,when we:22,the registers:22,of our:22,result of:22,bus cycle-eater:22,one for:22,on each:22,comes to:22,cost of:22,consists of:22,memory as:22,for any:22,figure out:22,they do:22,along with:22,turned out:22,up a:22,the Carry:22,was that:22,is then:22,there was:22,and 1:22,linked lists:22,virtual screen:22,mode 12H:22,plane 3:22,plane is:22,the colors:22,page 1:22,DAC locations:22,Wu antialiasing:22,bit-plane animation:22,the light:22,like the:21,of Quake:21,a large:21,see what:21,can make:21,of you:21,thanks to:21,to think:21,we must:21,the key:21,to build:21,the various:21,one byte:21,to Listing:21,in Table:21,using a:21,than one:21,we don’t:21,fast enough:21,by using:21,more complicated:21,case of:21,the execution:21,times as:21,As I:21,it a:21,perform the:21,the hardware:21,all there:21,the sort:21,I said:21,seem to:21,the true:21,instruction fetching:21,the state:21,they were:21,fact the:21,state of:21,equal to:21,on all:21,only to:21,in its:21,no matter:21,is needed:21,two instructions:21,an 8088:21,word-sized memory:21,the word:21,we know:21,the upper:21,the rules:21,toward the:21,to wait:21,of drawing:21,it should:21,You might:21,the walls:21,It is:21,real mode:21,a whole:21,the nature:21,value is:21,if it:21,and 3:21,this in:21,the lower:21,polygon filling:21,only once:21,the mode:21,screen and:21,generate the:21,Pentium optimization:21,X and:21,by setting:21,one scan:21,the Read:21,of Mode:21,plane 1:21,256-color modes:21,320x400 mode:21,Computer Graphics:21,working with:20,all this:20,don’t have:20,say that:20,but I:20,series of:20,or two:20,time I:20,aspect of:20,is this:20,just the:20,is still:20,a big:20,generate a:20,do this:20,It would:20,Listing 1.1:20,to improve:20,store the:20,that’s a:20,from memory:20,only when:20,to optimize:20,of how:20,of data:20,a way:20,a quick:20,I think:20,work with:20,a moment:20,you will:20,done in:20,can also:20,depends on:20,2 is:20,to tell:20,overhead of:20,that was:20,calls to:20,result in:20,waiting for:20,length of:20,are required:20,of optimization:20,the high:20,a 32-bit:20,a loop:20,execute in:20,bytes long:20,instruction is:20,discussion of:20,do not:20,is it:20,or even:20,through a:20,to figure:20,example the:20,size of:20,the full:20,because it’s:20,select the:20,the size:20,space to:20,to change:20,a VGA:20,it’s possible:20,the address:20,the list:20,calculate the:20,the AC:20,area of:20,the frame:20,one plane:20,Map register:20,draw a:20,run-length slice:20,the polygon’s:20,the spans:20,world is:20,dirty-rectangle animation:20,3-D clipping:20,cross product:20,surface is:20,Listing 67.1:20,has an:19,a long:19,back in:19,and an:19,about how:19,you use:19,much the:19,cycles in:19,for it:19,I haven’t:19,The second:19,block of:19,in Listings:19,string instructions:19,shows a:19,a matter:19,is much:19,a list:19,this sort:19,16 bits:19,at an:19,which I:19,take the:19,course of:19,so it’s:19,is capable:19,result is:19,After all:19,0 in:19,may well:19,as discussed:19,aware that:19,an excellent:19,the processor:19,the precision:19,any other:19,do is:19,can get:19,the flags:19,they can:19,even if:19,however the:19,it might:19,1 byte:19,which can:19,could have:19,perform a:19,more efficient:19,1 or:19,that’s the:19,but is:19,there were:19,On a:19,know that:19,the length:19,via the:19,to check:19,and would:19,good deal:19,not as:19,only if:19,takes only:19,another way:19,Carry flag:19,the order:19,mode in:19,onto the:19,3 is:19,next generation:19,Data register:19,setting of:19,the Start:19,this mode:19,bit 5:19,images in:19,of vertical:19,the Set/Reset:19,from plane:19,of color:19,polygons and:19,and blue:19,in Mode:19,pixel at:19,coordinate system:19,and Y:19,view space:19,the angle:19,unit normal:19,of BSP:19,tree is:19,the lighting:19,that he:18,so much:18,about it:18,aspects of:18,are many:18,the proper:18,the computer:18,not always:18,or a:18,That’s a:18,percent faster:18,of its:18,to access:18,makes the:18,bytes at:18,easier to:18,the work:18,three times:18,form of:18,is by:18,use it:18,a cycle:18,to another:18,can never:18,instruction set:18,a minimum:18,write the:18,consisting of:18,to each:18,as to:18,problem with:18,time a:18,if it’s:18,the PC’s:18,the 8253:18,the course:18,you’ll be:18,the initial:18,and other:18,it may:18,the three:18,1 is:18,sent to:18,it doesn’t:18,instruction that:18,as they:18,be sure:18,instructions in:18,is performed:18,find the:18,issue of:18,For one:18,running on:18,one instruction:18,whenever possible:18,one or:18,executes in:18,0 the:18,As you:18,used as:18,EGA and:18,screen in:18,modes and:18,half of:18,distance from:18,be to:18,it with:18,20 MHz:18,never be:18,it seems:18,found that:18,memory addressing:18,such a:18,is now:18,to discuss:18,as is:18,had a:18,of Life:18,chapter we:18,go through:18,register contention:18,to any:18,is selected:18,line to:18,written by:18,VGA to:18,set/reset circuitry:18,pixel in:18,red green:18,drawing a:18,the minor:18,0 0:18,four pixels:18,polygon and:18,the animation:18,a unit:18,span sorting:18,let me:17,and how:17,the latter:17,the space:17,find a:17,do with:17,at it:17,to come:17,it for:17,a PC:17,just about:17,far as:17,code was:17,a fast:17,than you:17,might think:17,exactly how:17,bytes in:17,each byte:17,written in:17,and most:17,can we:17,data and:17,is about:17,mean that:17,the design:17,is so:17,write to:17,for those:17,the object:17,While the:17,a variety:17,work in:17,all other:17,needs to:17,this way:17,not in:17,In particular:17,useful for:17,as long:17,to time:17,like a:17,that have:17,case the:17,deal with:17,changing the:17,be aware:17,my experience:17,by Listing:17,the internal:17,is loaded:17,program in:17,talking about:17,not so:17,cycles on:17,a 386:17,is at:17,the basic:17,see how:17,and data:17,8088 and:17,but that’s:17,is exactly:17,memory at:17,There’s no:17,a separate:17,registers to:17,the cost:17,it’s time:17,the actual:17,and not:17,that each:17,together with:17,code but:17,looking at:17,the bottom:17,on any:17,ratio of:17,and VGA:17,from display:17,VGA and:17,here is:17,worst case:17,back and:17,approach to:17,Listing 5.1:17,a 20:17,a standard:17,two or:17,with all:17,is faster:17,as follows:17,1 to:17,done with:17,viewed from:17,lookup table:17,the implementation:17,a while:17,stack pointer:17,are actually:17,It was:17,contains the:17,close to:17,offset 0:17,The basic:17,edges are:17,the model:17,the node:17,Game of:17,per pixel:17,of VGA:17,the virtual:17,planes are:17,16 colors:17,VGA’s hardware:17,left edge:17,the write:17,CPU byte:17,for drawing:17,coordinate of:17,drawing to:17,convex polygons:17,all polygons:17,product of:17,lighting is:17,the tree:17,of wall:17,BSP order:17,you’ll see:16,of his:16,the future:16,were to:16,I will:16,away from:16,Thanks to:16,just to:16,but if:16,you understand:16,of them:16,know how:16,to create:16,if a:16,interested in:16,guarantee that:16,on and:16,run on:16,the read:16,That means:16,this one:16,all but:16,better than:16,is often:16,not all:16,If a:16,but that:16,it happens:16,the bits:16,like this:16,by way:16,the compiler:16,given the:16,to its:16,that no:16,Given that:16,and by:16,in those:16,a solid:16,the information:16,had been:16,of interest:16,of three:16,For the:16,appear to:16,and should:16,dynamic RAM:16,mode the:16,54 ms:16,the correct:16,latches and:16,runs in:16,to match:16,resolution of:16,enough for:16,illustrates the:16,than in:16,time as:16,have no:16,move the:16,are two:16,inside the:16,8088 is:16,memory wait:16,of 1:16,memory The:16,than on:16,that uses:16,yet another:16,does this:16,just one:16,to reduce:16,them to:16,the video:16,and are:16,in text:16,with some:16,what we:16,first character:16,to scan:16,Now that:16,the search:16,before you:16,where it:16,I did:16,memory address:16,is generally:16,can use:16,a pretty:16,two bytes:16,The other:16,stack frame:16,an interesting:16,Pentium is:16,so you:16,is possible:16,the worst:16,standard VGA:16,pair of:16,Better yet:16,change list:16,drawn and:16,pixel and:16,in 256-color:16,address registers:16,1 the:16,function 10H:16,the page:16,are stored:16,background color:16,the visible:16,in plane:16,x and:16,Bresenham’s algorithm:16,3-D graphics:16,screen coordinates:16,the cross:16,light source:16,beam tree:16,the beam:16,how it:15,Dr Dobb’s:15,place to:15,that doesn’t:15,and when:15,on this:15,is simply:15,we’re going:15,an important:15,you get:15,program and:15,lots of:15,consider the:15,out how:15,is always:15,byte to:15,on your:15,and Listing:15,per byte:15,its own:15,the specified:15,it makes:15,what it:15,call to:15,pointer to:15,data in:15,the operation:15,data is:15,it into:15,and there’s:15,is required:15,under the:15,which it:15,programming the:15,are only:15,As with:15,to you:15,an assembly:15,fetch time:15,with which:15,once every:15,refer to:15,sets the:15,system clock:15,way in:15,although it:15,the 8088’s:15,RAM refresh:15,the count:15,and we:15,will see:15,Now we’re:15,ready to:15,after all:15,or to:15,worth noting:15,that only:15,in just:15,limited to:15,the effect:15,happens to:15,we do:15,no such:15,one that:15,that we’re:15,memory operands:15,a key:15,instruction and:15,next instruction:15,how fast:15,so long:15,when they:15,we get:15,by which:15,the extra:15,is being:15,is of:15,data for:15,conjunction with:15,the extent:15,compared to:15,to program:15,the string:15,the very:15,for two:15,which we:15,to accomplish:15,within a:15,and with:15,or three:15,faster on:15,the lines:15,but they:15,came up:15,C and:15,a point:15,however that:15,can handle:15,the bitmap:15,important to:15,So for:15,to try:15,especially for:15,first and:15,32-bit addressing:15,on top:15,as described:15,without a:15,simple matter:15,the direction:15,the inside:15,chapter we’ll:15,the change:15,to VGA:15,Attribute Controller:15,Graphics Controller:15,line in:15,The sample:15,pixels as:15,byte written:15,the images:15,sync pulse:15,up and:15,color is:15,Enable Set/Reset:15,plane to:15,Listing 30.1:15,in 320x400:15,is calculated:15,to page:15,X is:15,major axis:15,Listing 43.1:15,in 3-D:15,backface removal:15,the cross-product:15,the front:15,dynamic lighting:15,light map:15,surface cache:15,which was:14,is pretty:14,Zen of:14,was in:14,but at:14,much of:14,that for:14,if they:14,out and:14,the user:14,high-level language:14,do and:14,the optimization:14,find that:14,your programs:14,is easy:14,the real:14,at some:14,bytes and:14,memory so:14,loop is:14,implementation is:14,10 percent:14,C library:14,among the:14,know the:14,a performance:14,and use:14,but there’s:14,be faster:14,and you’ll:14,a C:14,restartable blocks:14,a block:14,well worth:14,are more:14,is basically:14,approach that:14,instructions to:14,than that:14,performed by:14,generated by:14,well to:14,and its:14,provides a:14,moment to:14,and also:14,your own:14,far from:14,that makes:14,the knowledge:14,case in:14,instruction fetch:14,improve the:14,which we’ll:14,note that:14,All in:14,The result:14,single instruction:14,for use:14,use in:14,after a:14,always be:14,in memory:14,to test:14,too much:14,have any:14,your program:14,as quickly:14,quickly as:14,lack of:14,That’s all:14,In general:14,instructions for:14,know of:14,point out:14,see in:14,understanding the:14,terms of:14,data bus:14,the Execution:14,width of:14,a maximum:14,with only:14,will become:14,value to:14,8 cycles:14,instruction execution:14,10 cycles:14,that instruction:14,the preceding:14,or so:14,to show:14,in both:14,performance cost:14,so far:14,to fill:14,should have:14,has no:14,as if:14,one time:14,First the:14,or all:14,Display memory:14,not that:14,graphics mode:14,example if:14,pixels and:14,take advantage:14,address in:14,We can:14,are also:14,that there’s:14,to process:14,a 286:14,an odd:14,that has:14,32-bit register:14,This makes:14,and they:14,up in:14,a function:14,and without:14,more difficult:14,if necessary:14,chapter and:14,is stored:14,look for:14,1 0:14,the values:14,none of:14,The solution:14,The 286:14,only those:14,So far:14,reduce the:14,address and:14,list is:14,the 486’s:14,without the:14,a normal:14,is how:14,is shown:14,the algorithm:14,of polygon:14,polygon edges:14,are to:14,chapter I’ll:14,the game:14,the cellmap:14,and drawing:14,cell triplet:14,known as:14,when drawing:14,the scan:14,images are:14,one frame:14,pel panning:14,plane and:14,other planes:14,at how:14,pixels are:14,stored as:14,pixel value:14,to clip:14,DAC registers:14,leading edge:14,line-drawing algorithm:14,true line:14,1 1:14,minor axis:14,drawing is:14,polygon as:14,hidden surface:14,of animation:14,screen space:14,the origin:14,in X-Sharp:14,destination polygon:14,a texture:14,source texture:14,wall C:14,and y:14,dot products:14,polygon models:14,see if:13,made it:13,and was:13,and writing:13,book is:13,the past:13,and performance:13,but a:13,me a:13,long time:13,each other:13,even the:13,plenty of:13,of some:13,going on:13,It’s not:13,making the:13,a particular:13,will do:13,code will:13,design and:13,the context:13,know what:13,byte in:13,sure that:13,or if:13,value for:13,If we:13,for Listing:13,equivalent to:13,except that:13,the slowest:13,MHz 386:13,a particularly:13,a significant:13,overall performance:13,or any:13,for us:13,a considerable:13,when it’s:13,the average:13,is fast:13,exactly what:13,in and:13,In Listing:13,with one:13,complicated than:13,spent in:13,different from:13,from that:13,chapter The:13,good assembly:13,the potential:13,mode of:13,addressing modes:13,language optimization:13,having to:13,generation of:13,CPU to:13,the remainder:13,only two:13,Given the:13,combination of:13,with this:13,is true:13,cycles and:13,8 bits:13,if I:13,in their:13,The most:13,versions of:13,precision Zen:13,0 of:13,any time:13,in use:13,even a:13,the single:13,be called:13,results in:13,to modify:13,go to:13,the idea:13,affect the:13,This approach:13,µs per:13,is all:13,point in:13,need for:13,be loaded:13,will work:13,work on:13,might want:13,also a:13,which a:13,many as:13,not necessarily:13,we’ll use:13,but as:13,of PC:13,and Pentium:13,to give:13,of performance:13,those that:13,to and:13,the low:13,a value:13,a word-sized:13,half the:13,The obvious:13,byte-sized memory:13,is built:13,no more:13,although the:13,That is:13,to four:13,as part:13,code sequence:13,intended to:13,very fast:13,a series:13,don’t know:13,to minimize:13,At this:13,of every:13,but there:13,in conjunction:13,I mentioned:13,keep the:13,answer is:13,the old:13,writes to:13,for display:13,do a:13,the displayed:13,pixels on:13,but we:13,access display:13,4 or:13,considerably more:13,realized that:13,in Chapters:13,1 2:13,being used:13,the area:13,up by:13,than twice:13,are still:13,makes for:13,address to:13,that way:13,drawn to:13,I discussed:13,a sample:13,complex and:13,also the:13,in detail:13,though the:13,and there:13,address is:13,be read:13,present in:13,and 2:13,floating point:13,uses the:13,of pixel:13,example you:13,points to:13,each character:13,the Z:13,a node:13,field of:13,accomplished by:13,start to:13,one another:13,edges and:13,it’s the:13,drawing of:13,two pipes:13,both pipes:13,is controlled:13,register at:13,selected by:13,screen to:13,lines are:13,the monitor:13,the 16:13,that plane:13,8 pixels:13,is displayed:13,Once the:13,the ALUs:13,are always:13,Data Rotate:13,pixels that:13,Controller register:13,plane 2:13,all bits:13,Write mode:13,to flip:13,Don’t Care:13,plane of:13,image and:13,Address registers:13,and draw:13,direction of:13,6 bits:13,running error:13,drawn at:13,Foley and:13,line segments:13,edges that:13,polygon in:13,the GET:13,with respect:13,respect to:13,the 3-D:13,perspective projection:13,two vectors:13,unit vector:13,texture mapper:13,the wall:13,each leaf:13,product is:13,backface culling:13,Listing 62.1:13,models are:13,the middle:12,and do:12,the Quake:12,Assembly Language:12,write a:12,working in:12,though and:12,wanted to:12,from now:12,will have:12,the moment:12,in his:12,code I:12,in many:12,it on:12,Dobb’s Journal:12,key is:12,do you:12,the software:12,that any:12,When you:12,time on:12,with just:12,have an:12,to turn:12,so let’s:12,let’s look:12,words the:12,over a:12,right now:12,any particular:12,single byte:12,time taken:12,is indeed:12,takes a:12,the main:12,that time:12,for every:12,out for:12,of magnitude:12,if there:12,a buffer:12,and some:12,example consider:12,it’s just:12,now on:12,of four:12,a total:12,that to:12,of their:12,are written:12,either the:12,choice for:12,be as:12,true that:12,at its:12,later chapters:12,time required:12,generating a:12,the output:12,set by:12,at address:12,an hour:12,timer interrupt:12,we will:12,is if:12,including the:12,you that:12,good idea:12,idea to:12,the text:12,be stored:12,to put:12,even on:12,for reasons:12,The same:12,given instruction:12,no need:12,uses a:12,that at:12,this particular:12,that on:12,described above:12,to finish:12,my mind:12,you really:12,really need:12,as good:12,the programming:12,performs a:12,external data:12,the AT:12,It’s a:12,data flow:12,cycles are:12,required for:12,For instance:12,discuss the:12,and two:12,optimization in:12,which I’ll:12,than they:12,runs at:12,speed and:12,becomes a:12,improve performance:12,to complete:12,being a:12,memory for:12,of bits:12,to control:12,data from:12,cache misses:12,and will:12,do so:12,All the:12,graphics modes:12,line the:12,the distance:12,with that:12,make for:12,it isn’t:12,can then:12,then be:12,in our:12,larger than:12,so we’ll:12,C implementation:12,might not:12,worth the:12,chapter I:12,program to:12,an index:12,two registers:12,286 or:12,good for:12,especially when:12,one more:12,register can:12,I’ll call:12,capabilities of:12,in most:12,as with:12,are all:12,to advance:12,advance the:12,work to:12,pretty good:12,doesn’t have:12,to convert:12,pointer is:12,unless you:12,little more:12,once for:12,resulting in:12,2 to:12,to eliminate:12,is greater:12,we come:12,with it:12,This was:12,no one:12,writing the:12,mode The:12,built around:12,reason that:12,a reasonable:12,are on:12,two of:12,be calculated:12,the addressing:12,addressing pipeline:12,worry about:12,that register:12,the fast:12,one and:12,three instructions:12,had the:12,left to:12,an edge:12,the mismatch:12,the head:12,guaranteed to:12,done by:12,partly because:12,Listing 16.4:12,that aren’t:12,Listing 17.1:12,each edge:12,implemented in:12,drawing and:12,made to:12,drawing code:12,is accomplished:12,illustrated by:12,Listing 21.1:12,once per:12,the Graphics:12,AC Index:12,Input Status:12,the Data:12,the book:12,VGA has:12,the Enable:12,Listing 26.1:12,being drawn:12,pixel of:12,Color Don’t:12,palette register:12,all 256:12,each line:12,a game:12,pixels per:12,in 360x480:12,The DAC:12,once and:12,in drawing:12,current Y:12,coordinates of:12,polygon edge:12,vertices in:12,Listing 40.1:12,polygons to:12,intensity of:12,painter’s algorithm:12,masked copying:12,clipping is:12,angle between:12,mapping is:12,world BSP:12,BSP compiler:12,the FPU:12,to sort:12,BSP models:12,Quake 2:12,John Carmack:11,things up:11,of us:11,I wrote:11,I hope:11,Most of:11,run into:11,it could:11,being the:11,to pick:11,to learn:11,first time:11,of graphics:11,down and:11,are just:11,of instruction:11,this and:11,much difference:11,and those:11,wouldn’t be:11,understanding of:11,and of:11,code as:11,that code:11,a file:11,make sure:11,no guarantee:11,fit in:11,an implementation:11,Listing 1.5:11,than any:11,to search:11,code with:11,access the:11,would seem:11,as that:11,difference in:11,you were:11,don’t want:11,much better:11,the calling:11,with code:11,how long:11,a specific:11,it uses:11,brings us:11,an approach:11,code by:11,time spent:11,especially in:11,I do:11,four bits:11,code that’s:11,total of:11,the programmer:11,machine language:11,is nothing:11,operating system:11,timer and:11,memory organization:11,a complex:11,that most:11,far the:11,on which:11,to spend:11,only about:11,possible in:11,only by:11,that an:11,programming is:11,Zen Timer:11,50 percent:11,from any:11,is called:11,that while:11,seems to:11,timing interval:11,code being:11,Each of:11,on how:11,by two:11,can perform:11,In addition:11,advancing the:11,to zero:11,You may:11,load a:11,more accurate:11,of various:11,Listing 3.2:11,Listing 3.3:11,It’s worth:11,segment and:11,you just:11,does the:11,allows the:11,Setting the:11,0 then:11,two separate:11,code model:11,addition to:11,a far:11,only because:11,Borland C:11,How the:11,described in:11,over time:11,fact it:11,read or:11,or write:11,and especially:11,all we:11,in terms:11,instructions with:11,is simple:11,high byte:11,instructions can:11,20 percent:11,two to:11,difference is:11,to provide:11,assume that:11,that every:11,memory byte:11,code can:11,bytes to:11,per instruction:11,Unit execution:11,talk about:11,when you’re:11,Listing 4.5:11,which they:11,next and:11,control the:11,The answer:11,to leave:11,and at:11,If you’re:11,by that:11,so they:11,just like:11,and what:11,cycle times:11,an image:11,would take:11,on average:11,ideal for:11,in either:11,do all:11,We could:11,to their:11,REPZ CMPS:11,requires that:11,program the:11,as one:11,algorithm is:11,time we:11,be very:11,be found:11,it wasn’t:11,be much:11,a book:11,index register:11,You see:11,made the:11,three cycles:11,excellent example:11,the level:11,are set:11,used the:11,rule is:11,whenever you:11,that I’ll:11,for performance:11,are some:11,a linked:11,was just:11,case where:11,more of:11,the logical:11,method for:11,can easily:11,One of:11,organization of:11,return to:11,problem of:11,though that:11,we are:11,may seem:11,apply to:11,we’ll look:11,data alignment:11,alignment cycle-eater:11,a branch:11,maximum performance:11,be quite:11,bits and:11,simple instructions:11,register as:11,loads the:11,and he:11,component of:11,ahead of:11,least one:11,the aforementioned:11,but this:11,looks like:11,give you:11,for some:11,text in:11,still be:11,contains a:11,choose to:11,for your:11,types of:11,are added:11,it’s necessary:11,so there:11,node and:11,on that:11,word count:11,For each:11,fastest possible:11,state machine:11,to detect:11,and back:11,a cell:11,and has:11,from scratch:11,calculating the:11,the eight:11,However I:11,that were:11,this time:11,great many:11,list and:11,Then the:11,The Pentium:11,VGA can:11,the Attribute:11,VGA registers:11,the GC:11,to force:11,screen the:11,controls the:11,screen The:11,the planes:11,from each:11,you run:11,Pel Panning:11,Panning register:11,come from:11,writing to:11,bit 0:11,Chapter 25:11,pixels to:11,Rotate register:11,The latches:11,bit 7:11,the intensity:11,plane normal:11,to plane:11,and each:11,7 of:11,color of:11,of write:11,color and:11,on whether:11,in system:11,of plane:11,colors of:11,4-bit pixel:11,bit from:11,color set:11,normal screen:11,Chapter 47:11,the horizontal:11,more and:11,Write Index:11,frame to:11,right edge:11,standard Bresenham’s:11,fixed-point arithmetic:11,Listing 37.1:11,vertex is:11,chapter’s code:11,Chapter 39:11,and van:11,is encountered:11,fill code:11,the outside:11,the span:11,animation in:11,be clipped:11,lighting and:11,world space:11,clip plane:11,cosine of:11,the cosine:11,unit vectors:11,The dot:11,source image:11,a 2-D:11,that node:11,moving objects:11,2-D BSP:11,frame of:11,polygon that:11,triangle models:11,middle of:10,ended up:10,working on:10,it out:10,so fast:10,it The:10,never have:10,only be:10,I learned:10,the basis:10,about a:10,source code:10,handle the:10,the beginning:10,use that:10,that and:10,hard work:10,best to:10,see shortly:10,Before we:10,requires a:10,be an:10,of both:10,data structures:10,working code:10,lies in:10,reading the:10,because we:10,best way:10,that many:10,next byte:10,function to:10,Table 1.1:10,in size:10,10 MHz:10,faster and:10,but you:10,that takes:10,loop in:10,is spent:10,calls and:10,How can:10,as needed:10,and see:10,similar to:10,than an:10,an order:10,even when:10,just how:10,reason is:10,The third:10,though it:10,concept of:10,searching for:10,already in:10,we learned:10,for you:10,is almost:10,speeding up:10,focus on:10,by no:10,language code:10,I’ll be:10,it’s hard:10,The point:10,of other:10,high-level languages:10,and another:10,controlling the:10,so this:10,remainder of:10,to save:10,described earlier:10,itself is:10,your mind:10,code of:10,about what:10,Using the:10,I came:10,of about:10,to measure:10,you think:10,times the:10,those instructions:10,The Zen:10,is with:10,the resulting:10,the companion:10,companion CD-ROM:10,it works:10,indicate that:10,soon as:10,more slowly:10,mode which:10,time that:10,we’re ready:10,will run:10,which case:10,to stop:10,to deal:10,goes to:10,Notes on:10,the segment:10,describe the:10,is certainly:10,of AL:10,memory variable:10,noting that:10,performed in:10,why the:10,way we:10,the test:10,MOV AL:10,same way:10,knowledge that:10,time The:10,since it:10,not one:10,fact that:10,1 in:10,on in:10,as for:10,calling the:10,relatively small:10,can cause:10,because I:10,start on:10,that lie:10,the bus:10,you find:10,the simplest:10,it all:10,the external:10,of just:10,to system:10,in some:10,instruction can:10,one to:10,other instructions:10,show up:10,with any:10,memory location:10,to manipulate:10,regardless of:10,the EU:10,each SHR:10,Let’s look:10,sequence of:10,in parallel:10,overall execution:10,a change:10,rule of:10,true for:10,Also the:10,that one:10,performance by:10,tell you:10,be added:10,faster to:10,I mean:10,without any:10,memory that:10,bit more:10,any way:10,would make:10,the long:10,and get:10,often the:10,is another:10,time it:10,Since the:10,VGA modes:10,a constant:10,PC graphics:10,That’s not:10,so many:10,source and:10,graphics code:10,be avoided:10,closer to:10,about as:10,memory In:10,would work:10,buffer is:10,what they:10,the approach:10,copying the:10,fill the:10,not particularly:10,first thing:10,anywhere in:10,could do:10,we’re not:10,would never:10,the remaining:10,the character:10,looked at:10,speed is:10,work and:10,the field:10,value in:10,to all:10,LEA can:10,no doubt:10,The two:10,486 is:10,The operation:10,sum of:10,a Pentium:10,The 386:10,a relatively:10,unrolling the:10,bytes are:10,s are:10,the simple:10,rotate the:10,of registers:10,to preserve:10,very good:10,a nice:10,are so:10,of ways:10,useful in:10,you can’t:10,size and:10,the back:10,be handled:10,range of:10,the width:10,the rightmost:10,approach of:10,This technique:10,care of:10,change in:10,that cycle:10,that with:10,bit in:10,way that:10,it the:10,Euclid’s algorithm:10,finding the:10,more interesting:10,or at:10,would also:10,we’ll get:10,instruction as:10,the target:10,having a:10,find out:10,but one:10,the near:10,directly from:10,single cycle:10,indexed addressing:10,byte register:10,my daughter:10,The final:10,is fully:10,good as:10,for maximum:10,was an:10,you look:10,the least:10,of thinking:10,header file:10,out there:10,look up:10,the topic:10,Listing 16.5:10,by simply:10,the Game:10,of cells:10,hundreds of:10,Listing 17.4:10,Listing 17.5:10,to worry:10,the amount:10,U-pipe and:10,that point:10,address of:10,256 colors:10,VGA programming:10,make up:10,by writing:10,the Input:10,a color:10,eight pixels:10,in VGA:10,screen as:10,planes in:10,of 0:10,image to:10,RAM and:10,5 of:10,3 of:10,Mode register:10,two pages:10,per frame:10,next frame:10,so only:10,frame rate:10,drawing in:10,each frame:10,settings of:10,sense of:10,mask is:10,a mode:10,for mode:10,corresponding bit:10,the blue:10,register 0:10,for plane:10,color in:10,Write Mode:10,the X-Sharp:10,to text:10,Color Compare:10,Compare register:10,Care register:10,directly to:10,pixel values:10,to color:10,well with:10,the border:10,resolution and:10,of mode:10,right and:10,Listing 31.1:10,16-color modes:10,drawing each:10,per scan:10,proved to:10,VGA color:10,each color:10,DAC Write:10,every pixel:10,DAC location:10,Bresenham’s line-drawing:10,Y coordinates:10,coordinate is:10,drawn as:10,lines in:10,the sign:10,sign of:10,the ideal:10,convex polygon:10,polygons on:10,and right:10,adjacent polygons:10,Listing 38.1:10,vertices and:10,active edges:10,that polygons:10,Listing 39.1:10,spans are:10,error accumulator:10,each image:10,Vertical Sync:10,the painter’s:10,are then:10,of reference:10,to 3-D:10,of vertices:10,the sorting:10,shading is:10,directed light:10,described by:10,Texture Mapping:10,texture map:10,the scene:10,world database:10,the node’s:10,the z:10,Listing 59.4:10,the surfaces:10,the splitter:10,potentially visible:10,surface-based lighting:10,copy of:9,id Software:9,the Internet:9,willing to:9,there and:9,of Assembly:9,very long:9,was able:9,Chris Hecker:9,already been:9,or in:9,a programmer:9,could get:9,my own:9,group of:9,the job:9,a computer:9,I used:9,hardware and:9,book but:9,1 The:9,past the:9,the obvious:9,code would:9,a compiler:9,build a:9,sets of:9,purpose of:9,he was:9,What does:9,you’ll find:9,language and:9,context of:9,the task:9,an example:9,is reached:9,a 10:9,times are:9,clear that:9,code The:9,it’s still:9,times in:9,interrupts are:9,more cycles:9,and read:9,100 percent:9,entirely in:9,considerable amount:9,is already:9,and often:9,shows that:9,in place:9,functions in:9,until it:9,In Chapter:9,At any:9,any rate:9,can go:9,indicates that:9,same code:9,you write:9,be considerably:9,All this:9,This chapter:9,no means:9,again in:9,ago I:9,spent a:9,time through:9,hand the:9,example a:9,a linear:9,the 32-bit:9,then is:9,set and:9,any sort:9,by far:9,collection of:9,of information:9,to examine:9,assembly programming:9,like that:9,by doing:9,well In:9,need the:9,worse than:9,author of:9,his code:9,in later:9,not very:9,from my:9,as four:9,much slower:9,run the:9,Listing 3.1:9,to these:9,be timed:9,as soon:9,to occur:9,interesting point:9,on its:9,to maintain:9,to about:9,period of:9,time but:9,than 54:9,display a:9,and since:9,3 to:9,at most:9,long to:9,times and:9,how many:9,One interesting:9,a special:9,count and:9,timing results:9,timer to:9,many ways:9,out a:9,the relative:9,models in:9,discuss shortly:9,display the:9,its entirety:9,right in:9,BIOS to:9,or less:9,potential for:9,will always:9,doesn’t work:9,it also:9,you’re using:9,order for:9,memory This:9,fraction of:9,can take:9,you are:9,from Listing:9,be changed:9,doing this:9,taken by:9,access memory:9,chapter is:9,are no:9,and this:9,the cycle-eaters:9,optimization rules:9,instruction prefetching:9,memory or:9,states and:9,the 8086:9,maximum rate:9,it or:9,that does:9,with other:9,memory variables:9,per loop:9,each word:9,let the:9,in registers:9,all sorts:9,registers as:9,because they:9,associated with:9,it’s an:9,meaning that:9,whether a:9,run at:9,work out:9,run Listing:9,the cycle:9,it’s easy:9,cycles of:9,to both:9,You could:9,6 cycles:9,during which:9,first byte:9,registers is:9,remember that:9,that your:9,the DRAM:9,only for:9,that as:9,cycles but:9,possible and:9,do to:9,there’s nothing:9,code size:9,very much:9,of execution:9,extent of:9,display adapters:9,the many:9,areas of:9,the base:9,a major:9,times to:9,many more:9,required in:9,the EGA’s:9,mind that:9,a dozen:9,a graphics:9,set all:9,worth of:9,of work:9,is for:9,in particular:9,all that’s:9,to what:9,need is:9,the potentially:9,is quite:9,I suspect:9,for most:9,is found:9,bytes the:9,the core:9,recall from:9,would require:9,assembly implementation:9,same thing:9,filled with:9,it up:9,I found:9,to identify:9,PC TECHNIQUES:9,the possibility:9,always the:9,produce the:9,set is:9,register or:9,modes to:9,the sum:9,to some:9,the index:9,been a:9,have made:9,out in:9,appears to:9,cycle and:9,cached 386:9,to reflect:9,levels of:9,matter what:9,bottom of:9,instructions but:9,of setting:9,time This:9,considered to:9,Put another:9,as opposed:9,opposed to:9,and POP:9,functions to:9,an area:9,the function:9,the critical:9,minimum of:9,saying that:9,information is:9,no problem:9,for both:9,but only:9,a much:9,a lookup:9,the interests:9,interests of:9,complex than:9,process is:9,applied to:9,prefix byte:9,mode as:9,code a:9,far jump:9,and I’ve:9,until you:9,times for:9,the faster:9,problem and:9,a straightforward:9,the GCD:9,I want:9,out with:9,how far:9,the default:9,one I:9,a larger:9,386 is:9,run in:9,are needed:9,around a:9,from all:9,address the:9,it must:9,course the:9,about this:9,I should:9,value with:9,learned about:9,byte and:9,code on:9,case with:9,be implemented:9,5 cycles:9,one register:9,s to:9,register for:9,cycles before:9,memory are:9,at one:9,feel for:9,to mention:9,complete with:9,are loaded:9,they have:9,register set:9,serve as:9,it had:9,we can’t:9,will not:9,to right:9,I say:9,this was:9,not necessary:9,approximation of:9,function that:9,First it:9,the universe:9,test for:9,Listing 17.3:9,to cover:9,point and:9,made a:9,object is:9,be displayed:9,free to:9,can have:9,on every:9,use for:9,one in:9,must first:9,I am:9,much easier:9,in Action:9,complexity of:9,values are:9,lines and:9,possible colors:9,Listing 23.1:9,and page:9,GC Index:9,word OUT:9,that scan:9,single pixel:9,10H function:9,CPU writes:9,color effects:9,writes the:9,plane at:9,screen with:9,of page:9,of images:9,16-color mode:9,be modified:9,s and:9,latches can:9,latches are:9,that could:9,and color:9,the font:9,rotation and:9,planes 0:9,in software:9,the CGA:9,same color:9,pixel color:9,320x200 256-color:9,pixel on:9,want the:9,starts at:9,the principles:9,0 through:9,to step:9,vertical blanking:9,two parts:9,Listing 30.2:9,a frame:9,two pixels:9,draws a:9,is visible:9,RAM registers:9,color component:9,way as:9,error of:9,the endpoints:9,the center:9,pixel along:9,DeltaX is:9,such that:9,90 degrees:9,polygons can:9,a convex:9,left and:9,polygons with:9,previous chapter’s:9,Listing 39.3:9,the rectangle:9,van Dam:9,edge and:9,visual quality:9,a wall:9,square pixels:9,rectangle fill:9,coordinates and:9,object space:9,perpendicular to:9,of view:9,surfaces and:9,surface removal:9,cross-product of:9,the vector:9,that surface:9,DDA texture:9,Listing 57.2:9,BSP Trees:9,a scene:9,view pyramid:9,clipping to:9,each wall:9,Listing 59.2:9,and z:9,in viewspace:9,visible from:9,sorted spans:9,a span:9,trailing edge:9,sorting on:9,of 1/z:9,subdivision rasterization:9,onto a:8,I spent:8,the day:8,optimized assembly:8,fall into:8,fast and:8,workings of:8,graphics and:8,people who:8,I wanted:8,overview of:8,As you’ll:8,I got:8,almost all:8,was going:8,for me:8,the graphics:8,starting with:8,thing as:8,didn’t work:8,a year:8,When a:8,in it:8,my first:8,Tech Journal:8,column in:8,beginning of:8,when one:8,even more:8,David Stafford:8,in truth:8,we should:8,inside and:8,solution to:8,high-performance code:8,that matter:8,a certain:8,the answer:8,need a:8,best of:8,better way:8,them in:8,and adds:8,the available:8,thing that:8,value and:8,language implementation:8,that means:8,the application:8,Listing 1.4:8,implement a:8,that much:8,well and:8,won’t be:8,reason to:8,a pointer:8,reasons that:8,and wait:8,library functions:8,nothing to:8,blocks of:8,is read:8,produced by:8,considerably faster:8,up on:8,only way:8,looking for:8,sped up:8,the form:8,a critical:8,run as:8,In case:8,something like:8,every time:8,understand why:8,No matter:8,Consequently the:8,course is:8,the quality:8,and every:8,to your:8,is important:8,hardware is:8,for code:8,more to:8,are often:8,almost always:8,is maintained:8,by itself:8,that both:8,heart of:8,of being:8,ability of:8,is better:8,doesn’t mean:8,bulk of:8,of most:8,to those:8,the limitations:8,limitations of:8,not just:8,to waste:8,where you:8,said that:8,good code:8,from your:8,bits to:8,well have:8,In truth:8,drawn on:8,the effects:8,effects of:8,I’ll refer:8,you shouldn’t:8,and returns:8,were in:8,to ZTimerOn:8,for other:8,timer 2:8,specified by:8,output of:8,turns over:8,mode mode:8,is both:8,a perfect:8,8088 can:8,in such:8,later in:8,cannot be:8,Recall that:8,are disabled:8,whenever the:8,value that:8,tell the:8,the calls:8,location in:8,result to:8,code runs:8,or by:8,to describe:8,as measured:8,relatively slow:8,does a:8,directly into:8,assumes that:8,queue and:8,you wish:8,directly in:8,you won’t:8,and therefore:8,feature of:8,causes the:8,In my:8,that I’ve:8,1 as:8,leave the:8,memory a:8,a slow:8,from C:8,model and:8,model C:8,example in:8,converted to:8,The full:8,and faster:8,the far:8,impossible to:8,the benefits:8,to view:8,those of:8,simple but:8,as I’ll:8,the absolute:8,things that:8,programming interface:8,and their:8,bus access:8,16-bit processor:8,bus and:8,suffer from:8,most important:8,everything in:8,an 8-bit:8,the matter:8,identical to:8,it allows:8,is really:8,only 1:8,byte or:8,or 1:8,By contrast:8,the 386SX:8,word at:8,in two:8,word-sized accesses:8,the official:8,longer to:8,cycles for:8,The upshot:8,results are:8,so in:8,I’ve said:8,each instruction:8,will take:8,keep up:8,instruction to:8,queue is:8,supposed to:8,leaves the:8,to talk:8,really is:8,alter the:8,start and:8,and end:8,or 8:8,the rule:8,For another:8,same speed:8,we really:8,two times:8,as being:8,technique is:8,6 bytes:8,differs from:8,refresh is:8,a read:8,be accessed:8,1 of:8,would otherwise:8,is especially:8,especially true:8,code which:8,word-sized variables:8,approach would:8,The display:8,states are:8,Mind you:8,not possible:8,understand how:8,video circuitry:8,more important:8,than to:8,half as:8,in half:8,VGA the:8,cause the:8,mode to:8,text modes:8,REP MOVS:8,about half:8,individual pixels:8,images to:8,memory with:8,took a:8,it requires:8,it can’t:8,So we:8,how we:8,do we:8,technique that:8,as illustrated:8,performing a:8,check for:8,that we’ve:8,pieces of:8,on The:8,this by:8,that’s how:8,That’s really:8,the reason:8,Take a:8,some interesting:8,you’ll recall:8,character that:8,than three:8,language version:8,time was:8,had never:8,instructions such:8,optimization for:8,faster at:8,effective address:8,or 386:8,a base:8,any register:8,more compact:8,32-bit registers:8,dealing with:8,New York:8,might have:8,corner of:8,exploration of:8,local optimization:8,put it:8,it this:8,setting up:8,and 486:8,do for:8,The trick:8,of characters:8,be useful:8,you a:8,setting bit:8,and look:8,as simple:8,can just:8,Not only:8,but with:8,even in:8,C compilers:8,and may:8,I’ve seen:8,benefit of:8,386 The:8,kind of:8,Mr Bourgeis:8,long run:8,and I’ll:8,the years:8,I’ll return:8,Look at:8,isn’t a:8,these instructions:8,but many:8,be reduced:8,reduced to:8,and add:8,9 cycles:8,the range:8,a wonderful:8,then use:8,that by:8,a table:8,What if:8,because there:8,sweet spot:8,three bytes:8,32-bit protected:8,a prefix:8,so a:8,you’ll have:8,one bit:8,something that:8,in different:8,we take:8,and start:8,chapter I’m:8,is useful:8,I’m sure:8,good example:8,and now:8,Listing 10.1:8,algorithm to:8,And in:8,data recursion:8,provides the:8,still in:8,on for:8,286 is:8,that mode:8,apart from:8,a wide:8,given time:8,286/386 computers:8,found in:8,the place:8,well The:8,penalty for:8,the offset:8,last byte:8,while I:8,of having:8,the issue:8,aware of:8,that access:8,segment is:8,1 bit:8,especially on:8,since they:8,case for:8,we’ll have:8,up for:8,before we:8,won’t work:8,486 optimization:8,math coprocessor:8,widely used:8,internal cache:8,definition of:8,the loading:8,loading a:8,but because:8,addressing register:8,is involved:8,extra cycle:8,only that:8,the trick:8,before being:8,results of:8,a feel:8,element of:8,that some:8,was no:8,lines at:8,cycle to:8,second on:8,to rotate:8,to split:8,into one:8,earlier in:8,could then:8,this technique:8,to by:8,edge to:8,and said:8,a friend:8,the discussion:8,from which:8,a complete:8,somewhat faster:8,maximum of:8,it easy:8,went to:8,composed of:8,polygon fill:8,an arbitrary:8,node for:8,the tail:8,is guaranteed:8,determine whether:8,form a:8,the challenge:8,where a:8,a faster:8,It’s also:8,David’s code:8,bit is:8,produce a:8,the root:8,cell is:8,an object:8,copy the:8,we’re done:8,Life implementation:8,and mask:8,implementation in:8,byte for:8,by drawing:8,every single:8,define the:8,draw each:8,next step:8,step is:8,that particular:8,branch prediction:8,of Pentium:8,so as:8,space and:8,the cycles:8,which way:8,well but:8,and we’re:8,that had:8,REP STOS:8,to begin:8,has its:8,done for:8,through which:8,Listing 21.3:8,to illustrate:8,of ClearS:8,the fill:8,VGAs are:8,the ball:8,vertical and:8,the CRT:8,to 3C0H:8,Status 1:8,drawing lines:8,given plane:8,per plane:8,CRTC register:8,is defined:8,defined by:8,line at:8,color The:8,1 then:8,image in:8,for vertical:8,new start:8,page has:8,has flipped:8,pixel data:8,is far:8,flipping and:8,to drawing:8,write modes:8,CPU reads:8,of planes:8,draw text:8,drawn by:8,13H the:8,for details:8,barrel shifter:8,planes that:8,planes to:8,register Graphics:8,0 or:8,data path:8,to appear:8,possible for:8,those pixels:8,the foreground:8,point on:8,bitmap to:8,many pixels:8,horizontal lines:8,type of:8,plane in:8,10H and:8,color compare:8,in read:8,some time:8,for color:8,hardware can:8,as each:8,an EGA:8,current scan:8,the resolution:8,VGA mode:8,to map:8,images and:8,drawing Listing:8,calculated as:8,set code:8,support for:8,to cycle:8,real time:8,color translation:8,color paging:8,DAC register:8,of DAC:8,before loading:8,DAC Data:8,RGB color:8,the advantage:8,X coordinates:8,the coordinate:8,in other:8,lines for:8,coordinates in:8,lengths of:8,are performed:8,each step:8,the fractional:8,with less:8,Chapter 38:8,a 3-D:8,surface and:8,polygons is:8,two edges:8,determine which:8,Listing 39.2:8,Listing 39.4:8,a leading:8,any polygon:8,polygon to:8,vertices that:8,3CH red:8,reduces the:8,if he:8,dirty rectangles:8,the bounding:8,the objects:8,16 pixels:8,about 3-D:8,Z axis:8,as viewed:8,viewpoint to:8,space in:8,vertices to:8,as seen:8,seen from:8,in screen:8,the CD-ROM:8,in back-to-front:8,light sources:8,Mapping a:8,texture onto:8,destination scan:8,visible and:8,Listing 57.1:8,mapping a:8,source pointer:8,root node:8,world and:8,the z-buffer:8,walls in:8,wall is:8,in screenspace:8,the x:8,which side:8,Listing 60.1:8,the car:8,coordinate space:8,new coordinate:8,Quake and:8,the leaves:8,no overdraw:8,complex scenes:8,PVS is:8,each span:8,1/z sorting:8,the client:8,modified to:7,to sleep:7,on both:7,information and:7,in there:7,with its:7,what I’ve:7,I’ve learned:7,lot more:7,to thank:7,me that:7,it but:7,but to:7,I knew:7,For a:7,it I:7,a virtual:7,approaches and:7,would you:7,don’t get:7,of things:7,PC Tech:7,Terje Mathisen:7,for writing:7,fast that:7,do just:7,It also:7,was designed:7,of many:7,was so:7,half a:7,the considerable:7,could easily:7,you’re going:7,work well:7,it matters:7,performance matters:7,and don’t:7,optimize the:7,is going:7,As an:7,generates a:7,program will:7,a specified:7,fact it’s:7,too slow:7,small model:7,is Listing:7,out by:7,instructions of:7,All of:7,As shown:7,code are:7,awful lot:7,bytes for:7,one at:7,Consider this:7,a call:7,library function:7,information about:7,calling code:7,assembly and:7,a nuisance:7,enough and:7,which has:7,place of:7,your application:7,work but:7,the block:7,see a:7,lot faster:7,and again:7,we got:7,against the:7,basically a:7,axis of:7,an efficient:7,to focus:7,task of:7,case you’re:7,4 bytes:7,saving a:7,here and:7,about 10:7,your programming:7,it really:7,how a:7,a solution:7,the transformation:7,code into:7,is usually:7,is particularly:7,more powerful:7,simply a:7,transformation from:7,result the:7,quality of:7,both of:7,the lowest:7,programming and:7,high-performance assembly:7,takes to:7,notice that:7,focusing on:7,choice of:7,either of:7,the heart:7,language is:7,you in:7,That doesn’t:7,piece of:7,more so:7,the 1:7,that must:7,mind is:7,to become:7,back I:7,provided by:7,you’re not:7,performance from:7,heavily on:7,shifts and:7,cycle counting:7,performance The:7,a rate:7,second and:7,timer can:7,again and:7,be on:7,to mode:7,mode sets:7,should not:7,ZTimerOn and:7,via a:7,a 0:7,an interrupt:7,refresh and:7,line on:7,time-of-day count:7,mode In:7,very useful:7,over and:7,nearly as:7,and hence:7,not use:7,of up:7,as slow:7,see whether:7,effects on:7,too long:7,must always:7,called to:7,being timed:7,the specific:7,result from:7,right up:7,running the:7,ZTimerReport to:7,to place:7,4 and:7,suited to:7,by changing:7,of computer:7,we’ll discuss:7,a row:7,data can:7,in code:7,jump is:7,That’s why:7,be copied:7,IBM PC:7,µs or:7,much less:7,likely that:7,unable to:7,if that:7,You should:7,during a:7,one but:7,this problem:7,so there’s:7,stop the:7,we used:7,the fact:7,well on:7,containing the:7,we would:7,Why Because:7,is designed:7,with and:7,and makes:7,the solution:7,forms of:7,benefits of:7,the latest:7,the IBM:7,a useful:7,reference for:7,I suggest:7,our purposes:7,is what:7,at best:7,8088-based PC:7,Similarly the:7,processor the:7,features and:7,to performance:7,bit as:7,more the:7,to at:7,a bad:7,start at:7,of hardware:7,register-only instructions:7,The 8088:7,is clearly:7,Interface Unit:7,the limited:7,that’s just:7,an effective:7,word-sized access:7,memory operand:7,a greater:7,only 2:7,by performing:7,and using:7,As I’ve:7,way you:7,in less:7,calculation and:7,Remember that:7,the greatest:7,address calculations:7,doesn’t it:7,than with:7,bytes as:7,instruction byte:7,be fetched:7,can fetch:7,Not so:7,takes 2:7,that can’t:7,example is:7,the sequence:7,affects the:7,can vary:7,1000 times:7,which in:7,dozens of:7,refresh cycle-eater:7,it took:7,of thumb:7,reducing the:7,that our:7,that information:7,by looking:7,that because:7,determined by:7,the 2:7,important point:7,the impact:7,impact of:7,at their:7,they don’t:7,yet to:7,important is:7,start with:7,is programmed:7,accesses are:7,is lost:7,from 0:7,all times:7,allow the:7,a case:7,were no:7,variables in:7,with either:7,code could:7,and on:7,in PC:7,of reasons:7,presence of:7,When it:7,CPU is:7,problem in:7,screen This:7,displayed on:7,the picture:7,VGA clones:7,accessing display:7,memory the:7,isn’t going:7,we’re talking:7,graphics is:7,VGA The:7,mode that:7,we did:7,and destination:7,memory on:7,off and:7,486s and:7,in favor:7,favor of:7,repeated string:7,more on:7,from this:7,was only:7,We have:7,and forth:7,to fit:7,a fairly:7,application of:7,subset of:7,search engine:7,by loading:7,occurrence of:7,character in:7,putting the:7,really all:7,each block:7,is likely:7,is worth:7,though we:7,of loading:7,a text:7,performance would:7,point where:7,Although the:7,not an:7,although not:7,I’ve been:7,what you’re:7,a pattern:7,can often:7,that’s what:7,an array:7,add the:7,two approaches:7,to hear:7,register which:7,register The:7,give us:7,you the:7,amounts to:7,can now:7,is hard:7,much to:7,the door:7,and finally:7,can think:7,A more:7,very important:7,is slower:7,about twice:7,just fine:7,and while:7,time with:7,is replaced:7,near the:7,instructions as:7,obvious way:7,However it:7,simple as:7,almost any:7,be saved:7,the FLAGS:7,FLAGS register:7,though I:7,taking the:7,is available:7,your data:7,and far:7,by having:7,having the:7,the large:7,this means:7,store a:7,when they’re:7,which takes:7,be necessary:7,in protected:7,Unfortunately the:7,section of:7,array of:7,More on:7,original C:7,this rule:7,pointed out:7,absolute value:7,how you:7,know which:7,may have:7,I described:7,easily be:7,which you:7,around in:7,the dividend:7,the ratio:7,what is:7,eliminating the:7,word is:7,be applied:7,a dword:7,require a:7,plus a:7,a cache:7,a direct:7,the big:7,these two:7,all is:7,set a:7,I’ve found:7,I can’t:7,pattern matching:7,are generally:7,not at:7,are at:7,the better:7,the sense:7,for now:7,point I:7,before I:7,basis of:7,a GCD:7,Listing 10.2:7,I might:7,with Listing:7,precisely the:7,to imagine:7,code recursion:7,all those:7,of whatever:7,and we’ll:7,used with:7,wide variety:7,The performance:7,reasonably well:7,286 can:7,a close:7,the general:7,performance on:7,be learned:7,The data:7,ensure that:7,and never:7,power of:7,meant that:7,486 or:7,There’s nothing:7,Be aware:7,split into:7,but for:7,5 to:7,least a:7,the setting:7,that we’ll:7,stack and:7,that address:7,case we:7,register in:7,you’d expect:7,to them:7,if only:7,memory pointer:7,then a:7,model in:7,characteristics of:7,and make:7,all possible:7,because only:7,a process:7,don’t need:7,more sophisticated:7,expect to:7,the pipeline:7,cycle the:7,do some:7,33 MHz:7,MHz 486:7,you’ll notice:7,pay off:7,of 32-bit:7,are very:7,The next:7,considering that:7,more useful:7,easy way:7,that simple:7,this sequence:7,however The:7,special cases:7,and have:7,with me:7,there will:7,allows us:7,understand that:7,3 and:7,the leftmost:7,appear in:7,that might:7,a sentinel:7,it As:7,tried to:7,function for:7,the active:7,active edge:7,sorting is:7,model of:7,by all:7,the highest:7,I thought:7,don’t use:7,around to:7,of using:7,my original:7,original code:7,code Listing:7,my code:7,time so:7,to count:7,is currently:7,word as:7,rid of:7,and setting:7,eight neighbors:7,each cell:7,but what:7,by putting:7,of eight:7,edges to:7,I decided:7,the neighbor:7,neighbor counts:7,be needed:7,This can:7,mask and:7,external cache:7,That was:7,that although:7,than my:7,is finished:7,so if:7,is made:7,complex but:7,placed in:7,describing the:7,As the:7,data cache:7,a final:7,AGI can:7,involved in:7,lines with:7,special case:7,even then:7,each new:7,not much:7,walls and:7,we might:7,it sounds:7,a fair:7,not on:7,cycle of:7,of 10:7,loaded into:7,colors and:7,two chapters:7,are both:7,are being:7,between them:7,exactly one:7,why I:7,these problems:7,the complexity:7,order in:7,cases where:7,computer graphics:7,guarantees that:7,VGA provides:7,VGA in:7,horizontal panning:7,OUT to:7,color modes:7,smooth panning:7,VGA hardware:7,given pixel:7,all modes:7,Address High:7,for video:7,RAM register:7,interrupt 10H:7,planes can:7,planes and:7,images that:7,are copied:7,Page Flipping:7,exactly once:7,bit 3:7,Display Enable:7,can draw:7,that pixel:7,can start:7,a write:7,The mode:7,few chapters:7,and bit:7,to being:7,Listing 25.1:7,be transformed:7,of set/reset:7,color to:7,planes as:7,set/reset is:7,drawing color:7,I presented:7,features of:7,left of:7,then draw:7,and EGA:7,2 the:7,switch to:7,question is:7,the red:7,which one:7,line-drawing code:7,register settings:7,mapping in:7,the overscan:7,offset zero:7,line from:7,line are:7,points are:7,point the:7,vertical resolution:7,256-Color Mode:7,with standard:7,earlier chapters:7,of line:7,line list:7,at 320x200:7,for animation:7,total number:7,Color Select:7,Listing 33.1:7,DAC directly:7,RGB triplet:7,Listing 34.1:7,the RGB:7,of Bresenham’s:7,Listing 35.3:7,the human:7,draws lines:7,pixel drawn:7,exactly on:7,Figure 35.2:7,endpoints of:7,intersects the:7,center of:7,between two:7,the running:7,The running:7,all drawing:7,line orientations:7,Octant0 and:7,and clipping:7,extra pixel:7,and last:7,before drawing:7,animation of:7,pixels within:7,polygons into:7,left edges:7,the triangles:7,polygon with:7,the vertex:7,vertex list:7,calculations and:7,386 with:7,the integer:7,polygon filler:7,coordinate and:7,currently active:7,all edges:7,of intersection:7,edges in:7,spans in:7,vertices are:7,draw all:7,scanning out:7,the low-level:7,thinking about:7,Y axis:7,antialiasing is:7,of Wu:7,it looks:7,very well:7,plane as:7,whenever a:7,3EH yellow:7,is represented:7,represented by:7,640x400 mode:7,the dirty:7,objects are:7,the window:7,the question:7,display enable:7,off-screen memory:7,and drawn:7,3-D drawing:7,from object:7,clipped and:7,transformation matrix:7,rotation around:7,transformation and:7,is clipped:7,clipped to:7,convex polyhedrons:7,hidden surfaces:7,are visible:7,transformed and:7,and projected:7,convex polyhedron:7,normal to:7,a vector:7,product to:7,data structure:7,to front:7,3-D math:7,diffuse shading:7,shading for:7,normal is:7,normal and:7,space station:7,each destination:7,across each:7,and perspective:7,texture and:7,texture pointer:7,he could:7,Listing 58.2:7,splits the:7,current viewpoint:7,Figure 59.2:7,the splitting:7,John has:7,products and:7,cross products:7,z and:7,view frustum:7,the FDIV:7,more polygons:7,of surface:7,visible set:7,PVS for:7,Listing 65.3:7,Chapter 67:7,on 1/z:7,1/z span:7,a sprite:7,the accelerator:7,two-pass alpha:7,alpha lighting:7,full of:6,Michael Abrash:6,spend the:6,3-D game:6,to let:6,them as:6,performance programming:6,is there:6,book Zen:6,of people:6,who have:6,who would:6,would like:6,a column:6,no chance:6,book in:6,you read:6,was on:6,the late:6,pick up:6,Some of:6,basis for:6,friend of:6,get an:6,on one:6,opportunity to:6,was working:6,to end:6,new perspective:6,will make:6,get it:6,doesn’t take:6,me the:6,instruction on:6,more about:6,John Miles:6,not have:6,with my:6,however and:6,do anything:6,you wouldn’t:6,and out:6,them into:6,understand what:6,as far:6,because all:6,many programmers:6,a clear:6,is perhaps:6,a local:6,and time:6,does all:6,or when:6,make your:6,everything else:6,improved performance:6,real world:6,turn into:6,checksum value:6,The logical:6,we only:6,only have:6,What’s the:6,and be:6,write and:6,with Borland:6,form the:6,optimization to:6,compensate for:6,it’s less:6,the small:6,faster but:6,so slow:6,a debugger:6,of overhead:6,functions are:6,it from:6,if not:6,virtually all:6,the life:6,every byte:6,is similar:6,The results:6,assembly version:6,4.77 MHz:6,PC and:6,code In:6,case that:6,particularly interesting:6,C is:6,listings in:6,an awful:6,for whatever:6,Consider the:6,is good:6,Let’s start:6,looking up:6,byte from:6,by contrast:6,maintaining a:6,inside a:6,are four:6,people are:6,3 The:6,which uses:6,the fourth:6,such an:6,chunk of:6,long way:6,that optimization:6,optimization can:6,can indeed:6,These are:6,except in:6,code you:6,disk access:6,and less:6,work for:6,does it:6,be sped:6,into assembly:6,it right:6,potential of:6,only at:6,line by:6,done the:6,a day:6,each bit:6,did not:6,You must:6,programming problems:6,why this:6,routine to:6,The process:6,a high-level:6,mode with:6,with their:6,programmer is:6,on his:6,a tool:6,assembly optimization:6,add to:6,that just:6,Let’s take:6,to achieve:6,more often:6,concerned with:6,You will:6,that my:6,and speed:6,that knowledge:6,although I:6,your way:6,available to:6,The ability:6,new and:6,flexible mind:6,the flexible:6,compiled code:6,language programmer:6,can generate:6,better code:6,to 10:6,much worse:6,control over:6,When you’re:6,your computer:6,A few:6,the author:6,might well:6,If it’s:6,all to:6,way I:6,you care:6,care about:6,more performance:6,I discovered:6,it did:6,how quickly:6,was actually:6,8253 timer:6,timers are:6,We’re going:6,timer count:6,restores the:6,to note:6,point about:6,MHz clock:6,counts down:6,gate input:6,to drive:6,54.925 ms:6,count of:6,time when:6,slowly than:6,is generated:6,slow as:6,and division:6,ways in:6,from mode:6,although this:6,timing code:6,some point:6,in effect:6,is running:6,need not:6,up until:6,under a:6,modification of:6,A final:6,could simply:6,I’ve presented:6,in to:6,far calls:6,to call:6,sure to:6,reflect the:6,us a:6,a count:6,discussed below:6,to compare:6,same on:6,as on:6,the opposite:6,program for:6,that data:6,which includes:6,batch file:6,which does:6,the name:6,copied to:6,which performs:6,load of:6,the exact:6,just too:6,good bit:6,official execution:6,just what:6,what this:6,that’s exactly:6,how I:6,time code:6,place in:6,however we:6,Listing 3.5:6,allowing the:6,that starts:6,If this:6,for more:6,that same:6,as does:6,but two:6,before it:6,it at:6,modes of:6,gives us:6,the choice:6,relying on:6,than once:6,all you:6,Listing 3.6:6,be processed:6,are left:6,reflects the:6,programming in:6,involves the:6,and new:6,states of:6,convert the:6,all it:6,large code:6,model is:6,a tad:6,likewise for:6,happened to:6,Microsoft C/C:6,suggest you:6,later on:6,we discuss:6,system is:6,refer back:6,I call:6,lowest level:6,cover the:6,this level:6,Which brings:6,code so:6,are already:6,be better:6,to explain:6,running at:6,and from:6,Wait states:6,this will:6,be built:6,bus is:6,and memory:6,the Bus:6,Bus Interface:6,into and:6,takes 4:6,byte every:6,1 word:6,accesses of:6,just 1:6,32 bits:6,One obvious:6,cycles longer:6,byte-sized accesses:6,the addition:6,REP MOVSW:6,data to:6,problems with:6,is ideal:6,for instance:6,second byte:6,instruction in:6,address calculation:6,reads from:6,is considerably:6,the access:6,operations are:6,with memory:6,is yet:6,tells us:6,wait state:6,I’ll cover:6,them and:6,than 1:6,for instruction:6,and why:6,EU execution:6,no time:6,and instruction:6,the effective:6,and display:6,from its:6,an entire:6,we just:6,instruction which:6,According to:6,mix of:6,memory-accessing instructions:6,truth is:6,cycle count:6,The reason:6,method of:6,measured in:6,What we:6,code takes:6,book and:6,is executing:6,two operations:6,to fetch:6,For all:6,principles of:6,can you:6,or 2:6,25 percent:6,generally faster:6,the combination:6,chapter I’ve:6,PC is:6,we begin:6,access is:6,minimize the:6,do about:6,that you’re:6,of several:6,to ensure:6,so each:6,of 256:6,data that:6,mentioned earlier:6,their own:6,over to:6,after each:6,forces the:6,is 2:6,can happen:6,to cause:6,operation and:6,multiplies and:6,and any:6,justify the:6,that such:6,a high:6,make sense:6,thing to:6,pattern of:6,cycle is:6,CPU and:6,a display:6,exactly as:6,a serious:6,one area:6,area in:6,Display Adapter:6,read display:6,the characters:6,screen can:6,and writes:6,to form:6,can read:6,as little:6,many display:6,Finally the:6,I’ve described:6,or other:6,performance in:6,now and:6,a mere:6,even with:6,they could:6,and mode:6,once in:6,cycle-eater on:6,halfway between:6,on those:6,characteristic of:6,the adapter:6,Instead we:6,it off:6,and Pentiums:6,that make:6,code the:6,have it:6,by keeping:6,smaller than:6,but can:6,approach and:6,And with:6,a string:6,the searched-for:6,searching through:6,set The:6,a pop:6,all and:6,loop of:6,The easiest:6,for our:6,buffer to:6,illustrated in:6,check out:6,match location:6,pass through:6,character of:6,matches the:6,scan for:6,a highly:6,use to:6,that start:6,it Listing:6,simple and:6,implementation and:6,more true:6,1 MB:6,about three:6,So the:6,when searching:6,that’s why:6,be worth:6,check the:6,In contrast:6,such thing:6,reason for:6,at high:6,high speed:6,you try:6,know where:6,needed and:6,whether it:6,be so:6,next to:6,every other:6,when working:6,Assembly language:6,of not:6,to offer:6,he said:6,right of:6,the array:6,together to:6,it’s best:6,if possible:6,calculation time:6,loop as:6,one extra:6,in MOV:6,base register:6,things down:6,better to:6,addressing calculations:6,that performs:6,which may:6,LEA is:6,does that:6,memory but:6,but no:6,so I’ll:6,2 4:6,often than:6,to two:6,pointing to:6,and scaling:6,instruction or:6,only on:6,for his:6,the third:6,and sets:6,sides of:6,do The:6,without using:6,room to:6,our exploration:6,the capabilities:6,If I:6,DEC CX/JNZ:6,LOOP and:6,slow on:6,which will:6,so they’re:6,a task:6,selecting the:6,that fast:6,accomplish the:6,Star Trek:6,MHz cached:6,replaced with:6,loop and:6,optimizations are:6,Listing 7.2:6,four bytes:6,and OR:6,takes an:6,but by:6,and 286:6,advantages of:6,critical code:6,doesn’t affect:6,Why is:6,do any:6,preserve the:6,happen to:6,of interesting:6,this allows:6,word of:6,I’ve never:6,it not:6,of such:6,was also:6,the trouble:6,principle of:6,Before I:6,concentrate on:6,That’s good:6,a portion:6,You don’t:6,registers but:6,affect performance:6,frame is:6,a stack:6,far pointer:6,causing the:6,a limited:6,whole lot:6,loop that:6,an integer:6,is when:6,consider that:6,However if:6,to bring:6,Listing 8.1:6,action Listing:6,is part:6,improvement over:6,return for:6,heavily optimized:6,were drawn:6,that didn’t:6,with his:6,my head:6,his head:6,chance of:6,head and:6,I realized:6,I like:6,So in:6,the carry:6,never seen:6,bit 15:6,AX is:6,to multiply:6,familiar with:6,isn’t as:6,that allows:6,One way:6,the multiplier:6,times a:6,of 2:6,of more:6,takes 3:6,386 are:6,can help:6,the smaller:6,sure the:6,one is:6,text string:6,often in:6,Listing 9.2:6,compare the:6,that actually:6,table of:6,be worthwhile:6,I’ve ever:6,I guess:6,most significant:6,native mode:6,can store:6,are three:6,may or:6,or may:6,cycle on:6,performance because:6,any number:6,Reference Manual:6,me know:6,when performance:6,direct far:6,bytes or:6,up this:6,in 32-bit:6,it that:6,not even:6,they will:6,to decide:6,your head:6,and run:6,way back:6,imagine that:6,That’s what:6,to or:6,Listing 10.3:6,of doing:6,lends itself:6,itself to:6,it’s more:6,most complex:6,information to:6,evolution of:6,of new:6,memory architectures:6,on two:6,now the:6,supported by:6,program uses:6,Next we’ll:6,even addresses:6,a side:6,particularly fast:6,fast the:6,learned from:6,are exactly:6,odd address:6,The way:6,easiest way:6,avoid the:6,offset of:6,per repetition:6,first instruction:6,after that:6,that may:6,multiples of:6,5 percent:6,throughout the:6,Finally we:6,two ways:6,of looking:6,are simply:6,memory then:6,workaround is:6,compact and:6,is somewhat:6,or 0:6,conditional jumps:6,modes in:6,we’ve learned:6,quite different:6,is never:6,BIOS is:6,the POPF:6,the workaround:6,some way:6,it’s certainly:6,above the:6,adjust the:6,to alter:6,idea of:6,MOV s:6,ever be:6,x86 processors:6,because there’s:6,the definition:6,by this:6,1-cycle penalty:6,that I’m:6,then we:6,AL is:6,before using:6,you how:6,a 33:6,are displayed:6,you see:6,years ago:6,no good:6,fast code:6,one-cycle instructions:6,have their:6,the n-bit:6,pointed to:6,16-bit addressing:6,and think:6,ever seen:6,to refer:6,that chapter:6,comparing the:6,have some:6,It’s important:6,approach will:6,of times:6,As we:6,skip ahead:6,algorithm and:6,of Boyer-Moore:6,from offset:6,mismatch location:6,length in:6,a character:6,length and:6,and potentially:6,Mismatch on:6,building the:6,best case:6,Table 14.1:6,Listing 14.3:6,build the:6,games and:6,be no:6,was my:6,afford to:6,processing time:6,fine but:6,so simple:6,out on:6,head pointer:6,node in:6,which points:6,That way:6,an empty:6,can still:6,to just:6,note the:6,than I:6,word counting:6,Listing 16.1:6,and partly:6,word-counting code:6,being scanned:6,of only:6,optimizations to:6,challenge I:6,did the:6,think about:6,a 64K:6,you catch:6,catch my:6,topic of:6,it turned:6,around and:6,though is:6,lets you:6,is provided:6,it even:6,though The:6,an astonishing:6,to design:6,still the:6,a technique:6,unrolled loop:6,This has:6,a non-separator:6,state and:6,get rid:6,I implemented:6,is ignored:6,the wonders:6,wonders of:6,from start:6,though there:6,chapter will:6,will show:6,the ground:6,member functions:6,than using:6,cells in:6,generations per:6,cell map:6,is known:6,where we:6,speed things:6,your right:6,right brain:6,and made:6,that’s done:6,be too:6,outside of:6,at first:6,all its:6,change of:6,been drawn:6,around each:6,by and:6,was still:6,Pentium can:6,behind the:6,one full:6,can stall:6,cache line:6,main memory:6,because a:6,V-pipe can:6,the AGI:6,on cycle:6,here because:6,goes through:6,whether or:6,have in:6,more expensive:6,attempt to:6,much like:6,U-pipe is:6,of rotation:6,pairable instructions:6,another instruction:6,if all:6,fair amount:6,overlap as:6,that use:6,which of:6,size prefix:6,Figure 20.7:6,help to:6,operations in:6,didn’t know:6,doing so:6,wait until:6,per checksummed:6,checksummed word:6,certainly not:6,Listing 21.5:6,let’s get:6,than two:6,are far:6,16 possible:6,experience is:6,upshot is:6,the road:6,starting in:6,is necessary:6,to remember:6,GC register:6,1 register:6,in color:6,byte OUT:6,and perform:6,mentioned above:6,an OUT:6,can set:6,register setting:6,is organized:6,organized as:6,given address:6,pixel The:6,of 16:6,of 64:6,10H 640x350:6,and 12H:6,plane for:6,memory starting:6,Offset register:6,register CRTC:6,a scan:6,pixels The:6,row of:6,screen that:6,of motion:6,set bit:6,memory planes:6,single CPU:6,then each:6,plane that:6,register are:6,planes at:6,image is:6,so because:6,In write:6,Chapter 49:6,the Pel:6,frames per:6,into display:6,read modes:6,more detailed:6,for real-time:6,frame buffer:6,the settings:6,with whatever:6,loaded with:6,the latched:6,a vertical:6,by each:6,with VGA:6,that draws:6,this would:6,single operation:6,select a:6,bit-mapped text:6,text is:6,data rotation:6,other bits:6,pixels controlled:6,foreground color:6,X in:6,plane with:6,some planes:6,first then:6,mode but:6,of text:6,solid and:6,the currently:6,Mode 2:6,well in:6,I’ll provide:6,color value:6,explanation of:6,nibble of:6,Graphics Mode:6,VGA In:6,chunky pixel:6,is active:6,CPU can:6,doing a:6,the basics:6,basics of:6,compare mode:6,Read mode:6,determining which:6,four possible:6,slow and:6,VGA animation:6,pixel that:6,all pixels:6,as I’ve:6,leaves that:6,and VGAs:6,to disk:6,With the:6,the 64:6,colors from:6,the mapping:6,values to:6,colors that:6,of displaying:6,the 4-bit:6,16 palette:6,INT 10H:6,10H subfunction:6,are never:6,coming out:6,256-color pixel:6,split the:6,Split Screen:6,settings for:6,being displayed:6,you set:6,Set the:6,it when:6,horizontal smooth:6,doing the:6,be possible:6,aspect ratio:6,bitmap organization:6,we’d like:6,organization in:6,of 320x400:6,320x200 resolution:6,to Chapter:6,detail in:6,360 pixels:6,few pixels:6,a discussion:6,list the:6,DAC is:6,any point:6,because they’re:6,The palette:6,Select register:6,colors in:6,map the:6,256 DAC:6,10H AH:6,AH 10H:6,move on:6,each DAC:6,cycling is:6,simpler and:6,entire DAC:6,the leading:6,the slow:6,Page flipping:6,DAC Mask:6,If it:6,quality and:6,line-drawing function:6,draw lines:6,and draws:6,line or:6,actually drawn:6,the starting:6,pixel has:6,an X:6,a general:6,Listing 35.1:6,axis the:6,the earlier:6,and Octant1:6,Run-Length Slice:6,for lines:6,would then:6,Think of:6,distance along:6,X the:6,that they’re:6,ideal line:6,of her:6,of filling:6,nonconvex and:6,filling convex:6,polygon into:6,polygon has:6,the boundary:6,drawn only:6,right edges:6,top and:6,polygons must:6,is where:6,and bottom:6,each vertex:6,with polygon:6,other people:6,a coordinate:6,floating-point calculations:6,exactly right:6,all vertices:6,are several:6,edge table:6,global edge:6,be sorted:6,fast convex:6,seeing the:6,technology for:6,image quality:6,almost no:6,animation program:6,bracketing pixels:6,intensities of:6,hope to:6,the endpoint:6,would result:6,bounding box:6,doing it:6,eye and:6,the illusion:6,Bit-plane animation:6,animation on:6,rotations and:6,CRT controller:6,page is:6,many other:6,for page:6,draw only:6,background box:6,pixels for:6,times slower:6,a fully:6,that Mode:6,the coordinates:6,Graphics by:6,Listing 49.5:6,real-time 3-D:6,polygon vertices:6,to transform:6,objects and:6,matrix math:6,clipping and:6,listings diskette:6,projection and:6,and projection:6,of hidden:6,more distant:6,space as:6,inside or:6,polygon was:6,is facing:6,polygon normal:6,to represent:6,to screen:6,chapter’s subdirectory:6,treated as:6,sine and:6,and cosine:6,the elevator:6,an angle:6,back-to-front order:6,vertex and:6,surface to:6,light is:6,a light:6,solid text:6,Pooh and:6,Texture mapping:6,perspective texture:6,different way:6,John had:6,two pieces:6,Listing 58.3:6,perspective correction:6,tree to:6,and polygon:6,surfaces that:6,be split:6,visible surface:6,wall C’s:6,viewing angle:6,Figure 59.7:6,visit the:6,inorder walk:6,left subtree:6,walk the:6,John was:6,t values:6,tree and:6,z values:6,a vertex:6,by projection:6,62.1 is:6,floors and:6,FP instructions:6,FADD FSUB:6,a level:6,and clipped:6,clipped against:6,precalculated PVS:6,the clip:6,against each:6,Chapter 66:6,the models:6,memory footprint:6,of spans:6,spans for:6,the AEL:6,Span Sorting:6,its surface:6,lighting effects:6,surface buffer:6,each triangle:6,affine texture:6,the player:6,potentially drawable:6,suitable for:5,version is:5,derived from:5,waiting to:5,until he:5,up I:5,Over the:5,I worked:5,at id:5,in Dr:5,can find:5,to programming:5,cycle counts:5,of useful:5,It’s hard:5,Jeff Duntemann:5,realtime 3-D:5,every two:5,it so:5,could never:5,written and:5,it’s been:5,a part:5,I read:5,everything that:5,my personal:5,find it:5,run by:5,my life:5,began to:5,to meet:5,few days:5,to code:5,and about:5,and take:5,Quake was:5,a huge:5,must have:5,found a:5,me I:5,something to:5,programming The:5,many people:5,people have:5,long ago:5,read in:5,Programmer’s Journal:5,John Bridges:5,on Bix:5,with your:5,if your:5,a topic:5,near and:5,are capable:5,an issue:5,obvious solution:5,can work:5,sure as:5,as heck:5,improvement in:5,and written:5,that’s all:5,That’s an:5,too many:5,any more:5,building a:5,a house:5,that goes:5,the tools:5,the purpose:5,an overall:5,program design:5,language The:5,end is:5,good design:5,slow program:5,a brief:5,perhaps the:5,the market:5,He was:5,face of:5,code or:5,and everything:5,deal more:5,task at:5,at hand:5,rules for:5,the territory:5,understand exactly:5,the portions:5,your time:5,the alternatives:5,way if:5,the hard:5,hard part:5,always a:5,file in:5,the checksum:5,together and:5,have one:5,that requires:5,reads the:5,available memory:5,fit into:5,that approach:5,memory one:5,read function:5,taken for:5,MHz AT:5,compiled with:5,and off:5,much too:5,it clear:5,rely on:5,AT clone:5,hard disk:5,lesson is:5,The C:5,read it:5,down in:5,this for:5,a code:5,in chunks:5,them from:5,read to:5,this application:5,application the:5,percent or:5,waste time:5,loops and:5,performance improvement:5,to our:5,no reason:5,getting the:5,contrast with:5,buffer and:5,code works:5,any code:5,both because:5,you’re doing:5,written for:5,to 4:5,which makes:5,is easier:5,the concept:5,it runs:5,pretty simple:5,bytes from:5,the optimized:5,maxed out:5,is enabled:5,unrolled loops:5,Don’t let:5,how well:5,after you’ve:5,show that:5,about which:5,doesn’t matter:5,light of:5,level and:5,happens in:5,but when:5,think it:5,versus the:5,Some time:5,the subroutine:5,from different:5,was done:5,accesses memory:5,changed the:5,just once:5,for another:5,assembly programs:5,instructions execute:5,Is it:5,languages and:5,harder to:5,an application:5,programmer who:5,a routine:5,Even the:5,transformation is:5,is completely:5,to machine:5,instructions on:5,the needs:5,needs of:5,or her:5,translation from:5,optimization then:5,let you:5,without having:5,their code:5,the generation:5,assembly programmer:5,with both:5,since those:5,about programming:5,assembly is:5,very little:5,A good:5,examine the:5,two possible:5,often be:5,desirable to:5,much time:5,and assembly:5,essential to:5,possible but:5,will start:5,increase the:5,assembler code:5,the bulk:5,what a:5,of transformation:5,percent to:5,sense to:5,With that:5,step in:5,learning how:5,PC code:5,approaches that:5,bound to:5,an article:5,to 16:5,and had:5,cycles by:5,to experiment:5,to his:5,more in:5,very likely:5,few cycles:5,for my:5,column of:5,they had:5,of video:5,states as:5,well so:5,than their:5,at no:5,long the:5,book I’ll:5,isn’t really:5,saves the:5,count to:5,a timer:5,reset to:5,interrupts to:5,disabled by:5,A second:5,work The:5,driven by:5,dedicated to:5,a BIOS:5,count is:5,square wave:5,wave mode:5,initial count:5,counted down:5,zero the:5,The initial:5,back when:5,of operation:5,pulse is:5,is sent:5,interrupt controller:5,down by:5,both a:5,timer interrupts:5,0 for:5,can’t do:5,the interrupt:5,much longer:5,only time:5,turned over:5,timer for:5,an average:5,is run:5,be lost:5,result The:5,ms to:5,timer The:5,are ignored:5,is virtually:5,is too:5,0 count:5,flag to:5,and ZTimerOff:5,may want:5,interfere with:5,to print:5,Yet another:5,then write:5,code running:5,any assembly:5,transparent to:5,in another:5,not affect:5,performance with:5,using it:5,works on:5,PS/2 computers:5,my earlier:5,you but:5,test-bed program:5,TESTCODE and:5,sample code:5,code segment:5,anything else:5,since we:5,can keep:5,Listing 3.4:5,runs the:5,true of:5,the command:5,repetitions of:5,works out:5,really does:5,why that:5,all about:5,the listing:5,With a:5,we’ll be:5,code sequences:5,The long-period:5,long-period timer:5,reports that:5,this happens:5,included in:5,to update:5,simultaneously in:5,just before:5,approach works:5,always work:5,compatibility with:5,disabling interrupts:5,to either:5,the undocumented:5,two modes:5,feature the:5,few of:5,does work:5,to more:5,the possible:5,work properly:5,has exactly:5,it’s worth:5,waits for:5,be left:5,Listing 3.8:5,time per:5,would expect:5,small code:5,and large:5,and change:5,use with:5,tad more:5,because in:5,changed in:5,call the:5,and likewise:5,great for:5,small and:5,the mechanics:5,mechanics of:5,to Intel’s:5,however it’s:5,and we’ve:5,execute as:5,and does:5,in exactly:5,Chapter 4:5,right to:5,those processors:5,Nonetheless the:5,is essential:5,every bit:5,processors and:5,many levels:5,the familiar:5,beneath the:5,task and:5,flags and:5,No one:5,and sometimes:5,execute at:5,full speed:5,a bus:5,access a:5,processor and:5,cycle-eaters in:5,8088’s 8-bit:5,Figure 4.1:5,be easy:5,same token:5,be one:5,Don’t worry:5,so some:5,It’s an:5,call it:5,16-bit bus:5,bits wide:5,at only:5,PC’s bus:5,cycles or:5,take 4:5,cycles each:5,word every:5,requires two:5,can access:5,ptr MemVar:5,become clear:5,and dynamic:5,adding a:5,only half:5,to Do:5,because each:5,result back:5,The difference:5,manipulate the:5,This code:5,per word:5,while Listing:5,I must:5,any instruction:5,cycle-eater The:5,Unit can:5,them so:5,execute instructions:5,instruction that’s:5,that’s already:5,as it’s:5,be required:5,of AX:5,queue when:5,Part of:5,last example:5,it starts:5,would still:5,those cases:5,context in:5,see later:5,might expect:5,effects and:5,many possible:5,Figure 4.3:5,show the:5,of SHR:5,slightly more:5,extra time:5,Now let’s:5,Listing 4.6:5,total execution:5,change from:5,another in:5,first few:5,SHR in:5,time or:5,that accesses:5,memory For:5,since all:5,performance to:5,replaces the:5,2 bytes:5,drawn into:5,instruction takes:5,may take:5,really want:5,could just:5,executing the:5,of 8:5,instructions short:5,though it’s:5,actually be:5,look-up table:5,follow the:5,being that:5,complete the:5,unless the:5,refresh can:5,you’re still:5,of God:5,access time:5,accessing memory:5,to DRAM:5,that’s that:5,DRAM chip:5,a short:5,of DRAM:5,and programming:5,every 72:5,taken together:5,is given:5,8088 in:5,extent to:5,otherwise be:5,ends of:5,impact on:5,on performance:5,we find:5,Listing 4.10:5,indicating that:5,the loss:5,can actually:5,we see:5,more likely:5,discovered the:5,What can:5,a fundamental:5,cycles so:5,did in:5,in programming:5,complexity and:5,The CPU:5,you this:5,and your:5,can occur:5,them when:5,First let’s:5,occur on:5,the presence:5,whole point:5,extent that:5,little as:5,normal system:5,had an:5,a 4-bit:5,reside in:5,the Display:5,however a:5,five times:5,an eye:5,in human:5,vertical retrace:5,now we:5,to ignore:5,high-resolution graphics:5,per access:5,thousands of:5,when accessing:5,floating-point arithmetic:5,minimize display:5,to mask:5,memory writes:5,than display:5,memory reads:5,which requires:5,reads and:5,of as:5,pays to:5,know about:5,one way:5,you haven’t:5,once you:5,addressed at:5,Because the:5,write this:5,a group:5,allowed to:5,work so:5,be extremely:5,searched-for string:5,any program:5,our own:5,to consider:5,bother with:5,why bother:5,checking for:5,and try:5,alternative approach:5,the brute-force:5,loop to:5,almost certainly:5,potential match:5,works but:5,can eliminate:5,eliminate most:5,buffer location:5,could make:5,make this:5,a match:5,yet a:5,implement this:5,does nothing:5,approach in:5,only trick:5,implement and:5,most purposes:5,the pieces:5,that span:5,next time:5,would run:5,blocks as:5,Where the:5,a 1:5,that even:5,is nonetheless:5,than 1/2:5,up at:5,say it:5,searching a:5,SCASB to:5,might also:5,And so:5,so often:5,don’t think:5,worth using:5,be slower:5,less obvious:5,and whether:5,As for:5,support the:5,plan to:5,fewer than:5,was at:5,once the:5,language for:5,design of:5,do much:5,put together:5,put the:5,short the:5,a shot:5,So what:5,said I:5,BX and:5,the arithmetic:5,approaches are:5,AL BX:5,cycles faster:5,than MOV:5,no extra:5,then I:5,taking a:5,The 486:5,destination of:5,calculations are:5,offset in:5,probably be:5,to replace:5,considerably slower:5,of ADD:5,might imagine:5,2 or:5,or 3:5,be scaled:5,multiplication of:5,2 3:5,4 5:5,pointing out:5,the complications:5,of 486:5,lines the:5,up some:5,not yet:5,The primary:5,text and:5,the room:5,a pure:5,are less:5,work as:5,LOOP is:5,that those:5,nearly twice:5,Then too:5,do something:5,this The:5,a surprisingly:5,x86 instruction:5,instructions so:5,slower and:5,good place:5,cycles because:5,building blocks:5,each with:5,It doesn’t:5,fast The:5,Listing 7.1:5,about to:5,question of:5,can produce:5,bit and:5,thinking of:5,Try to:5,to treat:5,pass the:5,up as:5,a bug:5,why not:5,often used:5,set for:5,and you’re:5,at two:5,on some:5,approach for:5,interesting aspects:5,The rule:5,to clear:5,saving and:5,and restoring:5,provide a:5,To do:5,C with:5,high school:5,by taking:5,compiler generates:5,suggest that:5,to concentrate:5,conversion to:5,useful to:5,The latter:5,with fewer:5,variables and:5,means is:5,and move:5,chosen to:5,and code:5,of accessing:5,a general-purpose:5,registers in:5,code isn’t:5,code shown:5,maybe a:5,you optimize:5,rules that:5,data so:5,necessary for:5,an optimization:5,The function:5,only four:5,data set:5,the typical:5,isn’t it:5,eight times:5,I trust:5,do as:5,will never:5,I took:5,My friend:5,place for:5,the floor:5,way through:5,all right:5,might as:5,problem when:5,when performing:5,in 386:5,which I’ve:5,Here are:5,1 which:5,data as:5,length is:5,lengths are:5,points out:5,386 the:5,486 but:5,per cycle:5,when all:5,12 cycles:5,quick refresher:5,checking the:5,match is:5,that appears:5,and much:5,a test:5,test program:5,than is:5,the version:5,is filled:5,routine that:5,the divisor:5,still limited:5,problems in:5,possibility of:5,involves nothing:5,that here:5,that case:5,the sweet:5,word on:5,architecture and:5,prefix bytes:5,is essentially:5,Programmer’s Reference:5,i486 Microprocessor:5,jump to:5,take at:5,faster In:5,those two:5,not by:5,of speed:5,pattern matcher:5,we’ve seen:5,than just:5,writing a:5,and generally:5,see it:5,certainly a:5,very visible:5,and come:5,up front:5,whether they’re:5,algorithm that:5,other things:5,done as:5,the largest:5,problem for:5,we’d have:5,for large:5,tests and:5,brute-force approach:5,shows how:5,for several:5,is extremely:5,as noted:5,was used:5,problem was:5,and iS:5,values and:5,The number:5,code Figure:5,one could:5,Listing 10.4:5,long last:5,it’s also:5,provides an:5,this the:5,brought the:5,advantage over:5,isn’t enough:5,although it’s:5,it’s on:5,Apart from:5,vastly improved:5,can run:5,we’ve been:5,covered in:5,at even:5,elimination of:5,That would:5,on either:5,fast on:5,After a:5,to lose:5,relatively little:5,possible on:5,386 computers:5,but will:5,to 3:5,does to:5,add that:5,0 The:5,two-thirds of:5,and well:5,because some:5,on 286/386:5,those are:5,8088 optimization:5,illustrates this:5,per word-sized:5,most cases:5,byte with:5,the branch:5,cuts the:5,be surprised:5,surprised at:5,out at:5,at me:5,loop one:5,be reached:5,go out:5,far we’ve:5,well ask:5,it’s impossible:5,PUSH POP:5,there’s not:5,is reasonably:5,are automatically:5,than half:5,this section:5,sense that:5,used only:5,mention that:5,MB of:5,down from:5,quick look:5,the 386’s:5,16-bit registers:5,a bit-by-bit:5,bit-by-bit basis:5,be tested:5,not quite:5,are quite:5,taken to:5,instructions is:5,and 6:5,to retrieve:5,an alternative:5,register from:5,address that:5,to adjust:5,and after:5,by 1:5,course this:5,The standard:5,the tremendous:5,off to:5,one side:5,we tried:5,an idea:5,we’re in:5,could ever:5,a math:5,486 in:5,and DI:5,addressing is:5,adding the:5,next two:5,penalty is:5,need it:5,if one:5,the additional:5,fine for:5,486 code:5,I’ll describe:5,rules and:5,least two:5,instruction the:5,only part:5,is slow:5,this stuff:5,using any:5,Worse still:5,before a:5,However there:5,exactly two:5,hazards of:5,second pass:5,bet that:5,those days:5,parts and:5,the closest:5,came to:5,100 times:5,bother to:5,word-counting program:5,per character:5,it necessary:5,his own:5,This way:5,a 486/33:5,bits from:5,a bitmap:5,the wrong:5,upper half:5,with more:5,directly with:5,value into:5,I’d say:5,overhead and:5,popping a:5,it’s often:5,critical loop:5,can save:5,same register:5,very simple:5,much simpler:5,using 32-bit:5,a 1-cycle:5,the Mod-R/M:5,Mod-R/M byte:5,with two:5,two more:5,information you:5,to stay:5,In that:5,to her:5,string searching:5,I’ve discussed:5,the primary:5,pattern to:5,This allows:5,know a:5,repeated 1000:5,As discussed:5,we also:5,done a:5,is well:5,and highly:5,mismatch on:5,span the:5,Unfortunately this:5,as usual:5,direction in:5,as there:5,pattern length:5,Then we:5,more intuitive:5,until we:5,perfectly good:5,by comparing:5,and went:5,And I:5,of Computer:5,lists are:5,nodes and:5,but more:5,list in:5,basic concept:5,Figure 15.1:5,on until:5,denoted by:5,a NULL:5,of Figure:5,list Figure:5,approach but:5,tail node:5,empty list:5,unlike the:5,this can:5,we’re working:5,thing it:5,functions for:5,sorted by:5,doesn’t make:5,in 24:5,function is:5,of David’s:5,it’s much:5,these days:5,that list:5,who are:5,but I’m:5,comfortable with:5,the words:5,whether each:5,taking advantage:5,is typically:5,allows you:5,it’s that:5,for further:5,code had:5,64K lookup:5,my drift:5,speed it:5,from an:5,should always:5,world of:5,you’re in:5,about 20:5,it didn’t:5,and started:5,started to:5,often a:5,do in:5,may recall:5,has two:5,I received:5,don’t even:5,so no:5,a logical:5,one after:5,bytes per:5,quite possible:5,a separator:5,exactly that:5,change to:5,bits are:5,level 3:5,somewhere in:5,is easily:5,64K table:5,suffices to:5,is added:5,lines as:5,the fly:5,a letter:5,the theoretical:5,which would:5,there’s the:5,but be:5,on or:5,and four:5,current generation:5,cells are:5,implementation details:5,is and:5,from here:5,another and:5,is A:5,now it’s:5,only difference:5,we saw:5,little less:5,generation and:5,The object:5,look like:5,update the:5,large model:5,at Listing:5,it’s quite:5,decided to:5,I noted:5,any part:5,486 with:5,everyone else:5,some very:5,drawing time:5,That’s the:5,David has:5,works in:5,any arbitrary:5,keep track:5,track of:5,first pass:5,updates the:5,the adjacent:5,triplet word:5,state for:5,tries to:5,byte boundaries:5,is completed:5,set in:5,the relevant:5,a black:5,quickly and:5,Pentium has:5,dependent on:5,is heavily:5,I’ll do:5,referred to:5,to as:5,the U:5,called the:5,discuss in:5,three other:5,superscalar execution:5,Second the:5,force the:5,final note:5,an AGI:5,should take:5,any extra:5,either pipe:5,segment or:5,video memory:5,AND and:5,guess is:5,can’t afford:5,to fall:5,particularly useful:5,have at:5,is most:5,it’s so:5,Pentium-optimized code:5,larger and:5,I won’t:5,chapters are:5,instruction stream:5,The Pentium’s:5,to pair:5,U-pipe instruction:5,instructions into:5,AGIs and:5,flow through:5,into three:5,can pair:5,when two:5,described below:5,same cycle:5,will generally:5,alternative is:5,However this:5,to interleave:5,registers so:5,of register:5,selection of:5,after which:5,the areas:5,far enough:5,time until:5,most common:5,see why:5,about Listing:5,screen or:5,for how:5,ClearS is:5,there’s an:5,get on:5,and uses:5,the parameters:5,Chapter 23:5,and my:5,good performance:5,to animation:5,letting the:5,are addressed:5,registers The:5,to port:5,Data registers:5,Index and:5,and Data:5,0 register:5,3BAH in:5,in monochrome:5,remains the:5,the OUT:5,graphics software:5,be considered:5,register could:5,The VGA’s:5,linear bitmap:5,adjacent pixels:5,line The:5,map as:5,a window:5,hardware to:5,bits for:5,memory into:5,64 colors:5,colors are:5,Chapter 33:5,modes 0DH:5,offset 8000H:5,displayed in:5,the Offset:5,The start:5,the Horizontal:5,Horizontal Pel:5,a palette:5,before writing:5,BIOS function:5,which planes:5,CPU write:5,CPU read:5,register 2:5,a blank:5,of zero:5,as would:5,is irrelevant:5,all in:5,drawing The:5,is complete:5,in 640x480:5,one display:5,that memory:5,status is:5,sync to:5,then set:5,which point:5,sync and:5,will come:5,considerably greater:5,disable interrupts:5,we set:5,reserved for:5,frame the:5,to erase:5,pretty well:5,available on:5,work is:5,to develop:5,we’ll take:5,four latches:5,planes with:5,the location:5,copying in:5,plane The:5,pattern is:5,and vertical:5,standard mode:5,latched data:5,0 This:5,animation The:5,applications for:5,enabled for:5,text on:5,mode are:5,the barrel:5,next few:5,and Set/Reset:5,the ALU:5,is perfectly:5,just isn’t:5,planes The:5,the latch:5,The bit:5,planes while:5,selected bits:5,every 16:5,pixel drawing:5,Chapter 35:5,filled polygons:5,latches with:5,font byte:5,to pass:5,desired color:5,draw in:5,to Figure:5,above approach:5,the green:5,register 1:5,no effect:5,value written:5,plane can:5,safe to:5,OUT instructions:5,16-color graphics:5,transparent text:5,in 16-color:5,mask to:5,itself and:5,loaded from:5,The color:5,enable set/reset:5,how write:5,be filled:5,bits that:5,VGA’s data:5,is expanded:5,plane then:5,becomes the:5,in earlier:5,lower nibble:5,corresponding to:5,pixels is:5,diagonal lines:5,restore the:5,28000 bytes:5,blue and:5,bitmap is:5,flipping to:5,however is:5,than page:5,also known:5,get started:5,from system:5,animation techniques:5,don’t care:5,then all:5,where all:5,is passed:5,screen into:5,be programmed:5,can simply:5,How does:5,64 possible:5,colors can:5,be sent:5,of red:5,out what:5,straight to:5,border color:5,color bars:5,programmed to:5,see when:5,it because:5,than simply:5,available in:5,line as:5,line that:5,first scan:5,screen Figure:5,screen on:5,visible at:5,VGA monitors:5,screen registers:5,This isn’t:5,70 Hz:5,60 Hz:5,13H to:5,of horizontal:5,pixels across:5,works fine:5,of moving:5,on-screen effects:5,have gotten:5,game that:5,the 256-color:5,256-color resolutions:5,13H The:5,the pixel’s:5,mode has:5,write pixel:5,horizontal and:5,plane mask:5,pixels with:5,two reasons:5,horizontal resolution:5,you would:5,and I’m:5,of scan:5,fourth pixel:5,and 3-D:5,of generating:5,lie within:5,value at:5,is ever:5,a 6-bit:5,DAC The:5,values in:5,that color:5,4 bits:5,once to:5,lower 6:5,effects such:5,will use:5,and DAC:5,red component:5,blue component:5,Chapter A:5,A on:5,go in:5,a smooth:5,primary colors:5,an RGB:5,to frame:5,in realtime:5,First though:5,DAC can:5,passed to:5,waited for:5,different approach:5,experiment with:5,vertical line:5,locations are:5,be cycled:5,images of:5,one color:5,in several:5,colors for:5,display page:5,back from:5,on it:5,yet the:5,Whenever a:5,with three:5,drawing speed:5,slice line:5,human eye:5,of lines:5,algorithm The:5,the workings:5,line-drawing algorithms:5,and both:5,is simpler:5,major dimension:5,minor dimension:5,pixels along:5,of X:5,coordinates are:5,Figure 35.3:5,next pixel:5,error at:5,The error:5,where X:5,It’s time:5,of EVGALine:5,Figure 35.4:5,line start:5,octants 1:5,octants 0:5,which DeltaX:5,drawn the:5,core of:5,up so:5,visible in:5,a clever:5,the loops:5,will probably:5,slice algorithm:5,Bresenham’s line:5,step along:5,pixels long:5,line Figure:5,maximum possible:5,axis is:5,a run:5,arithmetic is:5,Listing 36.1:5,is entirely:5,point The:5,37.1 is:5,I went:5,and error:5,a divide:5,filling a:5,a continuous:5,and complex:5,and left:5,complex polygons:5,polygon drawing:5,of convex:5,polygons Figure:5,which pixels:5,that describe:5,polygons of:5,other side:5,which edge:5,top scan:5,moved to:5,the magic:5,Good Thing:5,that happens:5,polygons would:5,fast graphics:5,as just:5,fast VGA:5,Chapter 40:5,complex polygon:5,code I’ve:5,rectangle to:5,of space:5,one with:5,sorted and:5,many polygons:5,into my:5,stewed chicken:5,two bracketing:5,step the:5,first pixel:5,but now:5,flip the:5,Listing 42.1:5,antialiasing in:5,Wu-antialiased lines:5,four colors:5,consist of:5,images from:5,given image:5,would select:5,very quickly:5,images as:5,internal animation:5,appearance of:5,planes for:5,all at:5,other page:5,takes time:5,objects in:5,background pixels:5,placed on:5,copying is:5,one page:5,the visual:5,amazed at:5,we moved:5,direction and:5,cycles OUT:5,were visible:5,of dirty-rectangle:5,so he:5,Serge’s approach:5,This eliminates:5,Masked images:5,the mask:5,the nearer:5,transparent color:5,I’ve implemented:5,the DDJ:5,Listing 47.1:5,for small:5,a Mode:5,Listing 47.4:5,Listing 47.5:5,with four:5,memory-to-display memory:5,destination pixels:5,animation package:5,for 3-D:5,3-D Animation:5,the errors:5,multiply and:5,with 3-D:5,polygon can:5,drawing pipeline:5,transformations and:5,fully clipped:5,clipping the:5,listings disk:5,the object-to-world:5,object-to-world transformation:5,the rotation:5,2-D clipping:5,clipping in:5,and texture:5,the transformed:5,facing away:5,perpendicular vector:5,vectors is:5,the vectors:5,vectors that:5,viewer and:5,the perspective:5,the ferry:5,we found:5,of X-Sharp:5,32-bit fixed-point:5,vector and:5,depth sorting:5,been added:5,to X-Sharp:5,each surface:5,red intensity:5,light and:5,X-Sharp archive:5,ambient lighting:5,we added:5,models that:5,DDA approach:5,of texture:5,started with:5,which were:5,polygons but:5,math and:5,an explosion:5,Listing 58.4:5,the fewest:5,two subspaces:5,unique subspace:5,viewpoint in:5,tree can:5,at runtime:5,world so:5,subspace of:5,sorted into:5,surface determination:5,or back-to-front:5,world in:5,from above:5,splitting line:5,front and:5,wall B:5,a leaf:5,The BSP:5,is nearer:5,tree from:5,tree as:5,its children:5,right children:5,game and:5,surfaces to:5,x y:5,parametric line:5,the intersection:5,tell which:5,same surface:5,that splits:5,and cross:5,the positive:5,world itself:5,scene are:5,in worldspace:5,vector from:5,to project:5,new axes:5,are calculated:5,near clip:5,clip each:5,and ceilings:5,Quake uses:5,FPU is:5,cycle N:5,Chapter 64:5,of Quake’s:5,BSP leaves:5,which polygons:5,the nodes:5,the leaf:5,node’s subspace:5,subspace is:5,every polygon:5,a beam:5,leaf is:5,encountered in:5,measured along:5,inside endpoint:5,the clipping:5,of sorting:5,sprites and:5,the sprites:5,world polygons:5,spans as:5,visible spans:5,scanned out:5,span is:5,a trailing:5,and 1/z:5,screen x:5,1/z is:5,1/z-sorted spans:5,BSP sorting:5,surface stack:5,with Gouraud:5,for lighting:5,texture is:5,the texels:5,of surface-based:5,to surface:5,port of:5,the triangle:5,distant models:5,the server:5,Graphics Programming:4,on Quake:4,come in:4,come back:4,it again:4,wonder how:4,that without:4,sharing information:4,worked and:4,two years:4,worked at:4,Quake in:4,Computer Game:4,a rare:4,development and:4,The rest:4,I’ve written:4,of ground:4,of Zen:4,most recent:4,words of:4,this material:4,material in:4,in print:4,long and:4,of Dr:4,in these:4,have much:4,programmers and:4,be just:4,and almost:4,forced to:4,What I:4,books and:4,good stuff:4,a copy:4,I never:4,I made:4,Commander Keen:4,of games:4,got a:4,chance to:4,would get:4,a job:4,I kept:4,him to:4,a tremendous:4,because he:4,now I:4,good to:4,was very:4,a fellow:4,to share:4,many different:4,should use:4,years of:4,for their:4,Jim Kent:4,Peter Klerings:4,you who:4,writing and:4,Chapter 1:4,software that:4,them the:4,the run:4,run of:4,you so:4,As we’ll:4,computers and:4,programs that:4,takes just:4,and linking:4,that but:4,create high-performance:4,so rapidly:4,rapidly that:4,is concerned:4,code should:4,any further:4,anything about:4,or for:4,designed and:4,get in:4,that assembly:4,not any:4,also need:4,an understanding:4,is doing:4,and solid:4,or assembly:4,optimization at:4,carefully optimized:4,optimized code:4,story is:4,the early:4,them In:4,becoming a:4,time optimizing:4,count on:4,compiler to:4,performance a:4,algorithm for:4,identify the:4,odds are:4,turn on:4,part is:4,to apply:4,good way:4,what that:4,that generates:4,occur during:4,into memory:4,won’t fit:4,is out:4,memory requirements:4,1.1 shows:4,with optimization:4,are pretty:4,are much:4,slow to:4,two and:4,minutes to:4,compiler optimization:4,tight assembly:4,listings were:4,All times:4,measured with:4,by calling:4,I figured:4,DOS function:4,For starters:4,interrupts and:4,are among:4,family CPUs:4,branch to:4,has already:4,the disk:4,specified location:4,main loop:4,its time:4,overhead to:4,up Listing:4,be clear:4,time then:4,time By:4,description of:4,though Listing:4,and yet:4,sure you:4,on when:4,function call:4,DOS and:4,are those:4,makes a:4,significant difference:4,example that:4,I suppose:4,do what:4,design is:4,that won’t:4,thought about:4,same results:4,over Listing:4,many bytes:4,it’s faster:4,than having:4,would give:4,2 The:4,works and:4,some people:4,that works:4,it’s likely:4,ignore the:4,long it:4,has nothing:4,functions and:4,consider Listing:4,do well:4,and exactly:4,makes no:4,of coding:4,of handling:4,restartable block:4,works with:4,immediately after:4,repeating the:4,Chapter 5:4,again that:4,optimized version:4,C version:4,optimization of:4,of Listings:4,cache is:4,enabled and:4,is three:4,be obtained:4,on optimizing:4,of saying:4,least not:4,not without:4,code does:4,does and:4,a two-times:4,quite so:4,there’s always:4,sections of:4,to boost:4,doesn’t need:4,that searches:4,fact in:4,in performance:4,then only:4,only after:4,The potential:4,response to:4,do I:4,to present:4,construct a:4,bits 3-0:4,3-0 of:4,byte In:4,you’re curious:4,object was:4,pixel from:4,be optimized:4,Now it’s:4,into place:4,four separate:4,not make:4,improved by:4,that wasn’t:4,wasn’t the:4,various instructions:4,must also:4,learn to:4,as all:4,To understand:4,consider how:4,the requirements:4,requirements of:4,search a:4,will end:4,C/C and:4,programmer to:4,language instructions:4,ease of:4,loss of:4,memory architecture:4,lend itself:4,hand is:4,no transformation:4,Only one:4,is able:4,entirely on:4,his or:4,from assembly:4,first part:4,have enough:4,the operating:4,the literature:4,most critical:4,of good:4,cycles the:4,but we’ll:4,more memory:4,if we’re:4,well that:4,not how:4,From the:4,path to:4,What that:4,importance of:4,from it:4,best choice:4,majority of:4,much about:4,wrote the:4,code than:4,While it:4,code it:4,both ways:4,code written:4,unique to:4,an obvious:4,Still the:4,in writing:4,code you’re:4,and learn:4,in point:4,article about:4,to him:4,correct and:4,processors are:4,measure the:4,wouldn’t have:4,and found:4,further and:4,and thereby:4,best code:4,the good:4,learn more:4,assure you:4,about performance:4,performance can:4,to wring:4,faster if:4,run faster:4,responsible for:4,action The:4,tool with:4,timer chip:4,times per:4,interest and:4,To be:4,timer works:4,worry if:4,a segment:4,to indicate:4,counting down:4,as they’re:4,was called:4,be part:4,clock time:4,contains three:4,Figure 3.1:4,clock to:4,the timers:4,a programmable:4,its output:4,1 that:4,connected to:4,the speaker:4,generate an:4,chip in:4,programmed by:4,line A:4,vector for:4,of six:4,count reaches:4,reaches zero:4,state is:4,is changed:4,a square:4,normal mode:4,ms and:4,the 8259:4,8259 interrupt:4,that its:4,tell us:4,in length:4,measured by:4,not seem:4,seem like:4,a CPU:4,CPU as:4,0 has:4,a message:4,such cases:4,by checking:4,generates the:4,happens the:4,again be:4,during any:4,54.9 ms:4,in common:4,computer is:4,is timed:4,is correct:4,to mark:4,actually have:4,stop timer:4,while a:4,does so:4,time after:4,timer from:4,while it:4,the DOS:4,of ZTimerReport:4,count in:4,5 or:4,simply be:4,a later:4,than those:4,however be:4,called from:4,compatible with:4,modifying the:4,timer code:4,timer routines:4,routines to:4,except the:4,make all:4,reported by:4,386 486:4,performance as:4,the relatively:4,than does:4,set out:4,the risk:4,assuming that:4,make of:4,will perform:4,tool for:4,This program:4,includes the:4,and calls:4,AL from:4,MOV instructions:4,and runs:4,contains Listing:4,by replacing:4,is executed:4,per load:4,number is:4,this works:4,actually a:4,this instruction:4,as used:4,tests in:4,wish to:4,way If:4,well for:4,few minutes:4,perfectly well:4,a simplified:4,a period:4,timed the:4,and ends:4,code because:4,subject to:4,that occur:4,most notably:4,has some:4,not however:4,time during:4,we may:4,over with:4,input to:4,an undocumented:4,no choice:4,used The:4,signs of:4,another reason:4,and set:4,which must:4,may occur:4,occur at:4,works perfectly:4,we’ve just:4,precision timer:4,handle all:4,While this:4,this program:4,interrupts for:4,take as:4,with most:4,C program:4,numbers and:4,all lines:4,here The:4,Changes for:4,Again the:4,with large:4,is normally:4,far call:4,However it’s:4,is taken:4,16 cycles:4,of optimizing:4,nice to:4,the assembler:4,are relatively:4,the changes:4,For those:4,one good:4,appeared in:4,refer you:4,of additional:4,For our:4,not perfect:4,thing the:4,resolution to:4,code itself:4,processor cache:4,as this:4,at times:4,almost entirely:4,Pentium as:4,cycle-eaters that:4,chapter so:4,the foundation:4,foundation for:4,chapters and:4,illustration of:4,read on:4,cycle-eaters and:4,but do:4,to jump:4,level by:4,are almost:4,of cycle-eaters:4,area that:4,registers the:4,the functionality:4,functionality of:4,almost never:4,And yet:4,understand and:4,our code:4,slowing the:4,at full:4,The 8088’s:4,The prefetch:4,Dynamic RAM:4,are shown:4,important and:4,and rewarding:4,chapters in:4,gets a:4,them is:4,is highly:4,8-bit processor:4,an 8086:4,is identical:4,basically the:4,only one-half:4,one-half the:4,Unit of:4,location of:4,16-bit memory:4,clock cycles:4,rate at:4,either 1:4,accesses the:4,word and:4,low byte:4,can process:4,an additional:4,isn’t very:4,each access:4,Believe it:4,x 4:4,in computer:4,cycle-eater can:4,What to:4,memory while:4,accesses in:4,come across:4,that seems:4,desire to:4,should you:4,strive to:4,in preference:4,preference to:4,takes at:4,cycles that:4,those 4:4,than 4:4,and execution:4,handle a:4,can’t get:4,very rapidly:4,operands and:4,bytes than:4,the dynamic:4,In an:4,the 16-bit:4,data at:4,The net:4,execute a:4,can’t execute:4,they can’t:4,maximum speed:4,AX to:4,say nothing:4,could take:4,to instruction:4,take up:4,both instruction:4,takes no:4,time at:4,instructions faster:4,then becomes:4,depends heavily:4,vary from:4,states can:4,time your:4,code if:4,fast it:4,No Such:4,few instructions:4,the clock:4,the branches:4,measuring the:4,actual performance:4,should work:4,way and:4,contrast to:4,SHR is:4,Execution and:4,prefetching sequence:4,sequence for:4,follows a:4,instructions take:4,execute and:4,a slew:4,slew of:4,which have:4,a mix:4,While that’s:4,times than:4,fast at:4,preceding instruction:4,never hurts:4,the rate:4,Now consider:4,at exactly:4,case you:4,times The:4,that context:4,long a:4,to happen:4,idea that:4,in context:4,rules of:4,is determined:4,sense in:4,could think:4,is fine:4,The important:4,be counted:4,instructions For:4,no performance:4,or 6:4,leads to:4,time even:4,it’s only:4,anything the:4,one such:4,hence the:4,can even:4,step back:4,much matter:4,What is:4,Likewise the:4,thing in:4,understanding that:4,with DRAM:4,that runs:4,RAM DRAM:4,act of:4,that DRAM:4,time from:4,are other:4,wouldn’t want:4,slower on:4,its contents:4,for only:4,chip to:4,data it:4,each and:4,programming for:4,DRAM Refresh:4,72 cycles:4,each successive:4,the details:4,can slow:4,anywhere from:4,on code:4,Listing 4.9:4,in between:4,lost to:4,illustrates that:4,is taking:4,Now we:4,either case:4,as high:4,high as:4,When we:4,learned to:4,work around:4,a free:4,in bytes:4,the limits:4,computers with:4,consider this:4,Instructions that:4,to suffer:4,wouldn’t make:4,it generally:4,vary considerably:4,count for:4,affected by:4,can tell:4,more wait:4,are inserted:4,be true:4,no wait:4,more or:4,Even when:4,how they:4,are of:4,no particular:4,occur when:4,states inserted:4,to insert:4,the wait:4,most often:4,Adapter Cycle-Eater:4,creates a:4,screen must:4,from and:4,bytes that:4,display quality:4,run a:4,big deal:4,reasons First:4,screen at:4,Figure 4.8:4,adapter to:4,access speed:4,it becomes:4,and creating:4,that display:4,to normal:4,a neat:4,you consider:4,in normal:4,display mode:4,about The:4,more bytes:4,graphics adapter:4,close relative:4,it just:4,just doesn’t:4,Even if:4,per display:4,take only:4,memory That’s:4,human time:4,matter in:4,however so:4,in graphics:4,image of:4,That’s more:4,accesses display:4,as both:4,segment to:4,double the:4,here the:4,spend a:4,or 5:4,instructions per:4,sort that:4,given byte:4,the popular:4,animation technique:4,large images:4,virtually every:4,several instructions:4,of cycles:4,to explore:4,explore the:4,with lots:4,space for:4,to 50:4,on 486s:4,covered a:4,further reading:4,an equivalent:4,None of:4,be eliminated:4,remains unchanged:4,only five:4,on earth:4,it seemed:4,spread the:4,It wasn’t:4,of 15:4,they did:4,you only:4,that results:4,but would:4,searches a:4,file for:4,line for:4,generally useful:4,blocks in:4,any byte:4,search through:4,into that:4,buffer in:4,one buffer:4,to bother:4,first occurrence:4,buffer for:4,put a:4,but why:4,being searched:4,we already:4,already know:4,know exactly:4,why you:4,you’re interested:4,pointer in:4,match for:4,potential matches:4,be fully:4,highly efficient:4,isn’t the:4,the Boyer-Moore:4,of checking:4,with integers:4,reading that:4,buffer The:4,be checked:4,although a:4,next The:4,be given:4,going from:4,the important:4,block size:4,memory required:4,that isn’t:4,and thus:4,taking up:4,time In:4,deal less:4,be apparent:4,language in:4,frequently as:4,character to:4,characters in:4,It might:4,One such:4,know whether:4,worst-case performance:4,performance it:4,would surely:4,just that:4,it’s nonetheless:4,I expected:4,expected the:4,remove the:4,Here we:4,for itself:4,told me:4,and perhaps:4,hand in:4,had just:4,book by:4,by its:4,be at:4,he is:4,instructions have:4,above and:4,of multiple:4,side effects:4,together the:4,for what:4,not what:4,add two:4,a substantial:4,sit down:4,Years ago:4,and asked:4,what do:4,can learn:4,do they:4,BX SI:4,on these:4,have not:4,from Intel:4,but then:4,you’re optimizing:4,optimizing for:4,slow things:4,are free:4,12 and:4,performed with:4,of LEA:4,provide the:4,either two:4,would probably:4,can add:4,than ADD:4,ADD on:4,cycle slower:4,Operation of:4,comes into:4,any 32-bit:4,EAX EBX:4,can multiply:4,four or:4,Well the:4,advantage is:4,registers or:4,do on:4,shift or:4,cycles is:4,3 4:4,8 and:4,and 9:4,to extend:4,complications of:4,make that:4,gas heater:4,the gas:4,and allows:4,idea in:4,ignore it:4,it involves:4,eye to:4,And yes:4,in case:4,alters the:4,status of:4,just not:4,counting and:4,once you’ve:4,capabilities and:4,because that’s:4,which your:4,of local:4,viewing the:4,perform well:4,it you:4,by branching:4,whether it’s:4,only so:4,trick then:4,fastest way:4,same result:4,maximum number:4,the LOOP:4,a slightly:4,but all:4,see from:4,optimization and:4,differently in:4,How much:4,The loop:4,percent improvement:4,a mask:4,into position:4,to shift:4,It’s actually:4,to precalculate:4,Even though:4,were able:4,knowing the:4,once again:4,could use:4,is merely:4,be but:4,down a:4,caused by:4,assumption that:4,an arithmetic:4,with 1:4,AX and:4,which there:4,obvious but:4,instruction for:4,the pointers:4,code like:4,better or:4,or worse:4,choose the:4,any flags:4,a common:4,other interesting:4,to help:4,the Overflow:4,but are:4,times when:4,in high:4,wasn’t a:4,15 years:4,across a:4,good at:4,To make:4,design your:4,heard of:4,an added:4,Rule 1:4,1 when:4,a model:4,the principle:4,I discuss:4,very small:4,the truly:4,shouldn’t be:4,if most:4,to actually:4,very least:4,from what:4,function calls:4,into an:4,move a:4,extra cycles:4,the underlying:4,for fairly:4,is sometimes:4,are useful:4,In assembly:4,limited number:4,and rotates:4,more efficiently:4,to something:4,eliminated all:4,string instruction:4,new code:4,entire program:4,of structures:4,used because:4,things to:4,and avoid:4,returns the:4,storage format:4,eliminating a:4,of branching:4,used instead:4,Note however:4,produces a:4,final step:4,language Listing:4,of linked:4,use REP:4,that so:4,puzzle is:4,your nose:4,Back in:4,went on:4,upon to:4,and his:4,rule that:4,way up:4,know more:4,for performing:4,see Chapter:4,instruction by:4,operations which:4,following code:4,optimizations that:4,will occur:4,occur to:4,15 of:4,0 that:4,is positive:4,I’ll explain:4,to believe:4,above is:4,John’s approach:4,is even:4,approach doesn’t:4,faster in:4,bitmap in:4,could also:4,operations and:4,allows for:4,a fixed:4,test and:4,value that’s:4,searching method:4,for locating:4,locating a:4,of REPNZ:4,Listing 9.1:4,the caller:4,However when:4,like so:4,to understanding:4,determine the:4,be particularly:4,job of:4,says that:4,know if:4,if anyone:4,get that:4,bits or:4,There’s another:4,arbitrarily large:4,of problems:4,is equivalent:4,386 native:4,word or:4,the allocation:4,my 386:4,386 as:4,just 3:4,and SHL:4,At least:4,Microprocessor Programmer’s:4,30 cycles:4,lesson here:4,won’t even:4,indirect far:4,is documented:4,between those:4,It does:4,creating a:4,a dummy:4,segment at:4,better solution:4,one pass:4,rule for:4,everything you:4,with plenty:4,finish up:4,long while:4,instruction doesn’t:4,is 3:4,apparent in:4,comes with:4,seen in:4,them for:4,given a:4,one out:4,particular problem:4,comes up:4,of fun:4,graphics for:4,and very:4,to walk:4,faced with:4,into your:4,I recommend:4,involves only:4,GCD of:4,to mind:4,necessary but:4,possible because:4,to solve:4,certainly be:4,history of:4,been in:4,to other:4,dog years:4,when we’re:4,problem that:4,and go:4,go back:4,solution that:4,iL and:4,until a:4,values of:4,25 MHz:4,Table 10.1:4,Using a:4,pairs of:4,than or:4,or equal:4,approach requires:4,It could:4,speeded up:4,good optimization:4,illustrates how:4,be improved:4,a mistake:4,a conceptual:4,is precisely:4,a commercial:4,on at:4,work that:4,it’s complex:4,run through:4,Pushing the:4,were the:4,the evolution:4,the present:4,details on:4,us with:4,code I’m:4,a world:4,just two:4,Protected mode:4,mode can:4,and can’t:4,far less:4,how often:4,programs are:4,what we’ve:4,hold true:4,true in:4,we won’t:4,Part II:4,addition the:4,The one:4,side effect:4,doesn’t much:4,Due to:4,when used:4,zero-wait-state memory:4,just so:4,being executed:4,executed and:4,cache and:4,states that:4,on most:4,we discussed:4,memory However:4,my friend:4,comes from:4,performance perspective:4,286 in:4,an AT:4,is reduced:4,really a:4,AT can:4,it actually:4,to odd:4,odd addresses:4,but since:4,save that:4,of word:4,not sound:4,at what:4,fact a:4,that two:4,this simple:4,alignment that:4,we’ve only:4,improves performance:4,by adding:4,Pentium will:4,BIOS functions:4,characters and:4,An interesting:4,instructions will:4,changed from:4,Basically the:4,at different:4,internal caches:4,is largely:4,of accesses:4,to PC:4,consequence of:4,byte can:4,to 8-bit:4,designed for:4,on PCs:4,speed on:4,both processors:4,than ever:4,new addressing:4,any case:4,I/O ports:4,all eight:4,which allows:4,registers of:4,EAX is:4,lower 16:4,simple to:4,chunks of:4,mode by:4,registers can:4,allow you:4,I’d recommend:4,using them:4,you keep:4,branch and:4,There’s one:4,times of:4,0 which:4,EA calculation:4,base index:4,as MOV:4,MOV AX:4,100H is:4,then that:4,words and:4,performance so:4,POPF and:4,popped into:4,flag is:4,the instant:4,POPF bug:4,coding in:4,does is:4,pop the:4,there’s only:4,push the:4,before and:4,a near:4,this version:4,with what:4,reached the:4,When he:4,are most:4,executed in:4,execution unit:4,all by:4,hit the:4,also want:4,starting point:4,for real:4,calculated with:4,go into:4,are considered:4,base addressing:4,and MOV:4,outside a:4,The version:4,version that:4,time if:4,pointer and:4,its use:4,means by:4,interrupting the:4,it’s used:4,be that:4,then used:4,cycle that:4,that Intel:4,address pipelining:4,Figure 12.2:4,the documented:4,least some:4,I feel:4,and let:4,wants to:4,PUSH and:4,pipeline penalty:4,actually not:4,cycle per:4,is followed:4,register during:4,source for:4,contained in:4,been written:4,and used:4,While it’s:4,486 In:4,you’re a:4,and overall:4,loaded and:4,how this:4,code For:4,expect the:4,than normal:4,that loading:4,It isn’t:4,show you:4,performance implications:4,implications of:4,we’ve covered:4,Sometimes it:4,we’re still:4,think the:4,course we:4,I’ve mentioned:4,Listing 13.1:4,this loop:4,that Terje:4,to five:4,remember the:4,instruction but:4,instructions between:4,stalls for:4,off big:4,does just:4,BSWAP can:4,locations and:4,bits at:4,take care:4,As any:4,way it:4,many cases:4,nicely in:4,very few:4,increasing the:4,the technique:4,these are:4,operation as:4,the 1-bit:4,however it:4,register may:4,may serve:4,a perfectly:4,plus the:4,let’s take:4,not limited:4,may also:4,scaled by:4,handy for:4,a valid:4,simpler than:4,for using:4,In many:4,the structure:4,and always:4,of at:4,register that:4,Here’s a:4,a week:4,above The:4,lines on:4,never been:4,suspect that:4,had in:4,to stick:4,seen it:4,We had:4,a start:4,5 and:4,of finding:4,every possible:4,and advancing:4,buffer at:4,be simpler:4,and although:4,or anything:4,thing about:4,knowledge of:4,at every:4,any good:4,is understanding:4,very close:4,faster way:4,there’s another:4,comparison of:4,Z in:4,also that:4,offset 1:4,we compare:4,rightmost character:4,a mismatch:4,spans the:4,can skip:4,because we’re:4,character checked:4,we choose:4,can move:4,Otherwise the:4,the table:4,The best:4,fast is:4,Listing 14.1:4,Turbo Profiler:4,Boyer-Moore in:4,in ASM:4,not shown:4,the perfectly:4,good reason:4,concluded that:4,didn’t have:4,boost performance:4,or better:4,better yet:4,these optimizations:4,up our:4,this story:4,about four:4,I turned:4,like in:4,manage to:4,goes a:4,Addison Wesley:4,and where:4,strengths and:4,are read:4,arbitrary number:4,have done:4,was much:4,I gave:4,next-node pointer:4,must change:4,the header:4,better approach:4,structure and:4,Listings 15.1:4,15.1 and:4,node to:4,it by:4,list The:4,list so:4,node that:4,Figure 15.3:4,performed on:4,pointer Figure:4,Figure 15.4:4,be determined:4,that do:4,a circular:4,Figure 15.5:4,circular list:4,been done:4,four instructions:4,passed along:4,24 bytes:4,the thought:4,one might:4,also in:4,of words:4,words in:4,RAM disk:4,disk and:4,386 Listing:4,little assembly:4,approach used:4,scanned for:4,than 0:4,10 to:4,to three:4,10 or:4,LODSB and:4,and XLAT:4,look closely:4,of potential:4,further optimization:4,although that:4,readers of:4,than you’d:4,found the:4,loop which:4,EBX EAX:4,reg mem:4,that after:4,percent speedup:4,didn’t seem:4,one day:4,possibility that:4,beyond the:4,very often:4,I wouldn’t:4,have that:4,graphics The:4,entry is:4,main program:4,briefly describe:4,come out:4,time since:4,was time:4,count a:4,byte was:4,it’s no:4,that new:4,this as:4,appropriate state:4,done this:4,would not:4,case a:4,edges the:4,implemented a:4,The interesting:4,Even more:4,not you:4,high bit:4,are processed:4,The original:4,letter from:4,shot at:4,I’ve spent:4,will find:4,The program:4,If you’ve:4,This may:4,Optimization Challenge:4,matrix of:4,neighbors that:4,on otherwise:4,cell states:4,and through:4,all Listing:4,Table 17.1:4,a rather:4,was not:4,I also:4,of going:4,keep in:4,example Listing:4,a purely:4,programming model:4,fact given:4,neighbors are:4,generally be:4,here though:4,border of:4,cellmap format:4,padding bytes:4,neighbor count:4,function and:4,to compensate:4,multiple of:4,better performance:4,performance As:4,A corollary:4,still have:4,addition and:4,net effect:4,when Listing:4,and register:4,for assembly:4,have two:4,trick is:4,most cells:4,Do you:4,the states:4,now that:4,earlier that:4,or with:4,17.5 is:4,generation engine:4,you start:4,some extent:4,processing the:4,appropriate for:4,under all:4,to win:4,be less:4,lines long:4,least of:4,out from:4,could run:4,the contest:4,VGA or:4,have only:4,chapter the:4,points in:4,cells that:4,was I:4,line if:4,that line:4,just plain:4,who was:4,not really:4,the neighborhood:4,neighborhood of:4,confident that:4,realize that:4,has done:4,as he:4,won’t have:4,life grid:4,height of:4,program does:4,it changes:4,noted that:4,the few:4,every cell:4,that changed:4,list for:4,me for:4,Figure 18.1:4,only three:4,changes in:4,and jump:4,bit 8:4,is constructed:4,adjusting the:4,will change:4,thought I:4,and varied:4,amenable to:4,execution pipe:4,clock speed:4,used and:4,external bus:4,the sorts:4,the help:4,but most:4,idea behind:4,with certain:4,works as:4,changes the:4,Pentium’s two:4,cache miss:4,as three:4,more times:4,once This:4,I’ll spend:4,details of:4,space is:4,this but:4,data out:4,Address Generation:4,Generation Interlocks:4,cause a:4,absolutely necessary:4,with instructions:4,overlap with:4,instructions or:4,stick with:4,modify the:4,cycles if:4,anyway so:4,expensive than:4,important in:4,inner loops:4,but on:4,to follow:4,of years:4,technology is:4,Pentium code:4,critical to:4,job with:4,a company:4,to visit:4,and finding:4,one would:4,the truth:4,you and:4,tour of:4,cover in:4,handled as:4,only with:4,going through:4,of action:4,V-pipe instruction:4,Table 20.1:4,listed in:4,neither the:4,this operation:4,full cycle:4,pair in:4,complex instructions:4,into simple:4,that don’t:4,write FIFO:4,writes and:4,speed the:4,independent of:4,same bank:4,instruction between:4,32-bit segment:4,can’t pair:4,2 in:4,the easiest:4,The above:4,I strongly:4,registers for:4,each pipe:4,and trying:4,prefix on:4,doesn’t always:4,bear in:4,exactly 1:4,point that:4,your optimizations:4,am not:4,learned that:4,We also:4,can prevent:4,in various:4,next cycle:4,that since:4,keep a:4,An AGI:4,execute until:4,doesn’t know:4,involving the:4,then get:4,use ESP:4,two MOV:4,basic premise:4,You can’t:4,is modified:4,case is:4,things about:4,and cause:4,out which:4,that that:4,that should:4,are likewise:4,time they:4,we’re down:4,is broken:4,and require:4,and cache:4,there would:4,complex for:4,the techniques:4,Note on:4,mentioned that:4,learn how:4,you’ll get:4,thing you’ll:4,REP STOSW:4,there that:4,easy enough:4,clearing the:4,word value:4,and keep:4,efficient way:4,and just:4,and indeed:4,accelerators and:4,VGA at:4,VGA that:4,then we’ll:4,a DAC:4,DAC and:4,for simplicity:4,the features:4,VGA code:4,interface and:4,through and:4,VGA features:4,block copying:4,to many:4,in more:4,23.1 The:4,CRT Controller:4,Sequence Controller:4,GC Data:4,downside is:4,their respective:4,same address:4,function of:4,register 3C2H:4,Status 0:4,monochrome modes:4,VGA BIOS:4,AL with:4,not work:4,EGA but:4,VGA so:4,once then:4,multiple times:4,OUT DXAX:4,OUT DXAL:4,only works:4,pixels of:4,next scan:4,to define:4,at A0000000:4,Consequently there:4,all 16:4,modes modes:4,VGA graphics:4,the 16-color:4,12H 640x480:4,this part:4,a 256-color:4,modes which:4,seen the:4,requires only:4,room in:4,0CH and:4,High register:4,organization for:4,register 13H:4,40 words:4,640 pixels:4,panning is:4,AC register:4,by increasing:4,9 dots:4,dots per:4,panning in:4,cycling the:4,5 is:4,be 0:4,to restore:4,set via:4,can in:4,IBM VGA:4,four display:4,copy four:4,The Map:4,effects as:4,image The:4,ensuring that:4,to is:4,image as:4,copy all:4,image into:4,VGA’s write:4,bits 0:4,register 5:4,all images:4,flipping is:4,As described:4,pages and:4,area or:4,next vertical:4,start drawing:4,point we:4,the extreme:4,set one:4,halves of:4,displaying the:4,problem but:4,all VGAs:4,VGAs and:4,touch on:4,programming of:4,a programming:4,the sine:4,VGA chip:4,data through:4,some or:4,but each:4,has four:4,given display:4,plane This:4,modified by:4,corresponding plane:4,being written:4,location to:4,write operation:4,follows First:4,latches The:4,The contents:4,is black:4,The set/reset:4,the functions:4,logical function:4,would produce:4,data unmodified:4,with 0:4,replacing the:4,It may:4,mask off:4,an existing:4,over an:4,could come:4,sets and:4,result will:4,its default:4,differences between:4,VGA latches:4,operation is:4,is present:4,it provides:4,an ideal:4,the macro:4,of OUT:4,Figure 25.1:4,mask circuitry:4,being able:4,the rotated:4,by bits:4,3 the:4,Data flow:4,to simply:4,latches for:4,data written:4,mask can:4,on byte:4,some but:4,only some:4,interfering with:4,illustrate the:4,Mask registers:4,drawing could:4,We’ll see:4,the example:4,last we:4,on write:4,Figure 25.3:4,0 write:4,or 0FFH:4,to enable:4,plane plane:4,color control:4,zero and:4,single write:4,0 2:4,extended to:4,planes the:4,bit 1:4,plane the:4,a handy:4,destination byte:4,then processed:4,were a:4,but some:4,3 which:4,drawing as:4,what write:4,pattern fills:4,26.1 is:4,code used:4,into which:4,font pattern:4,1 bits:4,Another advantage:4,colors The:4,extra work:4,been used:4,significant performance:4,drawn The:4,than for:4,required per:4,all VGA:4,are readable:4,path in:4,modes 0:4,and save:4,save the:4,two bits:4,selects the:4,expanded to:4,0 a:4,the CPU-side:4,Figure 27.1:4,is split:4,Set/Reset and:4,Set/Reset registers:4,effect in:4,the constraints:4,constraints of:4,the net:4,and 0:4,in modes:4,spread across:4,requiring a:4,the conversion:4,and diagonal:4,that’s required:4,lines a:4,drawing on:4,When to:4,upper left:4,memory will:4,12H bitmap:4,first 4000:4,4000 bytes:4,away with:4,registers 0CH:4,and 0DH:4,as color:4,reads come:4,any or:4,multiple planes:4,write only:4,and copying:4,a poor:4,application is:4,tell when:4,is compared:4,exactly which:4,to using:4,you’ve set:4,isn’t particularly:4,own and:4,color selection:4,reading and:4,EGAs and:4,together in:4,which provides:4,Figure 29.1:4,Listing 29.1:4,we’ll want:4,Listing 29.2:4,the action:4,Listings 29.1:4,29.1 and:4,and 29.2:4,registers must:4,it certainly:4,screen image:4,to account:4,account for:4,so for:4,equally well:4,registers that:4,VGA of:4,put them:4,them back:4,pixel information:4,For now:4,4-bit value:4,stored at:4,the 6-bit:4,in palette:4,of palette:4,are available:4,be mapped:4,mapped to:4,monitor to:4,Listing 29.3:4,them at:4,registers 0:4,Controller Index:4,go straight:4,video function:4,subfunction 2:4,through all:4,is pressed:4,to colors:4,whole screen:4,change is:4,directly or:4,to blank:4,of screen:4,4-bit to:4,8-bit to:4,to 18-bit:4,EGA registers:4,I recently:4,received a:4,when this:4,a field:4,the publisher:4,line value:4,If both:4,Overflow register:4,displayed the:4,display is:4,determines how:4,frame The:4,currently displayed:4,vertical non-display:4,non-display time:4,frame rates:4,line being:4,in much:4,screen which:4,the Mode:4,capability to:4,RAM is:4,I’ve used:4,the pel:4,modes such:4,will also:4,effects are:4,in fast:4,Chapter 31:4,one 256-color:4,640x480 16-color:4,256-color resolution:4,higher 256-color:4,higher-resolution 256-color:4,256-color programming:4,higher resolutions:4,a decision:4,effective resolution:4,to limit:4,limit the:4,13H is:4,of colors:4,mode bits:4,that control:4,and fast:4,Display Memory:4,hardware so:4,byte controlling:4,a higher:4,let us:4,than mode:4,Figure 31.1:4,address 0:4,1 pixel:4,from left:4,read pixel:4,VGA into:4,course that:4,calculation of:4,of 256-color:4,eliminates the:4,Listing 31.2:4,that page:4,draws all:4,effects that:4,time back:4,31 and:4,the line-drawing:4,a true:4,that John:4,drawbacks of:4,resolution is:4,however I:4,other VGA:4,pixels In:4,color at:4,are possible:4,like it:4,modes display:4,more pixels:4,during each:4,It takes:4,offset from:4,sets up:4,of changing:4,and pixel:4,new scan:4,80 bytes:4,create a:4,exploring the:4,color palette:4,color perception:4,Palette RAM:4,displayed for:4,color sets:4,RAM to:4,DAC settings:4,because this:4,through 15:4,Overscan register:4,green component:4,component and:4,more detail:4,become the:4,component in:4,DAC just:4,and three:4,Run the:4,DAC loading:4,primary color:4,DAC in:4,more realistic:4,from frame:4,cycle all:4,ISA bus:4,appear on:4,problem the:4,load all:4,of RGB:4,RGB triplets:4,approaches to:4,USE_BIOS is:4,approach described:4,The simplest:4,scene and:4,each part:4,Then you:4,each horizontal:4,and I’d:4,Second Edition:4,never know:4,and easy:4,two implementations:4,a difference:4,someone else:4,made by:4,some other:4,very high:4,amount by:4,drawing at:4,00 to:4,dimension of:4,end point:4,third pixel:4,as of:4,error is:4,of Foley:4,Graphics Principles:4,Principles and:4,and Practice:4,eight possible:4,good enough:4,get down:4,in EVGALine:4,by EVGALine:4,axis and:4,line end:4,orientations for:4,1 where:4,coordinate changes:4,of change:4,than DeltaY:4,such lines:4,pixel by:4,in whatever:4,EVGALine is:4,of EVGADot:4,those assumptions:4,color that:4,than drawing:4,that byte:4,was as:4,the lengths:4,time along:4,how close:4,slice drawing:4,Run-length slice:4,by trying:4,a slope:4,each run:4,add an:4,fractional parts:4,run length:4,routine would:4,implemented it:4,would draw:4,runs from:4,to grasp:4,was quite:4,shortly The:4,At that:4,I couldn’t:4,at about:4,what Listing:4,REP STOSB:4,with polygons:4,horizontal line:4,Check out:4,polygon drawn:4,boundaries of:4,never cross:4,vertex to:4,polygon but:4,lines to:4,drawing only:4,filled polygon:4,at vertices:4,the interior:4,interior of:4,if polygons:4,edge that:4,a right:4,same location:4,nearest point:4,vertices at:4,the floating:4,how my:4,to good:4,it helps:4,filling code:4,Drawing the:4,lines that:4,was spent:4,with drawing:4,of DrawHorizontalLineList:4,Listing 40.4:4,spent waiting:4,cycles go:4,instead it:4,pixel pairs:4,split by:4,she said:4,intersecting edges:4,like all:4,because that:4,given scan:4,polygon’s edges:4,van Dam’s:4,Dam’s Computer:4,that drawing:4,of edges:4,of active:4,edges as:4,the global:4,sort the:4,the complex:4,just described:4,drawing polygons:4,and edges:4,good job:4,total time:4,both have:4,wrote to:4,quite nicely:4,such polygons:4,monotone with:4,already have:4,polygon that’s:4,polygon at:4,39.4 from:4,fried stewed:4,a bonus:4,the stuff:4,in motion:4,each point:4,intensity calculations:4,they look:4,values so:4,design a:4,looks good:4,illusion of:4,motion and:4,for many:4,of bit-plane:4,coming from:4,Figure 43.1:4,share the:4,no interference:4,single plane:4,that instead:4,select color:4,determines the:4,3AH green:4,0 4:4,red 1:4,though I’d:4,images move:4,blank fringe:4,images which:4,holes in:4,for Mode:4,the appearance:4,controller scans:4,then drawn:4,of extra:4,techniques you:4,up against:4,wall that:4,computer animation:4,will appear:4,be seen:4,objects with:4,very efficiently:4,hardware features:4,screen updates:4,we simply:4,real-time animation:4,Memory allocation:4,allocation for:4,displayed and:4,seem that:4,be active:4,flipping The:4,be amazed:4,he would:4,moved and:4,turned into:4,because no:4,The fastest:4,access 0.300s:4,0.300s 10:4,system buffer:4,simply drawing:4,farther objects:4,drawn first:4,nearer objects:4,case because:4,partially drawn:4,flipping because:4,Listing 45.1:4,display-memory accesses:4,improves the:4,640x400 16-color:4,rectangles to:4,approach which:4,also to:4,them This:4,A Good:4,my way:4,a man:4,and easily:4,are now:4,masked images:4,objects that:4,bounding rectangle:4,rectangle is:4,together into:4,This would:4,expensive to:4,right pixels:4,47 Mode:4,with Mode:4,times over:4,where each:4,up an:4,X mode:4,Figure 47.1:4,X display:4,and 47.6:4,textures and:4,first two:4,storing the:4,might choose:4,Listing 48.3:4,copy routine:4,efficient to:4,is whether:4,by Foley:4,Chapter 50:4,attached to:4,and divide:4,be working:4,and shading:4,space the:4,to world:4,transformation to:4,I’ll use:4,the fingers:4,object and:4,and project:4,defines the:4,the viewing:4,each axis:4,Figure 50.4:4,single matrix:4,3-D rotation:4,near future:4,and translations:4,of getting:4,to working:4,single polygon:4,in space:4,several chapters:4,than 2-D:4,of perspective:4,calculated for:4,of clipping:4,facing the:4,use fixed-point:4,assumptions and:4,objects to:4,we implemented:4,our case:4,plane equation:4,normal perpendicular:4,The cross-product:4,that form:4,in clockwise:4,clockwise order:4,order as:4,visible side:4,Z component:4,removal is:4,normal Figure:4,coordinates which:4,Listing 51.4:4,clipped line:4,a cube:4,the cube:4,and down:4,vertices for:4,with floating-point:4,rotation matrix:4,I added:4,to integer:4,two polygons:4,my daughter’s:4,was getting:4,of objects:4,subdirectory on:4,sorting and:4,transformation matrices:4,precision for:4,floating-point emulator:4,multiplication and:4,the floating-point:4,thought of:4,Listing 53.1:4,that not:4,than 90:4,sorting key:4,sorting doesn’t:4,with rounding:4,color model:4,how brightly:4,surfaces are:4,it strikes:4,surface The:4,a directed:4,normal as:4,two adds:4,vectors The:4,normal The:4,polygon vertex:4,normal in:4,palette and:4,surface at:4,color space:4,represented as:4,each primary:4,mixes of:4,color resolution:4,24-bit RGB:4,palette is:4,that subspace:4,came in:4,along a:4,a space:4,mapping the:4,destination pixel:4,to average:4,onto an:4,polygon Figure:4,new edge:4,destination edges:4,stepping through:4,the DDA:4,small polygons:4,polygons or:4,works well:4,texture-mapped polygon:4,set-pixel routine:4,texture maps:4,of experience:4,aliasing and:4,decided that:4,up using:4,57.2 is:4,x or:4,not for:4,per scanline:4,very difficult:4,texture coordinates:4,for advancing:4,advance amounts:4,Y fractional:4,Binary Space:4,Space Partitioning:4,a tree:4,node splits:4,trees can:4,determination and:4,or front-to-back:4,vertical walls:4,walls viewed:4,scene database:4,of surfaces:4,where objects:4,in BSP:4,trees and:4,with BSP:4,front-to-back or:4,3-D BSP:4,tree Figure:4,front side:4,back side:4,A sample:4,walls can:4,a unique:4,split and:4,front subspace:4,back subspace:4,Split of:4,subspace along:4,node’s wall:4,viewpoint and:4,the farther:4,inorder walking:4,start vertex:4,walk of:4,node then:4,children are:4,The world:4,an alpha:4,asked if:4,Wolfenstein 3-D:4,entire world:4,until all:4,parametric lines:4,original line:4,line intersection:4,Figure 60.3:4,the t:4,trees to:4,Chapter 61:4,from worldspace:4,worldspace to:4,to viewspace:4,vector as:4,z axis:4,positive z:4,z distance:4,view direction:4,Dot Product:4,surface normal:4,this calculation:4,screenspace normals:4,the screenspace:4,product with:4,vector with:4,clip a:4,Chapter 62:4,always always:4,wall at:4,no polygons:4,world as:4,walls are:4,we clip:4,x coordinate:4,frustum are:4,x z:4,the viewspace:4,http www.intel.com:4,integer instructions:4,and FMUL:4,with integer:4,the 1/z:4,trying new:4,new things:4,graphics engine:4,and shadows:4,polygons as:4,Quake level:4,drawing order:4,leaves are:4,are completely:4,Figure 64.2:4,other polygons:4,remaining polygons:4,tree was:4,visible portions:4,to polygon:4,scenes with:4,into spans:4,of visible:4,visible polygons:4,leaves visible:4,that leaf:4,leaf and:4,visible leaves:4,set PVS:4,from anywhere:4,better with:4,very different:4,Chapter 65:4,clipped by:4,a distance:4,Clipping a:4,one leaf:4,models such:4,with z-buffering:4,explosions and:4,Quake engine:4,level performance:4,for Quake:4,Figure 66.1:4,Figure 66.2:4,spans is:4,against one:4,the APL:4,nearest polygon:4,of edge-sorting:4,polygon when:4,concave polygons:4,1/z value:4,calculate 1/z:4,the gradients:4,Quake to:4,order because:4,sorting order:4,models to:4,Figure 67.2:4,67.1 is:4,surfaces in:4,In Quake:4,Quake we:4,nearest surface:4,surface the:4,lighting would:4,lighting in:4,interpolating between:4,lighting values:4,of Gouraud:4,varies with:4,small triangles:4,shading but:4,preprocessing step:4,and lighting:4,map is:4,texel in:4,building and:4,even at:4,surface building:4,Surface Caching:4,mipmap level:4,procedural texturing:4,3-D hardware:4,hardware accelerators:4,a triangle:4,the model’s:4,triangles are:4,the PHS:4,light maps:4,software Quake:4,the mirror:4,server packet:4,This version:3,is derived:3,for free:3,any text:3,with John:3,a rocket:3,everything we:3,my time:3,writing optimized:3,into any:3,back the:3,it through:3,through that:3,course it:3,and Quake:3,standard for:3,Internet and:3,id I:3,wrote a:3,of columns:3,Game Developers:3,Developers Conference:3,represent a:3,look into:3,inner workings:3,software development:3,reading them:3,technology and:3,writing about:3,relevant to:3,rest is:3,of Code:3,Code Optimization:3,Optimization is:3,learned over:3,have all:3,that started:3,started out:3,and particularly:3,but pretty:3,exist for:3,I’d also:3,giving me:3,a place:3,Quake’s development:3,easy and:3,a paper:3,Quake technology:3,appears in:3,that hasn’t:3,elsewhere in:3,large number:3,of chapters:3,a decade:3,to not:3,And the:3,programming on:3,work was:3,the Apple:3,obvious that:3,the Intel:3,over several:3,several years:3,I needed:3,space of:3,The biggest:3,me of:3,nothing about:3,about so:3,information for:3,me in:3,in early:3,time my:3,in every:3,never did:3,learned the:3,was looking:3,took over:3,at his:3,I finally:3,a chance:3,to Michael:3,future of:3,a clean:3,It didn’t:3,it though:3,to Quake:3,where I:3,get there:3,there I:3,was trying:3,of approaches:3,teaching me:3,And rewritten:3,Quake but:3,the technical:3,perspective that:3,make me:3,happy to:3,Programming is:3,of programming:3,This book:3,the later:3,can provide:3,part in:3,Dan Illowsky:3,for not:3,ideas and:3,getting me:3,me started:3,Journal and:3,computer magazine:3,of thousands:3,that made:3,this day:3,will still:3,one should:3,lot about:3,to John:3,the BitMan:3,Jim Mackraz:3,Tom Wilson:3,Dave Methvin:3,Mick Brown:3,the people:3,people in:3,the ibm.pc/fast.code:3,topic on:3,done my:3,my apologies:3,could not:3,the limit:3,boxes are:3,operating systems:3,anything you:3,issue in:3,You bet:3,run so:3,that took:3,you say:3,proper design:3,compilation and:3,can imagine:3,believe that:3,you’re willing:3,more fruitful:3,simply this:3,work wonders:3,not easy:3,must understand:3,is The:3,creating high-performance:3,should ideally:3,say anything:3,language or:3,or an:3,an optimizing:3,optimizing compiler:3,compiler or:3,What it:3,say is:3,the user’s:3,all too:3,answer to:3,tools to:3,goes into:3,high-performance programming:3,overall program:3,computer can:3,using an:3,algorithms and:3,the program’s:3,fast slow:3,program you:3,knowing how:3,fact he:3,so good:3,right down:3,the face:3,effort and:3,time he:3,this have:3,with programming:3,you count:3,else that:3,optimizing compilers:3,hand and:3,got the:3,following rules:3,where you’re:3,of little:3,Know the:3,Know when:3,matters and:3,clever and:3,as best:3,rules is:3,figuring out:3,out however:3,now we’re:3,value as:3,as rapidly:3,rapidly as:3,are we:3,file The:3,them together:3,print the:3,are straightforward:3,only going:3,make one:3,convenient to:3,entire file:3,will fit:3,a sure:3,handle any:3,of no:3,given for:3,Borland and:3,and Microsoft:3,over two:3,Listings 1.2:3,1.2 and:3,1.1 and:3,Listings 1.6:3,1.6 and:3,and 1.7:3,fast Listing:3,optimization will:3,which together:3,than 10:3,optimization on:3,turned off:3,is clear:3,slow code:3,then how:3,implements the:3,desired number:3,this out:3,execute with:3,and Borland:3,internally and:3,been read:3,and return:3,short Listing:3,for yourself:3,debugger or:3,DOS calls:3,It should:3,file and:3,stream I/O:3,buffers the:3,memory rather:3,what happens:3,1.4 is:3,our new:3,magnitude faster:3,than even:3,different but:3,two is:3,what really:3,the time-critical:3,The last:3,portions in:3,response time:3,haven’t bothered:3,a version:3,improvement of:3,even that:3,spend an:3,does well:3,use assembly:3,good but:3,start by:3,via DOS:3,pushing a:3,returning to:3,on Listing:3,function 4:3,4 The:3,handles the:3,run fast:3,while you’re:3,does The:3,they’re often:3,2.5 to:3,assembly at:3,what your:3,no sense:3,That brings:3,the difficulty:3,difficulty of:3,is reading:3,operating on:3,as though:3,simple because:3,block and:3,for text:3,thinking and:3,How to:3,Microsoft C:3,than 60:3,60 percent:3,more a:3,other cases:3,and/or the:3,so optimization:3,two-times improvement:3,access times:3,a disk:3,disk cache:3,cache the:3,to C:3,this very:3,is between:3,and know:3,know when:3,have we:3,when speed:3,only matters:3,in light:3,than your:3,assembly for:3,presented a:3,code it’s:3,just an:3,works for:3,up code:3,and internal:3,2 A:3,is great:3,the hands:3,hands of:3,happens only:3,in response:3,present a:3,time ago:3,asked to:3,subroutine in:3,to construct:3,combining the:3,bits so:3,seemed to:3,write code:3,that’s much:3,which accesses:3,most programmers:3,was being:3,best possible:3,loop so:3,once rather:3,than four:3,look much:3,same number:3,by about:3,one change:3,optimization I:3,eliminated the:3,instructions by:3,which instructions:3,at your:3,so hard:3,write good:3,from other:3,is undeniably:3,If not:3,and implementation:3,transformation inefficiencies:3,Figure 2.1:3,2.1 The:3,than optimal:3,original design:3,High-level languages:3,the transition:3,to implementation:3,implementation The:3,memory-addressing instructions:3,particularly well:3,The high-level:3,a difficult:3,constructed assembly:3,programs suffer:3,suffer no:3,transformation loss:3,Figure 2.2:3,that single:3,tailored to:3,assembly the:3,her own:3,directly and:3,system the:3,everything is:3,familiarity with:3,and BIOS:3,book or:3,While that:3,organization and:3,and articles:3,of knowledge:3,The single:3,articles and:3,since most:3,knowledge to:3,you learn:3,PC in:3,on assembly:3,to high-performance:3,program or:3,or some:3,saving cycles:3,memory than:3,maintenance and:3,of development:3,are indeed:3,software on:3,they often:3,portions that:3,interact with:3,is absolutely:3,meet the:3,as efficiently:3,efficiently as:3,And it:3,PC that:3,start you:3,will help:3,help you:3,mind to:3,and better:3,the importance:3,than good:3,but they’re:3,or smallest:3,generate better:3,of choice:3,choice but:3,of small:3,and effort:3,the finest:3,ways and:3,and good:3,simply that:3,perspective and:3,thought that:3,makes possible:3,the smallest:3,Chapter 3:3,you’re likely:3,become more:3,that let:3,learn from:3,from them:3,them A:3,point A:3,years back:3,came across:3,word to:3,room for:3,The author:3,that did:3,instruction sequences:3,arrived at:3,nearly 50:3,There was:3,of x86:3,language programming:3,assumed that:3,by Intel:3,will return:3,true performance:3,line with:3,with relatively:3,as expected:3,I assure:3,Assume nothing:3,games for:3,a living:3,time trying:3,save a:3,was writing:3,program ran:3,have run:3,again as:3,the shifts:3,Color/Graphics Adapter:3,without causing:3,causing snow:3,snow The:3,every cycle:3,the story:3,failed to:3,fact they:3,would of:3,been to:3,only true:3,measure of:3,hardware but:3,no cost:3,which counts:3,second The:3,The 8253:3,started at:3,an accuracy:3,accuracy of:3,is abbreviated:3,be precise:3,ZTimerOff and:3,and ZTimerReport:3,these routines:3,K on:3,seeing what:3,and learning:3,be using:3,essential that:3,grasp the:3,ZTimerOn is:3,divide-by-N mode:3,Intel’s documentation:3,it finishes:3,in actual:3,to reset:3,0 as:3,One point:3,interest is:3,ZTimerOn was:3,other interrupts:3,timed with:3,to ZTimerOff:3,interrupts during:3,inaccuracy into:3,time whenever:3,keeps the:3,three timers:3,divided by:3,it counts:3,are connected:3,the manner:3,of timer:3,configuration of:3,PC Figure:3,drive the:3,at power-up:3,0 generates:3,0 causes:3,BIOS data:3,data area:3,microseconds and:3,changed The:3,changes state:3,the input:3,a factor:3,In its:3,for about:3,about 27.5:3,27.5 ms:3,and high:3,for precision:3,precision timing:3,substitute for:3,mode for:3,mode it:3,the duration:3,duration of:3,continues to:3,good time:3,input and:3,and isn’t:3,isn’t used:3,for anything:3,anything but:3,We need:3,since that:3,but even:3,perform more:3,division is:3,and turned:3,timer will:3,message to:3,determines whether:3,interrupt is:3,are off:3,reaches 0:3,the ways:3,can introduce:3,0 by:3,one-half of:3,or about:3,is switched:3,switched from:3,by up:3,The system:3,incurred by:3,takes longer:3,than about:3,pending timer:3,so all:3,ms the:3,matter for:3,common use:3,few seconds:3,timed in:3,to reboot:3,calling program:3,checks the:3,a pending:3,the counts:3,than by:3,timing and:3,manner in:3,is stopped:3,count the:3,good thing:3,to latch:3,the reference:3,representing the:3,in microseconds:3,it executes:3,string function:3,with AH:3,that supports:3,placing a:3,and directly:3,it A:3,place the:3,alteration of:3,a serial:3,another approach:3,to send:3,BIOS interrupt:3,to devise:3,your needs:3,Go to:3,get you:3,are designed:3,by modifying:3,to far:3,and making:3,discussed at:3,preserve all:3,ZTimerOff to:3,do make:3,make them:3,by starting:3,accurate to:3,timer as:3,measuring code:3,of better:3,performance when:3,timing intervals:3,most interested:3,relative performance:3,is using:3,compare and:3,PC-compatible computers:3,I’ve tested:3,been able:3,don’t expect:3,computers as:3,quite the:3,Model 30:3,another example:3,I set:3,earlier book:3,risk of:3,Not that:3,performance over:3,a test-bed:3,program sets:3,measures the:3,loads of:3,row and:3,is named:3,jumping around:3,3.3 is:3,with TASM:3,linking the:3,a batch:3,run this:3,exact number:3,17 cycles:3,the MASM:3,MASM or:3,or TASM:3,is right:3,cycles as:3,so is:3,enter Listing:3,and name:3,name it:3,enter the:3,I timed:3,program The:3,few exceptions:3,will serve:3,sequences that:3,Occasionally however:3,can measure:3,interrupts enabled:3,day and:3,for longer:3,means of:3,is limited:3,hour or:3,of timing:3,timer reports:3,won’t run:3,again for:3,disabled the:3,less accurate:3,accurate than:3,same effects:3,a potential:3,potential problem:3,times longer:3,two timing:3,BIOS time-of-day:3,just after:3,avoid this:3,Alas the:3,and waiting:3,experience this:3,computers we:3,count by:3,We’ll just:3,to accept:3,may occasionally:3,off by:3,and leave:3,leave it:3,use or:3,PS2 equate:3,PS2 is:3,timer-stop approach:3,but may:3,results that:3,but doesn’t:3,uses an:3,could conceivably:3,set PS2:3,PS2 to:3,This gives:3,book with:3,choice between:3,equate at:3,several times:3,results to:3,left on:3,key press:3,with MASM:3,and running:3,a length:3,command line:3,expect given:3,The extra:3,notoriously slow:3,is repeated:3,dealt with:3,tackle the:3,one the:3,Figure 3.2:3,line numbers:3,new states:3,lines from:3,In C:3,I’m talking:3,C Figure:3,Figure 3.3:3,specific to:3,very similar:3,safety tip:3,optimizing assemblers:3,code This:3,so great:3,because our:3,converting the:3,push/near call:3,call pairs:3,to emulate:3,way there:3,mind the:3,calls are:3,complete control:3,recent version:3,information on:3,I refer:3,the 8237:3,additional information:3,know is:3,perfect For:3,66 MHz:3,MHz Pentium:3,Another problem:3,cache at:3,preceding the:3,code under:3,as 3:3,magnitude of:3,becomes less:3,when your:3,ridiculously simple:3,of mine:3,applicable to:3,discussions of:3,as you’re:3,So don’t:3,and optimization:3,chapter to:3,give yourself:3,yourself a:3,the material:3,these cycle-eaters:3,regard to:3,chapter we’re:3,jump right:3,in at:3,to most:3,code optimization:3,requires an:3,simple task:3,above all:3,all else:3,we’re after:3,area is:3,by understanding:3,or I/O:3,I/O read:3,data are:3,cycle-eaters can:3,longer be:3,the chip:3,of running:3,8088’s external:3,bytes so:3,so even:3,no memory:3,fastest instructions:3,indeed The:3,major cycle-eaters:3,cycle-eaters are:3,8-bit external:3,AT and:3,chapter but:3,highly desirable:3,8-Bit Bus:3,Bus Cycle-Eater:3,processor The:3,The truth:3,that often:3,full 16-bit:3,In terms:3,clearly a:3,of performing:3,only 8:3,Figure 4.2:3,rate for:3,this cycle-eater:3,cycle-eater in:3,really the:3,True the:3,access by:3,0.838 µs:3,bus accesses:3,transfer rate:3,Consequently for:3,for word-sized:3,a nutshell:3,32-bit processor:3,are different:3,the cycle-eater:3,time however:3,loses a:3,The Impact:3,Impact of:3,operands on:3,official instruction:3,Actually the:3,be exactly:3,some cases:3,penalty on:3,to adding:3,takes about:3,single REP:3,word-sized data:3,performance problems:3,problems when:3,other sorts:3,Do about:3,variables should:3,used whenever:3,a byte-sized:3,2 byte-sized:3,all I’d:3,exist in:3,book that:3,should strive:3,use byte-sized:3,right into:3,8088 The:3,fetching and:3,Listing 4.3:3,which reads:3,must perform:3,perform two:3,faster because:3,accesses for:3,possibly be:3,16-bit operations:3,Instructions with:3,accesses and:3,reason why:3,preferable to:3,an unexpected:3,better In:3,last few:3,pages you:3,thinking that:3,doesn’t seem:3,us exactly:3,cycle-eater doesn’t:3,Yes and:3,longer a:3,instruction will:3,cover a:3,little later:3,there’s one:3,we haven’t:3,data the:3,fetch instructions:3,instructions at:3,fetch them:3,ends up:3,for instructions:3,every 4:3,rate is:3,the ultimate:3,overall instruction:3,any faster:3,one aspect:3,8088 code:3,That’s straightforward:3,What makes:3,since each:3,times but:3,about whether:3,to reach:3,be helped:3,of 5:3,SHR instructions:3,at 4:3,is empty:3,start the:3,cycles In:3,is supposed:3,time rather:3,time which:3,practically speaking:3,other times:3,of overall:3,time As:3,code mix:3,following instructions:3,instructions In:3,the fetch:3,to no:3,now you:3,know why:3,also know:3,why it:3,use than:3,is best:3,limited resolution:3,Another way:3,and over:3,long enough:3,However as:3,distinctly different:3,execution in:3,conclude that:3,true execution:3,MUL instructions:3,pair as:3,Figure 4.4:3,we run:3,4.5 The:3,key point:3,states in:3,instructions which:3,if an:3,a rule:3,is 4:3,cycles times:3,that’s often:3,accesses take:3,the 8088-based:3,the 4:3,per memory:3,it never:3,but still:3,are 2:3,both cases:3,the 3:3,3 or:3,into thinking:3,limiting the:3,add up:3,given code:3,measure your:3,not take:3,is starting:3,both instructions:3,instructions You:3,fetch and:3,executing in:3,a working:3,the overriding:3,of high-performance:3,with instruction:3,your instructions:3,minimum execution:3,short instructions:3,they actually:3,are nonetheless:3,More than:3,as heavily:3,heavily as:3,short and:3,perform memory:3,In some:3,may actually:3,8088 In:3,code At:3,point you:3,well wonder:3,but we’ve:3,hardware of:3,begin our:3,our discussion:3,certain circumstances:3,PC bus:3,CPU for:3,states on:3,DMA controller:3,control of:3,time although:3,CPU must:3,can sometimes:3,a thing:3,runs on:3,is sort:3,an act:3,all available:3,cache on:3,doesn’t come:3,come into:3,static RAM:3,chip that:3,a DRAM:3,every four:3,it stores:3,4 ms:3,programmed at:3,a device:3,8088 to:3,any help:3,help from:3,read access:3,The read:3,the refresh:3,are arranged:3,arranged so:3,Figure 4.5:3,more as:3,memory Figure:3,the spectrum:3,the series:3,Since a:3,there should:3,queue to:3,even after:3,should never:3,to demonstrate:3,fetch the:3,in 8:3,2 percent:3,percent more:3,refresh overhead:3,can this:3,this be:3,for as:3,timing of:3,we thought:3,as 8.33:3,8.33 percent:3,that tend:3,cycle-eater we:3,use short:3,it If:3,and divides:3,suppose that:3,leave a:3,from their:3,When programming:3,cycle-eater would:3,difficult task:3,indeed and:3,programming that:3,from DRAM:3,that performance:3,a fractional:3,on 386s:3,misses and:3,Whenever you:3,that’s usually:3,are well:3,by wait:3,any adapter:3,expects to:3,reasons For:3,memory read:3,by inserting:3,Figure 4.6:3,wasted time:3,program are:3,are concerned:3,circumstances in:3,avoid them:3,learn a:3,when an:3,Both the:3,of wait:3,this makes:3,sense given:3,allow a:3,to itself:3,it needs:3,inserted by:3,However in:3,memory systems:3,serious problem:3,be redrawn:3,reads of:3,master 1:3,important for:3,however many:3,memory it:3,It turns:3,circuitry can:3,available display:3,Figure 4.7:3,time can:3,becomes available:3,cycle Figure:3,Greek to:3,I’ll tell:3,Enough said:3,unless you’re:3,cutting the:3,below the:3,on what:3,adapter and:3,many fewer:3,IBM’s original:3,accessed in:3,high-resolution mode:3,represents the:3,future and:3,is rarely:3,or 40:3,performance only:3,matters in:3,eye can:3,3 I:3,characters could:3,memory without:3,instruction cycle:3,single horizontal:3,retrace interval:3,the longer:3,well however:3,access in:3,per screen:3,these modes:3,one-quarter of:3,That sounds:3,sounds pretty:3,make an:3,Let’s get:3,Listing 4.11:3,a REP:3,with display:3,are lost:3,proportional to:3,subroutine which:3,perhaps a:3,each display:3,uses REP:3,very slow:3,slow floating-point:3,because on:3,each memory:3,on graphics:3,on ATs:3,ATs and:3,more instructions:3,than can:3,can the:3,Remember the:3,adapter is:3,will allow:3,sort used:3,two display:3,one write:3,writes of:3,that set:3,once since:3,as are:3,of simply:3,memory whenever:3,maximum use:3,be handy:3,handy to:3,example code:3,paired with:3,course to:3,will all:3,operand to:3,The DRAM:3,writing high-performance:3,aren’t you:3,code really:3,And while:3,see again:3,Those three:3,anyone who:3,the usual:3,a sizable:3,the moving:3,be exact:3,driving back:3,forth between:3,days to:3,two things:3,a truck:3,easier and:3,bit to:3,nothing of:3,my approach:3,fact I:3,until I:3,1 I:3,using restartable:3,data sets:3,too large:3,large to:3,fast but:3,is relatively:3,processing is:3,extremely slow:3,the vast:3,off handsomely:3,The easy:3,nothing in:3,that let’s:3,fairly complex:3,complex application:3,of restartable:3,found or:3,first point:3,all approaches:3,that involve:3,by our:3,on our:3,that get:3,either one:3,We want:3,superior performance:3,as infrequently:3,loading it:3,this we:3,not immediately:3,immediately obvious:3,Where do:3,C/C library:3,string for:3,of another:3,a zero:3,zero byte:3,function must:3,search buffer:3,string we’re:3,we’re searching:3,Figure 5.1:3,could of:3,the comparison:3,of memcmp:3,wouldn’t hurt:3,hurt to:3,your compiler:3,5.1 The:3,considerable overhead:3,return from:3,test on:3,Figure 5.2:3,the memchr:3,information we:3,buffer being:3,The faster:3,go with:3,buffer This:3,certainly isn’t:3,one example:3,Boyer-Moore algorithm:3,algorithm which:3,faster However:3,us from:3,Chapter 14:3,approach we’ll:3,be fast:3,trick to:3,buffer of:3,we’ll work:3,described and:3,and reading:3,fewer bytes:3,complex although:3,nicely illustrates:3,program so:3,could if:3,would normally:3,as important:3,a lesson:3,optimization involves:3,seconds to:3,to 64:3,performance the:3,very large:3,large and:3,extra memory:3,in large:3,single call:3,search time:3,than 20:3,Given which:3,doubling the:3,that already:3,do most:3,Knowing When:3,engine in:3,can switch:3,CMPS to:3,parameters and:3,switch back:3,more quickly:3,normal text:3,application that:3,memory buffers:3,best approach:3,must know:3,whether you’re:3,that overhead:3,to further:3,engine is:3,there’s any:3,the balance:3,two important:3,large data:3,of blocks:3,write an:3,to remove:3,more easily:3,make much:3,the hot:3,spots in:3,out not:3,you tackle:3,on optimization:3,I first:3,was already:3,Turbo Pascal:3,seated next:3,that order:3,few more:3,I see:3,how little:3,You know:3,pay for:3,a real:3,was worth:3,occurred to:3,on by:3,who had:3,was obvious:3,its cover:3,what he:3,face value:3,full value:3,many instructions:3,best instructions:3,those functions:3,like any:3,we think:3,different instructions:3,turn out:3,precisely what:3,that end:3,usually used:3,this You:3,you’re used:3,to thinking:3,a look-up:3,in certain:3,program In:3,Addressing and:3,what else:3,that bit:3,To wit:3,you no:3,But what:3,perform arithmetic:3,different and:3,example suppose:3,index into:3,registers together:3,memory like:3,mov al:3,are functionally:3,the particular:3,loop if:3,BX is:3,is two:3,386 however:3,1 are:3,used I:3,then you:3,register that’s:3,previous instruction:3,loop on:3,more interested:3,doesn’t actually:3,be any:3,general-purpose register:3,is illustrated:3,Figure 6.1:3,which also:3,also shows:3,to DI:3,8088 but:3,DI and:3,as ADD:3,components are:3,slowed down:3,very interesting:3,It can:3,on as:3,register used:3,calculating a:3,Figure 6.2:3,any two:3,two 32-bit:3,any constant:3,register This:3,32-bit LEA:3,useful than:3,pointers into:3,by 2:3,a left:3,entry in:3,register by:3,be both:3,base and:3,by 5:3,LEA and:3,either a:3,three separate:3,separate instructions:3,would in:3,require the:3,destruction of:3,another register:3,32-bit value:3,386 or:3,486 The:3,multiply a:3,to beat:3,help in:3,uses for:3,Great Buffalo:3,Buffalo Sauna:3,Sauna Fiasco:3,the dead:3,third floor:3,that once:3,and lines:3,the bathroom:3,crank up:3,close the:3,And there:3,and everyone:3,had gotten:3,this without:3,for lack:3,horsepower The:3,analogous to:3,bitmapped text:3,language can:3,about any:3,so The:3,may find:3,and instructions:3,they appear:3,important optimization:3,call this:3,sequences of:3,than individual:3,individual instructions:3,Let me:3,I were:3,I’d never:3,and branches:3,branches if:3,of counting:3,for LOOP:3,than DEC:3,and LOOP:3,ask me:3,and 80286:3,little faster:3,faster still:3,shorter and:3,cycles slower:3,extra byte:3,on even:3,in so:3,those three:3,DEC/JNZ is:3,doesn’t require:3,more flexible:3,of LOOP:3,and DEC:3,if and:3,is zero:3,victim to:3,AND instruction:3,already set:3,the Zero:3,Zero flag:3,fine and:3,and JCXZ:3,is intended:3,task is:3,that together:3,you’d be:3,be well:3,members of:3,the advantages:3,they’re not:3,looking over:3,times on:3,you’ve learned:3,caught up:3,pays off:3,optimization that:3,task The:3,set as:3,of building:3,with unique:3,unique characteristics:3,Your job:3,those blocks:3,worth knowing:3,The bulk:3,taken up:3,just happens:3,and checking:3,checking whether:3,There may:3,faster by:3,by selecting:3,get only:3,and branching:3,rather to:3,as often:3,until either:3,Such a:3,search of:3,expect a:3,buy us:3,other optimizations:3,anywhere near:3,performed The:3,same instructions:3,but Listing:3,same task:3,memory you:3,by saving:3,position and:3,average of:3,look the:3,Once again:3,table lookup:3,slightly slower:3,no faster:3,done at:3,possible out:3,or from:3,a minor:3,by my:3,arithmetic and:3,and logical:3,logical instruction:3,instruction at:3,where there’s:3,for later:3,and XOR:3,any task:3,you’re trying:3,or you:3,same length:3,function as:3,status from:3,one addition:3,were used:3,Listing 7.6:3,is different:3,property of:3,to remain:3,altering the:3,arithmetic flags:3,clear the:3,only do:3,These instructions:3,A word:3,resides in:3,fast way:3,are times:3,increment the:3,Speeding Up:3,You Know:3,Seasons in:3,the Sun:3,particularly good:3,the song:3,I heard:3,gave it:3,that really:3,the translation:3,with assembly:3,code not:3,are by:3,compiler does:3,and design:3,your assembly:3,you risk:3,is readily:3,available as:3,compiler is:3,or another:3,another the:3,small portion:3,Unless you’re:3,critical sections:3,gives the:3,it only:3,as such:3,you down:3,and C:3,what assembly:3,pursuit it:3,in Borland:3,of function:3,when viewed:3,critical portion:3,loop the:3,call and:3,themselves are:3,they’re in:3,registers when:3,code However:3,frame and:3,and having:3,compilers can:3,loop by:3,used This:3,most obvious:3,a subset:3,that C:3,circumstances and:3,than C:3,through an:3,actually faster:3,on 386:3,used a:3,your brain:3,you change:3,this situation:3,REP SCASW:3,be contiguous:3,and storing:3,thoroughly understand:3,needs the:3,of fine-tuning:3,the benefit:3,it assumes:3,all matches:3,sizes and:3,Figure 8.2:3,The inner:3,1 As:3,smart enough:3,nothing but:3,Listing 8.3:3,and worst:3,optimization techniques:3,the mix:3,than CMP:3,values as:3,The whole:3,calculates the:3,will surely:3,high end:3,anything by:3,one place:3,the Earth:3,and possibly:3,through to:3,was too:3,any math:3,called upon:3,the classic:3,fall asleep:3,for X:3,the fundamental:3,fundamental rule:3,not apply:3,I whispered:3,still more:3,to convince:3,one by:3,you hear:3,Why Well:3,Well I:3,could hear:3,hear the:3,day I:3,and many:3,sent me:3,an addressing:3,it renders:3,which use:3,be replaced:3,LEA to:3,I’m just:3,cycle faster:3,actually more:3,carry from:3,ADC to:3,be preserved:3,likes to:3,optimize for:3,are good:3,John’s code:3,when bit:3,is negative:3,486 as:3,unto itself:3,Here’s how:3,copies a:3,than this:3,is odd:3,incurs a:3,approximately equal:3,for multiplication:3,386 but:3,programmers are:3,width in:3,and takes:3,shift and:3,bit per:3,bits but:3,MUL and:3,and IMUL:3,still faster:3,outperform the:3,along by:3,always in:3,the scale:3,any value:3,Figure 9.1:3,PC can:3,which he:3,by scanning:3,scanning for:3,use REPNZ:3,more sense:3,up one:3,one character:3,character and:3,and check:3,Q is:3,Figure 9.2:3,scans for:3,character the:3,Listing 9.3:3,program used:3,difference does:3,of FindString:3,when only:3,searching in:3,of scanning:3,gives you:3,is due:3,well be:3,buffer so:3,data with:3,way Listing:3,only slightly:3,difference lies:3,we all:3,yes I:3,of packing:3,can come:3,divisor and:3,in 16:3,That will:3,large dividends:3,the division:3,only 16:3,Figure 9.3:3,This process:3,here we:3,takes care:3,to divide:3,for handling:3,easily enough:3,enough by:3,drop me:3,the virtues:3,virtues of:3,your most:3,128 bytes:3,that fall:3,mode however:3,bytes a:3,Either way:3,missing the:3,On balance:3,keep your:3,the organization:3,uses to:3,desired effect:3,done I:3,did it:3,and RCL:3,Figure 9.4:3,Contrast that:3,contrary to:3,that you’ll:3,on other:3,486 can:3,in 3:3,you ever:3,Probably not:3,an indirect:3,only 15:3,some cycles:3,documented to:3,mode a:3,nowhere near:3,big difference:3,rate to:3,to return:3,run it:3,allocation of:3,it along:3,friend Dan:3,3 bytes:3,thus far:3,not your:3,become apparent:3,am I:3,We can’t:3,angle and:3,past experience:3,letters and:3,It goes:3,large part:3,generally the:3,coming up:3,has ever:3,and discipline:3,surprisingly close:3,parallel to:3,a sort:3,too quickly:3,a workable:3,feeling of:3,possible I:3,I’ve come:3,coding and:3,wisdom of:3,the problems:3,The alternative:3,greatly from:3,you’ll never:3,even have:3,decide whether:3,you take:3,that comes:3,run with:3,by Robert:3,Robert Sedgewick:3,most useful:3,greatest common:3,a fraction:3,sure it’s:3,it’s useful:3,knew it:3,perfect for:3,integer value:3,go The:3,them a:3,solve it:3,see I:3,The basis:3,problems that:3,one small:3,The drawback:3,a brute-force:3,than 1000000:3,the history:3,mainly because:3,about five:3,five minutes:3,work they’re:3,computer years:3,be slow:3,except when:3,the larger:3,evenly as:3,Figure 10.1:3,This works:3,a lousy:3,very expensive:3,years and:3,10.1 is:3,iS is:3,GCD Figure:3,times measured:3,was pretty:3,faster approach:3,iL becomes:3,Figure 10.2:3,generally much:3,is obviously:3,hand has:3,gotten the:3,I understood:3,subtracted from:3,without affecting:3,inherent in:3,Figure 10.3:3,Using Euclid’s:3,the greater:3,approach I:3,its best:3,can best:3,best be:3,really going:3,recursion and:3,then there’s:3,a subroutine:3,and ignore:3,performs the:3,At long:3,maximum optimization:3,are small:3,that sort:3,amounts of:3,optimization than:3,than at:3,And as:3,I pointed:3,enough information:3,angles to:3,measure it:3,that provides:3,more fun:3,New Instructions:3,an overview:3,I originally:3,millions of:3,386 in:3,worth considering:3,contrast the:3,of addressing:3,represent the:3,now all:3,but has:3,leaves us:3,this writing:3,386SX is:3,to offset:3,suffers from:3,processor but:3,find yourself:3,avoid memory:3,memory since:3,286 The:3,the biggest:3,offers a:3,mode it’s:3,segments are:3,mode uses:3,segment registers:3,4 gigabytes:3,In protected:3,Windows NT:3,can generally:3,program may:3,in In:3,specifically for:3,learning and:3,now is:3,general though:3,to protected:3,mode or:3,one exception:3,on computers:3,computers built:3,member of:3,to word-sized:3,far fewer:3,several reasons:3,fetching is:3,386 than:3,286 than:3,386 since:3,least twice:3,state cycle-eater:3,on accesses:3,were designed:3,with those:3,is fairly:3,performance for:3,memory It:3,one-wait-state memory:3,AT clones:3,8 or:3,the interaction:3,interaction between:3,that’s possible:3,desired data:3,will certainly:3,memory generally:3,MOV WordVar:3,WordVar 0:3,However that:3,is 6:3,architecture of:3,bringing the:3,cycles On:3,286-based AT:3,From a:3,percent longer:3,still on:3,new cycle-eater:3,a variant:3,variant of:3,cycle-eater of:3,picture is:3,since there:3,problems can:3,the board:3,a catch:3,variables that:3,Figure 11.1:3,conversion of:3,the 286’s:3,That in:3,one new:3,before each:3,be even:3,a NOP:3,Listing 11.2:3,ms per:3,0.64 ms:3,implications for:3,few bytes:3,word alignment:3,an even:3,fetches the:3,Figure 11.2:3,is however:3,following the:3,Figure 11.3:3,should run:3,in say:3,Instead it:3,me The:3,byte which:3,branch destinations:3,to word-align:3,only go:3,sometimes it:3,What you:3,are multiples:3,boundaries and:3,is fetched:3,to pay:3,odd value:3,value from:3,mode on:3,or Pentium:3,are executed:3,and second:3,it normally:3,normally would:3,386 In:3,clones and:3,computers are:3,are built:3,requires no:3,caches are:3,are made:3,made of:3,no point:3,worrying about:3,anyway and:3,when using:3,thing you:3,ways of:3,fact this:3,with REP:3,VGA does:3,memory much:3,MHz 286:3,8-bit devices:3,the AT’s:3,for PCs:3,use more:3,fast In:3,at just:3,seen that:3,when display:3,is accessed:3,this new:3,you possibly:3,possibly can:3,new instructions:3,instructions The:3,In real:3,mode each:3,to 64K:3,new features:3,somewhat more:3,per segment:3,applications and:3,these registers:3,as its:3,can scan:3,the conditions:3,Many of:3,old and:3,which any:3,in word:3,addressing mode:3,further in:3,address a:3,segment but:3,Note well:3,don’t necessarily:3,so I’d:3,although in:3,true on:3,on them:3,of functionality:3,have already:3,already seen:3,the calculation:3,case and:3,all The:3,ADD WordVar:3,WordVar 100H:3,ADD DX100H:3,8 to:3,a 3-cycle:3,simply not:3,instruction ADD:3,a ratio:3,Listing 11.4:3,Listing 11.5:3,virtually identical:3,and execute:3,code executes:3,The more:3,of POPF:3,the Interrupt:3,Interrupt flag:3,interrupts off:3,that cannot:3,workaround for:3,than POPF:3,costs a:3,be interrupted:3,as cheap:3,be achieved:3,Figure 11.4:3,and didn’t:3,approach so:3,same functionality:3,hope that:3,Figure 11.5:3,register with:3,the segmentoffset:3,for POPF:3,instruction after:3,workaround code:3,near call:3,We’ll also:3,out like:3,Figure 11.6:3,a macro:3,and performing:3,register If:3,as you’d:3,involves three:3,a choice:3,however there’s:3,a desirable:3,under which:3,not it’s:3,Chapter 12:3,a Model:3,back around:3,but he:3,again with:3,around with:3,are you:3,was all:3,how different:3,of sight:3,called a:3,cycle by:3,were on:3,being in:3,486 has:3,built in:3,are sometimes:3,techniques for:3,undocumented optimizations:3,particular the:3,because every:3,with little:3,of interference:3,external memory:3,with good:3,The Hazards:3,Hazards of:3,try not:3,memory Intel:3,memory because:3,one-cycle penalty:3,you expect:3,however In:3,this context:3,AX BX:3,MOV CL:3,and leaves:3,state as:3,The use:3,MOV EAX:3,addressing as:3,calculations take:3,because many:3,saved by:3,cycles after:3,instruction then:3,Figure 12.1:3,perform an:3,loading of:3,before it’s:3,take more:3,code loses:3,no cycles:3,cycles at:3,up when:3,register file:3,especially given:3,performance characteristics:3,help performance:3,most likely:3,further information:3,applies to:3,a destination:3,memory by:3,a sequence:3,SP is:3,six cycles:3,directly on:3,an explicit:3,then using:3,POP or:3,the explicit:3,reason I:3,I certainly:3,we use:3,Problems with:3,and neither:3,source register:3,bad idea:3,this because:3,by rearranging:3,register load:3,register usage:3,second instruction:3,required by:3,that value:3,read out:3,process that:3,important that:3,does in:3,works In:3,mentioned in:3,XLAT is:3,that XLAT:3,slow so:3,core instructions:3,486 you:3,for fun:3,programs and:3,the expected:3,no penalty:3,lead to:3,interrupts the:3,pipeline is:3,I arrived:3,or 4:3,ns per:3,test code:3,for reads:3,cycle as:3,and Other:3,92 percent:3,key element:3,was what:3,aimed at:3,considering the:3,was about:3,necessarily the:3,and empty:3,without being:3,There’s an:3,here about:3,Here’s the:3,to 100:3,back of:3,in ways:3,doubled the:3,by shuffling:3,code looks:3,There Ain’t:3,Ain’t No:3,Such Thing:3,Fastest Code:3,taken a:3,loop a:3,be with:3,Figure 13.1:3,loaded just:3,that costs:3,from two:3,DI to:3,takes two:3,moving one:3,instruction Note:3,exactly equivalent:3,could rearrange:3,Listing 13.4:3,pipeline stalls:3,of nothing:3,than 16:3,characters per:3,can pay:3,least significant:3,byte first:3,instruction such:3,order so:3,rotation is:3,out though:3,also useful:3,efficient use:3,programmer knows:3,it sure:3,is plenty:3,as having:3,it Not:3,the skip:3,four cycles:3,MOV to:3,memory takes:3,all for:3,added benefit:3,affecting any:3,technique of:3,a compact:3,or off:3,calling a:3,Pushing a:3,register takes:3,cost is:3,register but:3,a convenient:3,slow The:3,PUSH mem:3,mem and:3,AND OR:3,PUSH reg:3,reg and:3,POP reg:3,determine that:3,insert the:3,use this:3,code Again:3,Again this:3,get from:3,of EDX:3,32-bit instructions:3,an address:3,register except:3,except for:3,makes sense:3,ESP is:3,it’s very:3,than 16-bit:3,register In:3,is placed:3,constant value:3,albeit with:3,AL EBX:3,are supported:3,addressing the:3,describe all:3,SIB byte:3,this to:3,for greater:3,chapter with:3,segment by:3,a displacement:3,frame but:3,keeping in:3,it’s at:3,ESP as:3,a minute:3,at things:3,have fun:3,that spirit:3,me and:3,and nothing:3,had taken:3,was one:3,know for:3,tended to:3,all have:3,One day:3,a clue:3,the kind:3,For further:3,the excellent:3,on page:3,advancing one:3,a nifty:3,information that:3,contain a:3,buffer contains:3,distribution of:3,conclusion is:3,the slower:3,CMPS approach:3,the outset:3,common sense:3,and still:3,another sort:3,partial matches:3,that overlap:3,and half:3,can’t possibly:3,match starting:3,offset 2:3,straight from:3,byte as:3,byte rather:3,what if:3,instructions go:3,one set:3,least in:3,that location:3,match but:3,overlap the:3,Figure 14.1:3,buffer character:3,Figure 14.2:3,on first:3,Figure 14.3:3,we move:3,Boyer-Moore is:3,was reached:3,which helps:3,to skip:3,on character:3,where N:3,N is:3,How fast:3,chapter shows:3,this implementation:3,than REPNZ:3,be somewhat:3,16K 16K:3,Listing 14.4:3,hand optimization:3,not included:3,chapter for:3,say this:3,trap of:3,leading to:3,14.3 is:3,optimized to:3,approach The:3,speak for:3,one case:3,represents a:3,Know your:3,relatively expensive:3,This time:3,by building:3,turned up:3,code quite:3,goes with:3,name was:3,which made:3,attractive as:3,my book:3,hung out:3,it It:3,off at:3,I put:3,do mean:3,the hang:3,hang of:3,particularly difficult:3,reinventing the:3,the wheel:3,Linked lists:3,to mix:3,types and:3,applications where:3,to data:3,in x-sorted:3,straightforward to:3,for filling:3,my column:3,simple that:3,didn’t even:3,first but:3,the linked:3,I began:3,next node:3,node as:3,so Listing:3,head of:3,that’s an:3,node with:3,to specify:3,singly linked:3,For this:3,this reason:3,Similar problems:3,It’s easy:3,pointers to:3,list as:3,Figure 15.2:3,designing a:3,But I:3,have learned:3,head node:3,node is:3,actually used:3,every node:3,either side:3,it In:3,nodes as:3,NULL pointer:3,way a:3,be detected:3,that scans:3,Suppose however:3,inside of:3,head/tail node:3,you’re at:3,fond of:3,saves a:3,admit that:3,little while:3,together form:3,of C:3,efficiency of:3,the scanning:3,with Listings:3,In one:3,David Stafford’s:3,Not a:3,that David:3,had already:3,already done:3,hate to:3,pleased with:3,one has:3,you folks:3,might seem:3,if any:3,tools for:3,left corner:3,one word:3,word about:3,We are:3,are talking:3,about people:3,can safely:3,guess that:3,end I:3,first optimization:3,challenge in:3,call a:3,Listing 16.3:3,C to:3,good use:3,rearrange the:3,the tests:3,example we:3,what sort:3,byte value:3,want a:3,or 20:3,several interesting:3,the pointer:3,Although this:3,If there’s:3,there’s never:3,scanning the:3,further optimizations:3,performance significantly:3,performed to:3,a hard:3,time One:3,it tends:3,the readers:3,counted the:3,the winner:3,results as:3,a speed-up:3,brute-force optimization:3,fast I:3,We’re talking:3,fastest code:3,386 native-mode:3,save for:3,and they’re:3,lesson to:3,world into:3,I’ll bet:3,he didn’t:3,complexities of:3,most interesting:3,new version:3,at more:3,he thought:3,willingness to:3,stuck in:3,but very:3,program it:3,lines can:3,characters that:3,so desire:3,provided as:3,it if:3,fast assembly:3,though because:3,did have:3,the nice:3,the speedup:3,you like:3,Table 16.2:3,as my:3,perceived by:3,of Optimization:3,machine The:3,is like:3,turn is:3,is implemented:3,can ever:3,unrolled the:3,whole thing:3,performed at:3,to employ:3,two loops:3,word when:3,way it’s:3,byte that:3,implied by:3,cost in:3,purposes and:3,breaking out:3,a break:3,that word:3,then if:3,describes the:3,I try:3,my program:3,It seems:3,a transition:3,I’m a:3,always return:3,fairly simple:3,a sense:3,2 but:3,seems most:3,at level:3,bytes into:3,words with:3,it without:3,least the:3,the fifth:3,does exactly:3,defining the:3,the 64K:3,two potential:3,Figure 16.1:3,whether to:3,other two:3,Figure 16.2:3,resulting value:3,to index:3,the lookup:3,a carry:3,times so:3,lack the:3,the ballpark:3,time than:3,that calculates:3,native 386:3,didn’t bother:3,I’ll take:3,do Chapter:3,Life The:3,take this:3,to optimization:3,for improved:3,Or as:3,other day:3,complicated and:3,optimization process:3,finish and:3,all a:3,you’ve never:3,Life is:3,been the:3,topic in:3,in recent:3,process and:3,very straightforward:3,about eight:3,to 40:3,be either:3,cell has:3,game logic:3,three neighbors:3,it stays:3,otherwise the:3,is off:3,turns on:3,It’s only:3,implement the:3,and test:3,Calculating the:3,cell to:3,cellmap and:3,then copy:3,17.1 is:3,486 Listing:3,18 generations:3,might say:3,a profiler:3,and 17.2:3,graphics I:3,least I:3,generation is:3,the slightest:3,program runs:3,cell_state and:3,one reason:3,of knowing:3,highly abstract:3,cell storage:3,bugs and:3,surface of:3,insertion sort:3,calculations of:3,a border:3,Figure 17.1:3,can change:3,greater efficiency:3,Figure 17.2:3,that extra:3,very noticeable:3,hour and:3,a vast:3,general a:3,corollary is:3,it more:3,built on:3,be altered:3,altered and:3,little and:3,then see:3,find an:3,approach as:3,17.4 is:3,eliminated by:3,using pointers:3,pointers and:3,all remaining:3,keeping the:3,to increase:3,ten times:3,goal of:3,further by:3,C or:3,still not:3,ready for:3,vastly better:3,three to:3,to seven:3,few dozen:3,change state:3,saw how:3,by another:3,optimization problem:3,solve the:3,we looked:3,edges so:3,moving the:3,words we:3,we took:3,ground up:3,on then:3,can count:3,neighbors and:3,mind as:3,a typical:3,surrounded by:3,given generation:3,remain in:3,see where:3,we change:3,format to:3,bit for:3,that cell:3,Figure 17.3:3,performance boost:3,skip over:3,non-zero bytes:3,implementation that:3,and text:3,model to:3,that size:3,you choose:3,means the:3,zero bytes:3,model for:3,by storing:3,real problem:3,listening for:3,conceptual level:3,modify any:3,same output:3,than 400:3,400 lines:3,in from:3,corners of:3,be gone:3,a plain:3,shape of:3,field and:3,crossed the:3,who could:3,the 100:3,maximum memory:3,memory bandwidth:3,is why:3,will often:3,laid out:3,question about:3,colors at:3,the Life:3,pixel colors:3,as evidenced:3,evidenced by:3,had nothing:3,prepared to:3,draw that:3,away the:3,spirit of:3,raw speed:3,Challenge of:3,in full:3,a challenge:3,Even so:3,the power:3,you I:3,Onward to:3,the equivalent:3,compiler for:3,still a:3,he wrote:3,look over:3,day to:3,neat stuff:3,stuff in:3,ever see:3,lot to:3,engine and:3,to visualize:3,below The:3,the minimum:3,results The:3,feel free:3,on earlier:3,CPU cache:3,to touch:3,create the:3,David runs:3,runs down:3,and added:3,three cells:3,way So:3,has only:3,only need:3,counts of:3,A and:3,words when:3,picks up:3,idea is:3,list This:3,not change:3,the life/death:3,gained by:3,if this:3,During the:3,AND it:3,Therefore there:3,jump targets:3,needed for:3,triplet is:3,The value:3,is equal:3,byte then:3,In practice:3,a nearby:3,actually pretty:3,masking off:3,When this:3,completed the:3,again to:3,see which:3,branching to:3,has changed:3,ever been:3,been my:3,been an:3,vastly more:3,powerful and:3,the hazards:3,to 400:3,compiler technology:3,days of:3,through as:3,previous x86:3,x86 processor:3,same clock:3,speed In:3,second pipe:3,heavily used:3,that’s on:3,any processor:3,too but:3,there to:3,quick overview:3,help of:3,worst of:3,years old:3,vastly different:3,processors but:3,pipes are:3,executing instructions:3,execute two:3,comparable to:3,cache The:3,Also because:3,Pentium to:3,Unlike the:3,where there:3,Pentium The:3,fetched from:3,twice the:3,line so:3,pipes in:3,mostly in:3,Pentium performance:3,can’t use:3,least once:3,the working:3,about is:3,use is:3,have time:3,for superscalar:3,Pentium Processor:3,the article:3,combined with:3,cache space:3,now be:3,note on:3,cycles it:3,was modified:3,cycle 1:3,an attempt:3,was made:3,even for:3,calculations have:3,the side:3,by three:3,operands should:3,noted above:3,them if:3,extend the:3,V-pipe for:3,as two:3,normal instructions:3,that using:3,code although:3,extra overhead:3,they may:3,or otherwise:3,varies depending:3,it’s now:3,happens on:3,general and:3,or OR:3,test whether:3,be freed:3,by unrolling:3,all means:3,watch out:3,cache effects:3,fall through:3,Also it’s:3,move to:3,they might:3,can potentially:3,in inner:3,take 1:3,cycle when:3,it’s difficult:3,exactly where:3,be consistent:3,along to:3,but doing:3,that Pentium-optimized:3,flexible and:3,and powerful:3,an animated:3,of microcomputer:3,of money:3,too if:3,fifty-dollar bill:3,built a:3,Dan and:3,while walking:3,walking through:3,to notice:3,us but:3,Pentium and:3,looks much:3,does tend:3,delve into:3,superscalar optimization:3,execution and:3,of fast:3,execution units:3,job as:3,performance programmer:3,Figure 20.1:3,and simple:3,other The:3,pair only:3,parallel with:3,and REP:3,stream of:3,the set:3,practical purposes:3,Table 20.2:3,no other:3,Figure 20.2:3,constitute the:3,operations can:3,combinations of:3,value stored:3,effectively in:3,because most:3,chapter Figure:3,for Pentium:3,instructions other:3,in lockstep:3,INC EAX:3,idle for:3,2 of:3,Figure 20.4:3,we actually:3,instructions pair:3,then this:3,some extra:3,of writing:3,cache so:3,large blocks:3,pipes can:3,Figure 20.5:3,to watch:3,bits 2:3,and 4:3,because both:3,An alternative:3,arises when:3,pipe executes:3,complex memory:3,one pipe:3,other pipe:3,the pipe:3,Figure 20.6:3,for sure:3,AND EBX:3,EBX AL:3,lockstep execution:3,mixed together:3,simpler just:3,AND DLAL:3,can’t happen:3,has finished:3,of operations:3,should make:3,those registers:3,operation in:3,once is:3,will go:3,Figure 20.8:3,that includes:3,has always:3,always been:3,toward a:3,I still:3,not enough:3,explored the:3,pipeline for:3,five instructions:3,for speed:3,not set:3,address then:3,stall the:3,the changing:3,Figure 21.1:3,21.1 and:3,Figure 21.2:3,instructions later:3,new to:3,they’re still:3,up something:3,which should:3,known and:3,chapter when:3,being set:3,set both:3,following sequence:3,circuitry as:3,and 5:3,determines which:3,TCP/IP checksum:3,are generated:3,size prefixes:3,and maybe:3,about that:3,found to:3,per checksum:3,A little:3,five to:3,Listing 21.2:3,on ADD:3,broken into:3,interspersed with:3,4 to:3,worth it:3,bit faster:3,loop unrolling:3,for relatively:3,dword at:3,drawback to:3,details that:3,to exactly:3,and complexity:3,registers Listing:3,possible way:3,a trick:3,7 cycles:3,think you’ll:3,start out:3,that involves:3,Jeff Duntemann’s:3,mode This:3,and works:3,have become:3,Listing 22.1:3,by any:3,in ClearS:3,Does that:3,side to:3,whole of:3,that serves:3,to BP:3,so why:3,find any:3,loading ES:3,ES and:3,doesn’t change:3,so I’m:3,throw away:3,However those:3,not part:3,be taken:3,avoiding the:3,VGAs in:3,every PC:3,graphics accelerators:3,your software:3,software to:3,circles and:3,and before:3,last several:3,with 16:3,with 256:3,pixel as:3,video adapter:3,video hardware:3,for good:3,improving performance:3,features in:3,VGA Programming:3,a traditional:3,and several:3,sample VGA:3,VGA program:3,Chapter 42:3,copying and:3,background is:3,VGA could:3,one pair:3,these blocks:3,of EGA:3,VGA programmer:3,most VGA:3,register 8:3,8 the:3,to 0FFH:3,then writing:3,The downside:3,addresses of:3,address 3C0H:3,the Index:3,color mode:3,Miscellaneous Output:3,Output register:3,CRTC registers:3,at either:3,modes This:3,DX to:3,load AL:3,AC registers:3,As mentioned:3,such problems:3,register GC:3,8 is:3,loop when:3,to GC:3,internal index:3,index of:3,OUT instruction:3,not require:3,freeing up:3,planes is:3,a powerful:3,logical width:3,the physical:3,is free:3,memory map:3,screen of:3,in width:3,logical height:3,for moving:3,All four:3,assist the:3,CPU in:3,memory plane:3,serves as:3,VGA’s palette:3,by display:3,Figure 23.1:3,color capabilities:3,only and:3,features are:3,most powerful:3,VGA text:3,to pixel:3,made possible:3,possible by:3,256K of:3,two full:3,10H which:3,larger virtual:3,Figure 23.2:3,address at:3,Address Low:3,is increased:3,13H which:3,line after:3,pixels worth:3,displayed scan:3,set so:3,mode 10h:3,contiguous bytes:3,maps to:3,increased by:3,Smooth horizontal:3,register AC:3,to 7:3,displayed image:3,left is:3,register the:3,be viewed:3,viewed as:3,mode requires:3,6 and:3,panning setting:3,significant bit:3,VGA When:3,When bit:3,memory controls:3,0 video:3,screen becomes:3,with bit:3,BIOS video:3,video interrupt:3,BIOS may:3,hardware assistance:3,to planes:3,old image:3,new image:3,set/reset capabilities:3,VGA which:3,25 The:3,four VGA:3,The images:3,hardware feature:3,copy a:3,This causes:3,the addressed:3,addressed byte:3,VGA’s four:3,uses write:3,a desired:3,VGA’s display:3,the blank:3,then in:3,see this:3,chapter on:3,a complicated:3,which eliminates:3,problems The:3,premise of:3,while another:3,being modified:3,available for:3,640x350 mode:3,640x480 mode:3,the pages:3,switch between:3,is surprisingly:3,VGA’s internal:3,sync status:3,that we’d:3,then wait:3,However we:3,mismatched start:3,for pixel:3,Enable status:3,For maximum:3,far too:3,where it’s:3,single frame:3,mind when:3,To see:3,and set/reset:3,virtual bitmap:3,start addresses:3,that’s one:3,care to:3,test your:3,we didn’t:3,resources and:3,you an:3,begin to:3,qua non:3,during display:3,four ALUs:3,on Graphics:3,ALUs are:3,actually only:3,the surprisingly:3,ALUs and:3,ANDing and:3,operates on:3,memory bytes:3,VGA performance:3,Figure 24.1:3,read by:3,register However:3,always read:3,4 of:3,then writes:3,that neither:3,latches before:3,latches from:3,ALU data:3,area The:3,1 for:3,chapter or:3,bit pattern:3,fill each:3,across all:3,read that:3,read is:3,with write:3,support a:3,fills the:3,logical functions:3,box to:3,each operation:3,ANDed with:3,traditional way:3,on mode:3,is some:3,Mask and:3,read operation:3,register must:3,rarely used:3,function in:3,any mode:3,background The:3,convenient way:3,values into:3,they allow:3,bit position:3,wrapping back:3,it’s sometimes:3,one OUT:3,CPU rotate:3,many VGAs:3,useful applications:3,circuitry for:3,four bit:3,parallel and:3,mask data:3,Figure 25.2:3,mask for:3,latch for:3,operation Figure:3,unchanged In:3,Chapter 26:3,default font:3,font is:3,horizontally and:3,draw any:3,completely eliminates:3,map mask:3,I’ve made:3,rotate and:3,font data:3,than setting:3,VGA data:3,its way:3,rotated CPU:3,replace the:3,to independently:3,a feature:3,to only:3,that need:3,1 so:3,modified in:3,will remain:3,end result:3,contain the:3,particular it:3,0 set:3,1 with:3,that produces:3,and others:3,value it:3,circuitry is:3,specific color:3,time because:3,Listing 25.4:3,through unchanged:3,register provides:3,when set/reset:3,plane’s ALU:3,selected planes:3,my opinion:3,covered the:3,write path:3,Actually we:3,result can:3,We’ll get:3,of very:3,passed and:3,data byte:3,is rotated:3,rotated and:3,look back:3,at Chapters:3,Chapters 23:3,23 through:3,background in:3,character box:3,filled in:3,3 in:3,black box:3,drawn As:3,with bits:3,bits equal:3,character pixels:3,could only:3,rotating the:3,two adjacent:3,adjacent characters:3,modify only:3,allows only:3,correspond to:3,that part:3,One good:3,of letting:3,3 does:3,The write:3,40 characters:3,boundary and:3,Listing 26.2:3,font in:3,3 can:3,focused on:3,desired result:3,the combined:3,were going:3,eliminate all:3,as drawing:3,X-Sharp library:3,a speedup:3,speedup of:3,CGA and:3,readable registers:3,currently in:3,In all:3,VGA supports:3,Which leaves:3,modes for:3,with 0FFH:3,leaving it:3,it unchanged:3,set/reset bit:3,not and:3,what color:3,lower four:3,and sent:3,if bit:3,CPU-side input:3,It’s possible:3,some additional:3,2 Figure:3,into four:3,13H of:3,The byte:3,or simply:3,data paths:3,can modify:3,course but:3,VGA I:3,given color:3,possible ways:3,bits 1:3,Listing 27.1:3,graphics image:3,chunky format:3,CGA EGA:3,format is:3,chunky bitmap:3,12H with:3,format in:3,VGA’s planar:3,the chunky:3,have its:3,because when:3,effects can:3,Listing 27.2:3,horizontal vertical:3,passed color:3,only selected:3,reasonably fast:3,possible code:3,it draws:3,a full-blown:3,pixel or:3,memory when:3,planes This:3,Mode 13H:3,of 64000:3,64000 bytes:3,second pixel:3,while back:3,EGA in:3,image while:3,The EGA:3,screen memory:3,the 4K:3,of bands:3,EGA is:3,how can:3,That’s especially:3,12H the:3,a font:3,10H bitmap:3,3 character/attribute:3,first 8K:3,get away:3,to graphics:3,mode That’s:3,Controller registers:3,to 8000H:3,the resultant:3,drawing directly:3,that’s no:3,need do:3,sets in:3,back is:3,character/attribute map:3,while in:3,and restore:3,only every:3,different planes:3,would allow:3,64K of:3,mode As:3,Chapter 28:3,to tackle:3,don’t understand:3,active the:3,register 4:3,normally contains:3,simple enough:3,returned to:3,a slight:3,register Sequence:3,Map and:3,and Map:3,Listing 28.1:3,image from:3,new location:3,to flicker:3,VGA’s latches:3,memory each:3,latches is:3,mode all:3,for determining:3,1 read:3,care planes:3,1 In:3,not match:3,1 reads:3,color stored:3,the 8:3,pixel bit:3,as selecting:3,return 0FFH:3,0FFH the:3,that you’ve:3,in AL:3,well find:3,Not to:3,and Mode:3,And that’s:3,be put:3,and techniques:3,ground to:3,graphics screens:3,hi-res mode:3,All we:3,planes 2:3,described here:3,which contains:3,planes of:3,into each:3,problem if:3,a screen:3,Mask to:3,are certainly:3,changed to:3,can if:3,screen from:3,0DH 0EH:3,0EH 0FH:3,CGA graphics:3,EGA can:3,mapping of:3,200-scan-line modes:3,of modes:3,can select:3,from more:3,comes out:3,red and:3,which all:3,attribute 0:3,values from:3,Figure 29.2:3,mapping for:3,Figure 29.3:3,go about:3,certainly possible:3,registers directly:3,directly by:3,10H with:3,If AL:3,set that:3,attributes to:3,register Figure:3,colors 0-15:3,mapping from:3,it I’m:3,colors by:3,by either:3,too little:3,color on:3,of BIOS:3,Figure 29.4:3,quite thoroughly:3,slower for:3,worthwhile to:3,and need:3,JMP 2:3,because not:3,needed when:3,programmers who:3,Split Screens:3,The split:3,basic operation:3,to pull:3,panning with:3,resets the:3,addresses the:3,Figure 30.1:3,screen scan:3,starts on:3,modes The:3,supports a:3,Scan Line:3,setting all:3,and once:3,screen area:3,pattern and:3,a striking:3,keypress Listing:3,screen by:3,after another:3,IS_VGA is:3,EGA version:3,line In:3,EGA split:3,split screens:3,drivers are:3,the highest-resolution:3,15 and:3,picked up:3,screen will:3,line This:3,which take:3,take effect:3,there isn’t:3,sync is:3,will move:3,frame This:3,first line:3,other lines:3,fact if:3,VGA when:3,works just:3,works properly:3,move and:3,use horizontal:3,smooth scrolling:3,Mode Control:3,Control register:3,is reset:3,This doesn’t:3,to pan:3,pan the:3,screen while:3,an attractive:3,and fills:3,a form:3,panning suppression:3,the capability:3,interesting points:3,reading from:3,when there’s:3,loaded at:3,that he’s:3,miss the:3,one will:3,will ever:3,the 320x200:3,a 320x400:3,lines or:3,lord knows:3,modes other:3,PC market:3,starts out:3,Whether this:3,programmer and:3,only is:3,graphics pages:3,reprogramming of:3,many games:3,first question:3,is How:3,it be:3,400 scan:3,200 scan:3,late and:3,VGA was:3,the MCGA:3,same could:3,they didn’t:3,can readily:3,said above:3,VGA clone:3,screen when:3,use as:3,in hardware:3,though so:3,pixel number:3,modulo 4:3,programming perspective:3,graphics functions:3,although that’s:3,one each:3,vertical lines:3,13H mode:3,be obvious:3,address y:3,4 pixels:3,plane x:3,interest in:3,refresher on:3,13H and:3,just store:3,for 320x400:3,implemented by:3,next plane:3,thereby eliminating:3,your images:3,images with:3,with speed:3,pages of:3,in page:3,then drawing:3,Finally Listing:3,reprogramming the:3,any 16-color:3,display pages:3,those routines:3,mode supports:3,graphics page:3,animation applications:3,the drawbacks:3,page and:3,Video Seven’s:3,any standard:3,let’s have:3,360x480 256-Color:3,eager to:3,Drawing in:3,palette of:3,colors to:3,screen because:3,each one:3,to assume:3,both dimensions:3,480 scan:3,refresh rate:3,rate The:3,same in:3,from 320:3,to 360:3,horizontal resolutions:3,memory fetch:3,or four:3,has not:3,28 MHz:3,get more:3,calculated from:3,one line:3,Once all:3,lie in:3,screen coordinate:3,Figure 32.1:3,is longer:3,from every:3,the EGA-compatible:3,to 8:3,Michael’s article:3,colors the:3,color generation:3,flip between:3,the July:3,the dog:3,6-bit values:3,RAM The:3,Figure 33.1:3,33.1 The:3,by an:3,pixel the:3,manner as:3,stage of:3,8-bit values:3,green 0:3,DAC contains:3,contains 256:3,component the:3,color with:3,In 16-color:3,16 attributes:3,64 attributes:3,like is:3,Controller Mode:3,pass-through state:3,can display:3,tinker with:3,RGB value:3,far I’ve:3,VGA palette:3,something I:3,all 8:3,either directly:3,or through:3,loaded only:3,of interrupt:3,A single:3,the Overscan:3,bits each:3,of flicker:3,flicker and:3,and screen:3,cycle colors:3,have worked:3,6-bit red:3,6-bit green:3,6-bit blue:3,any desired:3,display at:3,to disable:3,while you:3,at 3C9H:3,Loading the:3,autoincrementing feature:3,I’d be:3,between I/O:3,I/O accesses:3,same port:3,attributes and:3,DAC to:3,detail the:3,other ways:3,be said:3,said about:3,Color Cycling:3,bits per:3,per primary:3,non-256 color:3,values stored:3,DAC once:3,dynamically changing:3,single bit:3,leaves only:3,one question:3,question How:3,than 256:3,768 OUT:3,many OUT:3,an 8:3,during vertical:3,time between:3,it’s safe:3,of calling:3,256 times:3,other of:3,while loading:3,I tested:3,some sort:3,screen for:3,for at:3,marking the:3,frame then:3,sync before:3,can always:3,what’s the:3,yourself and:3,find in:3,location 0:3,However you:3,various approaches:3,If USE_BIOS:3,cycling to:3,too fast:3,slow but:3,straightforward fashion:3,locations in:3,running into:3,now have:3,First of:3,guard against:3,it And:3,that looks:3,locations for:3,a static:3,colors could:3,would change:3,several different:3,the stars:3,same for:3,to animate:3,after one:3,flipping in:3,VGA’s undocumented:3,undocumented 256-color:3,modify page:3,The idea:3,The advantage:3,did this:3,most complicated:3,a serviceable:3,causes all:3,be ignored:3,displays the:3,performed during:3,when calling:3,most graphics:3,formula for:3,I’ll present:3,first implementation:3,is unique:3,faster drawing:3,lines which:3,have come:3,that never:3,35.3 is:3,line it:3,hardware as:3,The algorithm:3,presenting in:3,Figure 35.1:3,high resolution:3,little code:3,drawing an:3,an approximation:3,drawn will:3,side or:3,The amount:3,screen resolution:3,horizontal or:3,dimension is:3,coordinates to:3,keeping a:3,a running:3,adjacent Y:3,35.3 The:3,initial pixel:3,to The:3,minus D:3,D Figure:3,the sixth:3,each possible:3,coordinate along:3,Y is:3,than zero:3,algorithm in:3,of Interactive:3,Interactive Computer:3,Addison-Wesley 1990:3,derivation of:3,by comparison:3,comparison with:3,An Implementation:3,Listing 35.2:3,EVGALine and:3,possible line:3,lines into:3,orientations are:3,decreases from:3,four of:3,four orientations:3,transformed into:3,end coordinates:3,coordinates with:3,must still:3,of DeltaX:3,3 where:3,in octants:3,changes on:3,axis Figure:3,Figure 35.5:3,would improve:3,previous pixel:3,drawn is:3,of Octant0:3,a pixel-drawing:3,pixel-drawing function:3,line drawn:3,the assumption:3,that screen:3,by bit:3,bit controlling:3,will draw:3,the above-mentioned:3,builds a:3,to bear:3,more that:3,operations such:3,higher level:3,tied to:3,of 00:3,that calls:3,would the:3,written entirely:3,linked to:3,pixel processing:3,important because:3,hold the:3,Slice Line:3,Line Drawing:3,implemented the:3,cross the:3,says I’m:3,that what:3,Bresenham’s run-length:3,not sure:3,the run-length:3,at length:3,stepping one:3,Figure 36.1:3,drawing Figure:3,Figure 36.2:3,Figure 36.3:3,last runs:3,about 70:3,calculations in:3,pixel placement:3,fact we:3,line a:3,Figure 36.4:3,along X:3,advance is:3,run The:3,fractional X:3,XDelta YDelta:3,by multiplying:3,initial error:3,involves a:3,scaled up:3,many and:3,hardwired to:3,of run-length:3,is detected:3,step when:3,very efficient:3,Figure 36.5:3,36.1 is:3,it much:3,slice lines:3,me it:3,maybe it:3,at home:3,the owner:3,my 486/33:3,Then I:3,To my:3,memory I:3,very nearly:3,world would:3,get me:3,the Y-major:3,with slopes:3,0.5 and:3,more attractive:3,best for:3,and choose:3,Once we:3,get into:3,into 2-D:3,and animation:3,A polygon:3,three categories:3,convex nonconvex:3,Figure 38.1:3,38.1 Convex:3,Convex polygons:3,as convex:3,convex and:3,drawn through:3,of nonconvex:3,Chapter 41:3,filling is:3,easily done:3,right sides:3,apparent that:3,routine can:3,and build:3,polygon we:3,Figure 38.2:3,standard lines:3,a filled:3,polygons will:3,is after:3,all only:3,only an:3,standard line-drawing:3,fit together:3,Figure 38.3:3,drawing images:3,polygons together:3,How then:3,points that:3,those points:3,drawn once:3,located exactly:3,is directly:3,edges aren’t:3,bottom edges:3,This sort:3,Polygons are:3,edges which:3,last point:3,assumed to:3,list to:3,Listing 38.2:3,scan out:3,polygon so:3,edge If:3,the ends:3,ends are:3,polygon isn’t:3,top vertex:3,the slopes:3,is leftmost:3,by eliminating:3,to ask:3,time by:3,by other:3,programs will:3,graphics programming:3,ways that:3,say a:3,fill in:3,available from:3,X Window:3,Window System:3,X In:3,Polygon Filling:3,implementation was:3,tracing and:3,Table 39.1:3,spent drawing:3,of where:3,The previous:3,x86 has:3,memset to:3,memory model:3,program Listing:3,edge tracing:3,despite the:3,of total:3,scan/memset drawing:3,compact model:3,C integer:3,integer scan/ASM:3,scan/ASM drawing:3,0.03 7:3,a 20-MHz:3,polygons were:3,fixed-point calculations:3,integer and:3,polygons don’t:3,common edges:3,It turned:3,of integer:3,of similar:3,similar triangles:3,39.2 is:3,In return:3,it’s actually:3,39.3 is:3,how good:3,drawing will:3,the effort:3,word accesses:3,another case:3,which it’s:3,of ScanEdge:3,code other:3,a completely:3,switched to:3,led us:3,three types:3,edges but:3,and convex:3,between these:3,Nonconvex polygons:3,sorting because:3,fastest of:3,line we:3,Figure 40.1:3,The question:3,Figure 40.2:3,ascending X:3,intersection with:3,edges at:3,First we:3,any edges:3,same sort:3,approach we:3,for convex:3,Advancing the:3,coordinates is:3,particularly efficient:3,are moved:3,coordinates can:3,edges from:3,GET and:3,Figure 40.3:3,store all:3,1 Set:3,coordinate to:3,edge in:3,maintaining the:3,done and:3,step 2:3,convex fill:3,are defined:3,of overlapping:3,or right:3,its endpoints:3,Listing 40.5:3,space limitations:3,time would:3,coherence of:3,I’ve chosen:3,than ten:3,keep an:3,big picture:3,previous two:3,and letting:3,the convex:3,I stopped:3,better but:3,After I:3,which no:3,angle is:3,got to:3,were at:3,those who:3,of Autodesk:3,Autodesk Animator:3,Figure 41.1:3,Figure 41.2:3,polygons Listing:3,a situation:3,potential performance:3,The thought:3,It looks:3,my wife:3,appropriate technology:3,tired of:3,to eat:3,about an:3,processing and:3,to fast:3,to suggest:3,drawing This:3,lines look:3,Wu Antialiasing:3,line along:3,full intensity:3,minus the:3,Figure 42.1:3,sum to:3,centered on:3,is drawing:3,with fast:3,move along:3,axis with:3,error adjust:3,a fixed-point:3,line intersects:3,Now the:3,pixels the:3,At each:3,line but:3,intensity levels:3,2 n:3,value 0:3,Figure 42.2:3,flipping the:3,pixel’s value:3,take longer:3,Make no:3,no mistake:3,from perfect:3,good I:3,in rendering:3,general the:3,obtained by:3,error in:3,have chosen:3,increases the:3,axis to:3,both ends:3,Bit-Plane Animation:3,the toughest:3,lesson that:3,animation In:3,all over:3,animation to:3,an animation:3,overlapping images:3,image must:3,that images:3,animation isn’t:3,The real:3,work at:3,bit planes:3,that up:3,time-consuming to:3,when images:3,bits with:3,with images:3,plane we:3,planes Figure:3,Figure 43.2:3,Figure 43.3:3,43.3 The:3,Suppose that:3,plane would:3,absence of:3,and around:3,out all:3,highest precedence:3,RAM settings:3,Table 43.1:3,Figure 43.4:3,for bit-plane:3,red 0:3,1 3:3,any order:3,Animation in:3,a steady:3,take precedence:3,precedence over:3,animation makes:3,of animated:3,the hundreds:3,animation but:3,Unfortunately it:3,addition of:3,animation can:3,can look:3,1 This:3,for images:3,Figure 43.5:3,planes but:3,same plane:3,performance advantages:3,haven’t yet:3,noticeable when:3,done to:3,page of:3,screen We:3,flipping requires:3,there just:3,to date:3,page while:3,page flip:3,with page:3,animation looks:3,good animation:3,place as:3,bring the:3,your applications:3,you feel:3,flipped animation:3,single object:3,as objects:3,quite possibly:3,destroy the:3,pixels each:3,be updated:3,Listings 44.1:3,44.1 and:3,and 44.2:3,this article:3,detail and:3,point as:3,page to:3,individual bits:3,single color:3,Listing 44.2:3,with 1-bits:3,and 0-bits:3,information in:3,requires at:3,sample application:3,with our:3,aligned with:3,clipping of:3,Not at:3,is draw:3,and weaknesses:3,decide to:3,SuperVGA modes:3,large enough:3,Figure 44.1:3,displaying page:3,updating page:3,hasn’t yet:3,the Vertical:3,flipped and:3,page that:3,640x350 is:3,there’s some:3,Figure 44.2:3,area from:3,339 scan:3,and Sam:3,Sam turned:3,change was:3,And then:3,give up:3,especially if:3,bus VGA:3,incredibly slow:3,as 100:3,So as:3,I/O performance:3,performance tests:3,Table 45.1:3,30 or:3,even 10:3,although there:3,Dirty-Rectangle Animation:3,first place:3,overlapped drawing:3,never visible:3,Figure 45.1:3,Figure 45.2:3,support page:3,because display:3,a rectangle:3,when copying:3,Action Listing:3,animation This:3,of display-memory:3,it overlaps:3,with another:3,faster rate:3,wrote me:3,as Mode:3,they’re drawn:3,the newly:3,areas that:3,current one:3,of maintaining:3,quality is:3,if they’re:3,is sufficient:3,address one:3,of debugging:3,The overall:3,and told:3,I’ve had:3,animation was:3,of Chapter:3,Listing 46.1:3,to render:3,of or:3,other images:3,a transparent:3,of rectangles:3,dirty list:3,considered for:3,the erase:3,their new:3,new locations:3,games that:3,example with:3,level is:3,around for:3,way The:3,what you’ve:3,time Listing:3,I’ve provided:3,possible with:3,entirety in:3,most VGAs:3,before any:3,X although:3,courtesy of:3,was never:3,Figure 47.2:3,one per:3,Listing 47.6:3,47.6 is:3,undocumented 320x240:3,320x240 256-color:3,technique but:3,Figure 48.1:3,as determined:3,with so:3,Figure 48.2:3,patterns are:3,two passes:3,four are:3,Figure 48.3:3,76800 pixels:3,pixels from:3,their start:3,only possible:3,a win:3,copy from:3,on fast:3,in off-screen:3,the puzzle:3,Listing 48.4:3,order that:3,system memory-to-display:3,Masked Copying:3,We now:3,routine in:3,Listing 49.1:3,image pixel:3,know to:3,fast masked:3,alignments of:3,aligned images:3,mask alignments:3,structures that:3,already stored:3,Listings 49.1:3,as necessary:3,and coordinates:3,Principles of:3,far in:3,Figure 49.1:3,they all:3,of software:3,mind and:3,with fixed-point:3,3-D on:3,arithmetic In:3,3-D programming:3,will inevitably:3,in three:3,from earlier:3,sources for:3,the approaches:3,introduction to:3,The 3-D:3,Figure 50.1:3,transformation of:3,into view:3,viewpoint is:3,X axis:3,in view:3,the projected:3,Figure 50.2:3,an axis:3,would do:3,space so:3,chosen not:3,vertices of:3,Figure 50.3:3,that remains:3,Perspective projection:3,projection Figure:3,to concatenate:3,the rotations:3,rotation matrices:3,4x4 matrices:3,Figure 50.5:3,50.5 A:3,A 4x4:3,homogeneous coordinates:3,but basically:3,of rotations:3,together a:3,project the:3,polygon from:3,partially or:3,The clipping:3,the 2-D:3,sample 3-D:3,Listings 47.1:3,47.1 and:3,47.6 from:3,set rectangle:3,fill Listing:3,Listing 49.6:3,49.6 from:3,49 Listing:3,39 polygon:3,edge scan:3,scan and:3,FillConvexPolygon function:3,function from:3,subdirectory for:3,chapter This:3,This will:3,previous chapters:3,polygon’s vertices:3,negative Z:3,world to:3,matrices are:3,Z coordinates:3,coordinates This:3,one polygon:3,but unfortunately:3,to polygons:3,shading and:3,Backface Removal:3,Hidden Surfaces:3,into screen:3,approach was:3,it were:3,pointing toward:3,removal and:3,be visible:3,Backface removal:3,vector to:3,defined as:3,Figure 51.1:3,cross-product vector:3,vector is:3,is perpendicular:3,polygon the:3,we’ll know:3,polygon orientation:3,vectors in:3,Figure 51.2:3,us which:3,two multiplies:3,of backface:3,Listing 51.3:3,Figure 51.3:3,the complete:3,keys perform:3,perform rotation:3,polygon must:3,each face:3,Figure 51.4:3,would help:3,help a:3,structure Figure:3,the matrix:3,floating-point to:3,allows each:3,projected to:3,vertices as:3,for perspective:3,carved out:3,Ausable Chasm:3,wound up:3,we knew:3,The hard:3,In our:3,animation code:3,Taken together:3,together these:3,be removed:3,Listings 52.1:3,52.1 through:3,through 52.10:3,to serve:3,hidden-surface removal:3,general 3-D:3,X-Sharp and:3,As of:3,keys to:3,worked with:3,of fixed-point:3,32-bit multiply:3,are treated:3,one can:3,divide is:3,15 fps:3,range and:3,here on:3,on out:3,Raw Speed:3,a story:3,couldn’t get:3,the girls:3,closed doors:3,X-Sharp 3-D:3,a matrix:3,XformVec and:3,of degrees:3,the dragon:3,the farthest:3,Figure 53.1:3,back-to-front sorting:3,lost in:3,created by:3,Each time:3,done on:3,in X:3,of projection:3,triangles and:3,subdirectory of:3,a tiny:3,general color:3,X-Sharp has:3,Listing 54.1:3,shading as:3,32x32 divide:3,32x16 divide:3,projecting from:3,in calculating:3,frames and:3,needs and:3,have had:3,of shading:3,all surfaces:3,angle at:3,the ambient:3,ambient and:3,Shading The:3,and diffuse:3,surface has:3,all light:3,of intensity:3,surface with:3,the shading:3,ambient shading:3,surface as:3,intensity is:3,color components:3,shading isn’t:3,Figure 54.1:3,Figure 54.2:3,v and:3,and w:3,q is:3,N 1:3,54.2 The:3,calculated by:3,polygon’s unit:3,Unfortunately that:3,vertex in:3,Figure 54.3:3,54.3 The:3,endpoint to:3,Figure 54.4:3,sources that:3,a spotlight:3,be represented:3,light vector:3,the unit:3,will we:3,by running:3,run DEMO1:3,I asked:3,properly for:3,color modeling:3,chapter’s topic:3,stuff I:3,Figure 55.1:3,be generated:3,by mixing:3,RGB colors:3,component is:3,and full:3,256 levels:3,eye is:3,so we’re:3,not from:3,palette to:3,pure primary:3,The resulting:3,a 2-2-2:3,2-2-2 RGB:3,map to:3,DEMO1 and:3,to shade:3,mapping to:3,Figure 55.2:3,was drawn:3,in contrast:3,box is:3,half our:3,Figure 55.3:3,BitMan’s technique:3,Fast Texture:3,the Hundred:3,Hundred Acre:3,Acre Wood:3,and Piglet:3,the station:3,added the:3,transformed polygon:3,image bitmap:3,reverse transformation:3,and seeing:3,Figure 56.1:3,image pixels:3,source pixel:3,Figure 56.2:3,an untransformed:3,untransformed polygon:3,source pixels:3,Figure 56.3:3,we select:3,we step:3,destination edge:3,destination is:3,2-D rotated:3,we’re able:3,to track:3,in tandem:3,tandem with:3,Figure 56.4:3,Listing 56.2:3,dimensions of:3,Figure 56.5:3,larger polygons:3,polygons have:3,polygons the:3,average the:3,along each:3,or polygons:3,large polygons:3,so that’s:3,archive in:3,but certainly:3,man who:3,particularly profound:3,said You:3,years or:3,I’d been:3,the texture-mapping:3,continuous motion:3,gaps between:3,coordinates for:3,between polygons:3,same direction:3,fixed-point and:3,and all-integer:3,Figure 57.1:3,texture to:3,source coordinates:3,with complex:3,of converting:3,calculations to:3,adds and:3,fractional part:3,advances the:3,the sheer:3,of nuclear:3,widespread use:3,Heinlein was:3,Consider for:3,point at:3,me as:3,Figure 58.1:3,had done:3,of John’s:3,Figure 58.2:3,friend Chris:3,out Chris:3,for texture:3,Figure 58.3:3,directory for:3,one scanline:3,Figure 58.4:3,Y integer:3,Figure 58.5:3,Figure 58.6:3,Y advance:3,ADD EDXECX:3,both X:3,get us:3,the textures:3,was some:3,correction is:3,did get:3,me was:3,farther than:3,did a:3,id Software’s:3,tree that:3,subdivides space:3,in 2-D:3,2-D or:3,the root’s:3,polygon for:3,been assigned:3,with such:3,traverse a:3,back-to-front or:3,Figure 59.1:3,59.1 The:3,figures in:3,traversal of:3,because if:3,entirely outside:3,view volume:3,database is:3,tree with:3,frame as:3,tree would:3,drawback of:3,the static:3,tree rather:3,splitting lines:3,or planes:3,trees that:3,BSP Tree:3,tree for:3,sample set:3,carve up:3,of walls:3,to carve:3,tree but:3,visibility ordering:3,Figure 59.3:3,walls that:3,of choosing:3,Figure 59.4:3,by wall:3,wall D:3,wall in:3,C’s front:3,Figure 59.5:3,being split:3,straddles the:3,front or:3,or back:3,C’s back:3,Figure 59.6:3,leaf of:3,each BSP:3,child trees:3,arbitrary angle:3,all walls:3,ray from:3,than wall:3,Figure 59.8:3,we’re seeing:3,the wall’s:3,BSP splitting:3,subspace into:3,an inorder:3,viewpoint so:3,a node’s:3,z component:3,a ray:3,is viewed:3,x coordinates:3,subtree of:3,right subtree:3,Figure 59.9:3,to BSP:3,I ask:3,rewrite the:3,the code-recursive:3,code-recursive version:3,picture of:3,59.4 is:3,I’ll visit:3,done If:3,visited after:3,left child:3,are visited:3,Listing 59.5:3,on BSP:3,Chapter 60:3,I started:3,my X-Sharp:3,guy who:3,I’d ever:3,DOOM and:3,much The:3,from those:3,space into:3,subspace that:3,surfaces as:3,or plane:3,those parts:3,a root:3,Figure 60.1:3,current x:3,y coordinates:3,trees for:3,Figure 60.2:3,clipping a:3,normal of:3,just going:3,ISBN 0-201-12110-7:3,splitter the:3,t value:3,intersection point:3,parametric clipping:3,60.1 is:3,for Win32:3,splitter at:3,much larger:3,balance the:3,our BSP:3,surface that:3,fewest of:3,the subspace:3,define a:3,x axis:3,axis runs:3,coordinates onto:3,vector Now:3,Figure 61.1:3,l is:3,D l:3,Figure 61.2:3,the points:3,normals in:3,lighting intensity:3,screenspace normal:3,Figure 61.3:3,any vector:3,Thus the:3,adjacent polygon:3,Figure 61.4:3,orthogonal unit:3,above in:3,into viewspace:3,projected into:3,worldspace or:3,Figure 61.5:3,Backface culling:3,culling with:3,plane origin:3,line endpoint:3,products are:3,right triangle:3,triangle and:3,Figure 61.6:3,Want to:3,Figure 61.7:3,and dot:3,Rotation by:3,Billy Zelsnack:3,onto new:3,Figure 61.8:3,rotation by:3,to DOOM:3,performance counters:3,checked the:3,I hadn’t:3,Figure 62.1:3,Given a:3,view of:3,current location:3,least partially:3,discuss each:3,where x:3,Figure 62.2:3,partially clipped:3,z coordinates:3,calculation is:3,we draw:3,Clipping to:3,Figure 62.3:3,y z:3,scale the:3,or z:3,frustum with:3,culling and:3,end vertex:3,Figure 62.4:3,for backface:3,back-to-front drawing:3,tree so:3,polygons for:3,the Volvo:3,we decided:3,consisted of:3,are involved:3,last year:3,FP optimization:3,that FP:3,potential to:3,of FP:3,mapping and:3,have far:3,FDIV for:3,FDIV has:3,the latency:3,latency of:3,to stalls:3,Listing 63.5:3,transforms per:3,FDIV to:3,reduced precision:3,Chris Hecker’s:3,Game Developer:3,Paradise had:3,look of:3,keep on:3,Quake’s 3-D:3,Quake is:3,shadows and:3,3-D accelerators:3,splitting planes:3,the empty:3,Figure 64.1:3,completely outside:3,actually visible:3,viewpoint as:3,what parts:3,or partially:3,to cull:3,node’s children:3,Figure 64.3:3,for Quake’s:3,Figure 64.4:3,Figure 64.5:3,As each:3,origin the:3,3-D engine:3,were implemented:3,surface can:3,implicit in:3,polygons from:3,a z-buffer:3,eliminates overdraw:3,a global:3,span list:3,of span:3,behind it:3,the direct-BSP:3,direct-BSP approach:3,PVS was:3,frustum is:3,overdraw the:3,precalculating the:3,The precalculated:3,interesting task:3,runtime the:3,the precalculated:3,caching and:3,John did:3,worked out:3,attitude that:3,Anecdote the:3,volume and:3,Figure 65.1:3,clipping process:3,Figure 65.2:3,by clipping:3,clipping each:3,Figure 65.3:3,a visible:3,clipped polygon:3,far clip:3,clip planes:3,frustum planes:3,Quake the:3,multiple BSP:3,as doors:3,as monsters:3,leaf against:3,z value:3,1/z values:3,performance impact:3,and level:3,final HSR:3,HSR stage:3,Sorted Spans:3,spans that:3,Each polygon:3,clipped into:3,spans sorted:3,removed from:3,polygon starts:3,Figure 66.3:3,Figure 66.4:3,span emitted:3,active polygons:3,and sorting:3,polygon sorts:3,for 1/z:3,z is:3,a b:3,b c:3,gradients are:3,these models:3,by BSP:3,the Moon:3,fifth stage:3,rendering the:3,on nodes:3,leaves and:3,same world:3,world leaf:3,sorting errors:3,leaf in:3,sorting for:3,Intersecting span:3,occurs when:3,Figure 67.1:3,Abutting span:3,polygons by:3,and rasterization:3,cache coherency:3,one surface:3,an event:3,background surface:3,vertex coordinates:3,gradient calculations:3,Chapter 68:3,linearly interpolating:3,the texel:3,64x64 texture:3,is lit:3,to Gouraud:3,it difficult:3,spotlights and:3,lighting the:3,new vertex:3,Figure 68.1:3,points as:3,lighting detail:3,that lighting:3,that Gouraud:3,lighting varies:3,several ways:3,rotational variance:3,Figure 68.2:3,Quake levels:3,the engine:3,than Gouraud:3,What all:3,The Quake:3,Figure 68.3:3,16-texel grid:3,perspective-correct texture:3,built the:3,be rebuilt:3,performance was:3,Figure 68.4:3,level for:3,a preprocessing:3,the sprite:3,Triangle Models:3,we call:3,VQuake is:3,16-bpp surfaces:3,for hardware:3,surfaces but:3,3-D API:3,two-pass lighting:3,and two-pass:3,and such:3,triangles that:3,triangle is:3,triangle mesh:3,triangles in:3,integer coordinates:3,the reciprocal:3,model would:3,that side:3,processed recursively:3,the affine:3,the children:3,do better:3,less in:3,shipping Quake:3,Trinity is:3,3-D engines:3,net code:3,parent nodes:3,in Quake’s:3,After the:3,surfaces with:3,world are:3,PVS but:3,marked as:3,current frame’s:3,and t:3,t are:3,perspective correct:3,dynamically lit:3,the player’s:3,player is:3,polygon-model polygons:3,more models:3,at higher:3,fill rate:3,a native:3,native Win32:3,client-server is:3,packet delivery:3,Black Book:2,version which:2,free in:2,Removed any:2,was it:2,it like:2,Carmack on:2,a hurricane:2,Quake’s technology:2,the morning:2,still there:2,had tried:2,Toward the:2,end when:2,spent most:2,time speeding:2,day in:2,drive home:2,me on:2,At home:2,and under:2,that sometimes:2,sometimes I:2,how any:2,ideas were:2,game technology:2,id has:2,me write:2,write about:2,it worked:2,years I:2,columns about:2,about Quake:2,a detailed:2,find these:2,these in:2,they represent:2,the development:2,hope you:2,developing the:2,the technology:2,everything I’ve:2,written over:2,past decade:2,about graphics:2,that’s still:2,today and:2,covers a:2,the CD:2,there too:2,my 1989:2,Add to:2,Quake material:2,delighted to:2,single place:2,past ten:2,ten years:2,years I’ve:2,have found:2,my writings:2,couldn’t find:2,find them:2,stuff that:2,out as:2,for very:2,Coriolis Group:2,my good:2,good friend:2,also like:2,editor of:2,and general:2,for giving:2,so easy:2,have happened:2,thank Chris:2,the Computer:2,chance I:2,have written:2,written a:2,that ended:2,up being:2,ever likely:2,these pages:2,much else:2,hasn’t already:2,chapters As:2,got my:2,Apple II:2,computers at:2,at school:2,school and:2,move into:2,PC environment:2,up over:2,PC The:2,benefit to:2,of actually:2,programmer was:2,to buy:2,get my:2,hands on:2,the articles:2,The good:2,fun to:2,of Michael’s:2,Language I:2,I looked:2,did find:2,and developed:2,developed a:2,those tricks:2,year or:2,sense for:2,the Dr:2,I saw:2,saw some:2,the man:2,over my:2,A friend:2,us back:2,in touch:2,touch with:2,other after:2,finally got:2,the ins:2,ins and:2,and outs:2,outs of:2,Doom to:2,points or:2,Eventually I:2,him a:2,Just think:2,to anyone:2,an opportunity:2,code all:2,all day:2,programmer It:2,kept at:2,year later:2,later I:2,up but:2,the steps:2,he took:2,hundred thousand:2,rewritten And:2,In hindsight:2,have plenty:2,various aspects:2,acknowledge the:2,it Sure:2,moment it:2,it still:2,learned a:2,lot and:2,managed to:2,to teach:2,programmer doesn’t:2,take it:2,you I’m:2,can because:2,programming career:2,contribution to:2,people to:2,book was:2,was written:2,many years:2,years in:2,played a:2,in making:2,making this:2,started writing:2,for teaching:2,me how:2,me my:2,writing for:2,much fun:2,to haunt:2,to Robert:2,than anyone:2,teach me:2,the English:2,English language:2,use which:2,and related:2,related topics:2,for excellent:2,graphics hardware:2,Phil Coleman:2,Dave Miller:2,Duane Strong:2,ibm.pc/fast.code topic:2,your ideas:2,I’ve done:2,my best:2,to acknowledge:2,apologies and:2,and consider:2,And of:2,The Best:2,Best Optimizer:2,Optimizer Is:2,Is between:2,between Your:2,Your Ears:2,is devoted:2,devoted to:2,that pushes:2,of miracles:2,Only on:2,layers of:2,of operating:2,can understand:2,on if:2,so wish:2,still an:2,computers You:2,be happier:2,to slow:2,sequence that:2,seconds on:2,settling for:2,for nothing:2,Not with:2,expanded memory:2,PCs can:2,imagine with:2,exceptions such:2,you believe:2,potentially more:2,fun In:2,high performance:2,The objective:2,high-performance software:2,software is:2,to carry:2,out its:2,user is:2,not say:2,possible It:2,about using:2,matter a:2,all It:2,also doesn’t:2,shouldn’t get:2,programmers think:2,to creating:2,choosing a:2,of tools:2,to building:2,do indeed:2,You also:2,being built:2,particular tasks:2,all relevant:2,doing and:2,programming skills:2,the finishing:2,and complete:2,amount to:2,you ask:2,question and:2,knew a:2,fellow named:2,an engineer:2,back then:2,rule and:2,the wind:2,few short:2,anyone with:2,with half:2,considerable effort:2,had spent:2,spend time:2,without proper:2,on making:2,inherently slow:2,program as:2,have improved:2,little thought:2,and optimizing:2,matter but:2,but less:2,think in:2,all unless:2,they’re used:2,a thorough:2,thorough understanding:2,Know where:2,the objective:2,objective of:2,Make a:2,together Make:2,design an:2,overall design:2,design Know:2,out each:2,each task:2,where performance:2,optimizing the:2,Always consider:2,get stuck:2,does matter:2,For my:2,some actual:2,actual working:2,handle on:2,on programming:2,rules in:2,If we’re:2,do As:2,16-bit checksum:2,checksum of:2,specified file:2,16-bit value:2,value This:2,as might:2,a modem:2,We’re not:2,we’re only:2,in generating:2,we going:2,a checksum:2,logical approach:2,open the:2,add them:2,only tricky:2,tricky part:2,in reading:2,and adding:2,adding them:2,one program:2,section that:2,them up:2,this It:2,be convenient:2,sum the:2,one loop:2,Unfortunately there’s:2,file will:2,sure thing:2,we read:2,minimize memory:2,requirements and:2,any size:2,shows an:2,approach Listing:2,read a:2,adds the:2,byte into:2,file is:2,compact easy:2,one slight:2,slight hitch:2,the WordPerfect:2,4.2 thesaurus:2,thesaurus file:2,file TH.WP:2,TH.WP 362293:2,362293 bytes:2,no special:2,are given:2,Microsoft compilers:2,compilers with:2,off all:2,all are:2,and one-half:2,and 1.3:2,the C/assembly:2,C/assembly equivalent:2,and Listings:2,to rely:2,your compiler’s:2,home the:2,together are:2,are equivalent:2,checksum loop:2,in tight:2,The assembly:2,indeed faster:2,1.1 but:2,unacceptably slow:2,in seconds:2,chapter’s listings:2,the compiled:2,program on:2,The lesson:2,code faster:2,code Well:2,Well then:2,our design:2,understand what’s:2,wrong with:2,why is:2,overhead The:2,calling DOS:2,DOS to:2,bytes I:2,figured this:2,by watching:2,watching the:2,from both:2,DOS functions:2,overhead For:2,and interrupts:2,DOS has:2,and branch:2,process Finally:2,byte has:2,disk if:2,not store:2,location and:2,in DOS:2,code profiler:2,word for:2,it There’s:2,to DOS:2,we speed:2,must somehow:2,invoking DOS:2,By gosh:2,and buffers:2,bytes internally:2,them out:2,by reading:2,I/O and:2,and getc:2,new design:2,runs more:2,1.1 even:2,To the:2,casual observer:2,slightly different:2,yet in:2,that between:2,a 4.77:2,MHz PC:2,a 16:2,really goes:2,time-critical portions:2,last section:2,phrase the:2,those portions:2,code makes:2,your program—and:2,faster or:2,rather that:2,user’s perspective:2,set-up code:2,that directly:2,directly affect:2,affect response:2,bothered to:2,subroutines that:2,still used:2,assembly I:2,suppose you:2,might get:2,you’d get:2,get even:2,much and:2,and you’d:2,perceptible difference:2,about other:2,other approaches:2,but let’s:2,let’s see:2,file the:2,occurs because:2,us That’s:2,than reading:2,time using:2,our program:2,and manage:2,faster Consider:2,a parameter:2,the parameter:2,library code:2,the stream:2,stream and:2,and returning:2,especially by:2,single loop:2,programmers would:2,improve on:2,works even:2,it’s slow:2,slow enough:2,library is:2,essentially the:2,the buffering:2,of file:2,not run:2,second reason:2,hallmark of:2,when optimization:2,are they:2,they always:2,particularly well-optimized:2,fact they’re:2,well-matched to:2,internal buffering:2,is 2.5:2,uses no:2,no assembly:2,application needs:2,implementation like:2,like Listing:2,coding such:2,let a:2,that hard:2,reading a:2,runs out:2,while more:2,the restartable:2,block implementation:2,about each:2,reads in:2,process until:2,been processed:2,5 we’ll:2,text strings:2,rate Listing:2,and program:2,go a:2,unoptimized version:2,by more:2,26 percent:2,are considerable:2,design has:2,dominated by:2,DOS and/or:2,write is:2,improvement we:2,got by:2,by optimizing:2,DOS disk:2,file to:2,the inherent:2,limits the:2,improvement that:2,obtained via:2,assembly In:2,applications in:2,which string:2,assembly tends:2,faster relative:2,very specific:2,Don’t get:2,best optimizer:2,between your:2,your ears:2,matters Where:2,What have:2,knowing what:2,well it:2,your part:2,the ratios:2,vertical axis:2,of Table:2,the checksumming:2,without an:2,improvement from:2,debate about:2,which C:2,C compiler:2,much in:2,chapter has:2,process I’m:2,claiming that:2,however you:2,want but:2,never forget:2,that design:2,optimization Never:2,stop looking:2,on specific:2,we’ll continue:2,continue to:2,blocks and:2,Nature of:2,Optimization As:2,a badly:2,all make:2,run slowly:2,great optimization:2,speaking of:2,in is:2,a real-world:2,real-world example:2,assembly subroutine:2,it run:2,possible The:2,The task:2,a nibble:2,rotating and:2,and combining:2,up neatly:2,in bits:2,examined the:2,cycle here:2,key part:2,looked something:2,than seven:2,me so:2,going over:2,code again:2,bit into:2,separately so:2,a multibit:2,multibit rotation:2,rotation was:2,loop for:2,instructions themselves:2,optimized the:2,overall approach:2,possible use:2,instructions I:2,times While:2,code may:2,much different:2,original and:2,instructions the:2,entire subroutine:2,from just:2,I eliminated:2,DEC and:2,and JNZ:2,instructions do:2,problems from:2,of perspectives:2,can put:2,those fast:2,fast instructions:2,most effective:2,Assembly Is:2,hard as:2,the decidedly:2,decidedly quirky:2,other languages:2,well To:2,gets written:2,makes that:2,transformation that:2,takes place:2,implementation can:2,can reduce:2,reduce performance:2,binary search:2,design however:2,and Pascal:2,of turning:2,a design:2,involves two:2,into machine:2,code generated:2,lend themselves:2,relatively well:2,transition from:2,of implementation:2,of efficiency:2,true given:2,family in:2,real and:2,and 16-bit:2,itself particularly:2,to compiler:2,its successors:2,registers than:2,like Figure:2,language transformation:2,representation of:2,of machine:2,difficult programming:2,and systems:2,the programmer’s:2,perform no:2,a one-to-one:2,task a:2,2.2 Properly:2,Properly constructed:2,programmer must:2,the direct:2,you design:2,help at:2,be capable:2,PC world:2,world you:2,you add:2,well-documented and:2,and reasonably:2,articles about:2,single most:2,The x86:2,performance What’s:2,so difficult:2,learn that:2,most articles:2,and books:2,its limits:2,assembly programmers:2,knowledge about:2,the hardest:2,to gather:2,much you:2,learn about:2,to discover:2,Flexible Mind:2,Is the:2,base on:2,the objectives:2,objectives of:2,the forces:2,will fall:2,objectives to:2,run or:2,We’ll look:2,with saving:2,cycles than:2,relatively more:2,we’ll find:2,often possible:2,we’re willing:2,cycles It’s:2,use such:2,techniques to:2,always possible:2,for high-performance:2,not include:2,Those are:2,develop and:2,care only:2,developed nor:2,development environment:2,non-time-critical portions:2,that interact:2,be your:2,the path:2,sort described:2,earlier is:2,knowledge doesn’t:2,doesn’t do:2,do by:2,programming instincts:2,it happen:2,program specification:2,of learning:2,find your:2,you on:2,way with:2,book The:2,you gain:2,the necessary:2,the journey:2,meeting the:2,mind if:2,you will—is:2,will—is the:2,good assembler:2,will develop:2,good compiled:2,Many people:2,otherwise but:2,wrong That:2,languages are:2,the majority:2,of programmers:2,most applications:2,fastest or:2,smallest code:2,compiler can:2,a piece:2,do or:2,the person:2,who wrote:2,programmer can:2,that compilers:2,compilers are:2,only choice:2,small well-defined:2,compact as:2,possible as:2,instead but:2,those areas:2,areas where:2,code quality:2,will generate:2,that good:2,also true:2,that bad:2,bad assembly:2,code since:2,he or:2,or she:2,opportunities to:2,and bytes:2,bytes The:2,code requires:2,that framework:2,To summarize:2,a combination:2,of thought:2,possible the:2,absolutely the:2,code With:2,mind what:2,should the:2,first step:2,then would:2,pushing the:2,wring more:2,speed from:2,computer In:2,you’re bound:2,few years:2,8088 assembly:2,for Speed:2,optimize is:2,which certainly:2,for error:2,error The:2,author had:2,bits by:2,duplicating each:2,bit The:2,up cycles:2,routine In:2,used all:2,information at:2,the routine:2,It ran:2,original version:2,version The:2,cardinal sin:2,He had:2,had assumed:2,information available:2,was both:2,for its:2,indeed correct:2,correct they:2,is instruction:2,return in:2,taken the:2,have put:2,had he:2,found it:2,CPU There:2,There you:2,code possible:2,action to:2,it’s really:2,is If:2,than from:2,or book:2,book on:2,do your:2,the improvement:2,measure performance:2,you’re just:2,code just:2,writing my:2,game I:2,adds for:2,counting but:2,it often:2,the fetching:2,fetching of:2,was taking:2,taking as:2,for considerable:2,wasted effort:2,a debate:2,the letters:2,magazine about:2,about exactly:2,Adapter CGA:2,cycle in:2,had failed:2,one key:2,measure code:2,most accurate:2,cost can:2,made with:2,chip which:2,8253 can:2,be started:2,and stopped:2,indicating how:2,code took:2,about 1:2,microsecond is:2,8253 counts:2,counts once:2,every 838.1:2,three subroutines:2,ZTimerOn ZTimerOff:2,Zen timers:2,are presented:2,Chapter K:2,Is a:2,it I’ll:2,it’s essential:2,learn what:2,it On:2,we seek:2,rather it’s:2,Consequently you:2,called at:2,disables interrupts:2,sets timer:2,8253 to:2,2 divide-by-N:2,of ZTimerOn:2,that ZTimerOn:2,interrupts ZTimerOff:2,in when:2,when ZTimerOn:2,keyboard mouse:2,interval and:2,being measured:2,result code:2,expect any:2,the interval:2,PC A:2,second interesting:2,introduce some:2,some small:2,whenever it:2,PC’s system:2,clock which:2,current time:2,All three:2,a signal:2,Each timer:2,time via:2,its gate:2,that timer:2,timer counts:2,to external:2,circuitry and:2,PC the:2,purposes in:2,drives the:2,only timer:2,timer with:2,programmable gate:2,input in:2,timer that:2,program control:2,Intel On:2,is connected:2,interrupt to:2,is dedicated:2,3.1 The:2,The configuration:2,BIOS at:2,a rising:2,rising edge:2,edge on:2,This line:2,hardware interrupt:2,interrupt 0:2,every 54.925:2,interrupts in:2,area at:2,book are:2,count turns:2,once an:2,and date:2,the DATE:2,DATE and:2,and TIME:2,TIME commands:2,channel of:2,can operate:2,operate in:2,0 normally:2,operates in:2,down two:2,two at:2,output state:2,zero The:2,that changes:2,clock by:2,factor of:2,count In:2,its normal:2,generates an:2,pulse that:2,controller and:2,exact timings:2,one from:2,down again:2,a pulse:2,single clock:2,the pulse:2,in square:2,controller is:2,is configured:2,configured in:2,PC to:2,the existence:2,existence of:2,from timer:2,result timer:2,Why not:2,all timer:2,can’t generate:2,us when:2,shortly that:2,also makes:2,time much:2,longer periods:2,timer shown:2,intervals of:2,the period:2,be measured:2,0 before:2,its count:2,divides in:2,8088 performs:2,be longer:2,that effect:2,effect A:2,cases will:2,be presented:2,has turned:2,an IRQ0:2,IRQ0 interrupt:2,is pending:2,runs so:2,generated a:2,allow for:2,and generates:2,when timer:2,and reaches:2,is incurred:2,generated when:2,to 54.925:2,this only:2,a warm:2,warm or:2,or cold:2,cold boot:2,ZTimerOff is:2,to 110:2,110 ms:2,far greater:2,Consequently if:2,starts and:2,and doesn’t:2,time all:2,system time:2,for great:2,great concern:2,battery-backed clocks:2,reset the:2,timer usually:2,slow by:2,by at:2,most a:2,takes much:2,run is:2,computer at:2,session with:2,timer in:2,clock is:2,Stopping the:2,mark the:2,and stores:2,stores the:2,Immediately after:2,a flag:2,mark that:2,timer overflowed:2,indeed a:2,determine how:2,counts in:2,interrupt flag:2,start timing:2,interesting aspect:2,stopped in:2,We don’t:2,don’t actually:2,latched read:2,read feature:2,specific purpose:2,of reading:2,thing too:2,no documented:2,documented way:2,0 if:2,we wanted:2,to since:2,Later in:2,chapter though:2,0 can:2,We simply:2,latch the:2,without breaking:2,display timing:2,checks to:2,prints a:2,effect and:2,converts the:2,microseconds to:2,called immediately:2,normal display:2,this One:2,One approach:2,removal of:2,to 9:2,ZTimerReport and:2,observing the:2,is modification:2,an unused:2,serial port:2,a terminal:2,send the:2,the printer:2,via either:2,final approach:2,and load:2,device driver:2,result might:2,this final:2,still other:2,thrown out:2,you started:2,Timer The:2,timer subroutines:2,running in:2,the public:2,Code The:2,assembly or:2,OBJ files:2,are compatible:2,the Microsoft:2,Microsoft linker:2,segment that:2,far procedures:2,all registers:2,flag so:2,routines are:2,are transparent:2,do change:2,call them:2,from code:2,FAR PTR:2,latter two:2,two routines:2,aren’t the:2,they won’t:2,starting and:2,the inaccuracy:2,time does:2,timer itself:2,itself The:2,giving us:2,about 1µs:2,factors such:2,variations in:2,it perhaps:2,about 100:2,and tweak:2,purpose The:2,all PC-compatible:2,haven’t been:2,any problems:2,doesn’t run:2,hand there:2,certainly no:2,genuine IBM:2,or that:2,that either:2,absolute or:2,performance will:2,code much:2,PC or:2,As another:2,example I:2,mind you:2,without actually:2,excellent tool:2,Use of:2,3.2 shows:2,sets DS:2,DS equal:2,to CS:2,reasons we’ll:2,file TESTCODE:2,calls ZTimerReport:2,results Consequently:2,3.3 shows:2,shows some:2,variable MemVar:2,ZTimerOn to:2,performs 1000:2,When Listing:2,and included:2,included by:2,been run:2,begins by:2,lets us:2,and jumping:2,around that:2,each listing:2,before doing:2,precisely so:2,embedded in:2,code fragments:2,to include:2,include the:2,have full:2,full control:2,by naming:2,assembling both:2,both Listing:2,MASM and:2,two resulting:2,files together:2,together by:2,the Borland:2,linker Listing:2,generates and:2,the executable:2,executable file:2,3.1 and:2,The command-line:2,name of:2,and link:2,same is:2,Listing 3.7:2,Assuming that:2,to round:2,that last:2,last digit:2,instruction are:2,there’s just:2,refresh the:2,per MOV:2,See the:2,reference manuals:2,manuals for:2,Fear not:2,Exactly why:2,3.2 and:2,and enter:2,the test-bed:2,program of:2,places and:2,Long-Period Zen:2,above will:2,that generally:2,generally take:2,will need:2,time longer:2,longer intervals:2,more it:2,ms at:2,I’ve also:2,a Zen:2,periods longer:2,ms The:2,timer so:2,leaves interrupts:2,timing period:2,maintain an:2,time over:2,Practically speaking:2,speaking however:2,however there:2,indeed the:2,needed the:2,of calculating:2,hour is:2,is unable:2,time an:2,an interval:2,secure in:2,least you:2,be disabled:2,disabled for:2,a stretch:2,when interrupts:2,timer While:2,interval is:2,is included:2,time measured:2,Likewise any:2,interrupts that:2,will increase:2,measured time:2,timer has:2,however have:2,same potential:2,this In:2,components the:2,count The:2,count measures:2,ms intervals:2,Otherwise we:2,count just:2,then read:2,the time-of-day:2,inaccuracy in:2,other direction:2,0 isn’t:2,should we:2,undocumented feature:2,its tracks:2,new mode:2,an initial:2,and correct:2,is waiting:2,works beautifully:2,However there’s:2,programs the:2,way What’s:2,by disabling:2,just have:2,by 54:2,selects between:2,latch-and-read method:2,all computers:2,which could:2,could in:2,I’ve observed:2,results but:2,failure of:2,with PS2:2,PS2 set:2,has run:2,so be:2,alert for:2,trouble if:2,up any:2,problems of:2,above This:2,each code-timing:2,the PS2:2,1 if:2,results with:2,timer when:2,first to:2,If they’re:2,produces more:2,results when:2,approaches is:2,is yours:2,at 1:2,repeat each:2,before relying:2,code more:2,PS/2 and:2,computers The:2,Whenever the:2,long for:2,instead Listing:2,before calling:2,thereby allowing:2,starts the:2,temptation to:2,the mouse:2,timer the:2,file containing:2,TASM and:2,generating and:2,3.6 Listing:2,3.8 is:2,that interrupts:2,left enabled:2,a microsecond:2,execute the:2,that handles:2,10 minutes:2,are using:2,assembling Listing:2,is notoriously:2,slow at:2,C The:2,when programming:2,the box:2,cases to:2,be dealt:2,I’ll tackle:2,the simpler:2,Altering the:2,program involves:2,3.1 that:2,segment In:2,doesn’t occur:2,occur and:2,different lines:2,lines Figure:2,3.2 Changes:2,with small:2,in addition:2,reference timing:2,routines that:2,be subtracted:2,be converted:2,from large:2,numbers are:2,listings for:2,Watch Out:2,Out for:2,important safety:2,when modifying:2,works because:2,segment as:2,normally a:2,smaller and:2,3.3 Changes:2,C However:2,to push/near:2,it impossible:2,Put the:2,such problem:2,up through:2,it’s nice:2,jumps and:2,and selecting:2,tricks like:2,pairs for:2,for far:2,way when:2,control is:2,is optimizing:2,cause subtle:2,problems I:2,I happened:2,a recent:2,tested the:2,Further Reading:2,to pursue:2,pursue the:2,good article:2,January 1987:2,1987 issue:2,if somewhat:2,components including:2,8237 DMA:2,For details:2,PC as:2,PC’s hardware:2,of technical:2,not critical:2,Armed with:2,instructions although:2,an 8088-based:2,PC would:2,to manage:2,manage two:2,interferes with:2,does This:2,longer code:2,sequences since:2,notwithstanding the:2,4 In:2,the Lair:2,Lair of:2,the Cycle-Eaters:2,chapter adapted:2,adapted from:2,may sound:2,task indeed:2,indeed one:2,favorite of:2,PC programmers:2,pedal-to-the-metal optimization:2,and results:2,chapter are:2,x86-family processors:2,I’ll point:2,discuss those:2,lurk in:2,your system:2,remains an:2,chapter as:2,as gospel:2,newer processors:2,to later:2,chapters to:2,have changed:2,do take:2,good start:2,has many:2,ranging from:2,lie on:2,call these:2,share of:2,without regard:2,U.S Army:2,that live:2,interface that:2,Simply because:2,optimization requires:2,That’s no:2,no simple:2,in precisely:2,precisely that:2,that area:2,literature on:2,interface the:2,you about:2,the raw:2,performance which:2,by instruction:2,This area:2,hardware engineers:2,engineers and:2,discussed as:2,it relates:2,relates to:2,performance And:2,the mechanisms:2,level that:2,bus or:2,CPU itself:2,the older:2,where they:2,CPU performs:2,those cycle-eaters:2,will you:2,chapters The:2,The nature:2,cycle-eaters vary:2,architecture to:2,understand them:2,them all:2,among them:2,original 8088-based:2,8088-based IBM:2,Later on:2,the newer:2,first The:2,Internally the:2,processor capable:2,data must:2,traverse the:2,along every:2,operands but:2,even instructions:2,operands can:2,can suffer:2,that’s important:2,bus The:2,and 80386:2,states The:2,locations of:2,primordial 8088-based:2,cover each:2,programming By:2,all even:2,with them:2,processor It’s:2,Fans of:2,8088 an:2,truth of:2,matter is:2,the poor:2,poor man’s:2,interface is:2,wide but:2,wide as:2,be transferred:2,8086 which:2,8088 was:2,4.1 The:2,The location:2,4.2 Internal:2,Internal data:2,bus widths:2,widths of:2,8088 Figure:2,8088 As:2,squarely on:2,which breaks:2,accesses into:2,original PC’s:2,could still:2,time Each:2,8088 takes:2,4 clock:2,which data:2,every 0.838:2,8086 bus:2,access can:2,can transfer:2,effective transfer:2,every word-sized:2,access on:2,accesses one:2,8088 has:2,nutshell is:2,A related:2,two halves:2,the 8-Bit:2,that word-sized:2,instruction timings:2,MemVar takes:2,address MemVar:2,perform multiple:2,that 4-cycle:2,two word-sized:2,destination operand:2,operand from:2,adding to:2,than other:2,can lose:2,8088 instruction:2,take over:2,one-tenth of:2,simply because:2,second That’s:2,additions and:2,upshot of:2,an Execution:2,These problems:2,shortly the:2,well What:2,possible After:2,loop counter:2,loop That’s:2,DEC performs:2,the word-sized:2,word-sized operand:2,operand and:2,each byte-sized:2,Throughout this:2,shown a:2,still greater:2,greater advantage:2,DEC instructions:2,all However:2,instructions don’t:2,don’t exist:2,a vacuum:2,listings I:2,the counter:2,counter and:2,a functional:2,you come:2,seems less:2,to real:2,and improve:2,important part:2,said in:2,in 8088:2,not mean:2,manipulate a:2,1 word-sized:2,access as:2,every access:2,byte takes:2,least 4:2,built right:2,faster with:2,separate byte-sized:2,cycles As:2,of fact:2,access that:2,slowly with:2,separate instruction:2,word read:2,Listing 4.4:2,but does:2,so with:2,byte-sized reads:2,perform exactly:2,accesses each:2,two byte-sized:2,only 4:2,additional cycles:2,break the:2,you The:2,task than:2,can possibly:2,8088 where:2,cycle-eater can’t:2,get at:2,at them:2,many variables:2,the time-consuming:2,register operands:2,operands are:2,than instructions:2,shorter is:2,explain why:2,true and:2,cycle-eater I:2,all any:2,no It’s:2,It’s true:2,general we:2,take to:2,byte-sized operand:2,However all:2,all word-sized:2,lose 4:2,cycle-eater and:2,one sort:2,of word-sized:2,Prefetch Queue:2,Queue Cycle-Eater:2,from fetching:2,fetching instruction:2,lies idle:2,while waiting:2,memory data:2,net result:2,bytes much:2,BIU can:2,limit on:2,instructions any:2,at less:2,speed because:2,can’t keep:2,the demand:2,demand for:2,bytes That’s:2,the fuss:2,tricky is:2,memory Not:2,instance the:2,instructions should:2,cycles since:2,or how:2,take that:2,not there:2,an unavoidable:2,at why:2,wrong and:2,Execution Times:2,is 10:2,is full:2,full when:2,6 instruction:2,40 cycles:2,and could:2,Why does:2,includes both:2,and Execution:2,performed as:2,execution by:2,isn’t in:2,Sometimes the:2,the BIU:2,to prefetch:2,EU needs:2,executes instructions:2,mix preceding:2,instruction depends:2,of prefetching:2,prefetching the:2,full 4:2,all As:2,other cycle-eaters:2,during different:2,different executions:2,executions of:2,prefetch time:2,must time:2,is There:2,The effect:2,complicates the:2,results reported:2,queue effects:2,driving the:2,are similar:2,you’re measuring:2,100 or:2,just learned:2,instruction starts:2,starts executing:2,preceded by:2,prefetch states:2,likely state:2,results For:2,our familiar:2,time should:2,relationship between:2,not intended:2,of 8088:2,a contrast:2,byte The:2,cycle-eater which:2,cycles Figure:2,4.3 Execution:2,examine Listing:2,Here each:2,a MUL:2,MUL instruction:2,always full:2,be ready:2,we’d expect:2,expect that:2,SHR would:2,in 2:2,should come:2,120 cycles:2,per SHR/MUL:2,SHR/MUL pair:2,by God:2,an execution:2,pair or:2,or exactly:2,these results:2,the conclusion:2,we drew:2,We’ve seen:2,seen one:2,one code:2,sequence in:2,8-plus cycles:2,about two:2,different forms:2,is purely:2,purely a:2,the differing:2,left the:2,so overall:2,performance reflects:2,contrast each:2,which leaves:2,is partially:2,Some people:2,they assume:2,instruction While:2,for register-only:2,register-only code:2,hold for:2,be 4:2,would dictate:2,at calculating:2,memory addresses:2,instruction ends:2,ends The:2,given bit:2,other will:2,will improve:2,Listing 4.7:2,which consists:2,MOV AL0:2,which executes:2,1.81 µs:2,Listing 4.8:2,which replaces:2,Both instructions:2,time not:2,performance Figure:2,4.4 Execution:2,see it’s:2,you’re saving:2,cycles when:2,not You:2,by reducing:2,or sometimes:2,missed it:2,by executing:2,Intel manuals:2,The fact:2,fact of:2,least as:2,want is:2,us the:2,the tool:2,tool we:2,be easier:2,you simply:2,is For:2,crying out:2,just by:2,that execution:2,Don’t think:2,added together:2,performance For:2,plus 2:2,of Execution:2,next SHR:2,for 2:2,cycles there’s:2,4.5 as:2,cycles which:2,cycles while:2,being fetched:2,you prefer:2,execution of:2,should only:2,we’ll consider:2,particular context:2,context to:2,since such:2,Keep your:2,to faster:2,faster overall:2,queue bottleneck:2,than do:2,long instructions:2,Short instructions:2,generally have:2,have such:2,size For:2,which runs:2,of fewer:2,fewer instruction:2,their official:2,some circumstances:2,even differ:2,writing good:2,much an:2,an art:2,a science:2,should follow:2,is You:2,actual measured:2,bottom line:2,I’ve taken:2,and further:2,telling you:2,level in:2,low enough:2,quite yet:2,The 8-bit:2,one level:2,level at:2,affects code:2,level the:2,to hardware:2,of dynamic:2,let’s step:2,back for:2,truth the:2,distinctions between:2,don’t much:2,matter to:2,Under certain:2,making your:2,run more:2,seemingly should:2,refresh are:2,external to:2,as video:2,video and:2,can insert:2,insert wait:2,the DMA:2,controller can:2,code can’t:2,However code:2,be designed:2,better off:2,and knowing:2,code doesn’t:2,were programming:2,refresh which:2,which affects:2,By that:2,are accessing:2,data When:2,on more:2,into play:2,While you:2,could stop:2,all code:2,runs a:2,bit slower:2,PC than:2,of background:2,chip is:2,retains its:2,contents indefinitely:2,indefinitely so:2,power is:2,a dynamic:2,the blocks:2,is kept:2,often enough:2,PC must:2,each DRAM:2,will access:2,special circuitry:2,timer 1:2,channel 0:2,bus from:2,memory directly:2,directly without:2,between memory:2,it gives:2,256 possible:2,advancing to:2,next address:2,256 addresses:2,accessed by:2,that taken:2,the 256:2,15.08 µs:2,is refreshed:2,refreshed in:2,Only the:2,adapters and:2,must provide:2,not available:2,5.56 percent:2,cycles The:2,The Execution:2,processing while:2,memory Consequently:2,0 percent:2,percent and:2,and actually:2,which DRAM:2,cycles during:2,The PC:2,bus dynamic:2,refresh on:2,be plenty:2,refresh has:2,has taken:2,queue should:2,for data:2,and DRAM:2,no impact:2,DRAM refreshes:2,of repeated:2,demonstrate a:2,cycles Since:2,the shortest:2,instructions shown:2,be empty:2,4.10 executes:2,read each:2,program’s execution:2,time That’s:2,than our:2,loss to:2,be The:2,as 6:2,cycles depending:2,internal instruction:2,runs each:2,holds up:2,in executing:2,things can:2,than we:2,Which of:2,two cases:2,case can:2,performance reduction:2,ranging as:2,Refresh Cycle-Eater:2,we discovered:2,instructions When:2,registers What:2,nothing you:2,reduce DRAM:2,overhead is:2,some instructions:2,are affected:2,than others:2,but how:2,conceivably be:2,structured to:2,old days:2,when code:2,bytes not:2,were less:2,PC however:2,careful code:2,limits on:2,on faster:2,different execution:2,speeds and:2,way around:2,around it:2,much from:2,It certainly:2,matters The:2,code down:2,your code’s:2,fractional cycle:2,at work:2,adapter cycle:2,386s and:2,and later:2,effect as:2,performance are:2,Wait States:2,are cycles:2,the device:2,and truly:2,truly the:2,Everything we:2,will discuss:2,be affected:2,coexist with:2,how slow:2,complete each:2,adapters can’t:2,quickly for:2,adapters must:2,memory between:2,the circuitry:2,circuitry that:2,adapters can:2,accesses by:2,adapter that:2,that couldn’t:2,to executing:2,concerned By:2,the circumstances:2,advantage to:2,let’s learn:2,refresh wait:2,only occur:2,access are:2,are entirely:2,states the:2,access All:2,mechanism is:2,itself for:2,access Figure:2,4.6 Video:2,Video wait:2,states don’t:2,accesses a:2,pose a:2,only display:2,The Display:2,two masters:2,performance problem:2,display screen:2,This circuitry:2,circuitry must:2,must constantly:2,70 times:2,can require:2,Super VGA:2,demanding master:2,its needs:2,picture on:2,screen would:2,would suffer:2,Master 2:2,reads to:2,less important:2,1 since:2,affects display:2,words if:2,CPU has:2,It matters:2,matters a:2,memory only:2,write display:2,8088 CPU:2,for three:2,three reasons:2,as about:2,90 percent:2,all display:2,4.7 Allocation:2,Allocation of:2,or pixels:2,short for:2,access even:2,related to:2,complete an:2,free display:2,Any or:2,can result:2,creating the:2,4.8 Display:2,access slots:2,is Greek:2,don’t worry:2,memory How:2,How slow:2,slow is:2,Remember how:2,not display:2,and unless:2,PC isn’t:2,sounds like:2,of like:2,how great:2,answer varies:2,considerably depending:2,what display:2,Graphics Adapter:2,VGAs especially:2,fewer wait:2,VGA On:2,Super VGAs:2,have more:2,in high-resolution:2,Monochrome Display:2,Hercules Graphics:2,Graphics Card:2,cycle-eater as:2,a lesser:2,for PC:2,the foreseeable:2,foreseeable future:2,its close:2,Even on:2,selected In:2,cycle-eater isn’t:2,isn’t present:2,4000 bytes:2,display and:2,than five:2,still take:2,write every:2,eye in:2,to convey:2,information can:2,by definition:2,story of:2,a magazine:2,horizontal retrace:2,only during:2,the short:2,memory can:2,in 80-column:2,80-column text:2,the calculations:2,above notwithstanding:2,kicks in:2,the high-resolution:2,problem here:2,states per:2,modes that:2,varies from:2,Rather the:2,draw an:2,bytes used:2,modes the:2,the cumulative:2,performance even:2,time For:2,5 µs:2,access for:2,EGA’s high-resolution:2,to scroll:2,screen once:2,an eternity:2,system RAM:2,than 8:2,access In:2,can more:2,Bear in:2,is proportional:2,line-drawing subroutine:2,less performance:2,MOVS instructions:2,graphics which:2,performing calculations:2,using very:2,suffer less:2,next As:2,memory less:2,code Interestingly:2,machines because:2,because while:2,while those:2,those computers:2,computers can:2,PC it:2,of access:2,an inherent:2,inherent characteristic:2,can’t access:2,possible In:2,particular we:2,can try:2,operations of:2,and clip:2,read/modify/write operations:2,should try:2,don’t require:2,accesses The:2,key here:2,Pentiums as:2,schemes that:2,Along the:2,same line:2,avoided in:2,principle for:2,possible This:2,when many:2,since only:2,are ideal:2,for making:2,used on:2,on whole:2,whole bytes:2,of modifying:2,modifying display:2,time On:2,faster processors:2,between display:2,in depth:2,but alas:2,time being:2,is closer:2,is significant:2,We’ve covered:2,everything you’ve:2,you’ve read:2,documented cycle:2,most PC:2,position to:2,and software:2,can scarcely:2,scarcely be:2,be addressed:2,you better:2,vary in:2,processors with:2,vanishing altogether:2,new ones:2,unchanged as:2,chapters Chapter:2,Crossing the:2,We just:2,just moved:2,words should:2,of anyone:2,who owns:2,move was:2,five miles:2,I personally:2,spent about:2,about 15:2,15 hours:2,The move:2,You’re probably:2,with high-performance:2,didn’t I:2,rent a:2,over in:2,hours of:2,of driving:2,answers the:2,and cheaper:2,cheaper to:2,on It:2,wasn’t even:2,drive a:2,a car:2,But at:2,I sat:2,sat down:2,block approach:2,processing whereby:2,DOS or:2,is allowed:2,program but:2,slow due:2,results from:2,byte must:2,Sound familiar:2,should I:2,byte-by-byte approach:2,made for:2,approach often:2,great virtue:2,when writing:2,develop a:2,search the:2,specified on:2,string is:2,very limited:2,a generally:2,useful application:2,insight into:2,particular and:2,general in:2,of developing:2,developing a:2,a search:2,engine will:2,to plug:2,you from:2,from using:2,in designing:2,discard all:2,orders of:2,own code:2,Based on:2,experience in:2,in small:2,the bigger:2,buffer the:2,overhead A:2,buffer that:2,and 64K:2,search approach:2,maximum size:2,near pointers:2,know we:2,large buffer:2,infrequently as:2,accomplish this:2,do our:2,our searching:2,Well it:2,instructive to:2,our search:2,suppose we:2,with file:2,file handling:2,through multiple:2,multiple blocks:2,closest match:2,which searches:2,work it:2,isn’t ideal:2,a fixed-length:2,fixed-length buffer:2,our buffer:2,must spend:2,time either:2,is Even:2,its performance:2,least for:2,This illustrates:2,black boxes:2,and relate:2,relate that:2,meets our:2,with pointers:2,pointers in:2,will almost:2,instruction However:2,It wouldn’t:2,If necessary:2,necessary you:2,write your:2,The brute-force:2,brute-force searching:2,searching technique:2,technique Figure:2,each potential:2,Surely there’s:2,location that:2,the bat:2,potentially matching:2,scan the:2,match with:2,matches as:2,approach however:2,Use the:2,the extremely:2,extremely efficient:2,tested with:2,can build:2,efficient search:2,engine that:2,takes good:2,good advantage:2,memchr and:2,5.2 The:2,faster string-searching:2,string-searching technique:2,file-searching program:2,trick lies:2,in deciding:2,to integrate:2,approach with:2,with restartable:2,searching algorithm:2,algorithm as:2,locations as:2,as potential:2,locations can:2,complex to:2,and implement:2,main focus:2,blocks so:2,save it:2,chapter Chapter:2,suspect you’ll:2,selected a:2,and searching:2,no great:2,Basically we’ll:2,search it:2,handle this:2,by copying:2,The exact:2,next is:2,minus 1:2,since that’s:2,checked as:2,matches because:2,the check:2,run off:2,particularly complex:2,one block:2,block with:2,within each:2,say at:2,boost the:2,However I’m:2,important a:2,as any:2,interesting performance:2,all should:2,should become:2,for optimization:2,worth bothering:2,bothering with:2,with at:2,understanding where:2,where most:2,a program’s:2,5.1 is:2,three seconds:2,386 machine:2,cache If:2,is trimmed:2,approximately double:2,thing we’ve:2,blocks do:2,best performance:2,and might:2,Our next:2,call in:2,that simply:2,program into:2,contrast Listing:2,isn’t found:2,calls is:2,80 percent:2,probably a:2,exiting the:2,converting to:2,isn’t worth:2,by speeding:2,require more:2,than doubling:2,already uses:2,worth converting:2,If for:2,example your:2,application will:2,will typically:2,search string:2,case when:2,implementation might:2,be several:2,switch from:2,to REPZ:2,and call:2,to REPNZ:2,quickly than:2,z for:2,or nearly:2,significantly faster:2,such application:2,be searching:2,buffers and:2,will that:2,is definitely:2,single best:2,you’re more:2,more concerned:2,average or:2,decide how:2,up your:2,worth doing:2,all By:2,way don’t:2,just because:2,large block:2,times more:2,32 bytes:2,surely be:2,calls in:2,fully optimized:2,any reason:2,balance of:2,components of:2,I’ve explained:2,process large:2,blocks with:2,speed The:2,first lesson:2,I fully:2,version to:2,I actually:2,hot spots:2,tasks you:2,you into:2,for easy:2,inner loop—the:2,efficient as:2,easy but:2,than pays:2,pays for:2,greatly improved:2,And when:2,course or:2,Chapter 6:2,Than You:2,by PC:2,1 through:2,him I:2,fortunate enough:2,to Jeff:2,the dinner:2,table and:2,was making:2,making a:2,science fiction:2,year in:2,an old:2,Journal I:2,here You:2,should see:2,To which:2,Had I:2,all I:2,never occurred:2,put on:2,just finished:2,about Turbo:2,don’t judge:2,judge a:2,fact what:2,value a:2,that face:2,and beyond:2,as LOOP:2,aren’t always:2,functions So:2,think so:2,that perform:2,can turn:2,then put:2,most efficiently:2,best assembly:2,while we’re:2,we’re at:2,examples of:2,must come:2,thing and:2,often do:2,it faster:2,can’t put:2,can The:2,yourself to:2,time you:2,you sit:2,use everything:2,Memory Addressing:2,saw a:2,a store:2,Lamps he:2,Can’t you:2,the x86’s:2,do They:2,arithmetic that’s:2,useful perspective:2,perspective on:2,in BX:2,array in:2,could add:2,al bx:2,Or you:2,bx si:2,functionally interchangeable:2,context If:2,it’s generally:2,ADD instruction:2,loop however:2,addition outside:2,processors because:2,three memory:2,addressing components:2,SI 1:2,not been:2,performance hit:2,hit The:2,down so:2,free on:2,Pentium however:2,486 performance:2,issues in:2,Chapters 12:2,and 13:2,Pentium in:2,probably not:2,hear that:2,use addressing:2,arithmetic that:2,otherwise have:2,with separate:2,arithmetic instructions:2,accepts a:2,the calculated:2,memory offset:2,for comparison:2,that give:2,Two things:2,that ADD:2,doesn’t provide:2,Imagine that:2,BX to:2,result and:2,to increment:2,what we’re:2,plus two:2,add are:2,BX or:2,BP SI:2,displacement so:2,386 when:2,486 if:2,by addressing:2,6.1 Operation:2,ADD RegReg:2,RegReg vs:2,vs LEA:2,LEA Reg:2,Reg Addr:2,Addr Figure:2,LEA on:2,Pentium where:2,processors The:2,offer the:2,modes as:2,386 from:2,386 can:2,do two:2,register and/or:2,multiply any:2,two four:2,or eight:2,address as:2,Let’s see:2,that’s good:2,obvious advantage:2,LEA much:2,more generally:2,destination Figure:2,6.2 Operation:2,LEA reg:2,reg Addr:2,else can:2,values 2:2,when dealing:2,shift of:2,and shift:2,a doubly:2,yet with:2,that LEA:2,more feature:2,both base:2,and index:2,used unchanged:2,EBX by:2,following and:2,the destruction:2,works only:2,or 486:2,of values:2,values that:2,by on:2,5 8:2,ones and:2,for pointing:2,Local Optimization:2,Cycle Counting:2,not think:2,programming from:2,the Great:2,scene is:2,dead of:2,of winter:2,college students:2,a sauna:2,heater and:2,considerable risk:2,risk to:2,pipe that:2,of rocks:2,The remaining:2,the sides:2,the bucket:2,bucket of:2,their clothes:2,68 degrees:2,there it:2,degrees is:2,warm for:2,a stupid:2,world can:2,of either:2,a lack:2,is analogous:2,any function:2,function you:2,heater would:2,first of:2,suffered from:2,fundamental design:2,selection and:2,PC programming:2,Use it:2,only within:2,framework of:2,various portions:2,our quest:2,pure and:2,let’s resume:2,resume our:2,we’ll come:2,optimization it:2,instructions rather:2,instructions all:2,all with:2,you’re wondering:2,admit it:2,it When:2,Let’s examine:2,first an:2,it appears:2,LOOP does:2,CX and:2,if CX:2,when setting:2,That’s fine:2,the processors:2,processors in:2,LOOP doesn’t:2,me ask:2,byte shorter:2,things change:2,than DEC/JNZ:2,386 fetches:2,four instruction:2,is nearly:2,require that:2,used so:2,both faster:2,well By:2,way all:2,theory I’ve:2,I’ve timed:2,Things are:2,still for:2,LOOP s:2,don’t fall:2,fall victim:2,instruction has:2,isn’t already:2,of CX:2,The Lessons:2,Lessons of:2,complex task:2,necessarily faster:2,surprisingly large:2,386 protected:2,mode code:2,to rethink:2,more esoteric:2,they’re just:2,more general:2,not worth:2,going out:2,with LOOP:2,actual execution:2,486 than:2,performance levels:2,x86 instructions:2,are techniques:2,optimization It’s:2,instructions you:2,I’m saying:2,counting cycles:2,picture and:2,which assembly:2,to local:2,the 80x86:2,job is:2,or what:2,that matters:2,matters is:2,by cycle:2,learned it:2,routinely use:2,loops in:2,386/486-specific code:2,you’ll save:2,while that:2,helps a:2,which just:2,it’s zero:2,can’t even:2,get all:2,or branching:2,same principle:2,that offers:2,7.1 which:2,characters have:2,uses LOOP:2,LOOP in:2,µs on:2,with DEC:2,performance improves:2,something similar:2,slightly larger:2,could buy:2,used at:2,are surely:2,to anywhere:2,we’re about:2,different tack:2,that four:2,checked for:2,three-quarters of:2,are eliminated:2,they use:2,difference Listing:2,be unrolled:2,performance benefits:2,benefits That’s:2,it won’t:2,that algorithmic:2,algorithmic improvements:2,improvements can:2,or 100:2,improvement when:2,more by:2,stepping back:2,back a:2,can by:2,here or:2,using different:2,as building:2,than as:2,specific tasks:2,of rotating:2,shifting a:2,N in:2,OR it:2,AX as:2,follows This:2,obvious because:2,the special:2,or rotate:2,the variable:2,bits specified:2,by CL:2,number in:2,only 20:2,again we:2,example above:2,The table:2,486 However:2,addressing to:2,job in:2,illustrating the:2,this example:2,tables can:2,built at:2,optimization rule:2,from 1:2,0 That’s:2,as could:2,minor but:2,a data:2,manipulation instruction:2,MOV and:2,ROR and:2,and ROL:2,ROL which:2,Carry and:2,tasks such:2,test the:2,an operand:2,that XOR:2,modifies the:2,Understanding the:2,different ways:2,in INC:2,INC AX:2,difference The:2,that INC:2,usually a:2,the exception:2,some processors:2,while INC:2,that important:2,INC to:2,use INC:2,next If:2,code along:2,7.6 approach:2,the differences:2,to choose:2,whatever code:2,you happen:2,preserving the:2,aspects to:2,of program:2,control instructions:2,instructions like:2,and AND:2,which do:2,flags change:2,change whenever:2,a calculation:2,execute an:2,flags but:2,CX to:2,LAHF and:2,and SAHF:2,were created:2,for saving:2,restoring the:2,of caution:2,flag which:2,Also be:2,INC doesn’t:2,doesn’t set:2,that you’d:2,you’d need:2,As always:2,Terry Jacks:2,the pop:2,and spent:2,best I:2,can recall:2,lyrics were:2,often happens:2,on Me:2,Me Baby:2,Billy Don’t:2,Don’t Be:2,Be a:2,heard it:2,month or:2,so then:2,not another:2,another thought:2,for 15:2,know who:2,by The:2,I sent:2,we kicked:2,the names:2,names of:2,of old:2,big hit:2,knew that:2,The translation:2,program by:2,by converting:2,C are:2,language output:2,tweaking it:2,pure assembly:2,little or:2,or no:2,last time:2,to optimizing:2,C programs:2,programs with:2,said than:2,than done:2,readily available:2,generates is:2,thinking like:2,one form:2,discuss below:2,number 0:2,Only optimize:2,optimize where:2,most code:2,beyond that:2,I’d suggest:2,and reserve:2,complete programs:2,optimizing code:2,assembly though:2,though do:2,only where:2,final and:2,changes and:2,differently from:2,C programmers:2,programmers tend:2,how that:2,this pursuit:2,either by:2,by viewing:2,and S:2,C C:2,reusable code:2,better because:2,language level:2,slow especially:2,are expensive:2,expensive as:2,language function:2,then call:2,be unacceptable:2,move it:2,assembly you:2,can pass:2,they take:2,don’t affect:2,code they’re:2,isn’t critical:2,much code:2,work within:2,are accessed:2,from BP:2,architecture It’s:2,fairly compact:2,stack frames:2,few drawbacks:2,be constructed:2,They are:2,bias the:2,you cannot:2,cannot use:2,use BP:2,BP as:2,you intend:2,intend to:2,sometimes useful:2,mean you:2,shouldn’t use:2,frames which:2,useful and:2,not terrific:2,by leaving:2,loop But:2,far pointers:2,compiler I’ve:2,in 286:2,mode under:2,of 17:2,cycles versus:2,Do You:2,don’t generate:2,as XLAT:2,instructions On:2,rotates are:2,of circumstances:2,than equivalent:2,Writing code:2,indistinguishable from:2,than not:2,optimization consists:2,compiled C:2,Sure you:2,faster that:2,C loop:2,searches through:2,array for:2,Figure 8.1:2,8.1 Tweaked:2,Tweaked compiler:2,compiler output:2,output for:2,might look:2,all stack:2,frame access:2,you’ve used:2,explained in:2,the restricted:2,The ultimate:2,reorganize the:2,data searched:2,structures with:2,array containing:2,couldn’t be:2,searched through:2,array is:2,enough there’s:2,array elements:2,elements from:2,optimized is:2,one that’s:2,that’s easily:2,you thoroughly:2,and work:2,and potential:2,language optimizations:2,here are:2,some things:2,for when:2,Move the:2,Don’t use:2,rules to:2,That said:2,me show:2,8.1 is:2,doesn’t handle:2,example The:2,The main:2,memory blocks:2,various sizes:2,number and:2,all such:2,contains two:2,loops the:2,the outer:2,one repeating:2,repeating once:2,containing only:2,statements and:2,8.2 Linked:2,Linked array:2,array storage:2,format version:2,version 1:2,1 Figure:2,of FindIDAverage:2,generates for:2,The compiler:2,variable so:2,LOOP instruction:2,to squeeze:2,by tweaking:2,as exemplified:2,exemplified by:2,loop but:2,about all:2,a modest:2,frequency of:2,But then:2,optimization isn’t:2,Listing 8.4:2,is unrolled:2,SCASW is:2,CMP DI:2,DI AX:2,and 8088:2,step and:2,of storing:2,structures within:2,allow us:2,through each:2,Listing 8.6:2,average about:2,is I:2,of instruction-by-instruction:2,instruction-by-instruction optimization:2,is fun:2,fun but:2,can and:2,it better:2,What a:2,compiler can’t:2,tie together:2,end and:2,low end:2,in critical:2,and slightly:2,and put:2,Chapter 9:2,Odds and:2,and Ends:2,Barry who:2,behind me:2,claimed that:2,was because:2,were so:2,Earth and:2,this effect:2,Barry was:2,run that:2,to derive:2,derive the:2,though On:2,his eyes:2,a killer:2,solve this:2,the equation:2,Bourgeis shook:2,shook his:2,is either:2,either 0:2,apply this:2,balancing your:2,your checkbook:2,unfortunately that:2,a 25:2,One I:2,louder Barry:2,Barry looked:2,up into:2,into his:2,just doing:2,his best:2,solved this:2,to speak:2,him with:2,one row:2,went wild:2,have sent:2,think I:2,knew about:2,comments and:2,years So:2,a chapter:2,involve only:2,for multiword:2,to tie:2,ADC EDXECX:2,a distinct:2,pointer arithmetic:2,uses LEA:2,variable to:2,Yes I:2,point here:2,Alternatively we:2,it’s better:2,time There’s:2,all depends:2,there The:2,anywhere else:2,speed but:2,is This:2,this trick:2,you’re no:2,coming to:2,to realize:2,explain in:2,world unto:2,moving as:2,much data:2,possible a:2,faster depends:2,odd John’s:2,a penalty:2,emptying the:2,are evenly:2,evenly distributed:2,LEA s:2,be combined:2,combined to:2,perform multiplications:2,handled by:2,strung together:2,together can:2,are undoubtedly:2,still isn’t:2,is close:2,the shift:2,considerable optimization:2,a multiplication:2,operation for:2,shown above:2,early-out feature:2,of brevity:2,brevity I’ll:2,I’ll just:2,just say:2,by arranging:2,arranging your:2,no larger:2,multiplier bit:2,and immediately:2,significant bits:2,processed so:2,fewer cycles:2,multiplicand times:2,cycle for:2,significant multiplier:2,no additional:2,of 32767:2,multiply by:2,a multiplier:2,of smaller:2,holds true:2,in truly:2,time-critical code:2,code On:2,size can:2,performance due:2,386 no:2,that along:2,is smaller:2,I’m speaking:2,that’s always:2,of say:2,scale value:2,value will:2,value the:2,the REPNZ:2,string with:2,with REPNZ:2,full match:2,character as:2,The principle:2,buffer characters:2,characters won’t:2,won’t match:2,search on:2,most potential:2,entirety with:2,with REPZ:2,9.1 Simple:2,Simple searching:2,string Figure:2,Rob’s revelation:2,whole deal:2,deal is:2,SCASB matches:2,which require:2,CMPS and:2,if no:2,no match:2,Rob points:2,crops up:2,up quite:2,make more:2,then back:2,back up:2,whole string:2,occur much:2,less often:2,FindString is:2,FindString in:2,9.2 which:2,40 percent:2,386 for:2,which always:2,two versions:2,are compared:2,9.2 is:2,SCASB and:2,Listings 9.1:2,9.1 and:2,and 9.2:2,which gives:2,a doubling:2,data being:2,being handled:2,9.2 Faster:2,Faster searching:2,of character:2,in English:2,text to:2,character for:2,could well:2,table for:2,each buffer:2,be chosen:2,Or perhaps:2,perhaps not:2,not if:2,is small:2,can improve:2,is equally:2,programming by:2,recently of:2,of Borland:2,language programmers:2,a C-callable:2,of integers:2,integers in:2,in ascending:2,order That:2,That wouldn’t:2,that David’s:2,But this:2,they say:2,a 24-byte:2,him and:2,bits That’s:2,just don’t:2,divisor is:2,Divide By:2,By Zero:2,Zero interrupt:2,do when:2,is larger:2,significant word:2,dividend and:2,repeated as:2,we stop:2,divide takes:2,large dividend:2,dividend by:2,principle can:2,operation can:2,can proceed:2,time Figure:2,9.3 Fast:2,Fast multiword:2,multiword division:2,division on:2,386 As:2,by remembering:2,remembering the:2,the signs:2,dividing the:2,applying the:2,very first:2,variables within:2,the stack’s:2,stack’s sweet:2,spot the:2,to 128:2,pointer The:2,that range:2,range in:2,byte larger:2,had two:2,mode 32-bit:2,needed in:2,a variable:2,requires either:2,extra bytes:2,displacement byte:2,byte plus:2,cost a:2,increased code:2,because instructions:2,instructions must:2,frame In:2,effect It:2,in Turbo:2,C some:2,admittedly a:2,large one:2,by several:2,especially since:2,RCR and:2,take 9:2,measurements indicate:2,at 8:2,cycles apiece:2,can rotate:2,cycles However:2,reg 1:2,take 3:2,cycles just:2,9.4 Performing:2,Performing rotate:2,rotate instructions:2,instructions using:2,flag Figure:2,RCR or:2,or RCL:2,leery of:2,cycle-time documentation:2,Did you:2,not but:2,ever do:2,might then:2,think to:2,On an:2,JMP DWORD:2,DWORD PTR:2,jump takes:2,15 cycles:2,I’ve measured:2,measured for:2,is 21:2,21 cycles:2,jumps as:2,as 30:2,by so:2,Also a:2,27 cycles:2,mode I:2,no idea:2,our original:2,of jumping:2,jumping to:2,to 10005:2,Although an:2,work a:2,short program:2,it unless:2,the label:2,be created:2,created with:2,proper location:2,any actual:2,any memory:2,pass it:2,wondering how:2,out I:2,find something:2,of history:2,execute but:2,only 3:2,while takes:2,is 5:2,5 bytes:2,the MOV:2,fragments are:2,a classic:2,classic trade-off:2,speed for:2,EBX to:2,1 this:2,all 1-bits:2,XOR is:2,show how:2,of 386:2,Be warned:2,warned though:2,ADD and:2,first rule:2,action and:2,grandfather does:2,puzzle every:2,every Sunday:2,my grandfather:2,help it:2,it it:2,the voice:2,voice of:2,someone you:2,know and:2,recognize it:2,Although we:2,for granted:2,capabilities are:2,surely a:2,an incredibly:2,that computers:2,are an:2,more we:2,the serial:2,N 2:2,goes without:2,without saying:2,that pattern:2,are and:2,of coming:2,conclusions are:2,word in:2,feel like:2,of pattern:2,sense I’ve:2,For many:2,myself included:2,workable approach:2,start coding:2,programming pattern:2,I’ve always:2,Over time:2,and simply:2,time up:2,programs In:2,you through:2,that nicely:2,the wisdom:2,when faced:2,this may:2,obvious once:2,They may:2,Often however:2,the chance:2,Algorithms by:2,Sedgewick Addison-Wesley:2,Addison-Wesley which:2,which turned:2,what happened:2,pages that:2,simplest problems:2,positive integers:2,well although:2,spring to:2,and got:2,your eyes:2,and imagine:2,GCD is:2,but must:2,make here:2,it So:2,your pattern:2,a funny:2,feeling that:2,figured out:2,when reading:2,word I:2,for myself:2,are like:2,it before:2,before you’ve:2,That sort:2,can certainly:2,I fell:2,many problems:2,obvious brute-force:2,apply a:2,patience and:2,divide each:2,by every:2,see what’s:2,For most:2,after about:2,minutes of:2,they’re very:2,So when:2,apt to:2,to making:2,solutions tend:2,run just:2,I leave:2,revert to:2,brute force:2,smaller integer:2,that divides:2,take about:2,than 50:2,10.1 shows:2,As expected:2,10.1 Using:2,brute-force algorithm:2,Times are:2,10.1 for:2,with Microsoft:2,noted the:2,default optimization:2,optimization was:2,first solution:2,He then:2,of iL:2,very nature:2,number that:2,I immediately:2,iS from:2,from iL:2,iL until:2,until iL:2,to iS:2,than iS:2,indicates Listing:2,10.2 is:2,10.2 Using:2,Using repeated:2,repeated subtraction:2,subtraction algorithm:2,approach no:2,cut the:2,the worst-case:2,half for:2,optimization but:2,a hack:2,has gotten:2,was optimized:2,optimized a:2,number can:2,next page:2,one gets:2,gets by:2,by dividing:2,10.3 is:2,is superior:2,GCD determination:2,subtracting the:2,the lesser:2,commercial product:2,indeed Figure:2,10.3 Using:2,Give your:2,of important:2,still true:2,what’s even:2,best work:2,imagine how:2,be brought:2,Again though:2,stop and:2,what’s really:2,recursion to:2,operations that:2,last we’re:2,classic sense:2,Sure the:2,versions are:2,the unoptimized:2,optimizations in:2,that people:2,are lousy:2,you at:2,level with:2,you’re writing:2,breakthroughs in:2,matching than:2,oddly enough:2,better at:2,thing it’s:2,people tend:2,solutions to:2,to even:2,bog down:2,weeks for:2,person to:2,to absorb:2,reach a:2,solution and:2,a flash:2,the opportunity:2,through it:2,by lines:2,listen to:2,voice that:2,only will:2,more productive:2,those extra:2,8088 At:2,of processors:2,386 were:2,all three:2,use and:2,when optimizing:2,software This:2,came into:2,are really:2,really nothing:2,than faster:2,with very:2,functionality In:2,added a:2,whole new:2,new set:2,architectures that:2,So although:2,of computing:2,family is:2,arena The:2,while but:2,has now:2,never really:2,That leaves:2,going the:2,its relatively:2,for 32-bit:2,32-bit code:2,same general:2,general rules:2,instructions use:2,don’t branch:2,separately in:2,standard in:2,day The:2,in new:2,new systems:2,still being:2,leg of:2,in even:2,Pentium but:2,much a:2,book however:2,mode offers:2,isn’t supported:2,for protected:2,MS-DOS programs:2,indexes into:2,plain old:2,for temporary:2,temporary storage:2,or as:2,megabytes of:2,and 64:2,64 terabytes:2,of virtual:2,generally run:2,run under:2,under an:2,an operating:2,systems can:2,may depend:2,less on:2,often and:2,circumstances the:2,large a:2,taken as:2,different kettle:2,kettle of:2,of fish:2,fish altogether:2,There’s certainly:2,won’t discuss:2,Under the:2,I covered:2,4 as:2,they apply:2,one cycle-eater:2,processor both:2,both internally:2,and externally:2,externally and:2,is eliminated:2,Consequently there’s:2,byte-sized variables:2,isn’t any:2,any slower:2,would mean:2,8088 the:2,have larger:2,larger prefetch:2,16 bytes:2,instruction fetches:2,in far:2,still empty:2,down after:2,most branches:2,branches when:2,the queue:2,queue can:2,sometimes the:2,problem on:2,4 instruction:2,time versus:2,bytes fetched:2,386 also:2,in computers:2,little performance:2,386 it’s:2,it’s rarely:2,done The:2,but such:2,less common:2,clones The:2,386 systems:2,high-speed caches:2,it’s running:2,most 386:2,as what:2,data happens:2,column was:2,impossible for:2,well under:2,data isn’t:2,isn’t cached:2,this phenomenon:2,produces highly:2,our first:2,with system:2,generally has:2,store an:2,every 2:2,the one-wait-state:2,cycles Consequently:2,the six:2,bytes On:2,On top:2,to 12:2,And that:2,might add:2,above example:2,Listing 11.1:2,times MOV:2,MHz 286-based:2,chapter Listing:2,in 1.27:2,instruction just:2,extra seven-tenths:2,seven-tenths of:2,cycle comes:2,to shortly:2,It means:2,speaking the:2,perspective the:2,has two-thirds:2,that rate:2,relative of:2,is alive:2,cycle-eater but:2,rather a:2,execute those:2,still The:2,clear in:2,different memory:2,occur in:2,any computer:2,speeds on:2,particularly when:2,The extent:2,computer to:2,What’s to:2,course those:2,to 8088:2,access starting:2,address it:2,actually performs:2,byte just:2,The conversion:2,were required:2,take twice:2,one access:2,capacity of:2,cycle-eater Figure:2,11.1 The:2,your word-sized:2,inserting a:2,efficiently by:2,286 simply:2,repetition of:2,of MOVSW:2,MOVSW or:2,access That’s:2,access which:2,are word-aligned:2,in 0.64:2,has intriguing:2,intriguing implications:2,for speeding:2,blocks are:2,double performance:2,Lack of:2,instructions a:2,not There:2,only able:2,alignment of:2,target instruction:2,sound like:2,like much:2,tight loops:2,order When:2,clone to:2,to verify:2,of simple:2,simple instruction:2,11.2 Word-aligned:2,Word-aligned prefetching:2,prefetching on:2,286 Figure:2,11.3 How:2,How instruction:2,are fetched:2,fetched after:2,about 12:2,loop at:2,14 cycles:2,head for:2,two instruction:2,which resided:2,resided at:2,word-aligned word:2,another to:2,performance it’s:2,necessary and:2,performance advantage:2,Consequently it’s:2,recommend that:2,your subroutines:2,reasonable return:2,Alignment and:2,386 So:2,only discussed:2,doubleword alignment:2,alignment to:2,addresses that:2,accesses should:2,be word-aligned:2,to cross:2,doubleword-sized memory:2,word-alignment rule:2,we’ve developed:2,developed for:2,286 serves:2,it avoids:2,where just:2,entry to:2,price to:2,that improves:2,or subtracting:2,stack in:2,significantly reduce:2,of PUSH:2,and RET:2,IRET which:2,improved the:2,forcing the:2,corollary to:2,so any:2,goes for:2,PC but:2,computers in:2,few computers:2,RAM which:2,RAM so:2,same throughout:2,the PC-compatible:2,fairly small:2,nuisance since:2,but don’t:2,a blessed:2,blessed thing:2,Happily the:2,largely a:2,last of:2,2 it’s:2,local bus:2,memory during:2,given period:2,of making:2,adapter such:2,as we’re:2,faster computers:2,much much:2,accessing a:2,ms with:2,can manage:2,is anything:2,286 For:2,most display:2,adapters are:2,are 16-bit:2,automatically split:2,AT’s bus:2,is but:2,two factors:2,that reduce:2,speed with:2,computers than:2,bit different:2,you compare:2,when running:2,8088 And:2,states is:2,it’s worse:2,worse still:2,bad is:2,processor is:2,still present:2,Instructions and:2,and Features:2,Features The:2,286 has:2,386 has:2,and quite:2,with new:2,data sizes:2,We’ll discuss:2,this regard:2,regard The:2,for protected-mode:2,discuss protected:2,generally used:2,should mention:2,brings with:2,of addressable:2,addressable memory:2,each segment:2,real-mode instructions:2,quite useful:2,to high-level:2,actually relatively:2,and I/O:2,ports Finally:2,and pop:2,general-purpose registers:2,A couple:2,performed for:2,bit or:2,gigabytes per:2,in virtual-86:2,386 to:2,mode so:2,programs running:2,64K per:2,segment The:2,these new:2,new real-mode:2,386’s new:2,register containing:2,its lower:2,EBX is:2,two new:2,data on:2,it’s moved:2,0 on:2,these complex:2,are slower:2,support 32-bit:2,386 For:2,relatively simple:2,copy data:2,of 4:2,bytes on:2,Finally it’s:2,or pair:2,of memory-addressing:2,registers by:2,8 for:2,chapters In:2,with 32-bit:2,some unorthodox:2,as Windows:2,against using:2,environment such:2,Optimization Rules:2,Rules The:2,won’t go:2,short use:2,the plague:2,haven’t touched:2,touched on:2,and eliminate:2,eliminate both:2,vast difference:2,of 20:2,20 cycles:2,improvement is:2,takes from:2,mode such:2,that’s both:2,only case:2,which there’s:2,instruction while:2,while ADD:2,DX100H is:2,a 4-cycle:2,instruction—a ratio:2,of nearly:2,1 By:2,we’ve already:2,during those:2,6-byte instruction:2,instruction because:2,6 more:2,the register-only:2,of 2.5:2,1 Now:2,Now however:2,the memory-accessing:2,put our:2,ms while:2,Obviously the:2,is controlling:2,same lengths:2,it stands:2,stands to:2,to reason:2,same The:2,so code:2,instructions than:2,code consisting:2,course that’s:2,write when:2,of high-speed:2,instruction size:2,that faster:2,access and:2,more they:2,remain the:2,off In:2,tolerate interrupts:2,some code:2,have interrupts:2,disk BIOS:2,might need:2,few hundred:2,could result:2,and costs:2,can tolerate:2,view those:2,POPF workaround:2,Another reason:2,goal is:2,to reproduce:2,start is:2,POPF does:2,this purpose:2,provide any:2,own To:2,that contain:2,functionality as:2,instruction other:2,stack as:2,branches as:2,POPF so:2,word down:2,return address:2,that IRET:2,lies between:2,find on:2,the pushed:2,pushed flags:2,segmentoffset of:2,then branch:2,That’s just:2,bonus that:2,interrupts can:2,11.4 The:2,here but:2,requires both:2,an offset:2,continue with:2,with The:2,this Figure:2,11.5 The:2,of IRET:2,shrinking the:2,quickly if:2,one branch:2,alter any:2,any registers:2,and shorter:2,shorter than:2,spare the:2,286-specific instructions:2,of EMULATE_POPF:2,11.6 Workaround:2,Workaround code:2,larger slower:2,And now:2,flexibility of:2,road and:2,you guys:2,trowel and:2,days later:2,later he:2,he stops:2,happy with:2,the trowel:2,the Model:2,by again:2,80386 shovel:2,a narrow:2,emulate the:2,they really:2,the salesman:2,digging with:2,shovel the:2,the bulldozer:2,Why on:2,Lord knows:2,different the:2,quite that:2,a processor:2,processor where:2,in Kansas:2,Enter the:2,RISC chip:2,chip but:2,but other:2,example MOV:2,takes 5:2,floating-point execution:2,the 387:2,largely because:2,CPU the:2,than IMUL:2,integer multiply:2,to hit:2,touching on:2,the i486:2,lists a:2,which 486:2,optimization differs:2,for earlier:2,it being:2,most widely:2,mode at:2,more precise:2,other x86:2,Whenever both:2,instructions being:2,instructions access:2,a consistent:2,consistent and:2,interference from:2,of external:2,words for:2,precision and:2,calculations will:2,that go:2,those rules:2,addressing that:2,is try:2,use either:2,scaled addressing:2,a one-cycle:2,SI and:2,index registers:2,or none:2,context the:2,MOV DL:2,1 do:2,Therefore in:2,means adding:2,same state:2,example but:2,complex The:2,EAX EDX:2,memory All:2,this fuss:2,all on:2,486 however:2,instructions including:2,MOV ADD:2,CMP and:2,by something:2,addressing in:2,half speed:2,shown earlier:2,uses base:2,SI addressing:2,eight cycles:2,loop However:2,loop code:2,addressing makes:2,14 percent:2,key loop:2,cycle can:2,Rule 2:2,Intel states:2,ever before:2,Apparently the:2,instruction executes:2,can’t perform:2,code there’s:2,can calculate:2,MOV BXOFFSET:2,BXOFFSET MemVar:2,so pipelining:2,possible A:2,good workaround:2,use For:2,we understand:2,what Intel:2,the documentation:2,the penalty:2,for interrupting:2,calculation pipeline:2,that MOV:2,normally takes:2,cycle total:2,entire loop:2,there’s more:2,2 instructions:2,some 486:2,12.1 One-cycle-ahead:2,One-cycle-ahead address:2,pipelining Figure:2,actually starts:2,cycles ahead:2,ahead as:2,ahead the:2,written into:2,the 2-cycle-ahead:2,there’s considerable:2,potential in:2,careful rearrangement:2,rearrangement of:2,12.2 Two-cycle-ahead:2,Two-cycle-ahead address:2,pipeline interruption:2,two 486s:2,change this:2,this aspect:2,future especially:2,documentation indicates:2,Perhaps the:2,bug in:2,the optimizations:2,optimizations I:2,would hurt:2,hurt performance:2,to vanish:2,entirely correct:2,the internals:2,486 all:2,is time:2,to deduce:2,unaware of:2,reading this:2,the gospel:2,gospel truth:2,and Address:2,destination register:2,the implied:2,implies that:2,set This:2,my tests:2,involved For:2,sequence such:2,destination and:2,and addressing:2,sequence like:2,example to:2,or RET:2,loses two:2,explicit destination:2,possible combinations:2,far indicate:2,explicit operand:2,POP AX:2,ideally be:2,with Byte:2,Byte Registers:2,Registers There:2,byte registers:2,neither of:2,documented by:2,know Let’s:2,simpler of:2,Do not:2,during one:2,a source:2,example it:2,rearranging the:2,is contained:2,register value:2,not important:2,window on:2,such penalty:2,486’s pipeline:2,primarily to:2,fast core:2,logical operations:2,also often:2,to figuring:2,little value:2,instructions when:2,every corner:2,stuff for:2,key portions:2,Rule 4:2,load any:2,exactly 2:2,If any:2,takes four:2,expected three:2,not required:2,memory any:2,registers both:2,both one:2,not two:2,memory Therefore:2,truth I:2,not know:2,Whatever the:2,its interaction:2,interaction with:2,in seemingly:2,programmer would:2,or 67:2,67 percent:2,cycle before:2,produces no:2,that normally:2,of Rule:2,pipeline as:2,forcing it:2,first cycle:2,register either:2,be fine:2,warn you:2,Listings 12.1:2,12.1 and:2,and 12.2:2,I ran:2,to establish:2,ran in:2,repetition 120:2,120 ns:2,Listing 12.2:2,memory Note:2,that Listings:2,Also note:2,than 8K:2,8K internal:2,to 2000:2,sort it’s:2,good bet:2,or data:2,of cache:2,for writes:2,is though:2,it’s well:2,carefully crafted:2,do more:2,Chapter 13:2,of American:2,though We:2,what she:2,the lack:2,50 feet:2,the air:2,the enemy:2,that allow:2,a teenager:2,seek out:2,detected by:2,obvious lesson:2,optimization documentation:2,documentation available:2,50 to:2,incomplete and:2,not entirely:2,well done:2,go right:2,right on:2,of even:2,486 Pipeline:2,Pipeline Optimization:2,with source:2,code well:2,worth a:2,really fast:2,a regular:2,a thread:2,TANSTATFC There:2,Thing As:2,486 pipeline:2,I’ve yet:2,yet seen:2,for illustrative:2,illustrative purposes:2,few times:2,words but:2,as tight:2,tight as:2,no branches:2,but those:2,instructions actually:2,actually take:2,DI is:2,486’s internal:2,another two:2,takes twice:2,immediately before:2,Listing 13.2:2,five cycles:2,The load:2,of BL:2,BL is:2,separated by:2,instruction from:2,reduced from:2,cycle The:2,of DI:2,the intervening:2,13.1 Cycle-eaters:2,Cycle-eaters in:2,original WC:2,with increasing:2,potentially affected:2,point Terje:2,code simply:2,swapping the:2,loop Listing:2,not exactly:2,I’ll let:2,describe his:2,own words:2,closely as:2,this I:2,final ADD:2,ADD is:2,add it:2,loop This:2,throughput of:2,remarkable things:2,things First:2,saved in:2,up his:2,word-counting engine:2,more Listing:2,16 million:2,earthshaking but:2,what its:2,its name:2,one end:2,only work:2,obvious use:2,BSWAP is:2,significant byte:2,first in:2,memory also:2,reversing the:2,be rotated:2,ordering for:2,wrong order:2,as word:2,registers As:2,small or:2,that another:2,sure would:2,be nice:2,cases in:2,a video:2,yields the:2,conclusion that:2,be great:2,were some:2,upper and:2,and lower:2,of selected:2,as separate:2,separate 16-bit:2,next best:2,you access:2,the half:2,need at:2,particular time:2,Listing 13.5:2,values out:2,Not necessarily:2,Shifts and:2,Thus it:2,2 more:2,rotate it:2,especially considering:2,some reason:2,reason you:2,register into:2,two 16-bit:2,job but:2,the added:2,without altering:2,or popping:2,location as:2,parameters for:2,486 these:2,location takes:2,more cycle:2,is twice:2,previous contents:2,writing it:2,be executed:2,are fast:2,complex operations:2,ADC SBB:2,OR TEST:2,and PUSH:2,to rearrange:2,optimization described:2,486 the:2,n-bit forms:2,in ROR:2,default to:2,n-bit form:2,doesn’t even:2,a really:2,to assemble:2,SHL AX2:2,then look:2,program code:2,n-bit version:2,of SHL:2,SHL AX1:2,will contain:2,recommend using:2,you definitely:2,performance than:2,speed you:2,Modes The:2,486 both:2,register For:2,byte accessed:2,very powerful:2,far superior:2,superior to:2,addressing but:2,uses 32-bit:2,Any register:2,register when:2,CL EAX:2,few special:2,Intel calls:2,calls the:2,plus 1:2,cases 32-bit:2,these cases:2,10H is:2,that 1:2,of EBP:2,1 rather:2,byte the:2,the SIB:2,follows the:2,they’re needed:2,key loops:2,greater performance:2,performance I’ll:2,end this:2,First as:2,with 16-bit:2,by default:2,byte This:2,This reflects:2,EBP to:2,worth keeping:2,Lastly as:2,ESP cannot:2,done about:2,non-indexed addressing:2,register on:2,486 Chapter:2,String Searching:2,need may:2,just look:2,things a:2,point When:2,in college:2,the summer:2,a course:2,two but:2,but mostly:2,not my:2,partly for:2,will soon:2,soon become:2,my roommate:2,issue for:2,the kitchen:2,kitchen floor:2,black lines:2,background or:2,been cleaned:2,a certainty:2,cleaned it:2,or possibly:2,day my:2,basketball game:2,of hours:2,time I’ve:2,No you:2,just wasn’t:2,anyone would:2,of thing:2,really was:2,put in:2,to Boyer-Moore:2,Chapters 5:2,use some:2,of string:2,chapter If:2,j 0:2,for loop:2,loop should:2,missing something:2,searching is:2,possible match:2,one position:2,each location:2,Let’s assume:2,of different:2,the distribution:2,usually be:2,currently being:2,Only when:2,when that:2,that first:2,drop back:2,approach It’s:2,I meant:2,buffer but:2,sense and:2,the letter:2,approach when:2,every buffer:2,conditions under:2,work As:2,will match:2,Therefore if:2,least common:2,letter in:2,decrease the:2,to drop:2,time will:2,become very:2,go from:2,the match:2,location If:2,distance to:2,is N:2,searching at:2,get any:2,Can we:2,Actually yes:2,above but:2,we acquire:2,we check:2,is based:2,already implicitly:2,locations that:2,makes your:2,thinking which:2,easily understood:2,implemented and:2,highly effective:2,start offset:2,match on:2,on C:2,C the:2,a Z:2,pattern doesn’t:2,0 but:2,possibly match:2,pattern can:2,location from:2,and continue:2,two comparisons:2,partial match:2,only skip:2,from high:2,high memory:2,go after:2,all we’re:2,we’re comparing:2,another set:2,in what:2,would we:2,leftmost character:2,us about:2,the possibilities:2,the mismatched:2,mismatched character:2,doesn’t appear:2,one potential:2,but have:2,they overlap:2,belong in:2,ahead by:2,full pattern:2,can outperform:2,search when:2,character that’s:2,pattern Figure:2,a partial:2,mismatch occurs:2,occurs with:2,14.1 Mismatch:2,checked Figure:2,location but:2,to whatever:2,pattern with:2,right as:2,right across:2,eliminate as:2,a possible:2,a matching:2,atop the:2,it Figure:2,14.2 Mismatch:2,on third:2,third character:2,The Good:2,the Bad:2,The worst:2,time Again:2,are fewer:2,patterns which:2,diffuse the:2,14.3 Mismatch:2,in pattern:2,comparisons are:2,buffer length:2,Boyer-Moore Listing:2,14.1 is:2,Boyer-Moore searching:2,first 32K:2,32K of:2,with Turbo:2,Profiler on:2,come close:2,for long:2,of searching:2,searching techniques:2,SCASB on:2,7.5 7.5:2,Standard Boyer-Moore:2,handling of:2,ASM Listing:2,refers to:2,slower in:2,and slow:2,heck isn’t:2,the trap:2,of figuring:2,figuring that:2,every location:2,observation that:2,apply the:2,nice tight:2,implementing a:2,algorithm you:2,buffer as:2,unroll the:2,optimizations is:2,skip table:2,time could:2,passing a:2,Here we’ve:2,any new:2,needed was:2,it You:2,know it:2,it Chapter:2,Linked Lists:2,makes me:2,your enlightenment:2,first real:2,Okay maybe:2,good programmer:2,wasn’t it:2,it goes:2,Jeannie Schweigert:2,and she:2,she was:2,four feet:2,feet tall:2,approximately as:2,us could:2,never actually:2,the prospect:2,my father:2,father was:2,I walked:2,her to:2,to calm:2,business and:2,and eventually:2,a child:2,the mind:2,with her:2,that stuff:2,more When:2,something new:2,little knowledge:2,the learning:2,help speed:2,The Art:2,Art of:2,where was:2,a head:2,and creativity:2,part but:2,waste the:2,so smart:2,smart that:2,a lifetime:2,I sure:2,of discrete:2,joined together:2,are typically:2,the strengths:2,sequential processing:2,nodes of:2,up space:2,to backtrack:2,doubly linked:2,need more:2,maintain the:2,aren’t very:2,bubble sorts:2,depend on:2,don’t provide:2,Likewise you:2,for applications:2,fill function:2,order and:2,sorted order:2,lists work:2,with linked:2,handled with:2,all linked:2,filling polygons:2,polygons For:2,in polygon:2,1991 issue:2,following optimizations:2,that column:2,Sedgewick or:2,a moment’s:2,Heck I:2,look it:2,with for:2,straightforward as:2,first node:2,node which:2,last node:2,pointer Conceptually:2,nothing could:2,are serious:2,this model:2,model The:2,The fundamental:2,link manipulation:2,manipulation In:2,Listing 15.1:2,pointer which:2,NextNode field:2,special code:2,and extra:2,I’ll grant:2,grant you:2,you make:2,the next-node:2,the LinkNode:2,could successfully:2,an ugly:2,next Figure:2,15.1 The:2,same place:2,by casting:2,base link-node:2,specify the:2,the linked-list:2,node rather:2,this node:2,a singly:2,special-case code:2,those approaches:2,approaches work:2,far better:2,I invented:2,I encountered:2,during my:2,by spending:2,Sedgewick’s book:2,15.2 Using:2,dummy head:2,and tail:2,tail of:2,node on:2,this scheme:2,Although it:2,operation on:2,same operation:2,list terminated:2,node of:2,a giant:2,giant step:2,through such:2,list has:2,node containing:2,containing a:2,value field:2,two tests:2,we make:2,The list:2,to satisfy:2,the pike:2,streamlined to:2,one test:2,Listing 15.5:2,benefits are:2,do Figure:2,15.3 Representing:2,Representing an:2,15.4 List:2,List terminated:2,terminated by:2,Use a:2,single node:2,the head/tail:2,node can:2,course be:2,Why am:2,so fond:2,it saves:2,economy of:2,must admit:2,look in:2,in considerable:2,considerable detail:2,Look it:2,turning on:2,and 15.6:2,for maintaining:2,value Listing:2,per node:2,are simple:2,Make it:2,a habit:2,habit to:2,15.5 Representing:2,Representing a:2,my PC:2,the Envelope:2,I passed:2,along one:2,Write a:2,greatest or:2,smallest unsigned:2,unsigned int:2,challenge was:2,coming at:2,me from:2,my correspondents:2,has yet:2,missed a:2,you’re missing:2,I get:2,my readers:2,And if:2,Thing as:2,the Fastest:2,I remember:2,remember reading:2,development tools:2,PC Week:2,corporate buyers:2,looked like:2,Windows development:2,not saying:2,is everything:2,isn’t even:2,Ye gods:2,talking here:2,to New:2,plane because:2,would choose:2,buy a:2,particularly attractive:2,people with:2,a Hurry:2,this At:2,least we:2,that very:2,however in:2,would but:2,I issued:2,optimization challenge:2,in 1991:2,some pretty:2,all his:2,while an:2,properly and:2,was fast:2,for him:2,Pascal code:2,more comfortable:2,C so:2,count program:2,translated to:2,I left:2,few details:2,details such:2,Table 16.1:2,4.6 seconds:2,stored on:2,a RAM:2,was compiled:2,partly to:2,speed rather:2,seconds 16.2:2,C ASM:2,1.6 seconds:2,contains an:2,good return:2,straightforward translation:2,makes good:2,0 it’s:2,only 10:2,this What:2,than whether:2,table Listing:2,this represents:2,seconds which:2,in succession:2,indexed by:2,with MOV:2,Finally if:2,avoid an:2,back into:2,branch every:2,Not hardly:2,me it’s:2,least three:2,three ways:2,to reading:2,jumps to:2,One possible:2,possible optimization:2,a last:2,extremely difficult:2,put to:2,TECHNIQUES was:2,replace Listing:2,winner and:2,submissions had:2,plug-compatible with:2,to encourage:2,people not:2,didn’t want:2,functions that:2,by six:2,So how:2,stack up:2,three-times speedup:2,speedup over:2,You are:2,I consider:2,be significant:2,made faster:2,from many:2,table that:2,bytes simultaneously:2,possible is:2,Case in:2,Terje Mathisen’s:2,who I:2,I introduced:2,Terje’s program:2,he posted:2,That code:2,the ring:2,ring of:2,critical inner:2,was indeed:2,zero at:2,point a:2,an earlier:2,index addressing:2,good fortune:2,fortune to:2,CMP reg:2,takes 6:2,CMP mem:2,mem reg:2,they’re both:2,case though:2,assumptions that:2,second lesson:2,over your:2,in no:2,shape to:2,a hundred:2,enable us:2,the complexities:2,familiar code:2,third and:2,interesting lesson:2,counting is:2,He said:2,old version:2,and word:2,than 3:2,486 Even:2,allowing for:2,very impressive:2,faced was:2,faster approaches:2,of Terje’s:2,a 5:2,the rut:2,rut of:2,of cycle:2,and lets:2,comes in:2,it happened:2,happened the:2,readers was:2,entries I:2,winning entry:2,a starting:2,that kind:2,software or:2,Stafford who:2,for Borland:2,Borland International:2,and Mick:2,know nothing:2,an extremely:2,extremely good:2,out ahead:2,was twice:2,each entry:2,first value:2,second value:2,time actually:2,actually spent:2,The top:2,word-counting entries:2,table-driven state:2,faster code:2,most demanding:2,chance for:2,and stop:2,be noticed:2,harm but:2,nonetheless a:2,a waste:2,waste of:2,framework is:2,level 1:2,word rather:2,than 64K:2,step to:2,only upon:2,Another useful:2,a remarkable:2,remarkable variety:2,you unrolled:2,other with:2,detect the:2,of unrolling:2,unrolling a:2,set CX:2,the unrolled:2,count down:2,the unrolling:2,perform whatever:2,of LODSW:2,since with:2,looping is:2,branches used:2,entirely The:2,branching is:2,longer necessary:2,maintain a:2,Listing 16.6:2,illustrates a:2,optimizations the:2,approach the:2,Together these:2,for zero:2,used Nonetheless:2,so of:2,performance at:2,This level:2,Level 2:2,A New:2,stepped back:2,code actually:2,and implemented:2,up of:2,a state:2,word state:2,counting a:2,word if:2,current byte:2,splitting the:2,code up:2,efficient because:2,work required:2,those things:2,detected the:2,program would:2,have needed:2,of New:2,a hardware:2,it My:2,branches in:2,I noticed:2,values will:2,or ends:2,divides the:2,also possible:2,The boundaries:2,boundaries between:2,the levels:2,level 2:2,patterns of:2,to processing:2,we usually:2,in coding:2,few people:2,I present:2,he sent:2,a massive:2,that processes:2,unusual way:2,include file:2,a location:2,is simplicity:2,simplicity itself:2,his implementation:2,places where:2,can instantly:2,sequence The:2,the separator/not:2,and turn:2,turn them:2,count word:2,don’t count:2,status for:2,table based:2,David is:2,each pair:2,carry status:2,adding in:2,0 value:2,that table:2,table A:2,perform all:2,16.1 The:2,potential word:2,count locations:2,to setting:2,looked up:2,as desired:2,16.2 Looking:2,Looking up:2,count status:2,in David’s:2,64 times:2,I lack:2,discuss Listing:2,the pleasure:2,pleasure of:2,remarkable code:2,will say:2,say one:2,more thing:2,thing though:2,The cycle:2,at around:2,chapter I’d:2,previously and:2,and supports:2,also happens:2,table on:2,the EXE:2,and according:2,less time:2,written the:2,of San:2,code at:2,his design:2,design but:2,be fun:2,real work:2,Chapter 17:2,The Game:2,Optimization in:2,optimization which:2,this opportunity:2,necessary if:2,you’re looking:2,improved but:2,a thousand:2,your algorithm:2,new approaches:2,root of:2,old hat:2,your hand:2,Or is:2,performance programmers:2,While I’m:2,basic optimization:2,latter category:2,discuss some:2,find is:2,assembly It’s:2,It’s all:2,Game The:2,is neat:2,graphics topic:2,eye-catching dazzle:2,straightforward implementation:2,many many:2,Life and:2,they illustrate:2,First I’ll:2,version in:2,different approaches:2,assembly This:2,be patient:2,40 times:2,times speed-up:2,I’ll show:2,programmers really:2,me up:2,my second:2,second Optimization:2,involved the:2,is ridiculously:2,cells each:2,initially be:2,Each cell:2,vertically and:2,generation it:2,stays on:2,turns off:2,off If:2,exactly three:2,on neighbors:2,otherwise it:2,stays off:2,off That’s:2,rise to:2,patterns that:2,complicated to:2,Listing 17.2:2,object that’s:2,set each:2,of neighboring:2,neighboring on-cells:2,the cell’s:2,current state:2,state The:2,complication is:2,final result:2,before we’re:2,as molasses:2,the Time:2,17.1 shows:2,are for:2,1000 generations:2,second with:2,a 200x200:2,200x200 cellmap:2,Listings 17.1:2,17.1 and:2,you one:2,place where:2,was considerable:2,any drawing:2,target address:2,be among:2,Wrong wrong:2,wrong wrong:2,than calculating:2,in how:2,our Game:2,and next_generation:2,to redraw:2,when their:2,and eliminating:2,operations is:2,a potent:2,optimization technique:2,useful a:2,Advantages of:2,By writing:2,tempting to:2,cell_state is:2,taking all:2,assembly but:2,out why:2,Once you:2,are highly:2,wonderful thing:2,general it:2,programming time:2,Having said:2,working at:2,optimize your:2,algorithm from:2,the abstraction:2,us is:2,with eight:2,independent operations:2,to cell_state:2,of cell:2,mask In:2,the addresses:2,and masks:2,very easily:2,and shifts:2,of neighbors:2,neighbors for:2,for cells:2,cells at:2,wrapping is:2,enabled so:2,other edge:2,could improve:2,would slow:2,17.1 Edge-wrapping:2,Edge-wrapping complications:2,doesn’t lend:2,itself well:2,cellmap in:2,the padding:2,a hard-wired:2,all But:2,take time:2,notice it:2,or hundreds:2,17.3 shows:2,function This:2,not making:2,17.3 is:2,vast improvement:2,17.2 The:2,The padding:2,padding cells:2,cells solution:2,a multiple:2,to facilitate:2,of copying:2,exchange for:2,performance That’s:2,often not:2,more heavily:2,general you:2,three functions:2,also have:2,17.3 we’ve:2,we’ve gotten:2,the hood:2,and changed:2,impressive results:2,is hard-wired:2,hard-wired for:2,would actually:2,as our:2,decided it:2,C optimizations:2,Right now:2,some C:2,17.3 Listing:2,same the:2,next_generation is:2,brought into:2,and from-scratch:2,from-scratch address/mask:2,address/mask calculations:2,directly via:2,eliminating all:2,calculations The:2,we’ve achieved:2,speed to:2,especially with:2,far we:2,tremendous improvement:2,possible that:2,usage and:2,register variables:2,or C:2,real McCoy:2,next section:2,How is:2,possible cellmap:2,up about:2,can speed:2,another four:2,First I:2,levels from:2,late in:2,encourage you:2,with everything:2,performance considerably:2,considerably by:2,by making:2,abstract and:2,bytes off:2,that pointer:2,up looking:2,of The:2,new generation:2,otherwise an:2,is turned:2,turned on:2,an off-cell:2,to arrange:2,things so:2,count neighbors:2,cell state:2,cellmaps and:2,and lots:2,possible approaches:2,Step back:2,problem The:2,possible that’s:2,one possible:2,possible implementation:2,changed and:2,vast majority:2,cells change:2,previous generation:2,where I’m:2,whisper of:2,original implementation:2,eight operations:2,Suppose now:2,generation to:2,The actual:2,map format:2,state but:2,shows this:2,what about:2,cell changes:2,17.3 New:2,New cell:2,cell format:2,get another:2,said earlier:2,generation This:2,no neighbors:2,on Since:2,map representation:2,for non-zero:2,counts and:2,REPZ SCASB:2,the neighbor-count:2,and scans:2,4.5 times:2,ignoring the:2,time consumed:2,consumed by:2,true even:2,be compiled:2,in seeing:2,200x200 cellmaps:2,worked around:2,segment in:2,be efficiently:2,implemented with:2,some clever:2,data processing:2,models and:2,segments and:2,Otherwise you:2,find you’re:2,bit simpler:2,To some:2,around from:2,main reason:2,management and:2,it’s done:2,a whit:2,whit of:2,a 30-times:2,little of:2,and processing:2,data itself:2,words we’ve:2,we’ve done:2,the creative:2,No doubt:2,The Challenge:2,I laid:2,didn’t care:2,about time:2,the call:2,could modify:2,produce exactly:2,output as:2,all circumstances:2,be eligible:2,eligible to:2,long in:2,the video-related:2,C in:2,and were:2,did I:2,I realize:2,lay on:2,on me:2,some were:2,run and:2,or maybe:2,maybe the:2,What did:2,To find:2,the shape:2,I quickly:2,we came:2,cut across:2,the corner:2,the rear:2,his way:2,see who:2,Actually it:2,upon the:2,had broken:2,record for:2,100 meters:2,this First:2,for programming:2,the stunning:2,see at:2,life on:2,that Intel’s:2,to but:2,the flip:2,flip side:2,side is:2,are technically:2,raw performance:2,software you:2,you implement:2,left with:2,any question:2,same pixels:2,the entries:2,that standard:2,Some didn’t:2,colors or:2,support all:2,widths and:2,and heights:2,particular implementation:2,implementation This:2,This last:2,a brilliant:2,fastest submissions:2,engine itself:2,I to:2,but fully:2,fully compliant:2,compliant entries:2,whose entry:2,first Optimization:2,is slightly:2,is impossible:2,they’re the:2,both more:2,my final:2,mea culpa:2,lay a:2,just another:2,anyone has:2,by means:2,table The:2,fly as:2,build process:2,himself one:2,one better:2,only does:2,is write:2,equivalent of:2,a Life:2,general-purpose program:2,run for:2,screen However:2,perform All:2,of QLIFE:2,file used:2,build QLIFE:2,QLIFE Listing:2,certainly won’t:2,intricacies of:2,over these:2,these listings:2,apart because:2,of neat:2,operates at:2,may ever:2,build and:2,output to:2,almost impossible:2,C but:2,too difficult:2,Sets the:2,grid to:2,to 96:2,96 cells:2,the height:2,Turns off:2,have selected:2,to exit:2,finished This:2,N generations:2,generations under:2,QLIFE with:2,program from:2,may make:2,then it:2,bug is:2,no trouble:2,features that:2,they’re a:2,best if:2,are dead:2,or have:2,by maintaining:2,list that:2,of pointers:2,that change:2,those cells:2,cells and:2,their neighbors:2,are too:2,this generation:2,blame me:2,packed into:2,is convenient:2,cell array:2,size but:2,grid and:2,gets more:2,from zero:2,zero to:2,to eight:2,seven neighbors:2,cell word:2,reflect this:2,has at:2,never needs:2,18.1 Cell:2,Cell triplet:2,triplet storage:2,which changes:2,counts for:2,same word:2,builds the:2,routines on:2,byte contains:2,pass we:2,word AND:2,pass and:2,8 of:2,1 on:2,isn’t needed:2,purposes because:2,edge flag:2,flag bit:2,bits the:2,I use:2,changes are:2,are necessary:2,generation In:2,constructed so:2,that triplet:2,Then if:2,desired state:2,list again:2,summarized in:2,now in:2,don’t blame:2,I felt:2,simple though:2,setting it:2,new state:2,drawing it:2,routine for:2,of state:2,triplet and:2,word masking:2,lower 9:2,9 bits:2,He does:2,list When:2,changed cell:2,triplet David:2,looks at:2,affected neighbors:2,tests for:2,this condition:2,using each:2,each potentially:2,states If:2,don’t match:2,minimum possible:2,possible number:2,triplet in:2,a 1-bit:2,process the:2,all potentially:2,Alas I:2,close this:2,my pleasure:2,pleasure to:2,said This:2,programming I:2,someone who:2,magnitude more:2,correspondingly more:2,went by:2,died and:2,ever more:2,around I:2,had written:2,had learned:2,black art:2,art of:2,Unfortunately by:2,286 was:2,coming on:2,on strong:2,strong and:2,was less:2,it surely:2,cache that:2,and careful:2,Return of:2,and filled:2,optimization hazards:2,exceptions to:2,about them:2,its predecessors:2,because more:2,any previous:2,Pentium’s performance:2,second execution:2,pipe is:2,486 at:2,dual 8K:2,8K caches:2,kick in:2,algorithmic and:2,It’s been:2,style and:2,Pentium In:2,Trust me:2,a secret:2,you with:2,of classic:2,classic rock:2,listened to:2,to back:2,and regular:2,go away:2,next the:2,the sound:2,while on:2,is vastly:2,differences are:2,Pentium’s architecture:2,for understanding:2,understanding exactly:2,how code:2,not transparent:2,full 486:2,single chip:2,chip The:2,pipe or:2,U-pipe the:2,more limited:2,V-pipe The:2,instructions simultaneously:2,separate write:2,those for:2,486 although:2,although some:2,My first:2,hearing of:2,to wonder:2,bytes can:2,doesn’t allow:2,in practice:2,with data:2,all Pentium:2,incompatibilities with:2,are separate:2,be driven:2,a tight:2,tight loop:2,In conjunction:2,properly at:2,Pentium that:2,a healthy:2,One is:2,cache lines:2,that spans:2,line there’s:2,second is:2,line size:2,causes a:2,a longer:2,be placed:2,runs twice:2,data bytes:2,bandwidth to:2,heavily dependent:2,caches the:2,the caches:2,the superior:2,won’t affect:2,you program:2,the sizes:2,sizes of:2,cache hit:2,hit rate:2,to Pentium:2,50 or:2,V-pipe on:2,been executed:2,critical loops:2,loops to:2,One change:2,do have:2,a trivial:2,it properly:2,properly In:2,the meantime:2,references for:2,superscalar programming:2,other Pentium:2,information are:2,Intel’s Pentium:2,Processor User’s:2,User’s Manual:2,two other:2,but simply:2,put this:2,32-byte cache:2,little harder:2,working set:2,cache can:2,BIOS or:2,operation This:2,internal data:2,variables such:2,cheap as:2,discussed earlier:2,there in:2,Pentium the:2,slow down:2,instructions away:2,sequence takes:2,attempt was:2,more challenging:2,challenging and:2,game in:2,and More:2,calculate a:2,take any:2,very attractive:2,arithmetic instruction:2,multiplied by:2,through either:2,multiplication by:2,that unlike:2,doesn’t modify:2,As on:2,not cross:2,cross any:2,necessary Word:2,be dword-aligned:2,dword-aligned and:2,branch targets:2,argument for:2,might make:2,Pentium cache:2,usage but:2,branch target:2,loop or:2,segment overrides:2,overrides LOCK:2,the 0FH:2,set with:2,The exceptions:2,exceptions are:2,At a:2,and shuts:2,shuts down:2,two normal:2,cycles can:2,can overlap:2,or 32-bit:2,operands in:2,16-bit segment:2,or vice:2,vice versa:2,significantly slower:2,should generally:2,although if:2,although they:2,should if:2,locks the:2,and requires:2,The cost:2,a hidden:2,the XCHG:2,with video:2,write VGA:2,now a:2,XCHG with:2,memory if:2,discrete instructions:2,of AND:2,Chapter 21:2,target register:2,particular case:2,AND or:2,shut down:2,potential dependencies:2,the AND:2,from no:2,whereby the:2,on past:2,way or:2,the guess:2,correct the:2,branch or:2,or fall-through:2,fall-through takes:2,a fall-through:2,fall-through on:2,cycles more:2,prediction is:2,simple reason:2,to spare:2,go for:2,bigger than:2,loops so:2,then too:2,other code:2,code out:2,you absolutely:2,loop then:2,especially the:2,and watch:2,exactly when:2,Intel has:2,endeavor to:2,through branches:2,safe bet:2,an equally:2,branch that:2,and mispredicted:2,be Not:2,potentially execute:2,execute during:2,instructions if:2,through but:2,sure whether:2,optimization because:2,be certain:2,you measure:2,then it’s:2,All I:2,can say:2,has all:2,determine what:2,a compare:2,a reason:2,Pentium Optimization:2,Pentium optimizations:2,hurt on:2,discuss various:2,in complete:2,complete detail:2,code paths:2,the 486/Pentium:2,what will:2,possible performance:2,Pentium’s second:2,win and:2,programs in:2,more cache:2,even slower:2,better job:2,hearing how:2,certainly have:2,they play:2,upon which:2,compiler that:2,day Chapter:2,West Coast:2,animated discussion:2,educational software:2,the hottest:2,company that:2,point was:2,get off:2,was growing:2,money in:2,very successful:2,successful game:2,game company:2,and game:2,left a:2,computer so:2,wife and:2,Back then:2,was wide:2,about every:2,were having:2,We were:2,Market Street:2,Street in:2,in San:2,San Francisco:2,against a:2,Fifty-dollar bill:2,us for:2,every few:2,said it:2,than he:2,he did:2,did we:2,context is:2,tricks that:2,years are:2,what amounts:2,optimized Pentium:2,are that:2,the FXCH:2,FXCH instruction:2,is expensive:2,we delve:2,quick tour:2,cycle This:2,the sole:2,two integer:2,integer execution:2,operate on:2,and whenever:2,The U-pipe:2,Pentium’s instruction:2,A number:2,pipes at:2,though you:2,such instructions:2,U-pipe instructions:2,model as:2,all instructions:2,working as:2,V-pipe is:2,rotation or:2,20.1 The:2,pipes Figure:2,instructions executing:2,is trickier:2,trickier than:2,small subset:2,set but:2,also because:2,are able:2,a stream:2,instructions going:2,U and:2,and V-pipes:2,that take:2,V-pipe out:2,practice this:2,not too:2,of rules:2,The place:2,purposes the:2,unit is:2,bytes after:2,a U-pipe:2,finishes before:2,20.2 is:2,execution is:2,not listed:2,use SHR:2,hand you:2,see similar:2,different performance:2,is once:2,sends the:2,waits until:2,done then:2,are met:2,V-pipe if:2,if address:2,address contains:2,instructions used:2,but both:2,to push:2,push a:2,perform this:2,execute simultaneously:2,to break:2,instructions then:2,contention I’ll:2,20.2 Instruction:2,Instruction flow:2,downside of:2,Figure 20.3:2,20.3 Pushing:2,memory effectively:2,long with:2,with proper:2,interleaving the:2,1.5 cycles:2,to approximately:2,both performance:2,basis the:2,may wonder:2,wonder why:2,pipe with:2,with equal:2,be paired:2,not provide:2,that instructions:2,However any:2,ADD EBX:2,its instruction:2,work or:2,which means:2,two-cycle instructions:2,should in:2,mostly one-cycle:2,20.4 Lockstep:2,Lockstep execution:2,and idle:2,idle time:2,why The:2,fully capable:2,necessary in:2,continues processing:2,also has:2,is frequently:2,memory which:2,execution The:2,another so:2,cycle If:2,cache bank:2,attention to:2,same values:2,values for:2,20.5 The:2,Pentium’s eight:2,eight bank:2,bank data:2,bank as:2,is because:2,below This:2,everything we’ve:2,about its:2,explicit memory:2,memory instructions:2,only pairable:2,branches that:2,We’ve already:2,executes a:2,memory instruction:2,ADD EAX:2,cycles You:2,then neither:2,that turns:2,destination operands:2,pair and:2,of overlap:2,sure but:2,but I’d:2,I’d guess:2,pairs with:2,20.6 Non-overlapped:2,Non-overlapped lockstep:2,execution Figure:2,20.7 Interleaving:2,Interleaving simple:2,in progress:2,ask why:2,why it’s:2,operations as:2,first know:2,that until:2,happen until:2,cycle after:2,that these:2,pair so:2,takes the:2,seen is:2,the subject:2,subject of:2,chapter in:2,about superscalar:2,Pentium’s relatively:2,small register:2,registers I:2,registers More:2,still is:2,keep two:2,registers at:2,is difficult:2,that prefixes:2,exception of:2,happen while:2,As I’ll:2,my experiments:2,multiple-cycle instructions:2,you still:2,prefixed instruction:2,following instruction:2,effectively taking:2,instruction taking:2,byte long:2,a category:2,category that:2,Knowing this:2,reveals that:2,seems it:2,timing is:2,clear by:2,are working:2,think they:2,involved for:2,working properly:2,true than:2,20.8 Prefix:2,Prefix delays:2,delays Figure:2,suggested that:2,resemblance to:2,me any:2,Anyway my:2,the selection:2,be described:2,category and:2,spent the:2,last two:2,good without:2,without understanding:2,the fundamentals:2,well It’s:2,enough though:2,we’ll do:2,we explored:2,instructions could:2,which pipes:2,various stages:2,stages of:2,overlapping of:2,previous one:2,finished The:2,AGIs are:2,been performed:2,Pentium so:2,can begin:2,for AGIs:2,you modify:2,cycle or:2,register was:2,was true:2,a stall:2,a sharp:2,eye out:2,for them:2,also means:2,often worth:2,actual use:2,21.1 An:2,stall up:2,AND EBXEBX:2,well because:2,modify EBX:2,21.2 An:2,can cost:2,cost as:2,are special-cased:2,modify ESP:2,ESP to:2,most expensive:2,something as:2,potentially be:2,and six:2,have never:2,Register Contention:2,last major:2,We saw:2,contention is:2,primary reason:2,get maximum:2,comprising the:2,not cause:2,ESP only:2,only implicitly:2,neither do:2,cause register:2,six instructions:2,call or:2,V-pipe idle:2,jumps take:2,example and:2,not hard:2,forward from:2,from there:2,U-pipe The:2,U-pipe markers:2,implementing the:2,the TCP/IP:2,bit so:2,of exactly:2,this snippet:2,We should:2,the ADD:2,ADC AX0:2,ADD AX:2,AX ESI:2,my surprise:2,surprise that:2,actually takes:2,that adding:2,a size:2,cost anything:2,is change:2,What next:2,doesn’t really:2,anything in:2,still takes:2,data bank:2,and ESI:2,21.3 is:2,code tends:2,more registers:2,Again note:2,contention and:2,so we’ve:2,an improvement:2,general if:2,unlikely that:2,any real-world:2,faster yet:2,Listing 21.4:2,An obvious:2,considerable complexity:2,dword accesses:2,problems by:2,assumptions are:2,dictated by:2,by processing:2,cycle Listing:2,demonstrating that:2,still has:2,left in:2,21.5 is:2,write as:2,hand it’s:2,six times:2,in overall:2,claim that:2,more time:2,loop iteration:2,really really:2,fine on:2,so well:2,21.1 runs:2,21.5 runs:2,word a:2,As is:2,helped the:2,other processors:2,it helped:2,Taking a:2,now at:2,course need:2,need no:2,having just:2,chapters learning:2,learning about:2,find this:2,stay ahead:2,We’ll start:2,and bits:2,at many:2,excellent book:2,that’s designed:2,buffer with:2,mine The:2,22.1 is:2,that ClearS:2,that mean:2,is hardly:2,begin with:2,serves no:2,reload it:2,for cases:2,through BX:2,DI directly:2,chapter by:2,would serve:2,by clearing:2,code That’s:2,much it:2,for simple:2,instruction optimizations:2,optimizations Now:2,seems strange:2,strange to:2,then throw:2,necessary because:2,All it:2,byte addressed:2,addressed relative:2,BP into:2,into AH:2,AH and:2,turned two:2,accesses as:2,well Listing:2,of yet:2,specification for:2,loads and:2,on Let’s:2,keep it:2,check to:2,comparison and:2,reduced the:2,our minds:2,frame or:2,or set:2,designers of:2,stack with:2,it’s true:2,can it:2,that There:2,That’s easily:2,easily solved:2,the return:2,address into:2,register then:2,we’ll also:2,removing them:2,the Zenned:2,Zenned version:2,the bare:2,bare metal:2,but an:2,good one:2,Heart of:2,graphics standard:2,lingua franca:2,franca of:2,No other:2,other graphics:2,the 50000000:2,50000000 or:2,and virtually:2,sold today:2,VGA compatibility:2,course a:2,indeed it:2,is becoming:2,no standard:2,programs for:2,largest possible:2,market for:2,really understand:2,down cold:2,graphics at:2,first eight:2,chapters of:2,VGA after:2,about everything:2,read through:2,please keep:2,start our:2,dive right:2,a taste:2,taste of:2,PC compatibles:2,of documented:2,to 640x480:2,640x480 with:2,colors per:2,Chapters 31-34:2,31-34 and:2,and 47-49:2,code discussed:2,VGA compatible:2,this odd:2,that’s surely:2,tens of:2,of millions:2,can drive:2,selecting a:2,they become:2,in IBM’s:2,documentation and:2,meet your:2,VGA for:2,tools the:2,to combine:2,An Introduction:2,lists of:2,I’ll get:2,that eventually:2,several other:2,adapter the:2,makes you:2,getting a:2,process Listing:2,explain how:2,ball is:2,and horizontal:2,color plane:2,demonstrate the:2,Controller GC:2,been designed:2,of I/O:2,EGA each:2,separate chip:2,EGA compatibility:2,blocks has:2,why a:2,together make:2,interest to:2,the means:2,which most:2,which registers:2,indexed registers:2,The internal:2,0FFH to:2,registers through:2,entire VGA:2,are located:2,located at:2,plus one:2,3C0H and:2,to Index:2,Index mode:2,every read:2,register 3DAH:2,3DAH when:2,Index/Data register:2,register 3C0H:2,write with:2,AC Data:2,read/write GC:2,read/write CRTC:2,the former:2,point DX:2,desired Index:2,at 3C0H:2,separate byte:2,safe is:2,trouble with:2,however all:2,been fixed:2,or VGA:2,s could:2,considered a:2,a clone:2,The setting:2,register remains:2,is reprogrammed:2,in cases:2,internal register:2,register once:2,set repeatedly:2,lines The:2,MOV DX03CEH:2,DX03CEH point:2,register MOV:2,MOV AL8:2,AL8 internal:2,of Bit:2,register OUT:2,contains Bit:2,Alternatively the:2,register Of:2,is each:2,byte controls:2,adds a:2,memory need:2,logical screen:2,width and:2,physical screen:2,window onto:2,screen could:2,drawing for:2,hardware for:2,four linear:2,linear planes:2,provides special:2,special hardware:2,to assist:2,time switching:2,which maps:2,colors as:2,VGA’s color:2,BIOS supports:2,modes 4:2,be organized:2,true VGA:2,use them:2,powerful in:2,in true:2,single linear:2,book that’s:2,us an:2,fonts are:2,are another:2,another matter:2,we’ll touch:2,23.1 Video:2,Video data:2,pixel Figure:2,that background:2,program shown:2,before continuing:2,will mean:2,if you’ve:2,you’ve seen:2,uses only:2,37.5K per:2,is room:2,screen than:2,actually displayed:2,a resolution:2,The area:2,screen actually:2,displayed at:2,register 0CH:2,the CRTC:2,to 80H:2,8000H in:2,23.2 Video:2,Video memory:2,memory available:2,progresses from:2,effect the:2,screen appears:2,it advances:2,matter than:2,words or:2,screen width:2,screen height:2,in scan:2,registers select:2,the row:2,that maps:2,be increased:2,two The:2,the column:2,column that:2,display as:2,panning although:2,coarse byte-sized:2,by eight:2,Up to:2,7 pixels:2,pixel panning:2,possible via:2,5 6:2,and 7:2,bit bit:2,source of:2,displayed pixels:2,normal operation:2,not come:2,solid color:2,register should:2,to palette:2,always set:2,setting palette:2,RAM can:2,function can:2,mask incompatibilities:2,assistance for:2,manipulating the:2,control which:2,bytes—one from:2,write The:2,by CPU:2,If bit:2,CPU will:2,writes will:2,affect plane:2,CPU access:2,Any of:2,be selected:2,images can:2,three planes:2,planes from:2,plane from:2,is zeroed:2,A better:2,program writes:2,colored ball:2,by enabling:2,destination plane:2,plane selected:2,as consisting:2,a multicolored:2,multicolored image:2,writes a:2,blank image:2,discussed above:2,different sets:2,of reads:2,into VGA:2,slow performance:2,because OUT:2,preserve bits:2,setting bits:2,1 a:2,four internal:2,internal latches:2,latches to:2,irrelevant The:2,memory all:2,single block:2,mask out:2,animated images:2,pixels horizontally:2,horizontally This:2,rotation for:2,pixel alignment:2,technique in:2,these features:2,animated graphics:2,graphics are:2,stage the:2,memory of:2,perform page:2,flipping which:2,displayed while:2,another is:2,modified The:2,is providing:2,providing video:2,the modified:2,selected for:2,to hold:2,in 640x350:2,pages in:2,needed The:2,two 672x384:2,672x384 virtual:2,virtual pages:2,one starting:2,other starting:2,pages is:2,as setting:2,out that’s:2,the switch:2,is critical:2,VGA however:2,follows The:2,is latched:2,latched by:2,always on:2,all clones:2,as bit:2,modes or:2,is observed:2,pulse to:2,can’t just:2,just set:2,a nasty:2,possible solution:2,second page:2,page start:2,I’ve gone:2,To avoid:2,address bytes:2,program waits:2,displayed as:2,this tells:2,displayed portion:2,enough away:2,new pel:2,flipping will:2,interesting side:2,panning settings:2,possible although:2,maximum safety:2,safety you:2,start looking:2,for Display:2,be off:2,CPU This:2,Waiting for:2,the sync:2,of causing:2,of 60:2,60 or:2,or 70:2,the useful:2,any CPU:2,program just:2,An important:2,limited resource:2,and must:2,leaving only:2,a colored:2,ball and:2,many applications:2,dozens or:2,and image:2,image storage:2,be kept:2,kept in:2,when designing:2,VGA To:2,Earlier I:2,any VGA:2,and functionality:2,see all:2,really are:2,drawing pixels:2,involved with:2,pixels out:2,and onto:2,which I’m:2,are illustrated:2,fact have:2,some pixels:2,virtual bitmaps:2,bitmaps can:2,work reliably:2,by careful:2,the reasons:2,bitmaps and:2,around them:2,points of:2,many VGA:2,on but:2,of features:2,general to:2,what VGA:2,we’ll begin:2,basis The:2,I believe:2,segments the:2,and limited:2,real-time programming:2,really no:2,the lowest-level:2,environment in:2,sine qua:2,there from:2,here without:2,like we:2,at specific:2,specific areas:2,areas in:2,CPU during:2,ALUs in:2,masks and:2,that hardware:2,get up:2,Chapter 24:2,The ALUs:2,one part:2,surprisingly complex:2,in almost:2,flow of:2,built into:2,plane are:2,of ORing:2,together as:2,operation at:2,each ALU:2,ALU operates:2,address but:2,different plane:2,read as:2,performance if:2,select each:2,turn via:2,a crawl:2,Each ALU:2,matching latch:2,holds the:2,byte read:2,memory even:2,particular plane:2,actually read:2,last read:2,reads display:2,those four:2,logically combines:2,bits 3:2,read which:2,location being:2,common application:2,ALUs is:2,so requires:2,that modifies:2,operation that:2,n with:2,24.1 VGA:2,VGA ALU:2,flow Figure:2,written unmodified:2,unmodified to:2,ways By:2,0 so:2,latched bits:2,fill pattern:2,different bit:2,mechanism for:2,any display:2,plane so:2,each plane’s:2,change until:2,pattern for:2,box filled:2,with solid:2,empty and:2,are done:2,planes would:2,by ignoring:2,ORed with:2,data into:2,all when:2,unmodified function:2,true but:2,through 3:2,perform animation:2,uses of:2,AND can:2,mask a:2,a drawing:2,drawing operation:2,don’t overlap:2,force an:2,be honest:2,in handy:2,handy in:2,right context:2,keep them:2,Demo Program:2,VGA settings:2,function select:2,be restored:2,their default:2,draw pixels:2,not guarantee:2,will set:2,compatible BIOSes:2,a reliable:2,not explicitly:2,are enabled:2,the profusion:2,profusion of:2,control registers:2,on their:2,BIOS provides:2,RAM should:2,hardware directly:2,may mask:2,draws each:2,each vertical:2,box in:2,it means:2,8-bit register:2,write string:2,is installed:2,this function:2,slow If:2,The great:2,virtue of:2,seem strange:2,being loaded:2,byte values:2,values The:2,requires four:2,value destined:2,destined for:2,with MASM’s:2,both halves:2,Note though:2,mode there’s:2,16-bit instructions:2,book for:2,details As:2,combine the:2,A minor:2,listing is:2,register increment:2,increment and:2,and decrement:2,decrement instructions:2,low 8:2,and ALUs:2,central to:2,programs to:2,four memory:2,however because:2,hardware in:2,mask the:2,VGA Data:2,we examined:2,featuring the:2,that model:2,explored over:2,25.1 shows:2,an expanded:2,of GC:2,shifter and:2,shifter is:2,The barrel:2,seven bits:2,rotated byte:2,extra processing:2,operations The:2,OR and:2,25.1 Data:2,powerful but:2,only rotate:2,task that:2,perfectly capable:2,However with:2,sometimes possible:2,register so:2,OUT is:2,simply have:2,If only:2,could rotate:2,be all:2,I’ll demonstrate:2,demonstrate that:2,below In:2,though don’t:2,cases The:2,The Bit:2,bit masks:2,to in:2,25.2 illustrates:2,plane once:2,plane or:2,plane Figure:2,25.2 Bit:2,Bit mask:2,mask operation:2,operation The:2,while if:2,mask that’s:2,Remember though:2,first be:2,unchanged Listing:2,text at:2,characters on:2,text drawing:2,anywhere on:2,BIOS as:2,for much:2,for fast:2,that performed:2,performed when:2,as filled:2,is handy:2,drawn without:2,left unchanged:2,unchanged The:2,worth pointing:2,resource that:2,purposes For:2,could fill:2,3 as:2,later as:2,color without:2,reading display:2,we’re already:2,it completely:2,good illustration:2,combined in:2,let yourself:2,yourself be:2,limited by:2,need done:2,The example:2,25.1 is:2,fast or:2,and performed:2,access per:2,per font:2,data directly:2,text-drawing code:2,which tend:2,writes Also:2,Journal January:2,is complex:2,passes through:2,circuitry which:2,with set/reset:2,set/reset data:2,Briefly put:2,control color:2,those planes:2,3 are:2,blue plane:2,intensity plane:2,25.3 Data:2,flow during:2,planes contain:2,data just:2,just written:2,short color:2,force all:2,to contain:2,color In:2,force some:2,Listing 25.2:2,1 set:2,is first:2,with blue:2,Mask setting:2,of 01H:2,cyan is:2,to 0FH:2,to 01H:2,01H and:2,and fill:2,follows For:2,0FFH and:2,directly replaces:2,replaces CPU:2,enable the:2,set/reset for:2,set/reset to:2,force a:2,that set/reset:2,Here the:2,and planes:2,of CPU:2,a red:2,red pixel:2,are 10:2,bytes wide:2,for say:2,with CPU:2,particularly with:2,Chapter 27:2,set/reset in:2,in applications:2,planes In:2,in getting:2,tool that:2,that lets:2,and it’ll:2,not active:2,planes For:2,bits will:2,set/reset value:2,that plane’s:2,processed in:2,VGA there:2,that weren’t:2,Consequently I:2,I generally:2,two 8-bit:2,8-bit OUT:2,16-bit OUT:2,I chose:2,chose to:2,fact you’ll:2,with OUT:2,does no:2,are standard:2,since I’ve:2,I’ve heard:2,VGA Write:2,Mode 3:2,three chapters:2,chapters we’ve:2,Thus far:2,the straightforward:2,achieved by:2,have yet:2,powerful than:2,might initially:2,and pattern:2,considerably in:2,of 16-color:2,is automatically:2,alone would:2,normally be:2,through 25:2,understand write:2,write data:2,for write:2,lines circles:2,text that:2,is potentially:2,terrific for:2,a modification:2,draw bit-mapped:2,0 Listing:2,26.1 uses:2,original text-drawing:2,drew the:2,over it:2,of ANDing:2,ANDing the:2,1 indicating:2,25 the:2,that’s more:2,with using:2,that sets:2,text which:2,different rotation:2,characters into:2,it At:2,the pixel-aligned:2,pixel-aligned character:2,falls in:2,graphics data:2,out The:2,provide pixel:2,mask value:2,currently addressed:2,but given:2,25 and:2,how Listing:2,set/reset could:2,rotation as:2,as appropriate:2,only of:2,all 40:2,3 Then:2,mask could:2,s required:2,required would:2,illustrates one:2,the 8x14:2,ROM font:2,the 8x8:2,also an:2,font stored:2,3 works:2,Like the:2,VGA as:2,more significantly:2,possible so:2,would eliminate:2,speed As:2,be accelerated:2,3 could:2,bytes written:2,complications such:2,Chapter 55:2,working through:2,approach can:2,but surprisingly:2,surprisingly powerful:2,and flexible:2,A Note:2,reserved bits:2,was necessary:2,change only:2,those bits:2,clone manufacturers:2,are currently:2,four write:2,the heck:2,read VGA:2,bit unusual:2,particularly if:2,followed the:2,Reading VGA:2,hand can:2,the easy:2,that’s pretty:2,don’t remember:2,0FFH or:2,plane selects:2,none or:2,on CPU:2,color the:2,pixels being:2,data coming:2,bits written:2,written across:2,planes thereby:2,0 ALU:2,0FFH byte:2,bit 2:2,expanded for:2,3 It’s:2,byte through:2,2 data:2,path The:2,bits one:2,never to:2,be heard:2,that IBM:2,that supported:2,1 respectively:2,respectively The:2,the respective:2,latch byte:2,bytes together:2,together or:2,which selects:2,selects on:2,basis between:2,27.1 VGA:2,flow in:2,take place:2,registers have:2,the map:2,prevent the:2,CPU from:2,from altering:2,altering selected:2,to feed:2,correct way:2,register mask:2,leaving the:2,VGA Memory:2,Using Write:2,presents a:2,up each:2,chunky mode:2,bitmaps in:2,a planar:2,conversion from:2,planar format:2,of bit:2,pixels all:2,allow only:2,VGA display:2,leftmost chunky:2,Then a:2,its respective:2,respective plane:2,does have:2,and copy:2,copied one:2,line before:2,before moving:2,moving on:2,been modified:2,Lines Using:2,program presented:2,patterns on:2,color can:2,set pixel:2,result but:2,an index/data:2,index/data pair:2,new color:2,only would:2,pixel being:2,draws only:2,cases and:2,routine and:2,2 would:2,to Use:2,draw whatever:2,OR instruction:2,ignored in:2,set/reset color:2,VGA’s 320x200:2,16-color model:2,model that:2,five chapters:2,bitmap starting:2,controlling one:2,right pixel:2,screen That’s:2,a demo:2,demo program:2,Graphics and:2,A while:2,got an:2,Suppose I:2,at A000H:2,I digress:2,text The:2,EGA BIOS:2,that writing:2,text page:2,I switch:2,bands of:2,there a:2,this question:2,Where does:2,sets but:2,rest Or:2,Or rather:2,can I:2,explanation that:2,back without:2,without losing:2,losing the:2,noted below:2,correct in:2,that setting:2,clear display:2,loaded when:2,when going:2,The normal:2,takes up:2,38400 bytes:2,8K of:2,just under:2,10H or:2,12H to:2,though One:2,bitmap can:2,be relocated:2,relocated to:2,A0000000 with:2,resultant display:2,can’t start:2,The memory:2,memory used:2,by mode:2,bitmap at:2,of font:2,flip back:2,from graphics:2,up every:2,the odd:2,odd bytes:2,12K bytes:2,bytes actually:2,Listing 27.3:2,the save:2,save and:2,and attributes:2,attributes which:2,the even:2,so are:2,the explanation:2,this however:2,you flip:2,is don’t:2,the Page:2,the Miscellaneous:2,1 On:2,font are:2,loaded the:2,those particular:2,memory potentially:2,I’ve only:2,now though:2,Well it’s:2,as complex:2,complex as:2,1 also:2,is rather:2,Read Mode:2,the four-plane:2,four-plane nature:2,VGA If:2,read Chapters:2,reads VGA:2,planes will:2,supply the:2,read at:2,possible settings:2,3 In:2,to multiple:2,this Listing:2,by repeatedly:2,Note the:2,since it’s:2,As you’d:2,nor the:2,latches Remember:2,plane on:2,provide some:2,0 all:2,also likely:2,1.1 microseconds:2,to switch:2,mode provides:2,read you:2,color comparison:2,its simplest:2,that matches:2,interesting but:2,but what’s:2,algorithms since:2,Listing 28.2:2,there aren’t:2,many uses:2,always considered:2,this another:2,way A:2,by four:2,on That:2,all set:2,are 0:2,prone to:2,has limited:2,circumstances you:2,single AND:2,Listing 28.3:2,28.3 illustrates:2,VGA always:2,MOV is:2,save one:2,I’ve given:2,for Color:2,understand but:2,useful at:2,take some:2,find useful:2,your graphics:2,register has:2,we’re actually:2,actually done:2,personal favorite:2,animation We’ve:2,Chapter 29:2,place and:2,of EGAs:2,basic principle:2,Write each:2,EGA’s hi-res:2,enable reads:2,10H to:2,for planes:2,putting up:2,is something:2,10H frame:2,29.1 Saving:2,Saving EGA/VGA:2,EGA/VGA display:2,29.2 does:2,reverses the:2,then loading:2,to If:2,If your:2,enough you:2,text but:2,bit map:2,setting used:2,settings are:2,are plane:2,to 15:2,1 enables:2,enables writes:2,the adapter’s:2,properly in:2,screen saving:2,For screen:2,these requirements:2,requirements are:2,TSR that:2,image at:2,time With:2,never any:2,state the:2,registers aren’t:2,aren’t readable:2,simply read:2,a programmer’s:2,programmer’s perspective:2,you couldn’t:2,VGA version:2,screen capture:2,VGA’s mode:2,640x480 screen:2,displayed screen:2,screen size:2,Similarly if:2,shown on:2,Finally be:2,29.2 are:2,all text:2,modes 11H:2,11H and:2,well display:2,read back:2,back as:2,the high-level:2,it’s safest:2,safest to:2,you found:2,found them:2,does one:2,displayed by:2,or 64:2,for compatibility:2,the 200-scan-line:2,select from:2,a monitor:2,four input:2,now we’ll:2,the 350-scan-line:2,pixel comes:2,pixel’s color:2,is blue:2,if that’s:2,color 0:2,color 1:2,text attribute:2,to white:2,15 to:2,to black:2,you wished:2,possible 4-bit:2,6-bit value:2,pixel a:2,bits it:2,six bits:2,blue are:2,monitor The:2,29.2 Color:2,Color translation:2,translation via:2,registers Figure:2,However setting:2,the blanking:2,Conveniently the:2,one palette:2,overscan register:2,invoked by:2,10H If:2,subfunction 0:2,BL contains:2,BH contains:2,subfunction 1:2,a 17-byte:2,17-byte array:2,unrelated to:2,cause bit:2,text attributes:2,29.3 Bit:2,Bit organization:2,organization within:2,step through:2,16 color:2,on up:2,at mode:2,screen have:2,changed after:2,reason it’s:2,speak of:2,range 0-15:2,are mapped:2,the rectangular:2,area around:2,that’s outside:2,either setting:2,a proper:2,border when:2,A Bonus:2,blank the:2,other write:2,blanking the:2,Setting bit:2,but actually:2,modes where:2,are simultaneously:2,not readable:2,come as:2,news to:2,bits as:2,I’ll go:2,into Mode:2,register As:2,In 256-color:2,desired field:2,setting and:2,must set:2,once at:2,the port:2,a delay:2,and OUT:2,are after:2,be allowed:2,can’t guarantee:2,the delay:2,has more:2,motherboard chips:2,chips such:2,accessing VGAs:2,VGAs so:2,please let:2,me through:2,be doing:2,29.4 Graphics:2,Graphics mode:2,mode register:2,register fields:2,Chapter 30:2,EGA The:2,display two:2,purely in:2,and understand:2,limitations and:2,EGA’s split:2,little buggy:2,the Split:2,itself A:2,begins to:2,registers just:2,encounters the:2,specified split:2,screen it:2,internal pointer:2,progressing toward:2,whole process:2,effect The:2,screen starts:2,second scan:2,zero in:2,30.1 Display:2,screen So:2,stored The:2,EGA or:2,EGA the:2,in bit:2,total and:2,11H for:2,350-scan-line modes:2,in setting:2,bit 9:2,bit 6:2,6 of:2,Maximum Scan:2,Line register:2,on involves:2,you’ll probably:2,just end:2,twice once:2,last scan:2,such approach:2,The Split:2,fills display:2,with text:2,screen fills:2,default setting:2,screen up:2,quarter of:2,another keypress:2,flipping back:2,line setting:2,screen display:2,screen displays:2,screen doesn’t:2,start until:2,until after:2,reasons I’ll:2,upper bits:2,If IS_VGA:2,target then:2,by programming:2,9 of:2,changing only:2,the split-screen-related:2,30.1 won’t:2,of to:2,screens with:2,screens are:2,only mode:2,screen works:2,in however:2,is checked:2,takes effect:2,set In:2,changes to:2,the changed:2,changed screen:2,new split:2,is spread:2,spread out:2,out over:2,but before:2,jumping and:2,and flicker:2,flicker The:2,simple Set:2,set it:2,when there:2,any currently:2,that’s easy:2,pretty near:2,register sets:2,display time:2,display adapter’s:2,running Listing:2,of once:2,Hz frame:2,modes support:2,The bug:2,line starting:2,once but:2,twice In:2,EGA’s split-screen:2,split-screen bug:2,few lines:2,how your:2,bug that:2,least that:2,that’s in:2,of panning:2,many areas:2,the shortcomings:2,shortcomings of:2,Screen and:2,panning by:2,by 0:2,have your:2,your users:2,don’t change:2,AC Mode:2,register 10H:2,screen horizontally:2,produce an:2,information The:2,An Example:2,30.2 illustrates:2,interaction of:2,screen Listing:2,fills in:2,pans the:2,VGA By:2,form that:2,screen won’t:2,lacks the:2,support that:2,made about:2,3C0H with:2,index mode:2,3DAH in:2,The AC:2,them The:2,addressed by:2,index/data toggle:2,illustrates reading:2,registers CRTC:2,internal display:2,frame with:2,zero if:2,straightforward enough:2,Programmer’s Guide:2,Guide to:2,PC Video:2,Video Systems:2,Microsoft Press:2,Richard Wilton:2,to mean:2,testing the:2,status bit:2,Consequently he:2,effect until:2,right when:2,For that:2,unless they:2,adapter it:2,might run:2,hazards to:2,That’s because:2,panning at:2,whole frame:2,off from:2,to miss:2,pair for:2,although for:2,haven’t done:2,just move:2,notice when:2,discussed the:2,What about:2,CGA modes:2,lines not:2,on clones:2,be careful:2,least half:2,fine in:2,zero but:2,line within:2,screen pel:2,intended but:2,this causes:2,particular application:2,application for:2,example there:2,screen has:2,left side:2,it’s perfectly:2,input from:2,enough that:2,or without:2,the clone:2,gotten it:2,back that:2,say to:2,smoothly as:2,appealing features:2,256 simultaneous:2,simultaneous colors:2,the less:2,higher resolution:2,standard and:2,different manufacturers:2,mode If:2,do things:2,the clever:2,going all:2,my favorite:2,two graphics:2,the high-performance:2,games use:2,question Why:2,Why did:2,the higher-resolution:2,13H does:2,lines but:2,of 320x200:2,320x200 This:2,lines however:2,fixed at:2,modes but:2,13H has:2,Why then:2,know but:2,standard 256-color:2,was originally:2,originally created:2,for 640x480:2,12H for:2,odd aspect:2,a 400-scan-line:2,400-scan-line mode:2,about 320x400:2,13H into:2,into 320x400:2,one VGA:2,registers which:2,multisync monitors:2,timings to:2,area as:2,pages are:2,just barely:2,can’t support:2,pages at:2,As we’ve:2,paging is:2,smooth animation:2,like 320x400:2,why display:2,memory must:2,to 320x200:2,accomplished in:2,because mode:2,bitmap with:2,an acceptable:2,us use:2,controls one:2,Ideally we’d:2,like one:2,address that’s:2,number n:2,at display:2,31.1 Bitmap:2,Bitmap organization:2,mode Figure:2,n is:2,given by:2,a significantly:2,routines won’t:2,BIOS ROM:2,pixel routines:2,problem because:2,routines in:2,memory That:2,the double:2,display of:2,line making:2,making sure:2,are turned:2,byte mode:2,All that’s:2,the Set320x400Mode:2,Set320x400Mode subroutine:2,Writing Pixels:2,basic graphics:2,complex function:2,the speediest:2,pixel functions:2,complex graphics:2,we’ll start:2,one on:2,pressed The:2,of diagonal:2,It’s necessary:2,31.1 is:2,the WritePixel:2,WritePixel subroutine:2,which draws:2,is remarkably:2,remarkably simple:2,as address:2,y SCREEN_WIDTH:2,division by:2,by 4:2,x modulo:2,then written:2,registers If:2,on VGA:2,can support:2,the multiplication:2,with mode:2,the byte-per-pixel:2,clip and:2,pixels To:2,reasonably efficient:2,graphics function:2,line draw:2,draw for:2,mode would:2,image copies:2,OUT per:2,requires If:2,could store:2,MOVS instruction:2,image In:2,single access:2,an adequately:2,slanting color:2,bars in:2,other way:2,register When:2,extremely smooth:2,gradations of:2,that 320x400:2,maximum scan:2,but four:2,256-color display:2,at offsets:2,offsets 0:2,area to:2,256-Color Modes:2,learned how:2,but didn’t:2,from John:2,set routine:2,for 360x480:2,he has:2,has placed:2,placed into:2,public domain:2,John wrote:2,on SuperVGAs:2,demo of:2,of 360x480:2,When last:2,we left:2,single graphics:2,should that:2,that be:2,reasons It:2,another but:2,the monitor-oriented:2,monitor-oriented registers:2,certain to:2,the extended:2,resolution for:2,was kind:2,kind enough:2,make his:2,360x480 256mode:2,However bear:2,one graphics:2,direct setting:2,a drawback:2,need page:2,there If:2,clone VGAs:2,Video Seven:2,adapter or:2,you 360x480:2,from readers:2,is welcome:2,many colors:2,and nearly:2,showing you:2,Listing 32.1:2,specified color:2,location This:2,be presenting:2,fashion and:2,and haven’t:2,there yet:2,line-draw code:2,35 and:2,code presented:2,been altered:2,different color:2,to isolate:2,blend together:2,palette The:2,of 256K:2,For more:2,right away:2,detail is:2,visible on:2,horizontally by:2,those rectangles:2,as mode:2,distributed with:2,mode 13H—but:2,a SuperVGA:2,which our:2,you’re familiar:2,common and:2,by repeating:2,lines has:2,sync pulses:2,pulses to:2,adjust to:2,to 480:2,480-scan-line modes:2,extra lines:2,to 60:2,same rate:2,covered by:2,the electron:2,electron beam:2,adding extra:2,lines per:2,requires extra:2,rate the:2,supported and:2,320 to:2,resolution we:2,mode Unfortunately:2,display 9:2,Although it’s:2,that terminology:2,to solving:2,two clocks:2,clock about:2,MHz that’s:2,320 pixels:2,to crank:2,the 25:2,the 28:2,pixel so:2,than 80:2,easy doesn’t:2,Bridges has:2,done that:2,want you:2,some work:2,horizontal blanking:2,resolution as:2,high-resolution 256-color:2,Memory in:2,mode you:2,you already:2,the 320x400:2,routines would:2,that adjacent:2,every fourth:2,A new:2,line starts:2,starts every:2,pixels or:2,programming difference:2,modes is:2,VGA’s 256:2,around which:2,perspective this:2,clever coding:2,fast line-drawing:2,the traditional:2,generally even:2,32.1 Pixel:2,Pixel organization:2,mode There’s:2,There’s more:2,we’ll return:2,big way:2,way by:2,by exploring:2,2-D and:2,The Basics:2,VGA Color:2,default color:2,tip of:2,of screaming:2,the planet:2,at my:2,getting into:2,translation there’s:2,to 6-bit:2,6-bit translation:2,or 4-bit:2,that’s used:2,not it:2,1990 issue:2,areas I:2,and ties:2,you’ll understand:2,on color:2,within its:2,touch that:2,about fast:2,for graphics:2,translation circuitry:2,takes in:2,translates it:2,three 6-bit:2,values one:2,two stages:2,EGA-compatible palette:2,EGA which:2,and sends:2,on Each:2,an incoming:2,are sent:2,was described:2,translation on:2,performs an:2,same manner:2,to analog:2,analog red:2,blue signals:2,analog signals:2,every VGA:2,generation path:2,output stage:2,to 3FH:2,coming into:2,either and:2,in DAC:2,is red:2,blue 0:2,18-bit values:2,each for:2,for red:2,two missing:2,supplied by:2,select only:2,register however:2,however one:2,this manner:2,frankly it:2,we’d really:2,really like:2,DAC from:2,that happen:2,Once that’s:2,bits 4:2,RAM are:2,a pass-through:2,settings and:2,with EGA:2,pass-through values:2,effectively takes:2,no useful:2,will happen:2,happen if:2,no benefit:2,from VGA:2,VGA So:2,your heart’s:2,heart’s content:2,content in:2,no color:2,the Palette:2,strongly recommend:2,RAM or:2,unless there’s:2,10H of:2,this subfunction:2,for register:2,which specifies:2,via subfunction:2,BIOS should:2,few complications:2,here My:2,My experience:2,degrees of:2,on many:2,set through:2,shortly but:2,DAC so:2,I’ll briefly:2,describe how:2,indicating the:2,which that:2,subfunction 12H:2,AL 12H:2,12H of:2,first register:2,Also as:2,as mentioned:2,detail The:2,by first:2,at 3DAH:2,retrace before:2,it’s easier:2,pairs to:2,data gets:2,loading process:2,you load:2,loading sequence:2,at 3C8H:2,three-byte RGB:2,next DAC:2,by sending:2,susceptible to:2,separately for:2,the autoincrementing:2,be most:2,in hearing:2,final point:2,fact some:2,will continue:2,33.1 is:2,DAC that:2,nothing particularly:2,smooth gradient:2,gradient of:2,three primary:2,the jagged:2,jagged lines:2,selection can:2,example when:2,drawing antialiased:2,antialiased lines:2,touched the:2,other pixel:2,VGA turns:2,headed for:2,some more:2,more code:2,try the:2,it suffices:2,are called:2,Such is:2,cycling through:2,frame so:2,you had:2,had best:2,cycling and:2,learned in:2,storage locations:2,locations each:2,DAC as:2,8-bit value:2,33 and:2,in non-256:2,effects by:2,cycling The:2,by altering:2,changing color:2,colors used:2,by cycling:2,the river:2,3-D games:2,to seem:2,How do:2,without producing:2,some computers:2,computers In:2,indeed possible:2,so color:2,stored within:2,256 color:2,see next:2,DAC repeatedly:2,next so:2,so at:2,painfully slow:2,VLB and:2,and PCI:2,where wait:2,8 MHz:2,and looping:2,also required:2,more for:2,DAC while:2,find but:2,will let:2,which you’re:2,single DAC:2,DAC the:2,the considerably:2,that whenever:2,problems In:2,for they:2,The difficulty:2,VGAs from:2,nor does:2,some in:2,Two of:2,one was:2,locations without:2,of garbage:2,garbage on:2,you’re loading:2,in preparation:2,preparation for:2,will care:2,care that:2,garbage is:2,and show:2,If however:2,BIOS DAC:2,bring you:2,once a:2,work very:2,will wait:2,two frames:2,short of:2,on you:2,color cycle:2,Which is:2,then performing:2,triplet to:2,s in:2,increments to:2,could end:2,with quite:2,and continues:2,No problem:2,If on:2,index for:2,location separately:2,once as:2,location is:2,without problems:2,I commented:2,to relate:2,experience that:2,anything that:2,happen on:2,does happen:2,various DAC-loading:2,DAC-loading approaches:2,approaches for:2,right Once:2,many DAC:2,from changing:2,we’re interested:2,The big:2,system and:2,VGA you:2,equate is:2,function or:2,only other:2,WAIT_VSYNC is:2,may end:2,proceed at:2,effects or:2,feature is:2,relied upon:2,GUARD_AGAINST_INTS is:2,interesting if:2,case if:2,NOT_8088 is:2,then an:2,process for:2,then after:2,REP OUTSB:2,clearly the:2,experience with:2,locations cleanly:2,acting on:2,You now:2,a sampling:2,sampling of:2,safety margin:2,frame on:2,said at:2,outset that:2,thing of:2,of beauty:2,against interrupts:2,Color cycling:2,while using:2,locations to:2,employ the:2,draw images:2,cars and:2,Suppose you:2,the sky:2,effects with:2,then cycle:2,those attributes:2,in successive:2,the jets:2,animate the:2,to assign:2,too great:2,of seemingly:2,DAC during:2,using only:2,see Chapters:2,Chapters 31:2,colors 0-127:2,load DAC:2,cycle settings:2,128 colors:2,new colors:2,in colors:2,and flip:2,any pixels:2,spot of:2,up if:2,time No:2,you did:2,flipping you:2,several frames:2,another possibility:2,changes from:2,line down:2,that used:2,sync on:2,percent for:2,techniques but:2,know this:2,BIOS in:2,useful but:2,hurts to:2,off any:2,ignored and:2,position in:2,entire screen:2,quick and:2,DAC Read:2,Read Index:2,register after:2,reads out:2,location specified:2,by BX:2,location with:2,RGB RGB:2,used when:2,settings is:2,at long:2,imagined it:2,most rewarding:2,very real:2,image drawing:2,Is Fast:2,and Fast:2,Fast Is:2,Bresenham’s Line-Drawing:2,Line-Drawing Algorithm:2,lie at:2,that draw:2,line-drawing hardware:2,so lines:2,line quality:2,second in:2,lines could:2,particular lines:2,little calculation:2,are notoriously:2,performance If:2,us neatly:2,neatly to:2,my line-drawing:2,line-drawing implementation:2,As I’m:2,know there:2,are dozens:2,any problem:2,by Jim:2,function First:2,must draw:2,computer screen:2,a line-drawing:2,a straight:2,a jagged:2,jagged pattern:2,pattern that:2,pixels must:2,hardware that:2,accelerators such:2,accelerators don’t:2,well the:2,Line drawing:2,drawing quality:2,algorithm used:2,implementation written:2,capability The:2,video mode:2,has gone:2,of techniques:2,lines have:2,been developed:2,require very:2,algorithm on:2,uniquely suited:2,no floating-point:2,floating-point operations:2,no divides:2,line-drawing loop:2,Algorithm The:2,pixel actually:2,deviates from:2,line can:2,by placing:2,one unit:2,its predecessor:2,35.1 Approximating:2,Approximating a:2,pixel array:2,or Y:2,are greater:2,the upper-left-hand:2,simpler to:2,coordinate from:2,In Figure:2,35.2 the:2,other part:2,The approach:2,line each:2,new pixel:2,than halfway:2,between pixels:2,X dimension:2,decide on:2,35.2 Drawing:2,Drawing between:2,two pixel:2,pixel endpoints:2,each X:2,coordinate as:2,line then:2,through in:2,pixel will:2,whichever of:2,minus A:2,halfway to:2,next Y:2,is C:2,C minus:2,coordinate The:2,is subtracted:2,error to:2,the adjustment:2,term in:2,in Bresenham’s:2,algorithm Figure:2,The fourth:2,D since:2,since this:2,1/2 the:2,change The:2,The fifth:2,fifth pixel:2,coordinate advances:2,is G:2,G minus:2,The end:2,to Bresenham’s:2,possible coordinate:2,of when:2,as close:2,close as:2,dimension and:2,eight octants:2,octants in:2,mechanism of:2,algorithm I’ll:2,and Van:2,Fundamentals of:2,book which:2,the derivation:2,weakness of:2,most other:2,generated with:2,with Bresenham’s:2,look a:2,of relatively:2,lines drawn:2,don’t look:2,B in:2,is accepted:2,accepted by:2,eye as:2,by many:2,PC programs:2,standard of:2,acceptance the:2,finish drawing:2,drawing performance:2,35.1 is:2,modes 0EH:2,0FH 10H:2,EVGALine The:2,color This:2,register Setting:2,value 0FH:2,the passed:2,drawing done:2,it calls:2,In summary:2,EVGALine to:2,axes and:2,The need:2,to categorize:2,falls out:2,the orientations:2,moment of:2,are redundant:2,start Y:2,end Y:2,by reversing:2,coordinates so:2,EVGALine does:2,by swapping:2,start coordinates:2,form two:2,two major:2,and orientations:2,X increases:2,increases from:2,X decreases:2,in only:2,coordinate moves:2,moves when:2,X movement:2,movement is:2,differ only:2,changes only:2,35.4 Bresenham’s:2,Bresenham’s eight:2,one line-drawing:2,for octants:2,function with:2,could certainly:2,negative or:2,DeltaY and:2,default of:2,which as:2,of 0FFH:2,slower to:2,35.5 EVGALine’s:2,EVGALine’s decision:2,decision logic:2,Drawing Each:2,to DeltaY:2,coordinate should:2,it moves:2,draw toward:2,changed since:2,DeltaY For:2,For such:2,1 depending:2,of XDirection:2,XDirection This:2,both octant:2,and octant:2,Whenever ErrorTerm:2,ErrorTerm becomes:2,becomes non-negative:2,non-negative indicating:2,better approximation:2,these lines:2,is advanced:2,advanced by:2,EVGADot EVGADot:2,whatever color:2,line-drawing performance:2,drawing all:2,assumptions about:2,above it:2,assumption of:2,per row:2,0FEH is:2,operations or:2,we’ve set:2,value 0FEH:2,the OR:2,color Given:2,that points:2,of zeros:2,bits except:2,Third the:2,that mask:2,Because of:2,in step:2,bear on:2,pixel but:2,as we’ve:2,saving the:2,and calling:2,this if:2,separate function:2,for clarity:2,clarity and:2,a fundamentally:2,256-color SuperVGA:2,remember to:2,error checking:2,is tied:2,system of:2,system to:2,is specifically:2,do one:2,calls EVGALine:2,EVGALine would:2,calling and:2,performance increase:2,would come:2,be adjusted:2,it’s important:2,a worthwhile:2,a high-performance:2,same name:2,be linked:2,runs over:2,ISA-bus VGA:2,version and:2,a lengthy:2,should speak:2,make is:2,described the:2,the notion:2,article I:2,suggestion was:2,once with:2,good algorithm:2,to stand:2,implementation In:2,asked me:2,AutoCAD driver:2,out separate:2,routines for:2,pushed the:2,limits of:2,as line:2,slice line-drawing:2,fuzzy on:2,What exactly:2,mean by:2,by bad:2,bad It:2,universe so:2,never never:2,But why:2,why don’t:2,don’t you:2,relax and:2,later and:2,implement code:2,shown here:2,inputs and:2,by passing:2,themselves can:2,since I:2,read about:2,article and:2,is stepping:2,while maintaining:2,maintaining an:2,integer error:2,that indicates:2,to advancing:2,36.1 Standard:2,Standard Bresenham’s:2,axis as:2,by Figure:2,X-dimension of:2,particular because:2,run being:2,three or:2,this line:2,70 percent:2,decision at:2,However most:2,decisions are:2,Both approaches:2,36.2 Run-length:2,36.3 Runs:2,Runs in:2,slope 1/3.5:2,1/3.5 line:2,We know:2,slope of:2,of 1/3.5:2,that X:2,with X:2,possible length:2,is int(XDelta/YDelta:2,The maximum:2,is knowing:2,knowing which:2,two lengths:2,each one-pixel:2,we advance:2,three pixels:2,pixels because:2,fractional portion:2,advance along:2,X for:2,fractional advance:2,when to:2,pixel we:2,run If:2,we keep:2,running sum:2,a measure:2,close we:2,current run:2,on Figure:2,36.4 How:2,term determines:2,determines run:2,can’t work:2,because floating-point:2,and fixed-point:2,the error-term:2,axis advance:2,This value:2,we adjust:2,YDelta 2:2,scale up:2,so our:2,run we’ll:2,we’ll add:2,which involves:2,complicated process:2,and subtraction:2,run lengths:2,to blast:2,blast in:2,would ideally:2,rather just:2,customized to:2,possibilities for:2,three and:2,a subtraction:2,something on:2,overhead per:2,slice implementation:2,term is:2,a negative:2,and advances:2,after advancing:2,as evenly:2,appropriately for:2,exactly halfway:2,are scaled:2,it an:2,trick here:2,odd pixel:2,accounted for:2,for by:2,runs are:2,an optimized:2,it meant:2,be this:2,I’ll move:2,code I’ll:2,36.5 Balancing:2,Balancing run-length:2,a unbalanced:2,unbalanced b:2,b balanced:2,Cats and:2,I write:2,kid and:2,to Redmond:2,what makes:2,effort to:2,of shipping:2,good story:2,track down:2,it’s always:2,But maybe:2,dismay when:2,day he:2,owner would:2,be and:2,and came:2,a plan:2,same size:2,humans with:2,the kennel:2,kennel and:2,out she:2,home to:2,himself out:2,fix it:2,broken maybe:2,maybe that’s:2,drawing which:2,major longer:2,longer axis:2,37.1 draws:2,million pixels:2,principle that:2,converted the:2,last chapter’s:2,used REP:2,was surely:2,made and:2,point however:2,and compared:2,hit on:2,was drawing:2,Paradise VGA:2,fast for:2,lets the:2,merry way:2,is ready:2,my system:2,system nondisplay:2,nondisplay memory:2,possible rate:2,me less:2,but so:2,so what:2,would likely:2,likely be:2,that reason:2,reason I’ll:2,Profile before:2,freed up:2,loops for:2,X advances:2,freed registers:2,registers could:2,implement more:2,enough on:2,the X-major:2,of REP:2,implemented for:2,lines Also:2,could try:2,possible this:2,than horizontal:2,2 which:2,and slower:2,including a:2,for 100-pixel:2,approaches will:2,drawing For:2,best one:2,Drawing Polygons:2,Give me:2,me but:2,he might:2,are equally:2,spend some:2,next several:2,of polygon-based:2,entities as:2,an exploration:2,polygon In:2,first followed:2,a speedy:2,is scarcely:2,end to:2,work only:2,we’re concerned:2,any horizontal:2,edge exactly:2,and zero-length:2,reverses direction:2,second polygon:2,Listing 38.3:2,isn’t convex:2,convex in:2,nonconvex polygons:2,Complex polygons:2,deciding which:2,fill and:2,which not:2,See Chapter:2,Why bother:2,to distinguish:2,distinguish between:2,between convex:2,to filling:2,polygon a:2,filling the:2,edges on:2,simple approach:2,Convex nonconvex:2,to rasterize:2,scan-converting the:2,polygon on:2,each raster:2,raster line:2,line Then:2,draw from:2,A line:2,pixels nearest:2,nearest to:2,serving as:2,polygon boundary:2,algorithm will:2,pixels outside:2,to trace:2,trace out:2,are certain:2,advantages For:2,polygon will:2,same polygon:2,drawn unfilled:2,will look:2,look pretty:2,38.2 Drawing:2,Drawing polygons:2,polygons won’t:2,properly as:2,triangles to:2,triangles will:2,lines just:2,won’t do:2,then do:2,polygon This:2,vertices so:2,to adopt:2,Points located:2,38.3 The:2,The adjacent:2,polygons problem:2,ending at:2,no right:2,right or:2,or bottom:2,edges or:2,polygon These:2,are filled:2,the filled:2,Convex Polygons:2,Without further:2,further ado:2,ado Listing:2,FillConvexPolygon that:2,connect to:2,then passes:2,passes that:2,draw polygons:2,various sorts:2,simplest possible:2,way one:2,doesn’t bother:2,action is:2,all points:2,polygon are:2,polygon then:2,two ends:2,top edge:2,locations the:2,top is:2,and directions:2,them properly:2,rightmost pixel:2,edge are:2,isn’t drawn:2,top isn’t:2,isn’t flat:2,both edges:2,two lines:2,edge starts:2,corresponding scan:2,to DrawHorizontalLineList:2,to scan-convert:2,fields of:2,moved one:2,of but:2,whole line:2,DrawHorizontalLineList and:2,edges being:2,point calculations:2,Fast Convex:2,Well yes:2,magic of:2,ask the:2,I as:2,any idea:2,idea how:2,actually works:2,Put that:2,programming are:2,future The:2,this technology:2,process by:2,be reused:2,what actually:2,development time:2,for new:2,is without:2,Thing The:2,but I’ll:2,as programmers:2,less and:2,less of:2,general-purpose code:2,yet but:2,much memory:2,which many:2,various ways:2,the patent:2,window of:2,gaps in:2,may even:2,drawing into:2,a system:2,then copying:2,instance you:2,the WinG:2,from Microsoft:2,chapter although:2,chapter’s discussion:2,in good:2,use polygons:2,to current:2,helps to:2,work especially:2,visible parts:2,never overlap:2,overlap or:2,important consideration:2,work up:2,polygon-filling code:2,Our original:2,the tracing:2,chapter’s sample:2,in FillConvexPolygon:2,have our:2,up The:2,to plot:2,which we’re:2,polygon scan:2,linked in:2,data models:2,data model:2,draw to:2,of why:2,use C:2,Chapter 38’s:2,memset and:2,Drawing to:2,C floating:2,1 C:2,integer scan/memset:2,39.1 Listing:2,39.2 compact:2,ASM integer:2,Listing 40.3:2,0.03 23:2,20-MHz cached:2,are rounded:2,rounded to:2,point I’d:2,drawn or:2,between and:2,improving drawing:2,be had:2,filling time:2,time it’s:2,tracing code:2,Edge Tracing:2,point code:2,their proper:2,but after:2,not get:2,fact when:2,integer edge:2,by floating-point:2,leading me:2,code It:2,results were:2,to creep:2,not precise:2,trivial to:2,and X-major:2,horizontal The:2,triangles The:2,X pixels:2,implementation but:2,so In:2,complexity Listing:2,20 times:2,Still it:2,eye with:2,but just:2,than system:2,486 systems:2,local buffer:2,And indeed:2,does When:2,With those:2,time waiting:2,best and:2,that’s where:2,optimizations such:2,environments in:2,way out:2,addresses so:2,necessary Listing:2,overwhelm the:2,39.4 is:2,still further:2,nondrawing code:2,great enough:2,to justify:2,much maxed:2,are out:2,overall time:2,the versions:2,Every so:2,ever heard:2,well aware:2,easily take:2,A Hard:2,Hard Day’s:2,Day’s Night:2,people don’t:2,Finally I:2,back on:2,the Universe:2,remarkably well:2,just done:2,doubled over:2,us do:2,next year:2,a corner:2,where everything:2,is such:2,38 I:2,a terrific:2,convex If:2,stretched around:2,of complex:2,polygons require:2,polygon of:2,because edges:2,edges never:2,into complex:2,all polygon:2,the type:2,improve this:2,Active Edges:2,other aspects:2,the odd/even:2,specifies that:2,question then:2,which edges:2,edges cross:2,cross each:2,list because:2,edges don’t:2,about and:2,edge at:2,40.1 Filling:2,Filling one:2,by finding:2,finding intersecting:2,edges Figure:2,plus all:2,suggests that:2,proceed from:2,sorted in:2,of ascending:2,40.2 Checking:2,Checking currently:2,edges solid:2,solid lines:2,AET from:2,three steps:2,Second we:2,remove edges:2,end on:2,edges with:2,AET is:2,all required:2,edge one:2,AET by:2,by X:2,we’ll just:2,and remove:2,when its:2,as their:2,one particularly:2,single list:2,GET that:2,GET is:2,that share:2,share common:2,ensures that:2,new edges:2,GET in:2,of edge:2,GET to:2,become active:2,few pointers:2,AET removing:2,AET in:2,40.3 The:2,The global:2,global and:2,and active:2,edge tables:2,tables as:2,as linked:2,40.1 to:2,39 and:2,are handled:2,filling approach:2,Listing 40.2:2,polygons drawn:2,fill rule:2,solid objects:2,the hole:2,overlap This:2,bottom or:2,right boundaries:2,boundary filling:2,precisely this:2,an active:2,edge because:2,never intersect:2,intersect a:2,drawing individual:2,assembly in:2,greatly improve:2,when filling:2,traversing the:2,list processing:2,a bubble:2,bubble sort:2,performance However:2,An insertion:2,sort will:2,current edge:2,edge rather:2,back links:2,would complicate:2,complicate the:2,reason though:2,ten percent:2,spent sorting:2,sorting the:2,to 5:2,any but:2,sorted only:2,work though:2,edges must:2,arise when:2,point because:2,be compared:2,implemented this:2,that I’d:2,too often:2,have looked:2,You’ll find:2,identify which:2,slopes of:2,edges if:2,by not:2,low-level drawing:2,swap the:2,words I:2,I became:2,should look:2,advantages The:2,I ended:2,the columns:2,columns on:2,that became:2,Bill Huber:2,terminology in:2,a specialized:2,filling techniques:2,than 180:2,180 degrees:2,not convex:2,drawn that:2,Y direction:2,exactly twice:2,means not:2,I called:2,be referred:2,his books:2,who were:2,he suddenly:2,share ideas:2,and explanation:2,ideas can:2,in DDJ:2,for exactly:2,direction changes:2,because such:2,that’s monotone:2,just scan:2,is left-most:2,have is:2,low-level code:2,there as:2,of whether:2,41.1 shows:2,shows code:2,the edge-scanning:2,edge-scanning code:2,same and:2,41.1 Monotone-vertical:2,Monotone-vertical polygons:2,41.2 Non-monotone-vertical:2,Non-monotone-vertical polygons:2,Listing 41.4:2,41.4 is:2,to link:2,an appropriately:2,worth all:2,right circumstances:2,or has:2,filler that:2,is helped:2,family restaurant:2,when my:2,fried chicken:2,chicken I:2,think it’s:2,all costs:2,not good:2,Why was:2,ice cream:2,home So:2,food was:2,within which:2,antialiasing technique:2,the processing:2,wait to:2,generate one:2,do hidden:2,system with:2,with hardware:2,what we’d:2,with terrific:2,terrific speed:2,there’s almost:2,folks are:2,it For:2,algorithm presented:2,Wu’s article:2,antialiased line:2,be accomplished:2,been discussing:2,past few:2,partly an:2,issue because:2,makes images:2,temporal aliasing:2,draws the:2,axis at:2,42.1 illustrates:2,concept The:2,The presence:2,of aggregate:2,line has:2,have if:2,at precisely:2,correct location:2,intensity weighting:2,Not coincidentally:2,eye not:2,smooth line:2,pixels properly:2,segments that:2,non-antialiased line-drawing:2,42.1 The:2,two distinct:2,draw and:2,pixel pair:2,all practical:2,impressive considering:2,that about:2,around 50:2,theoretically possible:2,traced out:2,a one-pixel:2,single integer:2,adjust is:2,in 0.16:2,0.16 format:2,weighting is:2,accumulator turns:2,major-axis coordinate:2,nearest the:2,wonder of:2,draw at:2,a potentially:2,percent intensity:2,intensity being:2,n 1:2,n bits:2,intensity value:2,one element:2,by flipping:2,first pixel’s:2,distance between:2,42.2 Wu:2,Wu intensity:2,a shift:2,of complexity:2,Listing 42.6:2,mistake about:2,test of:2,good it:2,non-antialiased lines:2,Listing 42.3:2,resulting program:2,42.1 isn’t:2,pixel On:2,out Wu:2,It’s well:2,at 640x480:2,feet away:2,and smooth:2,The size:2,levels the:2,intensity steps:2,can program:2,palette with:2,our drawing:2,The implementation:2,near as:2,also describes:2,describes a:2,for antialiasing:2,and polygons:2,they would:2,notes that:2,in intensity:2,for Wu-antialiased:2,is under:2,fixed-point inaccuracy:2,would let:2,length In:2,reasons not:2,not least:2,symmetric drawing:2,it eliminates:2,all calculations:2,so doing:2,cumulative error:2,A Simple:2,animation There’s:2,nothing quite:2,quite like:2,the satisfaction:2,satisfaction of:2,of fooling:2,fooling the:2,animation particularly:2,interesting is:2,destroying the:2,animation the:2,neither is:2,animation that:2,a cheap:2,everything I:2,though You:2,only push:2,stretching your:2,mind a:2,to producing:2,not fatal:2,to first:2,All sorts:2,Or look:2,July 1986:2,Journal which:2,which shows:2,handle several:2,with virtually:2,no overlap:2,or flicker:2,but unlike:2,other animation:2,techniques I’ll:2,also work:2,with bit-plane:2,time each:2,must consist:2,it’s preferable:2,0EH 10H:2,and plane:2,we’ll simply:2,pixel coming:2,planes go:2,look-up stage:2,color from:2,43.1 shows:2,at Figure:2,manipulate images:2,those images:2,have four:2,four sets:2,planes because:2,because images:2,more since:2,span multiple:2,43.1 How:2,How 4:2,data become:2,become 6:2,color Figure:2,store each:2,43.2 Storing:2,Storing images:2,in separate:2,separate planes:2,overlapping colors:2,selecting one:2,3 would:2,the absence:2,color It:2,also give:2,image precedence:2,appearing to:2,from planes:2,images would:2,show through:2,through holes:2,letting us:2,select which:2,color If:2,are as:2,is green:2,Palette Register:2,Register Register:2,0 00H:2,00H black:2,39H blue:2,1 5:2,green 1:2,43.4 How:2,How pixel:2,pixel precedence:2,precedence works:2,Nonetheless it:2,very shortly:2,to bit-plane:2,animation and:2,of redrawing:2,moves so:2,the part:2,image that:2,green images:2,we wished:2,The animation:2,43.1 to:2,43.1 runs:2,should all:2,easily increase:2,well into:2,This saved:2,saved the:2,also meant:2,pixels 1:2,be noticeable:2,correctable with:2,see an:2,of fully:2,rotated images:2,X but:2,principles generalize:2,The addition:2,animation where:2,animation with:2,particularly for:2,Limitations of:2,planar modes:2,also reduces:2,set from:2,image are:2,two planes:2,animation while:2,reserving the:2,3 for:2,3 images:2,Table 43.2:2,tradeoff for:2,limitation of:2,image can:2,erase the:2,to overlap:2,overlap is:2,never notice:2,exception is:2,of green:2,Here however:2,are moving:2,43.5 Pixel:2,Pixel precedence:2,precedence for:2,3 only:2,technique has:2,visual and:2,animation would:2,produce very:2,bottom parts:2,image directly:2,is changing:2,been changed:2,scans out:2,more noticeable:2,small images:2,games in:2,is page:2,non-displayed page:2,another page:2,it heavily:2,finished the:2,new screen:2,flipping can:2,the unique:2,drawbacks to:2,Also page:2,extra drawing:2,you wait:2,until you’re:2,you’re sure:2,a page:2,whole purpose:2,for pages:2,pages to:2,animation by:2,and looks:2,looks a:2,overall animation:2,animation scheme:2,fun and:2,jaws drop:2,full power:2,should give:2,Page Flipped:2,that’s only:2,free up:2,were up:2,scheme that:2,easily Then:2,page flipped:2,images at:2,successive images:2,pixel patterns:2,an intermediate:2,erased and:2,can destroy:2,enough so:2,object that:2,30 Hz:2,do fine:2,should ever:2,The listings:2,object bounces:2,other objects:2,too complex:2,knowledge for:2,Listing 44.1:2,C It:2,needed only:2,resulting from:2,bugs that:2,8-MHz AT:2,VGA because:2,features to:2,VGA’s high-resolution:2,for there:2,and ORing:2,ORing would:2,hideously slow:2,must use:2,hardware assist:2,assist features:2,about real-time:2,our present:2,matter the:2,compact than:2,and earlier:2,color it’s:2,because none:2,write of:2,programming you’re:2,that everything:2,virtually no:2,faster for:2,modes In:2,good choice:2,animation area:2,that also:2,character is:2,coordinates that:2,drawing text:2,is copied:2,using write:2,0 approach:2,foreground and:2,and background:2,foreground pixels:2,draw transparent:2,matters get:2,if characters:2,pixels wide:2,pixel locations:2,that rotation:2,to delve:2,text I:2,there’s something:2,you decide:2,the fun:2,fun stuff:2,requirement for:2,one bitmap:2,simple In:2,is we:2,64 K:2,256 K:2,K of:2,of SuperVGA:2,SuperVGA has:2,so going:2,and displays:2,screen then:2,640x350 16:2,colors a:2,then setting:2,display that:2,ad infinitum:2,44.1 Memory:2,10h page:2,flipping Figure:2,hitch though:2,flipped The:2,VGA loads:2,comes around:2,start updating:2,longer displayed:2,away any:2,because page:2,flipped to:2,mandatory that:2,of Vertical:2,be mixed:2,mixed with:2,values the:2,must never:2,be anywhere:2,both pages:2,just change:2,for Vertical:2,base with:2,new screens:2,on slower:2,compensated for:2,full pages:2,VGA It’s:2,those monster:2,ways It:2,It offers:2,a 11:2,11 aspect:2,mode Surely:2,appeal of:2,line number:2,is reserved:2,allows page:2,purposes such:2,have as:2,have fewer:2,bitmap for:2,off-screen storage:2,storage for:2,44.2 Memory:2,mode 12h:2,12h page:2,chapter uses:2,the page-flipped:2,split that:2,no visible:2,get by:2,best combination:2,resolution possible:2,program if:2,Dirty Rectangles:2,same room:2,Mr Byte:2,for something:2,a surprising:2,morning I:2,Sam hadn’t:2,after we:2,turned three:2,this magic:2,turned one:2,themselves in:2,and going:2,and remained:2,we said:2,take two:2,he turned:2,day now:2,now By:2,take all:2,Clearly the:2,his health:2,bonus the:2,from being:2,being sick:2,the mistake:2,mistake of:2,with graphics:2,I’m glad:2,like they’ve:2,you buy:2,years now:2,VGA around:2,around is:2,things don’t:2,to own:2,the Phar:2,Phar Lap:2,systems and:2,with full:2,full I/O:2,I/O privileges:2,officially takes:2,takes 16:2,VGA I/O:2,26 cycles:2,take 10:2,only 13:2,to VGAs:2,more common:2,case I’ve:2,can effectively:2,the caching:2,buffer which:2,memory tends:2,tends not:2,as bad:2,bad as:2,DXAL repeated:2,times nonstop:2,nonstop maximum:2,byte access:2,DXAX repeated:2,word access:2,but interspersed:2,with MULs:2,MULs random:2,33 cycles:2,they only:2,are particularly:2,memory performance:2,would hope:2,maintained in:2,rectangles for:2,that frame:2,frame are:2,of off-screen:2,all our:2,flicker as:2,objects were:2,first so:2,that nearer:2,45.1 Drawing:2,Drawing directly:2,45.2 Dirty:2,Dirty rectangle:2,rectangle animation:2,want good:2,all adapters:2,rectangles are:2,are erased:2,objects move:2,old positions:2,flipping In:2,good because:2,Dirty-rectangle animation:2,drawn images:2,one sense:2,raster beam:2,beam reaches:2,producing a:2,finish so:2,doesn’t happen:2,fairly cries:2,cries out:2,especially because:2,copy and:2,rectangles so:2,minimum number:2,dirty rectangle:2,screen even:2,considering all:2,the system-memory:2,system-memory buffer:2,some good:2,good reasons:2,buffer can:2,be of:2,and appearance:2,high-performance animation:2,animation region:2,region is:2,is mode:2,than ideal:2,doesn’t address:2,resolution although:2,a 640x400:2,uses almost:2,almost every:2,lines if:2,at heart:2,which controls:2,fewer lines:2,starting the:2,this has:2,class of:2,can arise:2,when both:2,display text:2,nonstandard modes:2,rows of:2,do animation:2,their old:2,drawn page:2,me an:2,interesting and:2,on animation:2,you display:2,you update:2,2 Draw:2,Draw to:2,sync at:2,Copy via:2,from page:2,6 Go:2,of Serge’s:2,ever actually:2,standard page:2,that Serge’s:2,owing to:2,degree of:2,a valuable:2,valuable tool:2,latches the:2,only partially:2,for copying:2,sufficient to:2,Finally I’d:2,trick can:2,enable is:2,active and:2,assembly so:2,Who Was:2,Was that:2,that Masked:2,Masked Image:2,linear process:2,Still it’s:2,thinking in:2,in solving:2,problems such:2,by someone:2,else and:2,someone else’s:2,got this:2,this bug:2,this a:2,door and:2,car and:2,man in:2,face When:2,went back:2,needed a:2,the connection:2,questions about:2,Dave Barry:2,is you:2,invented and:2,to tap:2,alternative to:2,of producing:2,don’t support:2,implement than:2,final advantage:2,it’s potentially:2,speed advantage:2,no attempt:2,Chapter 45’s:2,Listing 46.2:2,way toward:2,animation speed:2,speed This:2,program now:2,rectangular images:2,are rendered:2,pixels through:2,have transparent:2,transparent areas:2,realistic animation:2,images draw:2,or behind:2,by distance:2,farther away:2,nearer images:2,and images:2,color for:2,copy only:2,the transparent:2,separate mask:2,base image:2,image but:2,convincing animation:2,given object:2,distinguished from:2,of internal:2,even this:2,greatly improves:2,feel of:2,animation You:2,cycled through:2,logic to:2,running and:2,didn’t do:2,copied all:2,chapter goes:2,for overlap:2,new rectangle:2,between zero:2,fully nonoverlapped:2,it worth:2,time doing:2,drawing can:2,so you’ll:2,might try:2,rectangles that:2,larger rectangles:2,copying code:2,its old:2,old location:2,resides at:2,erase rectangle:2,rectangle for:2,motion of:2,between different:2,which tends:2,identify and:2,and handle:2,Visual Quality:2,Quality A:2,the rectangles:2,same order:2,this caused:2,incorrect state:2,pixels one:2,Animation is:2,and brain:2,X 256-Color:2,book signing:2,Optimization an:2,was sure:2,her mouth:2,mouth was:2,As my:2,you didn’t:2,them no:2,the theory:2,theory that:2,more people:2,Neither do:2,the mystery:2,the phrase:2,about Mode:2,us get:2,better place:2,DDJ columns:2,columns that:2,and 32:2,in equal:2,pixel spacing:2,and vertically:2,displays and:2,primitives and:2,a circle:2,process In:2,X allows:2,animation Mode:2,VGA’s plane-oriented:2,plane-oriented hardware:2,pixel In:2,caching schemes:2,offscreen memory:2,free for:2,16-color VGA:2,programming can:2,often as:2,flat bitmap:2,bitmap of:2,the flat:2,talk to:2,not using:2,have taken:2,it perform:2,no mean:2,chapters exploring:2,rectangle fills:2,and yes:2,X from:2,we’ll let:2,up mode:2,X by:2,that The:2,been around:2,first version:2,fixed-frequency VGA:2,didn’t come:2,shipped to:2,I modified:2,the 25-MHz:2,25-MHz clock:2,change that:2,frames were:2,rate than:2,they should:2,invisible and:2,here as:2,how difficult:2,component from:2,software in:2,in short:2,the price:2,to double:2,fact possible:2,modes lack:2,out individual:2,continues with:2,pixel N:2,P of:2,pixel code:2,pixel written:2,provided the:2,copies and:2,it’s there:2,47.1 Mode:2,The plane:2,turn with:2,cycling from:2,designed from:2,X perspective:2,perspective The:2,weaknesses of:2,by pixel:2,performed and:2,memory Each:2,Each plane:2,is processed:2,doing an:2,a fading-in:2,fading-in effect:2,images because:2,columns for:2,47.5 is:2,2.5 times:2,at clearing:2,fill routine:2,is admittedly:2,in four:2,copying to:2,X an:2,to Mode:2,to fan:2,features for:2,plane contains:2,each CPU:2,pixels could:2,byte-sized write:2,operations like:2,47.2 Selecting:2,Selecting planes:2,four-pixel set:2,ends and:2,are modified:2,Mode X’s:2,However Mode:2,Listing 47.7:2,beginning to:2,I’m so:2,256-color VGA:2,by as:2,end users:2,users care:2,about results:2,results not:2,48.1 How:2,loaded Figure:2,48.2 Writing:2,Writing 4:2,chapter that:2,latch can:2,with every:2,with pixels:2,patterned fills:2,fills and:2,are widely:2,function called:2,called by:2,each half:2,fact be:2,multiple-of-four widths:2,Listing 48.2:2,double copying:2,copying process:2,information directly:2,only from:2,memory we:2,whatever is:2,screen As:2,X animation:2,program Figure:2,48.3 shows:2,are reserved:2,after images:2,48.3 A:2,A useful:2,useful Mode:2,memory layout:2,a solid-colored:2,background page:2,the solid:2,same nibble:2,nibble alignment:2,modulo four:2,corresponding destination:2,fast VLB:2,from main:2,latches Listing:2,important limitation:2,proper handling:2,top-to-bottom left-to-right:2,scrolls require:2,copy images:2,this discussion:2,handling if:2,I’ll address:2,secret is:2,display memory-to-display:2,memory copy:2,do us:2,get pixel:2,final piece:2,images rather:2,could manage:2,point it’s:2,it’s getting:2,getting to:2,build an:2,animation application:2,application I:2,that far:2,of tree:2,kick off:2,off this:2,one night:2,word processor:2,us we:2,memory block:2,block copies:2,objective is:2,by block:2,separate from:2,a pixel-by-pixel:2,pixel-by-pixel basis:2,which destination:2,a masked:2,masked copy:2,belonging to:2,perfectly into:2,background with:2,effect is:2,no separate:2,transparent copying:2,mask byte:2,encountered and:2,as explained:2,possible alignments:2,Given all:2,four image:2,of selecting:2,the destination’s:2,destination’s left:2,Listing 49.2:2,MaskedImage structure:2,masks are:2,form Given:2,that given:2,Listing 49.3:2,language but:2,I prefer:2,49.1 and:2,and 49.2:2,no clipping:2,clipping code:2,low-level Mode:2,X routines:2,49.1 for:2,clipping at:2,source images:2,distinction between:2,low level:2,separate parameters:2,and flexibility:2,the disadvantages:2,separate book:2,before attacking:2,are Computer:2,by Newman:2,Newman and:2,and Sproull:2,X so:2,the nondisplayed:2,nondisplayed page:2,is flipped:2,the kites:2,This continues:2,shot of:2,your imagination:2,49.1 An:2,An animated:2,animated Mode:2,X screen:2,jerky on:2,30 frames:2,interference or:2,or fringe:2,readily apparent:2,all look:2,object list:2,objects at:2,There’s much:2,Adding a:2,programming micros:2,wasn’t much:2,done otherwise:2,just for:2,a willingness:2,available The:2,filed away:2,Three-dimensional animation:2,information needed:2,seemed more:2,had I:2,In those:2,they seem:2,Actually it’s:2,With this:2,some fun:2,inevitably be:2,material I:2,earlier ones:2,because with:2,on 3-D:2,3-D Drawing:2,Practice Second:2,topic and:2,it nonetheless:2,basic 3-D:2,realtime on:2,six books:2,graphics but:2,theory and:2,global variables:2,variables with:2,touches on:2,many aspects:2,up A:2,books as:2,these books:2,3-D object:2,built out:2,screen For:2,avoid complications:2,as clipping:2,defined in:2,scaling and:2,and moving:2,fully defined:2,by transformation:2,its vertices:2,polygon just:2,transforms the:2,in world:2,space it:2,space defined:2,looking down:2,straight up:2,projected X:2,coordinate systems:2,hand with:2,your fingers:2,the thumb:2,points along:2,rotation from:2,axis are:2,origin The:2,for object:2,viewer along:2,a view:2,far away:2,50.1 The:2,pipeline Figure:2,50.2 A:2,A right-handed:2,right-handed coordinate:2,backward from:2,final image:2,for projection:2,is assumed:2,axis in:2,a perspective:2,distance of:2,point from:2,triangles as:2,projection has:2,if desired:2,Y and:2,through space:2,Translation is:2,addition for:2,axis Translation:2,into world:2,50.3 Perspective:2,in object:2,map into:2,matrix by:2,50.4 3-D:2,rotation formulas:2,3x3 rotation:2,also perform:2,translation and:2,making it:2,3-D space:2,polygon around:2,space with:2,arrow keys:2,keys and:2,the A:2,away and:2,and T:2,transform and:2,functionality and:2,polygon complete:2,4x4 Transformation:2,Transformation Matrix:2,2-D animation:2,animation framework:2,Chapters 47:2,47 48:2,48 and:2,and 49:2,about in:2,2-D element:2,could avoid:2,Listing 50.1:2,Chapters 38:2,then clipping:2,we shall:2,shall see:2,polygon each:2,it’s drawn:2,matrix multiplication:2,Listing 50.3:2,draws polygons:2,general header:2,Listing 50.5:2,50.5 is:2,are Listings:2,the FillConvexPolygon:2,38 All:2,All necessary:2,modules along:2,a project:2,project file:2,the subdirectory:2,whether they:2,were presented:2,some earlier:2,earlier chapter:2,from previous:2,may crowd:2,crowd the:2,diskette a:2,little bit:2,bit but:2,certainly reduce:2,reduce confusion:2,and view:2,space are:2,view is:2,with changing:2,matrices to:2,matrix entries:2,entries that:2,rotation to:2,sines and:2,and cosines:2,one axis:2,positive Z:2,the projection:2,point but:2,coordinates The:2,The polygon:2,polygon being:2,time goes:2,is working:2,percent is:2,we look:2,look to:2,jaggies crawling:2,crawling along:2,this should:2,are facing:2,will enable:2,and cubes:2,arithmetic to:2,in Space:2,objects on:2,contains no:2,in three-space:2,This involves:2,what’s actually:2,other or:2,topographic detail:2,the asteroids:2,it you’ll:2,miles into:2,other areas:2,you’d think:2,think Consider:2,simplifying assumptions:2,complex scene:2,floating in:2,Hecker for:2,it’s good:2,quest for:2,basic polygon:2,way from:2,definition in:2,space through:2,the shared:2,3-D world:2,space we:2,performed a:2,projection to:2,space then:2,polygon rotated:2,isn’t necessarily:2,visible the:2,and simplify:2,simplify the:2,or outside:2,outside face:2,average half:2,removal For:2,single convex:2,all hidden:2,polygon facing:2,viewer can:2,obscured by:2,other polygon:2,facing toward:2,viewer but:2,but none:2,and hidden:2,solves the:2,if there’s:2,handled in:2,how do:2,actually do:2,equation for:2,edges The:2,original vectors:2,vector perpendicular:2,visible if:2,need one:2,either way:2,51.1 The:2,vectors Figure:2,outside that:2,viewer we’ll:2,Z means:2,not The:2,calculated very:2,perform backface:2,visible to:2,provide that:2,not reflect:2,51.2 Using:2,performed using:2,as implemented:2,length or:2,two points:2,space rather:2,solid cube:2,cube in:2,Listing 51.2:2,50 draw:2,draw clipped:2,38.1 from:2,be present:2,keys may:2,left right:2,viewer The:2,the axis:2,horizontally across:2,keys are:2,51.3 Sample:2,Sample screens:2,screens from:2,3-D cube:2,cube program:2,been stored:2,the object’s:2,be manipulated:2,only eight:2,eight vertices:2,coordinates rather:2,to flag:2,moved with:2,51.4 The:2,object data:2,above optimizations:2,complexity possible:2,three axes:2,axes to:2,a rotation:2,matrix are:2,of floating-point:2,The cube:2,rotations ever:2,of precision:2,into it:2,Each object:2,of faces:2,single vertex:2,saw that:2,viewer it:2,space vertices:2,some sorts:2,accounting for:2,for collision:2,space can’t:2,as view:2,collision detection:2,all these:2,X-Sharp The:2,and headed:2,the alternative:2,spent on:2,65 sixth:2,sixth graders:2,Never mind:2,with 65:2,children and:2,part was:2,I bet:2,quality issues:2,our 3-D:2,we’ve used:2,floating-point processor:2,the microcomputer:2,will give:2,different sorts:2,so forth:2,mass of:2,and The:2,files are:2,X-Sharp Listings:2,nearly complete:2,Objects are:2,their entirety:2,devised for:2,shading or:2,radically different:2,objects such:2,be supported:2,different cubes:2,book I:2,a name:2,a flat:2,3-D library:2,More interesting:2,removal by:2,the cubes:2,drawing them:2,as will:2,I’m working:2,this last:2,learned and:2,implementations in:2,chapter subdirectories:2,This chapter’s:2,to extract:2,X-Sharp version:2,X-Sharp in:2,Performance As:2,I’m presenting:2,second fps:2,slow VGA:2,accordingly The:2,The keys:2,chapters we:2,now stored:2,fixed-point numbers:2,16.16 16:2,of fraction:2,integer operations:2,fixed-point multiplication:2,performance key:2,divide instructions:2,multiplications and:2,and divisions:2,are fairly:2,for division:2,and operating:2,on only:2,vector in:2,matrix and:2,This saves:2,dozen lines:2,at 15:2,techniques we’ve:2,be reasonable:2,It sure:2,sure is:2,is nice:2,creep in:2,deterioration of:2,example by:2,viewer moves:2,a front:2,front clip:2,certainly still:2,overhead in:2,to FixedMul:2,FixedMul and:2,and FixedDiv:2,FixedDiv is:2,Much of:2,that shortly:2,out it’s:2,story about:2,By and:2,the boys:2,piled into:2,could and:2,the hall:2,elevator doors:2,his friends:2,The universe:2,Speed Part:2,development of:2,order In:2,fixed-point math:2,the fixed-point:2,iteration of:2,and ConcatXforms:2,our optimization:2,doesn’t show:2,major drags:2,sin and:2,and cos:2,what was:2,tenths of:2,enough control:2,purposes if:2,X-Sharp is:2,dragon of:2,look good:2,example all:2,all objects:2,be convex:2,objects can:2,end the:2,objects The:2,latter approach:2,when objects:2,overlap in:2,This limited:2,each object:2,properly Figure:2,don’t intersect:2,trust that:2,z coordinate:2,support this:2,center point:2,point for:2,transformed along:2,Y Figure:2,53.1 Why:2,Why back-to-front:2,visibly after:2,they’ve been:2,seen any:2,rounding is:2,errors are:2,errors become:2,Even with:2,will eventually:2,accumulate over:2,reasonable to:2,the demonstration:2,demonstration program:2,a 72-sided:2,72-sided ball:2,in INITBALL.C:2,the Colors:2,Colors array:2,and face:2,have here:2,the prototype:2,prototype for:2,Certainly it:2,editing tool:2,tool and:2,one chapter:2,they’re much:2,other approach:2,approach In:2,have known:2,known better:2,I’ve gotten:2,a hint:2,of FIXED.ASM:2,8088 instructions:2,can animate:2,60 frames:2,of adding:2,divide but:2,a 32x16:2,a 32x32:2,more work:2,divide or:2,In X-Sharp:2,of projecting:2,the non-386:2,non-386 version:2,divide-by-zero error:2,world the:2,brightly it:2,is illuminated:2,illumination of:2,surface or:2,shading components:2,Ambient shading:2,is illumination:2,illumination by:2,strikes a:2,surface determines:2,both ambient:2,Each surface:2,between 0:2,means all:2,of light:2,light energy:2,the brightest:2,brightest possible:2,and blue—and:2,red reflectance:2,displayed red:2,blue color:2,although of:2,though In:2,of directed:2,strikes the:2,the surface’s:2,red diffuse:2,product denoted:2,cos(q v•w:2,w are:2,are unit:2,unit long:2,above equation:2,equation reduces:2,reduces to:2,vector of:2,three multiplies:2,vector must:2,be reversed:2,source as:2,54.1 Illumination:2,Illumination by:2,source Figure:2,summing the:2,each light:2,Listing 54.2:2,blue shadings:2,each directed:2,normal we:2,by generating:2,a cross-product:2,normal then:2,scaling to:2,square root:2,X-Sharp’s polygon:2,first vertex:2,polygon’s vertex:2,second point:2,normal for:2,The unit:2,polygon data:2,54.4 The:2,The reversed:2,reversed light:2,source vector:2,are infinitely:2,are parallel:2,spotlight’s unit:2,points at:2,two unit:2,program DEMO1:2,DEMO1 in:2,displaying a:2,rotating ball:2,lighting sources:2,on However:2,source polygon:2,the demo:2,is fundamentally:2,256-color palette:2,about some:2,Color Model:2,I wondered:2,whenever I:2,said But:2,Okay I:2,said What:2,a parable:2,parable about:2,of defining:2,X-Sharp for:2,sources and:2,color intensity:2,shading calculations:2,we map:2,map each:2,RGB model:2,model a:2,three color:2,is 0.0*R:2,cube Figure:2,55.1 The:2,The RGB:2,color cube:2,RGB is:2,other colors:2,the primaries:2,represented in:2,eight bits:2,is described:2,in New:2,colors on:2,colors with:2,that everyone:2,about 16000000:2,16000000 colors:2,sources such:2,really only:2,It’s the:2,rather from:2,three primaries:2,So it’s:2,adapter’s color:2,pretty obvious:2,mentioned at:2,for general:2,RGB space:2,subspace This:2,the DEMO1:2,and ModelColorToColorIndex:2,color mapping:2,colors red:2,most drawing:2,rendering quality:2,general RGB:2,press the:2,blue spotlight:2,it gets:2,use only:2,palette for:2,those objects:2,Kent author:2,the scope:2,scope of:2,shading The:2,good news:2,falls on:2,results can:2,indeed A:2,Finally a:2,what’s known:2,character was:2,we’re drawing:2,because for:2,there but:2,More important:2,the BitMan’s:2,55.2 Drawing:2,Drawing solid:2,problem we:2,55.3 The:2,may help:2,The BitMan’s:2,clip to:2,most suitable:2,the Pooh:2,lives in:2,station orbiting:2,orbiting Saturn:2,daughter and:2,there you:2,location for:2,station is:2,course and:2,Or the:2,out into:2,core and:2,hat to:2,interesting If:2,fast texture:2,of mapping:2,that’s been:2,we’ve drawn:2,lighting but:2,Thus in:2,of scene:2,station and:2,to quickly:2,transformed destination:2,bitmap as:2,intuitive to:2,any destination:2,pixels may:2,be skipped:2,skipped or:2,necessarily a:2,56.1 Using:2,Using reverse:2,Mapping Textures:2,how we’re:2,maps a:2,become clearer:2,done when:2,appropriate part:2,56.2 Mapping:2,polygon Now:2,source bitmap:2,angle as:2,transformed vertex:2,step a:2,image edge:2,equivalent amount:2,divide the:2,SourceXWidth and:2,and SourceYHeight:2,source edge:2,is stepped:2,DestYHeight times:2,edge The:2,56.3 Mapping:2,rotated polygon:2,edges through:2,technique as:2,step DestXWidth:2,DestXWidth times:2,line DestXWidth:2,SourceXStep and:2,and SourceYStep:2,to SourceX:2,copy to:2,names used:2,for 2-D:2,polygons where:2,and projections:2,that’s needed:2,happens automatically:2,polygonal area:2,given only:2,56.4 Mapping:2,a horizontal:2,horizontal destination:2,line back:2,image Figure:2,56.5 Mapping:2,a narrower:2,narrower polygon:2,mapping This:2,it DDA:2,improve image:2,quality by:2,Or we:2,Chapter 57:2,and average:2,are nearly:2,in 3-space:2,textures on:2,polygons at:2,angle to:2,detailed surfaces:2,texture-mapped polygons:2,been made:2,mapping code:2,mapping looks:2,surfaces where:2,the shearing:2,and aliasing:2,the rotational:2,mapping textures:2,finely detailed:2,normal polygon:2,in DEMO1:2,mapper and:2,some rough:2,a bear:2,say he:2,remember when:2,it here:2,help me:2,The fellow:2,giving the:2,you’ll know:2,was there:2,sound particularly:2,me He:2,really good:2,10 years:2,of wisdom:2,good chunk:2,lot in:2,looking in:2,that’s very:2,something less:2,least at:2,were still:2,faster rotation:2,the aliasing:2,the rotating:2,maps and:2,a collection:2,demo on:2,images together:2,into continuous:2,can give:2,draw those:2,was important:2,and outside:2,without either:2,an all-integer:2,for polygon:2,Fixed-point arithmetic:2,mapping would:2,all adjacent:2,end vertices:2,polygons should:2,for stepping:2,otherwise we:2,texture-mapping code:2,flaw was:2,standard polygon:2,polygon inside/outside:2,that mapped:2,mapped exactly:2,exactly to:2,edges were:2,were considered:2,bottom destination:2,be outside:2,different edges:2,the orientation:2,map This:2,57.1 Gaps:2,Gaps caused:2,mixing fixed-point:2,all-integer math:2,when mapping:2,source Instead:2,double-DDA texture:2,polygon A:2,single texture:2,across any:2,of adjacent:2,share vertices:2,texture across:2,across two:2,surfaces such:2,up close:2,a texture-mapped:2,calculated and:2,57.1 Listing:2,the set-pixel:2,drawing or:2,copy rotates:2,final optimization:2,looks very:2,y coordinate:2,makes Listing:2,Indeed it:2,of opinion:2,Spock’s Brain:2,Approach to:2,Robert A:2,Blowups Happen:2,nuclear power:2,had ever:2,ever happened:2,Solution Unsatisfactory:2,in Between:2,Between Planets:2,the widespread:2,than are:2,the engineers:2,the nuclear:2,the occasional:2,viewed the:2,this process:2,how you’ll:2,process but:2,problem becomes:2,that someone:2,graphics library:2,exercise in:2,good 3-D:2,can represent:2,mapper was:2,into 3-D:2,3-D and:2,from his:2,be for:2,took on:2,44 cycles:2,Listing 58.1:2,could eliminate:2,fully unrolled:2,with several:2,58.1 Texture:2,horizontal scanline:2,scanline Figure:2,pixel across:2,a scanline:2,of 30:2,John’s 9:2,plane control:2,control out:2,58.2 Display:2,boundary cases:2,was perfectly:2,been very:2,have suffered:2,came along:2,Conference in:2,megahit DOOM:2,write games:2,sometimes it’s:2,a 90-degree:2,change not:2,That’s exactly:2,given how:2,60 cycles:2,latter case:2,bottom and:2,and scanning:2,assumptions based:2,all my:2,with Chris’s:2,Chris’s approach:2,relaxed and:2,them Figure:2,58.3 Texture:2,single vertical:2,vertical column:2,column-oriented texture:2,tweaking the:2,the directory:2,another important:2,as John:2,I start:2,process with:2,and finish:2,destination pointer:2,it consists:2,first MOV:2,scanline to:2,and advance:2,pointer with:2,coordinates In:2,parts are:2,integer parts:2,58.4 Original:2,Original method:2,integer advance:2,then add:2,part carries:2,carries and:2,add in:2,well thereby:2,segment will:2,Y fraction:2,at zero:2,can similarly:2,amounts in:2,in Y:2,58.5 Efficient:2,Efficient method:2,advancing source:2,58.6 Storing:2,Storing both:2,fractional coordinates:2,pointer by:2,fractional addition:2,This requires:2,and our:2,to want:2,we’re guaranteed:2,them That:2,misses when:2,texture will:2,any angle:2,a decent:2,has just:2,Pentium stalls:2,stalls but:2,them because:2,takes 1:2,The type:2,do perspective:2,polygons not:2,did he:2,he used:2,didn’t take:2,efficient implementation:2,irrelevant to:2,optimization efforts:2,Chapter 59:2,Wendy Tucker:2,Camp Chingacook:2,lots more:2,never had:2,any interest:2,I ever:2,memory was:2,back storeroom:2,days ago:2,in 20:2,20 years:2,surface I:2,15 minutes:2,minutes I:2,completely different:2,Wendy’s name:2,appealing because:2,whatever comes:2,and intuitive:2,intuitive leaps:2,for and:2,scale that’s:2,trees First:2,games are:2,element is:2,use BSP:2,trees aren’t:2,ingenuity and:2,begin I’d:2,thank John:2,Carmack the:2,behind DOOM:2,DOOM for:2,that subdivides:2,two children:2,subspaces into:2,more parts:2,each subspace:2,until each:2,each component:2,or polygon:2,own unique:2,Building a:2,a structure:2,trees as:2,makes BSP:2,line-of-sight determination:2,discuss only:2,to traverse:2,segments or:2,front-to-back order:2,traversal can:2,very helpful:2,from directly:2,directly above:2,visibility determination:2,front-to-back traversal:2,linear time:2,polygon list:2,BSP-based rendering:2,stacks up:2,up well:2,huge chunks:2,or volume:2,volume of:2,children of:2,volume for:2,trees Figure:2,The painter’s:2,trees is:2,a BSP-tree:2,BSP-tree compiler:2,that attempts:2,attempts to:2,example can:2,scene but:2,much use:2,each move:2,possibility would:2,BSP-based world:2,traversal and:2,involving moving:2,falls entirely:2,entirely within:2,single subspace:2,be treated:2,processed by:2,which BSP:2,compiler I’ll:2,visually depicts:2,depicts the:2,discussion will:2,of figures:2,only 2-D:2,their 3-D:2,trees using:2,trees are:2,above so:2,tree Note:2,59.2 A:2,59.2 but:2,one wall:2,subspace would:2,This splitting:2,59.3 Initial:2,Initial split:2,split along:2,only wall:2,Wall A:2,from wall:2,wall A:2,B Figure:2,59.4 Split:2,59.5 Split:2,assigned to:2,a subspace:2,BSP node:2,nearer and:2,is farther:2,59.7 The:2,C this:2,front tree:2,back tree:2,viewpoint we:2,same far-near:2,node Figure:2,back-to-front traversal:2,node we:2,whether we’re:2,then visit:2,far side:2,wall and:2,child is:2,59.6 The:2,final BSP:2,59.7 Viewing:2,Viewing the:2,angle The:2,current subspace:2,single member:2,be traversed:2,front-to-back ordering:2,59.8 Back-to-front:2,Back-to-front traversal:2,viewed in:2,tree walk:2,back-to-front BSP:2,BSP traversal:2,traversal is:2,Listing 59.1:2,tree back-to-front:2,decision whether:2,facing forward:2,a viewspace:2,the decision:2,that BSP:2,by detecting:2,collinear surfaces:2,each collinear:2,collinear set:2,got me:2,inorder tree:2,recursively to:2,been visited:2,the left-subtree:2,on I’ll:2,the understanding:2,yet I:2,tree in:2,Listings 59.2:2,59.2 and:2,59.9 An:2,An inorder:2,to rewrite:2,had anyone:2,by trial:2,trial and:2,a data-recursive:2,between that:2,If they:2,each iteration:2,same underlying:2,underlying model:2,model For:2,node visit:2,subtree if:2,then I’ll:2,stack that:2,tells me:2,nothing left:2,error that:2,of right:2,children visited:2,node after:2,visited and:2,of special:2,and apply:2,children the:2,tree then:2,Visual C:2,node has:2,that half:2,efficient with:2,recursion in:2,and consistent:2,With each:2,your design:2,this information:2,effort in:2,but fortunately:2,February 1996:2,Web page:2,http www.qualia.com/bspfaq:2,1990 pp:2,Visible Surface:2,Compiling BSP:2,Reality As:2,my columns:2,know I:2,I tend:2,my family:2,to every:2,column for:2,great time:2,for years:2,game machine:2,of great:2,of Commander:2,DDJ s:2,bulletin board:2,there who:2,hired Chris:2,showed me:2,the guy:2,of mail:2,mail and:2,up my:2,out he:2,steadily more:2,writing some:2,when John:2,started doing:2,that then:2,When John:2,3-D the:2,was thinking:2,I’d known:2,or had:2,good things:2,that run:2,through our:2,far back:2,whatever you:2,closely related:2,John is:2,fellow who:2,article is:2,BSP optimization:2,chapter a:2,Then it:2,surfaces into:2,splitting surfaces:2,they cross:2,recursively until:2,surfaces have:2,node carves:2,root’s children:2,on with:2,a splitter:2,and assigning:2,splitting any:2,choosing splitters:2,of splitting:2,form with:2,with y:2,y as:2,of x:2,y are:2,60.1 shows:2,describes how:2,far along:2,segment the:2,however only:2,simplicity but:2,we’ll represent:2,all vertical:2,providing a:2,of t:2,60.1 A:2,sample parametric:2,60.2 Line:2,Line segment:2,segment storage:2,storage in:2,Clipping In:2,Equation 1:2,Equation 3:2,start point:2,xy form:2,segment being:2,split again:2,equation and:2,the denominator:2,we split:2,work of:2,60.3 How:2,How line:2,intersection is:2,normals to:2,to splitting:2,In 3-D:2,could calculate:2,compile as:2,that tree:2,uses parametric:2,below and:2,be because:2,subdivision of:2,CD-ROM in:2,discuss how:2,wall to:2,difficult problem:2,one node:2,and rendering:2,to answer:2,several possible:2,thereby reducing:2,planes aligned:2,are split:2,fewer polygons:2,polygon splits:2,originally tried:2,if each:2,level might:2,10000 polygons:2,choosing as:2,node the:2,Beatles songs:2,makes them:2,those songs:2,daughter’s frame:2,four years:2,is having:2,coordinates from:2,one coordinate:2,another for:2,example from:2,viewspace The:2,can talk:2,a BSP-based:2,renderer to:2,recent months:2,asked what:2,is there’s:2,two basic:2,stuff like:2,dot and:2,most people:2,3-D operations:2,other thing:2,understand either:2,products I’m:2,tools and:2,some math:2,a direction:2,the Real:2,Real McCoy:2,a left-handed:2,left-handed coordinate:2,fingers of:2,your left:2,left hand:2,positive x:2,positive y:2,y axis:2,projection is:2,to worldspace:2,points from:2,translating moving:2,The Dot:2,Product Now:2,a dot:2,what does:2,of much:2,equation 3:2,as calculated:2,to eq:2,application in:2,the fraction:2,61.1 The:2,product Figure:2,s is:2,of illumination:2,direction vector:2,normal If:2,surface unit:2,point that’s:2,points This:2,way too:2,right angles:2,viewspace but:2,screenspace Figure:2,61.2 The:2,product as:2,calculating lighting:2,any scene:2,negative z:2,be culled:2,normal has:2,and vice-versa:2,vice-versa as:2,readily be:2,61.3 A:2,A problem:2,with determining:2,determining front/back:2,front/back visibility:2,just any:2,surface This:2,61.4 How:2,edge vectors:2,vectors generates:2,products is:2,first vector:2,vector that’s:2,the axes:2,the Dot:2,vectors scaled:2,degrees and:2,exactly 90:2,suffices for:2,viewspace then:2,into screenspace:2,Calculate the:2,polygon’s normal:2,viewpoint the:2,are culled:2,behind a:2,plane Just:2,product between:2,clipping but:2,product for:2,61.5 Backface:2,again but:2,the magnitude:2,the non-unit:2,non-unit vector:2,and remember:2,projected onto:2,61.6 How:2,vector performs:2,a projection:2,dot the:2,vector onto:2,segment with:2,The ratio:2,One problem:2,cosines and:2,actually going:2,two 3-D:2,that seemed:2,thought it:2,61.7 Using:2,point onto:2,onto each:2,this involves:2,three dot:2,multiplication in:2,new way:2,new frame:2,experience has:2,been that:2,61.8 Rotation:2,Rotation to:2,space by:2,projection onto:2,BSP Renderer:2,Quake id:2,flipping as:2,to video:2,I assumed:2,counters to:2,of writes:2,writes performed:2,Pentium counters:2,performed but:2,writing an:2,time without:2,the memcpy:2,DOS version:2,done any:2,possibilities and:2,rendering from:2,recall the:2,carved into:2,62.1 Vertical:2,Vertical walls:2,represent them:2,polygons interpenetrate:2,farther subtree:2,Applied recursively:2,recursively from:2,order Listing:2,62.1 draws:2,polygon rasterizer:2,CD-ROM as:2,viewspace the:2,wall vertices:2,partially in:2,you move:2,move about:2,of movement:2,key-handling code:2,in x:2,horizontally Although:2,two rooms:2,The viewing:2,direction can:2,of viewspace:2,viewspace and:2,project points:2,In viewspace:2,clipped walls:2,drawn In:2,each end:2,we leave:2,plane by:2,by z:2,constant z:2,in z:2,edges After:2,frustum and:2,62.2 Clipping:2,stage is:2,is clipping:2,clipped at:2,in y:2,in ClipWalls:2,trivial rejection:2,our earlier:2,polygon point:2,point can:2,z 0:2,that’s at:2,62.3 Why:2,Why y:2,y clipping:2,than x:2,z clipping:2,Culling and:2,had expected:2,both visible:2,polygon The:2,screenspace then:2,vertex as:2,screenspace x:2,walking the:2,here that:2,be projected:2,62.4 Fast:2,Fast backspace:2,backspace culling:2,culling test:2,test in:2,rendering engine:2,a learning:2,for floors:2,advantages in:2,with viewing:2,to debug:2,walls floors:2,the boundaries:2,that space:2,space The:2,subspaces are:2,than polygons:2,illumination and:2,a crisis:2,my mother:2,an aging:2,late 70s:2,car on:2,hand was:2,Volvo sedan:2,New Year’s:2,my senior:2,senior year:2,year I:2,night I:2,Alan was:2,beer and:2,and chips:2,way And:2,car so:2,an enormous:2,One thing:2,thing I:2,has proven:2,design issues:2,to reexamine:2,detect and:2,to simplify:2,a step:2,floating-point math:2,article of:2,of faith:2,doing 3-D:2,floating-point unit:2,FPU and:2,and FP:2,and precision:2,well One:2,3-D to:2,down into:2,FP operations:2,accelerators will:2,scene complexity:2,more vertices:2,project and:2,By way:2,x86 FP:2,www.intel.com http:2,FSUB FMUL:2,and FDIV:2,for these:2,the FP:2,memory there’s:2,FDIV is:2,39 cycles:2,precision which:2,FDIV executes:2,until FDIV:2,while FDIV:2,integer unit:2,unit can:2,can simultaneously:2,have three:2,an FDIV:2,FDIV and:2,second cycle:2,though if:2,FP instruction:2,FSUB or:2,or FMUL:2,an FST:2,of starting:2,starting an:2,FSUB and:2,cycle so:2,N 3:2,FSUB is:2,of calculation:2,FMUL is:2,be issued:2,FPU can:2,has completed:2,into ST(0:2,ST(0 and:2,from ST(0:2,of independent:2,FXCH is:2,FXCH to:2,for common:2,v_2 u_3:2,theoretical minimum:2,cycles Listing:2,Listing 63.2:2,Listing 63.3:2,be interleaved:2,interleaved with:2,product code:2,there’s plenty:2,Listing 63.4:2,We couldn’t:2,three is:2,magic number:2,of latency:2,of properly:2,viewspace is:2,4x4 transformation:2,work than:2,implementation however:2,separate dot:2,and additions:2,dot-product code:2,to cache:2,to screenspace:2,much with:2,chop mode:2,Hecker’s column:2,Developer for:2,to floating-point:2,floating-point is:2,Determination The:2,All Things:2,had worked:2,months to:2,all he:2,show for:2,he tried:2,FIFO between:2,went into:2,the FIFO:2,FIFO allowing:2,one-deep FIFO:2,to Tom’s:2,video output:2,news about:2,about Paradise’s:2,Paradise’s chip:2,the Paradise:2,limits you:2,success but:2,less code:2,which everything:2,falls into:2,how all:2,first because:2,don’t happen:2,they happen:2,detailed lighting:2,and players:2,toughest 3-D:2,non-visible polygons:2,VSD to:2,and culling:2,VSD is:2,as texture:2,as 3-D:2,of VSD:2,I expect:2,become increasingly:2,level The:2,in overhead:2,overhead view:2,view in:2,order can:2,leaves in:2,in front-to-back:2,given leaf:2,convex polyhedra:2,pyramid and:2,clip away:2,are partially:2,actually need:2,64.1 Quake’s:2,Quake’s polygons:2,as empty:2,empty leaves:2,leaves Figure:2,64.2 Pixels:2,Pixels visible:2,are outside:2,entirely clipped:2,doesn’t scale:2,well though:2,add more:2,aren’t visible:2,into all:2,64.3 The:2,The substance:2,substance described:2,by node:2,node E:2,bounding spheres:2,culling to:2,back-to front:2,problem John:2,when he:2,those polygons:2,10 times:2,times or:2,rasterizer is:2,John faced:2,was how:2,be ideal:2,balancing act:2,overdraw that:2,for Wolfenstein:2,engines in:2,of perhaps:2,design was:2,try new:2,draw front-to-back:2,2-D region:2,region describing:2,empty areas:2,design the:2,beam was:2,was marked:2,new polygon:2,tree front-to-back:2,that polygon:2,64.4 Partitioning:2,Partitioning the:2,2-D regions:2,regions Figure:2,64.5 Beams:2,Beams as:2,as wedges:2,wedges projecting:2,beam plane:2,plane a:2,the ray:2,ray to:2,BSP nodes:2,frustum The:2,arise from:2,numeric precision:2,processing slowed:2,scale well:2,my office:2,well enough:2,that like:2,operation because:2,adjacent rays:2,surface then:2,ray is:2,on adjacent:2,pixels then:2,fast clipping:2,overdraw but:2,off each:2,rasterized into:2,spans which:2,global span:2,nearest span:2,where polygons:2,portals that:2,2-D visibility:2,the visibility:2,the look:2,portals he:2,precalculating and:2,leaf a:2,all leaves:2,then at:2,leaf the:2,a concern:2,several megabytes:2,bit vector:2,the BSPer:2,20 Kb:2,PVS are:2,leaf so:2,John says:2,was clearly:2,rasterizer that:2,Simplify and:2,keep trying:2,mapping with:2,the numbers:2,caching can:2,that almost:2,what John:2,visibility and:2,PVS The:2,out pretty:2,that id:2,allowing me:2,how Quake:2,Quake works:2,posting on:2,3-D Clipping:2,Our part:2,changing and:2,agree that:2,a dime:2,dime a:2,the writing:2,the ideas:2,an attitude:2,software patents:2,and published:2,knowledge base:2,they work:2,who thinks:2,idea but:2,that programming:2,talked about:2,hoped to:2,the street:2,actually got:2,got around:2,whether and:2,is considered:2,side on:2,an outside:2,polygon clipping:2,Sometimes this:2,includes clipping:2,to restrict:2,entirely inside:2,or completely:2,clip those:2,xyz coordinates:2,them are:2,points on:2,origin along:2,normal we’ll:2,clip the:2,not clipped:2,intersection between:2,normal returns:2,plane along:2,it touched:2,simple comparison:2,plane distance:2,the volume:2,After we:2,endpoint we:2,know everything:2,y and:2,models which:2,clip volume:2,are implicitly:2,output polygon:2,a polygon-clipping:2,polygon-clipping function:2,65.1 The:2,The distance:2,endpoint measured:2,65.2 Clipping:2,applied in:2,turn to:2,texture mapped:2,another one:2,clipping if:2,emerge from:2,65.3 is:2,65.3 Clipping:2,in single-precision:2,it’s never:2,projected and:2,orientation of:2,viewplane normal:2,process all:2,plane it:2,starting on:2,clipping them:2,or viewspace:2,viewspace clipping:2,near or:2,of z:2,the viewplane:2,efficient clipping:2,view so:2,normalized clipping:2,clipping mechanism:2,Procedural Elements:2,anyone who’s:2,years since:2,the Beatles:2,I drove:2,the radio:2,my car:2,alternative rock:2,no surprise:2,reminded me:2,adequately well:2,a precalculated:2,precalculated potentially:2,simply draw:2,the back-to-front:2,removal HSR:2,was far:2,draw moving:2,primary problem:2,no easy:2,drawing sprites:2,doors and:2,moving models:2,single leaf:2,other and:2,compare its:2,nearer than:2,ceilings and:2,z-buffer with:2,process than:2,reads or:2,or compares:2,z-buffering and:2,sorting all:2,z-buffer is:2,320x200 is:2,8 MB:2,models In:2,do additional:2,simplified the:2,single BSP:2,average scene:2,step toward:2,its worst:2,worst in:2,polygons than:2,by nearer:2,Spans The:2,Quake would:2,cost would:2,from front-to-back:2,level to:2,sorted-spans approach:2,66.1 and:2,lot like:2,slow for:2,world although:2,66.1 Span:2,Span generation:2,are scanned:2,that z-buffering:2,spans and:2,is sorted:2,spans on:2,scanning of:2,sorting in:2,of sorted:2,span descriptors:2,that sorted:2,design choices:2,spans to:2,With span-sorting:2,span-sorting spans:2,x-sorted linked:2,list buckets:2,line Each:2,is rasterized:2,nearest spans:2,involves generating:2,66.2 Two:2,Two sets:2,With edge-sorting:2,edges for:2,is scanned:2,AEL is:2,are removed:2,is activated:2,APL as:2,leading or:2,or trailing:2,is nearest:2,just ended:2,nearest and:2,The spans:2,with edge-sorting:2,sorting clipping:2,spans so:2,span-sorting and:2,and edge-sorting:2,can involve:2,share edges:2,edges between:2,between adjacent:2,66.3 Activating:2,Activating a:2,AEL Figure:2,and concave:2,graphics engines:2,66.4 Deactivating:2,Deactivating a:2,feel most:2,most comfortable:2,detail about:2,for Chapter:2,by discussing:2,1/z calculation:2,to emit:2,a sorting:2,key in:2,possible If:2,order is:2,moving polygons:2,sort all:2,nicely with:2,z distances:2,calculate z:2,arbitrary point:2,vary linearly:2,does vary:2,of screenspace:2,gradients for:2,using 1/z:2,a 1/z:2,1/z at:2,interpolate between:2,where z:2,origin for:2,and d:2,calculated in:2,that Quake:2,1/z as:2,1/z from:2,we switched:2,polygons unsplit:2,fewer edges:2,are themselves:2,Sorting in:2,because these:2,order We:2,z-buffering for:2,models because:2,moving BSP:2,polygons so:2,unclear whether:2,Quake will:2,engines as:2,Independent Span:2,to sorting:2,spans by:2,dead weight:2,and builds:2,haven’t already:2,67.1 and:2,zero overdraw:2,BSP sequence:2,sequence number:2,sort keys:2,generating spans:2,leaves which:2,convex subspaces:2,that touch:2,This results:2,polygons which:2,world but:2,those models:2,split so:2,polygon falls:2,smaller polygons:2,clipped transformed:2,only we:2,BSP splits:2,clipping for:2,node’s volume:2,rocket stage:2,was really:2,been with:2,crop of:2,out but:2,Quake world:2,Quake In:2,3-D there:2,1/z Span:2,is distance:2,sorting with:2,and independent:2,sorting occurs:2,when polygons:2,spans have:2,67.1 Intersecting:2,sorting Figure:2,sorting used:2,and floors:2,additional sorting:2,whichever polygon:2,small epsilon:2,the epsilon:2,slowed things:2,67.2 Abutting:2,were it:2,no interpenetration:2,than doing:2,screen so:2,polygons being:2,of caching:2,67.1 uses:2,polygons except:2,continuous mesh:2,polygons it:2,extra calculations:2,independent 1/z:2,earlier program:2,program did:2,67.1 works:2,polygons In:2,rasterization is:2,67.1 because:2,spans from:2,A surface:2,in ScanEdges:2,those edges:2,processed from:2,that reach:2,surface Each:2,Each leading:2,event marking:2,span ends:2,ends for:2,span starts:2,starts for:2,new surface:2,Each trailing:2,trailing edges:2,not need:2,active surfaces:2,edge causes:2,causes its:2,emitted if:2,on is:2,clip all:2,valid screen:2,even be:2,infinite distance:2,vertices per:2,per polygon:2,vertex pool:2,edge only:2,if state:2,of vertex:2,nearly edge-on:2,that occurs:2,1/z with:2,calculated at:2,the gradient:2,or generating:2,is applied:2,Trek game:2,photon torpedoes:2,A typical:2,your next:2,the Star:2,Trek program:2,dove into:2,it One:2,better I:2,her out:2,out She:2,She said:2,though was:2,response when:2,was interested:2,else is:2,way I’ve:2,PVS and:2,static walls:2,players are:2,drawn using:2,A primary:2,sophisticated lighting:2,all viewing:2,viewing conditions:2,goals of:2,complex lighting:2,be difficult:2,lighting approaches:2,Gouraud Shading:2,The traditional:2,a lighting:2,lighting value:2,between lighting:2,Quake then:2,interpolated lighting:2,a 64x64:2,database size:2,and best:2,RGB modes:2,texel color:2,extension of:2,polygon model:2,are large:2,quality was:2,for world:2,geometry to:2,the subdivision:2,into several:2,extra polygons:2,overlapping lights:2,lights and:2,additional polygons:2,shadow edges:2,because otherwise:2,between light:2,geometry the:2,at t-junctions:2,the rasterization:2,rasterization load:2,68.1 Adding:2,Adding an:2,extra vertex:2,vertex directly:2,directly beneath:2,beneath a:2,in texture:2,mapping but:2,ways First:2,perspective lighting:2,an effect:2,viewing variance:2,shift as:2,clipping variance:2,variance that:2,lighting for:2,and interpolating:2,as Gouraud:2,a Gouraud-shaded:2,database and:2,rotationally invariant:2,of triangles:2,clipping or:2,68.2 How:2,How Gouraud:2,shading varies:2,polygon screen:2,screen orientation:2,geometry so:2,build Quake:2,triangles with:2,detailed geometry:2,had hoped:2,Quake The:2,moving entities:2,Phong shading:2,techniques in:2,John came:2,off-line preprocessing:2,additional lighting:2,required and:2,world with:2,lights in:2,grid points:2,results for:2,shading to:2,polygon’s texture:2,is tiled:2,tiled into:2,each texel:2,lit according:2,with perspective:2,no lighting:2,perspective-correct lighting:2,because lighting:2,in surface:2,surface space:2,lighting to:2,texels in:2,extra step:2,with almost:2,lit texel:2,2.25 cycles:2,texture-mapping inner:2,is roughly:2,it hard:2,and post-processing:2,68.3 Tiling:2,Tiling the:2,texels from:2,because polygons:2,sides and:2,texture tile:2,every surface:2,the rough:2,rough order:2,scene The:2,below but:2,every texel:2,slowing things:2,caching Surface:2,John immediately:2,surfaces so:2,the surface-caching:2,was implemented:2,texture tiles:2,many texels:2,distant polygons:2,surface size:2,and caching:2,level as:2,mipmapping is:2,of texels:2,distant surfaces:2,given surface:2,texelpixel ratio:2,68.4 How:2,How mipmapping:2,mipmapping reduces:2,reduces surface:2,caching requirements:2,the mipmap:2,nearest vertex:2,in distant:2,Dynamic lighting:2,lighting on:2,use surface:2,surfaces change:2,lighting at:2,surface caching’s:2,of procedural:2,be cached:2,effects because:2,for reuse:2,surface are:2,automatically drawn:2,what with:2,the oil:2,NESEC was:2,the student:2,parking lot:2,lot but:2,blocks away:2,of oil:2,oil in:2,and checked:2,computer center:2,told him:2,Don’t give:2,give me:2,later we:2,he have:2,he hadn’t:2,hours and:2,rational creatures:2,are you’ll:2,lighting without:2,accelerator chip:2,caching in:2,lighting not:2,on demand:2,the Verite:2,the software-only:2,software-only version:2,CPU builds:2,to download:2,download surfaces:2,the requirement:2,accelerator is:2,be downloaded:2,8-bpp surfaces:2,as expensive:2,in VQuake:2,4 MB:2,runs fine:2,to bilinear:2,bilinear texture:2,texture filtering:2,filtering which:2,caching does:2,caching without:2,retains the:2,splatters and:2,A similar:2,to 16-bpp:2,some accelerators:2,to light:2,much performance:2,doing two:2,alpha blending:2,be widely:2,CPUs and:2,next graphics:2,Drawing Triangle:2,game engine:2,of triangle:2,tiny triangles:2,per edge:2,Consequently we:2,for triangle:2,visibility For:2,back skins:2,skins stretched:2,would add:2,with affine:2,we snap:2,but again:2,degenerate triangles:2,cross-product z:2,taking only:2,model are:2,lighting level:2,An Idea:2,Idea that:2,that Didn’t:2,a model’s:2,model’s image:2,Our thinking:2,too expensive:2,we reused:2,reused them:2,3-D rendering:2,sprite architecture:2,code complexity:2,well if:2,blobs of:2,and working:2,is created:2,vertex at:2,two rasterizers:2,feet for:2,triangle-model drawing:2,affine rasterizer:2,snap to:2,of commands:2,while drawing:2,children in:2,world have:2,Frederik Pohl’s:2,the assumptions:2,designer productivity:2,about Quake’s:2,those chapters:2,overall structure:2,engine code-named:2,code-named Trinity:2,Quake’s overall:2,the spirit:2,Carmack’s Law:2,new fundamental:2,fundamental assumption:2,the World:2,BSP model:2,constructed from:2,polygons called:2,of leaves:2,an optimal:2,into leaves:2,polygons per:2,we then:2,marked polygons:2,BSP is:2,levels are:2,a player:2,leaf consists:2,radiosity lighting:2,lighting which:2,discuss later:2,are getting:2,server but:2,Pentium Pro:2,visibility from:2,client and:2,through walls:2,solid wall:2,of QuakeWorld:2,PHS to:2,has made:2,come through:2,for events:2,events like:2,the places:2,portals can:2,worlds than:2,PVS because:2,the portals:2,portals themselves:2,have many:2,John realized:2,polygon set:2,the PVS’s:2,level designers:2,a weekend:2,best cases:2,that passages:2,pan out:2,quite likely:2,is marked:2,avoids having:2,node are:2,are marked:2,as potentially:2,The edge:2,drawable edges:2,span lists:2,spans cover:2,cover every:2,nearer surfaces:2,drawable polygons:2,slows down:2,something better:2,lighting This:2,and t/z:2,reciprocal of:2,error but:2,the perspective-correct:2,smooth but:2,single pass:2,highly detailed:2,the splatter:2,Game Developer’s:2,Developer’s Conference:2,lighting that:2,lit surfaces:2,the affected:2,day or:2,without it:2,because Quake’s:2,polygon fragment:2,fragment is:2,sort properly:2,same leaf:2,relatively few:2,Polygon models:2,the artists:2,artists and:2,is standing:2,the polygon-model:2,seduced by:2,hardware rendering:2,per scene:2,without requiring:2,the subdivider:2,distance and:2,be up:2,we’ve ported:2,ported it:2,to Win32:2,Verite Quake:2,Quake It:2,and Verite:2,accelerators The:2,VQuake uses:2,then Verite:2,Verite DMAs:2,onboard memory:2,because hardware:2,downloading and:2,also worth:2,an OpenGL:2,looking and:2,in GLQuake:2,OpenGL drivers:2,GLQuake also:2,considered more:2,distant than:2,write it:2,silhouette into:2,mirror surface:2,a hole:2,hole is:2,is left:2,the z-range:2,and z-buffering:2,gaming is:2,QuakeWorld is:2,and perceived:2,with client-server:2,latency for:2,the round:2,round trip:2,latency is:2,reduce latency:2,the client’s:2,client’s virtual:2,virtual time:2,reduced latency:2,often makes:2,didn’t arrive:2,assumption and:2,unreliable packet:2,100 ms:2,latency The:2,latest server:2,than Quake:2,a tradeoff:2,porting effort:2,two trends:2,of detail:2,cracks and:2,and bumps:2,scene in:2,of LOD:2,worry that:2,a journal:2,cross-product equations:2,equations found:2,math book:2,the perpendicular:2,Melvyn was:2,imagine any:2,I worry:2,a text-only:1,text-only copy:1,the Black:1,Book modified:1,be suitable:1,for text/word:1,text/word prediction:1,prediction This:1,the github:1,github ebook:1,ebook version:1,the PDF:1,PDF version:1,was released:1,released for:1,in 2001:1,2001 Changes:1,Changes Removed:1,text with:1,with formatting:1,formatting eg:1,eg bold:1,bold and:1,and italic:1,italic ascii:1,ascii indicators:1,indicators Removed:1,Removed code:1,code listings:1,listings because:1,because it's:1,it's full:1,of not-words:1,not-words like:1,like assembly:1,assembly instructions:1,instructions Removed:1,Removed contents:1,contents formatting:1,formatting again:1,again Removed:1,Removed tables:1,tables Removed:1,any urls:1,urls Removed:1,Removed legal:1,legal blurb:1,blurb at:1,end because:1,it contains:1,contains personal:1,personal info:1,info and:1,and urls:1,urls Michael:1,Michael Abrash’s:1,Abrash’s Graphics:1,Programming Black:1,Book Special:1,Special Edition:1,Edition Michael:1,Abrash Introduction:1,Introduction What:1,What was:1,like working:1,Quake Like:1,Like being:1,being strapped:1,strapped onto:1,rocket during:1,during takeoff—in:1,takeoff—in the:1,hurricane It:1,It seemed:1,seemed like:1,whole world:1,world was:1,was watching:1,watching waiting:1,if id:1,Software could:1,could top:1,top Doom:1,Doom every:1,every casual:1,casual e-mail:1,e-mail tidbit:1,tidbit or:1,or conversation:1,conversation with:1,a visitor:1,visitor ended:1,up posted:1,posted on:1,Internet within:1,within hours:1,hours And:1,And meanwhile:1,meanwhile we:1,were pouring:1,pouring everything:1,had into:1,into Quake’s:1,technology I’d:1,I’d often:1,often come:1,in in:1,morning to:1,find John:1,John still:1,there working:1,new idea:1,idea so:1,so intriguing:1,intriguing that:1,he couldn’t:1,couldn’t bear:1,bear to:1,sleep until:1,tried it:1,out Toward:1,speeding things:1,would spend:1,a trance:1,trance writing:1,code stagger:1,stagger out:1,the Town:1,Town East:1,East Tower:1,Tower into:1,the blazing:1,blazing Texas:1,Texas heat:1,heat and:1,and somehow:1,somehow drive:1,home on:1,on LBJ:1,LBJ Freeway:1,Freeway without:1,without smacking:1,smacking into:1,the speeding:1,speeding pickups:1,pickups whizzing:1,whizzing past:1,past me:1,both sides:1,sides At:1,home I’d:1,I’d fall:1,a fitful:1,fitful sleep:1,sleep then:1,then come:1,next day:1,a daze:1,daze and:1,again Everything:1,Everything happened:1,happened so:1,under so:1,much pressure:1,pressure that:1,I wonder:1,us made:1,without completely:1,completely burning:1,burning out:1,out At:1,was tremendously:1,tremendously exciting:1,exciting John’s:1,John’s ideas:1,were endless:1,endless and:1,and brilliant:1,brilliant and:1,Quake ended:1,up establishing:1,establishing a:1,new standard:1,for Internet:1,and first-person:1,first-person 3-D:1,technology Happily:1,Happily id:1,an enlightened:1,enlightened attitude:1,attitude about:1,about sharing:1,was willing:1,Quake technology—both:1,technology—both how:1,it evolved:1,evolved Over:1,Dobb’s Sourcebook:1,Sourcebook as:1,detailed overview:1,overview for:1,the 1997:1,1997 Computer:1,Conference You:1,latter part:1,book they:1,rare look:1,and inner:1,of leading-edge:1,leading-edge software:1,you enjoy:1,enjoy reading:1,I enjoyed:1,enjoyed developing:1,much everything:1,decade about:1,programming that’s:1,still relevant:1,programming today:1,that covers:1,ground Most:1,of Graphics:1,Programming 2nd:1,2nd Edition:1,Edition is:1,CD all:1,too and:1,even my:1,1989 book:1,Language with:1,its long-dated:1,long-dated 8088:1,8088 cycle:1,counts but:1,useful perspectives:1,perspectives is:1,CD Add:1,recent 20000:1,20000 words:1,material and:1,have most:1,decade in:1,one neat:1,neat package:1,package I’m:1,I’m delighted:1,print in:1,place because:1,because over:1,I’ve run:1,found my:1,writings useful—and:1,useful—and a:1,more who:1,read them:1,them but:1,but couldn’t:1,them It’s:1,keep programming:1,programming material:1,material especially:1,especially stuff:1,as columns:1,columns in:1,print for:1,thank The:1,The Coriolis:1,Group and:1,particularly my:1,friend Jeff:1,Duntemann without:1,without whom:1,whom not:1,only this:1,this volume:1,volume but:1,much my:1,my entire:1,entire writing:1,writing career:1,career wouldn’t:1,wouldn’t exist:1,for helping:1,helping me:1,me keep:1,keep this:1,material available:1,available I’d:1,thank Jon:1,Jon Erickson:1,Erickson editor:1,Dobb’s both:1,both for:1,for encouragement:1,encouragement and:1,general good:1,good cheer:1,cheer and:1,write whatever:1,whatever I:1,wanted about:1,about realtime:1,3-D It:1,It still:1,still amazes:1,amazes me:1,find time:1,column every:1,two months:1,months during:1,during Quake’s:1,if Jon:1,Jon hadn’t:1,hadn’t made:1,and enjoyable:1,enjoyable it:1,happened I’d:1,Hecker and:1,and Jennifer:1,Jennifer Pahlka:1,Pahlka of:1,Conference without:1,without whose:1,whose encouragement:1,encouragement nudging:1,nudging and:1,and occasional:1,occasional well-deserved:1,well-deserved nagging:1,nagging there:1,would ever:1,ever have:1,paper for:1,the CGDC—a:1,CGDC—a paper:1,paper that:1,most comprehensive:1,comprehensive overview:1,technology that’s:1,that’s ever:1,which appears:1,pages I:1,else to:1,been said:1,said elsewhere:1,the introductions:1,introductions to:1,previous volumes:1,volumes or:1,the astonishingly:1,astonishingly large:1,see as:1,read it’s:1,been quite:1,decade for:1,for microcomputer:1,microcomputer programmers:1,been extremely:1,extremely fortunate:1,fortunate to:1,to chronicle:1,chronicle part:1,well And:1,next decade:1,decade is:1,is shaping:1,shaping up:1,as exciting:1,exciting Michael:1,Abrash Bellevue:1,Bellevue Washington:1,Washington May:1,May 1997:1,1997 Foreword:1,Foreword I:1,my start:1,start programming:1,on Apple:1,II computers:1,my early:1,early work:1,Apple platform:1,platform After:1,After graduating:1,graduating it:1,it quickly:1,quickly became:1,became obvious:1,have trouble:1,trouble paying:1,paying my:1,my rent:1,rent working:1,II market:1,market in:1,late eighties:1,eighties so:1,was forced:1,very rapid:1,rapid move:1,Intel PC:1,environment What:1,years on:1,Apple I:1,learn in:1,few months:1,months on:1,biggest benefit:1,actually making:1,making money:1,money as:1,buy all:1,the books:1,and magazines:1,magazines I:1,wanted I:1,I bought:1,bought a:1,lot I:1,in territory:1,territory that:1,knew almost:1,almost nothing:1,read everything:1,my hands:1,on Feature:1,Feature articles:1,articles editorials:1,editorials even:1,even advertisements:1,advertisements held:1,held information:1,to assimilate:1,assimilate John:1,John Romero:1,Romero clued:1,clued me:1,early to:1,articles by:1,by Michael:1,Abrash The:1,stuff Graphics:1,Graphics hardware:1,hardware Code:1,Code optimization:1,optimization Knowledge:1,Knowledge and:1,and wisdom:1,wisdom for:1,the aspiring:1,aspiring developer:1,developer They:1,They were:1,were even:1,even fun:1,read For:1,personal quest:1,quest was:1,Michael’s first:1,first book:1,looked in:1,every bookstore:1,bookstore I:1,I visited:1,visited but:1,made do:1,articles I:1,could dig:1,dig up:1,the dark:1,dark secrets:1,secrets of:1,EGA video:1,video controller:1,controller there:1,few neat:1,neat tricks:1,tricks of:1,own Some:1,tricks became:1,became the:1,the Commander:1,Keen series:1,games which:1,which launched:1,launched id:1,Software A:1,A year:1,two later:1,later after:1,after Wolfenstein-3D:1,Wolfenstein-3D I:1,I bumped:1,bumped into:1,into Michael:1,Michael in:1,virtual sense:1,looking around:1,around on:1,on M&T:1,M&T Online:1,Online a:1,a BBS:1,BBS run:1,Dobb’s publishers:1,publishers before:1,Internet explosion:1,explosion when:1,some posts:1,posts from:1,man himself:1,himself We:1,We traded:1,traded email:1,email and:1,couple months:1,months we:1,we played:1,played tag-team:1,tag-team gurus:1,gurus on:1,graphics forum:1,forum before:1,before Doom’s:1,Doom’s development:1,development took:1,life A:1,Michael’s at:1,his new:1,new job:1,job put:1,put us:1,after Doom:1,Doom began:1,make its:1,its impact:1,impact and:1,meet up:1,with him:1,him in:1,in person:1,person I:1,I talked:1,talked myself:1,myself hoarse:1,hoarse that:1,that day:1,day explaining:1,explaining all:1,of Doom:1,Michael and:1,an interested:1,interested group:1,his coworkers:1,coworkers Every:1,Every few:1,days afterwards:1,afterwards I:1,an email:1,email from:1,from Michael:1,Michael asking:1,asking for:1,an elaboration:1,elaboration on:1,my points:1,or discussing:1,discussing an:1,an aspect:1,graphics Eventually:1,I popped:1,popped the:1,the question—I:1,question—I offered:1,offered him:1,job at:1,id Just:1,think no:1,no reporting:1,reporting to:1,anyone an:1,day starting:1,clean sheet:1,sheet of:1,of paper:1,paper A:1,A chance:1,right thing:1,work I:1,finally convinced:1,convinced him:1,come down:1,Quake Going:1,Going from:1,from Doom:1,tremendous step:1,step I:1,knew where:1,I wasn’t:1,wasn’t at:1,all clear:1,clear what:1,steps were:1,trying a:1,huge number:1,the failures:1,failures were:1,were teaching:1,lot My:1,My enthusiasm:1,enthusiasm must:1,been contagious:1,contagious because:1,took the:1,job Much:1,Much heroic:1,heroic programming:1,programming ensued:1,ensued Several:1,Several hundred:1,thousand lines:1,code were:1,were written:1,written And:1,rewritten In:1,hindsight I:1,of regrets:1,regrets about:1,about various:1,rare person:1,person that:1,doesn’t freely:1,freely acknowledge:1,technical triumph:1,triumph of:1,it We:1,We nailed:1,nailed it:1,Sure a:1,year from:1,have probably:1,probably found:1,me cringe:1,cringe at:1,the clunkiness:1,clunkiness of:1,some part:1,still looks:1,looks pretty:1,pretty damn:1,damn good:1,very happy:1,have Michael:1,Michael describe:1,describe much:1,technology in:1,his ongoing:1,ongoing magazine:1,magazine articles:1,articles We:1,We learned:1,hope we:1,we managed:1,teach a:1,bit When:1,a non-programmer:1,non-programmer hears:1,hears about:1,about Michael’s:1,Michael’s articles:1,articles or:1,have released:1,released I:1,I usually:1,usually get:1,a stunned:1,stunned WTF:1,WTF would:1,for look:1,look They:1,They don’t:1,it Programming:1,a zero-sum:1,zero-sum game:1,game Teaching:1,Teaching something:1,fellow programmer:1,it away:1,from you:1,I’m happy:1,share what:1,because I’m:1,I’m in:1,the love:1,love of:1,The Ferraris:1,Ferraris are:1,just gravy:1,gravy honest:1,honest This:1,book contains:1,contains many:1,original articles:1,articles that:1,that helped:1,helped launch:1,launch my:1,my programming:1,career I:1,hope my:1,my contribution:1,later articles:1,articles can:1,provide similar:1,similar stepping:1,stepping stones:1,stones for:1,for others:1,others John:1,Carmack id:1,Software Acknowledgments:1,Acknowledgments There:1,to thank—because:1,thank—because this:1,over many:1,different settings:1,settings an:1,an unusually:1,unusually large:1,have played:1,book possible:1,possible Thanks:1,to Dan:1,Illowsky for:1,only contributing:1,contributing ideas:1,and encouragement:1,encouragement but:1,also getting:1,writing articles:1,articles long:1,ago when:1,I lacked:1,lacked the:1,the confidence:1,confidence to:1,my own—and:1,own—and for:1,the business:1,business end:1,things Thanks:1,to Will:1,Will Fastie:1,Fastie for:1,first crack:1,crack at:1,at writing:1,large audience:1,audience in:1,the long-gone:1,long-gone but:1,but still-missed:1,still-missed PC:1,for showing:1,showing me:1,fun it:1,his even:1,even longer-vanished:1,longer-vanished but:1,but genuinely:1,genuinely terrific:1,terrific column:1,in Creative:1,Creative Computing:1,Computing the:1,most enjoyable:1,enjoyable single:1,single column:1,column I:1,have ever:1,ever read:1,magazine I:1,haunt the:1,the mailbox:1,mailbox around:1,the month:1,month just:1,what Will:1,Will had:1,say Thanks:1,Robert Keller:1,Keller Erin:1,Erin O’Connor:1,O’Connor Liz:1,Liz Oakley:1,Oakley Steve:1,Steve Baker:1,Baker and:1,the cast:1,cast of:1,thousands that:1,made Programmer’s:1,Journal a:1,a uniquely:1,uniquely fun:1,fun magazine—especially:1,magazine—especially Erin:1,Erin who:1,who did:1,did more:1,anyone to:1,proper use:1,language To:1,To this:1,day Erin:1,Erin will:1,still patiently:1,patiently explain:1,explain to:1,me when:1,which even:1,though eight:1,eight years:1,topics have:1,have left:1,left no:1,no discernible:1,discernible imprint:1,imprint on:1,my brain:1,brain Thanks:1,to Tami:1,Tami Zemel:1,Zemel Monica:1,Monica Berg:1,Berg and:1,Journal crew:1,crew for:1,excellent professional:1,professional editing:1,editing and:1,for just:1,just being:1,being great:1,great people:1,people Thanks:1,the Coriolis:1,Coriolis gang:1,gang for:1,their tireless:1,tireless hard:1,work Jeff:1,Duntemann Kim:1,Kim Eoff:1,Eoff Jody:1,Jody Kent:1,Kent Robert:1,Robert Clarfield:1,Clarfield and:1,and Anthony:1,Anthony Stock:1,Stock Thanks:1,to Jack:1,Jack Tseng:1,Tseng for:1,difference hard:1,work can:1,make Thanks:1,John Cockerham:1,Cockerham David:1,Stafford Terje:1,Mathisen the:1,BitMan Chris:1,Hecker Jim:1,Mackraz Melvin:1,Melvin Lafitte:1,Lafitte John:1,John Navas:1,Navas Phil:1,Coleman Anton:1,Anton Truenfels:1,Truenfels John:1,Carmack John:1,Miles John:1,Bridges Jim:1,Kent Hal:1,Hal Hardenbergh:1,Hardenbergh Dave:1,Miller Steve:1,Steve Levy:1,Levy Jack:1,Jack Davis:1,Davis Duane:1,Strong Daev:1,Daev Rohr:1,Rohr Bill:1,Bill Weber:1,Weber Dan:1,Dan Gochnauer:1,Gochnauer Patrick:1,Patrick Milligan:1,Milligan Tom:1,Wilson Peter:1,Klerings Dave:1,Methvin Mick:1,Brown the:1,Bix and:1,been so:1,so generous:1,generous with:1,and suggestions:1,suggestions I’ve:1,acknowledge contributors:1,contributors by:1,by name:1,name in:1,your name:1,name is:1,is omitted:1,omitted my:1,consider yourself:1,yourself thanked:1,thanked this:1,book could:1,happened without:1,without you:1,you And:1,course thanks:1,to Shay:1,Shay and:1,and Emily:1,Emily for:1,their generous:1,generous patience:1,patience with:1,my passion:1,passion for:1,and computers:1,computers Part:1,Part I:1,I Chapter:1,Ears The:1,The Human:1,Human Element:1,Element of:1,Optimization This:1,topic near:1,and dear:1,dear to:1,my heart:1,heart writing:1,writing software:1,pushes PCs:1,PCs to:1,limit Given:1,Given run-of-the-mill:1,run-of-the-mill software:1,software PCs:1,PCs run:1,run like:1,the 97-pound-weakling:1,97-pound-weakling minicomputers:1,minicomputers they:1,are Give:1,Give them:1,proper care:1,care however:1,those ugly:1,ugly boxes:1,miracles The:1,this Only:1,on microcomputers:1,microcomputers do:1,whole machine:1,machine without:1,without layers:1,systems drivers:1,drivers and:1,like getting:1,getting in:1,way You:1,want and:1,understand everything:1,everything that’s:1,that’s going:1,wish As:1,shortly you:1,should indeed:1,indeed so:1,wish Is:1,Is performance:1,performance still:1,this era:1,era of:1,of cheap:1,cheap 486:1,486 computers:1,and super-fast:1,super-fast Pentium:1,Pentium computers:1,bet How:1,How many:1,many programs:1,use really:1,really run:1,happier if:1,they ran:1,ran faster:1,faster We’re:1,We’re so:1,so used:1,slow software:1,a compile-and-link:1,compile-and-link sequence:1,took two:1,two minutes:1,minutes on:1,PC takes:1,just ten:1,ten seconds:1,486 computer:1,computer we’re:1,we’re ecstatic—when:1,ecstatic—when in:1,truth we:1,be settling:1,nothing less:1,than instantaneous:1,instantaneous response:1,response Impossible:1,Impossible you:1,say Not:1,design including:1,including incremental:1,incremental compilation:1,linking use:1,of extended:1,extended and/or:1,and/or expanded:1,and well-crafted:1,well-crafted code:1,code PCs:1,about anything:1,few obvious:1,obvious exceptions:1,as applications:1,applications involving:1,involving super-computer-class:1,super-computer-class number-crunching:1,number-crunching if:1,done if:1,computer inside:1,think past:1,to unconventional:1,unconventional but:1,but potentially:1,fruitful approaches:1,approaches My:1,My point:1,this PCs:1,wonders It’s:1,easy coaxing:1,coaxing them:1,into doing:1,doing that:1,it’s rewarding—and:1,rewarding—and it’s:1,it’s sure:1,heck fun:1,book we’re:1,work some:1,those wonders:1,wonders starting:1,starting now:1,now Understanding:1,Understanding High:1,High Performance:1,Performance Before:1,can create:1,code we:1,what high:1,objective not:1,always attained:1,attained in:1,in creating:1,software able:1,carry out:1,its appointed:1,appointed tasks:1,tasks so:1,it responds:1,responds instantaneously:1,instantaneously as:1,concerned In:1,words high-performance:1,ideally run:1,further improvement:1,be pointless:1,pointless Notice:1,Notice that:1,above definition:1,definition most:1,most emphatically:1,emphatically does:1,about making:1,software as:1,also does:1,using assembly:1,compiler at:1,doesn’t say:1,written What:1,does say:1,that high-performance:1,code shouldn’t:1,user’s way—and:1,way—and that’s:1,all That’s:1,important distinction:1,distinction because:1,right compiler:1,particular high-level:1,certain design:1,design approach:1,code They’re:1,They’re not:1,than choosing:1,certain set:1,tools is:1,house You:1,You do:1,indeed need:1,need tools:1,house but:1,but any:1,many sets:1,tools will:1,do You:1,a blueprint:1,blueprint an:1,of everything:1,house and:1,tools Likewise:1,Likewise high-performance:1,programming requires:1,clear understanding:1,software being:1,built an:1,design algorithms:1,algorithms for:1,for implementing:1,implementing particular:1,tasks an:1,what all:1,relevant software:1,solid programming:1,skills preferably:1,preferably using:1,The optimization:1,finishing touch:1,touch however:1,however Without:1,Without good:1,design good:1,good algorithms:1,complete understanding:1,program’s operation:1,operation your:1,your carefully:1,will amount:1,of mankind’s:1,mankind’s least:1,least fruitful:1,fruitful creations—a:1,creations—a fast:1,program What’s:1,What’s a:1,ask That’s:1,good question:1,brief true:1,true story:1,best answer:1,answer When:1,When Fast:1,Fast Isn’t:1,Isn’t Fast:1,Fast In:1,early 1970s:1,1970s as:1,first hand-held:1,hand-held calculators:1,calculators were:1,were hitting:1,hitting the:1,market I:1,named Irwin:1,Irwin He:1,good student:1,student and:1,was planning:1,planning to:1,engineer Being:1,Being an:1,engineer back:1,then meant:1,meant knowing:1,a slide:1,slide rule:1,and Irwin:1,Irwin could:1,could jockey:1,jockey a:1,a slipstick:1,slipstick with:1,good that:1,he challenged:1,challenged a:1,fellow with:1,a calculator:1,calculator to:1,a duel—and:1,duel—and won:1,won becoming:1,local legend:1,legend in:1,process When:1,get right:1,though Irwin:1,Irwin was:1,was spitting:1,spitting into:1,wind In:1,short years:1,years his:1,his hard-earned:1,hard-earned slipstick:1,slipstick skills:1,skills would:1,be worthless:1,worthless and:1,entire discipline:1,discipline would:1,be essentially:1,essentially wiped:1,wiped from:1,the earth:1,earth What’s:1,more anyone:1,a brain:1,brain could:1,could see:1,that changeover:1,changeover coming:1,coming Irwin:1,Irwin had:1,had basically:1,basically wasted:1,wasted the:1,spent optimizing:1,optimizing his:1,his soon-to-be-obsolete:1,soon-to-be-obsolete skills:1,skills What:1,programming Plenty:1,Plenty When:1,you spend:1,optimizing poorly-designed:1,poorly-designed assembly:1,code fast:1,fast you’re:1,you’re wasting:1,wasting the:1,optimization much:1,as Irwin:1,Irwin did:1,did Particularly:1,Particularly in:1,assembly you’ll:1,proper up-front:1,up-front design:1,into high-performance:1,high-performance design:1,design you’ll:1,you’ll waste:1,waste considerable:1,making an:1,an inherently:1,as possible—which:1,possible—which is:1,still slow—when:1,slow—when you:1,easily have:1,more with:1,thought As:1,see handcrafted:1,handcrafted assembly:1,compilers matter:1,the grand:1,grand scheme:1,scheme of:1,of things—and:1,things—and they:1,they scarcely:1,scarcely matter:1,matter at:1,unless they’re:1,PC Rules:1,Rules for:1,for Building:1,Building High-Performance:1,High-Performance Code:1,Code We’ve:1,We’ve got:1,for creating:1,software Know:1,going understand:1,software Make:1,big map:1,map have:1,design firmly:1,firmly in:1,mind so:1,various parts:1,structures work:1,well together:1,Make lots:1,little maps:1,maps design:1,an algorithm:1,each separate:1,separate part:1,territory understand:1,computer carries:1,carries out:1,task Know:1,matters identify:1,programs where:1,don’t waste:1,waste your:1,rest Always:1,alternatives don’t:1,stuck on:1,single approach:1,approach odds:1,are there’s:1,you’re clever:1,and inventive:1,inventive enough:1,enough Know:1,Know how:1,the juice:1,juice optimize:1,best you:1,how when:1,matter Making:1,Making rules:1,easy the:1,is figuring:1,apply them:1,world For:1,my money:1,money examining:1,examining some:1,a handle:1,programming concepts:1,concepts so:1,performance rules:1,action Know:1,Know Where:1,Where You’re:1,You’re Going:1,Going If:1,code first:1,first we:1,example let’s:1,let’s write:1,file In:1,will add:1,add each:1,This checksum:1,value might:1,file hasn’t:1,hasn’t been:1,been corrupted:1,corrupted as:1,might occur:1,during transmission:1,transmission over:1,modem or:1,a Trojan:1,Trojan horse:1,horse virus:1,virus rears:1,rears its:1,its ugly:1,ugly head:1,head We’re:1,anything with:1,value other:1,than print:1,print it:1,however right:1,only interested:1,generating that:1,that checksum:1,possible Make:1,a Big:1,Big Map:1,Map How:1,How are:1,file name:1,name open:1,file read:1,bytes out:1,file add:1,and print:1,result Most:1,those actions:1,actions are:1,straightforward the:1,part lies:1,Make Lots:1,Lots of:1,of Little:1,Little Maps:1,Maps Actually:1,Actually we’re:1,one little:1,little map:1,map because:1,program section:1,requires much:1,much thought—the:1,thought—the section:1,that reads:1,adds them:1,up What’s:1,file into:1,then sum:1,loop Unfortunately:1,particular file:1,many files:1,files won’t:1,out Well:1,Well if:1,whole file:1,file won’t:1,byte surely:1,surely will:1,will If:1,file one:1,time adding:1,adding each:1,value before:1,before reading:1,byte we’ll:1,we’ll minimize:1,size file:1,file at:1,all Sounds:1,Sounds good:1,good eh:1,eh Listing:1,1.1 uses:1,uses C’s:1,C’s read:1,byte adds:1,and loops:1,loops back:1,byte until:1,reached The:1,is compact:1,and functions:1,functions perfectly—with:1,perfectly—with one:1,hitch It’s:1,It’s slow:1,slow Table:1,1.1 to:1,WordPerfect version:1,version 4.2:1,size on:1,AT machine:1,machine of:1,special parentage:1,parentage Execution:1,Execution times:1,1.1 compiled:1,optimization both:1,both on:1,same however:1,be acceptable:1,acceptable Listing:1,1.1 requires:1,requires over:1,one-half minutes:1,to checksum:1,checksum one:1,one file:1,file Listings:1,1.3 form:1,1.7 form:1,1.5 These:1,These results:1,results make:1,it’s folly:1,folly to:1,compiler’s optimization:1,programs fast:1,1.1 is:1,simply poorly:1,poorly designed:1,no amount:1,of compiler:1,will compensate:1,that failing:1,failing To:1,To drive:1,point Listings:1,1.3 which:1,1.1 except:1,entire checksum:1,C versions:1,versions as:1,still unacceptably:1,slow Note:1,Note The:1,The execution:1,seconds for:1,were timed:1,timed when:1,compiled listings:1,were run:1,WordPerfect 4.2:1,size as:1,as compiled:1,compiled in:1,model with:1,on opt:1,opt and:1,off no:1,no opt:1,opt All:1,times were:1,were measured:1,with Paradigm:1,Paradigm Systems:1,Systems TIMER:1,TIMER program:1,MHz 1-wait-state:1,1-wait-state AT:1,clone with:1,a 28-ms:1,28-ms hard:1,disk with:1,with disk:1,disk caching:1,caching turned:1,off The:1,clear Optimization:1,Optimization makes:1,makes code:1,but without:1,design optimization:1,optimization just:1,just creates:1,creates fast:1,how are:1,improve our:1,design Before:1,what’s wrong:1,current design:1,the Territory:1,Territory Just:1,Just why:1,1.1 so:1,slow In:1,word overhead:1,library implements:1,function by:1,code execute:1,debugger but:1,can buy:1,buy library:1,library source:1,both Microsoft:1,Microsoft and:1,Borland That:1,Listing 1.3:1,1.3 as:1,well executes:1,executes one:1,one DOS:1,function per:1,byte processed—and:1,processed—and DOS:1,functions especially:1,especially this:1,one come:1,come with:1,starters DOS:1,are invoked:1,invoked with:1,with interrupts:1,slowest instructions:1,CPUs Then:1,Then DOS:1,up internally:1,desired function:1,function expending:1,expending more:1,Finally DOS:1,search its:1,own buffers:1,buffers to:1,desired byte:1,read read:1,return All:1,long time—far:1,time—far far:1,far longer:1,1.1 In:1,1.1 spends:1,spends virtually:1,time executing:1,executing read:1,spent somewhere:1,somewhere down:1,DOS You:1,can verify:1,verify this:1,yourself by:1,or using:1,profiler but:1,but take:1,take my:1,my word:1,that’s what’s:1,what’s draining:1,draining the:1,life out:1,1.1 How:1,1.1 It:1,somehow avoid:1,avoid invoking:1,DOS for:1,means reading:1,reading more:1,then buffering:1,buffering the:1,and parceling:1,parceling it:1,for examination:1,examination one:1,gosh that’s:1,a description:1,of C’s:1,C’s stream:1,I/O feature:1,feature whereby:1,whereby C:1,C reads:1,reads files:1,files in:1,chunks and:1,internally doling:1,doling them:1,application as:1,needed by:1,than calling:1,DOS Let’s:1,Let’s try:1,try using:1,using stream:1,happens Listing:1,but uses:1,uses fopen:1,fopen and:1,getc rather:1,than open:1,open and:1,file being:1,being checksummed:1,checksummed The:1,results confirm:1,confirm our:1,our theories:1,theories splendidly:1,splendidly and:1,and validate:1,validate our:1,design As:1,1.1 Listing:1,1.4 runs:1,1.4 look:1,look almost:1,almost the:1,same To:1,the casual:1,observer read:1,getc would:1,seem slightly:1,much interchangeable:1,interchangeable and:1,performance difference:1,between a:1,16 MHz:1,386 Make:1,Make sure:1,goes on:1,you insert:1,insert a:1,a seemingly-innocuous:1,seemingly-innocuous function:1,call into:1,means knowing:1,how DOS:1,the C/C:1,C/C file-access:1,file-access libraries:1,libraries do:1,do their:1,their work:1,work In:1,words know:1,territory Know:1,Know When:1,When It:1,It Matters:1,Matters The:1,section contained:1,contained a:1,interesting phrase:1,code Time-critical:1,Time-critical portions:1,program—and by:1,by significant:1,significant I:1,don’t mean:1,code 100:1,or 200:1,200 percent:1,particular amount:1,amount at:1,program more:1,more responsive:1,responsive and/or:1,and/or usable:1,usable from:1,perspective Don’t:1,Don’t waste:1,optimizing non-time-critical:1,non-time-critical code:1,code set-up:1,code initialization:1,initialization code:1,like Spend:1,Spend your:1,time improving:1,improving the:1,code inside:1,inside heavily-used:1,heavily-used loops:1,time Notice:1,Notice for:1,checksum program:1,program entirely:1,assembly Listings:1,and 1.6:1,1.6 call:1,call assembly:1,assembly subroutines:1,that handle:1,time-critical operations:1,operations but:1,but C:1,for checking:1,checking command-line:1,command-line parameters:1,parameters opening:1,opening files:1,files printing:1,printing and:1,like If:1,implement any:1,chapter entirely:1,in hand-optimized:1,hand-optimized assembly:1,few percent—but:1,percent—but I:1,I rather:1,rather doubt:1,doubt you’d:1,you’d sure:1,heck spend:1,whatever meager:1,meager improvement:1,improvement does:1,does result:1,result Let:1,Let C:1,C do:1,assembly only:1,a perceptible:1,difference Besides:1,Besides we:1,optimize until:1,is refined:1,refined to:1,our satisfaction:1,satisfaction and:1,case until:1,until we’ve:1,we’ve thought:1,approaches Always:1,Always Consider:1,the Alternatives:1,Alternatives Listing:1,are other—perhaps:1,other—perhaps less:1,less obvious—ways:1,obvious—ways to:1,results faster:1,faster Let’s:1,by considering:1,considering why:1,why Listing:1,1.1 Like:1,Like read:1,read getc:1,getc calls:1,calls DOS:1,speed improvement:1,1.4 over:1,1.1 occurs:1,because getc:1,getc reads:1,reads many:1,once via:1,DOS then:1,then manages:1,manages those:1,those bytes:1,That’s faster:1,them one:1,using read:1,read but:1,having our:1,program read:1,manage blocks:1,blocks itself:1,itself Easier:1,Easier yes:1,yes but:1,not faster:1,this Every:1,Every invocation:1,invocation of:1,of getc:1,getc involves:1,involves pushing:1,parameter executing:1,executing a:1,function getting:1,parameter in:1,code looking:1,up information:1,desired stream:1,stream unbuffering:1,unbuffering the:1,code That:1,That takes:1,time especially:1,with simply:1,simply maintaining:1,and whizzing:1,whizzing through:1,buffer inside:1,loop There:1,four reasons:1,give for:1,not trying:1,1.4 1:1,already fast:1,enough 2:1,are content:1,content with:1,be annoying:1,annoying 3:1,in optimized:1,average programmer:1,programmer could:1,could write:1,perform essentially:1,same function:1,library conveniently:1,conveniently handles:1,buffering of:1,file data:1,nuisance to:1,implement that:1,that capability:1,capability I’ll:1,I’ll ignore:1,first reason:1,reason both:1,because performance:1,longer an:1,issue if:1,current application:1,application does:1,fast enough—13:1,enough—13 seconds:1,seconds is:1,time Stop:1,Stop and:1,for 13:1,13 seconds:1,seconds while:1,doing something:1,something intense:1,intense and:1,see just:1,the hallmark:1,the mediocre:1,mediocre programmer:1,programmer Know:1,optimization matters—and:1,matters—and then:1,then optimize:1,optimize when:1,third reason:1,often fallacious:1,fallacious C:1,always written:1,assembly nor:1,nor are:1,always particularly:1,well-optimized In:1,often written:1,for portability:1,portability which:1,optimization What’s:1,more they’re:1,they’re general-purpose:1,general-purpose functions:1,often can:1,be outperformed:1,outperformed by:1,by well-but-not-brilliantly-written:1,well-but-not-brilliantly-written code:1,is well-matched:1,specific task:1,task As:1,1.5 which:1,uses internal:1,buffering to:1,handle blocks:1,time Table:1,1.5 is:1,4 times:1,1.4 and:1,as 49:1,49 times:1,all Clearly:1,Clearly you:1,well by:1,using special-purpose:1,special-purpose C:1,library function—if:1,function—if you:1,function operates:1,operates and:1,needs done:1,done Otherwise:1,Otherwise you’ll:1,you’ll end:1,up rewriting:1,rewriting C:1,C which:1,sense at:1,all That:1,fourth reason:1,reason avoiding:1,avoiding an:1,an internal-buffered:1,internal-buffered implementation:1,1.5 because:1,approach True:1,True it:1,function do:1,buffering internally:1,internally The:1,handling data:1,in restartable:1,blocks that:1,a chunk:1,data operating:1,data until:1,out suspending:1,suspending the:1,operation while:1,more data:1,then continuing:1,continuing as:1,though nothing:1,nothing had:1,had happened:1,happened In:1,1.5 the:1,because checksumming:1,checksumming works:1,time forgetting:1,forgetting about:1,byte immediately:1,after adding:1,adding it:1,total Listing:1,1.5 reads:1,file checksums:1,checksums the:1,and gets:1,gets another:1,another block:1,block repeating:1,file has:1,processed In:1,complex restartable:1,implementation involving:1,involving searching:1,strings At:1,1.5 isn’t:1,isn’t much:1,Listing 1.4—and:1,1.4—and it’s:1,faster Always:1,alternatives a:1,of clever:1,clever thinking:1,program redesign:1,redesign can:1,way Know:1,Know How:1,to Turn:1,Turn On:1,the Juice:1,Juice I:1,have said:1,said time:1,is pointless:1,pointless until:1,is settled:1,settled When:1,When that:1,time comes:1,comes however:1,however optimization:1,indeed make:1,difference Table:1,1.1 indicates:1,1.5 produced:1,by Microsoft:1,C outperforms:1,outperforms an:1,an unoptimized:1,percent What’s:1,a mostly-assembly:1,mostly-assembly version:1,1.5 shown:1,1.7 outperforms:1,outperforms even:1,the best-optimized:1,best-optimized C:1,1.5 by:1,by 26:1,percent These:1,considerable improvements:1,improvements well:1,worth pursuing—once:1,pursuing—once the:1,been maxed:1,out Note:1,1.1 optimization:1,optimization makes:1,makes little:1,little difference:1,difference except:1,1.5 where:1,been refined:1,refined considerably:1,considerably Execution:1,Execution time:1,cases is:1,is dominated:1,by time:1,library so:1,much irrelevant:1,irrelevant What’s:1,more while:1,the approximately:1,approximately two-times:1,optimizing is:1,be sneezed:1,sneezed at:1,it pales:1,pales against:1,the up-to-50-times:1,up-to-50-times improvement:1,by redesigning:1,redesigning By:1,times even:1,even of:1,1.7 are:1,are dominated:1,by DOS:1,times If:1,be checksummed:1,checksummed is:1,version In:1,inherent nature:1,application limits:1,via assembly:1,In applications:1,applications that:1,more CPU-intensive:1,CPU-intensive and:1,less disk-bound:1,disk-bound particularly:1,particularly those:1,those applications:1,instructions and/or:1,and/or unrolled:1,loops can:1,used effectively:1,effectively assembly:1,C than:1,specific case:1,case Don’t:1,get hung:1,hung up:1,compilers or:1,assembly language—the:1,language—the best:1,optimizer is:1,ears All:1,saying Know:1,going know:1,territory and:1,Where We’ve:1,We’ve Been:1,Been What:1,What We’ve:1,We’ve Seen:1,Seen What:1,learned Don’t:1,let other:1,other people’s:1,people’s code—even:1,code—even DOS—do:1,DOS—do the:1,you when:1,speed matters:1,matters at:1,without knowing:1,it performs:1,performs Optimization:1,Optimization only:1,matters after:1,you’ve done:1,done your:1,part on:1,design end:1,end Consider:1,ratios on:1,1.1 which:1,which show:1,almost totally:1,totally wasted:1,wasted in:1,checksumming application:1,application without:1,efficient design:1,design Optimization:1,no panacea:1,panacea Table:1,from optimization—and:1,optimization—and a:1,a 50-times-plus:1,50-times-plus improvement:1,from redesign:1,redesign The:1,The longstanding:1,longstanding debate:1,compiler optimizes:1,optimizes code:1,code best:1,best doesn’t:1,matter quite:1,1.1 does:1,it Your:1,Your organic:1,organic optimizer:1,optimizer matters:1,matters much:1,compiler’s optimizer:1,optimizer and:1,always assembly:1,those usually:1,usually small:1,small sections:1,code where:1,performance really:1,really matters:1,Where We’re:1,We’re Going:1,Going This:1,has presented:1,quick step-by-step:1,step-by-step overview:1,design process:1,not claiming:1,me Create:1,Create code:1,code however:1,but never:1,forget that:1,design matters:1,matters more:1,than detailed:1,detailed optimization:1,Never stop:1,for inventive:1,inventive ways:1,boost performance—and:1,performance—and never:1,never waste:1,up I’m:1,specific ways:1,on In:1,at restartable:1,buffering in:1,searches files:1,files for:1,strings Chapter:1,Chapter 2:1,A World:1,World Apart:1,Apart The:1,The Unique:1,Unique Nature:1,Language Optimization:1,I showed:1,showed in:1,chapter optimization:1,means always:1,of dropping:1,dropping into:1,performance tuning:1,tuning high-level:1,code assembly:1,assembly should:1,used rarely:1,rarely and:1,you’ve made:1,made sure:1,sure a:1,badly chosen:1,chosen or:1,or clumsily:1,clumsily implemented:1,implemented algorithm:1,algorithm isn’t:1,isn’t eating:1,eating you:1,you alive:1,alive Certainly:1,Certainly if:1,make absolutely:1,absolutely sure:1,right The:1,slowly is:1,is poorly:1,poorly understood:1,understood by:1,people but:1,that potential:1,potential is:1,great especially:1,the ignorant:1,ignorant Truly:1,Truly great:1,optimization however:1,however happens:1,assembly level:1,of dynamics:1,dynamics that:1,is totally:1,totally different:1,that governing:1,governing C/C:1,C/C or:1,or Pascal:1,Pascal optimization:1,optimization I’ll:1,be speaking:1,of assembly-level:1,assembly-level optimization:1,optimization time:1,be helpful:1,helpful if:1,a grasp:1,grasp of:1,those assembly:1,assembly specific:1,specific dynamics:1,dynamics As:1,As usual:1,usual the:1,to wade:1,wade in:1,example Instructions:1,Instructions The:1,The Individual:1,Individual versus:1,the Collective:1,Collective Some:1,was asked:1,work over:1,critical assembly:1,subroutine was:1,nibble out:1,bits read:1,different bytes:1,bytes rotating:1,they ultimately:1,ultimately ended:1,neatly aligned:1,aligned in:1,curious the:1,a 16-color:1,16-color pixel:1,from bits:1,bits scattered:1,scattered over:1,over 4:1,I examined:1,subroutine line:1,by line:1,line saving:1,cycle there:1,there until:1,code truly:1,truly seemed:1,optimized When:1,code looked:1,this Now:1,seven instructions:1,instructions only:1,have called:1,called it:1,day at:1,point Still:1,Still something:1,something bothered:1,bothered me:1,time going:1,again Suddenly:1,Suddenly the:1,answer struck:1,struck me—the:1,me—the code:1,was rotating:1,rotating each:1,place separately:1,being performed:1,performed every:1,separate time-consuming:1,time-consuming multibit:1,multibit rotations:1,rotations While:1,themselves were:1,were individually:1,individually optimized:1,approach did:1,I changed:1,following This:1,This moved:1,moved the:1,the costly:1,costly multibit:1,rotation out:1,was performed:1,performed just:1,not look:1,fact still:1,still contains:1,contains exactly:1,subroutine improved:1,percent from:1,just this:1,change Incidentally:1,Incidentally that:1,the DEC:1,JNZ instructions:1,by expanding:1,expanding the:1,four iterations:1,iterations of:1,the loop—but:1,loop—but that’s:1,a tale:1,tale for:1,another chapter:1,this To:1,To write:1,write truly:1,truly superior:1,superior assembly:1,programs you:1,execute fastest…and:1,fastest…and more:1,more You:1,also learn:1,perspectives so:1,put those:1,effective ways:1,ways Assembly:1,Is Fundamentally:1,Fundamentally Different:1,Different Is:1,really so:1,PC Yes:1,Yes Thanks:1,quirky nature:1,CPUs assembly:1,language differs:1,differs fundamentally:1,fundamentally from:1,undeniably harder:1,with On:1,much greater:1,languages as:1,so consider:1,program gets:1,written A:1,A programmer:1,programmer examines:1,examines the:1,application designs:1,designs a:1,solution at:1,some level:1,of abstraction:1,abstraction and:1,then makes:1,design come:1,come alive:1,alive in:1,code implementation:1,implementation If:1,not handled:1,handled properly:1,properly the:1,place between:1,between conception:1,conception and:1,performance tremendously:1,tremendously for:1,who implements:1,implements a:1,of 100000:1,100000 sorted:1,sorted items:1,items with:1,linear rather:1,than binary:1,search will:1,a disappointingly:1,disappointingly slow:1,program Transformation:1,Transformation Inefficiencies:1,Inefficiencies No:1,well an:1,corresponding design:1,however high-level:1,languages like:1,like C/C:1,Pascal inevitably:1,inevitably introduce:1,introduce additional:1,additional transformation:1,inefficiencies as:1,turning a:1,design into:1,into executable:1,executable code:1,language involves:1,two transformations:1,transformations one:1,one performed:1,generate source:1,another performed:1,turn source:1,instructions Consequently:1,the machine:1,by compilers:1,compilers is:1,usually less:1,optimal given:1,design High-level:1,languages provide:1,provide artificial:1,artificial environments:1,environments that:1,that lend:1,themselves relatively:1,to human:1,human programming:1,skills in:1,to ease:1,ease the:1,from design:1,design to:1,The price:1,price for:1,this ease:1,considerable loss:1,efficiency in:1,in transforming:1,transforming source:1,language This:1,particularly true:1,16-bit protected:1,its specialized:1,specialized memory-addressing:1,and segmented:1,segmented memory:1,architecture does:1,not lend:1,compiler design:1,design Even:1,32-bit mode:1,successors with:1,their more:1,powerful addressing:1,modes offer:1,offer fewer:1,fewer registers:1,than compilers:1,compilers would:1,inefficiencies Figure:1,inefficiencies Assembly:1,Assembly on:1,a human-oriented:1,human-oriented representation:1,language As:1,result assembly:1,assembly provides:1,programming environment—the:1,environment—the bare:1,bare hardware:1,systems software:1,software of:1,computer but:1,but properly:1,properly constructed:1,loss as:1,2.2 Only:1,one transformation:1,required when:1,when creating:1,creating an:1,an assembler:1,assembler program:1,single transformation:1,completely under:1,programmer’s control:1,control Assemblers:1,Assemblers perform:1,from source:1,language instead:1,instead they:1,they merely:1,merely map:1,map assembler:1,assembler instructions:1,one-to-one basis:1,basis As:1,produce machine:1,that’s precisely:1,precisely tailored:1,given application:1,application requires:1,requires Figure:1,loss Figure:1,loss The:1,key of:1,programmer since:1,since in:1,must essentially:1,essentially perform:1,application specification:1,specification to:1,language entirely:1,own The:1,The assembler:1,assembler merely:1,merely handles:1,direct translation:1,assembly to:1,language Self-Reliance:1,Self-Reliance The:1,is self:1,self An:1,An assembler:1,assembler is:1,tool to:1,design machine-language:1,machine-language programs:1,programs without:1,in hexadecimal:1,hexadecimal codes:1,codes So:1,So assembly:1,language programmers—unlike:1,programmers—unlike all:1,other programmers—must:1,programmers—must take:1,take full:1,full responsibility:1,responsibility for:1,code Since:1,Since assemblers:1,assemblers provide:1,provide little:1,little help:1,any level:1,level higher:1,higher than:1,language the:1,capable both:1,coding any:1,any programming:1,programming construct:1,construct directly:1,of controlling:1,PC at:1,lowest practical:1,practical level—the:1,level—the operating:1,BIOS even:1,hardware where:1,where necessary:1,necessary High-level:1,languages handle:1,handle most:1,this transparently:1,transparently to:1,programmer but:1,assembly everything:1,is fair—and:1,fair—and necessary—game:1,necessary—game which:1,which brings:1,another aspect:1,optimization knowledge:1,knowledge Knowledge:1,Knowledge In:1,enough knowledge:1,knowledge and:1,every item:1,item you:1,your store:1,store will:1,programs better:1,better Thorough:1,Thorough familiarity:1,system APIs:1,APIs and:1,BIOS interfaces:1,interfaces is:1,important since:1,those interfaces:1,interfaces are:1,are well-documented:1,reasonably straightforward:1,straightforward my:1,my advice:1,advice is:1,good book:1,and bring:1,bring yourself:1,yourself up:1,speed Similarly:1,Similarly familiarity:1,PC hardware:1,required While:1,that topic:1,topic covers:1,of ground—display:1,ground—display adapters:1,adapters keyboards:1,keyboards serial:1,serial ports:1,ports printer:1,printer ports:1,ports timer:1,and DMA:1,DMA channels:1,channels memory:1,and more—most:1,more—most of:1,is well-documented:1,programming major:1,major hardware:1,hardware components:1,components appear:1,appear frequently:1,frequently in:1,literature so:1,knowledge can:1,be acquired:1,acquired readily:1,readily enough:1,enough The:1,critical aspect:1,one about:1,is hardest:1,hardest to:1,learn is:1,CPU The:1,CPUs have:1,complex irregular:1,irregular instruction:1,and unlike:1,unlike most:1,most processors:1,processors they:1,are neither:1,neither straightforward:1,straightforward nor:1,nor well-documented:1,well-documented true:1,true code:1,more assembly:1,books that:1,that present:1,present assembly:1,code settle:1,settle for:1,just works:1,works rather:1,than code:1,pushes the:1,limits In:1,fact since:1,books are:1,for inexperienced:1,inexperienced assembly:1,programmers there:1,little information:1,information of:1,sort available:1,available about:1,generate high-quality:1,high-quality assembly:1,CPUs As:1,result knowledge:1,programming them:1,them effectively:1,effectively is:1,hardest knowledge:1,gather A:1,good portion:1,to seeking:1,seeking out:1,out such:1,such knowledge:1,knowledge Be:1,Be forewarned:1,forewarned though:1,though No:1,assembly there’s:1,always more:1,discover The:1,The Flexible:1,Mind Is:1,the never-ending:1,never-ending collection:1,information all:1,then Hardly:1,Hardly Knowledge:1,Knowledge is:1,a necessary:1,necessary base:1,build Let’s:1,forces that:1,that act:1,act on:1,place Basically:1,Basically there:1,possible objectives:1,programming Given:1,application keep:1,keep to:1,minimum either:1,of processor:1,processor cycles:1,program takes:1,some combination:1,both We’ll:1,at ways:1,achieve both:1,both objectives:1,objectives but:1,we’ll more:1,be concerned:1,than saving:1,saving bytes:1,PC generally:1,generally offers:1,offers relatively:1,does processing:1,processing horsepower:1,horsepower In:1,fact we’ll:1,that two-to-three:1,two-to-three times:1,times performance:1,performance improvements:1,improvements over:1,over already:1,already tight:1,possible if:1,spend additional:1,additional bytes:1,save cycles:1,always desirable:1,such techniques:1,code due:1,the heavy:1,heavy memory:1,memory requirements—but:1,requirements—but it:1,possible You:1,will notice:1,my short:1,short list:1,of objectives:1,objectives for:1,programming does:1,include traditional:1,traditional objectives:1,objectives such:1,as easy:1,easy maintenance:1,development Those:1,indeed important:1,important considerations—to:1,considerations—to persons:1,persons and:1,and companies:1,companies that:1,that develop:1,and distribute:1,distribute software:1,software People:1,People who:1,who actually:1,actually buy:1,buy software:1,hand care:1,that software:1,software performs:1,performs not:1,was developed:1,nor how:1,maintained These:1,These days:1,days developers:1,developers spend:1,spend so:1,time focusing:1,on such:1,such admittedly:1,admittedly important:1,important issues:1,issues as:1,as code:1,code maintainability:1,maintainability and:1,and reusability:1,reusability source:1,code control:1,control choice:1,environment and:1,often forget:1,forget rule:1,rule 1:1,1 From:1,perspective performance:1,is fundamental:1,fundamental Comment:1,Comment your:1,code design:1,design it:1,it carefully:1,carefully and:1,write non-time-critical:1,language if:1,you wish—but:1,wish—but when:1,user and/or:1,and/or affect:1,time performance:1,performance must:1,your paramount:1,paramount objective:1,objective and:1,that goal:1,goal Knowledge:1,Knowledge of:1,absolutely essential:1,to fulfilling:1,fulfilling either:1,programming What:1,is meet:1,both performs:1,performs to:1,application at:1,also operates:1,operates as:1,environment Knowledge:1,Knowledge makes:1,that possible:1,but your:1,instincts make:1,happen And:1,that intuitive:1,intuitive on-the-fly:1,on-the-fly integration:1,integration of:1,specification and:1,a sea:1,sea of:1,of facts:1,facts about:1,the Zen-class:1,Zen-class assembly:1,optimization As:1,with Zen:1,sort mastering:1,mastering that:1,that Zen:1,learning than:1,than of:1,being taught:1,taught You:1,own path:1,path of:1,learning although:1,The subtle:1,subtle facts:1,facts and:1,and examples:1,examples I:1,I provide:1,provide will:1,gain the:1,necessary experience:1,experience but:1,must continue:1,continue the:1,journey on:1,own Each:1,Each program:1,you create:1,create will:1,will expand:1,expand your:1,programming horizons:1,horizons and:1,and increase:1,the options:1,options available:1,in meeting:1,next challenge:1,challenge The:1,find surprising:1,surprising new:1,better ways:1,to craft:1,craft superior:1,superior code:1,a concept—the:1,concept—the flexible:1,the linchpin:1,linchpin of:1,develop this:1,this skill:1,skill only:1,doing Never:1,Never underestimate:1,underestimate the:1,mind Good:1,Good assembly:1,code Many:1,people would:1,have you:1,believe otherwise:1,they’re wrong:1,that high-level:1,are useless:1,useless far:1,it High-level:1,applications When:1,best code—the:1,code—the fastest:1,code possible—is:1,possible—is needed:1,needed though:1,though assembly:1,go Simple:1,Simple logic:1,logic dictates:1,dictates that:1,no compiler:1,can know:1,know as:1,code needs:1,or adapt:1,adapt as:1,those needs:1,needs as:1,person who:1,code Given:1,that superior:1,superior information:1,and adaptability:1,adaptability an:1,compiler all:1,so given:1,are constrained:1,constrained by:1,of high-level:1,from high-level:1,high-level to:1,language Consequently:1,Consequently carefully:1,the language:1,language of:1,1 percent:1,of code—usually:1,code—usually consisting:1,well-defined subroutines—that:1,subroutines—that determines:1,determines overall:1,program performance:1,as compact:1,the run-of-the-mill:1,run-of-the-mill non-time-critical:1,programs it:1,effort on:1,on writing:1,assembly code—concentrate:1,code—concentrate your:1,your efforts:1,efforts on:1,on loops:1,like instead:1,finest code:1,quality accept:1,accept no:1,no substitutes:1,substitutes Note:1,compiler not:1,not will:1,code While:1,often much:1,than bad:1,bad compiled:1,programmer has:1,has so:1,much control:1,program he:1,she has:1,has virtually:1,virtually unlimited:1,unlimited opportunities:1,waste cycles:1,The sword:1,sword cuts:1,cuts both:1,requires more:1,more not:1,not less:1,less forethought:1,forethought and:1,and planning:1,planning than:1,The gist:1,gist of:1,solid overall:1,overall framework:1,framework unique:1,each program:1,creating that:1,framework and:1,and holding:1,holding it:1,it together:1,together Where:1,Where to:1,to Begin:1,Begin To:1,summarize the:1,the skill:1,skill of:1,knowledge perspective:1,the genesis:1,genesis of:1,of absolutely:1,what should:1,step be:1,be Development:1,Development of:1,obvious step:1,step Still:1,no better:1,knowledge at:1,its disposal:1,disposal The:1,journey toward:1,toward mastering:1,mastering optimization:1,that exalted:1,exalted level:1,level then:1,be learning:1,learn Chapter:1,3 Assume:1,Assume Nothing:1,Nothing Understanding:1,Understanding and:1,and Using:1,Timer When:1,you’re pushing:1,the envelope:1,envelope in:1,optimized PC:1,little compulsive:1,compulsive about:1,about finding:1,finding approaches:1,you wring:1,more speed:1,process you’re:1,make mistakes:1,mistakes which:1,is fine—as:1,fine—as long:1,you watch:1,watch for:1,those mistakes:1,mistakes and:1,A case:1,across an:1,about 8088:1,language called:1,called Optimizing:1,Optimizing for:1,Speed Now:1,Now optimize:1,used lightly:1,lightly Webster’s:1,Webster’s Ninth:1,Ninth New:1,New Collegiate:1,Collegiate Dictionary:1,Dictionary defines:1,defines optimize:1,optimize as:1,make as:1,as perfect:1,perfect effective:1,effective or:1,or functional:1,functional as:1,possible which:1,certainly leaves:1,leaves little:1,little room:1,had however:1,however chosen:1,chosen a:1,well-defined 8088:1,language routine:1,to refine:1,refine consisting:1,about 30:1,30 instructions:1,did nothing:1,than expand:1,expand 8:1,by duplicating:1,of Optimizing:1,Optimizing had:1,had clearly:1,clearly fine-tuned:1,fine-tuned the:1,with care:1,care examining:1,examining alternative:1,alternative instruction:1,sequences and:1,adding up:1,cycles until:1,he arrived:1,implementation he:1,he calculated:1,calculated to:1,be nearly:1,original routine:1,short he:1,had used:1,his disposal:1,disposal to:1,improve his:1,had as:1,result saved:1,saved cycles:1,the bushel:1,bushel There:1,fact only:1,slight problem:1,routine It:1,ran slower:1,The Costs:1,Costs of:1,of Ignorance:1,Ignorance As:1,As diligent:1,diligent as:1,been he:1,had nonetheless:1,nonetheless committed:1,committed a:1,a cardinal:1,sin of:1,x86 assembly:1,programming He:1,him was:1,both correct:1,complete While:1,times provided:1,Intel for:1,its processors:1,are incomplete:1,incomplete the:1,the other—and:1,other—and often:1,often more:1,more important—part:1,important—part of:1,topic to:1,chapters Had:1,Had the:1,author taken:1,code he:1,he wouldn’t:1,put his:1,his reputation:1,reputation on:1,relatively low-performance:1,low-performance code:1,code What’s:1,more had:1,he actually:1,actually measured:1,measured the:1,be unexpectedly:1,unexpectedly slow:1,slow curiosity:1,curiosity might:1,have led:1,led him:1,experiment further:1,thereby add:1,his store:1,store of:1,of reliable:1,reliable information:1,important tenet:1,tenet of:1,optimization After:1,After crafting:1,crafting the:1,possible check:1,check it:1,really doing:1,doing what:1,not behaving:1,behaving as:1,expected that’s:1,good since:1,since solving:1,solving mysteries:1,mysteries is:1,to knowledge:1,knowledge You’ll:1,You’ll learn:1,you than:1,any manual:1,manual or:1,language Assume:1,nothing I:1,I cannot:1,cannot emphasize:1,emphasize this:1,this strongly:1,strongly enough—when:1,enough—when you:1,performance do:1,your best:1,then measure:1,improvement If:1,don’t measure:1,performance you’re:1,just guessing:1,guessing and:1,you’re guessing:1,guessing you’re:1,write top-notch:1,top-notch code:1,code Ignorance:1,Ignorance about:1,about true:1,be costly:1,costly When:1,wrote video:1,video games:1,living I:1,spent days:1,days at:1,my graphics:1,graphics drivers:1,drivers I:1,I rewrote:1,rewrote whole:1,whole sections:1,cycles juggled:1,juggled registers:1,and relied:1,relied heavily:1,on blurry-fast:1,blurry-fast register-to-register:1,register-to-register shifts:1,adds As:1,my last:1,last game:1,discovered that:1,ran perceptibly:1,perceptibly faster:1,used look-up:1,look-up tables:1,tables instead:1,of shifts:1,my calculations:1,calculations It:1,It shouldn’t:1,shouldn’t have:1,faster according:1,my cycle:1,did In:1,truth instruction:1,fetching was:1,was rearing:1,rearing its:1,its head:1,head again:1,often does:1,adds was:1,the nominal:1,nominal execution:1,instructions Ignorance:1,Ignorance can:1,be responsible:1,considerable wasted:1,effort I:1,I recall:1,recall a:1,debate in:1,letters column:1,one computer:1,quickly text:1,text can:1,a Color/Graphics:1,CGA screen:1,screen without:1,The letter-writers:1,letter-writers counted:1,counted every:1,their timing:1,timing loops:1,loops just:1,author in:1,story that:1,started this:1,chapter had:1,had Like:1,Like that:1,that author:1,author the:1,the letter-writers:1,letter-writers had:1,queue into:1,into account:1,account In:1,had neglected:1,neglected the:1,video wait:1,code they:1,they discussed:1,discussed was:1,actually much:1,their estimates:1,estimates The:1,The proper:1,proper test:1,test would:1,course have:1,if snow:1,snow resulted:1,resulted since:1,true measure:1,is observing:1,observing it:1,Timer Clearly:1,Clearly one:1,to mastering:1,mastering Zen-class:1,Zen-class optimization:1,accurate way:1,with expensive:1,expensive hardware:1,but reasonable:1,reasonable measurements:1,measurements at:1,PC’s 8253:1,counts at:1,of slightly:1,slightly over:1,over 1000000:1,1000000 times:1,stopped at:1,resulting count:1,count indicating:1,took to:1,1 microsecond:1,microsecond A:1,A microsecond:1,one millionth:1,millionth of:1,abbreviated µs:1,µs To:1,precise the:1,838.1 nanoseconds:1,nanoseconds A:1,A nanosecond:1,nanosecond is:1,one billionth:1,billionth of:1,abbreviated ns:1,ns Listing:1,3.1 shows:1,shows 8253-based:1,8253-based timer:1,timer software:1,software consisting:1,subroutines ZTimerOn:1,ZTimerReport For:1,routines collectively:1,collectively as:1,timer C-callable:1,C-callable versions:1,two precision:1,CD-ROM The:1,Timer Is:1,a Means:1,Means Not:1,Not an:1,an End:1,End We’re:1,chapter seeing:1,do examining:1,examining how:1,timer again:1,again over:1,book so:1,hand it:1,means essential:1,works Interesting:1,Interesting yes:1,yes essential:1,essential no:1,no In:1,timer isn’t:1,really part:1,knowledge we:1,seek rather:1,it’s one:1,one tool:1,we’ll acquire:1,acquire that:1,knowledge Consequently:1,shouldn’t worry:1,don’t fully:1,fully grasp:1,timer Instead:1,Instead focus:1,on learning:1,right road:1,road Starting:1,Starting the:1,Timer ZTimerOn:1,segment of:1,timed ZTimerOn:1,ZTimerOn saves:1,code disables:1,interrupts sets:1,initial timer:1,0 restores:1,returns I’d:1,while Intel’s:1,documentation for:1,8253 seems:1,timer won’t:1,won’t reset:1,0 until:1,finishes counting:1,actual practice:1,practice timers:1,timers seem:1,they’re loaded:1,loaded Two:1,Two aspects:1,ZTimerOn are:1,are worth:1,worth discussing:1,discussing further:1,further One:1,ZTimerOn disables:1,ZTimerOff later:1,later restores:1,restores interrupts:1,state they:1,called Were:1,Were interrupts:1,interrupts not:1,not disabled:1,by ZTimerOn:1,ZTimerOn keyboard:1,mouse timer:1,interrupts could:1,could occur:1,to service:1,service those:1,those interrupts:1,interrupts would:1,would incorrectly:1,incorrectly and:1,and erratically:1,erratically appear:1,measured As:1,code timed:1,timer should:1,not expect:1,any hardware:1,hardware interrupts:1,interval between:1,between any:1,any call:1,corresponding call:1,not enable:1,enable interrupts:1,during that:1,time Time:1,Time and:1,about ZTimerOn:1,may introduce:1,small inaccuracy:1,called To:1,which both:1,8253 and:1,which keeps:1,time work:1,8253 actually:1,actually contains:1,timers as:1,3.1 All:1,are driven:1,system board’s:1,board’s 14.31818:1,14.31818 MHz:1,MHz crystal:1,crystal divided:1,by 12:1,12 to:1,to yield:1,yield a:1,a 1.19318:1,1.19318 MHz:1,timers so:1,timers count:1,count once:1,838.1 ns:1,ns Each:1,timers counts:1,programmable way:1,way generating:1,signal on:1,output pin:1,pin when:1,0 Each:1,being halted:1,halted at:1,0 level:1,level on:1,input when:1,a timer’s:1,timer’s gate:1,input is:1,counts constantly:1,constantly All:1,the 8253’s:1,8253’s timers:1,are inherently:1,inherently very:1,very flexible:1,flexible timing:1,timing devices:1,devices unfortunately:1,unfortunately much:1,that flexibility:1,flexibility depends:1,external circuitry:1,connected with:1,with specific:1,specific purposes:1,mind Timer:1,Timer 2:1,2 drives:1,speaker although:1,other timing:1,timing purposes:1,purposes when:1,speaker is:1,use As:1,3.1 timer:1,is timer:1,started and:1,stopped under:1,under program:1,control in:1,manner specified:1,to nothing:1,nothing other:1,speaker In:1,particular timer:1,2 cannot:1,cannot generate:1,8088’s attention:1,attention Timer:1,Timer 1:1,to providing:1,providing dynamic:1,be tampered:1,tampered with:1,with lest:1,lest system:1,system crashes:1,crashes result:1,result Figure:1,PC Finally:1,Finally timer:1,clock As:1,As programmed:1,power-up every:1,every 65536:1,65536 64K:1,64K counts:1,counts or:1,or 54.925:1,54.925 milliseconds:1,milliseconds timer:1,output line:1,A millisecond:1,millisecond is:1,is one-thousandth:1,one-thousandth of:1,abbreviated ms:1,ms This:1,0 IRQ0:1,IRQ0 line:1,system board:1,board so:1,so every:1,ms timer:1,causes hardware:1,occur The:1,The interrupt:1,interrupt vector:1,for IRQ0:1,IRQ0 is:1,power-up time:1,BIOS routine:1,routine TIMER_INT:1,TIMER_INT that:1,that maintains:1,maintains a:1,a time-of-day:1,count TIMER_INT:1,TIMER_INT keeps:1,keeps a:1,16-bit count:1,of IRQ0:1,IRQ0 interrupts:1,address 0000046C:1,0000046C all:1,all addresses:1,addresses in:1,given in:1,in segmentoffset:1,segmentoffset hexadecimal:1,hexadecimal pairs:1,pairs this:1,this count:1,over once:1,hour less:1,less a:1,few microseconds:1,does TIMER_INT:1,TIMER_INT updates:1,updates a:1,16-bit hour:1,hour count:1,count at:1,address 0000046E:1,0000046E in:1,area This:1,This count:1,date that:1,that DOS:1,DOS supports:1,supports via:1,via functions:1,functions 2AH:1,2AH 2A:1,2A hexadecimal:1,hexadecimal through:1,through 2DH:1,2DH and:1,commands Each:1,timer channel:1,six modes:1,modes Timer:1,Timer 0:1,normally operates:1,3 square:1,In square:1,is counted:1,is again:1,again counted:1,is toggled:1,toggled back:1,wave that:1,state more:1,input clock:1,operation timer:1,an output:1,output pulse:1,is low:1,low for:1,high for:1,ms this:1,this pulse:1,its rising:1,edge generates:1,interrupt once:1,ms Square:1,Square wave:1,timing because:1,two twice:1,twice per:1,per timer:1,interrupt thereby:1,thereby rendering:1,rendering exact:1,timings impossible:1,impossible Fortunately:1,Fortunately the:1,8253 offers:1,offers another:1,another timer:1,timer mode:1,good substitute:1,for square:1,perfect mode:1,timing Divide-by-N:1,Divide-by-N mode:1,mode counts:1,count When:1,timer turns:1,and starts:1,starts counting:1,again without:1,without stopping:1,stopping and:1,generated for:1,clock period:1,period While:1,not held:1,held for:1,for nearly:1,matter since:1,be edge-triggered:1,edge-triggered and:1,hence cares:1,cares only:1,pulse from:1,0 not:1,pulse As:1,0 continues:1,generate timer:1,in divide-by-N:1,clock continues:1,maintain good:1,time Why:1,use timer:1,2 instead:1,timing After:1,2 has:1,but sound:1,sound generation:1,generation The:1,with timer:1,output can’t:1,interrupt in:1,fact timer:1,2 can’t:1,but drive:1,speaker We:1,interrupt generated:1,count has:1,has overflowed:1,overflowed and:1,interrupt also:1,periods than:1,3.1 supports:1,supports In:1,3.1 can:1,time intervals:1,about 54:1,ms in:1,length since:1,by timer:1,before its:1,and repeats:1,repeats Fifty-four:1,Fifty-four ms:1,ms may:1,than 1000:1,1000 divides:1,in 54:1,performs most:1,most slowly:1,slowly If:1,a measured:1,measured period:1,period turns:1,ms that:1,if timer:1,has counted:1,will display:1,A long-period:1,presented later:1,timer determines:1,whether timer:1,over by:1,checking to:1,whether an:1,pending Remember:1,Remember interrupts:1,off while:1,timer runs:1,interrupt cannot:1,be recognized:1,recognized until:1,timer stops:1,stops and:1,and enables:1,enables interrupts:1,interrupts If:1,If an:1,pending then:1,then timer:1,and generated:1,interrupt Recall:1,ZTimerOn initially:1,initially sets:1,the longest:1,longest possible:1,possible period—about:1,period—about 54:1,54 ms—before:1,ms—before timer:1,0 reaches:1,interrupt Now:1,introduce inaccuracy:1,clock Since:1,Since timer:1,is initially:1,initially set:1,clock ticks:1,ticks only:1,0 counts:1,counts off:1,off 54.925:1,0 again:1,again an:1,average inaccuracy:1,inaccuracy of:1,of one-half:1,of 54.925:1,ms or:1,ms is:1,incurred each:1,is started:1,started In:1,addition a:1,2 advancing:1,ms although:1,only happens:1,run after:1,boot Finally:1,Finally up:1,ms can:1,can again:1,lost when:1,when ZTimerOff:1,called since:1,that routine:1,routine again:1,again sets:1,zero Net:1,Net result:1,clock will:1,run up:1,ms about:1,a ninth:1,ninth of:1,second slow:1,slow each:1,used Potentially:1,Potentially far:1,greater inaccuracy:1,inaccuracy can:1,be incurred:1,by timing:1,about 110:1,execute Recall:1,all interrupts:1,interrupts including:1,interrupt are:1,disabled while:1,while timing:1,The 8259:1,of remembering:1,remembering at:1,most one:1,one pending:1,interrupt so:1,interrupts after:1,first one:1,one during:1,given Zen:1,Zen timing:1,interval are:1,ignored Consequently:1,a timing:1,interval exceeds:1,exceeds 54.9:1,clock effectively:1,effectively stops:1,stops 54.9:1,ms after:1,interval starts:1,doesn’t restart:1,restart until:1,interval ends:1,ends losing:1,losing time:1,the while:1,while The:1,The effects:1,timer aren’t:1,aren’t a:1,concern as:1,are temporary:1,temporary lasting:1,lasting only:1,only until:1,next warm:1,boot System:1,System that:1,have battery-backed:1,clocks AT-style:1,AT-style machines:1,machines that:1,all machines:1,machines in:1,use automatically:1,automatically reset:1,correct time:1,is booted:1,booted and:1,systems without:1,without battery-backed:1,clocks prompt:1,prompt for:1,correct date:1,date and:1,when booted:1,booted Also:1,Also repeated:1,repeated use:1,usually makes:1,clock slow:1,seconds unless:1,unless code:1,will notify:1,notify you:1,time Nonetheless:1,Nonetheless it’s:1,reboot your:1,each session:1,correct Stopping:1,Timer At:1,At some:1,point after:1,after ZTimerOn:1,called ZTimerOff:1,ZTimerOff must:1,interval ZTimerOff:1,ZTimerOff saves:1,program latches:1,and reads:1,count converts:1,converts that:1,that count:1,count from:1,the countdown:1,countdown value:1,timer maintains:1,maintains to:1,of counts:1,counts elapsed:1,elapsed since:1,since ZTimerOn:1,called and:1,result Immediately:1,after latching:1,latching the:1,0 count—and:1,count—and before:1,before enabling:1,enabling interrupts:1,ZTimerOff checks:1,controller to:1,interrupt setting:1,setting a:1,overflowed if:1,interrupt After:1,After that:1,that ZTimerOff:1,ZTimerOff executes:1,executes just:1,overhead code:1,ZTimerOff 16:1,16 times:1,and averages:1,averages and:1,and saves:1,timing result:1,result just:1,just obtained:1,obtained were:1,were incurred:1,timer rather:1,timed Finally:1,Finally ZTimerOff:1,ZTimerOff restores:1,program including:1,flag that:1,effect when:1,returns One:1,of ZTimerOff:1,which timer:1,count We:1,8253 provides:1,special latched:1,feature for:1,count while:1,running That’s:1,too we’ve:1,we’ve no:1,since its:1,input isn’t:1,isn’t connected:1,connected Later:1,though we’ll:1,be stopped:1,stopped after:1,all We:1,simply tell:1,current count:1,8253 does:1,so without:1,breaking stride:1,stride Reporting:1,Reporting Timing:1,Timing Results:1,Results ZTimerReport:1,ZTimerReport may:1,results at:1,after both:1,both ZTimerOn:1,ZTimerOff have:1,been called:1,called ZTimerReport:1,ZTimerReport first:1,first checks:1,overflowed counted:1,over before:1,before ZTimerOff:1,ZTimerOff was:1,called if:1,if overflow:1,overflow did:1,did occur:1,occur ZTimerOff:1,ZTimerOff prints:1,returns Otherwise:1,Otherwise ZTimerReport:1,ZTimerReport subtracts:1,subtracts the:1,reference count:1,count representing:1,count measured:1,measured between:1,ZTimerOff converts:1,counts to:1,to microseconds:1,and prints:1,prints the:1,resulting time:1,standard output:1,output Note:1,that ZTimerReport:1,ZTimerReport need:1,after ZTimerOff:1,ZTimerOff In:1,fact after:1,given call:1,ZTimerOff ZTimerReport:1,ZTimerReport can:1,time right:1,next call:1,ZTimerOn You:1,measure several:1,several portions:1,program while:1,executes normally:1,normally in:1,case it:1,be desirable:1,text printed:1,printed by:1,by ZTimerReport:1,ZTimerReport interfere:1,program’s normal:1,display There:1,is removal:1,the invocations:1,invocations of:1,DOS print:1,print string:1,function INT:1,INT 21H:1,21H with:1,AH equal:1,9 from:1,from ZTimerReport:1,ZTimerReport instead:1,instead running:1,program under:1,debugger that:1,supports screen:1,screen flipping:1,flipping such:1,as Turbo:1,Turbo Debugger:1,Debugger or:1,or CodeView:1,CodeView placing:1,a breakpoint:1,breakpoint at:1,directly observing:1,microseconds as:1,as ZTimerReport:1,ZTimerReport calculates:1,calculates it:1,second approach:1,result at:1,some safe:1,safe location:1,memory such:1,unused portion:1,area A:1,A third:1,third approach:1,is alteration:1,result over:1,port to:1,terminal or:1,another PC:1,PC acting:1,acting as:1,terminal Similarly:1,Similarly many:1,many debuggers:1,debuggers can:1,be run:1,run from:1,a remote:1,remote terminal:1,terminal via:1,serial link:1,link Yet:1,printer via:1,either DOS:1,function 5:1,or BIOS:1,interrupt 17H:1,17H A:1,modify ZTimerReport:1,the auxiliary:1,auxiliary output:1,output via:1,to then:1,special device:1,driver named:1,named AUX:1,AUX to:1,which DOS:1,4 output:1,output would:1,would automatically:1,automatically be:1,be directed:1,directed This:1,This device:1,driver could:1,could send:1,result anywhere:1,anywhere you:1,might desire:1,desire The:1,might go:1,the secondary:1,secondary display:1,adapter over:1,port or:1,printer or:1,or could:1,buffer within:1,the driver:1,driver to:1,be dumped:1,dumped at:1,later time:1,time Credit:1,Credit for:1,approach goes:1,Michael Geary:1,Geary and:1,and thanks:1,thanks go:1,to David:1,David Miller:1,Miller for:1,for passing:1,passing the:1,idea on:1,me You:1,well want:1,devise still:1,approaches better:1,better suited:1,needs than:1,those I’ve:1,presented Go:1,it I’ve:1,I’ve just:1,just thrown:1,few possibilities:1,possibilities to:1,started Notes:1,subroutines are:1,be near-called:1,near-called from:1,public segment:1,segment Code:1,subroutines can:1,can however:1,or high-level:1,generates OBJ:1,files that:1,linker simply:1,segment used:1,timed or:1,procedures and:1,making far:1,timed as:1,chapter All:1,subroutines preserve:1,all flags:1,flags except:1,so calls:1,code If:1,procedures in:1,another segment:1,segment be:1,routines far:1,far including:1,including ReferenceZTimerOn:1,ReferenceZTimerOn and:1,and ReferenceZTimerOff:1,ReferenceZTimerOff You’ll:1,You’ll have:1,put FAR:1,PTR overrides:1,overrides on:1,calls from:1,from ZTimerOff:1,routines if:1,them far:1,far If:1,reference routines:1,routines aren’t:1,same type—near:1,type—near or:1,or far—as:1,far—as the:1,other routines:1,routines they:1,won’t reflect:1,true overhead:1,overhead incurred:1,and stopping:1,stopping the:1,timer Please:1,Please be:1,inaccuracy that:1,introduce into:1,the accuracy:1,performance measurements:1,measurements reported:1,every 838:1,838 ns:1,ns giving:1,count resolution:1,1µs although:1,although factors:1,queue as:1,below dynamic:1,internal timing:1,timing variations:1,8253 make:1,perhaps more:1,as measuring:1,than 10µs:1,10µs In:1,actually most:1,accurate in:1,in assessing:1,assessing code:1,when timing:1,intervals longer:1,100 µs:1,µs At:1,rate we’re:1,we’re most:1,in using:1,to assess:1,assess the:1,various code:1,code sequences—that:1,sequences—that is:1,tweak code—and:1,code—and the:1,than accurate:1,accurate enough:1,that purpose:1,computers I’ve:1,tested it:1,on including:1,including XTs:1,XTs ATs:1,ATs PS/2:1,and Pentium-based:1,Pentium-based machines:1,machines Of:1,course I:1,test it:1,all PC-compatibles:1,PC-compatibles but:1,problems computers:1,computers on:1,timer doesn’t:1,run can’t:1,can’t truly:1,truly be:1,called PC-compatible:1,PC-compatible On:1,on compatible:1,compatible computers:1,on genuine:1,IBM machines:1,machines or:1,either absolute:1,or relative:1,relative code:1,be similar:1,similar even:1,on different:1,different IBM:1,IBM models:1,fact quite:1,opposite is:1,true For:1,example every:1,every PS/2:1,PS/2 computer:1,computer even:1,slow Model:1,30 executes:1,executes code:1,or XT:1,XT As:1,the timings:1,timings for:1,Language on:1,an XT-compatible:1,XT-compatible computer:1,computer only:1,computer wasn’t:1,wasn’t quite:1,quite IBM-compatible:1,IBM-compatible regarding:1,regarding code:1,The differences:1,differences were:1,were minor:1,minor mind:1,but my:1,experience illustrates:1,of assuming:1,specific make:1,computer will:1,perform in:1,certain way:1,way without:1,actually checking:1,checking Not:1,this variation:1,variation between:1,between models:1,models makes:1,timer one:1,one whit:1,whit less:1,less useful—quite:1,useful—quite the:1,the contrary:1,contrary The:1,for evaluating:1,evaluating code:1,entire spectrum:1,spectrum of:1,of PC-compatible:1,computers A:1,A Sample:1,Sample Use:1,Timer Listing:1,for measuring:1,timer This:1,CS for:1,shortly includes:1,measured from:1,measured should:1,should contain:1,contain calls:1,ZTimerOff Listing:1,some sample:1,timed This:1,This listing:1,listing measures:1,execute 1000:1,1000 loads:1,MemVar Note:1,3.3 calls:1,calls ZTimerOn:1,timing performs:1,1000 MOV:1,calls ZTimerOff:1,end timing:1,timing When:1,3.2 is:1,named TESTCODE:1,3.3 Listing:1,3.2 calls:1,3.3 has:1,run It’s:1,3.3 begins:1,by jumping:1,MemVar This:1,approach lets:1,us avoid:1,avoid reproducing:1,reproducing Listing:1,3.2 in:1,entirety for:1,each code:1,code fragment:1,fragment we:1,measure by:1,by defining:1,defining any:1,any needed:1,needed data:1,data right:1,data each:1,listing becomes:1,becomes self-contained:1,self-contained and:1,be plugged:1,plugged directly:1,into Listing:1,3.2 as:1,as TESTCODE:1,TESTCODE Listing:1,3.2 sets:1,CS before:1,doing anything:1,else precisely:1,be embedded:1,fragments being:1,timed Note:1,initial jump:1,timer started:1,started since:1,of start-up:1,start-up code:1,interval That’s:1,ZTimerOff are:1,in TESTCODE:1,TESTCODE not:1,in PZTEST.ASM:1,PZTEST.ASM this:1,over which:1,which portion:1,of TESTCODE:1,TESTCODE is:1,timed and:1,keep set-up:1,like out:1,interval Listing:1,naming it:1,it TESTCODE:1,TESTCODE assembling:1,3.2 which:1,includes TESTCODE:1,3.1 with:1,TASM or:1,or MASM:1,resulting OBJ:1,Borland or:1,or Microsoft:1,3.4 shows:1,file PZTIME.BAT:1,PZTIME.BAT which:1,when run:1,this batch:1,file generates:1,file PZTEST.EXE:1,PZTEST.EXE PZTIME.BAT:1,PZTIME.BAT Listing:1,3.4 assumes:1,file PZTIMER.ASM:1,PZTIMER.ASM contains:1,file PZTEST.ASM:1,PZTEST.ASM contains:1,3.2 The:1,command-line parameter:1,parameter to:1,to PZTIME.BAT:1,PZTIME.BAT is:1,to TESTCODE:1,included into:1,into PZTEST.ASM:1,PZTEST.ASM Note:1,that Turbo:1,Turbo Assembler:1,Assembler can:1,be substituted:1,substituted for:1,for MASM:1,MASM by:1,replacing masm:1,masm with:1,with tasm:1,tasm and:1,link with:1,with tlink:1,tlink in:1,3.4 The:1,3.7 Assuming:1,named LST3-3.ASM:1,LST3-3.ASM and:1,3.4 is:1,named PZTIME.BAT:1,PZTIME.BAT the:1,3.3 would:1,command cb14-1:1,cb14-1 pztime:1,pztime LST3-3.ASM:1,LST3-3.ASM which:1,performs all:1,all assembly:1,linking and:1,and reports:1,reports the:1,3.3 When:1,above command:1,command is:1,executed on:1,an original:1,original 4.77:1,MHz IBM:1,time reported:1,is 3619:1,3619 µs:1,about 3.62:1,3.62 µs:1,memory While:1,is 3.619:1,3.619 µs:1,AL I’m:1,round off:1,off that:1,digit from:1,on No:1,many repetitions:1,are timed:1,timed there’s:1,much noise:1,noise in:1,timing process—between:1,process—between dynamic:1,internal state:1,processor at:1,of timing—for:1,timing—for that:1,digit to:1,any significance:1,significance Given:1,test PC’s:1,PC’s 4.77:1,clock this:1,about 17:1,MOV which:1,bit longer:1,than Intel’s:1,Intel’s specified:1,specified 10-cycle:1,10-cycle execution:1,instruction See:1,TASM documentation:1,documentation or:1,or Intel’s:1,Intel’s processor:1,processor reference:1,for official:1,times Fear:1,right MOV:1,AL MEMVAR:1,MEMVAR really:1,does take:1,take 17:1,3.3 Exactly:1,about In:1,perform any:1,timing tests:1,book enter:1,it PZTIMER.ASM:1,PZTIMER.ASM enter:1,it PZTEST.ASM:1,PZTEST.ASM and:1,3.4 and:1,it PZTIME.BAT:1,PZTIME.BAT Then:1,Then simply:1,simply enter:1,listing you:1,file filename:1,filename and:1,command cb15-1:1,cb15-1 pztime:1,pztime filename:1,filename In:1,fact that’s:1,timed each:1,book Code:1,Code fragments:1,fragments you:1,write yourself:1,yourself can:1,code directly:1,programs rather:1,3.2 simply:1,simply insert:1,insert calls:1,ZTimerReport in:1,appropriate places:1,link PZTIMER:1,PZTIMER to:1,The Long-Period:1,Timer With:1,exceptions the:1,timer presented:1,presented above:1,serve us:1,us well:1,book since:1,since we’ll:1,be focusing:1,on relatively:1,relatively short:1,short code:1,take much:1,execute Occasionally:1,intervals What’s:1,will want:1,sequences longer:1,career Accordingly:1,Accordingly I’ve:1,also developed:1,for periods:1,so named:1,named by:1,timer just:1,just presented:1,presented shown:1,3.5 can:1,measure periods:1,periods up:1,one hour:1,hour in:1,length The:1,key difference:1,timer leaves:1,enabled during:1,period As:1,are recognized:1,recognized by:1,PC allowing:1,an accurate:1,accurate system:1,period Theoretically:1,Theoretically this:1,this enables:1,enables measurement:1,measurement of:1,of arbitrarily:1,arbitrarily long:1,long periods:1,periods Practically:1,measure more:1,minutes since:1,DOS time:1,of day:1,date functions:1,functions or:1,or indeed:1,commands in:1,file serve:1,serve perfectly:1,intervals Since:1,Since very:1,long timing:1,intervals aren’t:1,aren’t needed:1,timer uses:1,simplified means:1,calculating elapsed:1,elapsed time:1,to measuring:1,measuring intervals:1,less If:1,period longer:1,timer prints:1,effect that:1,interval of:1,that length:1,length For:1,For implementation:1,implementation reasons:1,reasons the:1,also incapable:1,incapable of:1,starts before:1,before midnight:1,midnight and:1,ends after:1,after midnight:1,midnight if:1,that eventuality:1,eventuality occurs:1,occurs the:1,was unable:1,because midnight:1,midnight was:1,was crossed:1,crossed If:1,just time:1,again secure:1,problem again:1,for 23-odd:1,23-odd hours:1,hours You:1,requires interrupts:1,stretch during:1,interval since:1,since when:1,is subject:1,same 54:1,ms maximum:1,maximum measurement:1,measurement time:1,While permitting:1,permitting the:1,occur allows:1,allows long:1,long intervals:1,intervals to:1,timed that:1,same interrupt:1,interrupt makes:1,timer less:1,timer since:1,BIOS spends:1,spends handling:1,handling timer:1,timer Likewise:1,interval most:1,notably keyboard:1,keyboard and:1,and mouse:1,mouse interrupts:1,interrupts will:1,the measured:1,reboot the:1,system after:1,a session:1,timer does:1,for introducing:1,introducing major:1,major inaccuracy:1,single timing:1,timing run:1,run since:1,it leaves:1,therefore allows:1,update normally:1,normally Stopping:1,the Clock:1,Clock There’s:1,measure times:1,ms we:1,must maintain:1,maintain not:1,timing components:1,The time-of-day:1,the passage:1,passage of:1,of 54.9:1,intervals while:1,measures time:1,time within:1,within those:1,those 54.9:1,intervals We:1,two time:1,time components:1,components simultaneously:1,clean reading:1,reading Otherwise:1,may read:1,interrupt then:1,interrupt has:1,has occurred:1,occurred and:1,and caused:1,caused the:1,turn over:1,a resulting:1,resulting 54:1,ms measurement:1,measurement inaccuracy:1,inaccuracy The:1,The opposite:1,opposite sequence—reading:1,sequence—reading the:1,timer count—can:1,count—can result:1,a 54:1,ms inaccuracy:1,direction The:1,0 read:1,read both:1,and time-of-day:1,time-of-day counts:1,counts while:1,stopped and:1,then restart:1,restart the:1,timer Alas:1,the gate:1,to timer:1,isn’t program-controllable:1,program-controllable in:1,PC so:1,The latched:1,feature we:1,3.1 doesn’t:1,doesn’t stop:1,timer it:1,it latches:1,latches a:1,count but:1,timer keeps:1,keeps running:1,running What:1,What should:1,out an:1,8253 makes:1,timer dead:1,dead in:1,tracks Setting:1,loaded causes:1,stop until:1,loaded Surprisingly:1,Surprisingly the:1,count remains:1,remains readable:1,readable and:1,correct while:1,initial load:1,load In:1,beautifully with:1,with fully:1,fully 8253-compatible:1,8253-compatible chips:1,chips However:1,work since:1,it programs:1,8253 in:1,undocumented way:1,more IBM:1,IBM chose:1,chose not:1,implement compatibility:1,particular 8253:1,8253 feature:1,feature in:1,the custom:1,custom chips:1,chips used:1,in PS/2:1,computers On:1,On PS/2:1,then stop:1,BIOS count:1,interrupts as:1,possible We’ll:1,accept the:1,on PS/2:1,occasionally get:1,a reading:1,reading that’s:1,that’s off:1,I’ve set:1,3.5 so:1,can assemble:1,assemble to:1,either use:1,undocumented timer-stopping:1,timer-stopping feature:1,feature as:1,you please:1,please The:1,The PS2:1,equate selects:1,operation If:1,If PS2:1,3.5 then:1,the latch-and-read:1,method is:1,used if:1,if PS2:1,undocumented timer-stop:1,The latch-and-read:1,method will:1,computers but:1,occasionally produce:1,produce results:1,are incorrect:1,incorrect by:1,The timer-stop:1,approach avoids:1,avoids synchronization:1,synchronization problems:1,problems but:1,computers Moreover:1,Moreover because:1,the timer-stop:1,approach could:1,conceivably cause:1,cause erratic:1,erratic 8253:1,8253 operation:1,operation which:1,turn seriously:1,seriously affect:1,affect your:1,your computer’s:1,computer’s operation:1,operation until:1,next reboot:1,reboot In:1,In non-8253-compatible:1,non-8253-compatible systems:1,systems I’ve:1,observed not:1,only wildly:1,wildly incorrect:1,incorrect timing:1,also failure:1,a diskette:1,diskette drive:1,drive to:1,to operate:1,operate properly:1,properly after:1,be alert:1,for signs:1,of trouble:1,do set:1,0 Rebooting:1,Rebooting should:1,should clear:1,clear up:1,any timer-related:1,timer-related problems:1,us another:1,reboot at:1,code-timing session:1,session You:1,should immediately:1,immediately reboot:1,reboot and:1,equate to:1,get erratic:1,erratic or:1,or obviously:1,obviously incorrect:1,incorrect results:1,when PS2:1,0 If:1,0 it:1,set first:1,then to:1,results match:1,match If:1,they’re consistently:1,consistently different:1,different you:1,should set:1,1 While:1,the the:1,the non-PS/2:1,non-PS/2 version:1,more dangerous:1,dangerous than:1,the PS/2:1,PS/2 version:1,version it:1,also produces:1,accurate results:1,work If:1,a non-PS/2:1,non-PS/2 PC-compatible:1,PC-compatible computer:1,computer the:1,timing approaches:1,yours If:1,do leave:1,3.5 you:1,should repeat:1,code-timing run:1,run several:1,times before:1,be accurate:1,ms since:1,since variations:1,variations may:1,may result:1,possible lack:1,of synchronization:1,synchronization between:1,once no:1,matter which:1,which version:1,timer you’re:1,using since:1,since interrupts:1,interrupts which:1,be enabled:1,enabled in:1,properly may:1,can alter:1,alter execution:1,time substantially:1,substantially Finally:1,Finally please:1,please note:1,both PS/2:1,and non-PS/2:1,non-PS/2 computers:1,The PS/2:1,and 8253:1,8253 considerations:1,considerations we’ve:1,just discussed:1,discussed apply:1,apply only:1,timer Example:1,Example Use:1,the Long-Period:1,same calling:1,calling interface:1,interface as:1,timer simply:1,by linking:1,linking it:1,of linking:1,code Whenever:1,timer informs:1,informs you:1,timed takes:1,takes too:1,is link:1,link in:1,timer instead:1,3.6 shows:1,3.2 it’s:1,3.6 waits:1,seconds before:1,calling ZTimerOn:1,ZTimerOn thereby:1,allowing any:1,any pending:1,pending keyboard:1,keyboard interrupts:1,processed Since:1,Since interrupts:1,interrupts must:1,time periods:1,the interrupts:1,interrupts generated:1,by keystrokes:1,keystrokes including:1,the upstroke:1,upstroke of:1,the Enter:1,Enter key:1,press that:1,that matter—could:1,matter—could incorrectly:1,incorrectly inflate:1,inflate the:1,time recorded:1,recorded by:1,timer In:1,In light:1,this resist:1,resist the:1,the temptation:1,to type:1,type ahead:1,ahead move:1,mouse or:1,like while:1,is timing:1,timing As:1,3.6 is:1,naming the:1,timed TESTCODE:1,TESTCODE then:1,then assembling:1,3.6 and:1,3.5 with:1,two files:1,Microsoft or:1,or Borland:1,Borland linker:1,3.7 shows:1,file named:1,named LZTIME.BAT:1,LZTIME.BAT which:1,above generating:1,file LZTEST.EXE:1,LZTEST.EXE LZTIME.BAT:1,LZTIME.BAT assumes:1,file LZTIMER.ASM:1,LZTIMER.ASM contains:1,3.5 and:1,file LZTEST.ASM:1,LZTEST.ASM contains:1,3.8 shows:1,shows sample:1,3.8 measures:1,execute 20000:1,20000 loads:1,time too:1,8088 When:1,When LZTIME.BAT:1,LZTIME.BAT is:1,PC with:1,following command:1,line assuming:1,assuming the:1,file LST3-8.ASM:1,LST3-8.ASM cb20-1:1,cb20-1 lztime:1,lztime lst3-8.asm:1,lst3-8.asm the:1,is 72544:1,72544 µs:1,about 3.63:1,3.63 µs:1,just slightly:1,slightly longer:1,AL measured:1,enabled by:1,extra fraction:1,microsecond measured:1,measured per:1,MOV reflects:1,BIOS code:1,the 18.2:1,18.2 timer:1,occur each:1,each second:1,second Note:1,command can:1,as 10:1,finish on:1,slow PC:1,PC if:1,using MASM:1,MASM with:1,spent assembling:1,3.8 Why:1,Because MASM:1,MASM is:1,at assembling:1,assembling REPT:1,REPT blocks:1,block in:1,repeated 20000:1,20000 times:1,times Using:1,Timer from:1,in C—but:1,C—but not:1,not right:1,right out:1,box As:1,As presented:1,presented earlier:1,earlier the:1,language some:1,some relatively:1,relatively minor:1,minor modifications:1,modifications are:1,required before:1,the ZTimerOn:1,ZTimerOn start:1,start timer:1,timer ZTimerOff:1,ZTimerOff stop:1,ZTimerReport display:1,results routines:1,routines can:1,C There:1,separate cases:1,with here:1,here small:1,large I’ll:1,simpler one:1,model first:1,first Altering:1,for linking:1,linking to:1,following steps:1,steps Change:1,Change ZTimerOn:1,ZTimerOn change:1,change ZTimerOff:1,ZTimerOff change:1,change ZTimerReport:1,to ZTimerReport:1,change Code:1,Code to:1,to TEXT:1,TEXT Figure:1,changed These:1,These changes:1,changes convert:1,use C-style:1,C-style external:1,external label:1,label names:1,names and:1,C use:1,C specifier:1,specifier as:1,in cb21-1:1,cb21-1 extern:1,extern C:1,C ZTimerOn(void:1,ZTimerOn(void when:1,when declaring:1,declaring the:1,routines extern:1,extern so:1,that name-mangling:1,name-mangling doesn’t:1,the linker:1,linker can:1,the routines:1,routines C-style:1,C-style names:1,names That’s:1,takes after:1,after doing:1,this you’ll:1,C as:1,in I’m:1,timer here:1,long-period timer—Listing:1,timer—Listing 3.5—requires:1,3.5—requires the:1,same modifications:1,modifications but:1,to different:1,C Altering:1,in C’s:1,C’s large:1,complex because:1,above changes:1,changes all:1,all functions:1,functions including:1,internal reference:1,timing routines:1,calculate overhead:1,overhead so:1,subtracted out:1,out must:1,far Figure:1,C Again:1,are specific:1,timer but:1,similar The:1,full listings:1,the C-callable:1,C-callable Zen:1,CD-ROM Watch:1,for Optimizing:1,Optimizing Assemblers:1,Assemblers One:1,One important:1,tip when:1,code Watch:1,Watch out:1,for optimizing:1,assemblers TASM:1,TASM actually:1,actually replaces:1,replaces with:1,for ReferenceZTimerOff:1,ReferenceZTimerOff which:1,which works:1,because ReferenceZTimerOn:1,ReferenceZTimerOn is:1,same segment:1,optimization being:1,being both:1,both smaller:1,call Figure:1,timer because:1,our purpose:1,purpose in:1,in calling:1,determine exactly:1,by overhead:1,overhead code—including:1,code—including the:1,and ZTimerOf:1,ZTimerOf By:1,By converting:1,pairs within:1,timer module:1,module TASM:1,TASM makes:1,emulate exactly:1,makes timings:1,timings slightly:1,slightly about:1,about 16:1,386 less:1,accurate What’s:1,solution Put:1,the NOSMART:1,NOSMART directive:1,directive at:1,This directive:1,directive instructs:1,instructs TASM:1,TASM to:1,turn off:1,all optimizations:1,optimizations including:1,including converting:1,converting far:1,pairs By:1,my knowledge:1,knowledge no:1,MASM up:1,through version:1,version 5.10A:1,5.10A In:1,whole business:1,business of:1,assemblers is:1,a mixed:1,mixed blessing:1,blessing In:1,general it’s:1,assembler shortening:1,shortening jumps:1,selecting sign-extended:1,sign-extended forms:1,you On:1,of tricks:1,like substituting:1,substituting push/near:1,tricks can:1,when complete:1,needed Sure:1,Sure complete:1,needed very:1,very rarely:1,rarely but:1,assemblers can:1,subtle problems:1,discovered TASM’s:1,TASM’s alteration:1,of far:1,calls only:1,view the:1,the debugger:1,debugger and:1,same if:1,of MASM:1,MASM I’ve:1,changes shown:1,in Figures:1,Figures 3.2:1,and 3.3:1,3.3 with:1,C 4.0:1,4.0 and:1,also with:1,latest MASM:1,C/C compiler:1,compiler Further:1,Reading For:1,who wish:1,code measurement:1,measurement further:1,further one:1,about measuring:1,is Programming:1,Programming Insight:1,Insight High-Performance:1,High-Performance Software:1,Software Analysis:1,Analysis on:1,PC by:1,by Byron:1,Byron Sheppard:1,Sheppard which:1,which appeared:1,the January:1,of Byte:1,Byte For:1,For complete:1,complete if:1,somewhat cryptic:1,cryptic information:1,itself I:1,Intel’s Microsystem:1,Microsystem Components:1,Components Handbook:1,Handbook which:1,useful reference:1,other PC:1,PC components:1,8259 Programmable:1,Programmable Interrupt:1,Interrupt Controller:1,Controller and:1,DMA Controller:1,Controller For:1,details about:1,8253 is:1,BIOS resources:1,resources I:1,you consult:1,consult IBM’s:1,IBM’s series:1,technical reference:1,PC XT:1,XT AT:1,AT Model:1,30 and:1,and microchannel:1,microchannel computers:1,computers such:1,the Models:1,Models 50:1,50 60:1,60 and:1,and 80:1,80 For:1,purposes however:1,critical that:1,works All:1,All you:1,we’ve accomplished:1,accomplished that:1,chapter Armed:1,Timer Onward:1,Onward and:1,and Upward:1,Upward The:1,finest resolution:1,measure an:1,best about:1,1µs a:1,a 66:1,Pentium computer:1,as 132:1,132 instructions:1,although an:1,be hard-pressed:1,hard-pressed to:1,microsecond Another:1,itself interferes:1,and processor:1,timed because:1,necessarily fetched:1,fetched and:1,necessarily access:1,time sequence:1,sequence as:1,code immediately:1,immediately preceding:1,under measurement:1,measurement normally:1,normally does:1,This prefetch:1,prefetch effect:1,effect can:1,introduce as:1,4 µs:1,µs of:1,of inaccuracy:1,inaccuracy Similarly:1,queue at:1,timed affects:1,affects how:1,that stops:1,stops the:1,timer takes:1,execute Consequently:1,timer tends:1,accurate for:1,relative magnitude:1,inaccuracy introduced:1,introduced by:1,timer becomes:1,less over:1,over longer:1,periods Imperfections:1,Imperfections notwithstanding:1,good tool:1,for exploring:1,exploring C:1,and x86:1,family assembly:1,tool we’ll:1,use frequently:1,frequently for:1,book Chapter:1,Cycle-Eaters How:1,PC Hardware:1,Hardware Devours:1,Devours Code:1,Code Performance:1,Performance This:1,Language located:1,located on:1,CD-ROM goes:1,goes right:1,my philosophy:1,philosophy of:1,optimization Understand:1,Understand where:1,time really:1,goes when:1,runs That:1,That may:1,sound ridiculously:1,chapter makes:1,makes clear:1,clear it:1,a challenging:1,challenging task:1,times verges:1,verges on:1,on black:1,black magic:1,magic This:1,a long-time:1,long-time favorite:1,mine because:1,the first—and:1,first—and to:1,large extent:1,extent only—work:1,only—work that:1,that discussed:1,discussed this:1,material thereby:1,thereby introducing:1,introducing a:1,a generation:1,programmers to:1,to pedal-to-the-metal:1,optimization This:1,chapter focuses:1,focuses almost:1,first popular:1,popular x86-family:1,x86-family processor:1,8088 Some:1,specific features:1,I cite:1,cite in:1,longer applicable:1,to modern:1,modern x86-family:1,processors such:1,out later:1,processors Nonetheless:1,overall theme:1,theme of:1,this chapter—that:1,chapter—that understanding:1,understanding dimly-seen:1,dimly-seen and:1,and poorly-documented:1,poorly-documented code:1,code gremlins:1,gremlins called:1,called cycle-eaters:1,that lurk:1,performance programming—is:1,programming—is every:1,as valid:1,valid today:1,today Also:1,Also later:1,chapters often:1,often refer:1,basic cycle-eaters:1,cycle-eaters described:1,the discussions:1,of x86-family:1,x86-family optimization:1,come What’s:1,timer remains:1,to flush:1,flush out:1,and examine:1,examine cycle-eaters:1,cycle-eaters as:1,good an:1,an illustration:1,find So:1,don’t take:1,take either:1,relative execution:1,times presented:1,gospel for:1,for newer:1,rules have:1,changed over:1,least skim:1,skim through:1,through this:1,book Cycle-Eaters:1,Cycle-Eaters Programming:1,Programming has:1,levels ranging:1,familiar high-level:1,languages DOS:1,like down:1,the esoteric:1,esoteric things:1,the shadowy:1,shadowy edge:1,of hardware-land:1,hardware-land I:1,cycle-eaters because:1,because like:1,the monsters:1,monsters in:1,bad 50s:1,50s horror:1,horror movie:1,movie they:1,they lurk:1,those shadows:1,shadows taking:1,taking their:1,their share:1,your program’s:1,program’s performance:1,performance without:1,forces of:1,of goodness:1,goodness or:1,the U.S:1,Army In:1,by examining:1,examining the:1,live beneath:1,is beneath:1,beneath your:1,application DOS:1,and BIOS—in:1,BIOS—in fact:1,fact beneath:1,set itself:1,itself Why:1,Why start:1,level Simply:1,because cycle-eaters:1,cycle-eaters affect:1,all assembler:1,yet are:1,almost unknown:1,unknown to:1,programmers A:1,A full:1,full understanding:1,their implications:1,implications That’s:1,most books:1,about assembly:1,programming fall:1,fall short:1,short Nearly:1,Nearly all:1,all literature:1,programming discusses:1,discusses only:1,BIOS and:1,and DOS:1,calls Those:1,Those topics:1,topics cover:1,programs most:1,most thoroughly—but:1,thoroughly—but it’s:1,it’s performance:1,performance above:1,after No:1,one ever:1,ever tells:1,tells you:1,raw stuff:1,stuff of:1,which lies:1,lies beneath:1,interface in:1,the dimly-seen:1,dimly-seen realm—populated:1,realm—populated by:1,prefetching dynamic:1,wait states—where:1,states—where software:1,software meets:1,meets hardware:1,hardware This:1,the domain:1,domain of:1,never discussed:1,yet it:1,mechanisms operating:1,operating at:1,can fully:1,fully understand:1,and properly:1,properly improve:1,code Which:1,to cycle-eaters:1,cycle-eaters The:1,The Nature:1,of Cycle-Eaters:1,Cycle-Eaters Cycle-eaters:1,Cycle-eaters are:1,are gremlins:1,gremlins that:1,live on:1,in peripherals:1,peripherals and:1,sometimes within:1,itself slowing:1,doesn’t execute:1,speed Most:1,Most cycle-eaters:1,those haunting:1,haunting the:1,older Intel:1,Intel processors:1,processors live:1,live outside:1,the CPU’s:1,CPU’s Execution:1,Unit where:1,only affect:1,CPU when:1,write Once:1,Once your:1,already inside:1,CPU those:1,can no:1,problem Only:1,Pentium CPUs:1,CPUs will:1,find cycle-eaters:1,cycle-eaters inside:1,chip as:1,nature and:1,and severity:1,severity of:1,vary enormously:1,enormously from:1,from processor:1,processor to:1,to processor:1,especially from:1,architecture In:1,need first:1,simplest among:1,them those:1,that haunted:1,haunted the:1,PC Later:1,better able:1,explain the:1,newer generation:1,those ancestral:1,ancestral cycle-eaters—but:1,cycle-eaters—but we:1,the groundwork:1,groundwork down:1,down first:1,8088’s Ancestral:1,Ancestral Cycle-Eaters:1,Cycle-Eaters Internally:1,speed at:1,all times—unless:1,times—unless external:1,required External:1,External data:1,must traverse:1,PC’s data:1,bus one:1,from peripherals:1,peripherals with:1,with cycle-eaters:1,cycle-eaters lurking:1,lurking along:1,every step:1,step of:1,more external:1,data includes:1,includes not:1,only memory:1,also instruction:1,from cycle-eaters:1,cycle-eaters Since:1,Since some:1,8088’s fastest:1,are register-only:1,instructions that’s:1,important indeed:1,The major:1,are The:1,queue Dynamic:1,refresh Wait:1,states notably:1,notably display:1,80386 computers:1,computers system:1,The locations:1,the primordial:1,PC are:1,4.1 We’ll:1,We’ll cover:1,turn in:1,The material:1,material won’t:1,easy since:1,since cycle-eaters:1,most subtle:1,subtle aspects:1,token however:1,however this:1,rewarding chapters:1,book Don’t:1,don’t catch:1,catch everything:1,do read:1,the going:1,going gets:1,bit tough:1,tough Cycle-eaters:1,Cycle-eaters play:1,play a:1,key role:1,role in:1,chapters so:1,some familiarity:1,desirable The:1,The 8-Bit:1,Cycle-Eater Look:1,Look Down:1,Down on:1,the motherboard:1,motherboard It’s:1,8088 Fans:1,8088 call:1,processor Fans:1,other 16-bit:1,16-bit processors:1,processors call:1,processor that:1,often performs:1,performs like:1,like an:1,is internally:1,internally a:1,processor equivalent:1,8086 In:1,8086 is:1,8088 except:1,man’s 8086:1,8086 because:1,allows a:1,a cheaper—albeit:1,cheaper—albeit slower—system:1,slower—system to:1,built thanks:1,the half-sized:1,half-sized bus:1,bus In:1,performing any:1,given 16-bit:1,16-bit operation—addition:1,operation—addition subtraction:1,subtraction even:1,even multiplication:1,multiplication or:1,or division—with:1,division—with a:1,instruction Externally:1,Externally however:1,is unequivocally:1,unequivocally an:1,processor since:1,wide In:1,is 16:1,hardware interface:1,4.2 The:1,this mismatch:1,mismatch is:1,simple Word-sized:1,Word-sized data:1,transferred between:1,or peripherals:1,peripherals at:1,say one-half:1,designed Figure:1,4.1 the:1,cycle-eater lies:1,lies squarely:1,bus Technically:1,Technically it:1,place this:1,Unit which:1,breaks 16-bit:1,into paired:1,paired 8-bit:1,8-bit accesses:1,accesses but:1,limited width:1,bus that:1,that constricts:1,constricts data:1,flow into:1,8088 True:1,also only:1,bus even:1,bus were:1,were 16:1,wide data:1,data could:1,still pass:1,pass into:1,8088 chip:1,chip itself:1,itself only:1,Each bus:1,or 0.838:1,µs in:1,the 4.77:1,and transfers:1,transfers 1:1,byte That:1,transferred into:1,µs While:1,While 8086:1,accesses also:1,also take:1,each 8086:1,transfer either:1,maximum transfer:1,µs Consequently:1,8086 has:1,every 0.419:1,0.419 µs:1,µs By:1,contrast every:1,8088 requires:1,two 4-cycle-long:1,4-cycle-long bus:1,word As:1,every 1.676:1,1.676 µs—and:1,µs—and that:1,cycle-eater A:1,related cycle-eater:1,cycle-eater lurks:1,lurks beneath:1,386SX chip:1,processor internally:1,internally with:1,16-bit path:1,The numbers:1,cycle-eater operates:1,operates is:1,same AT-compatible:1,AT-compatible systems:1,systems have:1,have 16-bit:1,16-bit data:1,data buses:1,buses which:1,16-bit word:1,The 386SX:1,386SX can:1,process 32:1,bits a:1,a doubleword:1,doubleword at:1,and loses:1,time fetching:1,fetching that:1,that doubleword:1,doubleword from:1,halves The:1,Cycle-Eater One:1,obvious effect:1,8088 take:1,than byte-sized:1,accesses That’s:1,timings indicate:1,additional 4:1,operand For:1,instance cb25-1:1,cb25-1 mov:1,mov axword:1,axword ptr:1,MemVar than:1,than cb26-1:1,cb26-1 mov:1,mov albyte:1,albyte ptr:1,MemVar Actually:1,two isn’t:1,exactly 4:1,clear once:1,once we:1,refresh cycle-eaters:1,cycle-eaters later:1,chapter What’s:1,cases one:1,multiple word-sized:1,accesses incurring:1,incurring that:1,4-cycle penalty:1,access For:1,example adding:1,variable requires:1,word-sized accesses—one:1,accesses—one to:1,memory prior:1,prior to:1,addition back:1,destination operand—and:1,operand—and thus:1,thus incurs:1,incurs not:1,two 4-cycle:1,4-cycle penalties:1,penalties As:1,result takes:1,about 8:1,execute than:1,than String:1,String instructions:1,cycle-eater to:1,greater extent:1,extent than:1,instructions Believe:1,MOVSW instruction:1,lose as:1,as 131070:1,131070 word-sized:1,accesses x:1,or 524280:1,524280 cycles:1,cycle-eater In:1,words one:1,one 8088:1,instruction admittedly:1,admittedly an:1,deal can:1,over one-tenth:1,second longer:1,longer on:1,8088 than:1,8086 simply:1,bus One-tenth:1,One-tenth of:1,a phenomenally:1,phenomenally long:1,computer terms:1,terms in:1,in one-tenth:1,second the:1,than 50000:1,50000 additions:1,and subtractions:1,subtractions The:1,transfer word-sized:1,which inevitably:1,inevitably causes:1,causes performance:1,when coupled:1,coupled with:1,Unit that:1,process word-sized:1,data every:1,8086 These:1,problems show:1,uses word-sized:1,operands More:1,More ominously:1,ominously as:1,cause performance:1,Cycle-Eater The:1,obvious implication:1,implication of:1,that byte-sized:1,performs byte-sized:1,accesses just:1,8086 For:1,instance Listing:1,Listing 4.1:1,4.1 which:1,variable as:1,counter runs:1,in 10.03:1,10.03 s:1,s per:1,That’s 20:1,the 12.05:1,12.05 µs:1,loop execution:1,Listing 4.2:1,4.2 which:1,word-sized counter:1,counter Why:1,Why the:1,in execution:1,times Simply:1,each word-sized:1,word-sized DEC:1,performs 4:1,4 byte-sized:1,accesses two:1,while each:1,byte-sized DEC:1,performs only:1,brief aside:1,aside concerning:1,concerning code:1,book Throughout:1,book I’ve:1,I’ve modeled:1,modeled the:1,code after:1,after working:1,are applicable:1,to real-world:1,real-world programming:1,programming In:1,In Listings:1,Listings 4.1:1,4.1 and:1,and 4.2:1,4.2 for:1,have shown:1,a still:1,advantage for:1,for byte-sized:1,byte-sized operands:1,operands simply:1,performing 1000:1,1000 DEC:1,row with:1,no branching:1,branching at:1,However DEC:1,vacuum so:1,used code:1,both decremented:1,decremented the:1,and tested:1,between decrementing:1,decrementing a:1,location simply:1,simply an:1,counter a:1,functional instruction:1,instruction sequence:1,sequence If:1,across code:1,optimal it’s:1,it’s simply:1,simply due:1,my desire:1,provide code:1,that’s relevant:1,real programming:1,problems On:1,hand optimal:1,optimal code:1,an elusive:1,elusive thing:1,thing indeed:1,indeed by:1,means should:1,you assume:1,ideal Examine:1,Examine it:1,it question:1,question it:1,improve upon:1,upon it:1,an inquisitive:1,inquisitive skeptical:1,skeptical mind:1,optimization Back:1,Back to:1,cycle-eater As:1,8088 work:1,work you:1,variables whenever:1,possible That:1,That does:1,use 2:1,variable in:1,instance cb31-1:1,cb31-1 mov:1,mov dlbyte:1,dlbyte ptr:1,MemVar cb31-2:1,cb31-2 mov:1,mov dhbyte:1,dhbyte ptr:1,MemVar 1:1,1 versus:1,versus cb32-1:1,cb32-1 mov:1,mov dxword:1,dxword ptr:1,MemVar Recall:1,that limitation:1,limitation is:1,also built:1,built so:1,second byte-sized:1,variable takes:1,just those:1,more There’s:1,can manipulate:1,variable faster:1,second separate:1,byte-sized instruction:1,fact you’re:1,that second:1,byte much:1,instruction thanks:1,execution address:1,like For:1,4.3 which:1,1000 word-sized:1,word-sized reads:1,in 3.77:1,3.77 µs:1,MHz 8088:1,8088 That’s:1,That’s 45:1,45 percent:1,the 5.49:1,5.49 µs:1,read of:1,4.4 which:1,same 1000:1,1000 words:1,words as:1,4.3 but:1,with 2000:1,2000 byte-sized:1,reads Both:1,Both listings:1,listings perform:1,memory accesses—2000:1,accesses—2000 accesses:1,byte-sized as:1,all 8088:1,8088 memory:1,accesses must:1,be Remember:1,Unit must:1,operand However:1,However Listing:1,4.3 is:1,it expends:1,expends only:1,4 additional:1,word while:1,4.4 performs:1,second LODSB:1,LODSB requiring:1,requiring 13:1,13 cycles:1,word In:1,short if:1,access let:1,8088 break:1,access into:1,efficient at:1,that task:1,be Word-sized:1,Word-sized variables:1,greatest feasible:1,feasible extent:1,extent since:1,since registers:1,are inside:1,where 16-bit:1,as 8-bit:1,8-bit operations:1,operations because:1,8-bit cycle-eater:1,keep as:1,variables of:1,sorts in:1,can Instructions:1,with register-only:1,register-only operands:1,operands execute:1,execute very:1,rapidly partially:1,partially because:1,they avoid:1,avoid both:1,time-consuming memory:1,the lengthy:1,lengthy address:1,calculations associated:1,operands There:1,why register:1,are preferable:1,unexpected effect:1,cycle-eater Instructions:1,only register:1,operands tend:1,be shorter:1,shorter in:1,performance shorter:1,usually better:1,must diverge:1,diverge for:1,moment For:1,few pages:1,been thinking:1,cycle-eater while:1,nuisance doesn’t:1,seem particularly:1,particularly subtle:1,subtle or:1,or difficult:1,to quantify:1,quantify After:1,instruction reference:1,reference tells:1,many cycles:1,instruction loses:1,loses to:1,it Yes:1,know approximately:1,approximately how:1,operand than:1,operand although:1,state cycle-eaters:1,cycle-eaters which:1,later can:1,can raise:1,raise the:1,cycle-eater considerably:1,considerably However:1,accesses lose:1,access we:1,haven’t discussed:1,discussed yet:1,yet instruction:1,fetching The:1,The ugliest:1,ugliest manifestation:1,manifestation of:1,The Prefetch:1,Cycle-Eater In:1,8088 context:1,context here’s:1,here’s the:1,nutshell The:1,bus keeps:1,Unit from:1,16-bit Execution:1,execute them:1,Unit often:1,often lies:1,idle while:1,fetched Exactly:1,why does:1,this happen:1,happen Recall:1,8086 internally:1,internally but:1,but accesses:1,accesses word-sized:1,8086 due:1,bus Unfortunately:1,Unfortunately instructions:1,8086 fetches:1,fetches meaning:1,8086 On:1,the 8086-equivalent:1,8086-equivalent Execution:1,instructions every:1,8086 The:1,Unit burns:1,burns up:1,up instruction:1,up idling:1,idling while:1,instructions bytes:1,to arrive:1,arrive The:1,The BIU:1,fetch instruction:1,4-cycle per:1,byte rate:1,ultimate limit:1,on overall:1,time regardless:1,of EU:1,EU speed:1,speed While:1,EU may:1,may execute:1,queue in:1,byte over:1,EU can’t:1,can arrive—and:1,arrive—and they:1,can’t arrive:1,arrive faster:1,cycles Clearly:1,Clearly then:1,cycle-eater 8088:1,code often:1,often runs:1,Execution Unit’s:1,Unit’s maximum:1,8-bit data:1,bus can’t:1,straightforward enough—so:1,enough—so why:1,why all:1,fuss about:1,cycle-eater What:1,cycle-eater tricky:1,it’s undocumented:1,undocumented and:1,and unpredictable:1,unpredictable That:1,access such:1,it’s well-documented:1,well-documented that:1,extra 4:1,cycles will:1,upper byte:1,cycle-eater lurking:1,lurking nearby:1,nearby For:1,should execute:1,in 10:1,SHR takes:1,execute according:1,Intel’s specifications:1,specifications Those:1,Those specifications:1,specifications contain:1,contain Intel’s:1,Intel’s official:1,this case—and:1,case—and in:1,many others—the:1,others—the specifications:1,specifications are:1,are drastically:1,drastically wrong:1,wrong Why:1,Because they:1,they describe:1,describe execution:1,time once:1,instruction reaches:1,reaches the:1,queue They:1,They say:1,reach the:1,queue if:1,there already:1,already Thanks:1,low performance:1,bus that’s:1,a glaring:1,glaring omission—but:1,omission—but alas:1,alas an:1,unavoidable one:1,one Let’s:1,are wrong:1,helped Official:1,Official Execution:1,Times Are:1,Are Only:1,Only Part:1,the Story:1,Story The:1,The sequence:1,5 SHR:1,10 bytes:1,long That:1,never execute:1,than 24:1,24 cycles:1,cycles even:1,the 4-byte:1,4-byte prefetch:1,starts since:1,since 6:1,bytes would:1,still remain:1,remain to:1,fetched at:1,per fetch:1,fetch If:1,empty at:1,sequence could:1,take 40:1,short thanks:1,fetching the:1,code won’t:1,its documented:1,documented speed:1,to Why:1,does Intel:1,Intel document:1,document Execution:1,than overall:1,Unit EU:1,time Well:1,Well instruction:1,fetching isn’t:1,isn’t performed:1,Unit but:1,but instead:1,instead is:1,is carried:1,carried on:1,parallel by:1,Unit BIU:1,BIU whenever:1,bus isn’t:1,or whenever:1,EU runs:1,execute Sometimes:1,BIU is:1,use spare:1,spare bus:1,bus cycles:1,prefetch instruction:1,bytes before:1,needs them:1,cases instruction:1,fetching takes:1,all practically:1,speaking At:1,At other:1,EU executes:1,fetching then:1,significant part:1,effective fetch:1,instruction varies:1,varies greatly:1,greatly depending:1,preceding that:1,instruction Similarly:1,state in:1,instruction leaves:1,queue affects:1,words while:1,is constant:1,constant the:1,is executing—the:1,executing—the amount:1,preceding instructions:1,instructions allowed—and:1,allowed—and can:1,later other:1,cycle-eaters such:1,as DRAM:1,cause prefetching:1,prefetching variations:1,variations even:1,even during:1,sequence Given:1,it’s meaningless:1,meaningless to:1,instruction except:1,specific code:1,sequence So:1,So now:1,often wrong:1,why Intel:1,Intel can’t:1,can’t provide:1,provide better:1,better specifications:1,specifications You:1,know now:1,now why:1,There Is:1,Is No:1,Such Beast:1,Beast as:1,a True:1,True Instruction:1,Instruction Execution:1,Execution Time:1,Time The:1,code preceding:1,preceding an:1,instruction makes:1,timer trickier:1,trickier to:1,expect and:1,and complicates:1,the interpretation:1,interpretation of:1,timer For:1,best used:1,instructions long:1,long below:1,below 10µs:1,10µs or:1,so prefetch:1,clock driving:1,cause problems:1,problems Some:1,Some slight:1,slight prefetch:1,prefetch queue-induced:1,queue-induced inaccuracy:1,inaccuracy usually:1,usually exists:1,exists even:1,usually alter:1,the code’s:1,code’s prefetch:1,queue from:1,normal state:1,state Branches—jumps:1,Branches—jumps calls:1,calls returns:1,returns and:1,the like—empty:1,like—empty the:1,queue Ideally:1,Ideally the:1,subroutine so:1,branches at:1,subroutine are:1,the subroutine’s:1,subroutine’s performance:1,performance Another:1,cycle-eater complicates:1,timer involves:1,the practice:1,practice of:1,timing the:1,instructions over:1,over I’ll:1,I’ll often:1,often repeat:1,repeat one:1,instructions 100:1,or 1000:1,row in:1,in listings:1,get timing:1,intervals that:1,are long:1,provide reliable:1,reliable measurements:1,measurements However:1,any 8088:1,preceding any:1,given use:1,turn affects:1,executing Alas:1,instruction preceded:1,by dozens:1,of identical:1,identical instructions:1,instructions reflects:1,reflects just:1,possible prefetch:1,state at:1,other prefetch:1,states may:1,well produce:1,produce distinctly:1,different results:1,Listings 4.5:1,4.5 and:1,and 4.6:1,4.6 Listing:1,4.5 shows:1,shows our:1,familiar SHR:1,SHR case:1,case Here:1,Here because:1,always empty:1,empty execution:1,about 4:1,per SHR:1,SHR as:1,4.3 Figure:1,4.3 illustrates:1,the relationship:1,between instruction:1,simplified way:1,timings of:1,8088 operations:1,operations That’s:1,That’s quite:1,official 2-cycle:1,2-cycle execution:1,SHR In:1,4.5 executes:1,in 1.81µs:1,1.81µs per:1,or slightly:1,shortly Going:1,Going by:1,4.5 we:1,would conclude:1,is 8.64:1,8.64 cycles:1,4.5 Figure:1,4.5 Now:1,let’s examine:1,4.6 Here:1,SHR follows:1,instruction Since:1,Since MUL:1,take so:1,execute that:1,they finish:1,finish each:1,SHR should:1,ready and:1,waiting in:1,preceding MUL:1,MUL ends:1,ends As:1,result we’d:1,would execute:1,cycles together:1,the 118-cycle:1,118-cycle execution:1,of multiplying:1,multiplying 0:1,0 times:1,times 0:1,to 120:1,4.4 And:1,And by:1,God when:1,4.6 we:1,of 25.14:1,25.14 µs:1,exactly 120:1,cycles According:1,results the:1,be 2:1,cycles quite:1,conclusion we:1,drew from:1,this We’ve:1,which SHR:1,SHR took:1,took 8-plus:1,took only:1,cycles Are:1,Are we:1,we talking:1,two different:1,SHR here:1,here Of:1,course not—the:1,not—the difference:1,a reflection:1,reflection of:1,differing states:1,preceding code:1,code left:1,queue In:1,4.5 each:1,SHR after:1,few follows:1,other SHR:1,have sucked:1,sucked the:1,queue dry:1,dry so:1,reflects instruction:1,4.6 follows:1,queue full:1,full so:1,reflects Execution:1,time Clearly:1,Clearly either:1,either instruction:1,or Execution:1,execution time—or:1,time—or even:1,two if:1,partially prefetched—can:1,prefetched—can determine:1,determine code:1,performance Some:1,people operate:1,operate under:1,thumb by:1,often true:1,it frequently:1,frequently doesn’t:1,doesn’t hold:1,rule should:1,accesses not:1,not instruction:1,bytes since:1,all accesses:1,PC For:1,another memory-accessing:1,instructions often:1,often have:1,have slower:1,slower Execution:1,access rule:1,rule would:1,dictate because:1,8088 isn’t:1,calculating memory:1,addresses Also:1,byte rule:1,rule isn’t:1,isn’t true:1,hurts performance:1,reduce either:1,count or:1,byte count:1,performance either:1,either For:1,4.7 which:1,of 4-cycle:1,4-cycle 2-byte:1,2-byte MOV:1,AL0 instructions:1,executes at:1,of 1.81:1,instruction Now:1,4.8 which:1,the 4-cycle:1,4-cycle MOV:1,AL0 with:1,the 3-cycle:1,3-cycle but:1,still 2-byte:1,2-byte SUB:1,SUB ALAL:1,ALAL Despite:1,Despite its:1,its 1-cycle-per-instruction:1,1-cycle-per-instruction advantage:1,advantage Listing:1,4.8 runs:1,speed as:1,4.7 The:1,reason Both:1,cases it:1,the 8-cycle:1,8-cycle instruction:1,or 4-cycle:1,4-cycle Execution:1,that limits:1,limits performance:1,4.6 Figure:1,4.6 As:1,thinking you’re:1,only improve:1,specific bit:1,the factor—either:1,factor—either instruction:1,or execution:1,sometimes a:1,the two—that’s:1,two—that’s limiting:1,you missed:1,the excitement:1,excitement the:1,the variability:1,variability of:1,prefetching means:1,our method:1,of testing:1,testing performance:1,executing 1000:1,1000 instructions:1,row by:1,means produces:1,produces true:1,true instruction:1,times any:1,manuals are:1,are true:1,true times:1,time given:1,manuals but:1,as 4:1,byte longer:1,longer depending:1,certain context:1,context and:1,is meaningful:1,meaningful only:1,context What:1,long useful:1,useful working:1,run not:1,takes and:1,timer gives:1,gather that:1,information Granted:1,Granted it:1,easier if:1,just add:1,neatly documented:1,documented instruction:1,execution times—but:1,times—but that’s:1,happen Without:1,Without actually:1,actually measuring:1,sequence you:1,simply don’t:1,For crying:1,out loud:1,loud even:1,who designed:1,designed the:1,8088 at:1,at Intel:1,Intel couldn’t:1,couldn’t tell:1,you exactly:1,quickly a:1,given 8088:1,sequence executes:1,executes on:1,PC just:1,it Get:1,Get used:1,only meaningful:1,meaningful in:1,context learn:1,learn the:1,thumb in:1,code Approximating:1,Approximating Overall:1,Overall Execution:1,Times Don’t:1,because overall:1,by both:1,times should:1,together when:1,when estimating:1,estimating performance:1,example practically:1,speaking each:1,4.5 does:1,take 8:1,time plus:1,execute Figure:1,4.3 shows:1,given SHR:1,fetch of:1,are overlapped:1,overlapped for:1,in charging:1,charging the:1,extra instruction:1,for SHR:1,being 6:1,which yields:1,yields an:1,when added:1,time Alternatively:1,Alternatively you:1,as taking:1,taking 8:1,then executing:1,in effectively:1,effectively 0:1,0 cycles:1,fetched Whichever:1,Whichever perspective:1,perspective you:1,prefer is:1,fine The:1,instruction overlap:1,overlap should:1,counted toward:1,all intents:1,intents and:1,and purposes:1,purposes one:1,instructions runs:1,cost whatsoever:1,whatsoever while:1,the overlap:1,overlap exists:1,exists As:1,working definition:1,definition we’ll:1,start when:1,Unit and:1,EU What:1,the Prefetch:1,Cycle-Eater Reducing:1,Reducing the:1,overriding principles:1,code How:1,One effective:1,effective technique:1,minimize access:1,operands since:1,such accesses:1,accesses compete:1,compete with:1,fetching for:1,for precious:1,precious memory:1,accesses You:1,also greatly:1,greatly reduce:1,reduce instruction:1,time simply:1,by your:1,your choice:1,instructions Keep:1,short Less:1,Less time:1,are 1:1,long than:1,are 5:1,long Reduced:1,Reduced instruction:1,fetching lowers:1,lowers minimum:1,time minimum:1,often leads:1,execution While:1,While short:1,instructions minimize:1,minimize overall:1,overall prefetch:1,time ironically:1,ironically they:1,actually often:1,often suffer:1,suffer more:1,more from:1,bottleneck than:1,do long:1,instructions Short:1,instructions generally:1,such fast:1,fast execution:1,times that:1,they drain:1,drain the:1,queue despite:1,despite their:1,their small:1,small size:1,the SHR:1,SHR of:1,4.5 which:1,only 25:1,its Execution:1,long thanks:1,bottleneck Short:1,nonetheless generally:1,than long:1,instructions thanks:1,faster Execution:1,as possible—just:1,possible—just don’t:1,expect them:1,official documented:1,documented speeds:1,speeds More:1,than anything:1,above rules:1,rules mean:1,mean using:1,possible both:1,because register-only:1,are short:1,don’t perform:1,write operands:1,operands However:1,However using:1,thumb not:1,a commandment:1,commandment In:1,circumstances it:1,The look-up:1,table technique:1,such case:1,case What’s:1,instruction differs:1,sequence to:1,differ during:1,sequence All:1,all writing:1,art as:1,science As:1,result you:1,thumb described:1,described here—and:1,here—and then:1,then time:1,should experiment:1,experiment freely:1,freely but:1,but always:1,always remember:1,that actual:1,measured performance:1,line Holding:1,Holding Up:1,Up the:1,taken you:1,you further:1,further into:1,the depths:1,depths of:1,PC telling:1,you again:1,lowest possible:1,possible level:1,wonder Have:1,Have we:1,we gotten:1,gotten low:1,enough Not:1,Not quite:1,yet The:1,and prefetch:1,queue cycle-eaters:1,are low-level:1,low-level indeed:1,indeed but:1,we’ve one:1,level yet:1,go Dynamic:1,wait states—our:1,states—our next:1,next topics—together:1,topics—together form:1,PC affects:1,performance Below:1,Below this:1,interest only:1,engineers Before:1,refresh let’s:1,take an:1,overall look:1,this lowest:1,cycle-eaters In:1,the distinctions:1,between wait:1,refresh don’t:1,programmer What:1,understand this:1,this Under:1,circumstances devices:1,devices on:1,bus can:1,can stop:1,for 1:1,cycles making:1,code run:1,it seemingly:1,should Unlike:1,Unlike all:1,cycle-eaters we’ve:1,we’ve encountered:1,encountered so:1,far wait:1,are strictly:1,strictly external:1,as was:1,was shown:1,4.1 Adapters:1,Adapters on:1,bus such:1,memory cards:1,cards can:1,any bus:1,idea being:1,access properly:1,properly unless:1,is stretched:1,stretched out:1,out Likewise:1,the channel:1,controller dedicated:1,to dynamic:1,can request:1,request control:1,bus at:1,must relinquish:1,relinquish the:1,bus before:1,over This:1,can’t directly:1,directly control:1,control wait:1,states or:1,or dynamic:1,refresh However:1,sometimes be:1,cycle-eaters slow:1,slow your:1,code without:1,without there:1,there being:1,it you’re:1,still better:1,off understanding:1,you’re losing:1,losing performance:1,knowing why:1,why your:1,it’s supposed:1,to than:1,in ignorance:1,ignorance Let’s:1,every program:1,PC Dynamic:1,RAM Refresh:1,Refresh The:1,The Invisible:1,Invisible Hand:1,Hand Dynamic:1,God By:1,refresh invisibly:1,invisibly and:1,and inexorably:1,inexorably steals:1,steals a:1,certain fraction:1,programs when:1,When they:1,accessing cache:1,more recent:1,recent processors:1,processors theoretically:1,theoretically the:1,play but:1,cycle-eaters waiting:1,to prey:1,prey on:1,on cache-bound:1,cache-bound programs:1,programs While:1,stop DRAM:1,refresh you:1,sure prescription:1,prescription for:1,for crashing:1,crashing your:1,end thanks:1,refresh almost:1,it otherwise:1,otherwise would:1,would and:1,that A:1,A bit:1,background A:1,A static:1,RAM SRAM:1,SRAM chip:1,memory chip:1,that retains:1,as power:1,maintained By:1,several blocks:1,chip retains:1,contents for:1,short time:1,after it’s:1,it’s accessed:1,accessed for:1,write In:1,store data:1,an extended:1,extended period:1,period each:1,that chip:1,chip must:1,accessed regularly:1,regularly so:1,the chip’s:1,chip’s stored:1,stored data:1,kept refreshed:1,refreshed and:1,and valid:1,valid So:1,So long:1,done often:1,enough a:1,chip will:1,will retain:1,retain its:1,indefinitely All:1,memory consists:1,DRAM chips:1,chips Each:1,Each DRAM:1,be completely:1,completely refreshed:1,refreshed about:1,about once:1,four milliseconds:1,milliseconds in:1,ensure the:1,the integrity:1,integrity of:1,stores Obviously:1,Obviously it’s:1,it’s highly:1,desirable that:1,PC retain:1,retain the:1,correct data:1,data indefinitely:1,be refreshed:1,refreshed within:1,within 4:1,ms of:1,last refresh:1,refresh Since:1,Since there’s:1,given program:1,access each:1,every DRAM:1,DRAM block:1,block once:1,PC contains:1,contains special:1,for providing:1,providing DRAM:1,refresh How:1,How DRAM:1,Refresh Works:1,Works in:1,PC On:1,PC timer:1,power-up to:1,signal once:1,or once:1,every 15.08µs:1,15.08µs That:1,That signal:1,signal goes:1,to channel:1,controller which:1,which requests:1,requests the:1,8088 upon:1,upon receiving:1,receiving the:1,the signal:1,signal DMA:1,DMA stands:1,stands for:1,for direct:1,direct memory:1,device other:1,and access:1,As soon:1,accesses it:1,gives control:1,bus to:1,8237 which:1,with special:1,circuitry on:1,PC’s motherboard:1,motherboard then:1,then performs:1,single 4-cycle:1,4-cycle read:1,possible addresses:1,addresses advancing:1,address on:1,successive access:1,access The:1,of refreshing:1,refreshing the:1,DRAM the:1,read isn’t:1,The 256:1,addresses accessed:1,refresh DMA:1,DMA accesses:1,together they:1,they properly:1,properly refresh:1,refresh all:1,PC By:1,By accessing:1,accessing one:1,addresses every:1,every 15.08:1,µs all:1,PC’s DRAM:1,DRAM is:1,in 256:1,256 x:1,x 15.08:1,or 3.86:1,3.86 ms:1,ms which:1,desired 4:1,ms time:1,earlier Only:1,first 640K:1,640K of:1,PC video:1,video adapters:1,other adapters:1,adapters above:1,above 640K:1,640K containing:1,containing memory:1,requires refreshing:1,refreshing must:1,provide their:1,own DRAM:1,refresh in:1,in pre-AT:1,pre-AT systems:1,systems Don’t:1,Don’t sweat:1,sweat the:1,details here:1,this For:1,For at:1,4 out:1,given over:1,8088 as:1,4.5 That:1,as 5.56:1,PC’s already:1,already inadequate:1,inadequate bus:1,bus capacity:1,capacity is:1,lost However:1,However DRAM:1,refresh doesn’t:1,doesn’t necessarily:1,necessarily stop:1,tracks for:1,for 4:1,keep processing:1,while DRAM:1,is occurring:1,occurring unless:1,Consequently DRAM:1,performance anywhere:1,to 5.56:1,shortly depending:1,refresh occupies:1,occupies cycles:1,8088 would:1,be accessing:1,refresh Figure:1,refresh The:1,Refresh Let’s:1,at examples:1,examples from:1,from opposite:1,opposite ends:1,spectrum in:1,performance First:1,First consider:1,of MUL:1,4.9 Since:1,16-bit MUL:1,MUL on:1,8088 executes:1,between 118:1,118 and:1,and 133:1,133 cycles:1,long there:1,fill after:1,instruction even:1,after DRAM:1,taken its:1,its slice:1,slice of:1,time Consequently:1,Unit well-supplied:1,well-supplied with:1,times Since:1,Since Listing:1,4.9 uses:1,operands the:1,Unit should:1,refresh should:1,performance Remember:1,operate normally:1,normally during:1,during DRAM:1,refreshes so:1,to request:1,request a:1,access from:1,Unit LISTING:1,LISTING 4.9:1,4.9 LST4-9.ASM:1,LST4-9.ASM cb41-1:1,cb41-1 Measures:1,Measures the:1,repeated MUL:1,instructions cb41-2:1,cb41-2 which:1,which allow:1,be full:1,full at:1,times cb41-3:1,cb41-3 to:1,impact cb41-4:1,cb41-4 on:1,performance cb41-5:1,cb41-5 cb41-6:1,cb41-6 sub:1,sub axax:1,axax cb41-7:1,cb41-7 call:1,call ZTimerOn:1,ZTimerOn cb41-8:1,cb41-8 rept:1,rept 1000:1,1000 cb41-9:1,cb41-9 mul:1,mul ax:1,ax cb41-10:1,cb41-10 endm:1,endm cb41-11:1,cb41-11 call:1,call ZTimerOff:1,ZTimerOff Running:1,Running Listing:1,4.9 we:1,each MUL:1,MUL executes:1,in 24.72:1,24.72 µs:1,exactly 118:1,118 cycles:1,Since that’s:1,shortest time:1,which MUL:1,MUL can:1,execute we:1,refresh Listing:1,4.9 clearly:1,clearly illustrates:1,refresh only:1,only affects:1,refresh forces:1,access Now:1,4.10 Since:1,Since SHR:1,SHR executes:1,empty while:1,executes with:1,8088 prefetching:1,prefetching instruction:1,bytes non-stop:1,non-stop As:1,instruction of:1,4.10 should:1,should precisely:1,precisely reflect:1,bytes Since:1,Since 4:1,byte we’d:1,expect each:1,SHR to:1,or 1.676:1,1.676 µs:1,µs if:1,no DRAM:1,refresh In:1,fact each:1,in 1.81:1,µs indicating:1,taking 7.4:1,7.4 percent:1,That’s nearly:1,nearly 2:1,our worst-case:1,worst-case estimate:1,estimate of:1,overhead In:1,result indicates:1,is stealing:1,stealing not:1,not 4:1,4 but:1,but 5.33:1,5.33 cycles:1,cycles out:1,cycles How:1,given DRAM:1,actually hold:1,hold up:1,up CPU:1,CPU memory:1,DRAM refresh’s:1,refresh’s DMA:1,DMA request:1,request relative:1,8088’s internal:1,execution state:1,state When:1,4.10 runs:1,refresh holds:1,for either:1,either 5:1,on where:1,current SHR:1,SHR instruction:1,instruction when:1,refresh request:1,request occurs:1,occurs Now:1,that things:1,even worse:1,thought DRAM:1,can steal:1,steal as:1,of available:1,access time—6:1,time—6 out:1,72 cycles—from:1,cycles—from the:1,8088 Which:1,cases we’ve:1,we’ve examined:1,examined reflects:1,reflects reality:1,reality While:1,While either:1,happen the:1,latter case—significant:1,case—significant performance:1,reduction ranging:1,8.33 percent—is:1,percent—is far:1,occur This:1,uses fast:1,cause non-stop:1,non-stop instruction:1,fetching What:1,Do About:1,About the:1,Cycle-Eater Hmmm:1,Hmmm When:1,operands whenever:1,keep word-sized:1,cycle-eater Nothing:1,Nothing As:1,said before:1,before DRAM:1,God DRAM:1,fundamental unchanging:1,unchanging part:1,PC’s operation:1,you or:1,or I:1,If refresh:1,refresh were:1,were any:1,any less:1,less frequent:1,frequent the:1,the reliability:1,reliability of:1,be compromised:1,compromised so:1,so tinkering:1,tinkering with:1,either timer:1,or DMA:1,DMA channel:1,out Nor:1,Nor is:1,there any:1,to structure:1,structure code:1,refresh Sure:1,Sure some:1,affected less:1,less by:1,by DRAM:1,refresh than:1,others but:1,many multiplies:1,row can:1,really use:1,use I:1,be structured:1,free memory:1,access every:1,so DRAM:1,refresh wouldn’t:1,any effect:1,effect In:1,days when:1,size was:1,was measured:1,not K:1,K bytes:1,and processors:1,processors were:1,less powerful—and:1,powerful—and complex—programmers:1,complex—programmers did:1,fact use:1,use similar:1,similar tricks:1,tricks to:1,to eke:1,eke every:1,every last:1,last bit:1,code When:1,make such:1,such careful:1,code synchronization:1,synchronization a:1,any modest:1,modest performance:1,did result:1,result could:1,never justify:1,the increase:1,increase in:1,programming complexity:1,on creative:1,creative programming:1,would entail:1,entail Besides:1,Besides all:1,that effort:1,effort goes:1,waste on:1,faster 8088s:1,8088s 286s:1,286s and:1,other computers:1,with different:1,execution speeds:1,and refresh:1,refresh characteristics:1,characteristics There’s:1,it Useful:1,Useful code:1,code accesses:1,memory frequently:1,frequently and:1,at irregular:1,irregular intervals:1,intervals and:1,long haul:1,haul DRAM:1,refresh always:1,always exacts:1,exacts its:1,its price:1,price If:1,still harboring:1,harboring thoughts:1,thoughts of:1,of reducing:1,refresh consider:1,this Instructions:1,tend not:1,suffer very:1,high ratio:1,those aren’t:1,PC It:1,certainly wouldn’t:1,use slower:1,slower instructions:1,instructions just:1,overhead for:1,for it’s:1,it’s total:1,execution time—DRAM:1,time—DRAM refresh:1,refresh instruction:1,and all—that:1,all—that matters:1,important thing:1,understand about:1,about DRAM:1,generally slows:1,slows your:1,reduction can:1,considerably and:1,and unpredictably:1,unpredictably depending:1,refreshes interact:1,code’s pattern:1,accesses When:1,cycle-eater at:1,another possible:1,possible culprit:1,culprit and:1,later processors:1,processors cache:1,and pipeline:1,pipeline execution:1,execution hazards:1,hazards produce:1,produce this:1,of effect:1,well Whenever:1,get two:1,that differ:1,differ less:1,less or:1,they seemingly:1,should that’s:1,usually DRAM:1,refresh too:1,too Thanks:1,refresh variations:1,variations of:1,to 8.33:1,percent in:1,are par:1,par for:1,course Wait:1,States Wait:1,device on:1,is temporarily:1,temporarily halted:1,halted by:1,that device:1,device while:1,device gets:1,gets ready:1,write Wait:1,performance Everything:1,have discussed:1,discussed and:1,discuss even:1,even DMA:1,DMA accesses—can:1,accesses—can be:1,states Wait:1,states exist:1,exist because:1,must to:1,to coexist:1,adapter no:1,slow within:1,within reason:1,reason The:1,8088 expects:1,each bus:1,bus access—a:1,access—a memory:1,or write—in:1,write—in 4:1,but adapters:1,can’t always:1,always respond:1,respond that:1,that quickly:1,example display:1,must split:1,split access:1,video signal:1,signal based:1,often can’t:1,can’t immediately:1,immediately fulfill:1,fulfill a:1,a request:1,request by:1,write To:1,To resolve:1,resolve this:1,this conflict:1,conflict display:1,wait during:1,during bus:1,inserting one:1,4.6 The:1,CPU simply:1,simply sits:1,sits and:1,and idles:1,idles as:1,as wait:1,inserted then:1,then completes:1,completes the:1,adapter indicates:1,indicates its:1,its readiness:1,readiness by:1,longer inserting:1,inserting wait:1,same would:1,couldn’t keep:1,CPU Mind:1,all transparent:1,executing code:1,code An:1,An instruction:1,that encounters:1,encounters wait:1,states runs:1,runs exactly:1,states only:1,only slower:1,slower Wait:1,are nothing:1,than wasted:1,By understanding:1,which wait:1,occur you:1,can avoid:1,when possible:1,possible Even:1,around wait:1,states it’s:1,still to:1,your advantage:1,cause your:1,slowly First:1,about wait:1,states by:1,refresh Unlike:1,Unlike DRAM:1,states do:1,not occur:1,any regularly:1,regularly scheduled:1,scheduled basis:1,basis and:1,particular duration:1,duration Wait:1,instruction performs:1,write Both:1,inserted on:1,given bus:1,entirely controlled:1,device being:1,being accessed:1,accessed When:1,is passive:1,passive merely:1,merely accepting:1,accepting whatever:1,whatever wait:1,the accessed:1,accessed device:1,device chooses:1,chooses to:1,insert during:1,makes perfect:1,perfect sense:1,state mechanism:1,device to:1,to stretch:1,stretch out:1,out any:1,any access:1,for however:1,however much:1,adapter Figure:1,adapter As:1,don’t stop:1,8088 completely:1,completely The:1,can continue:1,continue processing:1,while wait:1,inserted so:1,EU doesn’t:1,access However:1,PC wait:1,states most:1,often occur:1,instruction accesses:1,operand so:1,Unit usually:1,usually is:1,stopped by:1,states Instruction:1,Instruction fetches:1,fetches rarely:1,rarely wait:1,wait in:1,PC because:1,because system:1,is zero-wait-state:1,zero-wait-state AT-class:1,AT-class memory:1,systems routinely:1,routinely insert:1,insert 1:1,states however:1,however As:1,out wait:1,states pose:1,PC While:1,While any:1,adapter can:1,PC only:1,adapters do:1,so to:1,is seriously:1,seriously affected:1,affected The:1,Cycle-Eater Display:1,Display adapters:1,must serve:1,serve two:1,masters and:1,that creates:1,fundamental performance:1,problem Master:1,Master 1:1,that drives:1,constantly read:1,to obtain:1,obtain the:1,information used:1,characters or:1,or dots:1,dots displayed:1,screen Since:1,redrawn between:1,between 50:1,50 and:1,and 70:1,each redraw:1,redraw of:1,require as:1,as 36000:1,36000 reads:1,memory more:1,in Super:1,modes master:1,a demanding:1,master indeed:1,indeed No:1,how demanding:1,1 gets:1,gets however:1,however its:1,needs must:1,be met—otherwise:1,met—otherwise the:1,suffer Master:1,CPU which:1,circuitry reads:1,screen Master:1,important than:1,than master:1,CPU affects:1,quality only:1,only indirectly:1,indirectly In:1,circuitry has:1,picture will:1,develop holes:1,holes snow:1,snow and:1,like but:1,will just:1,just run:1,bit slower—no:1,slower—no big:1,deal It:1,deal which:1,which master:1,master is:1,for while:1,while both:1,must gain:1,gain access:1,masters can:1,time Potential:1,Potential conflicts:1,conflicts are:1,are resolved:1,resolved by:1,by flat-out:1,flat-out guaranteeing:1,guaranteeing the:1,circuitry however:1,many accesses:1,needs with:1,CPU waiting:1,whatever display:1,left over:1,over It:1,of waiting:1,about 90:1,4.7 leaving:1,leaving as:1,8088 These:1,These percentages:1,percentages vary:1,considerably among:1,many EGA:1,clones Figure:1,access Second:1,Second because:1,displayed dots:1,dots or:1,pixels short:1,for picture:1,picture elements:1,elements must:1,constant speed:1,speed many:1,adapters provide:1,provide memory:1,accesses only:1,at fixed:1,fixed intervals:1,intervals As:1,result time:1,lost while:1,8088 synchronizes:1,synchronizes with:1,next display:1,adapter memory:1,circuitry isn’t:1,isn’t accessing:1,4.8 Finally:1,complete a:1,is related:1,which generates:1,generates pixels:1,screen rather:1,8088 Consequently:1,8088 read:1,write access:1,often longer:1,for system:1,an access:1,8088 lucks:1,lucks into:1,into hitting:1,hitting a:1,access just:1,available again:1,4.8 Any:1,three factors:1,factors I’ve:1,described can:1,in wait:1,states slowing:1,slots Figure:1,slots If:1,If some:1,worry The:1,fast compared:1,it Incredibly:1,Incredibly slow:1,slow Remember:1,slow IBM’s:1,IBM’s ill-fated:1,ill-fated PC/jr/was:1,PC/jr/was In:1,case you’ve:1,you’ve forgotten:1,forgotten I’ll:1,I’ll refresh:1,refresh your:1,your memory:1,The PC/jr/was:1,PC/jr/was at:1,best only:1,The PC/jr:1,PC/jr had:1,8088 running:1,at 4.77:1,MHz just:1,the PC—why:1,PC—why do:1,you suppose:1,suppose it:1,slower I’ll:1,you why:1,why All:1,the PCjr:1,PCjr was:1,was display:1,memory Enough:1,said All:1,memory however:1,you’re thickheaded:1,thickheaded enough:1,put code:1,as slowly:1,slowly as:1,a PC/jr:1,PC/jr Putting:1,Putting code:1,other non-video:1,non-video data:1,in unused:1,unused areas:1,memory sounds:1,neat idea—until:1,idea—until you:1,effect on:1,on instruction:1,prefetching of:1,of cutting:1,8088’s already-poor:1,already-poor memory:1,access performance:1,half Running:1,Running your:1,like running:1,a hypothetical:1,hypothetical 8084—an:1,8084—an 8086:1,8086 with:1,4-bit bus:1,bus Not:1,Not recommended:1,recommended Given:1,data reside:1,memory below:1,the 640K:1,640K mark:1,mark how:1,great an:1,an impact:1,impact does:1,cycle-eater have:1,have on:1,varies considerably:1,mode we’re:1,is worst:1,worst with:1,the Enhanced:1,Enhanced Graphics:1,Adapter EGA:1,original Video:1,Video Graphics:1,Graphics Array:1,Array VGA:1,VGA Many:1,Many VGAs:1,especially newer:1,newer ones:1,ones insert:1,insert many:1,states than:1,than IBM’s:1,original VGA:1,hand Super:1,VGAs have:1,mode While:1,the Color/Graphics:1,CGA Monochrome:1,Adapter MDA:1,MDA and:1,and Hercules:1,Card HGC:1,HGC all:1,all suffer:1,well they:1,they suffer:1,suffer to:1,lesser degree:1,degree Since:1,VGA represents:1,base standard:1,graphics now:1,hardest graphics:1,wring performance:1,from we’ll:1,we’ll restrict:1,restrict our:1,discussion to:1,relative the:1,EGA for:1,Cycle-Eater Even:1,cycle-eater depends:1,mode selected:1,In text:1,rarely a:1,major factor:1,factor It’s:1,present however:1,mere 4000:1,bytes control:1,entire text:1,mode display:1,cycle-eater it:1,that long:1,manipulate 4000:1,bytes Even:1,cycle-eater were:1,as 5µs:1,5µs per:1,memory access—more:1,access—more than:1,times normal—it:1,normal—it would:1,only 4000x:1,4000x 2x:1,2x 5µs:1,5µs or:1,40 ms:1,8088 cycles:1,the blink:1,blink of:1,and video:1,video performance:1,time After:1,drawing graphics:1,convey visual:1,visual information:1,presented faster:1,definition fast:1,enough That’s:1,can’t matter:1,I recounted:1,recounted the:1,debate among:1,among letter-writers:1,letter-writers to:1,quickly characters:1,The writers:1,writers carefully:1,carefully added:1,added up:1,up Intel’s:1,Intel’s instruction:1,many writes:1,memory they:1,could squeeze:1,squeeze into:1,interval On:1,a CGA:1,CGA it’s:1,short horizontal:1,longer vertical:1,interval that:1,mode without:1,snow Of:1,course now:1,that their:1,their cardinal:1,sin was:1,queue even:1,states their:1,their calculations:1,calculations would:1,been overly:1,overly optimistic:1,optimistic There:1,are display:1,calculations were:1,were not:1,just optimistic:1,optimistic but:1,but wildly:1,wildly optimistic:1,optimistic Text:1,Text mode:1,mode situations:1,situations such:1,notwithstanding where:1,cycle-eater really:1,really kicks:1,most especially:1,are necessarily:1,necessarily more:1,in highgraphics:1,highgraphics modes:1,that varies:1,from adapter:1,to adapter:1,mode Rather:1,memory per:1,modes than:1,in lower-resolution:1,lower-resolution graphics:1,modes so:1,more display:1,memory accesses—each:1,accesses—each incurring:1,incurring its:1,its share:1,wait states—are:1,states—are required:1,given size:1,size When:1,When accessing:1,accessing the:1,many thousands:1,cumulative effects:1,can seriously:1,seriously impact:1,impact code:1,even as:1,we assume:1,assume the:1,same 5:1,we assumed:1,assumed for:1,take 26000:1,26000 x:1,x 2:1,2 x:1,x 5:1,or 260:1,260 ms:1,scroll the:1,10H That’s:1,than one-quarter:1,a second—noticeable:1,second—noticeable by:1,by human:1,human standards:1,standards an:1,eternity by:1,by computer:1,computer standards:1,standards That:1,pretty serious:1,serious but:1,did make:1,an unfounded:1,unfounded assumption:1,assumption about:1,about memory:1,speed Let’s:1,get some:1,some hard:1,hard numbers:1,numbers Listing:1,4.11 accesses:1,8088’s maximum:1,speed by:1,MOVSW with:1,both source:1,destination The:1,4.11 executes:1,in 3.18:1,3.18 µs:1,display memory—not:1,memory—not as:1,assumed but:1,time nonetheless:1,nonetheless For:1,For comparison:1,comparison let’s:1,takes when:1,accessing normal:1,RAM instead:1,Listing 4.12:1,4.12 which:1,MOVSW from:1,segment executes:1,in 1.39:1,1.39 µs:1,access That:1,average 1.79:1,1.79 µs:1,µs more:1,than double:1,code Bear:1,a worst:1,case here:1,the percent:1,sequence spends:1,spends accessing:1,memory A:1,A line-drawing:1,executes perhaps:1,dozen instructions:1,access generally:1,generally loses:1,loses less:1,cycle-eater than:1,a block-copy:1,block-copy or:1,or scrolling:1,scrolling subroutine:1,subroutine that:1,instructions Scaled:1,Scaled and:1,and three-dimensional:1,three-dimensional graphics:1,which spend:1,time performing:1,calculations often:1,often using:1,arithmetic tend:1,less In:1,addition code:1,memory infrequently:1,infrequently tends:1,suffer only:1,maximum display:1,states because:1,average such:1,such code:1,memory halfway:1,between one:1,one available:1,access slot:1,slot and:1,less intensively:1,intensively than:1,4.11 will:1,will on:1,average lose:1,5 rather:1,than 8-plus:1,access Nonetheless:1,cycle-eater always:1,always takes:1,takes its:1,its toll:1,toll on:1,Interestingly that:1,that toll:1,toll becomes:1,becomes much:1,much higher:1,higher on:1,80386 machines:1,execute many:1,per microsecond:1,microsecond than:1,PC Remember:1,limited speed:1,adapter so:1,fastest computer:1,computer around:1,around can’t:1,one iota:1,iota faster:1,adapter will:1,allow What:1,Cycle-Eater What:1,cycle-eater Well:1,Well we:1,can minimize:1,accesses whenever:1,avoid read/modify/write:1,read/modify/write display:1,memory operations:1,mask individual:1,clip images:1,images Why:1,Because read/modify/write:1,operations require:1,require two:1,one read:1,write each:1,time display:1,is manipulated:1,manipulated Instead:1,use writes:1,such writes:1,writes don’t:1,require accompanying:1,accompanying read:1,read accesses:1,memory mask:1,mask part:1,and alter:1,rest and:1,byte back:1,memory Half:1,Half as:1,accesses means:1,means half:1,states Moreover:1,Moreover 486s:1,as recent:1,recent Super:1,VGAs employ:1,employ write-caching:1,write-caching schemes:1,make display:1,writes considerably:1,reads Along:1,cycle-eater makes:1,popular exclusive-OR:1,exclusive-OR animation:1,technique which:1,requires paired:1,paired reads:1,memory less-than-ideal:1,less-than-ideal for:1,PC Exclusive-OR:1,Exclusive-OR animation:1,animation should:1,simply writing:1,writing images:1,possible Another:1,Another principle:1,adapter programming:1,multiple accesses:1,memory very:1,rapidly in:1,make use:1,the scarce:1,scarce accesses:1,especially important:1,important when:1,many large:1,images need:1,drawn quickly:1,quickly since:1,using virtually:1,every available:1,can many:1,bytes be:1,short period:1,time Repeated:1,Repeated string:1,making maximum:1,course repeated:1,another point:1,On faster:1,processors however:1,however display:1,slow that:1,often pays:1,do several:1,instructions worth:1,work between:1,be wasted:1,wasted on:1,states It:1,cycle-eater issue:1,depth with:1,of example:1,execution timings:1,timings but:1,alas I:1,that right:1,now For:1,being all:1,8088 you:1,lose more:1,For intensive:1,intensive access:1,loss really:1,really can:1,as 8cycles:1,8cycles and:1,and up:1,50 100:1,Pentiums paired:1,with slow:1,slow VGAs:1,VGAs while:1,while for:1,for average:1,average graphics:1,loss is:1,significant There:1,discover just:1,how significant:1,significant the:1,particular graphics:1,code Cycle-Eaters:1,Cycle-Eaters A:1,A Summary:1,Summary We’ve:1,of sophisticated:1,sophisticated material:1,so don’t:1,don’t feel:1,feel bad:1,bad if:1,haven’t understood:1,understood everything:1,all become:1,clear from:1,from further:1,reading especially:1,especially once:1,you study:1,study time:1,and tune:1,tune code:1,written yourself:1,yourself What’s:1,What’s really:1,really important:1,come away:1,chapter understanding:1,cycle-eater causes:1,causes each:1,equivalent access:1,operand The:1,cause instruction:1,the officially:1,officially documented:1,cycle-eater slows:1,slows most:1,with performance:1,performance reductions:1,reductions ranging:1,percent The:1,cycle-eater typically:1,typically doubles:1,doubles and:1,than triple:1,triple the:1,standard 4-cycle:1,4-cycle access:1,with intensive:1,intensive display:1,access suffering:1,suffering most:1,most This:1,This basic:1,basic knowledge:1,about cycle-eaters:1,cycle-eaters puts:1,puts you:1,good position:1,you’re well:1,to writing:1,high-performance assembler:1,code What:1,What Does:1,Does It:1,It All:1,All Mean:1,Mean There:1,it life:1,life under:1,interface It’s:1,particularly pretty:1,pretty picture:1,picture for:1,the inhabitants:1,inhabitants of:1,that strange:1,strange realm:1,realm where:1,where hardware:1,software meet:1,meet are:1,are little-known:1,little-known cycle-eaters:1,that sap:1,sap the:1,your unsuspecting:1,unsuspecting code:1,code Still:1,Still some:1,be minimized:1,minimized by:1,keeping instructions:1,short using:1,registers using:1,using byte-sized:1,and accessing:1,possible None:1,eliminated and:1,all still:1,still aren’t:1,off knowing:1,fast your:1,really runs—and:1,runs—and why—than:1,why—than you:1,were reading:1,and guessing:1,guessing And:1,while specific:1,specific cycle-eaters:1,in importance:1,importance on:1,on later:1,later x86-family:1,some cycle-eaters:1,cycle-eaters vanishing:1,altogether and:1,ones appearing:1,appearing the:1,concept that:1,that understanding:1,understanding these:1,these obscure:1,obscure gremlins:1,gremlins is:1,performance remains:1,5 Crossing:1,the Border:1,Border Searching:1,Searching Files:1,Files with:1,with Restartable:1,Restartable Blocks:1,Blocks We:1,moved Those:1,three little:1,little words:1,should strike:1,strike terror:1,terror into:1,owns more:1,a sleeping:1,sleeping bag:1,bag and:1,a toothbrush:1,toothbrush Our:1,Our last:1,last move:1,usual zoo—and:1,zoo—and then:1,then some:1,some Because:1,old house:1,house to:1,new was:1,miles we:1,used cars:1,cars to:1,move everything:1,everything smaller:1,a washing:1,washing machine:1,machine We:1,sizable household—cats:1,household—cats dogs:1,dogs kids:1,kids com:1,com you:1,you name:1,name it—so:1,it—so the:1,moving process:1,process took:1,of car:1,car trips:1,trips A:1,A large:1,large number—33:1,number—33 to:1,exact I:1,personally spent:1,hours just:1,just driving:1,two houses:1,houses The:1,move took:1,took days:1,complete Never:1,Never again:1,again You’re:1,probably wondering:1,wondering two:1,things What:1,why on:1,earth didn’t:1,I rent:1,truck and:1,the move:1,move over:1,two trips:1,trips saving:1,saving hours:1,driving As:1,second question:1,question answers:1,first I:1,didn’t rent:1,truck because:1,seemed easier:1,use cars—no:1,cars—no big:1,big truck:1,truck to:1,drive no:1,no rentals:1,rentals spread:1,out more:1,more manageably:1,manageably and:1,wasn’t easier:1,and wasn’t:1,even much:1,much cheaper:1,cheaper It:1,It costs:1,costs quite:1,car 330:1,330 miles:1,miles to:1,time But:1,seemed as:1,though my:1,cheaper In:1,didn’t realize:1,realize just:1,had wasted:1,wasted driving:1,forth until:1,chapter In:1,I briefly:1,briefly discussed:1,discussed using:1,blocks This:1,This you:1,might remember:1,remember is:1,handling in:1,chunks data:1,sets too:1,processed just:1,did fit:1,The restartable:1,relatively difficult:1,program At:1,opposite end:1,spectrum lies:1,lies byte-by-byte:1,byte-by-byte processing:1,whereby DOS:1,less extreme:1,extreme cases:1,cases a:1,of library:1,functions is:1,time Byte-by-byte:1,Byte-by-byte processing:1,vast overhead:1,overhead that:1,from invoking:1,DOS each:1,processed Sound:1,familiar It:1,I moved:1,moved via:1,the byte-by-byte:1,forth made:1,for miserable:1,miserable performance:1,performance Renting:1,Renting a:1,truck the:1,have required:1,required more:1,more effort:1,and forethought:1,forethought but:1,have paid:1,paid off:1,handsomely The:1,easy familiar:1,familiar approach:1,often has:1,its favor:1,favor except:1,requires less:1,less thinking:1,thinking not:1,virtue when:1,high-performance code—or:1,code—or when:1,when moving:1,moving And:1,blocks Searching:1,Searching for:1,for Text:1,Text The:1,The application:1,application we’re:1,examine searches:1,specified string:1,string We’ll:1,We’ll develop:1,will search:1,file specified:1,string also:1,also specified:1,the comline:1,comline then:1,then report:1,report whether:1,string was:1,was found:1,not Because:1,is obtained:1,via argv:1,argv it:1,can’t contain:1,contain any:1,any whitespace:1,whitespace characters:1,characters This:1,limited subset:1,what search:1,search utilities:1,utilities such:1,as grep:1,grep can:1,really intended:1,purpose is:1,provide insight:1,into restartable:1,engine That:1,That search:1,will however:1,plug into:1,nothing preventing:1,preventing you:1,fruitful context:1,context like:1,like searching:1,a user-selectable:1,user-selectable file:1,file set:1,designing our:1,appropriate text-search:1,text-search approach:1,use Literally:1,Literally dozens:1,of workable:1,workable ways:1,ways exist:1,exist to:1,file We:1,can immediately:1,immediately discard:1,involve reading:1,reading any:1,file more:1,once because:1,because disk:1,is orders:1,magnitude slower:1,any data:1,data handling:1,handling performed:1,code Based:1,our experience:1,1 we:1,also discard:1,get bytes:1,bytes either:1,small sets:1,sets from:1,from DOS:1,DOS We:1,read big:1,big buffers-full:1,buffers-full of:1,pop from:1,the searched:1,searched file:1,bigger the:1,the better—in:1,better—in order:1,minimize DOS’s:1,DOS’s overhead:1,good rough:1,rough cut:1,cut is:1,be between:1,between 16K:1,16K and:1,64K depending:1,exact search:1,approach 64K:1,64K being:1,size because:1,because near:1,pointers make:1,for superior:1,performance So:1,buffer filling:1,filling it:1,possible Now:1,file by:1,that large:1,chunks To:1,To accomplish:1,searching and:1,obvious Where:1,begin Well:1,be instructive:1,would search:1,search if:1,if our:1,search involved:1,involved only:1,buffer already:1,already resident:1,resident in:1,words suppose:1,handling at:1,further suppose:1,with searching:1,blocks After:1,good description:1,the all-important:1,all-important inner:1,searching program:1,program where:1,will spend:1,spend virtually:1,time aside:1,aside from:1,the unavoidable:1,unavoidable disk:1,access overhead:1,overhead Avoiding:1,Avoiding the:1,the String:1,String Trap:1,Trap The:1,easiest approach:1,a C/C:1,function The:1,The closest:1,match to:1,is strstr:1,strstr which:1,searches one:1,one string:1,second string:1,string However:1,However while:1,while strstr:1,strstr would:1,purposes The:1,this Where:1,Where we:1,string strstr:1,strstr searches:1,another string:1,string We:1,could put:1,allow strstr:1,strstr to:1,bother The:1,The strstr:1,strstr function:1,either checking:1,string being:1,searched or:1,or determining:1,determining the:1,that string—wasted:1,string—wasted effort:1,effort given:1,long our:1,given strstr:1,strstr implementation:1,is well-written:1,well-written its:1,will suffer:1,suffer at:1,our application:1,application from:1,from unnecessary:1,unnecessary overhead:1,overhead This:1,illustrates why:1,shouldn’t think:1,of C/C:1,functions as:1,as black:1,boxes understand:1,their performance:1,context you’re:1,in Brute-Force:1,Brute-Force Techniques:1,Techniques Given:1,no C/C:1,function meets:1,our needs:1,needs precisely:1,precisely an:1,obvious alternative:1,brute-force technique:1,uses memcmp:1,memcmp to:1,compare every:1,every potential:1,potential matching:1,matching location:1,5.1 By:1,course use:1,use our:1,code working:1,comparison in:1,memcmp But:1,But memcmp:1,memcmp will:1,certainly use:1,fast REPZ:1,CMPS instruction:1,However never:1,never assume:1,assume It:1,debugger to:1,actual machine-code:1,machine-code implementation:1,memcmp from:1,compiler If:1,could always:1,always write:1,own assembly:1,memcmp Figure:1,technique Invoking:1,Invoking memcmp:1,memcmp for:1,location works:1,but entails:1,entails considerable:1,overhead Each:1,Each comparison:1,comparison requires:1,that parameters:1,parameters be:1,be pushed:1,pushed and:1,from memcmp:1,memcmp be:1,performed along:1,a pass:1,comparison loop:1,loop Surely:1,way Indeed:1,Indeed there:1,is We:1,most calls:1,to memcmp:1,memcmp by:1,simple test:1,will reject:1,reject most:1,most such:1,such locations:1,locations right:1,right off:1,bat We’ll:1,just check:1,check whether:1,matching buffer:1,location matches:1,for We:1,this check:1,check by:1,next match:1,character stopping:1,stopping to:1,string only:1,character matches:1,5.2 Using:1,Using memchr:1,memchr There’s:1,There’s yet:1,however Use:1,memchr function:1,function which:1,than find:1,next occurrence:1,specified character:1,buffer presumably:1,presumably by:1,efficient REPNZ:1,SCASB instruction:1,instruction although:1,although again:1,again it:1,it wouldn’t:1,check By:1,By using:1,using memchr:1,memchr to:1,for potential:1,matches that:1,fully tested:1,with memcmp:1,memcmp we:1,have about:1,searched and:1,for Our:1,Our engine:1,engine also:1,also relies:1,relies heavily:1,on repeated:1,instructions assuming:1,and memcmp:1,memcmp library:1,are properly:1,properly coded:1,coded Figure:1,technique We’re:1,the this:1,our file-searching:1,deciding how:1,integrate this:1,through files:1,files larger:1,This certainly:1,the fastest-possible:1,fastest-possible searching:1,which cleverly:1,cleverly eliminates:1,eliminates many:1,many buffer:1,buffer locations:1,matches in:1,checking preceding:1,preceding locations:1,quite complex:1,would distract:1,distract us:1,from our:1,our main:1,focus restartable:1,we’ll save:1,later chapter:1,14 to:1,precise Besides:1,Besides I:1,purposes Now:1,we’ve selected:1,a searching:1,searching approach:1,approach let’s:1,let’s integrate:1,integrate it:1,handling and:1,blocks In:1,words let’s:1,let’s make:1,it restartable:1,restartable Making:1,Making a:1,a Search:1,Search Restartable:1,Restartable As:1,happens there’s:1,great trick:1,to putting:1,this search:1,search program:1,program together:1,together Basically:1,we’ll read:1,data we’ll:1,with 16K:1,16K at:1,avoid signed:1,signed overflow:1,overflow problems:1,integers search:1,memchr memcmp:1,memcmp engine:1,engine described:1,and exit:1,exit with:1,string found:1,found response:1,response if:1,desired string:1,found Otherwise:1,Otherwise we’ll:1,we’ll load:1,load in:1,another buffer:1,buffer full:1,file search:1,in handling:1,handling potentially:1,matching sequences:1,sequences in:1,file that:1,start in:1,end in:1,the next—that:1,next—that is:1,is sequences:1,span buffers:1,buffers We’ll:1,We’ll handle:1,the unchecked:1,unchecked bytes:1,we fill:1,copied from:1,string minus:1,buffer can’t:1,possible matches:1,check would:1,buffer That’s:1,5.1 shows:1,the file-searching:1,program As:1,few fairly:1,fairly opaque:1,opaque lines:1,handle merging:1,merging the:1,single block—the:1,block—the function:1,function SearchForString:1,SearchForString is:1,and compact:1,it’s by:1,most heavily-executed:1,heavily-executed code:1,listing Listing:1,5.1 nicely:1,core concept:1,blocks Organize:1,Organize your:1,your processing:1,processing within:1,block as:1,were only:1,one block—which:1,block—which is:1,at top:1,top speed—and:1,speed—and make:1,your blocks:1,as large:1,large as:1,overhead associated:1,with going:1,block to:1,next Interpreting:1,Interpreting Where:1,the Cycles:1,Cycles Go:1,Go To:1,To boost:1,5.1 I:1,normally convert:1,convert SearchForString:1,SearchForString to:1,language at:1,point However:1,lesson as:1,any discussion:1,of optimized:1,be Take:1,examine some:1,performance aspects:1,become much:1,much clearer:1,clearer As:1,1 one:1,important rules:1,involves knowing:1,knowing when:1,all Another:1,Another rule:1,rule involves:1,involves understanding:1,going That’s:1,5.1 than:1,think When:1,MB assembly:1,assembly source:1,source file:1,file it:1,string xxxend:1,xxxend which:1,file on:1,machine with:1,If BLOCK_SIZE:1,BLOCK_SIZE is:1,trimmed from:1,from 16K:1,16K to:1,to 4K:1,4K execution:1,not increase:1,increase perceptibly:1,perceptibly At:1,At 2K:1,2K the:1,program slows:1,slows slightly:1,slightly it’s:1,not until:1,size shrinks:1,shrinks to:1,64 bytes:1,time becomes:1,becomes approximately:1,double that:1,the 16K:1,16K buffer:1,buffer So:1,we’ve discovered:1,discovered is:1,while bigger:1,bigger blocks:1,the increment:1,increment in:1,performance may:1,not justify:1,those larger:1,larger blocks:1,blocks Our:1,next discovery:1,discovery is:1,large chunks:1,chunks most:1,nonetheless spent:1,function When:1,I replaced:1,replaced the:1,5.1 with:1,simply fools:1,fools the:1,MB file:1,being read:1,ran almost:1,almost instantaneously—in:1,instantaneously—in less:1,1/2 second:1,second even:1,string wasn’t:1,wasn’t anywhere:1,anywhere to:1,found By:1,5.1 requires:1,requires three:1,run even:1,single character:1,found anywhere:1,to memchr:1,thus a:1,single REPNZ:1,SCASB can:1,eliminate an:1,entire block:1,block at:1,time All:1,for DOS:1,access calls:1,least 80:1,and search:1,fact search:1,is probably:1,total given:1,program running:1,running through:1,C startup:1,startup code:1,code opening:1,opening the:1,file executing:1,executing printf:1,printf and:1,and exiting:1,DOS shell:1,shell are:1,also included:1,my timings:1,timings Given:1,apparent why:1,why converting:1,language isn’t:1,the trouble—the:1,trouble—the best:1,best we:1,search is:1,so improvement:1,improvement and:1,uses repeated:1,work Not:1,Not likely:1,likely Knowing:1,When Assembly:1,Is Pointless:1,Pointless So:1,So that’s:1,why we’re:1,this example—which:1,example—which is:1,5.1 to:1,assembly If:1,typically search:1,search buffers:1,buffers in:1,string occurs:1,occurs frequently:1,text buffer:1,string starting:1,space character:1,character an:1,faster Why:1,Because assembly:1,from REPNZ:1,remaining characters:1,5.1 must:1,must return:1,from memchr:1,memchr set:1,up parameters:1,call memcmp:1,memcmp in:1,thing Likewise:1,Likewise assembly:1,assembly can:1,SCASB after:1,a non-match:1,non-match much:1,The switching:1,switching overhead:1,is high:1,high when:1,file completely:1,completely filled:1,character z:1,string zy:1,zy Listing:1,5.1 takes:1,takes almost:1,almost 1/2:1,1/2 minute:1,minute or:1,nearly an:1,magnitude longer:1,than when:1,file filled:1,with normal:1,text It:1,engine to:1,for searches:1,searches performed:1,performed entirely:1,file access:1,access eliminated:1,eliminated improvements:1,improvements in:1,in search-engine:1,search-engine performance:1,would translate:1,translate directly:1,into significantly:1,performance One:1,same structure:1,structure as:1,5.1 would:1,through expanded:1,another would:1,through huge:1,huge segment-spanning:1,segment-spanning buffers:1,buffers And:1,find as:1,we so:1,often will:1,definitely not:1,a cut-and-dried:1,cut-and-dried matter:1,matter and:1,approach You:1,typically do:1,with average:1,or worst-case:1,performance before:1,can decide:1,how best:1,program—and indeed:1,indeed whether:1,whether speeding:1,speeding it:1,up is:1,doing at:1,because very:1,block sizes:1,sizes don’t:1,much improve:1,wasn’t worth:1,5.1 Listing:1,5.1 runs:1,of 32:1,of 4K:1,4K and:1,any byte-by-byte:1,slower still:1,still due:1,repeated calls:1,C stream:1,I/O library:1,library Restartable:1,Restartable blocks:1,do minimize:1,of DOS:1,DOS file-access:1,file-access calls:1,5.1 it’s:1,reduce that:1,becomes worth:1,worth attempting:1,attempting to:1,further improve:1,our relatively:1,relatively efficient:1,engine Although:1,means fully:1,optimized it’s:1,nonetheless as:1,as there’s:1,performance among:1,the components:1,program Always:1,Always Look:1,Look Where:1,Where Execution:1,Execution Is:1,Is Going:1,Going I’ve:1,explained two:1,important lessons:1,lessons Know:1,worth optimizing:1,optimizing further:1,use restartable:1,blocks to:1,sets as:1,block handled:1,handled at:1,obvious than:1,seems When:1,fully intended:1,5.1 and:1,faster When:1,actually looked:1,at where:1,where execution:1,going which:1,did by:1,function but:1,profiler could:1,thing much:1,easily I:1,world wouldn’t:1,difference When:1,code take:1,where optimization:1,difference before:1,you invest:1,invest your:1,for restartable:1,blocks Here:1,we tackled:1,tackled a:1,a considerably:1,blocks than:1,Chapter 1—which:1,1—which turned:1,difficult after:1,all Don’t:1,let irregularities:1,irregularities in:1,programming tasks:1,tackle such:1,as strings:1,strings that:1,span blocks:1,blocks fluster:1,fluster you:1,into settling:1,easy general—and:1,general—and slow—solutions:1,slow—solutions Focus:1,Focus on:1,loop—the code:1,handles each:1,each block—as:1,block—as efficient:1,possible then:1,then structure:1,structure the:1,loop Programming:1,Programming with:1,blocks isn’t:1,isn’t easy:1,issue using:1,right places:1,places more:1,itself with:1,with greatly:1,not time-critical:1,time-critical you:1,wouldn’t dream:1,dream of:1,of wasting:1,wasting your:1,optimization Would:1,Would you:1,you Chapter:1,6 Looking:1,Looking Past:1,Past Face:1,Face Value:1,Value How:1,How Machine:1,Machine Instructions:1,Instructions May:1,May Do:1,Do More:1,More Than:1,You Think:1,Think I:1,first met:1,met Jeff:1,Duntemann at:1,an authors:1,authors dinner:1,dinner hosted:1,hosted by:1,Journal at:1,at Fall:1,Fall Comdex:1,Comdex back:1,in 1985:1,1985 Jeff:1,Jeff was:1,already reasonably:1,reasonably well-known:1,well-known as:1,computer editor:1,editor and:1,and writer:1,writer although:1,as famous:1,famous as:1,as Complete:1,Complete Turbo:1,Pascal editions:1,editions 1:1,through 672:1,672 or:1,or thereabouts:1,thereabouts TURBO:1,TURBO TECHNIX:1,TECHNIX and:1,and PC:1,TECHNIQUES would:1,would soon:1,soon make:1,make him:1,was fortunate:1,be seated:1,Jeff at:1,dinner table:1,not surprisingly:1,surprisingly our:1,our often:1,often animated:1,animated conversation:1,conversation revolved:1,revolved around:1,around computers:1,computers computer:1,computer writing:1,more computers:1,computers not:1,necessarily in:1,order Although:1,Although I:1,living at:1,at computer:1,computer work:1,and enjoying:1,enjoying it:1,I nonetheless:1,nonetheless harbored:1,harbored vague:1,vague ambitions:1,ambitions of:1,a science-fiction:1,science-fiction writer:1,writer when:1,I grew:1,grew up:1,have since:1,since realized:1,this hardly:1,hardly puts:1,puts me:1,in elite:1,elite company:1,company especially:1,computer world:1,world where:1,seems that:1,other person:1,person has:1,has told:1,me they:1,they plan:1,write science:1,fiction someday:1,someday Given:1,that probably:1,probably fewer:1,than 500—I’m:1,500—I’m guessing:1,guessing here—original:1,here—original science:1,fiction and:1,and fantasy:1,fantasy short:1,short stories:1,stories and:1,more novels:1,novels than:1,are published:1,published each:1,each year:1,this country:1,country I:1,few mid-life:1,mid-life crises:1,crises coming:1,coming At:1,rate I:1,had accumulated:1,accumulated a:1,small collection:1,of rejection:1,rejection slips:1,slips and:1,and fancied:1,fancied myself:1,myself something:1,something of:1,old hand:1,field At:1,dinner as:1,other writers:1,writers complained:1,complained half-seriously:1,half-seriously about:1,little they:1,were paid:1,paid for:1,for Tech:1,I leaned:1,leaned over:1,Jeff and:1,and whispered:1,whispered You:1,the pay:1,pay isn’t:1,isn’t so:1,so bad:1,bad here:1,they pay:1,for science:1,science fiction—even:1,fiction—even to:1,the guys:1,guys who:1,who win:1,win awards:1,awards To:1,which Jeff:1,Jeff replied:1,replied I:1,know I’ve:1,been nominated:1,nominated for:1,two Hugos:1,Hugos Oh:1,Oh Had:1,I known:1,known I:1,was seated:1,real live:1,live science-fiction:1,science-fiction writer—an:1,writer—an award-nominated:1,award-nominated writer:1,writer by:1,God I:1,have pumped:1,pumped him:1,him for:1,worth but:1,possibility had:1,a dinner:1,dinner put:1,magazine seated:1,an editor:1,editor who:1,finished a:1,book about:1,Pascal and:1,and gosh:1,gosh it:1,appropriate topic:1,topic was:1,was computers:1,computers For:1,For once:1,the moral:1,moral is:1,not don’t:1,cover Jeff:1,Jeff is:1,he appeared:1,appeared to:1,at face:1,computer writer:1,writer and:1,and editor:1,editor However:1,However he:1,more too:1,too face:1,value wasn’t:1,wasn’t full:1,value You’ll:1,You’ll similarly:1,similarly find:1,value isn’t:1,isn’t always:1,computer programming:1,especially so:1,so when:1,language where:1,where many:1,have talents:1,talents above:1,beyond their:1,their obvious:1,obvious abilities:1,abilities On:1,LOOP that:1,perform specific:1,specific functions:1,functions but:1,but aren’t:1,cover either:1,either Assembly:1,family isn’t:1,isn’t like:1,other language:1,should without:1,without hesitation:1,hesitation offer:1,offer our:1,our profuse:1,profuse thanks:1,thanks Assembly:1,language reflects:1,processor rather:1,it’s full:1,multiple instructions:1,perform similar:1,similar functions:1,functions instructions:1,with odd:1,odd and:1,often confusing:1,confusing side:1,and endless:1,endless ways:1,to string:1,string together:1,together different:1,same things:1,things often:1,often with:1,with seemingly:1,seemingly minuscule:1,minuscule differences:1,differences that:1,be surprisingly:1,surprisingly important:1,important To:1,To produce:1,must decide:1,decide precisely:1,accomplish then:1,that accomplishes:1,accomplishes that:1,end most:1,efficiently regardless:1,are usually:1,for That’s:1,why optimization:1,art and:1,it’s why:1,family will:1,always handily:1,handily outperform:1,outperform compiled:1,mind let’s:1,look past:1,past face:1,face value—and:1,value—and while:1,I’ll toss:1,toss in:1,few examples:1,not judging:1,judging a:1,cover The:1,to regard:1,regard the:1,family instructions:1,thinking they:1,do Yes:1,Yes SHL:1,SHL shifts:1,shifts a:1,pattern left—but:1,left—but a:1,table can:1,faster ADD:1,ADD can:1,indeed add:1,two operands:1,a third:1,third register:1,register LEA:1,The instruction:1,is your:1,your raw:1,raw material:1,material for:1,code By:1,By limiting:1,limiting yourself:1,thinking only:1,certain well-established:1,well-established ways:1,ways about:1,instructions you’re:1,you’re putting:1,putting yourself:1,yourself at:1,substantial disadvantage:1,disadvantage every:1,family can:1,you think—if:1,think—if you’ll:1,you’ll use:1,everything it:1,offer Give:1,Give it:1,shot Memory:1,and Arithmetic:1,Arithmetic Years:1,a clip:1,clip on:1,the David:1,David Letterman:1,Letterman show:1,show in:1,which Letterman:1,Letterman walked:1,walked into:1,store by:1,of Just:1,Just Lamps:1,Lamps and:1,asked So:1,you sell:1,sell here:1,here Lamps:1,was told:1,told Just:1,Just lamps:1,lamps Can’t:1,read Lamps:1,see And:1,And what:1,else From:1,From that:1,of sublime:1,sublime idiocy:1,idiocy we:1,learn much:1,about divining:1,divining the:1,instruction To:1,wit Quick:1,Quick what:1,x86’s memory:1,modes do:1,do Calculate:1,Calculate memory:1,addresses you:1,doubt replied:1,replied And:1,And you’re:1,you’re right:1,course But:1,else do:1,They perform:1,a distinctly:1,often useful:1,on memory:1,calculations For:1,array base:1,base address:1,in SI:1,SI You:1,this cb46-1:1,cb46-1 add:1,add bxsi:1,bxsi cb46-2:1,cb46-2 mov:1,bx Or:1,could let:1,processor do:1,arithmetic for:1,instruction cb47-1:1,cb47-1 mov:1,si The:1,interchangeable but:1,not equivalent:1,equivalent from:1,performance standpoint:1,standpoint and:1,better depends:1,a one-shot:1,one-shot memory:1,access it’s:1,processor perform:1,addition it’s:1,at doing:1,this than:1,separate ADD:1,instruction would:1,be If:1,access within:1,it’s advantageous:1,advantageous on:1,possible reducing:1,reducing effective:1,time inside:1,following Here:1,Here MOV:1,SI On:1,balance shifts:1,shifts MOV:1,SI takes:1,BX on:1,these processors:1,because effective:1,calculations generally:1,take no:1,all According:1,MASM manual:1,manual one:1,extra clock:1,required if:1,if three:1,components as:1,to confirm:1,confirm this:1,this from:1,Intel publications:1,publications but:1,haven’t looked:1,looked all:1,hard If:1,386 then:1,the processor’s:1,processor’s ability:1,arithmetic as:1,calculations without:1,without taking:1,odd case:1,instruction may:1,may slow:1,generally but:1,always better:1,486 All:1,All memory:1,however I’ll:1,discuss 486:1,performance issues:1,13 and:1,Chapters 19:1,19 through:1,through 21:1,21 Math:1,Math via:1,via Memory:1,Addressing You’re:1,particularly wowed:1,wowed to:1,addressing arithmetic:1,separate arithmetic:1,may however:1,interested to:1,also use:1,addressing and:1,of advantages:1,advantages over:1,over arithmetic:1,that How:1,How With:1,With LEA:1,LEA the:1,only instruction:1,performs memory:1,calculations but:1,actually address:1,memory LEA:1,LEA accepts:1,standard memory:1,addressing operand:1,operand but:1,than store:1,calculated memory:1,specified register:1,any general-purpose:1,6.1 which:1,of register-to-register:1,register-to-register ADD:1,ADD for:1,comparison What:1,us Two:1,ADD doesn’t:1,perform addition:1,addition with:1,three operands:1,register not:1,just in:1,source operands:1,operands Imagine:1,add BX:1,DI add:1,and store:1,in AX:1,AX The:1,compact to:1,increment AX:1,AX twice:1,twice than:1,after at:1,moment An:1,An elegant:1,elegant alternative:1,alternative solution:1,simply cb50-1:1,cb50-1 lea:1,lea ax:1,ax bx:1,bx di:1,di 2:1,2 Likewise:1,Likewise either:1,following would:1,would copy:1,copy SI:1,SI plus:1,DI or:1,or cb52-1:1,cb52-1 lea:1,lea di:1,di si:1,si 2:1,2 Mind:1,only components:1,components LEA:1,are BX:1,or BP:1,SI or:1,or DI:1,constant displacement:1,replace ADD:1,ADD most:1,time Also:1,Also LEA:1,8088 although:1,when fewer:1,used LEA:1,no slower:1,Pentium On:1,On both:1,Pentium LEA:1,be slowed:1,addressing interlocks:1,interlocks Figure:1,Addr The:1,The Wonders:1,Wonders of:1,386 LEA:1,LEA really:1,really comes:1,into its:1,own as:1,a super-ADD:1,super-ADD instruction:1,the enhanced:1,enhanced memory:1,Pentium offer:1,same modes:1,386 so:1,refer only:1,two very:1,interesting things:1,things It:1,use any:1,register EAX:1,EBX and:1,addressing base:1,addressing index:1,index by:1,eight in:1,6.2 Let’s:1,what that’s:1,for Well:1,constant or:1,constant can:1,result stored:1,standard 16-bit:1,16-bit LEA:1,LEA in:1,the role:1,role of:1,an ADD:1,ADD with:1,an independent:1,independent destination:1,Addr But:1,can LEA:1,LEA do:1,386 besides:1,besides add:1,add It:1,index LEA:1,multiply only:1,the power-of-two:1,power-of-two values:1,8 but:1,that’s useful:1,useful more:1,imagine especially:1,into tables:1,tables Besides:1,Besides multiplying:1,multiplying by:1,8 amounts:1,left shift:1,3 bits:1,now add:1,constant and:1,or multiply:1,multiply one:1,some extent—all:1,extent—all with:1,instruction For:1,example replaces:1,replaces all:1,this when:1,when pointing:1,an entry:1,doubly indexed:1,indexed table:1,table Multiplication:1,Multiplication with:1,with LEA:1,LEA Using:1,Using Non-Powers:1,Non-Powers of:1,of Two:1,Two Are:1,Are you:1,you impressed:1,impressed yet:1,386 Believe:1,feature still:1,still awaits:1,awaits us:1,us LEA:1,actually perform:1,fast multiply:1,multiply of:1,by some:1,some values:1,values other:1,than powers:1,powers of:1,two You:1,same 32-bit:1,index on:1,scaled as:1,index while:1,while being:1,base That:1,can for:1,example multiply:1,multiply EBX:1,5 with:1,with Without:1,Without LEA:1,scaling multiplication:1,of EBX:1,5 would:1,require either:1,slow MUL:1,MUL along:1,a set-up:1,set-up instruction:1,instructions along:1,case require:1,register Multiplying:1,Multiplying a:1,value by:1,a non-power-of-two:1,non-power-of-two multiplier:1,multiplier in:1,just 2:1,pretty neat:1,neat trick:1,trick even:1,full list:1,9 That:1,That list:1,list doesn’t:1,doesn’t include:1,include every:1,every multiplier:1,multiplier you:1,it covers:1,covers some:1,some commonly:1,commonly used:1,used ones:1,beat I’d:1,extend my:1,my thanks:1,to Duane:1,Strong of:1,of Metagraphics:1,Metagraphics for:1,his help:1,in brainstorming:1,brainstorming uses:1,386 version:1,486 instruction:1,timings Chapter:1,Chapter 7:1,7 Local:1,Optimization Optimizing:1,Optimizing Halfway:1,Halfway between:1,between Algorithms:1,Algorithms and:1,and Cycle:1,Counting You:1,there’s much:1,Fiasco To:1,wit The:1,The scene:1,is Buffalo:1,Buffalo New:1,York in:1,winter with:1,the snow:1,snow piled:1,piled several:1,several feet:1,feet deep:1,deep Four:1,Four college:1,students living:1,living in:1,in typical:1,typical student:1,student housing:1,housing are:1,are frozen:1,frozen to:1,the bone:1,bone The:1,floor of:1,their house:1,house uninsulated:1,uninsulated and:1,so cold:1,cold that:1,it’s uninhabitable:1,uninhabitable has:1,an ancient:1,ancient bathroom:1,bathroom One:1,One fabulously:1,fabulously cold:1,cold day:1,day inspiration:1,inspiration strikes:1,strikes Hey—we:1,Hey—we could:1,that bathroom:1,bathroom into:1,sauna Pandemonium:1,Pandemonium ensues:1,ensues Someone:1,Someone rushes:1,rushes out:1,and buys:1,buys a:1,a gas:1,at considerable:1,to life:1,life and:1,and limb:1,limb hooks:1,hooks it:1,an abandoned:1,abandoned but:1,still live:1,live gas:1,gas pipe:1,once fed:1,fed a:1,a stove:1,stove on:1,floor Someone:1,Someone else:1,else gets:1,gets sheets:1,sheets of:1,of plastic:1,plastic and:1,walls of:1,bathroom to:1,the moisture:1,moisture in:1,another student:1,student gets:1,a bucket:1,bucket full:1,rocks The:1,remaining chap:1,chap brings:1,brings up:1,some old:1,old wooden:1,wooden chairs:1,chairs and:1,sets them:1,make benches:1,benches along:1,bathroom Voila:1,Voila instant:1,instant sauna:1,sauna They:1,They crank:1,heater put:1,rocks in:1,it close:1,door take:1,take off:1,off their:1,clothes and:1,and sit:1,to steam:1,steam themselves:1,themselves Mind:1,you it’s:1,yet 50:1,50 degrees:1,degrees Fahrenheit:1,Fahrenheit in:1,this room:1,room but:1,heater is:1,is roaring:1,roaring Surely:1,Surely warmer:1,warmer times:1,times await:1,await Indeed:1,Indeed they:1,The temperature:1,temperature climbs:1,climbs to:1,to 55:1,55 degrees:1,degrees then:1,then 60:1,60 then:1,then 63:1,63 then:1,then 65:1,65 and:1,finally creeps:1,creeps up:1,to 68:1,degrees And:1,it stops:1,stops 68:1,is warm:1,an uninsulated:1,uninsulated third:1,floor in:1,in Buffalo:1,Buffalo in:1,winter Damn:1,Damn warm:1,warm It:1,however particularly:1,particularly warm:1,sauna Eventually:1,Eventually someone:1,someone acknowledges:1,acknowledges the:1,obvious and:1,allows that:1,stupid idea:1,idea after:1,everyone agrees:1,agrees and:1,they shut:1,shut off:1,the heater:1,leave each:1,each no:1,doubt offering:1,offering silent:1,silent thanks:1,thanks that:1,gotten out:1,any incidents:1,incidents requiring:1,requiring major:1,major surgery:1,surgery And:1,best idea:1,can fail:1,fail for:1,either proper:1,design or:1,or adequate:1,adequate horsepower:1,primary cause:1,cause of:1,Fiasco was:1,of horsepower:1,horsepower the:1,heater was:1,was flat-out:1,flat-out undersized:1,undersized This:1,to trying:1,write programs:1,that incorporate:1,incorporate features:1,features like:1,like bitmapped:1,searching of:1,of multisegment:1,multisegment buffers:1,buffers without:1,using high-performance:1,language Any:1,Any PC:1,PC language:1,perform just:1,think of—eventually:1,of—eventually That:1,That heater:1,would eventually:1,eventually have:1,have heated:1,heated the:1,110 degrees:1,degrees too—along:1,too—along about:1,of June:1,June or:1,The Great:1,Fiasco also:1,also suffered:1,from fundamental:1,design flaws:1,flaws A:1,powerful heater:1,would indeed:1,indeed have:1,room hotter—and:1,hotter—and might:1,have burned:1,burned the:1,the house:1,house down:1,process Likewise:1,Likewise proper:1,proper algorithm:1,algorithm selection:1,design are:1,are fundamental:1,fundamental to:1,extra horsepower:1,horsepower a:1,a superb:1,superb assembly:1,implementation gives:1,gives a:1,design Assembly:1,small but:1,but crucial:1,crucial corner:1,programming world:1,world Use:1,it sparingly:1,sparingly and:1,the framework:1,good design—but:1,design—but ignore:1,find various:1,your anatomy:1,anatomy out:1,the cold:1,cold So:1,So drawing:1,drawing fortitude:1,fortitude from:1,quest is:1,and worthy:1,worthy one:1,one let’s:1,with hidden:1,hidden talents:1,talents and:1,with well-known:1,well-known talents:1,talents that:1,be In:1,process we’ll:1,another very:1,optimization level:1,level between:1,the algorithm/design:1,algorithm/design level:1,the cycle-counting/individual:1,cycle-counting/individual instruction:1,instruction level:1,level I’ll:1,this middle:1,middle level:1,level local:1,involves focusing:1,optimizing sequences:1,to implementing:1,implementing designs:1,designs as:1,possible given:1,family instruction:1,set And:1,yes in:1,wondering the:1,above story:1,indeed true:1,true Was:1,Was I:1,I there:1,there Let:1,me put:1,were I’d:1,never admit:1,When LOOP:1,LOOP Is:1,a Bad:1,Bad Idea:1,Idea Let’s:1,examine first:1,be LOOP:1,LOOP There’s:1,no mystery:1,mystery about:1,what LOOP:1,it decrements:1,decrements CX:1,CX doesn’t:1,doesn’t decrement:1,decrement to:1,zero It’s:1,It’s so:1,so beautifully:1,beautifully suited:1,down loops:1,loops that:1,any experienced:1,experienced x86:1,x86 programmer:1,programmer instinctively:1,instinctively stuffs:1,stuffs the:1,loop count:1,in CX:1,reaches for:1,LOOP when:1,fine LOOP:1,does of:1,course work:1,as advertised—but:1,advertised—but there:1,one problem:1,problem On:1,On half:1,family LOOP:1,DEC CX:1,CX followed:1,by JNZ:1,JNZ Granted:1,Granted DEC:1,CX/JNZ isn’t:1,isn’t precisely:1,precisely equivalent:1,to LOOP:1,LOOP because:1,because DEC:1,DEC alters:1,doesn’t but:1,most situations:1,situations they’re:1,they’re comparable:1,comparable How:1,be Don’t:1,Don’t ask:1,ask Intel:1,80286 LOOP:1,CX/JNZ by:1,generally a:1,still because:1,so can:1,fetched faster:1,faster On:1,however things:1,change LOOP:1,DEC/JNZ and:1,byte on:1,even an:1,an uncached:1,uncached 386:1,386 generally:1,generally isn’t:1,isn’t significant:1,significant Remember:1,fetches four:1,pop LOOP:1,DEC/JNZ on:1,486 executes:1,so few:1,cycles mean:1,that DEC/JNZ:1,LOOP Then:1,too unlike:1,unlike LOOP:1,LOOP DEC:1,DEC doesn’t:1,that CX:1,CX be:1,the DEC/JNZ:1,DEC/JNZ solution:1,flexible on:1,just theory:1,relative performances:1,performances of:1,CX/JNZ on:1,a cached:1,LOOP really:1,slower Things:1,are stranger:1,stranger still:1,s relative:1,relative JCXZ:1,JCXZ which:1,which branches:1,CX is:1,zero JCXZ:1,JCXZ is:1,than AND:1,AND CXCX/JZ:1,CXCX/JZ on:1,80286 and:1,and equivalent:1,equivalent on:1,the 80386—but:1,80386—but is:1,486 By:1,the lures:1,lures of:1,of JCXZ:1,JCXZ and:1,The AND:1,all processors:1,processors Use:1,Use JCXZ:1,JCXZ only:1,flag isn’t:1,the status:1,CX The:1,JCXZ What:1,we learn:1,from LOOP:1,JCXZ First:1,First that:1,than several:1,together do:1,thing Second:1,Second that:1,relative merits:1,merits of:1,rules vary:1,vary to:1,large degree:1,degree across:1,family In:1,particular if:1,write 386:1,run only:1,Pentium you’d:1,well advised:1,advised to:1,rethink your:1,your use:1,esoteric members:1,set LOOP:1,LOOP JCXZ:1,JCXZ the:1,various accumulator-specific:1,accumulator-specific instructions:1,many circumstances:1,circumstances no:1,longer offer:1,advantages they:1,did on:1,8088 Sometimes:1,Sometimes they’re:1,than more:1,general instructions:1,worth going:1,use sometimes:1,sometimes as:1,LOOP they’re:1,they’re actually:1,actually slower:1,you’d do:1,them altogether:1,altogether in:1,the 386/486:1,386/486 world:1,world Reviewing:1,Reviewing the:1,TASM manuals:1,manuals or:1,or looking:1,in Intel’s:1,Intel’s literature:1,literature is:1,start published:1,published cycle:1,are closer:1,to actual:1,are reasonably:1,reasonably reliable:1,reliable indicators:1,indicators of:1,instructions Avoiding:1,Avoiding LOOPS:1,LOOPS of:1,of Any:1,Any Stripe:1,Stripe Cycle:1,Cycle counting:1,directly substituting:1,substituting instructions:1,instructions DEC:1,CX/JNZ for:1,LOOP for:1,example are:1,techniques that:1,that belong:1,belong at:1,important level:1,level but:1,it’s fairly:1,fairly mechanical:1,mechanical once:1,and relative:1,instructions fairly:1,fairly easily:1,easily What’s:1,more this:1,which compilers:1,compilers excel:1,excel What:1,What I’m:1,saying is:1,get too:1,too caught:1,in counting:1,small albeit:1,albeit important:1,optimization picture:1,your greatest:1,greatest advantage:1,advantage lies:1,lies Local:1,Optimization One:1,One level:1,programming pays:1,handsomely is:1,is selecting:1,best sequence:1,is viewing:1,80x86 instruction:1,blocks each:1,characteristics Your:1,to sequence:1,sequence those:1,they perform:1,well It:1,are intended:1,what their:1,their names:1,names are:1,do Our:1,Our discussion:1,LOOP versus:1,versus DEC/JNZ:1,optimization by:1,counting It’s:1,knowing but:1,but once:1,just routinely:1,use DEC/JNZ:1,DEC/JNZ at:1,of loops:1,in 386/486-specific:1,that Besides:1,Besides you’ll:1,save at:1,that helps:1,little it’s:1,difference Now:1,moment and:1,no preconceptions:1,preconceptions consider:1,consider what:1,set can:1,us The:1,both LOOP:1,and DEC/JNZ:1,branching which:1,slowest aspects:1,every processor:1,processor in:1,family and:1,by decrementing:1,decrementing the:1,count register:1,zero There:1,be ways:1,perform those:1,those tasks:1,tasks a:1,selecting different:1,branching can’t:1,even get:1,to decrement:1,decrement a:1,branch conditionally:1,conditionally but:1,result without:1,without decrementing:1,decrementing or:1,branching as:1,often Remember:1,the Kobiyashi:1,Kobiyashi Maru:1,Maru problem:1,in Star:1,Trek The:1,principle applies:1,applies here:1,here Redefine:1,Redefine the:1,problem to:1,offers better:1,better solutions:1,solutions Consider:1,Consider Listing:1,buffer until:1,specified byte:1,specified number:1,been checked:1,checked Such:1,function would:1,for scanning:1,scanning up:1,a zero-terminated:1,zero-terminated buffer:1,buffer Listing:1,loop performs:1,sample string:1,period in:1,in 170:1,170 µs:1,386 When:1,7.1 is:1,CX/JNZ performance:1,improves to:1,to 168:1,168 µs:1,µs less:1,than 2:1,7.1 Actually:1,Actually instruction:1,instruction alignment:1,alignment cache:1,cache characteristics:1,characteristics or:1,or something:1,similar is:1,is affecting:1,affecting these:1,results I’d:1,I’d expect:1,larger improvement—around:1,improvement—around 7:1,7 percent—but:1,percent—but that’s:1,most that:1,that counting:1,cycles could:1,us in:1,case All:1,All right:1,right already:1,already LOOPNZ:1,LOOPNZ could:1,surely possible:1,won’t add:1,benefits we’re:1,from local:1,point Unrolling:1,Unrolling Loops:1,Loops Listing:1,7.2 takes:1,tack unrolling:1,are checked:1,each LOOP:1,LOOP performed:1,used inside:1,listing but:1,7.2 is:1,is arranged:1,that three-quarters:1,eliminated Listings:1,Listings 7.1:1,7.1 and:1,and 7.2:1,7.2 perform:1,the loop—the:1,loop—the searching:1,algorithm hasn’t:1,hasn’t changed:1,any way—but:1,way—but we:1,have sequenced:1,sequenced the:1,instructions differently:1,7.2 and:1,makes all:1,difference How:1,7.2 runs:1,in 121:1,121 µs—40:1,µs—40 percent:1,7.1 even:1,7.2 still:1,still uses:1,LOOP rather:1,CX/JNZ The:1,7.2 could:1,unrolled further:1,further too:1,too it’s:1,a question:1,to trade:1,trade for:1,for ever-decreasing:1,ever-decreasing performance:1,That’s typical:1,typical of:1,won’t often:1,often yield:1,yield the:1,the order-of-magnitude:1,order-of-magnitude improvements:1,improvements that:1,produce but:1,critical 50:1,when you’ve:1,you’ve exhausted:1,exhausted all:1,other avenues:1,avenues The:1,can gain:1,gain far:1,by stepping:1,and thinking:1,fastest overall:1,overall way:1,way for:1,or there:1,there using:1,instructions Try:1,think at:1,of sequences:1,treat x86:1,characteristics rather:1,as instructions:1,instructions dedicated:1,to specific:1,tasks Rotating:1,Rotating and:1,and Shifting:1,Shifting with:1,with Tables:1,Tables As:1,optimization consider:1,rotating or:1,or shifting:1,mask into:1,position First:1,bit N:1,N of:1,place N:1,in CL:1,CL rotate:1,with AX:1,This solution:1,is obvious:1,special ability:1,family to:1,rotate by:1,variable number:1,CL However:1,about 45:1,45 cycles:1,8088 It’s:1,actually far:1,far faster:1,precalculate the:1,results pass:1,bit number:1,the shifted:1,shifted bit:1,bit up:1,Listing 7.3:1,7.3 Even:1,it accesses:1,memory this:1,approach takes:1,20 cycles—more:1,cycles—more than:1,variable shift:1,shift Once:1,performance considerably—not:1,considerably—not by:1,by knowing:1,fastest sequence:1,particular example:1,above we:1,we once:1,again run:1,optimizing across:1,family The:1,lookup is:1,286 but:1,it’s slightly:1,However 386/486-specific:1,use enhanced:1,enhanced addressing:1,whole job:1,instruction along:1,code snippet:1,snippet in:1,Listing 7.4:1,7.4 Besides:1,Besides illustrating:1,optimization this:1,example also:1,generally pays:1,precalculate results:1,results this:1,often done:1,at or:1,or before:1,before assembly:1,assembly time:1,but precalculated:1,precalculated tables:1,at run:1,run time:1,merely one:1,fundamental optimization:1,rule Move:1,Move as:1,much work:1,your critical:1,by whatever:1,whatever means:1,means necessary:1,necessary NOT:1,NOT Flips:1,Flips Bits—Not:1,Bits—Not Flags:1,Flags The:1,The NOT:1,NOT instruction:1,instruction flips:1,flips all:1,the operand:1,That’s as:1,but NOT:1,NOT nonetheless:1,nonetheless has:1,but interesting:1,interesting talent:1,talent It:1,flags That:1,That can:1,be irritating:1,irritating I:1,I once:1,once spent:1,good hour:1,hour tracking:1,tracking down:1,bug caused:1,my unconscious:1,unconscious assumption:1,that NOT:1,NOT does:1,does set:1,flags After:1,all every:1,other arithmetic:1,instruction sets:1,flags why:1,not NOT:1,NOT Probably:1,Probably because:1,because NOT:1,NOT isn’t:1,isn’t considered:1,arithmetic or:1,or logical:1,all rather:1,data manipulation:1,instruction like:1,like MOV:1,various rotates:1,rotates These:1,are RCR:1,RCR RCL:1,RCL ROR:1,which affect:1,affect only:1,and Overflow:1,Overflow flags:1,flags NOT:1,NOT is:1,for tasks:1,as flipping:1,flipping masks:1,masks where:1,context it:1,flags unmodified:1,unmodified for:1,later testing:1,testing Besides:1,Besides if:1,to NOT:1,NOT an:1,flags in:1,process you:1,just XOR:1,XOR it:1,1 Put:1,only functional:1,functional difference:1,between NOT:1,NOT AX:1,XOR AX0FFFFH:1,AX0FFFFH is:1,XOR modifies:1,and NOT:1,NOT doesn’t:1,doesn’t The:1,set offers:1,offers many:1,accomplish almost:1,task Understanding:1,the subtle:1,subtle distinctions:1,the instructions—whether:1,instructions—whether and:1,which flags:1,flags are:1,for example—can:1,example—can be:1,be critical:1,critical when:1,optimize a:1,sequence and:1,you’re running:1,running out:1,minimize branching:1,branching Incrementing:1,Incrementing with:1,without Carry:1,Carry Another:1,Another case:1,two slightly:1,task involves:1,involves adding:1,adding 1:1,operand You:1,this with:1,with INC:1,INC as:1,AX or:1,with ADD:1,ADD as:1,in ADD:1,ADD AX1:1,AX1 What’s:1,obvious difference:1,INC is:1,two shorter:1,shorter the:1,exception being:1,being ADD:1,ADD AL1:1,AL1 which:1,which at:1,bytes is:1,length as:1,as INC:1,INC AL:1,AL and:1,processors Less:1,Less obvious:1,no less:1,ADD sets:1,flag while:1,INC leaves:1,flag untouched:1,untouched Why:1,important Because:1,Because it:1,allows INC:1,to function:1,data pointer:1,pointer manipulation:1,for multi-word:1,multi-word arithmetic:1,arithmetic You:1,that shown:1,Listing 7.5:1,7.5 without:1,any work:1,Carry status:1,If ADD:1,ADD were:1,flag would:1,saved between:1,between additions:1,additions with:1,lines shown:1,7.6 It’s:1,the Listing:1,is necessarily:1,necessarily better:1,worse that:1,that depends:1,the situation:1,situation The:1,The Listing:1,differences you’ll:1,write DEC:1,DEC has:1,same property:1,of preserving:1,flag by:1,way There:1,example First:1,First note:1,that LOOP:1,affect any:1,flags at:1,remain unchanged:1,unchanged from:1,next Not:1,Not altering:1,flags is:1,common characteristic:1,to arithmetic:1,logical instructions:1,like SUB:1,SUB and:1,AND which:1,do alter:1,flags The:1,calculation rather:1,rather the:1,you execute:1,arithmetic logical:1,logical or:1,or flag:1,flag control:1,control such:1,as CLC:1,CLC to:1,flag instruction:1,instruction Not:1,do LOOP:1,JCXZ not:1,not alter:1,but REP:1,MOVS which:1,down CX:1,0 doesn’t:1,flags either:1,either The:1,of LAHF:1,SAHF which:1,which transfer:1,transfer the:1,from AH:1,AH respectively:1,respectively These:1,instructions were:1,created to:1,help provide:1,provide compatibility:1,the 8080’s:1,8080’s that’s:1,that’s 8080:1,8080 not:1,not 8088:1,8088 PUSH:1,PUSH PSW:1,PSW and:1,POP PSW:1,PSW instructions:1,but turn:1,be compact:1,compact one:1,byte instructions:1,flags A:1,caution however:1,however SAHF:1,SAHF restores:1,Carry Zero:1,Zero Sign:1,Sign Auxiliary:1,Auxiliary Carry:1,and Parity:1,Parity flags—but:1,flags—but not:1,Overflow flag:1,which resides:1,register Also:1,that LAHF:1,SAHF provide:1,flags on:1,slow instructions:1,Pentium There:1,clear liability:1,liability that:1,flag For:1,instance does:1,not increment:1,in DXAX:1,DXAX To:1,following As:1,always pay:1,pay attention:1,attention Chapter:1,Chapter 8:1,8 Speeding:1,Up C:1,with Assembly:1,Language Jumping:1,Jumping Languages:1,Languages When:1,When You:1,Know It’ll:1,It’ll Help:1,Help When:1,a senior:1,senior in:1,school a:1,pop song:1,song called:1,called Seasons:1,Sun sung:1,sung by:1,one Terry:1,Jacks soared:1,soared up:1,pop charts:1,charts and:1,spent as:1,recall two:1,two straight:1,straight weeks:1,weeks atop:1,atop Kasey:1,Kasey Kasem’s:1,Kasem’s American:1,American Top:1,Top 40:1,40 Seasons:1,Sun wasn’t:1,good song:1,song primarily:1,primarily because:1,the lyrics:1,were silly:1,silly I’ve:1,never understood:1,understood why:1,song was:1,a hit:1,hit but:1,as so:1,happens with:1,with undistinguished:1,undistinguished but:1,but popular:1,popular music:1,music by:1,by forgotten:1,forgotten one:1,or two-shot:1,two-shot groups:1,groups Don’t:1,Don’t Pull:1,Pull Your:1,Your Love:1,Love Out:1,Out on:1,Baby Billy:1,a Hero:1,Hero et:1,et al:1,al I:1,it everywhere:1,everywhere for:1,a month:1,then gave:1,thought for:1,years Recently:1,Recently though:1,a review:1,review of:1,a Rhino:1,Rhino Records:1,Records collection:1,of obscure:1,obscure 1970s:1,1970s pop:1,pop hits:1,hits Knowing:1,Knowing that:1,that Jeff:1,Duntemann is:1,an aficionado:1,aficionado of:1,such esoterica:1,esoterica who:1,who do:1,owns an:1,an album:1,album by:1,The Peppermint:1,Peppermint Trolley:1,Trolley Company:1,Company I:1,sent the:1,the review:1,review to:1,him He:1,was amused:1,amused by:1,by it:1,kicked the:1,old songs:1,songs around:1,around Seasons:1,Sun came:1,I expressed:1,expressed my:1,my wonderment:1,wonderment that:1,a song:1,song that:1,really wasn’t:1,wasn’t very:1,good was:1,was such:1,hit Well:1,Well said:1,said Jeff:1,Jeff I:1,it suffered:1,suffered in:1,the French:1,French Ah-ha:1,Ah-ha Mystery:1,Mystery solved:1,solved Apparently:1,Apparently everyone:1,everyone but:1,but me:1,me knew:1,was translated:1,translated from:1,from French:1,French and:1,that novelty:1,novelty undoubtedly:1,undoubtedly made:1,song a:1,translation was:1,also surely:1,surely responsible:1,the sappy:1,sappy lyrics:1,lyrics dollars:1,dollars to:1,to donuts:1,donuts that:1,original French:1,French lyrics:1,were stronger:1,stronger Which:1,us without:1,without missing:1,missing a:1,a beat:1,beat to:1,chapter’s theme:1,theme speeding:1,up C:1,language When:1,you seek:1,seek to:1,converting selected:1,selected parts:1,generally no:1,few functions:1,language make:1,you end:1,not fine-tuned:1,fine-tuned C:1,code Compilers:1,Compilers like:1,like Microsoft:1,and Watcom:1,Watcom C:1,by now:1,now pretty:1,at fine-tuning:1,fine-tuning C:1,not likely:1,better by:1,the compiler’s:1,compiler’s assembly:1,output and:1,and tweaking:1,it To:1,of translating:1,translating C:1,language worth:1,trouble you:1,must ignore:1,ignore what:1,language perspective:1,perspective With:1,a merely:1,merely adequate:1,adequate translation:1,translation you:1,risk laboring:1,laboring mightily:1,mightily for:1,for little:1,no reward:1,reward Apropos:1,Apropos of:1,which when:1,when was:1,you heard:1,of Terry:1,Jacks Billy:1,a Compiler:1,Compiler The:1,optimizing C:1,as always:1,always writing:1,added twist:1,twist Rule:1,when converting:1,converting C:1,this Don’t:1,think like:1,compiler That’s:1,easily said:1,done especially:1,you’re converting:1,converting is:1,well Nevertheless:1,Nevertheless the:1,not thinking:1,essential and:1,form or:1,below Before:1,discuss Rule:1,1 further:1,further let:1,me mention:1,mention rule:1,rule number:1,0 Only:1,code beyond:1,that small:1,portion doesn’t:1,any perceptible:1,perceptible impact:1,performance Unless:1,you’re supremely:1,supremely concerned:1,size an:1,which assembly-only:1,assembly-only programs:1,programs can:1,can excel:1,excel I’d:1,write most:1,reserve assembly:1,truly critical:1,the formula:1,formula that:1,I find:1,find gives:1,most bang:1,bang for:1,the buck:1,buck This:1,that complete:1,programs shouldn’t:1,designed with:1,with optimized:1,mind As:1,shortly orienting:1,orienting your:1,structures towards:1,towards assembly:1,a salubrious:1,salubrious endeavor:1,endeavor indeed:1,indeed even:1,C When:1,actually optimizing:1,code and/or:1,and/or converting:1,converting it:1,matters Get:1,Get a:1,a profiler—and:1,profiler—and use:1,it Also:1,Also make:1,on refining:1,refining your:1,and algorithmic:1,algorithmic approach:1,approach at:1,the conceptual:1,conceptual and/or:1,and/or C:1,C levels:1,levels before:1,doing any:1,optimization Assembly:1,only step:1,optimization chain:1,chain and:1,such should:1,performed last:1,last converting:1,assembly too:1,too soon:1,soon can:1,can lock:1,lock in:1,code before:1,is optimal:1,optimal At:1,least conversion:1,make future:1,future changes:1,and debugging:1,debugging more:1,difficult slowing:1,slowing you:1,and limiting:1,limiting your:1,your options:1,options Don’t:1,Don’t Call:1,Call Your:1,Your Functions:1,Functions on:1,Baby In:1,think differently:1,compiler you:1,understand both:1,both what:1,what compilers:1,compilers and:1,that differs:1,language does:1,code your:1,generates either:1,compiler generate:1,output file:1,latter is:1,with Fa:1,Fa or:1,or Fc:1,Fc in:1,in Microsoft:1,S in:1,to modularize:1,modularize their:1,calls That’s:1,for readable:1,readable reliable:1,reliable reusable:1,optimize better:1,can deal:1,fewer variables:1,and statements:1,statements in:1,each optimization:1,optimization arena—but:1,arena—but it’s:1,good when:1,level Calls:1,Calls and:1,returns are:1,are slow:1,the pushes:1,pushes required:1,put parameters:1,parameters on:1,stack are:1,What this:1,should identify:1,entire critical:1,portion and:1,move all:1,that critical:1,portion into:1,function You:1,loop into:1,C every:1,return overhead:1,overhead would:1,unacceptable Carve:1,Carve out:1,code en:1,en masse:1,masse and:1,avoid calls:1,returns even:1,code True:1,True in:1,pass parameters:1,parameters in:1,returns themselves:1,still slow:1,slow if:1,cycles they:1,take don’t:1,performance then:1,in probably:1,probably isn’t:1,critical and:1,perhaps you’ve:1,you’ve chosen:1,convert too:1,assembly eh:1,eh Stack:1,Stack Frames:1,Frames Slow:1,Slow So:1,So Much:1,Much C:1,compilers work:1,frame model:1,model whereby:1,whereby variables:1,variables reside:1,of stack:1,stack memory:1,accessed via:1,via offsets:1,offsets from:1,BP Compilers:1,Compilers may:1,may store:1,of variables:1,may briefly:1,briefly keep:1,keep other:1,other variables:1,used repeatedly:1,repeatedly but:1,underlying architecture:1,nice architecture:1,architecture it’s:1,it’s flexible:1,flexible convenient:1,convenient easy:1,compact code:1,However stack:1,frames have:1,drawbacks They:1,They must:1,constructed and:1,and destroyed:1,destroyed which:1,takes both:1,both time:1,code They:1,they tend:1,to bias:1,programmer in:1,variables more:1,than might:1,necessary Finally:1,Finally you:1,register if:1,having that:1,that seventh:1,seventh register:1,register available:1,available is:1,useful indeed:1,indeed That:1,use stack:1,often necessary:1,necessary Just:1,Just don’t:1,their undeniable:1,undeniable charms:1,charms Torn:1,Torn Between:1,Between Two:1,Two Segments:1,Segments C:1,terrific at:1,at handling:1,handling segments:1,segments Some:1,Some compilers:1,can efficiently:1,efficiently handle:1,single far:1,pointer used:1,leaving ES:1,ES set:1,But two:1,two far:1,pointers used:1,same loop:1,loop confuse:1,confuse every:1,every compiler:1,seen causing:1,full segmentoffset:1,segmentoffset address:1,be reloaded:1,reloaded each:1,either pointer:1,This particularly:1,particularly affects:1,affects performance:1,286 protected:1,under OS/2:1,OS/2 1.X:1,1.X or:1,the Rational:1,Rational DOS:1,DOS Extender:1,Extender for:1,example because:1,because segment:1,segment loads:1,loads in:1,mode take:1,versus a:1,mere 2:1,language you:1,over segments:1,segments Use:1,necessary reorganize:1,reorganize your:1,minimize segment:1,segment loading:1,loading Why:1,Why Speeding:1,Up Is:1,Is Hard:1,Hard to:1,advantage assembly:1,language has:1,has over:1,over C:1,all forms:1,all ways:1,ways whereas:1,whereas C:1,compilers tend:1,ways Yes:1,compilers typically:1,typically don’t:1,generate instructions:1,XLAT rotates:1,rotates or:1,hand XLAT:1,XLAT and:1,limited set:1,and string:1,functions In:1,fact C:1,be carefully:1,optimized by:1,by experts:1,experts and:1,equivalent code:1,code you’d:1,you’d produce:1,produce yourself:1,yourself Am:1,Am I:1,I saying:1,compilers produce:1,produce better:1,do No:1,No I’m:1,can unless:1,language properly:1,properly Writing:1,language rather:1,C guarantees:1,guarantees nothing:1,nothing You:1,can write:1,assembly bad:1,assembly that:1,virtually indistinguishable:1,from compiled:1,likely than:1,latter if:1,of tweaking:1,tweaking compiled:1,code Sure:1,can probably:1,probably use:1,registers more:1,efficiently and:1,two that:1,compiler missed:1,missed but:1,way True:1,True optimization:1,requires rethinking:1,rethinking your:1,language A:1,A C:1,integer array:1,for matches:1,matches might:1,might compile:1,compile Figure:1,loop Figure:1,Figure 8.1A:1,8.1A You:1,tweak it:1,Figure 8.1B:1,8.1B Congratulations:1,Congratulations You’ve:1,You’ve successfully:1,successfully eliminated:1,access you’ve:1,used LOOP:1,LOOP although:1,although DEC:1,DEC SI/JNZ:1,SI/JNZ is:1,later machines:1,machines as:1,I explained:1,and you’ve:1,instruction Unfortunately:1,run very:1,faster Maybe:1,Maybe 25:1,faster maybe:1,more Big:1,Big deal:1,deal You’ve:1,You’ve eliminated:1,the trappings:1,trappings of:1,the compiler—the:1,compiler—the stack:1,restricted register:1,register usage—but:1,usage—but you’re:1,still thinking:1,compiler Try:1,Try this:1,this cb68-1:1,cb68-1 repnz:1,repnz scasw:1,scasw cb68-2:1,cb68-2 jz:1,jz Match:1,Match It’s:1,simple example—but:1,example—but I:1,hope a:1,a convincing:1,convincing one:1,one Stretch:1,Stretch your:1,brain when:1,optimize Taking:1,Taking It:1,It to:1,the Limit:1,Limit The:1,ultimate in:1,optimization comes:1,comes when:1,you reorganize:1,better assembly:1,small section:1,most affects:1,affects overall:1,searched in:1,each structure:1,structure in:1,containing other:1,other information:1,information as:1,situation REP:1,SCASW couldn’t:1,through wouldn’t:1,contiguous However:1,in searching:1,searching the:1,is urgent:1,urgent enough:1,can’t reorganize:1,data This:1,This might:1,might mean:1,mean removing:1,removing the:1,the structures:1,structures and:1,storing them:1,own array:1,array so:1,that REP:1,SCASW could:1,used Organizing:1,Organizing a:1,program’s data:1,sections can:1,of design:1,easily shortchanged:1,shortchanged unless:1,unless during:1,design stage:1,stage you:1,bring together:1,together your:1,data needs:1,potential assembly:1,optimizations More:1,this shortly:1,shortly To:1,To recap:1,recap here:1,when striving:1,striving to:1,convert C:1,into optimized:1,language Move:1,entire performance-critical:1,performance-critical section:1,section into:1,single assembly:1,function Don’t:1,use calls:1,calls or:1,or stack:1,frame accesses:1,accesses inside:1,avoid unnecessary:1,unnecessary memory:1,any kind:1,kind Change:1,Change segments:1,segments as:1,possible Optimize:1,Optimize in:1,assembly does:1,well not:1,fine-tuning compiled:1,code Change:1,Change the:1,assembly if:1,example reorganize:1,reorganize data:1,data structto:1,structto allow:1,allow efficient:1,efficient assembly:1,language processing:1,processing That:1,said let:1,show some:1,these precepts:1,precepts in:1,action A:1,A C-to-Assembly:1,C-to-Assembly Case:1,Case Study:1,Study Listing:1,sample C:1,C application:1,application I’m:1,examine optimization:1,8.1 isn’t:1,really complete—it:1,complete—it doesn’t:1,the no-matches:1,no-matches case:1,case well:1,matches will:1,an int:1,int but:1,fine as:1,optimization example:1,main body:1,body of:1,8.1 constructs:1,constructs a:1,stores an:1,structures across:1,across those:1,8.2 The:1,function FindIDAverage:1,FindIDAverage in:1,8.1 searches:1,that array:1,matches to:1,specified ID:1,ID number:1,average value:1,such matches:1,matches FindIDAverage:1,FindIDAverage contains:1,two nested:1,nested loops:1,outer one:1,each linked:1,linked block:1,inner one:1,each array:1,array element:1,element in:1,block The:1,loop—the critical:1,critical one—is:1,one—is compact:1,compact containing:1,four statements:1,should lend:1,itself rather:1,rather well:1,optimization Figure:1,happens Microsoft:1,C/C does:1,does optimize:1,FindIDAverage nicely:1,nicely Listing:1,Listing 8.2:1,8.2 shows:1,code Microsoft:1,C/C generates:1,loop consisting:1,mere seven:1,seven assembly:1,instructions inside:1,loop The:1,is smart:1,loop index:1,index variable:1,variable which:1,counts up:1,but counting:1,counting loops:1,loops into:1,a count-down:1,count-down variable:1,used It’s:1,squeeze much:1,8.3 a:1,a fine-tuned:1,fine-tuned assembly:1,FindIDAverage that:1,was produced:1,assembly output:1,of MS:1,MS C/C:1,and tightening:1,tightening it:1,8.3 eliminates:1,eliminates all:1,that’s about:1,the tightening:1,tightening there:1,result as:1,Table 8.1:1,8.3 runs:1,modest 11:1,11 percent:1,8.1 on:1,results could:1,could vary:1,set searched:1,through average:1,average block:1,and frequency:1,of matches:1,matches But:1,then understanding:1,typical and:1,case conditions:1,conditions is:1,8.4 tosses:1,tosses some:1,some sophisticated:1,sophisticated optimization:1,techniques into:1,mix The:1,unrolled eight:1,times eliminating:1,branching and:1,and SCASW:1,of CMP:1,AX Note:1,that SCASW:1,fact slower:1,AX on:1,sometimes faster:1,8088 only:1,it’s shorter:1,therefore may:1,may prefetch:1,prefetch faster:1,faster This:1,This advanced:1,advanced tweaking:1,tweaking produces:1,a 39:1,39 percent:1,C code—substantial:1,code—substantial but:1,tremendous return:1,optimization effort:1,effort invested:1,invested Listings:1,Listings 8.5:1,8.5 and:1,and 8.6:1,8.6 together:1,together go:1,go the:1,Listing 8.5:1,8.5 creates:1,creates the:1,same list:1,linked blocks:1,8.1 However:1,However instead:1,storing an:1,block it:1,stores two:1,two arrays:1,arrays in:1,block one:1,one consisting:1,of ID:1,ID numbers:1,other consisting:1,corresponding values:1,Figure 8.3:1,8.3 No:1,No information:1,lost the:1,merely rearranged:1,rearranged The:1,this rearrangement:1,rearrangement is:1,SCASW to:1,what FindIDAverage2:1,FindIDAverage2 in:1,8.6 does:1,result Listing:1,8.6 calculates:1,8.4 heavily:1,optimized as:1,latter code:1,trust you:1,picture The:1,The sort:1,us love:1,love to:1,a kind:1,of puzzle:1,but compilers:1,it nearly:1,future will:1,surely do:1,better What:1,is tie:1,specification on:1,processor on:1,end resulting:1,runs just:1,hardware permits:1,permits The:1,only software:1,is located:1,located north:1,north of:1,your sternum:1,sternum and:1,slightly aft:1,aft of:1,nose Dust:1,Dust it:1,to work—and:1,work—and your:1,never again:1,be confused:1,confused with:1,with anything:1,by Hamilton:1,Hamilton Joe:1,Joe Frank:1,Frank eynolds:1,eynolds or:1,or Bo:1,Bo Donaldson:1,Donaldson and:1,the Heywoods:1,Heywoods Chapter:1,9 Hints:1,Hints My:1,My Readers:1,Readers Gave:1,Gave Me:1,Me Optimization:1,Optimization Odds:1,Ends from:1,the Field:1,Field Back:1,school I:1,a pre-calculus:1,pre-calculus class:1,class from:1,from Mr:1,Bourgeis whose:1,whose most:1,most notable:1,notable characteristics:1,characteristics were:1,were incessant:1,incessant pacing:1,pacing and:1,truly enormous:1,enormous feet:1,feet My:1,friend Barry:1,who sat:1,sat in:1,back row:1,row right:1,right behind:1,me claimed:1,his large:1,large feet:1,feet that:1,that Mr:1,Bourgeis was:1,so restless:1,restless Those:1,Those feet:1,feet were:1,so heavy:1,heavy Barry:1,Barry hypothesized:1,hypothesized that:1,if Mr:1,Bourgeis remained:1,remained in:1,for too:1,floor would:1,give way:1,way under:1,the strain:1,strain plunging:1,plunging the:1,the unfortunate:1,unfortunate teacher:1,teacher deep:1,deep into:1,the mantle:1,mantle of:1,possibly all:1,to China:1,China Many:1,Many amusing:1,amusing cartoons:1,cartoons were:1,effect Unfortunately:1,Unfortunately Barry:1,too busy:1,busy drawing:1,drawing cartoons:1,cartoons or:1,or alternatively:1,alternatively sleeping:1,sleeping to:1,actually learn:1,learn any:1,math In:1,didn’t turn:1,a handicap:1,handicap for:1,for Barry:1,who went:1,become vice-president:1,vice-president of:1,of sales:1,sales for:1,a ham-packing:1,ham-packing company:1,company where:1,where presumably:1,presumably he:1,was rarely:1,rarely called:1,the quadratic:1,quadratic equation:1,equation Barry’s:1,Barry’s lack:1,of scholarship:1,scholarship caused:1,caused some:1,some problems:1,problems back:1,then though:1,On one:1,one memorable:1,memorable occasion:1,occasion Barry:1,was half-asleep:1,half-asleep with:1,eyes open:1,open but:1,but unfocused:1,unfocused and:1,his chin:1,chin balanced:1,balanced on:1,his hand:1,classic if:1,I fall:1,asleep my:1,head will:1,fall off:1,off my:1,my hand:1,I’ll wake:1,wake up:1,up posture:1,posture when:1,when Mr:1,Bourgeis popped:1,popped a:1,killer problem:1,problem Barry:1,Barry solve:1,X please:1,please On:1,the blackboard:1,blackboard lay:1,lay the:1,equation X:1,X 1:1,0 Minus:1,Minus 1:1,1 Barry:1,Barry said:1,said promptly:1,promptly Mr:1,head mournfully:1,mournfully Try:1,Try again:1,again Barry:1,Barry thought:1,thought hard:1,hard He:1,He knew:1,knew the:1,most mathematical:1,mathematical questions:1,questions is:1,1 infinity:1,infinity 1:1,or minus:1,minus infinity:1,infinity do:1,rule to:1,to balancing:1,checkbook however:1,however unfortunately:1,that gave:1,gave him:1,him only:1,percent chance:1,of guessing:1,guessing right:1,right One:1,whispered surreptitiously:1,surreptitiously Zero:1,Zero Barry:1,Barry announced:1,announced Mr:1,head even:1,more sadly:1,sadly One:1,whispered louder:1,looked still:1,more thoughtful—a:1,thoughtful—a bad:1,bad sign—so:1,sign—so I:1,whispered one:1,one again:1,again even:1,even louder:1,looked so:1,so thoughtful:1,thoughtful that:1,that his:1,eyes nearly:1,nearly rolled:1,rolled up:1,doing his:1,convince Mr:1,Bourgeis that:1,that Barry:1,Barry had:1,had solved:1,by himself:1,himself As:1,As Barry:1,Barry neared:1,neared the:1,the climax:1,climax of:1,his stirring:1,stirring performance:1,and opened:1,opened his:1,his mouth:1,mouth to:1,speak Mr:1,Bourgeis looked:1,at him:1,with great:1,concern Barry:1,Barry can:1,hear me:1,me all:1,right Yes:1,Yes sir:1,sir Barry:1,Barry replied:1,replied Why:1,answer all:1,up here:1,here Surely:1,Surely you:1,hear it:1,row away:1,away The:1,The class:1,class went:1,wild They:1,They might:1,sent us:1,us home:1,home early:1,early for:1,we accomplished:1,accomplished the:1,programming than:1,than Barry:1,Barry knew:1,about math:1,math Nonetheless:1,Nonetheless I:1,I always:1,always welcome:1,welcome good:1,good ideas:1,and comments:1,many readers:1,readers have:1,those over:1,think I’ll:1,return the:1,the favor:1,favor by:1,by devoting:1,devoting a:1,to reader:1,reader feedback:1,feedback Another:1,Another Look:1,at LEA:1,LEA Several:1,Several people:1,have pointed:1,while LEA:1,performing certain:1,certain additions:1,additions see:1,6 it:1,perfect replacement:1,replacement for:1,for ADD:1,ADD What’s:1,difference LEA:1,LEA an:1,addressing instruction:1,by trade:1,trade doesn’t:1,flags while:1,arithmetic ADD:1,instruction most:1,most certainly:1,certainly does:1,performing additions:1,additions that:1,only quantities:1,quantities that:1,that fit:1,one machine:1,machine word:1,word 32:1,mode 16:1,bits otherwise:1,renders LEA:1,LEA useless:1,useless for:1,multiword operations:1,together partial:1,partial results:1,example these:1,instructions cb78-1:1,cb78-1 ADD:1,ADD EAXEBX:1,EAXEBX cb78-2:1,cb78-2 ADC:1,EDXECX could:1,replaced cb79-1:1,cb79-1 LEA:1,LEA EAX:1,EAX EAX:1,EBX cb79-2:1,cb79-2 ADC:1,EDXECX because:1,because LEA:1,LEA doesn’t:1,flag The:1,The no-carry:1,no-carry characteristic:1,LEA becomes:1,distinct advantage:1,advantage when:1,performing pointer:1,arithmetic however:1,however For:1,code uses:1,pointers while:1,while adding:1,adding one:1,one 128-bit:1,128-bit memory:1,another such:1,such variable:1,variable Yes:1,use LODSD:1,LODSD instead:1,of MOV/LEA:1,MOV/LEA I’m:1,just illustrating:1,illustrating a:1,here Besides:1,Besides LODS:1,LODS is:1,than MOV/LEA:1,MOV/LEA on:1,486 If:1,used ADD:1,ADD rather:1,than LEA:1,pointers the:1,one ADC:1,next would:1,preserved with:1,either PUSHF/POPF:1,PUSHF/POPF or:1,or LAHF/SAHF:1,LAHF/SAHF Alternatively:1,use multiple:1,multiple INC:1,INC s:1,s since:1,since INC:1,flag In:1,short LEA:1,indeed different:1,from ADD:1,ADD Sometimes:1,Sometimes it’s:1,better Sometimes:1,Sometimes not:1,not that’s:1,various instruction:1,instruction substitutions:1,substitutions and:1,and optimizations:1,you over:1,x86 it:1,do But:1,But there:1,there sure:1,sure are:1,interesting options:1,options aren’t:1,aren’t there:1,The Kennedy:1,Kennedy Portfolio:1,Portfolio Reader:1,Reader John:1,John Kennedy:1,Kennedy regularly:1,regularly passes:1,passes along:1,along intriguing:1,intriguing assembly:1,programming tricks:1,tricks many:1,seen mentioned:1,mentioned anywhere:1,else John:1,John likes:1,for size:1,size whereas:1,whereas I:1,I lean:1,lean more:1,more toward:1,toward speed:1,his optimizations:1,both purposes:1,purposes Here:1,my favorites:1,favorites John’s:1,for setting:1,setting AX:1,its absolute:1,This does:1,nothing when:1,if AX:1,positive When:1,When AX:1,negative the:1,code nots:1,nots it:1,adds 1:1,you perform:1,a two’s:1,two’s complement:1,complement negate:1,negate For:1,where AX:1,not negative:1,negative this:1,trick usually:1,usually beats:1,beats the:1,the stuffing:1,stuffing out:1,standard absolute:1,value code:1,However John’s:1,doubt coming:1,realize and:1,13 the:1,optimization world:1,itself Here’s:1,how John:1,John copies:1,from DSSI:1,DSSI to:1,to ESDI:1,ESDI moving:1,time ADC:1,ADC CXCX:1,CXCX can:1,with RCL:1,RCL CX1:1,CX1 which:1,processor type:1,type It:1,be hard:1,this However:1,generally is:1,is Sure:1,Sure if:1,approach incurs:1,penalty approximately:1,the REP:1,REP startup:1,startup time:1,for MOVSB:1,MOVSB However:1,even John’s:1,doesn’t branch:1,branch saving:1,not emptying:1,queue If:1,If copy:1,copy lengths:1,distributed between:1,between even:1,even and:1,and odd:1,most x86:1,x86 systems:1,systems Not:1,Not on:1,486 though:1,though John:1,John also:1,also points:1,386 multiple:1,multiple LEA:1,s can:1,multiplications that:1,single LEA:1,as multiple:1,multiple shifts:1,adds can:1,multiplication only:1,only faster:1,faster LEA:1,multiply in:1,9 several:1,several LEA:1,s strung:1,much wider:1,wider range:1,values For:1,example video:1,video programmers:1,undoubtedly familiar:1,multiply AX:1,AX times:1,times 80:1,80 the:1,PC display:1,display modes:1,modes Using:1,Using LEA:1,above could:1,which still:1,as using:1,table like:1,like cb87-1:1,cb87-1 MOV:1,MOV EAXMultiplesOf80Table[EAX*4:1,EAXMultiplesOf80Table[EAX*4 but:1,close and:1,less space:1,space Of:1,course on:1,add version:1,version could:1,this considerably:1,efficient code:1,code Speeding:1,Up Multiplication:1,Multiplication That:1,to multiplication:1,multiplication one:1,slowest of:1,x86 operations:1,optimization One:1,up multiplication:1,multiplication is:1,use shift:1,add LEA:1,LEA or:1,table to:1,to hard-code:1,hard-code a:1,multiplication operation:1,fixed multiplier:1,multiplier as:1,above Another:1,Another is:1,the early-out:1,say 386:1,your operands:1,operands so:1,multiplier always:1,rightmost operand:1,operand following:1,following MUL:1,MUL or:1,or IMUL:1,IMUL is:1,other operand:1,operand Why:1,386 processes:1,processes one:1,one multiplier:1,immediately ends:1,ends a:1,multiplication when:1,all significant:1,multiplier have:1,so fewer:1,large multiplicand:1,small multiplier:1,multiplier than:1,small multiplicand:1,large multiplier:1,multiplier by:1,each significant:1,bit eliminated:1,eliminated There’s:1,trick below:1,below 3:1,3 significant:1,multiplier bits:1,bits no:1,are saved:1,saved For:1,example multiplication:1,32767 times:1,times 1:1,is 12:1,than multiplication:1,1 times:1,times 32727:1,32727 Choosing:1,Choosing the:1,right operand:1,operand as:1,multiplier can:1,wonders According:1,to published:1,published specs:1,specs the:1,386 takes:1,takes 38:1,38 cycles:1,multiplier with:1,with 32:1,32 significant:1,only 9:1,multiplier of:1,2 a:1,times My:1,My tests:1,tests regularly:1,regularly indicate:1,that multiplication:1,multiplication takes:1,the specs:1,specs indicate:1,indicate but:1,the cycle-per-bit:1,cycle-per-bit advantage:1,smaller multipliers:1,multipliers holds:1,true nonetheless:1,nonetheless This:1,This highlights:1,highlights another:1,another interesting:1,point MUL:1,IMUL on:1,that alternative:1,alternative multiplication:1,multiplication approaches:1,approaches while:1,while generally:1,generally still:1,faster are:1,are worthwhile:1,worthwhile only:1,truly time-critical:1,On 386SXs:1,386SXs and:1,and uncached:1,uncached 386s:1,386s where:1,where code:1,can significantly:1,significantly affect:1,the compact:1,compact MUL:1,IMUL instructions:1,can approach:1,cases even:1,even outperform:1,optimized alternatives:1,alternatives All:1,all MUL:1,IMUL are:1,are reasonable:1,reasonable performers:1,performers on:1,most cases—and:1,cases—and you:1,help that:1,smaller operand:1,operand the:1,multiplier whenever:1,which operand:1,operand is:1,smaller That:1,should test:1,and swap:1,swap operands:1,operands to:1,smaller one:1,multiplier that:1,that rarely:1,rarely pays:1,off I’m:1,speaking more:1,you’re scaling:1,scaling an:1,array up:1,say 2:1,10 because:1,be small:1,elements may:1,logical choice:1,multiplier Optimizing:1,Optimizing Optimized:1,Optimized Searching:1,Searching Rob:1,Rob Williams:1,Williams writes:1,writes with:1,wonderful optimization:1,SCASB based:1,based optimized:1,optimized searching:1,searching routine:1,routine I:1,5 As:1,refresher I:1,described searching:1,string as:1,follows Scan:1,Scan for:1,SCASB then:1,use REPZ:1,match whenever:1,whenever REPNZ:1,SCASB finds:1,finds a:1,9.1 The:1,principle is:1,most buffer:1,given string:1,string so:1,so REPNZ:1,SCASB by:1,matches each:1,each remaining:1,remaining potential:1,match can:1,checked in:1,CMPS Figure:1,string Rob’s:1,revelation which:1,he credits:1,credits without:1,without explanation:1,explanation to:1,to Edgar:1,Edgar Allen:1,Allen Poe:1,Poe search:1,search nevermore:1,nevermore was:1,slowest part:1,is handling:1,handling REPNZ:1,matches which:1,require checking:1,and restarting:1,restarting REPNZ:1,SCASB if:1,found Rob:1,matches can:1,reduced simply:1,string that:1,appears least:1,least often:1,searched Imagine:1,Imagine if:1,you’re searching:1,string EQUAL:1,EQUAL By:1,By my:1,approach you’d:1,you’d use:1,each occurrence:1,of E:1,E which:1,which crops:1,quite often:1,text Rob:1,for Q:1,Q then:1,string when:1,a Q:1,found as:1,9.2 Q:1,often resulting:1,fewer whole-string:1,whole-string checks:1,checks and:1,faster processing:1,processing Listing:1,9.1 implements:1,the scan-on-first-character:1,scan-on-first-character approach:1,9.2 scans:1,whatever character:1,caller specifies:1,specifies Listing:1,9.3 is:1,approaches How:1,does Rob’s:1,revelation make:1,make Plenty:1,Plenty Even:1,entire C:1,C function:1,to FindString:1,timed strlen:1,strlen calls:1,calls parameter:1,parameter pushing:1,pushing calling:1,calling setup:1,setup and:1,and all—the:1,all—the version:1,is directed:1,directed by:1,9.3 to:1,the infrequently-occurring:1,infrequently-occurring Q:1,about 40:1,test search:1,9.3 than:1,9.1 which:1,always scans:1,case E:1,E However:1,search loops:1,actually does:1,the searching:1,FindString are:1,compared Listing:1,Listing 9.1—a:1,9.1—a remarkable:1,remarkable improvement:1,over code:1,uses REPNZ:1,and REPZ:1,CMPS What:1,about Rob’s:1,Rob’s approach:1,it demonstrates:1,demonstrates that:1,involves much:1,than instruction:1,instruction selection:1,and cycle:1,counting Listings:1,9.2 use:1,use pretty:1,even use:1,same approach:1,scanning with:1,using REPZ:1,check scanning:1,scanning matches:1,matches The:1,between Listings:1,you more:1,doubling of:1,due entirely:1,entirely to:1,handled and:1,and biasing:1,biasing the:1,reflect that:1,knowledge Figure:1,string You’ll:1,You’ll notice:1,9.2 I:1,didn’t use:1,character frequencies:1,frequencies in:1,English text:1,scan but:1,rather let:1,caller make:1,that choice:1,choice Each:1,Each buffer:1,bytes has:1,has unique:1,characteristics and:1,and English-letter:1,English-letter frequency:1,frequency could:1,be inappropriate:1,inappropriate What:1,with French:1,French text:1,text Cyrillic:1,Cyrillic What:1,isn’t text:1,text that’s:1,that’s being:1,searched It:1,worthwhile for:1,application to:1,dynamic frequency:1,frequency table:1,best scan:1,scan character:1,character could:1,chosen for:1,each search:1,search Or:1,search isn’t:1,isn’t time-critical:1,time-critical or:1,small The:1,performance dramatically:1,dramatically by:1,you work:1,work This:1,equally true:1,for high-level:1,9.1 the:1,lies not:1,in elbow:1,elbow grease:1,grease or:1,or cycle:1,the organic:1,organic integrating:1,integrating optimizer:1,optimizer technology:1,technology we:1,all carry:1,carry around:1,our heads:1,heads Short:1,Short Sorts:1,Sorts David:1,Stafford recently:1,Borland Japan:1,Japan who:1,who happens:1,programmers I’ve:1,ever met:1,met has:1,has written:1,C-callable routine:1,that sorts:1,sorts an:1,ascending order:1,particularly noteworthy:1,noteworthy except:1,David’s routine:1,routine shown:1,Listing 9.4:1,9.4 is:1,exactly 25:1,25 bytes:1,long Look:1,code you’ll:1,you’ll keep:1,keep saying:1,saying to:1,to yourself:1,yourself But:1,this doesn’t:1,doesn’t work…oh:1,work…oh yes:1,guess it:1,does As:1,As they:1,say in:1,the Prego:1,Prego spaghetti:1,spaghetti sauce:1,sauce ads:1,ads it’s:1,it’s in:1,packing Anyway:1,Anyway David:1,David says:1,24-byte sort:1,sort routine:1,routine eludes:1,eludes him:1,and he’d:1,he’d like:1,anyone can:1,one Full:1,Full 32-Bit:1,32-Bit Division:1,Division One:1,most annoying:1,annoying limitations:1,x86 is:1,dividend operand:1,the DIV:1,DIV instruction:1,be 32:1,size both:1,result must:1,be 16:1,That’s particularly:1,particularly annoying:1,annoying in:1,in regards:1,regards to:1,result because:1,because sometimes:1,sometimes you:1,dividend to:1,than 64K-1:1,64K-1 or:1,or not—and:1,not—and if:1,you guess:1,guess wrong:1,wrong you:1,that godawful:1,godawful Divide:1,interrupt So:1,not fit:1,dividend is:1,than 32:1,bits Fall:1,Fall back:1,a software:1,software division:1,division approach:1,approach That:1,will work—but:1,work—but oh:1,oh so:1,so slowly:1,slowly There’s:1,another technique:1,technique that’s:1,pure software:1,software approach:1,approach albeit:1,albeit not:1,so flexible:1,flexible This:1,technique allows:1,allows arbitrarily:1,dividends and:1,limited to16:1,to16 bits:1,perfect but:1,does solve:1,solve a:1,particular eliminating:1,a Divide:1,interrupt from:1,a too-large:1,too-large result:1,result This:1,technique involves:1,than breaking:1,breaking up:1,division into:1,into word-sized:1,word-sized chunks:1,chunks starting:1,dividend The:1,is divided:1,divisor with:1,of overflow:1,overflow because:1,each then:1,remainder is:1,is prepended:1,prepended to:1,next 16:1,of dividend:1,9.3 This:1,to dividing:1,dividing by:1,by hand:1,hand except:1,stop to:1,carry the:1,remainder manually:1,manually only:1,dividend the:1,hardware divide:1,rest Listing:1,Listing 9.5:1,9.5 shows:1,divide an:1,an arbitrarily:1,16-bit divisor:1,Listing 9.6:1,9.6 shows:1,sample division:1,division of:1,dividend Note:1,to handling:1,handling arbitrarily:1,dividends in:1,proceed a:1,dword rather:1,386 Figure:1,handling signed:1,signed division:1,division with:1,with arbitrarily:1,dividends that:1,done easily:1,and divisor:1,divisor dividing:1,and applying:1,the stored:1,stored signs:1,signs to:1,proper signs:1,signs for:1,the quotient:1,quotient and:1,and remainder:1,remainder There:1,more clever:1,clever ways:1,result by:1,using IDIV:1,IDIV for:1,one drop:1,line c/o:1,c/o Coriolis:1,Group Books:1,Books Sweet:1,Sweet Spot:1,Spot Revisited:1,Revisited Way:1,Way back:1,in Volume:1,Volume 1:1,1 Number:1,Number 1:1,TECHNIQUES April/May:1,April/May 1990:1,1990 I:1,that magazine’s:1,magazine’s HAX:1,HAX 1:1,which extolled:1,extolled the:1,of placing:1,placing your:1,most commonly-used:1,commonly-used automatic:1,automatic stack-based:1,stack-based variables:1,area between:1,between 127:1,127 to:1,bytes away:1,BP the:1,frame pointer:1,reason was:1,store addressing:1,addressing displacements:1,displacements that:1,fall within:1,within that:1,larger displacements:1,displacements require:1,full word:1,of storage:1,storage increasing:1,increasing code:1,size by:1,byte per:1,thereby slowing:1,slowing down:1,down performance:1,to increased:1,increased instruction:1,fetching time:1,This takes:1,takes on:1,on new:1,new prominence:1,prominence in:1,mode where:1,where straying:1,straying from:1,spot costs:1,costs not:1,bytes Where:1,8088 had:1,possible displacement:1,displacement sizes:1,sizes either:1,either byte:1,or word:1,386 there:1,three possible:1,possible sizes:1,sizes byte:1,byte word:1,or dword:1,dword In:1,In native:1,word-sized displacement:1,variable located:1,located outside:1,spot requires:1,two extra:1,bytes an:1,extra displacement:1,three extra:1,dword displacement:1,displacement rather:1,byte displacement:1,displacement Either:1,way instructions:1,instructions grow:1,grow alarmingly:1,alarmingly Performance:1,Performance may:1,not suffer:1,from missing:1,spot depending:1,mix On:1,486 prefix:1,bytes often:1,often cost:1,a 386SX:1,386SX increased:1,size often:1,often slows:1,slows performance:1,fetched through:1,the half-pint:1,half-pint 16-bit:1,bus on:1,effect depends:1,instruction mix:1,mix and:1,whether there’s:1,cache On:1,balance though:1,it’s as:1,your most-used:1,most-used variables:1,spot in:1,assembly it’s:1,your stack:1,C however:1,however you’ll:1,allocation scheme:1,scheme your:1,compiler uses:1,to allocate:1,allocate automatic:1,automatic variables:1,and declare:1,declare automatics:1,automatics appropriately:1,appropriately to:1,Turbo C:1,some years:1,and trimmed:1,trimmed the:1,program admittedly:1,several K—not:1,K—not bad:1,bad when:1,spot optimization:1,essentially free:1,free with:1,no code:1,code reorganization:1,reorganization change:1,in logic:1,logic or:1,or heavy:1,heavy thinking:1,thinking involved:1,involved Hard-Core:1,Hard-Core Cycle:1,Counting Next:1,Next we:1,an item:1,item that:1,cycle counters:1,counters will:1,will love:1,love especially:1,involves apparently:1,apparently incorrect:1,incorrect documentation:1,documentation on:1,on Intel’s:1,Intel’s part:1,part According:1,Intel’s documents:1,documents all:1,all RCR:1,RCL instructions:1,which perform:1,perform rotations:1,rotations through:1,flag as:1,9.4 take:1,register operand:1,operand My:1,My measurements:1,the 9-cycle:1,9-cycle execution:1,time almost:1,almost holds:1,for multibit:1,multibit rotate-through-carries:1,rotate-through-carries which:1,timed at:1,apiece for:1,example RCR:1,RCR AXCL:1,AXCL takes:1,takes 8:1,does RCL:1,RCL DX2:1,DX2 Contrast:1,with ROR:1,register any:1,However rotating:1,rotating by:1,bit through:1,flag does:1,cycles contrary:1,Intel’s 80386:1,80386 Programmer’s:1,Manual or:1,even 8:1,fact RCR:1,RCR reg:1,RCL reg:1,1 take:1,like ROR:1,ROR ROL:1,ROL SHR:1,SHR and:1,SHL At:1,least that’s:1,fast they:1,they run:1,I very:1,much doubt:1,doubt that:1,find different:1,other 386s:1,386s Please:1,Please let:1,do though:1,though Figure:1,flag Interestingly:1,Interestingly according:1,Intel’s i486:1,Manual the:1,can RCR:1,RCL a:1,but takes:1,takes between:1,between 8:1,and 30:1,multibit register:1,register RCR:1,RCL No:1,No great:1,great lesson:1,here just:1,a caution:1,caution to:1,be leery:1,of multibit:1,multibit RCR:1,RCL when:1,performance matters—and:1,matters—and to:1,take cycle-time:1,documentation with:1,a grain:1,grain of:1,of salt:1,salt Hardwired:1,Hardwired Far:1,Far Jumps:1,Jumps Did:1,ever wonder:1,an absolute:1,absolute address:1,language Probably:1,do you’re:1,be glad:1,glad for:1,this next:1,next item:1,item because:1,solution doesn’t:1,work You:1,think all:1,say 10005:1,10005 would:1,be JMP:1,JMP FAR:1,PTR 10005:1,10005 but:1,but you’d:1,be wrong:1,That won’t:1,even assemble:1,assemble You:1,then think:1,construct in:1,pointer containing:1,containing 10005:1,10005 as:1,following That:1,a price:1,price in:1,performance On:1,8088 JMP:1,PTR mem:1,mem an:1,least 37:1,37 cycles:1,cycles JMP:1,PTR label:1,label a:1,cycles plus:1,plus almost:1,certainly some:1,fetching On:1,386 an:1,least 43:1,43 cycles:1,mode 31:1,31 in:1,least 12:1,cycles about:1,is nowhere:1,near that:1,that big:1,big the:1,fastest I’ve:1,measured indirect:1,far jumps:1,so direct:1,direct is:1,much Oh:1,Oh those:1,those cycle-time:1,documentation blues:1,blues Also:1,least 27:1,mode why:1,idea At:1,original problem:1,10005 Although:1,jump will:1,still preferable:1,preferable Listing:1,Listing 9.7:1,9.7 shows:1,10005 Don’t:1,Don’t run:1,to crash:1,crash your:1,system It:1,by creating:1,dummy segment:1,at 1000H:1,1000H so:1,label FarLabel:1,FarLabel can:1,desired far:1,far attribute:1,attribute at:1,location Segments:1,Segments created:1,with AT:1,AT don’t:1,don’t cause:1,actual bytes:1,memory they’re:1,just templates:1,templates It’s:1,little kludgey:1,kludgey but:1,least it:1,work There:1,solution if:1,along By:1,I merely:1,merely applied:1,applied my:1,Dan Illowsky’s:1,Illowsky’s long-standing:1,long-standing rule:1,for dealing:1,MASM If:1,obvious doesn’t:1,it usually:1,usually doesn’t:1,doesn’t just:1,just try:1,try everything:1,how ridiculous:1,ridiculous until:1,that does—a:1,does—a rule:1,rule with:1,history on:1,its side:1,side Setting:1,Setting 32-Bit:1,32-Bit Registers:1,Registers Time:1,Time versus:1,versus Space:1,Space To:1,To finish:1,chapter consider:1,consider these:1,two items:1,items First:1,First in:1,mode takes:1,long because:1,because native:1,mode constants:1,constants are:1,are dwords:1,dwords and:1,MOV instruction:1,doesn’t sign-extend:1,sign-extend Both:1,Both code:1,are ways:1,set EAX:1,EAX to:1,1 although:1,first affects:1,second doesn’t:1,doesn’t this:1,trade-off of:1,for space:1,space Second:1,Second takes:1,long Both:1,instructions set:1,set EBX:1,trade-off of—gee:1,of—gee it’s:1,a trade-off:1,trade-off at:1,it OR:1,OR is:1,1-bits just:1,as SUB:1,SUB or:1,or XOR:1,all 0-bits:1,0-bits Who:1,Who woulda:1,woulda thunk:1,thunk it:1,it Just:1,Just goes:1,32-bit displacements:1,displacements and:1,and constants:1,constants of:1,mode change:1,familiar landscape:1,landscape of:1,of 80x86:1,80x86 optimization:1,optimization Be:1,found OR:1,OR AND:1,AND ADD:1,MOV when:1,with immediate:1,immediate operands:1,386 under:1,under some:1,circumstances for:1,that thus:1,far escape:1,escape me:1,me This:1,This just:1,just reinforces:1,reinforces the:1,optimization Measure:1,Measure your:1,and place:1,place not:1,your trust:1,trust in:1,in documented:1,times Chapter:1,Chapter 10:1,10 Patient:1,Patient Coding:1,Coding Faster:1,Faster Code:1,Code How:1,How Working:1,Working Quickly:1,Quickly Can:1,Can Bring:1,Bring Execution:1,Execution to:1,a Crawl:1,Crawl My:1,My grandfather:1,The New:1,York Times:1,Times crossword:1,crossword puzzle:1,Sunday In:1,In ink:1,ink With:1,With nary:1,nary a:1,a blemish:1,blemish The:1,The relevance:1,relevance of:1,a trice:1,trice What:1,What my:1,grandfather is:1,is is:1,matcher par:1,par excellence:1,excellence You’re:1,You’re a:1,matcher too:1,too So:1,So am:1,I We:1,can’t help:1,territory Try:1,Try focusing:1,on text:1,not reading:1,reading it:1,it Can’t:1,Can’t do:1,it Can:1,Can you:1,of someone:1,not recognize:1,can’t And:1,And how:1,how in:1,the Nine:1,Nine Billion:1,Billion Names:1,Names of:1,God is:1,we’re capable:1,of instantly:1,instantly recognizing:1,recognizing one:1,one face:1,face out:1,the thousands:1,thousands we’ve:1,our lifetimes—even:1,lifetimes—even years:1,years later:1,later from:1,different angle:1,different light:1,light Although:1,take them:1,granted our:1,our pattern-matching:1,pattern-matching capabilities:1,a miracle:1,miracle on:1,of loaves:1,loaves and:1,and fishes:1,fishes By:1,By pattern:1,matching I:1,mean more:1,just recognition:1,recognition though:1,generally able:1,take complex:1,often seemingly:1,seemingly woefully:1,woefully inadequate:1,inadequate data:1,data instantaneously:1,instantaneously match:1,match it:1,incredibly flexible:1,flexible way:1,our past:1,experience extrapolate:1,extrapolate and:1,and reach:1,reach amazing:1,amazing conclusions:1,conclusions something:1,scarcely do:1,do at:1,all Crossword:1,Crossword puzzles:1,puzzles are:1,example given:1,of letters:1,a cryptic:1,cryptic clue:1,clue we’re:1,we’re somehow:1,somehow able:1,several hundred:1,thousand words:1,words that:1,know Try:1,Try writing:1,that What’s:1,don’t process:1,process data:1,serial brute-force:1,brute-force way:1,computers do:1,do Solutions:1,Solutions tend:1,be virtually:1,virtually instantaneous:1,instantaneous or:1,all none:1,those N:1,N log:1,log N:1,N or:1,or N:1,2 execution:1,us It:1,matching is:1,good more:1,faster we:1,better Not:1,Not always:1,always though:1,though Sometimes:1,Sometimes insufficient:1,insufficient information:1,information really:1,is insufficient:1,insufficient and:1,our haste:1,haste to:1,the heady:1,heady rush:1,rush of:1,solution incorrect:1,incorrect or:1,or less-than-optimal:1,less-than-optimal conclusions:1,are reached:1,reached as:1,as anyone:1,who has:1,ever done:1,the Times:1,Times Sunday:1,Sunday crossword:1,crossword will:1,will attest:1,attest Still:1,Still my:1,that puzzle:1,Sunday in:1,in ink:1,ink What’s:1,What’s his:1,his secret:1,secret Patience:1,Patience and:1,discipline He:1,He never:1,never fills:1,fills a:1,in until:1,until he’s:1,he’s confirmed:1,confirmed it:1,head via:1,via intersecting:1,intersecting words:1,words no:1,how strong:1,strong the:1,the urge:1,urge may:1,put something:1,something down:1,down where:1,where he:1,he can:1,and feel:1,like he’s:1,he’s getting:1,getting somewhere:1,somewhere There’s:1,close parallel:1,programming here:1,here Programming:1,matching in:1,with crossword:1,crossword puzzles:1,puzzles following:1,following your:1,instincts too:1,quickly can:1,a liability:1,liability For:1,programmers myself:1,included there’s:1,a strong:1,strong urge:1,urge to:1,coding it:1,now what:1,what some:1,people call:1,call hacking:1,hacking a:1,program Going:1,Going with:1,thing your:1,matcher comes:1,with can:1,fun there’s:1,there’s instant:1,instant gratification:1,gratification and:1,a feeling:1,of unbounded:1,unbounded creativity:1,creativity Personally:1,Personally I’ve:1,always hungered:1,hungered to:1,get results:1,my work:1,I gravitated:1,gravitated toward:1,toward graphics:1,its instant:1,instant and:1,visible gratification:1,gratification Over:1,however I’ve:1,learned patience:1,patience I’ve:1,an increasingly:1,increasingly large:1,large portion:1,time choosing:1,choosing algorithms:1,algorithms designing:1,designing and:1,simply giving:1,giving my:1,mind quiet:1,quiet time:1,on problems:1,problems and:1,with non-obvious:1,non-obvious approaches:1,approaches before:1,before coding:1,front more:1,itself in:1,both decreased:1,decreased coding:1,coding time:1,and superior:1,superior programs:1,walk you:1,but illustrative:1,illustrative case:1,case history:1,history that:1,nicely points:1,points up:1,of delaying:1,delaying gratification:1,gratification when:1,problems so:1,mind has:1,has time:1,to chew:1,chew on:1,other angles:1,angles The:1,alternative solutions:1,solutions you:1,find by:1,seem obvious:1,you’ve come:1,them They:1,differ greatly:1,your initial:1,initial solutions:1,solutions Often:1,however they:1,much better—and:1,better—and you’ll:1,never even:1,they’re better:1,The Case:1,Case for:1,for Delayed:1,Delayed Gratification:1,Gratification Once:1,Once upon:1,upon a:1,read Algorithms:1,wonderful stimulating:1,stimulating and:1,useful book:1,book one:1,recommend highly:1,highly My:1,My story:1,story however:1,however involves:1,only what:1,happened in:1,first 12:1,12 pages:1,pages for:1,those pages:1,that Sedgewick:1,Sedgewick discussed:1,discussed Euclid’s:1,algorithm Euclid’s:1,algorithm discovered:1,discovered by:1,by Euclid:1,Euclid of:1,of Euclidean:1,Euclidean geometry:1,geometry fame:1,fame a:1,ago way:1,when computers:1,computers still:1,used core:1,core memory:1,straightforward algorithm:1,that solves:1,solves one:1,problems imaginable:1,imaginable finding:1,common integer:1,integer divisor:1,divisor GCD:1,two positive:1,integers Sedgewick:1,Sedgewick points:1,for reducing:1,reducing a:1,fraction to:1,its lowest:1,lowest terms:1,terms I’m:1,things as:1,although none:1,none spring:1,mind A:1,A long:1,wrote an:1,about optimizing:1,optimizing a:1,even vaguely:1,vaguely time-critical:1,time-critical and:1,got swamped:1,swamped with:1,with letters:1,letters telling:1,telling me:1,wasn’t time-critical:1,time-critical it:1,example So:1,now close:1,close your:1,eyes and:1,that finding:1,only necessary:1,it’s perfect:1,now Okay:1,Okay The:1,problem at:1,hand then:1,this Find:1,Find the:1,largest integer:1,that evenly:1,evenly divides:1,divides two:1,two arbitrary:1,arbitrary positive:1,integers That’s:1,So warm:1,warm up:1,pattern matchers…and:1,matchers…and go:1,The Brute-Force:1,Brute-Force Syndrome:1,Syndrome I:1,funny feeling:1,you’d already:1,already figured:1,GCD before:1,I even:1,even said:1,said go:1,go That’s:1,did when:1,reading Algorithms:1,Algorithms before:1,read another:1,another word:1,figure it:1,myself Programmers:1,Programmers are:1,give them:1,their eyes:1,eyes immediately:1,immediately glaze:1,glaze over:1,over as:1,they try:1,you’ve even:1,even shut:1,shut your:1,your mouth:1,mouth That:1,of instant:1,instant response:1,response can:1,be impressive:1,impressive but:1,can backfire:1,backfire too:1,too as:1,my case:1,case You:1,fell victim:1,common programming:1,programming pitfall:1,pitfall the:1,brute-force syndrome:1,syndrome The:1,this syndrome:1,syndrome is:1,have obvious:1,brute-force solutions—with:1,solutions—with one:1,small drawback:1,drawback The:1,drawback is:1,brute-force solution:1,solution by:1,by hand—that:1,hand—that is:1,is work:1,single problem:1,problem out:1,with pencil:1,pencil and:1,and paper:1,paper or:1,a calculator—it:1,calculator—it would:1,would generally:1,generally require:1,the patience:1,discipline to:1,for approximately:1,approximately seven:1,seven hundred:1,hundred years:1,years not:1,not counting:1,counting eating:1,eating and:1,and sleeping:1,sleeping in:1,an answer:1,answer Finding:1,Finding all:1,the prime:1,prime numbers:1,numbers less:1,1000000 is:1,example just:1,just divide:1,each number:1,number up:1,to 1000000:1,1000000 by:1,every lesser:1,lesser number:1,what’s left:1,left standing:1,standing For:1,of humankind:1,humankind people:1,people were:1,were forced:1,of cleverer:1,cleverer solutions:1,solutions such:1,the Sieve:1,Sieve of:1,of Eratosthenes:1,Eratosthenes we’d:1,in big:1,big trouble:1,the ancient:1,ancient Greeks:1,Greeks had:1,had had:1,had computers:1,computers mainly:1,because after:1,of brute:1,brute force-type:1,force-type work:1,work people’s:1,people’s attention:1,attention gets:1,gets diverted:1,diverted to:1,other important:1,important matters:1,matters such:1,as how:1,far a:1,paper airplane:1,airplane will:1,will fly:1,fly from:1,a second-story:1,second-story window:1,window Not:1,so nowadays:1,nowadays though:1,though Computers:1,Computers love:1,love boring:1,boring work:1,very patient:1,patient and:1,and disciplined:1,disciplined and:1,and besides:1,besides one:1,one human:1,human year:1,year seven:1,seven dog:1,years two:1,two zillion:1,zillion computer:1,we’re faced:1,but exceedingly:1,exceedingly lengthy:1,lengthy solution:1,solution we’re:1,we’re apt:1,say Ah:1,Ah let:1,computer do:1,it’s fast:1,making paper:1,paper airplanes:1,airplanes Unfortunately:1,Unfortunately brute-force:1,brute-force solutions:1,slow even:1,when performed:1,by modern-day:1,modern-day microcomputers:1,microcomputers which:1,several MIPS:1,MIPS except:1,when I’m:1,I’m late:1,late for:1,an appointment:1,appointment and:1,and want:1,finish a:1,a compile:1,compile and:1,more test:1,test before:1,leave in:1,the crystal:1,crystal in:1,my computer:1,is apparently:1,apparently designed:1,to automatically:1,automatically revert:1,1 Hz:1,Hz The:1,I instantly:1,instantly came:1,with to:1,to finding:1,as brute:1,force as:1,get Divide:1,Divide both:1,larger integer:1,integer iL:1,integer iS:1,iS by:1,every integer:1,integer equal:1,integer until:1,divides both:1,both evenly:1,10.1 This:1,lousy solution:1,solution requiring:1,requiring as:1,as iS*2:1,iS*2 divisions:1,divisions very:1,expensive especially:1,large values:1,of iS:1,iS For:1,example finding:1,of 30001:1,30001 and:1,and 30002:1,30002 would:1,require 60002:1,60002 divisions:1,divisions which:1,which alone:1,alone disregarding:1,disregarding tests:1,branches would:1,about 2:1,2 seconds:1,50 milliseconds:1,milliseconds even:1,MHz 486—a:1,486—a very:1,not insignificant:1,insignificant in:1,human years:1,years either:1,either Listing:1,to GCD:1,GCD calculation:1,calculation Table:1,takes this:1,GCD for:1,several integer:1,integer pairs:1,pairs As:1,expected performance:1,extremely poor:1,poor when:1,when iS:1,is large:1,large Figure:1,GCD Integer:1,Integer pairs:1,find GCD:1,GCD Note:1,Note Performance:1,Performance of:1,Listings 10.1:1,10.1 through:1,through 10.5:1,10.5 in:1,in finding:1,common divisors:1,divisors of:1,various pairs:1,integers Times:1,microseconds Percentages:1,Percentages represent:1,represent execution:1,a percentage:1,percentage of:1,same integer:1,integer pair:1,pair Listings:1,Listings 10.1-10.4:1,10.1-10.4 were:1,were compiled:1,C except:1,except as:1,used All:1,3 on:1,386 Wasted:1,Wasted Breakthroughs:1,Breakthroughs Sedgewick’s:1,Sedgewick’s first:1,GCD problem:1,with He:1,then pointed:1,of iL-iS:1,iL-iS and:1,iS This:1,once Sedgewick:1,Sedgewick pointed:1,pointed it:1,of division:1,division any:1,divides iL:1,iL evenly:1,evenly nL:1,nL times:1,iS evenly:1,evenly nS:1,nS times:1,times must:1,must divide:1,divide iL-iS:1,iL-iS evenly:1,evenly nL-nS:1,nL-nS times:1,times Given:1,that insight:1,insight I:1,immediately designed:1,designed a:1,new faster:1,approach shown:1,10.2 Listing:1,10.2 repeatedly:1,repeatedly subtracts:1,subtracts iS:1,iS If:1,If iL:1,becomes equal:1,iS then:1,then that’s:1,GCD alternatively:1,alternatively if:1,if iL:1,iS iL:1,iS switch:1,switch values:1,10.2 The:1,of iterations:1,iterations this:1,requires relative:1,10.1 depends:1,iS so:1,always faster:1,as Table:1,10.1 indicates:1,GCD Listing:1,far graver:1,graver misstep:1,misstep than:1,faster Listing:1,obviously a:1,a hacked-up:1,hacked-up brute-force:1,could mistake:1,mistake it:1,else It:1,be speeded:1,ways with:1,thought Simply:1,Simply skipping:1,skipping testing:1,testing all:1,the divisors:1,divisors between:1,between iS:1,iS and:1,and iS/2:1,iS/2 not:1,not inclusive:1,inclusive would:1,would cut:1,worst-case time:1,example that’s:1,it illustrates:1,how easily:1,easily Listing:1,10.1 can:1,improved Listing:1,hack job:1,job crying:1,for inspiration:1,inspiration Listing:1,10.2 on:1,the inspiration—and:1,inspiration—and largely:1,largely wasted:1,wasted it:1,through haste:1,haste Had:1,Had Sedgewick:1,Sedgewick not:1,not told:1,me otherwise:1,otherwise I:1,have assumed:1,10.2 was:1,mistake I:1,10.1 I:1,I experienced:1,experienced a:1,conceptual breakthrough:1,breakthrough when:1,understood Sedgewick’s:1,Sedgewick’s point:1,A smaller:1,smaller number:1,larger number:1,number without:1,affecting their:1,their GCD:1,GCD thereby:1,thereby inexpensively:1,inexpensively reducing:1,scale of:1,problem And:1,my hurry:1,hurry to:1,this breakthrough:1,breakthrough reality:1,reality I:1,I missed:1,missed its:1,its full:1,full scope:1,scope As:1,As Sedgewick:1,Sedgewick says:1,says on:1,very next:1,page the:1,by subtracting:1,subtracting iS:1,iL is:1,remainder that:1,dividing iL:1,iL by:1,by iS—again:1,iS—again this:1,is inherent:1,of division—and:1,division—and that:1,for Euclid’s:1,algorithm shown:1,10.3 Listing:1,of Euclid’s:1,algorithm As:1,from Table:1,10.1 Euclid’s:1,superior especially:1,large numbers:1,imagine if:1,were working:1,large longs:1,longs Had:1,I been:1,been implementing:1,implementing GCD:1,determination without:1,without Sedgewick’s:1,Sedgewick’s help:1,help I:1,surely not:1,have settled:1,settled for:1,Listing 10.1—but:1,10.1—but I:1,have ended:1,10.2 in:1,my enthusiasm:1,enthusiasm over:1,the brilliant:1,brilliant discovery:1,discovery of:1,of subtracting:1,lesser Using:1,GCD number:1,number from:1,greater In:1,product my:1,my lack:1,of patience:1,discipline could:1,been costly:1,costly indeed:1,GCD Give:1,mind time:1,and space:1,to wander:1,wander around:1,important programming:1,problems before:1,you settle:1,settle on:1,one approach:1,I titled:1,titled this:1,this book’s:1,book’s first:1,first chapter:1,Ears and:1,true what’s:1,true is:1,the optimizer:1,optimizer between:1,ears does:1,does its:1,work not:1,implementation stage:1,stage but:1,very beginning:1,beginning when:1,how what:1,doing can:1,brought together:1,together Recursion:1,Recursion Euclid’s:1,algorithm lends:1,to recursion:1,recursion beautifully:1,beautifully so:1,much so:1,10.3 comes:1,comes almost:1,almost without:1,without thought:1,thought Again:1,though take:1,consider what’s:1,10.3 There’s:1,There’s recursion:1,there’s recursion:1,recursion code:1,exact Listing:1,is code:1,code recursion—recursion:1,recursion—recursion through:1,through calls—the:1,calls—the sort:1,sort most:1,is conceptually:1,conceptually simplest:1,simplest However:1,recursion tends:1,slow because:1,it pushes:1,pushes parameters:1,calls a:1,subroutine for:1,every iteration:1,iteration Listing:1,10.4 which:1,uses data:1,recursion is:1,10.3 Actually:1,Actually you:1,10.4 uses:1,ignore any:1,any mention:1,mention of:1,of recursion:1,recursion conceptually:1,conceptually though:1,10.4 performs:1,same recursive:1,recursive operations:1,10.3 does:1,does Patient:1,Patient Optimization:1,Optimization At:1,optimize GCD:1,determination in:1,sense Table:1,10.4 with:1,without Microsoft:1,C/C s:1,s maximum:1,Listing 10.5:1,10.5 an:1,10.4 Sure:1,optimized versions:1,are faster:1,Listing 10.4—but:1,10.4—but the:1,the gains:1,gains are:1,small compared:1,those realized:1,realized from:1,the higher-level:1,higher-level optimizations:1,Listings 10.2:1,10.2 through:1,through 10.4:1,10.4 Assembly:1,is pattern:1,matching on:1,local scale:1,scale Frankly:1,Frankly it’s:1,of boring:1,boring brute-force:1,brute-force work:1,lousy at:1,at compilers:1,compilers could:1,could out-optimize:1,out-optimize you:1,pass tied:1,tied behind:1,behind their:1,their back:1,back if:1,they knew:1,knew as:1,writing as:1,do which:1,don’t Design:1,Design optimization—conceptual:1,optimization—conceptual breakthroughs:1,in understanding:1,the relationships:1,relationships between:1,application works:1,can do—is:1,do—is global:1,global pattern:1,matching Computers:1,Computers are:1,worse at:1,than humans:1,humans computers:1,computers have:1,integrate vast:1,vast amounts:1,of disparate:1,disparate information:1,information much:1,only vaguely:1,vaguely defined:1,defined or:1,or subject:1,change People:1,People oddly:1,enough are:1,are better:1,at global:1,global optimization:1,at local:1,optimization For:1,interesting For:1,another it’s:1,and imprecise:1,imprecise enough:1,allow intuition:1,intuition and:1,and inspiration:1,inspiration two:1,two vastly:1,vastly underrated:1,underrated programming:1,programming tools:1,the fore:1,fore And:1,out earlier:1,earlier people:1,perform instantaneous:1,instantaneous solutions:1,complex problems:1,problems while:1,while computers:1,computers bog:1,in geometrically:1,geometrically or:1,or exponentially:1,exponentially increasing:1,increasing execution:1,times Oh:1,Oh it:1,take days:1,days or:1,or weeks:1,a person:1,absorb enough:1,solution may:1,may only:1,be near-optimal—but:1,near-optimal—but the:1,solution itself:1,itself or:1,least each:1,solution arrives:1,arrives in:1,flash Those:1,Those flashes:1,flashes are:1,are your:1,matcher doing:1,doing its:1,its job:1,job Your:1,give your:1,matcher the:1,know each:1,each problem:1,it two:1,times from:1,different angles:1,what unexpected:1,unexpected solutions:1,solutions it:1,with Pull:1,Pull back:1,the reins:1,reins a:1,little Don’t:1,Don’t measure:1,measure progress:1,progress by:1,written today:1,today measure:1,it instead:1,instead by:1,by overall:1,overall progress:1,progress and:1,by quality:1,quality Relax:1,Relax and:1,and listen:1,that quiet:1,quiet inner:1,inner voice:1,real breakthroughs:1,breakthroughs Stop:1,Stop look:1,look listen—and:1,listen—and think:1,think Not:1,productive and:1,and creative:1,creative way:1,to program—but:1,program—but you’ll:1,you’ll also:1,also find:1,fun And:1,And think:1,think what:1,extra computer:1,years Chapter:1,Chapter 11:1,11 Pushing:1,386 New:1,New Registers:1,Registers New:1,Instructions New:1,New Timings:1,Timings New:1,New Complications:1,Complications This:1,Language 1989:1,1989 now:1,now out:1,of print:1,print provides:1,386 often:1,often contrasting:1,contrasting those:1,originally wrote:1,wrote this:1,the king:1,king of:1,new kids:1,kids on:1,block Today:1,Today of:1,course all:1,three processors:1,are past:1,past their:1,their primes:1,primes but:1,many millions:1,each are:1,particular is:1,still well:1,considering when:1,optimizing software:1,chapter provides:1,interesting look:1,x86 architecture:1,greater degree:1,degree than:1,expect for:1,family came:1,into full:1,full maturity:1,maturity with:1,Pentium are:1,faster 386s:1,386s with:1,little in:1,new functionality:1,286 added:1,instructions respectable:1,respectable performance:1,and protected:1,8088’s capabilities:1,386 added:1,added more:1,and brought:1,family into:1,32-bit world:1,world that:1,that represents:1,and increasingly:1,increasingly the:1,present of:1,of personal:1,personal computing:1,computing This:1,chapter also:1,also provides:1,provides insight:1,the variations:1,in processors:1,are common:1,common in:1,world So:1,longer represent:1,the mainstream:1,mainstream of:1,computing this:1,useful mix:1,history lesson:1,lesson x86:1,x86 overview:1,overview and:1,and details:1,two workhorse:1,workhorse processors:1,processors that:1,in wide:1,wide use:1,use Family:1,Family Matters:1,Matters While:1,one only:1,few members:1,the family—which:1,family—which includes:1,8088 8086:1,8086 80188:1,80188 80186:1,80186 286:1,286 386SX:1,386SX 386DX:1,386DX numerous:1,numerous permutations:1,permutations of:1,the Pentium—really:1,Pentium—really matter:1,matter The:1,but extinct:1,extinct in:1,PC arena:1,The 8086:1,8086 was:1,used fairly:1,fairly widely:1,widely for:1,but disappeared:1,disappeared The:1,The 80186:1,80186 and:1,and 80188:1,80188 never:1,really caught:1,caught on:1,require further:1,further discussion:1,discussion That:1,the high-end:1,high-end chips:1,chips the:1,286 the:1,386SX the:1,Pentium At:1,fast going:1,8088 people:1,are realizing:1,realizing that:1,small cost:1,cost advantage:1,386 isn’t:1,offset its:1,relatively large:1,large performance:1,performance disadvantage:1,disadvantage After:1,386SX suffers:1,same debilitating:1,debilitating problem:1,that looms:1,looms over:1,the 8088—a:1,8088—a too-small:1,too-small bus:1,bus Internally:1,but externally:1,externally it’s:1,processor a:1,a non-optimal:1,non-optimal architecture:1,architecture especially:1,386SX in:1,detail If:1,do find:1,yourself programming:1,386SX follow:1,rules you:1,follow for:1,8088 use:1,branch In:1,words avoid:1,definition better:1,at processing:1,processing data:1,data internally:1,internally than:1,at accessing:1,the purposes:1,purposes of:1,a universe:1,universe unto:1,itself We’ll:1,We’ll treat:1,treat them:1,them separately:1,chapters This:1,This leaves:1,two processors:1,processors the:1,386 Each:1,Each was:1,PC standard:1,its day:1,longer used:1,systems but:1,are millions:1,of 286-based:1,286-based systems:1,systems still:1,in daily:1,daily use:1,use The:1,systems although:1,the downhill:1,downhill leg:1,its lifespan:1,lifespan and:1,even wider:1,wider use:1,The future:1,future clearly:1,clearly belongs:1,belongs to:1,still very:1,the present-day:1,present-day landscape:1,landscape Crossing:1,the Gulf:1,Gulf to:1,386 Apart:1,from vastly:1,biggest difference:1,later Intel:1,Intel CPUs:1,CPUs is:1,286 introduced:1,introduced protected:1,386 greatly:1,greatly expanded:1,expanded the:1,of protected:1,mode We’re:1,We’re only:1,about real-mode:1,real-mode operation:1,however Protected:1,new memory:1,memory management:1,management scheme:1,scheme one:1,8088 Only:1,Only code:1,code specifically:1,specifically written:1,an alien:1,alien and:1,and hostile:1,hostile environment:1,environment for:1,for MS-DOS:1,particular segments:1,different creatures:1,creatures in:1,mode They’re:1,They’re selectors:1,selectors indexes:1,of segment:1,segment descriptors—rather:1,descriptors—rather than:1,than plain:1,old registers:1,to arbitrary:1,arbitrary values:1,values That:1,that segments:1,segments can’t:1,storage or:1,fast indivisible:1,indivisible 32-bit:1,32-bit load:1,load from:1,in Protected:1,uses those:1,those altered:1,altered segment:1,offer access:1,than real:1,286 supports:1,supports 16:1,16 megabytes:1,386 supports:1,supports 4:1,gigabytes 4K:1,4K megabytes:1,of physical:1,physical memory:1,terabytes 64K:1,64K gigabytes:1,gigabytes of:1,virtual memory:1,mode your:1,programs generally:1,system OS/2:1,OS/2 Unix:1,Unix Windows:1,NT or:1,that exerts:1,exerts much:1,more control:1,computer than:1,does MS-DOS:1,MS-DOS Protected:1,mode operating:1,run multiple:1,multiple programs:1,programs simultaneously:1,simultaneously and:1,depend far:1,quality than:1,how efficiently:1,efficiently the:1,uses operating:1,system services:1,services and:1,under what:1,what circumstances:1,system preempts:1,preempts the:1,program Protected:1,mode programs:1,often mostly:1,mostly collections:1,collections of:1,system calls:1,isn’t operating-system:1,operating-system oriented:1,oriented may:1,depend primarily:1,primarily on:1,how large:1,time slice:1,slice the:1,system gives:1,gives that:1,short taken:1,whole protected:1,mode programming:1,altogether from:1,been describing:1,describing in:1,book There’s:1,a knack:1,knack to:1,optimizing specifically:1,given operating:1,operating system…but:1,system…but it’s:1,been learning:1,pursue it:1,it further:1,further In:1,optimization strategies:1,strategies discussed:1,book still:1,still hold:1,just issues:1,issues specific:1,particular operating:1,system that:1,discuss In:1,Cycle-Eaters Part:1,II Under:1,386 differ:1,differ considerably:1,considerably from:1,8088 Nonetheless:1,Nonetheless with:1,exception and:1,cycle-eaters remain:1,remain much:1,386 Next:1,we’ll review:1,review each:1,familiar cycle-eaters:1,cycle-eaters I:1,new member:1,the gang:1,gang the:1,cycle-eater that:1,that vanishes:1,vanishes on:1,externally so:1,Execution Unit/Bus:1,Unit/Bus Interface:1,Unit size:1,size mismatch:1,mismatch that:1,that plagues:1,plagues the:1,eliminated Consequently:1,longer any:1,any need:1,variables at:1,least so:1,as word-sized:1,variables start:1,addresses as:1,shortly On:1,hand access:1,to byte-sized:1,variables still:1,than access:1,variables so:1,use whichever:1,whichever size:1,size suits:1,suits a:1,given task:1,task best:1,best You:1,the elimination:1,also vanish:1,vanish since:1,since on:1,bus That:1,seem all:1,likely given:1,386 have:1,prefetch queues:1,queues than:1,8088 6:1,286 16:1,accesses including:1,including instruction:1,fetches in:1,8088 However:1,doesn’t vanish:1,vanish on:1,thing branching:1,branching instructions:1,instructions still:1,empty the:1,queue so:1,so instruction:1,fetching still:1,still slows:1,slows things:1,after most:1,empty it:1,how big:1,big it:1,Even apart:1,from emptying:1,queue branches:1,branches aren’t:1,aren’t particularly:1,386 at:1,of seven-plus:1,seven-plus cycles:1,apiece Avoid:1,Avoid branching:1,branching whenever:1,branch it:1,can refill:1,refill and:1,there we:1,reason the:1,cycle-eater lives:1,lives on:1,fetched even:1,though instruction:1,8088 All:1,All other:1,things being:1,being equal:1,equal too-slow:1,too-slow instruction:1,fetches 4:1,2 instruction:1,fetched per:1,286 However:1,also typically:1,typically runs:1,286 meaning:1,easily execute:1,fetched unless:1,unless very:1,very high-speed:1,high-speed memory:1,significant reason:1,cycle-eater not:1,only survives:1,survives but:1,but prospers:1,prospers on:1,however lies:1,various memory:1,architectures used:1,386 Due:1,architectures the:1,replaced by:1,new form:1,cycle-eater wait:1,memory System:1,System Wait:1,States The:1,lose relatively:1,cycle-eater when:1,with zero-wait-state:1,memory memory:1,can complete:1,complete memory:1,accesses so:1,needed However:1,However true:1,true zero-wait-state:1,never used:1,processors Why:1,Because memory:1,fairly expensive:1,expensive and:1,expensive Instead:1,Instead computer:1,computer designers:1,designers use:1,use alternative:1,alternative memory:1,that offer:1,offer more:1,the dollar—but:1,dollar—but less:1,performance overall—than:1,overall—than zero-wait-state:1,build zero-wait-state:1,zero-wait-state systems:1,systems for:1,so expensive:1,expensive that:1,rarely done:1,The IBM:1,IBM AT:1,and true:1,true compatibles:1,compatibles use:1,use one-wait-state:1,memory some:1,some AT:1,clones use:1,use zero-wait-state:1,such clones:1,clones are:1,common than:1,than one-wait-state:1,one-wait-state AT:1,systems use:1,memory systems—including:1,systems—including high-speed:1,caches interleaved:1,interleaved memory:1,and static-column:1,static-column RAM—that:1,RAM—that insert:1,insert anywhere:1,about 5:1,5 wait:1,more if:1,if 8:1,or 16-bit:1,memory expansion:1,expansion cards:1,cards are:1,inserted at:1,time depends:1,memory system:1,system it’s:1,386 memory:1,vary greatly:1,one memory:1,another depending:1,on factors:1,what data:1,which interleaved:1,interleaved bank:1,bank and/or:1,and/or RAM:1,RAM column:1,was accessed:1,accessed last:1,last The:1,The many:1,many memory:1,systems in:1,use make:1,for 286/386:1,precision that’s:1,8088 Instead:1,must write:1,runs reasonably:1,the varying:1,varying conditions:1,conditions found:1,the 286/386:1,286/386 arena:1,The wait:1,most accesses:1,computers mean:1,that nearly:1,nearly every:1,system memory—memory:1,memory—memory in:1,the DOS’s:1,DOS’s normal:1,normal 640K:1,640K memory:1,memory area—is:1,area—is slowed:1,down Accesses:1,Accesses in:1,with high-speed:1,caches may:1,be wait-state-free:1,wait-state-free if:1,cache but:1,certainly encounter:1,encounter wait:1,states if:1,cached this:1,phenomenon produces:1,highly variable:1,variable instruction:1,is our:1,first encounter:1,encounter with:1,states we:1,a wait-state:1,wait-state cycle-eater:1,cycle-eater before:1,discussed along:1,other 8088:1,8088 cycle-eaters:1,cycle-eaters way:1,4 System:1,System memory:1,has fewer:1,access than:1,However system:1,also accessed:1,accessed far:1,so system:1,states hurt:1,hurt plenty—and:1,plenty—and the:1,place they:1,they hurt:1,hurt most:1,most is:1,fetching Consider:1,an immediate:1,immediate value:1,long The:1,of fetching:1,fetching 1:1,cycles however:1,one-wait-state architecture:1,AT stretches:1,stretches that:1,Consequently nine:1,nine cycles:1,six instruction:1,that 3:1,memory bringing:1,total memory:1,balance memory:1,access time—especially:1,time—especially instruction:1,instruction prefetching—greatly:1,prefetching—greatly exceeds:1,exceeds execution:1,particular instruction:1,Unit And:1,friend is:1,is unmistakably:1,unmistakably the:1,in rare:1,rare good:1,good form:1,form in:1,example A:1,A 4-to-1:1,4-to-1 ratio:1,to execution:1,a class:1,class with:1,best or:1,or worst:1,worst that’s:1,that’s found:1,found on:1,8088 Let’s:1,Let’s check:1,11.1 times:1,a one-wait-state:1,one-wait-state 10:1,clone the:1,computer used:1,all tests:1,11.1 runs:1,1.27 µs:1,instruction That’s:1,That’s 12.7:1,12.7 cycles:1,we calculated:1,calculated That:1,That extra:1,shortly What:1,this mean:1,mean It:1,that practically:1,286 as:1,AT doesn’t:1,bus From:1,AT has:1,bus a:1,a 10.7-bit:1,10.7-bit bus:1,bus since:1,since every:1,every bus:1,AT takes:1,takes 50:1,should A:1,A 286:1,286 running:1,at 10:1,MHz should:1,every 200:1,200 ns:1,ns in:1,AT however:1,every 300:1,300 ns:1,ns by:1,short a:1,our old:1,old friend:1,friend the:1,bus cycle-eater—the:1,cycle-eater—the system:1,state cycle-eater—haunts:1,cycle-eater—haunts us:1,us still:1,but zero-wait-state:1,zero-wait-state 286:1,alive and:1,general wait:1,another variant:1,variant While:1,instructions much:1,The picture:1,less clear:1,386 world:1,world since:1,architectures but:1,but similar:1,similar problems:1,computer built:1,a factor—albeit:1,factor—albeit a:1,lesser one—on:1,one—on zero-wait-state:1,zero-wait-state machines:1,machines both:1,because branching:1,branching empties:1,empties the:1,can outrun:1,outrun even:1,even zero—5:1,zero—5 cycles:1,time To:1,summarize Memory-accessing:1,Memory-accessing instructions:1,don’t run:1,official speeds:1,on non-zero-wait-state:1,non-zero-wait-state 286/386:1,cycle-eater reduces:1,reduces performance:1,computers particularly:1,when non-zero-wait-state:1,non-zero-wait-state memory:1,used Branches:1,Branches often:1,often execute:1,their rated:1,rated speeds:1,is emptied:1,emptied The:1,states affect:1,performance varies:1,one 286/386:1,286/386 computer:1,another making:1,making precise:1,precise optimization:1,optimization impossible:1,impossible What’s:1,this Several:1,Several things:1,things Keep:1,short Keep:1,Keep it:1,registers avoid:1,since memory:1,generally can’t:1,processor Don’t:1,Don’t jump:1,jump Of:1,that apply:1,optimization as:1,well Isn’t:1,Isn’t it:1,it convenient:1,convenient that:1,rules apply:1,apply across:1,board Data:1,Data Alignment:1,Alignment Thanks:1,its 16-bit:1,bus the:1,access word-sized:1,variables just:1,as byte-sized:1,variables There’s:1,catch however:1,however That’s:1,That’s only:1,addresses When:1,is asked:1,performs two:1,separate accesses:1,which fetches:1,fetches 1:1,8088 does:1,does for:1,accesses Figure:1,11.1 illustrates:1,phenomenon The:1,addresses into:1,into double:1,double byte-sized:1,accesses is:1,is transparent:1,to memory-accessing:1,instruction knows:1,knows is:1,the requested:1,requested word:1,word has:1,been accessed:1,accessed no:1,matter whether:1,whether 1:1,access or:1,accesses were:1,accomplish it:1,The penalty:1,calculate Two:1,Two accesses:1,effective capacity:1,286’s external:1,is halved:1,halved when:1,performed That:1,cycle-eater the:1,it behaves:1,behaves differently—occurring:1,differently—occurring only:1,at odd:1,odd addresses—and:1,addresses—and is:1,is avoided:1,avoided with:1,different workaround:1,workaround we’ll:1,consider it:1,is straightforward:1,straightforward Don’t:1,Don’t perform:1,perform word-sized:1,addresses on:1,286 if:1,the directive:1,directive EVEN:1,EVEN before:1,variables EVEN:1,EVEN forces:1,byte assembled:1,assembled to:1,even by:1,NOP if:1,current offset:1,offset is:1,odd consequently:1,consequently you:1,can ensure:1,any word-sized:1,word-sized variable:1,variable can:1,accessed efficiently:1,by preceding:1,preceding it:1,with EVEN:1,EVEN Listing:1,11.2 which:1,word starting:1,address runs:1,clone in:1,1.27 ms:1,or 0.64:1,That’s 6-plus:1,6-plus cycles:1,breaks down:1,separate memory:1,memory accesses—3:1,accesses—3 cycles:1,word the:1,the inevitable:1,inevitable result:1,of non-word-aligned:1,non-word-aligned word-sized:1,memory accesses—plus:1,accesses—plus a:1,bit extra:1,extra for:1,for DRAM:1,refresh On:1,hand Listing:1,Listing 11.3:1,11.3 which:1,11.2 save:1,word-aligned start:1,addresses runs:1,or 0.32:1,0.32 µs:1,That’s 3:1,word-sized access—exactly:1,access—exactly twice:1,the non-word-aligned:1,non-word-aligned accesses:1,11.2 just:1,we predicted:1,predicted LISTING:1,LISTING 11.3:1,11.3 L11-3.ASM:1,L11-3.ASM The:1,cycle-eater has:1,up 286/386:1,286/386 code:1,The expenditure:1,expenditure of:1,little care:1,care and:1,word-aligned can:1,can literally:1,literally double:1,of certain:1,certain code:1,286 Even:1,doesn’t double:1,performance word:1,alignment usually:1,usually helps:1,helps and:1,hurts Code:1,Code Alignment:1,Alignment Lack:1,alignment can:1,also interfere:1,fetching on:1,286 although:1,it interferes:1,with access:1,variables The:1,286 prefetches:1,prefetches instructions:1,doesn’t begin:1,begin at:1,even address:1,simply fetches:1,it fetches:1,11.2 then:1,then separates:1,separates the:1,internally That:1,cases instructions:1,instructions run:1,fast whether:1,they’re word-aligned:1,word-aligned or:1,a non-word-alignment:1,non-word-alignment penalty:1,on branches:1,branches to:1,addresses On:1,fetch 1:1,1 useful:1,useful byte:1,fetch following:1,branch as:1,11.3 In:1,words lack:1,any branch:1,branch effectively:1,effectively cuts:1,the instruction-fetching:1,instruction-fetching power:1,fetch after:1,that branch:1,branch While:1,much you’d:1,to tight:1,brief story:1,was developing:1,timer I:1,used my:1,my trusty:1,trusty 10:1,verify the:1,basic functionality:1,timer by:1,by measuring:1,sequences I:1,was cruising:1,cruising along:1,no problems:1,problems until:1,branch Figure:1,branch Now:1,Now this:1,say about:1,most Instead:1,over 14:1,loop an:1,not explain:1,way After:1,After rolling:1,rolling it:1,it around:1,a debugger…and:1,debugger…and the:1,answer leaped:1,leaped out:1,loop began:1,began at:1,address That:1,That meant:1,fetches were:1,required each:1,the opcode:1,opcode byte:1,one word-aligned:1,the displacement:1,next word-aligned:1,word One:1,One simple:1,simple change:1,change brought:1,time down:1,reasonable 12.5:1,12.5 cycles:1,loop While:1,While word-aligning:1,word-aligning branch:1,destinations can:1,improve branching:1,branching performance:1,nuisance and:1,can increase:1,increase code:1,size a:1,deal so:1,doing in:1,code Besides:1,Besides EVEN:1,EVEN inserts:1,inserts a:1,NOP instruction:1,instruction if:1,NOP can:1,sometimes cancel:1,cancel the:1,a word-aligned:1,word-aligned branch:1,branch destination:1,destination Consequently:1,word-align only:1,those branch:1,destinations that:1,reached solely:1,solely by:1,branching I:1,word-align the:1,start offsets:1,offsets of:1,subroutines as:1,simple practice:1,practice is:1,code alignment:1,that consistently:1,consistently provides:1,for bytes:1,effort expended:1,expended although:1,although sometimes:1,also pays:1,word-align tight:1,tight time-critical:1,time-critical loops:1,loops Alignment:1,discussed alignment:1,alignment as:1,it pertains:1,pertains to:1,286 What:1,ask of:1,386 adds:1,of doubleword:1,is alignment:1,to addresses:1,four The:1,is Word-sized:1,Word-sized memory:1,word-aligned it’s:1,for word-aligned:1,word-aligned word-sized:1,cross doubleword:1,doubleword boundaries:1,and doubleword-sized:1,be doubleword-aligned:1,doubleword-aligned However:1,real as:1,to 32-bit:1,mode doubleword-sized:1,are rare:1,rare so:1,simple word-alignment:1,rule we’ve:1,serves for:1,well As:1,code alignment…the:1,alignment…the subroutine-start:1,subroutine-start word-alignment:1,serves reasonably:1,well there:1,too since:1,avoids the:1,fetched on:1,on entry:1,subroutine While:1,While optimum:1,optimum performance:1,dictate doubleword:1,of subroutines:1,high price:1,the post:1,post 286:1,286 processors:1,processors Alignment:1,the Stack:1,Stack One:1,One side-effect:1,side-effect of:1,never allow:1,become odd:1,odd You:1,pointer odd:1,odd by:1,adding an:1,subtracting an:1,value An:1,An odd:1,odd stack:1,pointer on:1,a non-doubleword-aligned:1,non-doubleword-aligned stack:1,will significantly:1,POP CALL:1,CALL and:1,RET as:1,as INT:1,INT and:1,and IRET:1,executed to:1,to invoke:1,invoke DOS:1,functions handle:1,handle keystrokes:1,keystrokes and:1,and incoming:1,incoming serial:1,serial characters:1,manage the:1,mouse I:1,a Forth:1,Forth programmer:1,who vastly:1,application on:1,AT simply:1,by forcing:1,the Forth:1,Forth interpreter:1,interpreter to:1,even stack:1,pointer at:1,times An:1,interesting corollary:1,shouldn’t INC:1,INC SP:1,SP twice:1,twice to:1,add 2:1,2 even:1,takes fewer:1,ADD SP2:1,SP2 The:1,The stack:1,odd between:1,second INC:1,INC so:1,any interrupt:1,interrupt occurring:1,occurring between:1,be serviced:1,serviced more:1,would The:1,same goes:1,for decrementing:1,decrementing twice:1,twice use:1,use SUB:1,SUB SP2:1,SP2 instead:1,instead Keep:1,Keep the:1,pointer aligned:1,aligned at:1,Cycle-Eater Still:1,Still an:1,an Act:1,Act of:1,God The:1,cycle-eater that’s:1,that’s least:1,least changed:1,its 8088:1,8088 form:1,form on:1,AT DRAM:1,refresh uses:1,little over:1,over five:1,five percent:1,accesses slightly:1,slightly less:1,uses in:1,same ballpark:1,ballpark While:1,refresh penalty:1,penalty varies:1,varies somewhat:1,somewhat on:1,on various:1,various AT:1,around static:1,no refresh:1,refresh at:1,all likewise:1,likewise caches:1,of static:1,so cached:1,cached systems:1,systems generally:1,generally suffer:1,less from:1,the 5:1,percent figure:1,figure is:1,good rule:1,thumb Basically:1,PC-compatible world:1,world fairly:1,small so:1,doesn’t greatly:1,greatly affect:1,performance unavoidable:1,unavoidable so:1,in worrying:1,it anyway:1,it results:1,in fractional:1,counts when:1,timer Just:1,Just as:1,PC a:1,sequence on:1,at varying:1,varying speeds:1,speeds at:1,different times:1,refresh There’s:1,nothing much:1,much new:1,new with:1,computers then:1,then Be:1,don’t overly:1,overly concern:1,concern yourself—DRAM:1,yourself—DRAM refresh:1,God and:1,it Happily:1,caches of:1,Pentium make:1,make DRAM:1,refresh largely:1,performance non-issue:1,non-issue on:1,Cycle-Eater Finally:1,cycle-eaters the:1,cycle-eater There:1,computers 1:1,1 It’s:1,It’s much:1,PC Either:1,extremely bad:1,bad news:1,news on:1,those systems:1,systems is:1,largely responsible:1,the popularity:1,popularity of:1,of VESA:1,VESA local:1,bus VLB:1,VLB The:1,actually the:1,same As:1,earlier discussion:1,4 display:1,adapters offer:1,offer only:1,making use:1,most but:1,those slots:1,slots with:1,MOVSW so:1,accesses allowed:1,allowed by:1,reasonably well-matched:1,an 8088’s:1,8088’s memory:1,speed Granted:1,Granted access:1,VGA slows:1,slows the:1,8088 down:1,down considerably—but:1,considerably—but as:1,out considerably:1,considerably is:1,a relative:1,relative term:1,term What:1,PC performance:1,nothing compared:1,computers Under:1,Under ideal:1,ideal conditions:1,conditions a:1,8088 A:1,A 10:1,of system:1,memory every:1,every 0.20:1,0.20 ms:1,MOVSW dwarfing:1,dwarfing the:1,every 1.31:1,1.31 µs:1,µs that:1,manage However:1,However access:1,but ideal:1,thing most:1,are 8-bit:1,devices although:1,although newer:1,newer adapters:1,16-bit in:1,in nature:1,nature One:1,One consequence:1,or written:1,written per:1,memory word-sized:1,devices are:1,into 2:1,2 separate:1,bus Another:1,Another consequence:1,consequence is:1,simply slower:1,slower the:1,bus inserts:1,inserts additional:1,additional wait:1,devices since:1,must assume:1,such devices:1,devices were:1,PCs and:1,run reliably:1,reliably at:1,at AT:1,AT speeds:1,speeds However:1,8-bit size:1,adapters is:1,factors that:1,memory Far:1,Far more:1,are eaten:1,eaten by:1,inherent memory-access:1,memory-access limitations:1,display adapters—that:1,adapters—that is:1,accesses that:1,adapters make:1,make available:1,286 Look:1,If REP:1,MOVSW on:1,available accesses:1,faster can:1,can code:1,386 possibly:1,possibly run:1,run when:1,That’s right—less:1,right—less than:1,words instructions:1,memory won’t:1,PCs That:1,That explains:1,explains one:1,two viewpoints:1,viewpoints expressed:1,expressed at:1,section The:1,on high-end:1,high-end computers:1,allows instructions:1,computers Of:1,different when:1,instructions Instructions:1,memory receive:1,receive many:1,states when:1,8088 Why:1,Why While:1,8088 we’ve:1,the frequency:1,determined not:1,by processor:1,processor speed:1,adapter itself:1,itself As:1,result both:1,actually allowed:1,allowed just:1,same maximum:1,By definition:1,definition then:1,286 must:1,spend many:1,cycles waiting:1,waiting than:1,that explains:1,explains the:1,second viewpoint:1,viewpoint expressed:1,expressed above:1,above regarding:1,regarding the:1,cycle-eater vis-a-vis:1,vis-a-vis the:1,in cycles:1,cycles lost:1,indeed much:1,worse on:1,on AT-class:1,AT-class computers:1,powerful computers:1,computers How:1,How bad:1,AT It’s:1,It’s this:1,this bad:1,bad Based:1,my not:1,not inconsiderable:1,inconsiderable experience:1,in timing:1,timing display:1,adapter access:1,access I’ve:1,slow an:1,an AT—or:1,AT—or even:1,386 computer—to:1,computer—to near-PC:1,near-PC speeds:1,speeds when:1,accessed I:1,know that’s:1,that’s hard:1,believe but:1,cycle-eater gives:1,gives out:1,out just:1,more no:1,is In:1,faster the:1,cycle-eater hurts:1,hurts the:1,only still:1,in 286/386:1,computers it’s:1,ever What:1,new more:1,more virulent:1,virulent form:1,The workaround:1,PC Access:1,Access display:1,can New:1,386 offer:1,offer a:1,small number:1,8088 lacks:1,lacks while:1,has those:1,more along:1,sizes We’ll:1,386 separately:1,instructions designed:1,protected-mode operations:1,operations As:1,said we’re:1,case protected-mode:1,protected-mode instructions:1,by operating:1,systems I:1,286’s protected:1,mode brings:1,address 16:1,16 MB:1,considerable improvement:1,8088’s 1:1,MB In:1,however programs:1,286 In:1,In either:1,either mode:1,64K There:1,a handful:1,handful of:1,of 286-specific:1,286-specific real-mode:1,useful BOUND:1,BOUND checks:1,checks array:1,array bounds:1,bounds ENTER:1,ENTER and:1,and LEAVE:1,LEAVE support:1,support compact:1,and speedy:1,speedy stack:1,frame construction:1,construction and:1,and removal:1,removal ideal:1,for interfacing:1,interfacing to:1,languages such:1,as C:1,Pascal although:1,although these:1,successors and:1,with caution:1,caution when:1,matters INS:1,INS and:1,and OUTS:1,OUTS are:1,are new:1,new string:1,that support:1,support efficient:1,efficient data:1,data transfer:1,transfer between:1,Finally PUSHA:1,PUSHA and:1,and POPA:1,POPA push:1,push and:1,pop all:1,eight general-purpose:1,registers A:1,old instructions:1,instructions gain:1,gain new:1,features on:1,286 version:1,PUSH is:1,of pushing:1,constant on:1,stack For:1,286 allows:1,allows all:1,all shifts:1,rotates to:1,CL but:1,constant number:1,bits New:1,286 regarding:1,regarding new:1,features Once:1,which on:1,386 comes:1,address up:1,terabytes in:1,all In:1,virtual-86 mode:1,to multitask:1,multitask MS-DOS:1,MS-DOS applications:1,as MS-DOS:1,concerned programs:1,many new:1,as new:1,new registers:1,registers addressing:1,sizes that:1,have trickled:1,trickled down:1,from protected:1,mode Let’s:1,at these:1,real-mode features:1,features Even:1,Even in:1,access many:1,and extended:1,extended registers:1,registers Most:1,simply 32-bit:1,32-bit extensions:1,extensions of:1,8088 For:1,example EAX:1,containing AX:1,bits EBX:1,containing BX:1,BX as:1,on There:1,also two:1,new segment:1,registers FS:1,FS and:1,and GS:1,GS The:1,also comes:1,instructions beyond:1,beyond those:1,those supported:1,286 These:1,scan data:1,basis set:1,specified bit:1,bit sign-extend:1,sign-extend or:1,or zero-extend:1,zero-extend data:1,moved set:1,or memory:1,conditions that:1,with conditional:1,more Again:1,Again beware:1,beware Many:1,complex 386-specific:1,386-specific instructions:1,equivalent sequences:1,Pentium What’s:1,more both:1,both old:1,instructions support:1,32-bit operations:1,operations on:1,example it’s:1,it’s relatively:1,386 even:1,the MOVSD:1,MOVSD move:1,move string:1,string double:1,double instruction:1,to negate:1,negate a:1,with NEG:1,NEG eax:1,eax Finally:1,32-bit general-purpose:1,memory What’s:1,more multiplication:1,memory-addressing registers:1,for look-ups:1,look-ups in:1,word doubleword:1,doubleword or:1,or quadword:1,quadword tables:1,The 32-bit:1,modes are:1,are discussed:1,discussed further:1,mode these:1,modes allow:1,mode you’re:1,64K even:1,modes unless:1,you play:1,play some:1,unorthodox tricks:1,tricks with:1,registers Note:1,well Those:1,Those tricks:1,tricks don’t:1,necessarily work:1,system software:1,software such:1,Windows so:1,recommend against:1,them If:1,want 4-gigabyte:1,4-gigabyte segments:1,segments use:1,32-bit environment:1,as Win32:1,Win32 Optimization:1,The More:1,More Things:1,Things Change:1,Change Let’s:1,about 286/386:1,286/386 optimization:1,optimization Mostly:1,Mostly what:1,learned is:1,familiar PC:1,PC cycle-eaters:1,cycle-eaters still:1,still apply:1,apply although:1,in somewhat:1,somewhat different:1,forms and:1,major optimization:1,PC hold:1,and 386-based:1,386-based computers:1,You won’t:1,go wrong:1,wrong on:1,these computers:1,computers if:1,registers heavily:1,heavily and:1,memory don’t:1,avoid accessing:1,plague Although:1,them repeated:1,still desirable:1,desirable on:1,they provide:1,functionality per:1,branching However:1,However string:1,so spectacularly:1,spectacularly superior:1,superior on:1,8088 since:1,since non-string:1,non-string memory-accessing:1,been speeded:1,up considerably:1,considerably on:1,processors There’s:1,cycle-eater with:1,new implications:1,implications on:1,cycle-eater From:1,new rule:1,rule Word-align:1,Word-align your:1,start your:1,subroutines at:1,addresses Detailed:1,Detailed Optimization:1,Optimization While:1,major 8088:1,rules hold:1,386 many:1,the instruction-specific:1,instruction-specific optimizations:1,optimizations no:1,longer hold:1,most instructions:1,different on:1,8088 We:1,such example:1,the sometimes:1,sometimes vast:1,between 8088:1,and 286/386:1,286/386 instruction:1,an EU:1,of virtually:1,all memory-accessing:1,instructions has:1,been improved:1,improved enormously:1,enormously on:1,this improvement:1,near elimination:1,of effective:1,address EA:1,time Where:1,Where an:1,from 5:1,calculate an:1,an EA:1,EA a:1,386 usually:1,usually takes:1,time whatsoever:1,whatsoever to:1,calculation If:1,index displacement:1,displacement addressing:1,AX WordArray:1,WordArray bx:1,si is:1,386 1:1,the EA:1,calculation but:1,any EA:1,EA overhead:1,overhead at:1,The elimination:1,of EA:1,time means:1,much closer:1,of register-only:1,instance on:1,8088 ADD:1,a 31-cycle:1,31-cycle instruction:1,4-cycle instruction—a:1,nearly 8:1,contrast on:1,286 ADD:1,a 7-cycle:1,7-cycle instruction:1,3-cycle instruction—a:1,just 2.3:1,2.3 to:1,1 It:1,seem then:1,less necessary:1,registers on:1,that’s simply:1,reasons we’ve:1,seen The:1,execute memory-addressing:1,no spare:1,spare instruction:1,prefetching time:1,queue runs:1,runs dry:1,dry especially:1,AT with:1,its one-wait-state:1,memory On:1,AT the:1,the 6-byte:1,is effectively:1,effectively at:1,a 15-cycle:1,15-cycle instruction:1,because 3:1,fetch each:1,three instruction:1,instruction words:1,read WordVar:1,WordVar and:1,memory Granted:1,Granted the:1,register-only instruction:1,DX100H also:1,also slows:1,slows down—to:1,down—to 6:1,6 cycles—because:1,cycles—because of:1,prefetching leaving:1,leaving a:1,however let’s:1,The register-only:1,cycles 4:1,byte while:1,memory-accessing code:1,in 40:1,cycles 6:1,2 word-sized:1,accesses at:1,word That’s:1,1 exactly:1,286 This:1,all theoretical:1,theoretical We:1,We put:1,our trust:1,trust not:1,in theory:1,theory but:1,let’s run:1,code through:1,timer On:1,PC Listing:1,11.4 which:1,performs register-only:1,register-only addition:1,addition runs:1,in 3.62:1,3.62 ms:1,11.5 which:1,performs addition:1,variable runs:1,in 10.05:1,10.05 ms:1,ms On:1,clone Listing:1,11.4 runs:1,11.5 runs:1,in 1.80:1,1.80 ms:1,ms Obviously:1,AT is:1,much faster…but:1,faster…but the:1,11.5 to:1,11.4 is:1,identical on:1,both computers:1,at 2.78:1,2.78 for:1,and 2.81:1,2.81 for:1,AT If:1,If anything:1,register-only form:1,ADD has:1,larger advantage:1,advantage on:1,AT than:1,does on:1,case Theory:1,Theory confirmed:1,confirmed What’s:1,What’s going:1,on Simply:1,Simply this:1,this Instruction:1,Instruction fetching:1,controlling overall:1,processors Both:1,Listings 11.4:1,11.4 and:1,and 11.5:1,11.5 faster:1,fetched Since:1,lengths on:1,processors it:1,processors as:1,well Instruction:1,Instruction length:1,length controls:1,controls execution:1,instruction lengths:1,the same—therefore:1,same—therefore the:1,ratios of:1,can both:1,both fetch:1,execute instruction:1,bytes faster:1,can so:1,executes much:1,286 nonetheless:1,nonetheless because:1,also execute:1,those instruction:1,them overall:1,still largely:1,largely determined:1,instructions Is:1,Is this:1,this always:1,case No:1,No When:1,full memory-accessing:1,to register-only:1,8088 Given:1,system wait:1,states prevalent:1,prevalent on:1,on 286:1,computers however:1,empty quite:1,bit especially:1,with short:1,short EU:1,times is:1,executed Of:1,code we’re:1,we’re likely:1,we’re optimizing:1,optimizing so:1,high-speed code:1,be controlled:1,size than:1,by EU:1,most 286:1,computers just:1,PC All:1,faster memory:1,and EA:1,calculation notwithstanding:1,notwithstanding it’s:1,as desirable:1,keep instructions:1,minimum on:1,use string:1,short forms:1,like The:1,more things:1,they remain:1,same POPF:1,286 We’ve:1,We’ve one:1,one final:1,final 286-related:1,286-related item:1,item to:1,hardware malfunction:1,malfunction of:1,POPF under:1,under certain:1,circumstances on:1,this Sometimes:1,Sometimes POPF:1,POPF permits:1,permits interrupts:1,are initially:1,initially off:1,setting popped:1,flag from:1,stack keeps:1,keeps interrupts:1,words an:1,interrupt can:1,happen even:1,never set:1,Now I:1,to blow:1,blow this:1,particular bug:1,bug out:1,of proportion:1,proportion It:1,It only:1,only causes:1,causes problems:1,cannot tolerate:1,interrupts under:1,under any:1,any circumstances:1,rare sort:1,code especially:1,in user:1,user programs:1,programs However:1,However some:1,does need:1,interrupts absolutely:1,absolutely disabled:1,disabled with:1,interrupt sneaking:1,sneaking through:1,through For:1,BIOS might:1,retrieve data:1,disk controller:1,controller the:1,instant it:1,available even:1,hundred microseconds:1,microseconds of:1,of delay:1,delay could:1,a sector’s:1,sector’s worth:1,data misread:1,misread In:1,case one:1,one misplaced:1,misplaced interrupt:1,interrupt during:1,a POPF:1,POPF could:1,a trashed:1,trashed hard:1,that interrupt:1,interrupt occurs:1,occurs while:1,a sector:1,sector of:1,the File:1,File Allocation:1,Allocation Table:1,Table There:1,a workaround:1,bug While:1,use it’s:1,it’s considerably:1,won’t want:1,interrupts On:1,that truly:1,truly cannot:1,interrupted you:1,should view:1,cheap insurance:1,insurance against:1,against mysterious:1,mysterious and:1,and erratic:1,erratic program:1,program crashes:1,crashes One:1,obvious reason:1,useful Another:1,of Zen-level:1,Zen-level assembly:1,assembly coding:1,a well-defined:1,well-defined goal:1,goal to:1,achieved but:1,no obvious:1,The goal:1,reproduce the:1,POPF instruction:1,instruction without:1,using POPF:1,by asking:1,asking exactly:1,what POPF:1,does All:1,All POPF:1,is pop:1,stack into:1,11.4 How:1,without POPF:1,POPF Of:1,286’s designers:1,designers intended:1,intended us:1,use POPF:1,POPF for:1,purpose and:1,didn’t intentionally:1,intentionally provide:1,any alternative:1,devise an:1,search for:1,contain some:1,as POPF:1,POPF in:1,the hope:1,replace POPF:1,POPF Well:1,Well there’s:1,POPF that:1,that loads:1,register directly:1,that’s IRET:1,which loads:1,it branches:1,11.5 iret:1,iret has:1,no known:1,known bugs:1,bugs of:1,that plague:1,plague POPF:1,a candidate:1,candidate to:1,replace popf:1,popf in:1,in non-interruptible:1,non-interruptible applications:1,applications Unfortunately:1,Unfortunately IRET:1,IRET loads:1,third word:1,down on:1,stack not:1,with POPF:1,POPF the:1,far return:1,IRET pops:1,pops into:1,into CSIP:1,CSIP lies:1,word popped:1,register Obviously:1,segmentoffset that:1,IRET expects:1,stack above:1,flags isn’t:1,present when:1,stack is:1,stack a:1,bit before:1,can substitute:1,substitute IRET:1,IRET for:1,POPF What:1,What we’ll:1,is push:1,after our:1,our workaround:1,code onto:1,stack right:1,right above:1,flags IRET:1,IRET will:1,will then:1,flags ending:1,ending up:1,flags popped:1,popped That’s:1,result that:1,have occurred:1,occurred had:1,had we:1,we executed:1,executed POPF:1,POPF WITH:1,WITH the:1,the bonus:1,no interrupts:1,can accidentally:1,accidentally occur:1,0 both:1,both before:1,pop Figure:1,POPF Figure:1,POPF How:1,we push:1,instruction Well:1,Well finding:1,a tried-and-true:1,tried-and-true trick:1,trick We:1,similar here:1,call since:1,since IRET:1,IRET requires:1,offset We’ll:1,also branch:1,branch backward:1,backward so:1,address pushed:1,pushed on:1,stack will:1,will point:1,instruction we:1,to continue:1,IRET Figure:1,IRET The:1,11.6 The:1,The POPF:1,workaround can:1,implemented as:1,macro we:1,also emulate:1,emulate a:1,call by:1,by pushing:1,pushing CS:1,CS and:1,call thereby:1,thereby shrinking:1,byte By:1,flags can:1,be popped:1,popped much:1,alter a:1,process For:1,following macro:1,macro emulates:1,emulates POPF:1,POPF with:1,branch but:1,but wipes:1,wipes out:1,out AX:1,AX It’s:1,perfect substitute:1,POPF since:1,since POPF:1,POPF doesn’t:1,doesn’t alter:1,than EMULATE_POPF:1,EMULATE_POPF when:1,can spare:1,using 286-specific:1,is shorter:1,shorter still:1,still alters:1,alters no:1,no registers:1,branches just:1,once Of:1,EMULATE_POPF won’t:1,bug Figure:1,bug The:1,standard version:1,EMULATE_POPF is:1,bytes longer:1,slower as:1,three branches:1,branches Anyone:1,Anyone in:1,in his/her:1,his/her right:1,right mind:1,mind would:1,would prefer:1,prefer POPF:1,POPF to:1,slower three-branch:1,three-branch macro—given:1,macro—given a:1,choice In:1,In noncode:1,noncode however:1,choice here:1,the safer—if:1,safer—if slower—approach:1,slower—approach is:1,best Having:1,Having people:1,people associate:1,associate your:1,with crashed:1,crashed computers:1,computers is:1,desirable situation:1,situation no:1,how unfair:1,unfair the:1,circumstances under:1,it occurs:1,occurs And:1,of and:1,bug Whether:1,Whether you:1,ever need:1,workaround or:1,a neatly:1,neatly packaged:1,packaged example:1,tremendous flexibility:1,set Chapter:1,12 Pushing:1,486 It’s:1,It’s Not:1,Not Just:1,Just a:1,a Bigger:1,Bigger 386:1,So this:1,this traveling:1,traveling salesman:1,salesman is:1,is walking:1,walking down:1,a road:1,he sees:1,sees a:1,of men:1,men digging:1,digging a:1,a ditch:1,ditch with:1,their bare:1,bare hands:1,hands Whoa:1,Whoa there:1,there he:1,he says:1,says What:1,guys need:1,Model 8088:1,8088 ditch:1,ditch digger:1,digger And:1,And he:1,he whips:1,whips out:1,a trowel:1,and sells:1,sells it:1,stops back:1,around They’re:1,They’re happy:1,trowel but:1,he sells:1,sells them:1,latest ditch-digging:1,ditch-digging technology:1,technology the:1,Model 80286:1,80286 spade:1,spade That:1,That keeps:1,keeps them:1,them content:1,content until:1,stops by:1,Model 80386:1,shovel a:1,full 32:1,32 inches:1,inches wide:1,wide with:1,narrow point:1,that holds:1,holds them:1,them until:1,he comes:1,comes back:1,Model 80486:1,80486 bulldozer:1,bulldozer Having:1,Having reached:1,salesman doesn’t:1,doesn’t pay:1,pay them:1,call for:1,while When:1,he does:1,only are:1,they none:1,none too:1,too friendly:1,friendly but:1,they’re digging:1,the 80386:1,bulldozer is:1,is sitting:1,sitting off:1,side Why:1,earth are:1,you using:1,using that:1,that shovel:1,salesman asks:1,asks Why:1,Why aren’t:1,you digging:1,bulldozer Well:1,Well Lord:1,knows we:1,tried says:1,says the:1,the foreman:1,foreman but:1,to lift:1,lift the:1,the damn:1,damn thing:1,thing Substitute:1,Substitute processor:1,processor for:1,various digging:1,digging implements:1,implements and:1,486 are:1,are from:1,to Okay:1,Okay it’s:1,that bad—but:1,bad—but upon:1,upon encountering:1,encountering a:1,where string:1,often to:1,avoided and:1,and memory-to-register:1,memory-to-register MOV:1,are frequently:1,as register-to-register:1,register-to-register MOV:1,s Dorothy:1,Dorothy was:1,was heard:1,heard to:1,to exclaim:1,exclaim before:1,before she:1,she sank:1,sank out:1,sight in:1,a swirl:1,swirl of:1,of hopelessly:1,hopelessly mixed:1,mixed metaphors:1,metaphors I:1,think we’re:1,Kansas anymore:1,anymore Toto:1,Toto Enter:1,486 No:1,No chip:1,direct fully:1,fully compatible:1,compatible descendant:1,descendant of:1,8088 286:1,386 could:1,a RISC:1,486 certainly:1,certainly contains:1,contains RISC:1,RISC elements:1,elements and:1,it’s those:1,those elements:1,elements that:1,most responsible:1,making 486:1,optimization unique:1,unique Simple:1,Simple common:1,common instructions:1,a RISC-like:1,RISC-like core:1,core processor:1,executed pretty:1,386 where:1,where every:1,every instruction:1,least 2:1,cycles For:1,AL TestChar:1,TestChar takes:1,486 assuming:1,assuming both:1,the cache—3:1,cache—3 cycles:1,the 386—but:1,386—but STOSB:1,STOSB takes:1,cycles 1:1,The floating-point:1,unit inside:1,also much:1,387 math:1,coprocessor largely:1,because being:1,same silicon:1,silicon as:1,coprocessor built:1,more tightly:1,tightly coupled:1,coupled The:1,sometimes startling:1,startling FMUL:1,FMUL floating:1,point multiply:1,multiply is:1,usually faster:1,IMUL integer:1,multiply An:1,An encyclopedic:1,encyclopedic approach:1,to 486:1,optimization would:1,book all:1,itself so:1,I’m only:1,the highlights:1,highlights of:1,optimization touching:1,on several:1,several optimization:1,rules some:1,some documented:1,documented some:1,some not:1,following sources:1,sources of:1,486 information:1,information i486:1,Manual from:1,Intel 8086:1,8086 Optimization:1,Optimization Aim:1,Aim Down:1,Down the:1,the Middle:1,Middle and:1,and Pray:1,Pray in:1,the March:1,March 1991:1,1991 Dr:1,and Peak:1,Peak Performance:1,Performance On:1,On to:1,the November:1,November 1990:1,1990 Programmer’s:1,Journal Rules:1,Rules to:1,to Optimize:1,Optimize By:1,By In:1,In Appendix:1,Appendix G:1,G of:1,Microprocessor Programmer:1,Programmer s:1,s Reference:1,Manual Intel:1,Intel lists:1,486 While:1,While neither:1,neither exhaustive:1,exhaustive we’ll:1,two undocumented:1,optimizations shortly:1,shortly nor:1,nor entirely:1,entirely accurate:1,accurate we’ll:1,we’ll correct:1,correct two:1,rules here:1,here Intel’s:1,Intel’s list:1,good starting:1,point In:1,list conveys:1,conveys the:1,from optimization:1,earlier x86:1,processors Generally:1,Generally I’ll:1,be discussing:1,discussing optimization:1,used mode:1,moment although:1,although many:1,rules should:1,should apply:1,well 486:1,generally more:1,precise and:1,less frustrating:1,frustrating than:1,than optimization:1,every 486:1,an identical:1,identical internal:1,cache Whenever:1,cache those:1,and calculatable:1,calculatable number:1,all 486s:1,486s with:1,little chance:1,for cached:1,cached code:1,which time-critical:1,code almost:1,always is:1,is performance:1,is predictable:1,predictable and:1,good precision:1,those calculations:1,will apply:1,apply on:1,any 486:1,However predictable:1,predictable doesn’t:1,mean trivial:1,trivial the:1,times printed:1,printed for:1,whole story:1,story You:1,rules documented:1,documented and:1,and undocumented:1,undocumented that:1,into calculating:1,calculating actual:1,execution times—and:1,times—and uncovering:1,uncovering some:1,of Indexed:1,Indexed Addressing:1,Addressing Rule:1,1 Avoid:1,Avoid indexed:1,or scaled:1,Intel cautions:1,cautions against:1,using indexing:1,indexing to:1,for indexed:1,addressing True:1,True enough—but:1,enough—but indexed:1,addressing might:1,mean what:1,expect Traditionally:1,Traditionally SI:1,DI are:1,considered the:1,x86 CPUs:1,CPUs That:1,which indexed:1,is meant:1,meant here:1,here however:1,mode indexed:1,addressing means:1,registers rather:1,none are:1,is base:1,addressing no:1,what register:1,used MOV:1,BX DI:1,CL BP:1,SI 10:1,10 perform:1,perform indexed:1,addressing MOV:1,DL SI:1,not Therefore:1,avoid using:1,using two:1,possible Often:1,Often this:1,this simply:1,simply means:1,together outside:1,loop before:1,before memory:1,actually addressed:1,addressed which:1,which calculates:1,same sum:1,sum and:1,first example:1,but avoids:1,avoids indexed:1,addressing In:1,of indexed:1,EDX EDI:1,EDI still:1,still qualifies:1,qualifies for:1,the one-cycle:1,penalty In:1,of 386/486:1,386/486 scaled:1,MOV ECX*2:1,ECX*2 EAX:1,EAX also:1,also constitutes:1,constitutes indexed:1,addressing even:1,fuss over:1,over one:1,cycle You:1,difference one:1,cycle could:1,make After:1,8088 effective:1,however 1:1,deal because:1,including most:1,most register-only:1,instructions MOV:1,ADD CMP:1,on execute:1,cycle In:1,particular MOV:1,memory execute:1,in 1:1,1 cycle—if:1,cycle—if they’re:1,not hampered:1,hampered by:1,like indexed:1,case they:1,they slow:1,to half:1,speed or:1,worse as:1,shortly For:1,the summing:1,summing example:1,example shown:1,earlier The:1,index BX:1,addressing executes:1,in eight:1,loop As:1,base SI:1,addressing runs:1,runs one:1,at seven:1,seven cycles:1,executes so:1,486 that:1,cycle saved:1,using base:1,whole loop:1,loop more:1,than 14:1,486 1:1,indeed matter:1,matter Calculate:1,Calculate Memory:1,Memory Pointers:1,Pointers Ahead:1,Ahead of:1,of Time:1,Time Rule:1,2 Don’t:1,pointer during:1,after loading:1,it Intel:1,addressing component:1,is imposed:1,imposed This:1,This rule:1,rule unlike:1,unlike anything:1,anything ever:1,before seen:1,family reflects:1,the heavily:1,heavily pipelined:1,pipelined nature:1,486 Apparently:1,486 starts:1,starts each:1,each effective:1,calculation before:1,12.1 this:1,this effectively:1,effectively makes:1,time vanish:1,vanish because:1,happens while:1,executes Of:1,486 can’t:1,calculation for:1,a target:1,instruction ahead:1,address components:1,components isn’t:1,isn’t known:1,known until:1,instruction modifies:1,modifies one:1,target instruction’s:1,instruction’s addressing:1,addressing registers:1,registers For:1,address referenced:1,referenced by:1,by MOV:1,BX until:1,until MOV:1,MemVar finishes:1,finishes so:1,pipelining that:1,that calculation:1,calculation ahead:1,is rearranging:1,rearranging your:1,instruction lies:1,example postdecrementing:1,postdecrementing as:1,following Now:1,Intel means:1,rule let:1,me make:1,important comment:1,comment My:1,My observations:1,observations indicate:1,for real-mode:1,real-mode code:1,documentation understates:1,understates the:1,pipeline by:1,pointer just:1,matter appears:1,mode not:1,lost In:1,In 32-bit:1,Intel Considering:1,Considering that:1,MOV normally:1,total that’s:1,that’s quite:1,a loss:1,loss For:1,the postdecrement:1,postdecrement loop:1,loop shown:1,2 full:1,full cycles:1,the preincrement:1,preincrement loop:1,loop resulting:1,a 29:1,29 percent:1,But wait:1,wait there’s:1,more If:1,loaded 2:1,which generally:1,generally means:1,means 2:1,486 instructions:1,pipelining the:1,2 are:1,always equivalent:1,equivalent before:1,memory 1:1,lost Therefore:1,Therefore whereas:1,whereas this:1,loses no:1,all Apparently:1,486’s addressing:1,addressing calculation:1,pipeline actually:1,starts 2:1,12.2 In:1,truth my:1,best guess:1,guess at:1,moment is:1,pipeline really:1,does start:1,start only:1,cycle ahead:1,additional cycle:1,cycle crops:1,pipeline has:1,file before:1,in addressing:1,calculations However:1,I’m guessing:1,guessing here:1,2-cycle-ahead model:1,12.2 will:1,optimization purposes:1,purposes Clearly:1,Clearly there’s:1,optimization potential:1,in careful:1,pipelining Caveat:1,Caveat Programmor:1,Programmor A:1,A caution:1,caution I’m:1,I’m quite:1,quite certain:1,certain that:1,2-cycle-ahead addressing:1,interruption penalty:1,penalty I’ve:1,described exists:1,exists in:1,486s I’ve:1,tested However:1,Intel won’t:1,won’t change:1,indicates otherwise:1,otherwise Perhaps:1,the 2-cycle:1,2-cycle penalty:1,initial steps:1,steps of:1,will revert:1,documented 1-cycle:1,penalty someday:1,someday likewise:1,optimizations I’ll:1,describe below:1,below Nonetheless:1,Nonetheless none:1,suggest would:1,undocumented performance:1,486 were:1,vanish and:1,they certainly:1,certainly will:1,some 486s:1,486s right:1,now so:1,feel they’re:1,they’re well:1,using There:1,course no:1,I’m entirely:1,correct about:1,optimizations discussed:1,chapter Without:1,Without knowing:1,internals of:1,make inferences:1,inferences from:1,results I:1,I invite:1,invite you:1,deduce your:1,own rules:1,and cross-check:1,cross-check them:1,them against:1,against mine:1,mine Also:1,Also most:1,likely there:1,I’m unaware:1,of If:1,have further:1,these or:1,other undocumented:1,optimizations please:1,please write:1,know And:1,course if:1,anyone from:1,Intel is:1,and wants:1,truth please:1,please do:1,do Stack:1,Stack Addressing:1,Address Pipelining:1,Pipelining Rule:1,Rule 2A:1,2A Rule:1,2 sometimes:1,sometimes but:1,always applies:1,pointer when:1,is implicitly:1,implicitly used:1,an implied:1,implied destination:1,for CALL:1,CALL ENTER:1,ENTER LEAVE:1,LEAVE RET:1,RET PUSH:1,POP which:1,which alter:1,alter E)SP:1,E)SP and:1,implied base:1,for PUSH:1,POP and:1,RET which:1,use E)SP:1,E)SP to:1,Intel then:1,then implies:1,aforementioned addressing:1,incurred whenever:1,destination by:1,first set:1,then immediately:1,immediately used:1,second set:1,This raises:1,raises the:1,the specter:1,specter of:1,of unpleasant:1,unpleasant programming:1,programming contortions:1,contortions such:1,as intermixing:1,intermixing PUSH:1,PUSH es:1,es and:1,POP s:1,s with:1,avoid interrupting:1,pipeline Fortunately:1,Fortunately matters:1,matters are:1,so grim:1,grim as:1,as Intel’s:1,documentation would:1,would indicate:1,indicate my:1,tests indicate:1,penalty pops:1,pops up:1,up only:1,only spottily:1,spottily when:1,example you’d:1,you’d certainly:1,certainly expect:1,to exhibit:1,exhibit the:1,interruption phenomenon:1,phenomenon SP:1,both destination:1,instructions according:1,to Intel:1,Intel but:1,in six:1,per POP/RET:1,POP/RET pair:1,pair matching:1,matching the:1,times exactly:1,exactly Likewise:1,Likewise a:1,like runs:1,should On:1,hand performing:1,performing arithmetic:1,arithmetic directly:1,on SP:1,SP as:1,explicit destination—for:1,destination—for example:1,to deallocate:1,deallocate local:1,local variables—and:1,variables—and then:1,using PUSH:1,RET definitely:1,definitely can:1,can interrupt:1,interrupt the:1,pipeline For:1,example loses:1,because SP:1,implied addressing:1,sequence loses:1,same reason:1,certainly haven’t:1,haven’t tried:1,tried all:1,combinations but:1,results so:1,pointer incurs:1,incurs the:1,penalty only:1,if E)SP:1,E)SP is:1,two following:1,memory So:1,instance SP:1,SP isn’t:1,operand of:1,of POP:1,AX AX:1,AX is—and:1,is—and no:1,lost if:1,if POP:1,by POP:1,RET Happily:1,Happily then:1,not worry:1,use PUSH:1,POP However:1,However adding:1,to moving:1,moving to:1,subtracting from:1,pointer should:1,before PUSH:1,POP RET:1,RET or:1,other instruction:1,memory Problems:1,lose cycles:1,using byte:1,Intel so:1,lesser and:1,and simpler:1,two Rule:1,Rule 3:1,3 Do:1,not load:1,byte portion:1,entirety as:1,instruction So:1,because AL:1,loaded by:1,then AX:1,instruction A:1,A cycle:1,saved simply:1,load isn’t:1,isn’t immediately:1,immediately followed:1,word register:1,usage like:1,so Strange:1,Strange as:1,seem this:1,is neither:1,neither arbitrary:1,arbitrary nor:1,nor nonsensical:1,nonsensical Basically:1,Basically when:1,byte destination:1,word source:1,to directly:1,directly use:1,register required:1,first instruction’s:1,instruction’s result:1,full updated:1,updated register:1,value must:1,value can’t:1,out until:1,file a:1,cycle I’m:1,explain this:1,in great:1,great detail:1,detail because:1,rule exists:1,exists only:1,fact exist:1,exist but:1,interesting window:1,486 works:1,curious there’s:1,typical XLAT:1,XLAT sequence:1,like cb134-1:1,cb134-1 mov:1,mov bxoffset:1,bxoffset MemTable:1,MemTable cb134-2:1,cb134-2 cb134-3:1,cb134-3 mov:1,al si:1,si cb134-4:1,cb134-4 xlat:1,xlat even:1,though AL:1,AL must:1,word by:1,by XLAT:1,XLAT before:1,to BX:1,fact none:1,the penalties:1,penalties mentioned:1,chapter apply:1,to XLAT:1,XLAT apparently:1,apparently because:1,because XLAT:1,so slow—4:1,slow—4 cycles—that:1,cycles—that it:1,486 time:1,perform addressing:1,calculations during:1,nice that:1,XLAT doesn’t:1,doesn’t suffer:1,various 486:1,486 addressing:1,addressing penalties:1,penalties the:1,basically that:1,there’s still:1,still no:1,no compelling:1,compelling reason:1,use XLAT:1,XLAT on:1,general penalties:1,penalties for:1,pipeline apply:1,apply primarily:1,486 most:1,notably register-only:1,MOV although:1,although arithmetic:1,often affected:1,affected I:1,know all:1,performance dependencies:1,dependencies and:1,don’t plan:1,figuring all:1,out would:1,big boring:1,boring job:1,value Basically:1,Basically on:1,should concentrate:1,on using:1,using those:1,rules I’ll:1,discuss do:1,indeed apply:1,understand every:1,486 universe:1,universe unless:1,a diehard:1,diehard ASMhead:1,ASMhead who:1,who does:1,fun Just:1,Just learn:1,learn enough:1,and spend:1,fast design:1,overall implementation:1,implementation More:1,More Fun:1,Fun with:1,Registers Rule:1,4 Don’t:1,Don’t load:1,register exactly:1,This the:1,chapter’s rules:1,the strangest:1,strangest of:1,the lot:1,lot If:1,then two:1,cycles later:1,later any:1,lost So:1,example this:1,four rather:1,execute Note:1,required that:1,register be:1,register will:1,trick Worse:1,still loading:1,loading byte:1,memory costs:1,costs two:1,takes five:1,five rather:1,run However:1,penalty if:1,loaded one:1,cycle but:1,Therefore runs:1,happens Clearly:1,Clearly it:1,has something:1,with interrupting:1,pipeline and:1,have my:1,my theories:1,theories about:1,point they’re:1,they’re pure:1,pure speculation:1,speculation Whatever:1,rule ignorance:1,ignorance of:1,of it—and:1,it—and of:1,other rules—could:1,rules—could lead:1,to considerable:1,considerable performance:1,performance loss:1,loss in:1,seemingly air-tight:1,air-tight code:1,instance a:1,a casual:1,observer would:1,cycles A:1,sophisticated programmer:1,lose one:1,cycle because:1,because BX:1,loaded two:1,fact though:1,though this:1,5 cycles—2:1,cycles—2 cycles:1,normal Why:1,Well under:1,under normal:1,normal conditions:1,conditions loading:1,byte register—CL:1,register—CL in:1,this case—one:1,case—one cycle:1,memory produces:1,penalty loading:1,loading 2:1,ahead is:1,normally incurs:1,penalty However:1,However think:1,as meaning:1,register disrupts:1,disrupts the:1,starts up:1,up Viewed:1,Viewed that:1,MemVar interrupts:1,pipeline forcing:1,start again:1,then presumably:1,presumably MOV:1,MOV CLAL:1,CLAL interrupts:1,pipeline again:1,again because:1,its first:1,can affect:1,affect I:1,I know—it:1,know—it seems:1,seems awfully:1,awfully complicated:1,complicated It:1,really Generally:1,Generally try:1,use byte:1,byte destinations:1,destinations exactly:1,fine Timing:1,Timing Your:1,Your Own:1,Own 486:1,486 Code:1,Code In:1,performance analysis:1,analysis of:1,own let:1,above conclusions:1,conclusions at:1,can warn:1,you of:1,timing hazards:1,cache Listings:1,12.2 show:1,ran through:1,establish the:1,register before:1,memory Listing:1,Listing 12.1:1,12.1 ran:1,in 120:1,120 µs:1,120 µs/1000:1,µs/1000 repetitions:1,repetitions 120:1,per repetition/30:1,repetition/30 ns:1,cycle 4:1,repetition Listing:1,12.2 ran:1,in 90:1,90 µs:1,cycles establishing:1,establishing that:1,register costs:1,cycle only:1,it’s performed:1,performed exactly:1,before addressing:1,addressing memory:1,12.2 each:1,each repeat:1,repeat the:1,under test:1,test a:1,second time:1,which results:1,displayed Also:1,8K in:1,size so:1,can all:1,all fit:1,486’s 8K:1,I double:1,the REPT:1,REPT value:1,12.2 to:1,2000 making:1,code larger:1,8K the:1,time more:1,than doubles:1,doubles to:1,to 224:1,224 µs:1,or 3.7:1,3.7 cycles:1,repetition the:1,fetching non-cached:1,non-cached instruction:1,bytes Whenever:1,see non-integral:1,non-integral timing:1,cached The:1,The Story:1,Story Continues:1,Continues There’s:1,certainly plenty:1,plenty more:1,more 486:1,486 lore:1,lore to:1,explore including:1,486’s unique:1,unique prefetch:1,queue more:1,more optimization:1,rules branching:1,branching optimizations:1,optimizations performance:1,misses for:1,the implications:1,cache write-through:1,write-through for:1,writes Nonetheless:1,Nonetheless we’ve:1,covered quite:1,ground in:1,trust you’ve:1,you’ve gotten:1,gotten a:1,considerable extent:1,to Odd:1,Odd as:1,as 486:1,worth mastering:1,mastering for:1,best so:1,so staggeringly:1,staggeringly fast:1,that carefully:1,crafted 486:1,much per:1,best 386:1,386 code—which:1,code—which makes:1,perhaps 50:1,50 times:1,as optimized:1,original PC:1,PC Sometimes:1,believe we’re:1,Kansas Chapter:1,13 Aiming:1,Aiming the:1,486 Pipelines:1,Pipelines and:1,Other Hazards:1,the High:1,High End:1,End It’s:1,a sad:1,sad but:1,but true:1,true fact:1,that 84:1,84 percent:1,American schoolchildren:1,schoolchildren are:1,are ignorant:1,ignorant of:1,of 92:1,American history:1,history Not:1,Not my:1,daughter though:1,We recently:1,recently visited:1,visited historical:1,historical Revolutionary-War-vintage:1,Revolutionary-War-vintage Fort:1,Fort Ticonderoga:1,Ticonderoga and:1,and she’s:1,she’s now:1,now 97:1,97 percent:1,percent aware:1,our national:1,national heritage:1,heritage that:1,basic uniform:1,uniform for:1,for soldiers:1,soldiers in:1,days was:1,what appears:1,be underwear:1,underwear plus:1,a hat:1,hat so:1,could complain:1,complain that:1,were undermining:1,undermining family:1,family values:1,values Ha:1,Ha Just:1,Just kidding:1,kidding Actually:1,Actually what:1,she learned:1,learned was:1,days it:1,was pure:1,pure coincidence:1,coincidence if:1,a cannonball:1,cannonball actually:1,actually hit:1,hit anything:1,anything it:1,was aimed:1,which isn’t:1,isn’t surprising:1,surprising considering:1,of rifling:1,rifling precision:1,precision parts:1,and ballistics:1,ballistics The:1,The guides:1,guides at:1,the fort:1,fort shot:1,shot off:1,off three:1,three cannons:1,cannons the:1,closest they:1,they came:1,target was:1,about 50:1,feet and:1,wind helped:1,helped I:1,early wars:1,wars was:1,put so:1,much lead:1,lead in:1,air that:1,was bound:1,hit something:1,something preferably:1,preferably but:1,enemy Nowadays:1,Nowadays of:1,have automatic:1,automatic weapons:1,weapons that:1,teenager to:1,to singlehandedly:1,singlehandedly defeat:1,defeat the:1,entire U.S:1,Army not:1,mention so-called:1,so-called smart:1,smart bombs:1,bombs which:1,are smart:1,smart in:1,can seek:1,empty a:1,a taxpayer’s:1,taxpayer’s wallet:1,wallet without:1,being detected:1,by radar:1,radar There’s:1,about progress:1,progress which:1,leave you:1,deduce for:1,for yourselves:1,yourselves Here’s:1,same lesson:1,lesson in:1,another form:1,form Ten:1,Ten years:1,ago we:1,slow processor:1,8088 for:1,was devilishly:1,devilishly hard:1,optimize and:1,available Now:1,486 that’s:1,that’s 50:1,the 8088—and:1,8088—and for:1,available Sure:1,Sure Intel:1,Intel provides:1,few tidbits:1,tidbits on:1,Manual but:1,12 that:1,both incomplete:1,correct Besides:1,Besides most:1,most assembly:1,programmers don’t:1,don’t bother:1,read Intel’s:1,Intel’s manuals:1,manuals which:1,are extremely:1,extremely informative:1,informative and:1,done but:1,read than:1,the phone:1,phone book:1,486 using:1,using outdated:1,outdated 8088:1,techniques blissfully:1,blissfully unaware:1,and heavily:1,heavily mutated:1,mutated generation:1,ways undreamt:1,undreamt of:1,how Terje:1,Mathisen doubled:1,his word-counting:1,486 simply:1,shuffling a:1,instructions 486:1,Optimization I’ve:1,mentioned Terje:1,Mathisen in:1,writings before:1,before Terje:1,Terje is:1,programmer extraordinaire:1,extraordinaire and:1,and author:1,the incredibly:1,incredibly fast:1,fast public-domain:1,public-domain word-counting:1,program WC:1,WC which:1,which comes:1,comes complete:1,look if:1,like Terje’s:1,Terje’s a:1,regular participant:1,participant in:1,Bix In:1,thread titled:1,titled 486:1,Optimization or:1,or TANSTATFC:1,As The:1,The Fastest:1,Code he:1,he detailed:1,detailed the:1,following optimization:1,to WC:1,WC perhaps:1,best example:1,pipeline optimization:1,optimization I’ve:1,seen Terje’s:1,Terje’s inner:1,loop originally:1,originally looked:1,13.1 I’ve:1,few liberties:1,liberties for:1,purposes Of:1,course Terje:1,Terje unrolls:1,unrolls this:1,times 128:1,128 times:1,exact By:1,13.1 you’ll:1,Terje counts:1,counts not:1,only words:1,also lines:1,two characters:1,characters LISTING:1,LISTING 13.1:1,13.1 L13-1.ASM:1,L13-1.ASM Listing:1,13.1 looks:1,looks as:1,two one-cycle:1,instructions one:1,one two-cycle:1,two-cycle instruction:1,branches It:1,is tight:1,tight but:1,13.1 The:1,that DI:1,costs 2:1,it interrupts:1,instruction pipeline:1,pipeline Likewise:1,Likewise BX:1,memory costing:1,costing another:1,cycles Thus:1,Thus this:1,loop takes:1,as cycle:1,counts would:1,indicate simply:1,because two:1,loaded immediately:1,used disrupting:1,disrupting the:1,pipeline Listing:1,13.2 shows:1,shows Terje’s:1,Terje’s immediate:1,immediate response:1,these pipelining:1,pipelining problems:1,problems he:1,he simply:1,simply swapped:1,swapped the:1,that load:1,load DI:1,and BL:1,BL This:1,This one:1,change cut:1,cut execution:1,character pair:1,pair from:1,from eight:1,now separated:1,of BX:1,also separated:1,memory remember:1,unrolled so:1,last instruction:1,intervening instruction:1,penalty at:1,all Figure:1,WC Figure:1,WC Remember:1,Remember pipeline:1,pipeline penalties:1,penalties diminish:1,diminish with:1,increasing number:1,cycles not:1,not instructions:1,pipeline disrupter:1,disrupter and:1,affected instruction:1,instruction LISTING:1,LISTING 13.2:1,13.2 L13-2.ASM:1,L13-2.ASM At:1,Terje had:1,had nearly:1,nearly doubled:1,by moving:1,that swapping:1,instructions also:1,also made:1,to preload:1,preload DI:1,DI at:1,13.2 is:1,13.1 I’ll:1,let Terje:1,Terje describe:1,his next:1,next optimization:1,words When:1,looked closely:1,to DX:1,DX so:1,written as:1,Listing 13.3:1,13.3 The:1,final breakthrough:1,breakthrough came:1,came when:1,by initializing:1,initializing AX:1,zero outside:1,loop I:1,rearrange it:1,13.4 and:1,ADD DXAX:1,DXAX after:1,two single-cycle:1,single-cycle instructions:1,fourth line:1,line avoiding:1,avoiding all:1,all pipeline:1,total throughput:1,two cycles/char:1,cycles/char LISTING:1,LISTING 13.4:1,13.4 L13-4.ASM:1,L13-4.ASM I’d:1,out two:1,two fairly:1,fairly remarkable:1,Terje saved:1,13.4 sped:1,his entire:1,entire word-counting:1,engine by:1,by 25:1,13.4 is:1,fully twice:1,Listing 13.1—all:1,13.1—all the:1,than shifting:1,shifting an:1,and splitting:1,splitting another:1,another into:1,operations Second:1,Second Terje’s:1,Terje’s word-counting:1,engine can:1,process more:1,million characters:1,486/33 Clever:1,Clever 486:1,big QED:1,QED BSWAP:1,BSWAP More:1,More Useful:1,Useful Than:1,You Might:1,Might Think:1,Think There:1,3 non-system:1,non-system instructions:1,instructions unique:1,486 None:1,None is:1,is earthshaking:1,their uses:1,uses Consider:1,Consider BSWAP:1,BSWAP BSWAP:1,BSWAP does:1,name implies:1,implies swapping:1,not bits:1,other as:1,Figure 13.2:1,13.2 BSWAP:1,registers memory:1,memory locations:1,not valid:1,valid operands:1,operands The:1,of BSWAP:1,convert data:1,Intel format:1,format least:1,also called:1,called little:1,little endian:1,endian to:1,to Motorola:1,Motorola format:1,format most:1,or big:1,big endian:1,endian like:1,so BSWAP:1,for reversing:1,pixel bits:1,bitmap so:1,rotated 32:1,as ROR:1,ROR EAX1:1,EAX1 Intel’s:1,Intel’s byte:1,byte ordering:1,multiword values:1,values least-significant:1,least-significant byte:1,first loads:1,loads pixels:1,word rotation:1,concerned but:1,but BSWAP:1,that As:1,though BSWAP:1,unexpected way:1,way having:1,with making:1,making efficient:1,knows the:1,x86 register:1,too small:1,to phrase:1,phrase that:1,nice if:1,set were:1,were bigger:1,bigger As:1,any 386/486:1,386/486 assembly:1,knows there:1,which 16:1,bits is:1,plenty For:1,16-bit scan-line:1,scan-line counter:1,counter generally:1,generally does:1,trick nicely:1,video driver:1,driver because:1,few video:1,video devices:1,devices with:1,than 65535:1,65535 addressable:1,addressable scan:1,lines Combining:1,Combining these:1,two observations:1,observations yields:1,obvious conclusion:1,great if:1,selected 386:1,386 registers:1,registers effectively:1,effectively increasing:1,available register:1,register space:1,space Unfortunately:1,set doesn’t:1,work directly:1,best solution:1,half you:1,13.5 Having:1,Having to:1,16-bit fields:1,fields into:1,position certainly:1,having direct:1,direct access:1,half but:1,but surely:1,surely it’s:1,memory isn’t:1,necessarily Shifts:1,worst performing:1,performing instructions:1,486 taking:1,taking 2:1,execute Thus:1,skip value:1,into CX:1,CX in:1,13.5 and:1,it back:1,of ECX:1,ECX I’d:1,say four:1,pretty steep:1,steep price:1,pay especially:1,a MOV:1,cycle Basically:1,Basically using:1,using ROR:1,ROR to:1,16-bit register:1,pretty marginal:1,marginal technique:1,technique unless:1,unless for:1,using BP:1,working register:1,register temporarily:1,temporarily making:1,frame inaccessible:1,inaccessible On:1,386 ROR:1,ROR was:1,split a:1,registers On:1,however BSWAP:1,can not:1,because BSWAP:1,BSWAP executes:1,cycle BSWAP:1,BSWAP has:1,not affecting:1,flags unlike:1,unlike ROR:1,ROR With:1,With BSWAP:1,BSWAP based:1,based code:1,Listing 13.6:1,13.6 the:1,upper 16:1,accessed with:1,altering any:1,flags making:1,packing two:1,registers into:1,one 32-bit:1,register much:1,useful Pushing:1,Pushing and:1,and Popping:1,Popping Memory:1,Memory Pushing:1,Pushing or:1,in PUSH:1,PUSH WORD:1,WORD PTR:1,PTR BX:1,or POP:1,POP MemVar:1,MemVar is:1,value onto:1,onto or:1,off of:1,stack especially:1,when pushing:1,pushing parameters:1,for calling:1,a C-compatible:1,C-compatible function:1,function However:1,However on:1,are unattractive:1,unattractive instructions:1,instructions from:1,perspective Pushing:1,contrast loading:1,location into:1,and pushing:1,1 more:1,cycles Therefore:1,Therefore is:1,as and:1,only cost:1,AX are:1,are destroyed:1,destroyed Likewise:1,Likewise popping:1,takes six:1,but popping:1,cycles combined:1,combined The:1,The i486:1,Manual lists:1,4-cycle execution:1,for popping:1,but pay:1,pay that:1,no mind:1,mind popping:1,cycle Why:1,convenient operation:1,as pushing:1,pushing or:1,popping memory:1,rule on:1,simple operations:1,486’s RISC:1,RISC core:1,core are:1,fast whereas:1,whereas complex:1,be carried:1,carried out:1,in microcode:1,microcode just:1,all relatively:1,slow Slow:1,Slow complex:1,operations include:1,include all:1,instructions except:1,except REP:1,MOVS as:1,XLAT LOOP:1,course PUSH:1,POP mem:1,mem Whenever:1,Whenever possible:1,possible try:1,486’s 1-cycle:1,1-cycle instructions:1,including MOV:1,ADD SUB:1,SUB CMP:1,CMP ADC:1,SBB XOR:1,XOR AND:1,TEST LEA:1,reg These:1,benefit in:1,rearrange them:1,maximum pipeline:1,pipeline efficiency:1,efficiency as:1,with Terje’s:1,Terje’s optimization:1,chapter Optimal:1,Optimal 1-Bit:1,1-Bit Shifts:1,and Rotates:1,Rotates On:1,and rotate:1,rotate instructions—as:1,instructions—as in:1,ROR AX2:1,AX2 and:1,SHL BX9:1,BX9 are:1,are 2-cycle:1,2-cycle instructions:1,1-bit forms—as:1,forms—as in:1,ROR AX1:1,AX1 and:1,SHL BX1:1,BX1 are:1,are 3-cycle:1,3-cycle instructions:1,instructions Go:1,Go figure:1,figure Assemblers:1,Assemblers default:1,1-bit instruction:1,for 1-bit:1,1-bit shifts:1,rotates That’s:1,not unreasonable:1,unreasonable since:1,1-bit form:1,form is:1,forms on:1,form doesn’t:1,even exist:1,exist on:1,really critical:1,worth hand-assembling:1,hand-assembling the:1,a single-bit:1,single-bit shift:1,rotate in:1,assemble a:1,a 2-bit:1,2-bit form:1,desired instruction:1,in SHL:1,AX2 then:1,the hex:1,hex codes:1,codes that:1,assembler generates:1,use DB:1,DB to:1,insert them:1,value two:1,two replaced:1,value one:1,one For:1,could determine:1,that SHL:1,AX2 assembles:1,assembles to:1,bytes 0C1H:1,0C1H 0E0H:1,0E0H 002H:1,002H either:1,the disassembly:1,disassembly in:1,assembler generate:1,a listing:1,listing file:1,file You:1,then insert:1,AX1 in:1,follows cb150-1:1,cb150-1 mov:1,mov ax1:1,ax1 cb150-2:1,cb150-2 db:1,db 0c1h:1,0c1h 0e0h:1,0e0h 001h:1,001h cb150-3:1,cb150-3 mov:1,mov dxax:1,dxax At:1,sequence DX:1,DX will:1,contain 2:1,fast n-bit:1,AX1 will:1,have executed:1,executed If:1,approach I’d:1,macro rather:1,than sticking:1,sticking DBs:1,DBs in:1,is advantageous:1,advantageous only:1,486 It:1,doesn’t apply:1,to RCL:1,RCL and:1,and RCR:1,RCR where:1,definitely want:1,1-bit versions:1,versions whenever:1,n-bit versions:1,are horrendously:1,horrendously slow:1,slow But:1,But if:1,these tidbits:1,tidbits can:1,few critical:1,critical cycles—and:1,cycles—and Lord:1,knows that:1,the 486—that:1,486—that is:1,need even:1,from unoptimized:1,unoptimized code:1,a 486—you:1,486—you almost:1,certainly need:1,need all:1,get 32-Bit:1,32-Bit Addressing:1,Addressing Modes:1,both support:1,base memory:1,potentially scaled:1,scaled index:1,example cb151-1:1,cb151-1 mov:1,mov alBaseTable[ecx:1,alBaseTable[ecx edx*4:1,edx*4 uses:1,perfectly valid:1,valid 32-bit:1,32-bit address:1,address with:1,accessed being:1,in DS:1,DS pointed:1,EDX times:1,times 4:1,4 plus:1,of BaseTable:1,BaseTable plus:1,plus ECX:1,ECX This:1,powerful memory:1,addressing scheme:1,scheme far:1,to 8088-style:1,8088-style 16-bit:1,without its:1,its quirks:1,quirks and:1,costs so:1,at 32-bit:1,addressing By:1,way 32-bit:1,instructions may:1,mode although:1,although each:1,addressing must:1,an address-size:1,address-size prefix:1,byte costs:1,486 Any:1,register component:1,address Any:1,except ESP:1,ESP may:1,also serve:1,8 Scaling:1,Scaling is:1,very handy:1,performing lookups:1,lookups in:1,in arrays:1,arrays and:1,and tables:1,tables The:1,for ESP:1,ESP which:1,base Incidentally:1,Incidentally it:1,that ESP:1,ESP can’t:1,scaled ESP:1,ESP presumably:1,presumably always:1,always points:1,valid stack:1,can’t think:1,reason you’d:1,you’d want:1,pointer times:1,times 2:1,8 in:1,address ESP:1,its nature:1,nature a:1,base rather:1,than index:1,index pointer:1,pointer That’s:1,addressing it’s:1,simple much:1,addressing with:1,its sharply:1,sharply limited:1,limited memory:1,register combinations:1,combinations The:1,The costs:1,costs of:1,addressing are:1,more subtle:1,subtle The:1,only performance:1,cost apart:1,aforementioned 1-cycle:1,penalty imposed:1,imposed for:1,context you:1,use an:1,that’s scaled:1,scaled or:1,memory MOV:1,MOV BL:1,BL EBX*2:1,EBX*2 uses:1,does MOV:1,EDX MOV:1,EAX 100H:1,not indexed:1,indexed however:1,other cost:1,in instruction:1,size Old-style:1,Old-style 16-bit:1,addressing usually:1,usually except:1,cases uses:1,uses one:1,which Intel:1,placed immediately:1,each instruction’s:1,instruction’s opcode:1,opcode to:1,mode plus:1,2 optional:1,optional bytes:1,addressing displacement—that:1,displacement—that is:1,add into:1,address In:1,addressing continues:1,byte albeit:1,different interpretation:1,interpretation in:1,addressing except:1,32-bit displacement:1,displacement is:1,a 2-byte:1,2-byte instruction:1,instruction MOV:1,EBX 10H:1,a 3-byte:1,3-byte instruction:1,EBX 10000H:1,10000H is:1,a 6-byte:1,and 4-byte:1,4-byte displacements:1,displacements but:1,not 2-byte:1,2-byte displacements:1,displacements are:1,supported for:1,addressing Code:1,Code size:1,be greatly:1,keeping stack:1,frame variables:1,within 128:1,EBP and:1,and variables:1,in pointed-to:1,pointed-to structures:1,within 127:1,127 bytes:1,structure so:1,that displacements:1,displacements can:1,be 1:1,bytes However:1,However because:1,because 32-bit:1,addressing supports:1,supports many:1,more addressing:1,addressing combinations:1,combinations than:1,byte can’t:1,can’t describe:1,the combinations:1,combinations Therefore:1,Therefore whenever:1,whenever an:1,involved a:1,byte follows:1,provide additional:1,additional address:1,address information:1,information Consequently:1,Consequently whenever:1,a scaled:1,scaled memory:1,or use:1,you automatically:1,automatically add:1,add 1:1,instruction This:1,use index:1,needed but:1,yourself using:1,them inside:1,inside key:1,loops you:1,index calculation:1,calculation outside:1,loop like:1,could change:1,following for:1,I’ll end:1,more quirks:1,quirks of:1,addressing First:1,addressing addressing:1,uses EBP:1,EBP as:1,register both:1,both accesses:1,the SS:1,SS segment:1,default and:1,always has:1,displacement of:1,least 1:1,the common:1,should happen:1,use EBP:1,address non-stack:1,non-stack memory:1,memory Lastly:1,mentioned ESP:1,scaled In:1,fact ESP:1,register it:1,register Ironically:1,Ironically however:1,however ESP:1,an SIB:1,byte even:1,used without:1,an outcome:1,outcome of:1,byte extends:1,extends the:1,least worth:1,that ESP-based:1,ESP-based non-indexed:1,other non-indexed:1,slower there’s:1,no 1-cycle:1,using ESP:1,14 Boyer-Moore:1,Boyer-Moore String:1,Searching Optimizing:1,Optimizing a:1,a Pretty:1,Pretty Optimum:1,Optimum Search:1,Search Algorithm:1,Algorithm When:1,you seem:1,be stumped:1,stumped stop:1,stop for:1,minute and:1,think All:1,be right:1,nose if:1,little differently:1,differently Here’s:1,college I:1,stay around:1,around campus:1,campus for:1,summer Oh:1,Oh I’d:1,I’d take:1,mostly it:1,an excuse:1,excuse to:1,to hang:1,hang out:1,spirit my:1,my girlfriend:1,girlfriend Adrian:1,Adrian not:1,my future:1,future wife:1,wife partly:1,apparent bussed:1,bussed in:1,week sharing:1,sharing a:1,a less-than-elegant:1,less-than-elegant 150:1,150 per:1,per month:1,month apartment:1,apartment with:1,by necessity:1,necessity my:1,roommate Our:1,Our apartment:1,apartment was:1,much standard:1,standard issue:1,two male:1,male college:1,students maybe:1,maybe even:1,a cut:1,cut above:1,The dishes:1,dishes were:1,were usually:1,usually washed:1,washed there:1,was generally:1,generally food:1,food in:1,the refrigerator:1,refrigerator and:1,nothing larger:1,small dog:1,dog had:1,up permanent:1,permanent residence:1,residence in:1,bathroom However:1,one sticking:1,sticking point:1,point literally:1,literally the:1,floor This:1,This floor—standard:1,floor—standard tile:1,tile with:1,nice pattern:1,of black:1,an off-white:1,off-white background:1,thought had:1,cleaned By:1,By which:1,certainty that:1,never cleaned:1,fact not:1,cleaned since:1,the Late:1,Late Jurassic:1,Jurassic or:1,possibly earlier:1,earlier Our:1,Our feet:1,feet tended:1,stick to:1,the apartment:1,apartment suddenly:1,suddenly turned:1,turned upside-down:1,upside-down I:1,think we’d:1,we’d all:1,been hanging:1,hanging from:1,the ceiling:1,ceiling One:1,roommate and:1,I returned:1,returned from:1,a pick-up:1,pick-up basketball:1,game Adrian:1,Adrian having:1,having been:1,been left:1,own devices:1,devices for:1,hours had:1,had apparently:1,apparently kept:1,kept herself:1,herself busy:1,busy Notice:1,Notice anything:1,anything she:1,she asked:1,asked with:1,her voice:1,that suggested:1,suggested we:1,had damned:1,damned well:1,well better:1,better Uh:1,Uh you:1,you cooked:1,cooked dinner:1,dinner I:1,I guessed:1,guessed Washed:1,Washed the:1,the dishes:1,dishes Had:1,Had your:1,your hair:1,hair done:1,done My:1,My roommate:1,roommate was:1,was equally:1,equally without:1,clue She:1,She stamped:1,stamped her:1,her foot:1,foot really:1,happen and:1,said No:1,you jerks:1,jerks The:1,The kitchen:1,floor Look:1,floor I:1,I cleaned:1,The floor:1,floor really:1,really did:1,did look:1,look amazing:1,amazing It:1,actually all:1,all white:1,white the:1,the black:1,lines had:1,been grooves:1,grooves filled:1,with dirt:1,dirt We:1,We assured:1,assured her:1,her that:1,it looked:1,looked terrific:1,terrific it:1,wasn’t that:1,that obvious:1,obvious until:1,you knew:1,knew to:1,it anyone:1,would tell:1,that jumped:1,jumped out:1,at you:1,was great:1,great no:1,no kidding:1,kidding We:1,had almost:1,almost smoothed:1,smoothed things:1,things over:1,over when:1,friend walked:1,walked in:1,in looked:1,looked around:1,said Hey:1,Hey Did:1,guys put:1,new floor:1,floor As:1,said sometimes:1,sometimes everything:1,nose Which:1,Boyer-Moore string:1,searching String:1,Searching Refresher:1,Refresher I’ve:1,discussed string:1,searching earlier:1,9 You:1,these chapters:1,chapters for:1,some background:1,background on:1,on string:1,general I’m:1,I’m also:1,also going:1,chapter’s test:1,test suite:1,suite For:1,excellent Algorithms:1,Algorithms in:1,C by:1,which served:1,served as:1,primary reference:1,at Sedgewick:1,Sedgewick be:1,Boyer-Moore listing:1,listing on:1,page 288:1,288 there:1,mistake j:1,the for:1,be j:1,0 unless:1,unless I’m:1,I’m missing:1,something String:1,String searching:1,particular sequence:1,pattern within:1,within another:1,another sequence:1,try every:1,location starting:1,position after:1,each mismatch:1,mismatch until:1,is exhausted:1,exhausted There’s:1,There’s even:1,nifty string:1,instruction REPZ:1,CMPS that’s:1,that’s perfect:1,for comparing:1,location What:1,What could:1,simpler We:1,some important:1,important information:1,yet using:1,using though:1,though Typically:1,Typically the:1,buffer will:1,bytes Let’s:1,contains text:1,case there:1,be dozens:1,different characters:1,won’t usually:1,even neither:1,neither will:1,will any:1,character constitute:1,constitute half:1,buffer or:1,anything close:1,close A:1,A reasonable:1,reasonable conclusion:1,pattern will:1,will rarely:1,rarely match:1,location currently:1,being checked:1,checked This:1,the speedy:1,speedy REPNZ:1,to whiz:1,whiz through:1,buffer eliminating:1,eliminating most:1,match locations:1,locations with:1,with single:1,single repetitions:1,of SCASB:1,SCASB Only:1,character does:1,does infrequently:1,infrequently match:1,match must:1,must we:1,we drop:1,slower REPZ:1,we’re assuming:1,is typical:1,typical text:1,text That’s:1,meant at:1,outset when:1,be under:1,under your:1,nose Formally:1,Formally you:1,but experience:1,experience common:1,your knowledge:1,application give:1,useful if:1,somewhat imprecise:1,imprecise information:1,information If:1,letter A:1,A repeated:1,times followed:1,letter B:1,B then:1,REPNZ SCASB/REPZ:1,SCASB/REPZ CMPS:1,brute-force REPZ:1,pattern AB:1,AB because:1,because REPNZ:1,SCASB would:1,would match:1,match at:1,location You:1,could construct:1,a horrendous:1,horrendous worst-case:1,worst-case scenario:1,scenario for:1,for almost:1,optimization the:1,usual conditions:1,9 we:1,that certain:1,certain characters:1,have lower:1,lower probabilities:1,probabilities of:1,of matching:1,others In:1,normal buffer:1,buffer T:1,T will:1,match far:1,than X:1,X Therefore:1,common letter:1,string rather:1,first letter:1,letter we’ll:1,we’ll greatly:1,greatly decrease:1,times we:1,takes REPNZ:1,first match:1,N bytes:1,the least-common:1,least-common REPNZ:1,SCASB approach:1,as N:1,N repetitions:1,SCASB At:1,point we’re:1,we’re pretty:1,much searching:1,SCASB On:1,x86 there:1,there simply:1,simply is:1,test each:1,turn In:1,faster we’d:1,check fewer:1,fewer characters—but:1,characters—but we:1,sure of:1,finding all:1,matches Can:1,we Actually:1,yes we:1,The Boyer-Moore:1,Boyer-Moore Algorithm:1,Algorithm All:1,All our:1,our a:1,a priori:1,priori knowledge:1,is stated:1,stated above:1,of knowledge—knowledge:1,knowledge—knowledge that’s:1,that’s generated:1,generated dynamically:1,dynamically As:1,we search:1,buffer we:1,acquire information:1,information each:1,match One:1,One sort:1,acquire is:1,on partial:1,matches we:1,often skip:1,ahead after:1,after partial:1,because take:1,a deep:1,deep breath:1,breath by:1,by partially:1,partially matching:1,matching we:1,implicitly done:1,a comparison:1,the partially:1,partially matched:1,matched buffer:1,characters with:1,possible pattern:1,pattern start:1,start locations:1,overlap those:1,those partially-matched:1,partially-matched bytes:1,bytes If:1,If that:1,head hurt:1,hurt it:1,it should—and:1,should—and don’t:1,worry This:1,the Knuth-Morris-Pratt:1,Knuth-Morris-Pratt algorithm:1,what gives:1,gives Boyer-Moore:1,Boyer-Moore its:1,its reputation:1,reputation for:1,for inscrutability:1,inscrutability That:1,That reputation:1,reputation is:1,well deserved:1,deserved for:1,aspect which:1,not discuss:1,discuss further:1,another part:1,Boyer-Moore that’s:1,understood easily:1,easily implemented:1,effective Consider:1,this We’re:1,We’re searching:1,pattern ABC:1,ABC beginning:1,beginning the:1,search at:1,buffer containing:1,containing ABZABC:1,ABZABC We:1,We match:1,on A:1,A we:1,we match:1,on B:1,B and:1,we mismatch:1,this position:1,position What:1,learned Why:1,Why we’ve:1,learned not:1,doesn’t match:1,buffer starting:1,or offset:1,2 either:1,either After:1,all there’s:1,2 since:1,doesn’t contain:1,single Z:1,Z there’s:1,can match:1,any location:1,would span:1,Z at:1,2 We:1,just skip:1,skip straight:1,offset 3:1,continue saving:1,saving ourselves:1,ourselves two:1,comparisons Unfortunately:1,approach only:1,only pays:1,big when:1,a near-complete:1,near-complete partial:1,found if:1,comparison fails:1,fails on:1,first pattern:1,pattern character:1,happens we:1,ahead 1:1,usual Look:1,it differently:1,differently though:1,though What:1,pattern starting:1,last rightmost:1,rightmost byte:1,first leftmost:1,leftmost byte:1,words what:1,compare from:1,memory toward:1,toward low:1,low in:1,the STD:1,STD instruction:1,instruction After:1,comparing one:1,buffer it:1,what order:1,order we:1,compare them:1,set are:1,corresponding bytes:1,other set:1,set Why:1,earth would:1,character Because:1,Because a:1,character tells:1,character We:1,We learn:1,learn nothing:1,nothing new:1,new from:1,character except:1,pattern can’t:1,can’t match:1,location A:1,A mismatch:1,character however:1,however tells:1,possibilities of:1,matching starting:1,pattern spans:1,buffer doesn’t:1,pattern then:1,then we’ve:1,just eliminated:1,eliminated not:1,many potential:1,are characters:1,pattern that’s:1,many locations:1,locations there:1,have matched:1,matched but:1,have just:1,just been:1,been shown:1,shown not:1,to because:1,doesn’t belong:1,pattern In:1,outperform even:1,even REPNZ:1,SCASB REPNZ:1,SCASB has:1,check every:1,but Boyer-Moore:1,Boyer-Moore doesn’t:1,doesn’t Figure:1,14.1 illustrates:1,a Boyer-Moore:1,Boyer-Moore search:1,the rightcharacter:1,rightcharacter of:1,search pattern:1,pattern which:1,that’s compared:1,compared at:1,location because:1,comparing backwards:1,backwards mismatches:1,mismatches with:1,appears nowhere:1,nowhere in:1,14.2 illustrates:1,match when:1,pattern member:1,member In:1,ahead past:1,location resulting:1,an advance:1,advance of:1,potentially as:1,same single:1,byte distance:1,distance by:1,standard search:1,approach advances:1,advances Figure:1,checked What:1,does occur:1,pattern Then:1,can’t skip:1,skip past:1,skip to:1,whatever location:1,location aligns:1,aligns the:1,rightmost occurrence:1,that character:1,14.3 Basically:1,Basically we:1,we exercise:1,exercise our:1,our right:1,as members:1,free society:1,society to:1,compare strings:1,strings in:1,in whichever:1,whichever direction:1,direction we:1,choose and:1,so right:1,to left:1,left rather:1,intuitive left:1,right Whenever:1,Whenever we:1,mismatch we:1,that failed:1,pattern Imagine:1,location until:1,start location:1,mismatch does:1,not eliminate:1,pattern If:1,mismatch character:1,character doesn’t:1,pattern the:1,move clear:1,clear past:1,location Otherwise:1,pattern moves:1,moves until:1,matching pattern:1,pattern byte:1,byte lies:1,lies atop:1,mismatch That’s:1,checked Boyer-Moore:1,Boyer-Moore The:1,Good and:1,Bad The:1,pattern mismatches:1,mismatches on:1,leftmost character—the:1,character—the last:1,last character:1,character compared—every:1,compared—every time:1,Again not:1,likely but:1,Boyer-Moore performs:1,performs better:1,better as:1,fewer and:1,shorter partial:1,matches ideally:1,ideally the:1,character would:1,never match:1,match until:1,location was:1,reached Longer:1,Longer patterns:1,which make:1,longer skips:1,skips help:1,help Boyer-Moore:1,Boyer-Moore as:1,long distance:1,location which:1,helps diffuse:1,of distances:1,distances to:1,ahead on:1,possible mismatch:1,mismatch values:1,values Figure:1,pattern The:1,for Boyer-Moore:1,good indeed:1,indeed About:1,About N/M:1,N/M comparisons:1,required where:1,and M:1,M is:1,length This:1,Boyer-Moore to:1,length on:1,complete mismatch:1,mismatch How:1,is Boyer-Moore:1,searching Listing:1,Listing 14.2:1,14.2 is:1,searches up:1,pattern Table:1,14.1 all:1,386 searching:1,a modified:1,modified version:1,text of:1,SCASB although:1,does come:1,close when:1,long patterns:1,patterns Listing:1,designed primarily:1,make later:1,later assembly:1,assembly implemenmore:1,implemenmore comprehensible:1,comprehensible rather:1,faster Sedge’s:1,Sedge’s implementation:1,implementation uses:1,uses arrays:1,arrays rather:1,than pointers:1,pointers is:1,very clever:1,faster Regardless:1,Regardless the:1,SCASB clearly:1,clearly indicates:1,order at:1,point Table:1,14.1 Comparison:1,Comparison of:1,techniques g:1,g Yogi:1,Yogi igoY:1,igoY Adrian:1,Adrian Conclusion:1,Conclusion You:1,know Searching:1,Searching approach:1,approach 16K:1,16K 1K:1,1K 16K:1,16K REPNZ:1,first char:1,char a:1,a Listing:1,9.1 8.2:1,8.2 7.5:1,7.5 9.7:1,9.7 0.4:1,0.4 7.4:1,7.4 8.1:1,8.1 REPNZ:1,on least:1,common char:1,char Listing:1,9.2 7.6:1,7.6 7.5:1,7.5 0.5:1,0.5 7.5:1,7.5 Boyer-Moore:1,C Listing:1,14.1 71.0:1,71.0 38.4:1,38.4 37.7:1,37.7 1.8:1,1.8 18.2:1,18.2 9.2:1,9.2 Standard:1,ASM code:1,shown 38.5:1,38.5 21.0:1,21.0 20.5:1,20.5 0.8:1,0.8 9.4:1,9.4 4.8:1,4.8 Quick:1,Quick handling:1,of first:1,first mismatch:1,mismatch Boyer-Moore:1,14.3 14.1:1,14.1 8.9:1,8.9 7.7:1,7.7 0.4:1,0.4 4.0:1,4.0 2.0:1,2.0 255:1,255 pattern:1,length sentinelBoyer-Moore:1,sentinelBoyer-Moore in:1,14.4 8.1:1,8.1 5.2:1,5.2 4.6:1,4.6 0.3:1,0.3 2.6:1,2.6 1.2:1,1.2 Search:1,Search pattern:1,pattern approximate:1,approximate distance:1,distance searched:1,searched before:1,before match:1,in parentheses:1,parentheses Times:1,in milliseconds:1,milliseconds shorter:1,better The:1,The entry:1,entry Standard:1,ASM in:1,14.1 refers:1,to straight-forward:1,straight-forward hand:1,14.1 code:1,cases than:1,SCASB I:1,this casually:1,casually now:1,now but:1,so yesterday:1,yesterday when:1,had all:1,but concluded:1,that Boyer-Moore:1,Boyer-Moore was:1,was simply:1,simply inferior:1,inferior on:1,x86 due:1,two architectural:1,architectural quirks:1,quirks the:1,slow branch:1,branch I:1,had even:1,even coined:1,coined a:1,neat phrase:1,phrase for:1,it Architecture:1,Architecture is:1,is destiny:1,destiny Has:1,Has a:1,nice ring:1,ring doesn’t:1,it Well:1,Well architecture:1,architecture carries:1,carries a:1,of weight:1,weight but:1,isn’t destiny:1,destiny I:1,had simply:1,simply fallen:1,fallen into:1,algorithm was:1,so clever:1,clever that:1,any thinking:1,thinking myself:1,myself The:1,The path:1,path leading:1,SCASB from:1,original brute-force:1,of REPZ:1,REPZ CMPSB:1,CMPSB at:1,location had:1,been based:1,my observation:1,character comparison:1,comparison at:1,location usually:1,usually fails:1,fails Why:1,same concept:1,concept to:1,standard implementation—except:1,implementation—except that:1,it’s optimized:1,a first-comparison:1,first-comparison mismatch:1,mismatch as:1,at QuickSearchLoop:1,QuickSearchLoop much:1,as REPNZ:1,SCASB optimizes:1,optimizes first-comparison:1,first-comparison mismatches:1,mismatches for:1,14.1 speak:1,for themselves:1,themselves Listing:1,you was:1,already a:1,and unrolling:1,unrolling QuickSearchLoop:1,QuickSearchLoop could:1,could boost:1,also four:1,SCASB in:1,case Table:1,14.1 represents:1,limited and:1,and decidedly:1,decidedly unscientific:1,unscientific comparison:1,techniques Nonetheless:1,overall trend:1,trend is:1,clear For:1,shortest patterns:1,patterns well-implemented:1,well-implemented Boyer-Moore:1,generally as:1,as or:1,better than—sometimes:1,than—sometimes much:1,better than—brute-force:1,than—brute-force searching:1,searching For:1,For short:1,short patterns:1,patterns you:1,SCASB thereby:1,thereby getting:1,both worlds:1,worlds Know:1,use your:1,your smarts:1,smarts Don’t:1,Don’t stop:1,stop thinking:1,thinking just:1,because you’re:1,you’re implementing:1,a big-name:1,big-name algorithm:1,does Further:1,Further Optimization:1,Optimization of:1,Boyer-Moore We:1,do substantially:1,substantially better:1,yet than:1,14.3 if:1,accept tighter:1,tighter limits:1,data Limiting:1,Limiting the:1,searched-for pattern:1,of 255:1,255 bytes:1,bytes allows:1,the XLAT:1,XLAT instruction:1,generally tighten:1,tighten the:1,loop Be:1,aware however:1,expensive instruction:1,Pentium Putting:1,Putting a:1,string at:1,sentinel so:1,search never:1,never fails:1,fails frees:1,frees us:1,from counting:1,to unroll:1,14.4 which:1,which implements:1,implements these:1,about 60:1,14.3 Note:1,that Table:1,14.1 includes:1,table each:1,time FindString:1,called This:1,eliminated for:1,first search:1,when repeatedly:1,repeatedly searching:1,particular pattern:1,pattern by:1,table externally:1,and passing:1,parameter Know:1,Know What:1,What You:1,Know Here:1,we’ve turned:1,our nose:1,nose at:1,a repeated:1,instruction we’ve:1,we’ve gone:1,gone against:1,the grain:1,grain by:1,comparing backward:1,backward and:1,yet we’ve:1,we’ve speeded:1,bit All:1,any restrictions:1,restrictions or:1,or special:1,special requirements:1,requirements excluding:1,excluding Listing:1,14.4 and:1,new information:1,information Everything:1,we needed:1,was sitting:1,sitting there:1,there all:1,all along:1,along we:1,just needed:1,As Yogi:1,Yogi Berra:1,Berra might:1,might put:1,know until:1,Chapter 15:1,15 Linked:1,Lists and:1,and plain:1,plain Unintended:1,Unintended Challenges:1,Challenges Unfamiliar:1,Unfamiliar Problems:1,with Familiar:1,Familiar Data:1,Data Structures:1,Structures After:1,After 21:1,21 years:1,years this:1,story still:1,still makes:1,me wince:1,wince Oh:1,Oh the:1,the humiliations:1,humiliations I:1,I suffer:1,suffer for:1,enlightenment It:1,wasn’t until:1,until ninth:1,ninth grade:1,grade that:1,had my:1,real girlfriend:1,girlfriend Okay:1,maybe I:1,little socially:1,socially challenged:1,challenged as:1,a kid:1,kid but:1,but hey:1,hey show:1,show me:1,who wasn’t:1,territory Her:1,Her name:1,was Jeannie:1,Schweigert and:1,tall pretty:1,pretty enough:1,and female—and:1,female—and willing:1,me which:1,made her:1,her approximately:1,as attractive:1,as Cheryl:1,Cheryl Tiegs:1,Tiegs in:1,book Jeannie:1,Jeannie and:1,I hung:1,out together:1,together at:1,to basketball:1,basketball games:1,few parties:1,parties together:1,together but:1,but somehow:1,somehow the:1,us were:1,were never:1,never alone:1,alone Being:1,Being 14:1,14 neither:1,could drive:1,drive so:1,so her:1,her parents:1,parents tended:1,up chauffeuring:1,chauffeuring us:1,a next-to-ideal:1,next-to-ideal arrangement:1,arrangement I:1,I now:1,now realize:1,realize having:1,a daughter:1,daughter of:1,own ideal:1,ideal being:1,being exiling:1,exiling all:1,all males:1,males between:1,the ages:1,ages of:1,of 12:1,and 18:1,18 to:1,to Tasmania:1,Tasmania but:1,it drove:1,drove me:1,me nuts:1,nuts You:1,You see…ahem…I:1,see…ahem…I had:1,actually kissed:1,kissed Jeannie—or:1,Jeannie—or anyone:1,anyone for:1,matter unless:1,count maiden:1,maiden aunts:1,aunts and:1,the like—and:1,like—and I:1,was dying:1,dying to:1,to At:1,was terrified:1,terrified at:1,prospect What:1,wasn’t as:1,could go:1,to Kisses:1,Kisses R:1,R Us:1,Us and:1,take lessons:1,lessons My:1,My long-awaited:1,long-awaited opportunity:1,opportunity finally:1,finally came:1,came after:1,a basketball:1,game For:1,change my:1,was driving:1,driving and:1,we dropped:1,dropped her:1,her off:1,at her:1,her house:1,house I:1,walked her:1,door This:1,my big:1,big chance:1,put my:1,my arms:1,arms around:1,around her:1,her bent:1,bent over:1,my eyes:1,eyes closed:1,closed just:1,the movies:1,movies And:1,And whacked:1,whacked her:1,her on:1,head with:1,my chin:1,chin As:1,said she:1,tall And:1,mean whacked:1,whacked Jeannie:1,Jeannie burst:1,burst into:1,into hysterical:1,hysterical laughter:1,laughter tried:1,calm herself:1,herself down:1,down said:1,said goodnight:1,goodnight and:1,went inside:1,inside still:1,still giggling:1,giggling No:1,No kiss:1,kiss I:1,pretty mature:1,mature teenager:1,teenager so:1,more traumatic:1,traumatic than:1,than leading:1,leading the:1,the Tournament:1,Tournament of:1,of Roses:1,Roses parade:1,parade in:1,my underwear:1,underwear On:1,next try:1,try though:1,did manage:1,this kissing:1,kissing business:1,eventually even:1,even went:1,child Not:1,with Jeannie:1,Jeannie I:1,mind boggles:1,boggles at:1,the mess:1,mess I:1,her As:1,out none:1,stuff is:1,difficult in:1,it’s kind:1,of enjoyable:1,enjoyable wink:1,wink wink:1,wink say:1,say no:1,you’re dealing:1,with something:1,new a:1,knowledge goes:1,way When:1,to kissing:1,kissing we:1,to fumble:1,fumble along:1,learning curve:1,curve on:1,own but:1,of resources:1,resources to:1,learning process:1,process when:1,basic mechanisms:1,mechanisms of:1,of programming—searches:1,programming—searches sorts:1,sorts parsing:1,parsing and:1,the like—are:1,like—are well-understood:1,well-understood and:1,and superbly:1,superbly well-documented:1,well-documented Treat:1,Treat yourself:1,book like:1,like Algorithms:1,Sedgewick Addison:1,Wesley or:1,or Knuth’s:1,Knuth’s The:1,Computer Programming:1,Programming series:1,series also:1,also from:1,from Addison:1,Wesley and:1,was Knuth:1,Knuth with:1,of Kissing:1,Kissing when:1,needed him:1,him or:1,or practically:1,practically anything:1,by Jon:1,Jon Bentley:1,Bentley and:1,tackle a:1,new area:1,area give:1,head start:1,start There’s:1,There’s still:1,still plenty:1,of room:1,for inventiveness:1,inventiveness and:1,creativity on:1,apply that:1,that energy:1,energy on:1,knowledge that’s:1,been gained:1,gained instead:1,of reinventing:1,wheel I:1,know reinventing:1,wheel is:1,of challenge:1,challenge programmers:1,programmers love—but:1,love—but can:1,really afford:1,time And:1,And do:1,you honestly:1,honestly think:1,you’re so:1,can out-think:1,out-think Knuth:1,Knuth who’s:1,who’s spent:1,lifetime at:1,stuff and:1,and happens:1,a genius:1,genius Maybe:1,Maybe you:1,you can—but:1,can—but I:1,sure can’t:1,can’t For:1,my understanding:1,lists Linked:1,Lists Linked:1,are data:1,structures composed:1,discrete elements:1,elements or:1,or nodes:1,nodes joined:1,with links:1,links In:1,the links:1,links are:1,typically pointers:1,pointers Like:1,Like all:1,all data:1,structures linked:1,lists have:1,their strengths:1,their weaknesses:1,weaknesses Primary:1,Primary among:1,strengths are:1,are simplicity:1,simplicity speedy:1,speedy sequential:1,processing ease:1,ease and:1,of insertion:1,insertion and:1,and deletion:1,deletion the:1,mix nodes:1,and types:1,handle variable:1,variable amounts:1,data especially:1,total amount:1,data changes:1,changes dynamically:1,dynamically or:1,or is:1,always known:1,known beforehand:1,beforehand Weaknesses:1,Weaknesses include:1,include greater:1,greater memory:1,requirements than:1,than arrays:1,arrays the:1,pointers take:1,space slow:1,slow non-sequential:1,non-sequential processing:1,processing including:1,including finding:1,finding arbitrary:1,arbitrary nodes:1,an inability:1,inability to:1,backtrack unless:1,unless doubly-linked:1,doubly-linked lists:1,used Unfortunately:1,Unfortunately doubly:1,lists need:1,as processing:1,the backward:1,backward links:1,links Linked:1,lists aren’t:1,most types:1,of sorts:1,sorts Insertion:1,Insertion and:1,and bubble:1,sorts work:1,work fine:1,sophisticated sorts:1,sorts depend:1,on efficient:1,efficient random:1,random access:1,which linked:1,lists don’t:1,provide Likewise:1,a binary:1,list On:1,hand linked:1,where nothing:1,than sequential:1,sequential access:1,data that’s:1,always sorted:1,sorted or:1,nearly sorted:1,sorted Consider:1,Consider a:1,example Polygon:1,Polygon edges:1,x-sorted order:1,and tend:1,stay pretty:1,pretty nearly:1,nearly x-sorted:1,x-sorted so:1,so sophisticated:1,sophisticated sorting:1,never needed:1,needed Edges:1,Edges are:1,in sorted:1,order just:1,way linked:1,work best:1,best Moreover:1,Moreover linked:1,lists an:1,edges can:1,no fuss:1,fuss All:1,work beautifully:1,beautifully for:1,For an:1,lists in:1,filling see:1,see my:1,the May:1,May 1991:1,Journal Be:1,that none:1,column You:1,first heavy-duty:1,heavy-duty use:1,lists and:1,they seemed:1,seemed so:1,even open:1,open Sedgewick:1,or Knuth:1,Knuth For:1,For hashing:1,hashing or:1,or Boyer-Moore:1,searching sure:1,sure I’d:1,I’d have:1,my homework:1,homework first:1,but linked:1,lists seemed:1,seemed too:1,too obvious:1,obvious to:1,bother I:1,the polygon-related:1,polygon-related aspects:1,gave the:1,list implementation:1,implementation not:1,moment’s thought:1,thought before:1,began coding:1,coding Heck:1,had handled:1,handled much:1,much tougher:1,tougher programming:1,past surely:1,surely it:1,figure this:1,own than:1,up Not:1,Not The:1,linked list—the:1,list—the one:1,that DDJ:1,DDJ column—is:1,column—is straightforward:1,15.1 A:1,A head:1,pointer points:1,list which:1,reached typically:1,typically denoted:1,NULL next-node:1,Conceptually nothing:1,simpler From:1,From an:1,implementation perspective:1,perspective however:1,serious flaws:1,flaws with:1,fundamental problem:1,15.1 unnecessarily:1,unnecessarily complicates:1,complicates link:1,to delete:1,delete a:1,preceding node’s:1,node’s NextNode:1,NextNode pointer:1,following node:1,15.1 Listing:1,Listing 15.2:1,15.2 is:1,file LLIST.H:1,LLIST.H which:1,is include:1,include d:1,d by:1,list listings:1,chapter Easy:1,Easy enough—unless:1,enough—unless the:1,preceding node:1,node happens:1,which doesn’t:1,a NextNode:1,field because:1,node so:1,15.1 won’t:1,work Cumbersome:1,Cumbersome special:1,extra information:1,information a:1,list are:1,the head-pointer:1,head-pointer case:1,case as:1,Listing 15.3:1,15.3 I’ll:1,pointer the:1,first field:1,field in:1,LinkNode structure:1,structure at:1,successfully point:1,and pretend:1,pretend it:1,a LinkNode:1,LinkNode structure—but:1,structure—but that’s:1,ugly and:1,potentially dangerous:1,dangerous trick:1,trick and:1,approach next:1,list However:1,of types:1,structures in:1,your linked:1,lists you:1,should start:1,start each:1,LinkNode field:1,field That:1,the link:1,link pointer:1,every structure:1,same linked:1,list code:1,structure types:1,types by:1,casting them:1,link-node structure:1,structure type:1,type This:1,a less:1,than elegant:1,elegant approach:1,works C:1,C can:1,handle data:1,data mixing:1,mixing more:1,more cleanly:1,cleanly than:1,C via:1,via derivation:1,derivation from:1,link-node class:1,class Note:1,and 15.3:1,15.3 have:1,linked-list delete:1,delete operation:1,as delete:1,delete the:1,than delete:1,delete this:1,node because:1,to relink:1,relink it’s:1,the NextNode:1,node preceding:1,be deleted:1,deleted and:1,backtrack in:1,list For:1,reason singly-linked:1,singly-linked list:1,list operations:1,operations tend:1,structure preceding:1,of interest—and:1,interest—and that:1,to special-case:1,special-case the:1,pointer all:1,more acute:1,acute Similar:1,pointer crop:1,crop up:1,you’re inserting:1,inserting nodes:1,all link:1,manipulation code:1,code It’s:1,up working:1,either pointers:1,to pointers:1,pointers or:1,or lots:1,of special-case:1,they’re inelegant:1,inelegant and:1,and inefficient:1,inefficient Dummies:1,Dummies and:1,and Sentinels:1,Sentinels A:1,A far:1,dummy node:1,15.2 I:1,invented this:1,myself the:1,encountered linked:1,lists while:1,while designing:1,a seed:1,seed fill:1,for MetaWindows:1,MetaWindows back:1,back during:1,my tenure:1,tenure at:1,at Metagraphics:1,Metagraphics Corp:1,Corp But:1,spending five:1,minutes with:1,with Sedgewick’s:1,book Figure:1,The next-node:1,pointer of:1,real node:1,node that’s:1,that’s actually:1,cases Likewise:1,Likewise there:1,separate node:1,that contains:1,contains real:1,real data:1,scheme an:1,list contains:1,two nodes:1,15.3 Although:1,necessary the:1,node may:1,may point:1,itself as:1,own next:1,than contain:1,pointer This:1,a deletion:1,deletion operation:1,list will:1,no effect—quite:1,effect—quite unlike:1,operation performed:1,terminated with:1,The tail:1,terminated like:1,detected because:1,only node:1,pointer equals:1,equals the:1,the current-node:1,current-node pointer:1,15.3 is:1,right direction:1,direction but:1,still make:1,few refinements:1,refinements The:1,scans through:1,special test:1,tail has:1,been reached:1,reached So:1,field greater:1,certain value:1,value has:1,Listing 15.4:1,15.4 Suppose:1,node a:1,sentinel by:1,by giving:1,giving it:1,to terminate:1,terminate the:1,search as:1,15.4 The:1,15.4 has:1,sentinel with:1,32767 since:1,since we’re:1,integers that’s:1,highest possible:1,possible search:1,search value:1,satisfy any:1,any search:1,search that:1,comes down:1,pike The:1,The success:1,success or:1,or failure:1,search can:1,determined outside:1,necessary by:1,tail node’s:1,node’s special:1,special pointer—but:1,pointer—but the:1,is streamlined:1,test as:1,15.5 Not:1,Not all:1,lists lend:1,themselves to:1,to sentinels:1,sentinels but:1,considerable for:1,sentinel Figure:1,sentinel Circular:1,Circular Lists:1,Lists One:1,One minor:1,but elegant:1,elegant refinement:1,refinement yet:1,yet remains:1,remains Use:1,list We:1,by connecting:1,connecting the:1,node back:1,first through:1,circular fashion:1,fashion as:1,15.5 This:1,This head/tail:1,also of:1,sentinel when:1,list explicitly:1,explicitly that:1,current node:1,node pointer:1,pointer If:1,they’re equal:1,equal you’re:1,node Why:1,I so:1,this circular:1,list architecture:1,architecture For:1,my linked:1,list programming:1,programming has:1,in severely:1,severely memory-constrained:1,memory-constrained environments:1,environments Mostly:1,Mostly though:1,so neat:1,neat with:1,this setup:1,setup there’s:1,node or:1,or inner-loop:1,inner-loop instruction:1,instruction wasted:1,wasted Perfect:1,Perfect economy:1,programming if:1,I racked:1,racked my:1,my brains:1,brains for:1,for quite:1,while to:1,the circular:1,list simple:1,seem Shortly:1,Shortly after:1,after coming:1,in Sedgewick’s:1,book only:1,find my:1,my nifty:1,nifty optimization:1,described plain:1,plain as:1,as day:1,while after:1,thread in:1,the algorithms/computer.sci:1,algorithms/computer.sci topic:1,on BIX:1,BIX that:1,that described:1,described it:1,detail Folks:1,Folks the:1,there Look:1,up before:1,before turning:1,your optimizer:1,optimizer afterburners:1,afterburners Listings:1,15.6 together:1,a suite:1,suite of:1,C functions:1,circular linked:1,list sorted:1,by ascending:1,ascending value:1,15.5 requires:1,requires modification:1,modification before:1,with circular:1,circular lists:1,lists Listing:1,Listing 15.7:1,15.7 is:1,of InsertNodeSorted:1,InsertNodeSorted note:1,tremendous efficiency:1,scanning loop:1,in InsertNodeSorted:1,InsertNodeSorted four:1,node thanks:1,the dummy:1,dummy head/tail/sentinel:1,head/tail/sentinel node:1,node Listing:1,Listing 15.8:1,15.8 is:1,simple application:1,that illustrates:1,linked-list functions:1,15.6 Contrast:1,Contrast Figure:1,15.5 with:1,with Figure:1,15.1 15.5:1,15.5 15.6:1,15.6 and:1,and 15.7:1,15.7 with:1,Listings 15.3:1,15.3 and:1,and 15.4:1,15.4 Yes:1,Yes linked:1,substantial difference:1,difference Make:1,read Knuth:1,Knuth or:1,or Sedgewick:1,like before:1,single line:1,list Hi/Lo:1,Hi/Lo in:1,24 Bytes:1,Bytes In:1,TECHNIQUES Pushing:1,Envelope columns:1,columns I:1,of David:1,Stafford’s fiendish:1,fiendish programming:1,programming puzzles:1,puzzles Write:1,C-callable function:1,int Not:1,big deal—except:1,deal—except that:1,David had:1,done it:1,less Such:1,Such routines:1,routines soon:1,soon began:1,began coming:1,all angles:1,angles However:1,However and:1,I hate:1,correspondents were:1,were very:1,very pleased:1,had bested:1,bested David:1,David no:1,yet met:1,met the:1,the challenge—because:1,challenge—because most:1,folks missed:1,When David:1,David said:1,said Write:1,int in:1,less he:1,he meant:1,meant Write:1,Write the:1,the hi:1,hi and:1,the lo:1,lo functions:1,less combined:1,combined Oh:1,Oh Yes:1,Yes a:1,24-byte hi/lo:1,hi/lo function:1,possible anatomically:1,anatomically improbable:1,improbable as:1,seem Which:1,Which I:1,guess goes:1,David’s puzzles:1,puzzles seems:1,than impossible:1,impossible odds:1,are you’re:1,something Listing:1,Listing 15.9:1,15.9 is:1,is David’s:1,David’s 24-byte:1,24-byte solution:1,solution from:1,lot may:1,learned if:1,one reads:1,reads closely:1,closely enough:1,enough Before:1,I end:1,chapter let:1,me say:1,of feedback:1,feedback from:1,readers and:1,much appreciated:1,appreciated Keep:1,Keep those:1,those cards:1,cards letters:1,and email:1,email messages:1,messages coming:1,coming And:1,know Jeannie:1,Schweigert have:1,have her:1,her drop:1,how she’s:1,she’s doing:1,doing these:1,days Chapter:1,Chapter 16:1,16 There:1,Code Lessons:1,Lessons Learned:1,Learned in:1,the Pursuit:1,Pursuit of:1,the Ultimate:1,Ultimate Word:1,Word Counter:1,Counter I:1,reading an:1,C development:1,for Windows:1,Windows in:1,a past:1,past issue:1,Week In:1,lower left:1,corner was:1,familiar box:1,box listing:1,listing the:1,the 10:1,10 leading:1,leading concerns:1,concerns of:1,of corporate:1,buyers when:1,C Boiled:1,Boiled down:1,list looked:1,of descending:1,descending importance:1,importance to:1,to buyers:1,buyers 1:1,1 Debugging:1,Debugging 2:1,2 Documentation:1,Documentation 3:1,3 Windows:1,tools 4:1,4 High-level:1,High-level Windows:1,Windows support:1,support 5:1,5 Class:1,Class library:1,library 6:1,6 Development:1,Development cycle:1,cycle efficiency:1,efficiency 7:1,7 Object-oriented:1,Object-oriented development:1,development aids:1,aids 8:1,8 Programming:1,Programming management:1,management aids:1,aids 9:1,9 Online:1,Online help:1,help 10:1,10 Windows:1,development cycle:1,cycle automation:1,automation Is:1,Is something:1,something missing:1,missing here:1,bet your:1,your maximum:1,maximum gluteus:1,gluteus something’s:1,something’s missing—nowhere:1,missing—nowhere on:1,there so:1,runs I’m:1,everything but:1,but optimization:1,even down:1,down there:1,there at:1,at number:1,number 10:1,10 below:1,below online:1,online help:1,help Ye:1,gods and:1,and little:1,little fishes:1,fishes We:1,from LA:1,LA to:1,York instead:1,a cleaner:1,cleaner bathroom:1,bathroom who:1,choose a:1,a painting:1,painting from:1,a Holiday:1,Holiday Inn:1,Inn over:1,a Matisse:1,Matisse because:1,a fancier:1,fancier frame:1,frame who:1,would buy:1,a Yugo:1,Yugo instead:1,instead of—well:1,of—well hell:1,hell anything—because:1,anything—because it:1,nice owner’s:1,owner’s manual:1,manual and:1,attractive keys:1,keys We:1,are focusing:1,on means:1,means and:1,have forgotten:1,forgotten about:1,about ends:1,ends We:1,no programming:1,programming souls:1,souls Counting:1,Counting Words:1,Words in:1,Hurry What:1,What are:1,we to:1,safely guess:1,few corporate:1,buyers ever:1,ever enter:1,enter optimization:1,optimization contests:1,contests Most:1,readers do:1,do however:1,fact far:1,thought ever:1,ever would:1,that gladdens:1,gladdens me:1,no end:1,issued my:1,a Pushing:1,Envelope column:1,TECHNIQUES back:1,1991 and:1,was deluged:1,deluged by:1,by respondents:1,respondents who:1,who one:1,also gather:1,gather do:1,not live:1,live by:1,Week That:1,That initial:1,initial challenge:1,was sparked:1,sparked by:1,column David:1,David Gerrold:1,Gerrold wrote:1,wrote also:1,TECHNIQUES concerning:1,concerning the:1,counting the:1,a document:1,document David:1,David turned:1,pretty interesting:1,interesting optimization:1,optimization issues:1,issues along:1,way David:1,David did:1,did all:1,his coding:1,in Pascal:1,Pascal pointing:1,version would:1,faster his:1,his Pascal:1,Pascal utility:1,utility worked:1,worked properly:1,him It:1,wasn’t however:1,however fast:1,logical starting:1,starting place:1,up word:1,counting would:1,be David’s:1,David’s original:1,original Pascal:1,I’m much:1,with C:1,16.1 is:1,a loose:1,loose approximation:1,David’s word:1,program translated:1,C I:1,left out:1,as handling:1,handling comment:1,comment blocks:1,blocks partly:1,such blocks:1,blocks myself:1,myself and:1,partly so:1,can focus:1,core word-counting:1,code As:1,As Table:1,16.1 indicates:1,16.1 counts:1,counts the:1,a 104448-word:1,104448-word file:1,in 4.6:1,seconds The:1,The file:1,file was:1,was stored:1,16.1 was:1,all optimization:1,optimization enabled:1,enabled A:1,A RAM:1,disk was:1,used partly:1,it returns:1,returns consistent:1,consistent times—no:1,times—no seek:1,seek times:1,times rotational:1,rotational latency:1,latency or:1,or cache:1,cache to:1,to muddy:1,muddy the:1,the waters—and:1,waters—and partly:1,to highlight:1,highlight word-counting:1,word-counting speed:1,than disk:1,speed Table:1,16.1 Word:1,Word count:1,count timings:1,timings Listing:1,Listing Time:1,Time to:1,to Count:1,Count Words:1,Words 16.1:1,16.1 C:1,C 4.6:1,16.2 16.3:1,16.3 C:1,ASM 2.4:1,2.4 seconds:1,16.2 16.4:1,16.4 C:1,ASM w/lookup:1,w/lookup 1.6:1,seconds These:1,the times:1,times taken:1,containing 104448:1,104448 words:1,words timed:1,timed from:1,disk on:1,Listing 16.2:1,16.2 is:1,16.1 modified:1,scans each:1,block for:1,for words:1,16.3 contains:1,assembly function:1,that counts:1,counts words:1,words Used:1,Used together:1,together Listings:1,Listings 16.2:1,16.2 and:1,and 16.3:1,16.3 are:1,16.1 a:1,16.3 is:1,pretty straightforward:1,key code—determining:1,code—determining whether:1,character or:1,or not—is:1,not—is still:1,still done:1,same multiple-sequential-tests:1,multiple-sequential-tests approach:1,generates Which:1,Which Way:1,Way to:1,to Go:1,Go from:1,from Here:1,Here We:1,could perform:1,tests more:1,it’s either:1,either an:1,an apostrophe:1,apostrophe or:1,character at:1,fine-tuning is:1,typically good:1,for speedups:1,speedups of:1,to 20:1,I’ve intentionally:1,intentionally refrained:1,refrained from:1,from implementing:1,implementing this:1,16.3 to:1,avoid pointing:1,pointing you:1,wrong path:1,path what:1,tack altogether:1,altogether Ponder:1,Ponder this:1,character not:1,character it:1,value we:1,a yes/no:1,yes/no status:1,status and:1,nothing else—and:1,else—and that:1,that description:1,description practically:1,practically begs:1,begs for:1,16.4 uses:1,table approach:1,performance another:1,another 50:1,386 this:1,from 4.6:1,4.6 to:1,to 1.6:1,be significant—who:1,significant—who likes:1,wait On:1,in word-counting:1,word-counting a:1,large file:1,file could:1,be 10:1,20 seconds:1,definitely significant:1,significant Listing:1,16.4 features:1,features several:1,interesting tricks:1,tricks First:1,uses LODSB:1,XLAT in:1,succession a:1,very neat:1,neat way:1,a pointed-to:1,pointed-to byte:1,byte advance:1,value indexed:1,table all:1,bytes Interestingly:1,Interestingly Listing:1,16.4 would:1,probably run:1,run quite:1,bit better:1,better still:1,where LODSB:1,XLAT have:1,over conventional:1,conventional instructions:1,however LODSB:1,XLAT lose:1,lose much:1,their appeal:1,appeal and:1,instructions Better:1,yet LODSB:1,XLAT don’t:1,don’t alter:1,flags so:1,flag status:1,status set:1,set before:1,before LODSB:1,LODSB is:1,still around:1,tested after:1,after XLAT:1,XLAT Finally:1,closely you:1,16.4 jumps:1,jumps out:1,actually found:1,found with:1,a duplicate:1,duplicate of:1,the loop-bottom:1,loop-bottom code:1,code placed:1,placed after:1,that increments:1,increments the:1,extra branch:1,branch back:1,loop this:1,this replaces:1,intuitive approach:1,the incrementing:1,incrementing code:1,loop bottom:1,bottom when:1,word isn’t:1,found Although:1,this incurs:1,typically found:1,found only:1,every 5:1,average then:1,branch is:1,is saved:1,saved about:1,about two-thirds:1,how understanding:1,data you’re:1,you’re processing:1,processing allows:1,optimize in:1,ways the:1,can’t Know:1,data So:1,So gosh:1,gosh Listing:1,16.4 is:1,best word-counting:1,universe right:1,right Not:1,hardly If:1,thing my:1,my years:1,of toil:1,toil in:1,this vale:1,vale of:1,of silicon:1,silicon have:1,have taught:1,taught me:1,never a:1,Never Off:1,Off the:1,head I:1,16.4 and:1,since Turbo:1,Profiler reports:1,16.4 88:1,88 percent:1,spent scanning:1,file there’s:1,there’s potential:1,those further:1,significantly However:1,when access:1,hard rather:1,than RAM:1,disk disk:1,access jumps:1,is unrolling:1,loop although:1,is truly:1,truly a:1,last resort:1,resort because:1,make further:1,further changes:1,changes extremely:1,difficult Exhaust:1,Exhaust all:1,optimizations before:1,before unrolling:1,unrolling loops:1,loops Challenges:1,Challenges and:1,and Hazards:1,Hazards The:1,The challenge:1,faster module:1,module to:1,16.4 The:1,that counted:1,my secret:1,secret test:1,test file:1,file fastest:1,fastest on:1,my 20:1,386 would:1,and receive:1,receive Numerous:1,Numerous Valuable:1,Valuable Prizes:1,Prizes No:1,No listings:1,than 200:1,200 lines:1,lines No:1,No complete:1,programs were:1,be accepted:1,accepted submissions:1,be plug-compatible:1,16.4 This:1,encourage people:1,optimizing outside:1,loop Finally:1,16.4 I:1,see functions:1,that approximated:1,approximated the:1,characters by:1,six instead:1,counting actual:1,actual words:1,words So:1,how did:1,the entrants:1,entrants in:1,particular challenge:1,challenge stack:1,up More:1,one claimed:1,claimed a:1,speed-up over:1,my assembly:1,assembly word-counting:1,times On:1,the three-times:1,already realized:1,realized we’re:1,we’re almost:1,almost up:1,faster You:1,course entitled:1,entitled to:1,own opinion:1,opinion but:1,consider an:1,magnitude to:1,significant Truth:1,Truth to:1,tell I:1,didn’t expect:1,a three-times:1,speedup around:1,around two:1,times was:1,mind Which:1,Which just:1,just goes:1,expect if:1,it long:1,different perspectives:1,perspectives The:1,most potent:1,potent word-counting:1,word-counting technique:1,technique seems:1,allows handling:1,handling two:1,simultaneously This:1,of technique:1,technique one:1,one comes:1,with by:1,by brute-force:1,optimization Thinking:1,Thinking or:1,worse yet:1,yet boasting:1,boasting that:1,is rollescating:1,rollescating on:1,a tightrope:1,tightrope in:1,hurricane you’re:1,you’re due:1,due for:1,a fall:1,fall if:1,drift Case:1,Mathisen’s word-counting:1,program Blinding:1,Blinding Yourself:1,Yourself to:1,a Better:1,Better Approach:1,Approach Not:1,ago Terje:1,Mathisen who:1,introduced earlier:1,book wrote:1,fast word-counting:1,and posted:1,posted it:1,Bix When:1,mean fast:1,fast this:1,optimized like:1,like nobody’s:1,nobody’s business:1,business We’re:1,talking top-quality:1,top-quality code:1,code here:1,here When:1,optimizing came:1,the Bix:1,Bix conferences:1,conferences Terje’s:1,program was:1,was mentioned:1,mentioned and:1,posted the:1,following message:1,message I:1,I challenge:1,challenge BIXens:1,BIXens and:1,especially mabrash:1,mabrash to:1,up significantly:1,significantly I:1,would consider:1,consider 5:1,percent a:1,good result:1,The clear:1,clear implication:1,implication was:1,was That:1,be Naturally:1,Naturally it:1,wasn’t there:1,there ain’t:1,ain’t no:1,code TANSTATFC:1,TANSTATFC I:1,I agree:1,agree it:1,of TANSTAAFL:1,TANSTAAFL I:1,I pored:1,pored over:1,over Terje’s:1,Terje’s 386:1,native-mode code:1,indeed as:1,could imagine:1,imagine consisting:1,few 386:1,native-mode instructions:1,instructions However:1,However one:1,instructions was:1,was this:1,this cb171-1:1,cb171-1 CMP:1,CMP DH:1,DH EBX:1,EAX Harmless:1,Harmless enough:1,enough save:1,First EBX:1,EBX happened:1,be zero:1,a leftover:1,leftover from:1,earlier version:1,out so:1,was superfluous:1,superfluous as:1,a memory-addressing:1,memory-addressing component:1,component this:1,this made:1,use base-only:1,base-only addressing:1,addressing EAX:1,EAX rather:1,than base:1,addressing EBX:1,EAX which:1,which saves:1,386 Second:1,Second Changing:1,Changing the:1,to CMP:1,CMP EAX:1,EAX DH:1,DH saved:1,saved 2:1,2 cycles—just:1,cycles—just enough:1,by good:1,whole program:1,percent CMP:1,mem takes:1,but CMP:1,reg takes:1,only 5:1,cycles you:1,always perform:1,perform CMP:1,CMP with:1,operand on:1,386 Granted:1,Granted CMP:1,reg is:1,mem on:1,was specific:1,curious both:1,both forms:1,forms take:1,take 2:1,486 quite:1,faster eh:1,eh Watch:1,for Luggable:1,Luggable Assumptions:1,Assumptions The:1,learned here:1,to lug:1,lug assumptions:1,may no:1,be valid:1,valid from:1,the 8088/286:1,8088/286 world:1,the wonderful:1,wonderful new:1,new world:1,native-mode programming:1,you’ve slaved:1,slaved over:1,no shape:1,see its:1,its flaws:1,flaws or:1,new perspectives:1,perspectives needed:1,up I’ll:1,bet Terje:1,Terje looked:1,that EBX:1,EAX addressing:1,addressing a:1,hundred times:1,times while:1,while trying:1,didn’t really:1,really see:1,did instead:1,instead he:1,he saw:1,saw what:1,was supposed:1,do Mental:1,Mental shortcuts:1,shortcuts like:1,this are:1,are what:1,what enable:1,language without:1,without overloading:1,overloading after:1,20 instructions:1,major problem:1,when looking:1,over familiar:1,fruitful optimization:1,optimization came:1,came of:1,to happiness:1,happiness riches:1,riches and:1,and wondrous:1,wondrous performance:1,performance After:1,After getting:1,getting my:1,my 5:1,speedup I:1,mentioned to:1,to Terje:1,Terje the:1,table This:1,This predated:1,predated the:1,the arrival:1,arrival of:1,of entries:1,entries for:1,optimization contest:1,contest He:1,had considered:1,considered it:1,worthwhile He:1,He couldn’t:1,couldn’t shake:1,shake the:1,thought though:1,to poke:1,poke around:1,day voila:1,voila he:1,posted a:1,his word:1,program WC50:1,WC50 that:1,version I:1,have exact:1,exact numbers:1,numbers but:1,but Terje’s:1,Terje’s preliminary:1,preliminary estimate:1,estimate was:1,was 80:1,counting including:1,including disk:1,cache access:1,access time—proceeds:1,time—proceeds at:1,3 MB:1,MB per:1,Even allowing:1,486 those:1,impressive numbers:1,numbers indeed:1,make though:1,biggest optimization:1,optimization barrier:1,barrier that:1,Terje faced:1,thought he:1,possible Once:1,Once he:1,he opened:1,opened up:1,were faster:1,and looked:1,looked beyond:1,specific approach:1,had so:1,so carefully:1,optimized he:1,the incongruity:1,incongruity of:1,Terje’s willingness:1,consider a:1,speedup significant:1,significant in:1,his later:1,later near-doubling:1,near-doubling of:1,performance Don’t:1,It’s useful:1,in key:1,loops but:1,in approach:1,work far:1,greater wonders:1,wonders than:1,any amount:1,counting can:1,can By:1,way Terje’s:1,Terje’s WC50:1,WC50 program:1,a full-fledged:1,full-fledged counting:1,counting program:1,counts characters:1,characters words:1,handle multiple:1,multiple files:1,files and:1,you specify:1,that separate:1,separate words:1,desire Source:1,Source code:1,the archive:1,archive WC50:1,WC50 comes:1,in All:1,all it’s:1,nice piece:1,in really:1,wouldn’t call:1,fastest word-counting:1,code though:1,course never:1,so foolish:1,foolish as:1,call anything:1,fastest The:1,The Astonishment:1,Astonishment of:1,of Right-Brain:1,Right-Brain Optimization:1,issued to:1,TECHNIQUES readers:1,a smashing:1,smashing success:1,success with:1,with dozens:1,good entries:1,certainly enjoyed:1,enjoyed it:1,of tricky:1,tricky assembly:1,didn’t write—hard:1,write—hard work:1,work under:1,circumstances It:1,trouble though:1,The winning:1,entry was:1,astonishing example:1,right hands:1,386 it:1,was four:1,at word:1,counting than:1,I provided:1,starting point—and:1,point—and about:1,about 13:1,13 times:1,implementation Attention:1,Attention high-level:1,language chauvinists:1,chauvinists Is:1,speedup getting:1,getting significant:1,significant yet:1,yet Okay:1,maybe word:1,counting isn’t:1,critical application:1,application but:1,how would:1,of improvement:1,your compression:1,compression software:1,your real-time:1,real-time games—or:1,games—or in:1,in Windows:1,Windows graphics:1,The winner:1,winner was:1,was David:1,who at:1,working for:1,International his:1,his entry:1,16.5 Dave:1,Methvin whom:1,whom some:1,recall as:1,a tech:1,tech editor:1,late lamented:1,lamented PC:1,Journal was:1,close second:1,Brown about:1,about whom:1,whom I:1,obviously an:1,close third:1,third as:1,16.2 which:1,which precedes:1,precedes Listing:1,16.5 Those:1,three were:1,were out:1,the pack:1,pack the:1,the fourth-place:1,fourth-place entry:1,entry good:1,as David’s:1,David’s winning:1,entry so:1,David Dave:1,Dave and:1,Mick attained:1,attained a:1,a rarefied:1,rarefied level:1,optimization indeed:1,indeed Table:1,16.2 has:1,entry listed:1,listed the:1,overall counting:1,counting time:1,time including:1,including time:1,program disk:1,disk I/O:1,else the:1,spent counting:1,counting words:1,in ScanBuffer:1,ScanBuffer The:1,time perceived:1,user but:1,value best:1,best reflects:1,entry since:1,is fixed:1,fixed Word-Counting:1,Word-Counting Time:1,Time Table:1,16.2 The:1,top four:1,four word-counting:1,entries Name:1,Name Overall:1,Overall time:1,time ScanBuffer:1,ScanBuffer only:1,only David:1,Stafford Listing:1,16.5 0.61:1,0.61 seconds:1,seconds 0.33:1,0.33 seconds:1,seconds Dave:1,Methvin 0.66:1,0.66 0.39:1,0.39 Mick:1,Brown 0.70:1,0.70 0.41:1,0.41 Wendell:1,Wendell Neubert:1,Neubert 0.92:1,0.92 0.65:1,0.65 For:1,For Comparison:1,Comparison Michael:1,Abrash assembly:1,16.1 1.73:1,1.73 1.44:1,1.44 Michael:1,Abrash C:1,16.4 4.70:1,4.70 4.43:1,4.43 Note:1,Note All:1,measured on:1,386 DX:1,DX Levels:1,Levels of:1,Optimization Three:1,Three levels:1,optimization were:1,were evident:1,evident in:1,the word-counting:1,received in:1,my challenge:1,challenge I’d:1,I’d briefly:1,describe them:1,as fine-tuning:1,fine-tuning new:1,and table-driven:1,latter categories:1,categories produce:1,produce faster:1,token they:1,are harder:1,design harder:1,understand so:1,they’re suitable:1,demanding applications:1,applications Heck:1,even guarantee:1,Stafford’s entry:1,entry works:1,perfectly although:1,although knowing:1,knowing him:1,him it:1,it probably:1,probably does:1,and cryptic:1,cryptic the:1,greater the:1,for obscure:1,obscure bugs:1,bugs Remember:1,Remember optimize:1,optimize only:1,when needed:1,stop when:1,when further:1,noticed Optimization:1,Optimization that’s:1,not perceptible:1,perceptible to:1,like buying:1,buying Telly:1,Telly Savalas:1,Savalas a:1,a comb:1,comb it’s:1,any harm:1,time Optimization:1,Optimization Level:1,Level 1:1,1 Good:1,Good Code:1,first level:1,involves fine-tuning:1,fine-tuning and:1,and clever:1,clever use:1,basic framework:1,implemented more:1,efficiently One:1,obvious level:1,1 optimization:1,than dword:1,dword counter:1,counter ScanBuffer:1,ScanBuffer can:1,handle more:1,64K bytes:1,than 32K:1,32K words:1,words can:1,found Given:1,logical step:1,INC rather:1,than ADD/ADC:1,ADD/ADC to:1,keep count:1,count adding:1,the tally:1,tally into:1,full 32-bit:1,32-bit count:1,count only:1,upon exiting:1,function Another:1,useful optimization:1,is aligning:1,aligning loop:1,loop tops:1,tops and:1,other branch:1,destinations to:1,to word:1,yet dword:1,dword boundaries:1,boundaries Eliminating:1,Eliminating branches:1,branches was:1,very popular:1,popular as:1,on x86:1,processors Branches:1,Branches were:1,were eliminated:1,eliminated in:1,ways Many:1,does pay:1,off nicely:1,nicely A:1,caution Some:1,simply stacking:1,stacking repetitions:1,DEC CX/JZ:1,CX/JZ appearing:1,appearing after:1,each repetition:1,repetition to:1,buffer Part:1,times you:1,of repetitions:1,and count:1,down only:1,once each:1,loop In:1,handle repetition:1,repetition counts:1,counts that:1,aren’t exact:1,exact multiples:1,unrolling factor:1,factor you:1,must enter:1,branching into:1,whatever fraction:1,of unrolled:1,unrolled repetitions:1,repetitions is:1,thing come:1,out right:1,right Listing:1,16.5 QSCAN3.ASM:1,QSCAN3.ASM illustrates:1,technique Another:1,Another effective:1,effective optimization:1,LODSW rather:1,than LODSB:1,LODSB thereby:1,thereby processing:1,processing two:1,access This:1,with LODSW:1,LODSW looping:1,most only:1,bytes Cutting:1,Cutting down:1,to loop:1,the branching:1,branching story:1,story More:1,More often:1,code also:1,also branched:1,branched in:1,word There:1,reduce this:1,branching in:1,eliminate it:1,it entirely:1,most straightforward:1,straightforward way:1,reduce such:1,such branching:1,employ two:1,loops One:1,One loop:1,non-separator and:1,separator This:1,indicate the:1,that state:1,is implied:1,by whichever:1,whichever loop:1,currently executing:1,executing This:1,This considerably:1,considerably simplifies:1,simplifies and:1,and streamlines:1,streamlines the:1,16.6 contributed:1,contributed by:1,by Willem:1,Willem Clements:1,Clements of:1,of Granada:1,Granada Spain:1,Spain illustrates:1,of level:1,1 optimizations:1,the two-loop:1,two-loop approach:1,16 rather:1,than 32-bit:1,32-bit counter:1,LODSW Together:1,optimizations made:1,made Willem’s:1,Willem’s code:1,code nearly:1,as mine:1,mine in:1,16.4 A:1,details could:1,could stand:1,stand improvement:1,improvement for:1,example AND:1,AND AXAX:1,AXAX is:1,a shorter:1,shorter way:1,zero than:1,CMP AX0:1,AX0 and:1,and ALIGN:1,ALIGN 2:1,2 could:1,Nonetheless this:1,also fairly:1,reasonably easy:1,understand In:1,short this:1,how an:1,of hand-optimization:1,hand-optimization might:1,might accomplish:1,accomplish significantly:1,significantly improved:1,reasonable cost:1,in complexity:1,is adequate:1,adequate for:1,is beyond:1,the abilities:1,abilities of:1,programmers Level:1,New Perspective:1,Perspective The:1,second level:1,of breaking:1,thinking established:1,established by:1,code Some:1,Some entrants:1,entrants clearly:1,clearly did:1,did exactly:1,that They:1,They stepped:1,back thought:1,actually needed:1,do rather:1,just improving:1,improving how:1,it already:1,already worked:1,implemented code:1,that sprang:1,sprang from:1,perspective You:1,see one:1,16.6 where:1,where Willem:1,Willem uses:1,uses CMP:1,CMP AX0101H:1,AX0101H to:1,check two:1,once While:1,as nothing:1,doubling up:1,of tests:1,tests it’s:1,that especially:1,when taken:1,loops This:1,break with:1,serial nature:1,a recognition:1,recognition that:1,machine that:1,that transitions:1,transitions from:1,the in:1,state to:1,the not:1,back counting:1,not both:1,those transitions:1,transitions Willem:1,Willem says:1,says in:1,effect We’re:1,We’re in:1,are non-separators:1,non-separators then:1,then we’re:1,word else:1,else we’re:1,word so:1,so count:1,state That’s:1,really quite:1,from saying:1,saying as:1,originally did:1,did If:1,non-separator then:1,separator then:1,then count:1,word Willem:1,Willem has:1,has moved:1,moved away:1,the all-in-one:1,all-in-one approach:1,approach splitting:1,into state-specific:1,state-specific chunks:1,chunks that:1,each does:1,does only:1,particular state:1,state Another:1,Another example:1,perspective is:1,is counting:1,non-separator follows:1,separator at:1,than waiting:1,separator following:1,following a:1,non-separator at:1,word My:1,Illowsky describes:1,thought process:1,process leading:1,approach thusly:1,thusly I:1,as closely:1,world nature:1,things my:1,program models:1,models It:1,seems somehow:1,somehow wrong:1,wrong to:1,a non-word:1,non-word A:1,transition it:1,characters Thought:1,Thought of:1,have counted:1,it first:1,first detected:1,the group:1,group Had:1,Had you:1,you done:1,this your:1,your main:1,possible last:1,last transition:1,transition or:1,or deal:1,the semantics:1,semantics of:1,in CharValue:1,CharValue John:1,John Richardson:1,Richardson of:1,York contributed:1,contributed a:1,different perspective:1,perspective in:1,hardware perspective:1,perspective John:1,John eliminated:1,all branches:1,for detecting:1,detecting word:1,word edges:1,Listing 16.7:1,16.7 As:1,As John:1,John explains:1,explains it:1,My next:1,next shot:1,shot was:1,loop To:1,I reached:1,reached back:1,my college:1,college hardware:1,hardware courses:1,courses I:1,noticed that:1,were really:1,really looking:1,edge triggered:1,triggered device:1,device we:1,count each:1,the I’m:1,character state:1,state goes:1,goes from:1,zero Remembering:1,Remembering that:1,XOR on:1,two single-bit:1,single-bit values:1,return whether:1,different or:1,same I:1,transition counter:1,counter The:1,The counter:1,counter triggers:1,triggers every:1,word begins:1,begins or:1,ends John:1,John later:1,later divides:1,transition count:1,count Food:1,Food for:1,for thought:1,thought It’s:1,use CMP:1,and ADC:1,detect words:1,words without:1,without branching:1,branching John’s:1,approach makes:1,that word-counting:1,word-counting is:1,simple state:1,interesting part:1,is building:1,fastest state:1,machine Level:1,Level 3:1,3 Breakthrough:1,Breakthrough The:1,optimization are:1,not sharply:1,sharply defined:1,defined In:1,sense level:1,3 optimization:1,like levels:1,levels 1:1,so At:1,At level:1,3 one:1,one takes:1,takes whatever:1,whatever level:1,2 perspective:1,perspective seems:1,most promising:1,promising and:1,and implements:1,implements it:1,x86 Even:1,2 at:1,3 this:1,means breaking:1,of familiar:1,familiar patterns:1,thinking In:1,counting level:1,3 means:1,means building:1,a table-driven:1,machine dedicated:1,processing a:1,branching This:1,optimization strips:1,strips away:1,away many:1,the abstractions:1,abstractions we:1,usually use:1,as loops:1,loops tests:1,and named:1,named variables—look:1,variables—look back:1,16.5 and:1,mean Only:1,Only a:1,people reached:1,reached this:1,think any:1,them did:1,without long:1,long hard:1,hard thinking:1,thinking David:1,Stafford’s final:1,final entry:1,entry that:1,present as:1,16.5 was:1,fifth entry:1,entry he:1,key concept:1,concept at:1,massive 64K:1,processes byte:1,byte sequences:1,sequences directly:1,into word-count:1,word-count actions:1,actions With:1,With such:1,table it’s:1,appropriate action:1,action for:1,instructions next:1,next I’m:1,the inspired:1,inspired and:1,highly unusual:1,16.5 does:1,that Before:1,Before assembling:1,16.5 you:1,must run:1,Listing 16.8:1,16.8 to:1,an include:1,file defining:1,table When:1,you assemble:1,assemble Listing:1,16.5 TASM:1,TASM will:1,will report:1,report a:1,location counter:1,counter overflow:1,overflow warning:1,warning ignore:1,it David’s:1,David’s approach:1,itself although:1,although his:1,implementation arguably:1,arguably is:1,not Consider:1,Consider any:1,any three:1,three sequential:1,sequential bytes:1,buffer Those:1,bytes define:1,define two:1,potential places:1,word might:1,counted as:1,16.1 Given:1,the separator/non-separator:1,separator/non-separator states:1,bytes you:1,instantly determine:1,if somewhere:1,sequence there:1,non-separator followed:1,separator Note:1,word can:1,counted per:1,per three-byte:1,three-byte sequence:1,separator/not statuses:1,statuses of:1,each set:1,1 count:1,0 don’t:1,possible Assuming:1,separator/not status:1,flag this:1,easily accomplished:1,lookup in:1,flag and:1,16.2 Remember:1,we’re counting:1,counting 7-bit:1,7-bit ASCII:1,ASCII here:1,here so:1,ignored Thus:1,Thus David:1,the word/not:1,word/not status:1,main word:1,count simply:1,by getting:1,bytes working:1,table adding:1,value found:1,A sequence:1,of MOV/ADC/ADD:1,MOV/ADC/ADD suffices:1,all word-counting:1,word-counting tasks:1,tasks for:1,a pair:1,bytes Three:1,Three instructions:1,instructions no:1,no branches—pretty:1,branches—pretty nearly:1,nearly perfect:1,perfect code:1,locations Figure:1,locations One:1,One detail:1,detail remains:1,remains to:1,be attended:1,attended to:1,flag for:1,for next:1,non-separator David:1,David does:1,a bizarre:1,bizarre and:1,and incredibly:1,incredibly effective:1,effective way:1,way He:1,He presets:1,presets the:1,those entries:1,entries looked:1,by non-separators:1,non-separators When:1,a non-separator’s:1,non-separator’s lookup:1,lookup entry:1,count it:1,will produce:1,carry as:1,desired The:1,The high:1,is masked:1,masked off:1,off before:1,being added:1,total count:1,count so:1,so David:1,essentially using:1,different parts:1,count variables:1,variables for:1,for different:1,different purposes:1,purposes counting:1,status Figure:1,status There:1,interesting details:1,details in:1,code including:1,unrolling of:1,loop 64:1,that 256:1,256 bytes:1,row are:1,processed without:1,single branch:1,branch Unfortunately:1,Unfortunately I:1,16.5 any:1,further Perhaps:1,Perhaps that’s:1,so unfortunate:1,unfortunate after:1,I’d hate:1,to deny:1,deny you:1,of discovering:1,discovering the:1,this rather:1,rather remarkable:1,code yourself:1,yourself I:1,for David’s:1,David’s inner:1,is 6.5:1,6.5 cycles:1,byte processed:1,processed and:1,his routine:1,routine overhead:1,is 7.9:1,7.9 cycles/byte:1,cycles/byte The:1,code clocked:1,clocked in:1,around 100:1,100 cycles/byte:1,cycles/byte Enough:1,trust Enough:1,Enough Word:1,Word Counting:1,Counting Already:1,Already Before:1,I finish:1,Mathisen’s WC:1,WC word-counting:1,program which:1,mentioned previously:1,available with:1,source on:1,Bix is:1,ballpark with:1,with David’s:1,more Terje’s:1,program handles:1,handles 8-bit:1,8-bit ASCII:1,ASCII counts:1,counts lines:1,as words:1,supports user-definable:1,user-definable separator:1,separator sets:1,sets It’s:1,It’s wonderful:1,wonderful code:1,great word-counting:1,word-counting utility:1,utility By:1,way Terje:1,Terje builds:1,builds his:1,his 64K:1,fly at:1,at program:1,program initialization:1,initialization this:1,for customized:1,customized tables:1,tables shrinks:1,shrinks the:1,EXE and:1,to Terje’s:1,Terje’s calculations:1,calculations takes:1,takes less:1,than loading:1,table off:1,off disk:1,disk as:1,EXE So:1,So has:1,has David:1,David written:1,possible word-counting:1,Well maybe—but:1,maybe—but I:1,from Terry:1,Terry Holmes:1,Holmes of:1,San Rafael:1,Rafael California:1,California that:1,theoretical maximum:1,of native:1,386 word-counting:1,at 5.5:1,5.5 cycles/byte:1,cycles/byte which:1,be significantly:1,than David’s:1,code Terry:1,Terry alas:1,alas didn’t:1,implement his:1,but maybe:1,maybe I’ll:1,it someday:1,someday It’d:1,It’d be:1,fun for:1,for sure—but:1,sure—but jeez:1,jeez I’ve:1,I’ve got:1,got real:1,17 The:1,The Triumph:1,Triumph of:1,of Algorithmic:1,Algorithmic Optimization:1,a Cellular:1,Cellular Automata:1,Automata Game:1,Game I’ve:1,life discussing:1,discussing assembly:1,consider to:1,and underappreciated:1,underappreciated topic:1,topic However:1,However I’d:1,than assembly:1,language Assembly:1,Assembly is:1,essential for:1,for absolute:1,absolute maximum:1,performance but:1,only ingredient:1,ingredient necessary:1,not sufficient:1,sufficient if:1,my drift—and:1,drift—and not:1,even necessary:1,not maximum:1,performance You’ve:1,You’ve heard:1,thousand times:1,times Optimize:1,Optimize your:1,algorithm first:1,first Devise:1,Devise new:1,approaches Or:1,as Knuth:1,Knuth said:1,said Premature:1,Premature optimization:1,all evil:1,evil This:1,course old:1,hat stuff:1,stuff you:1,know like:1,hand Or:1,As Jeff:1,Duntemann pointed:1,day performance:1,made not:1,not born:1,born While:1,I’m merrily:1,merrily gallivanting:1,gallivanting around:1,book optimizing:1,optimizing 486:1,486 pipelining:1,pipelining and:1,and turning:1,turning simple:1,simple tasks:1,tasks into:1,into horribly:1,horribly complicated:1,and terrifyingly:1,terrifyingly fast:1,fast state:1,state machines:1,machines many:1,still developing:1,developing your:1,your basic:1,optimization skills:1,skills I:1,to shortchange:1,shortchange those:1,category so:1,some high-level:1,applied by:1,by mere:1,mere mortals:1,mortals within:1,reasonable period:1,time We’re:1,examine a:1,complete optimization:1,process from:1,a 50-times:1,50-times speed-up:1,speed-up without:1,using one:1,of perspective—how:1,perspective—how you:1,data Conway’s:1,Conway’s Game:1,is Conway’s:1,Conway’s famous:1,famous Game:1,Life long-ago:1,long-ago favorite:1,the hackers:1,hackers at:1,at MIT’s:1,MIT’s AI:1,AI Lab:1,Lab If:1,it let:1,me assure:1,you Life:1,neat and:1,little hypnotic:1,hypnotic Fractals:1,Fractals have:1,hot graphics:1,recent years:1,years but:1,for eye-catching:1,dazzle Life:1,beat Of:1,course eye-catching:1,dazzle requires:1,requires real-time:1,real-time performance—lots:1,performance—lots of:1,pixels help:1,help too—and:1,too—and there’s:1,the rub:1,rub When:1,When there:1,are say:1,say 40000:1,40000 cells:1,cells to:1,simple straightforward:1,implementation just:1,doesn’t cut:1,cut it:1,486 Happily:1,Happily though:1,up Life:1,illustrate a:1,optimization principles:1,principles as:1,show First:1,ground rules:1,Life implement:1,straightforward version:1,then speed:1,speed that:1,that version:1,version up:1,times without:1,any drastically:1,drastically different:1,approaches or:1,little tame:1,tame for:1,patient for:1,for after:1,we’ll haul:1,haul out:1,big guns:1,guns and:1,the 30:1,30 to:1,speed-up range:1,range Then:1,Then in:1,how several:1,several programmers:1,really floored:1,floored it:1,in taking:1,taking me:1,Challenge which:1,which involved:1,The Rules:1,Rules of:1,simple There:1,a cellmap:1,cellmap consisting:1,a rectangular:1,rectangular matrix:1,may initially:1,either on:1,off Each:1,has eight:1,neighbors two:1,two horizontally:1,horizontally two:1,two vertically:1,four diagonally:1,diagonally For:1,each succeeding:1,succeeding generation:1,cells the:1,logic determines:1,cell will:1,off according:1,rules If:1,has either:1,cell turns:1,three on:1,neighbors in:1,rules there:1,there are—but:1,are—but they:1,they give:1,give rise:1,astonishing variety:1,of forms:1,forms including:1,including patterns:1,that spin:1,spin march:1,march across:1,and explode:1,explode It’s:1,Life than:1,describe it:1,17.1 together:1,display functions:1,17.2 is:1,straightforward A:1,A cellmap:1,cellmap is:1,that’s accessible:1,accessible through:1,through member:1,set clear:1,clear and:1,test cell:1,a member:1,member function:1,generation Calculating:1,generation involves:1,other member:1,state given:1,on-cells and:1,cell’s current:1,only complication:1,next generation’s:1,generation’s cells:1,another cellmap:1,original cellmap:1,cellmap This:1,This keeps:1,keeps us:1,from corrupting:1,corrupting the:1,current generation’s:1,generation’s cellmap:1,cellmap before:1,done using:1,generation All:1,clean compact:1,and elegant:1,elegant implementation:1,Life Were:1,Were it:1,molasses we:1,stop right:1,right here:1,here Where:1,Where Does:1,Does the:1,Time Go:1,Go How:1,17.1 Table:1,17.1 does:1,does fewer:1,three 96x96:1,96x96 generations:1,The times:1,17.1 are:1,for 1000:1,generations of:1,a 96x96:1,96x96 cell:1,map with:1,with seed:1,seed 1:1,1 LIMIT_18_HZ:1,LIMIT_18_HZ 0:1,0 WRAP_EDGES:1,WRAP_EDGES 1:1,and magnifier:1,magnifier 2:1,2 running:1,486 Since:1,Since my:1,my target:1,target is:1,is 18:1,cellmap on:1,rather wide:1,wide margin—75:1,margin—75 times:1,times too:1,slow in:1,fact You:1,say we:1,little optimizing:1,optimizing to:1,is Only:1,matters Use:1,profiler or:1,or risk:1,risk making:1,a fool:1,fool of:1,of yourself:1,yourself Consider:1,Consider Listings:1,17.2 Where:1,for significant:1,significant speed-up:1,speed-up lies:1,lies I’ll:1,thought there:1,considerable potential—in:1,potential—in draw_pixel:1,draw_pixel As:1,programmer of:1,high-speed graphics:1,figured any:1,drawing function:1,only written:1,in C/C:1,C/C but:1,also recalculated:1,recalculated the:1,address from:1,scratch for:1,pixel would:1,optimization targets:1,targets I:1,also expected:1,expected to:1,get major:1,major gains:1,gains out:1,a Ping-Pong:1,Ping-Pong arrangement:1,arrangement so:1,new cellmap:1,cellmap back:1,to current_map:1,current_map after:1,after calculating:1,generation I:1,was wrong:1,wrong Wrong:1,wrong But:1,was smart:1,profiler before:1,before actually:1,actually writing:1,writing any:1,code Table:1,shows where:1,actually goes:1,goes in:1,17.2 As:1,by draw_pixel:1,draw_pixel copy_cells:1,copy_cells and:1,everything other:1,than noise:1,noise We:1,could optimize:1,optimize these:1,routines right:1,executing instantaneously:1,instantaneously and:1,what It:1,slightest perceptible:1,runs Given:1,present state:1,implementation the:1,only areas:1,areas worth:1,worth looking:1,at for:1,for possible:1,possible optimizations:1,are cell_state:1,next_generation It’s:1,noting though:1,reason draw_pixel:1,draw_pixel doesn’t:1,much affect:1,17.1 we’re:1,we’re smart:1,redraw pixels:1,pixels only:1,their states:1,states change:1,change rather:1,than during:1,during every:1,every generation:1,generation Detecting:1,Detecting and:1,eliminating redundant:1,redundant operations:1,potent optimization:1,extremely useful:1,Hazards and:1,and Advantages:1,of Abstraction:1,Abstraction How:1,up cell_state:1,next_generation I’ll:1,how not:1,it By:1,writing those:1,those member:1,It’s tempting:1,that cell_state:1,is figure:1,why cell_state:1,then address:1,that aspect:1,program directly:1,directly Once:1,mind isn’t:1,isn’t assembly:1,assembly it’s…plastics:1,it’s…plastics No:1,No actually:1,actually it’s:1,it’s abstraction:1,abstraction Well-written:1,Well-written C:1,especially C:1,abstract models:1,models For:1,17.1 essentially:1,essentially creates:1,new programming:1,programming language:1,which cells:1,are tangible:1,tangible things:1,things with:1,with built-in:1,built-in manipulation:1,manipulation instructions:1,instructions Given:1,cellmap member:1,functions you:1,even need:1,format This:1,saves programming:1,and bugs:1,and frees:1,frees you:1,the application’s:1,application’s needs:1,needs rather:1,than implementation:1,details However:1,you never:1,never look:1,look beneath:1,the abstract:1,abstract model:1,model at:1,details you:1,various operations:1,without that:1,have largely:1,largely surrendered:1,surrendered control:1,over performance:1,performance Having:1,me hasten:1,hasten to:1,difference even:1,purely abstract:1,abstract level:1,level For:1,large unordered:1,unordered data:1,high-level Quicksort:1,Quicksort will:1,will beat:1,beat the:1,the pants:1,pants off:1,the best-implemented:1,best-implemented insertion:1,sort you:1,imagine Still:1,Still you:1,can optimize:1,here til:1,til doomsday:1,doomsday and:1,fast algorithm:1,algorithm running:1,abstract programming:1,model you’ll:1,you’ll almost:1,certainly end:1,17.1 the:1,abstraction that’s:1,that’s killing:1,killing us:1,neighbors with:1,eight completely:1,completely independent:1,operations requiring:1,requiring eight:1,eight calls:1,and eight:1,eight calculations:1,cell address:1,and cell:1,cell mask:1,storage the:1,fixed relationship:1,relationship to:1,addresses and:1,masks of:1,eight can:1,found very:1,easily via:1,via hard-wired:1,hard-wired offsets:1,offsets and:1,shifts once:1,mask of:1,known There’s:1,a kicker:1,kicker here:1,the counting:1,counting of:1,cellmap When:1,When cellmap:1,cellmap wrapping:1,cellmap becomes:1,becomes essentially:1,essentially a:1,a toroid:1,toroid with:1,edge joined:1,joined seamlessly:1,seamlessly to:1,opposite edge:1,edge as:1,to having:1,of off-cells:1,off-cells neighbors:1,that reside:1,reside on:1,cellmap can’t:1,standard fixed:1,fixed offset:1,offset as:1,17.1 So:1,by hard-wiring:1,hard-wiring our:1,our neighbor-counting:1,neighbor-counting for:1,the bit-per-cell:1,bit-per-cell cellmap:1,format but:1,seems we’d:1,we’d need:1,of conditional:1,conditional code:1,handle wrapping:1,wrapping and:1,things back:1,back down:1,again Figure:1,complications Figure:1,complications When:1,problem doesn’t:1,optimization make:1,a practice:1,practice to:1,problem definition:1,definition to:1,efficiency In:1,case we’ll:1,we’ll change:1,problem by:1,putting padding:1,bytes around:1,and duplicating:1,opposite side:1,side as:1,17.2 That:1,hard-wired neighbor:1,count will:1,find exactly:1,it should—the:1,should—the opposite:1,opposite edge—without:1,edge—without any:1,any special:1,But doesn’t:1,doesn’t that:1,extra copying:1,copying of:1,edges take:1,time Sure:1,Sure but:1,little we:1,build it:1,cellmap copying:1,copying function:1,then frankly:1,frankly we:1,even notice:1,it Avoiding:1,Avoiding tens:1,tens or:1,of calls:1,cell_state on:1,hand will:1,noticeable Listing:1,the alterations:1,alterations to:1,17.1 required:1,hard-wired neighbor-counting:1,neighbor-counting function:1,minor change:1,truth implemented:1,in about:1,half an:1,code significantly:1,significantly larger—but:1,larger—but Listing:1,is 3.6:1,3.6 times:1,17.1 as:1,17.1 We’re:1,We’re up:1,10 generations:1,486 not:1,not where:1,improvement Figure:1,solution Figure:1,solution In:1,17.3 note:1,the padded:1,padded cellmap:1,cellmap edges:1,the alteration:1,the member:1,padding Also:1,width now:1,now has:1,eight to:1,facilitate the:1,opposite padding:1,bytes We:1,have decreased:1,decreased the:1,the generality:1,generality of:1,in exchange:1,for better:1,very common:1,common trade-off:1,trade-off as:1,as common:1,common as:1,as trading:1,trading memory:1,rule the:1,slower it:1,always but:1,but often:1,implement it:1,often improve:1,deal by:1,by implementing:1,implementing only:1,of generality:1,generality you:1,need but:1,time decreased:1,decreased generality:1,generality makes:1,change or:1,or port:1,port the:1,program at:1,some later:1,later date:1,date A:1,A Game:1,implementation such:1,17.1 that’s:1,that’s built:1,on set_cell:1,set_cell clear_cell:1,clear_cell and:1,and get_cell:1,get_cell is:1,completely general:1,format simply:1,the constructor:1,constructor and:1,functions Listing:1,is harder:1,change because:1,because count_neighbors:1,count_neighbors would:1,other functions:1,gotten under:1,hood and:1,format a:1,and gotten:1,gotten impressive:1,results But:1,But now:1,now count_neighbors:1,count_neighbors is:1,for optimized:1,optimized counting:1,still taking:1,up more:1,time Maybe:1,Maybe now:1,assembly Not:1,hardly Heavy-Duty:1,Heavy-Duty C:1,C Optimization:1,Optimization Before:1,assembly we:1,we still:1,perform C:1,C optimization:1,that better:1,better fits:1,fits the:1,application It:1,made much:1,sense if:1,had looked:1,looked for:1,new approach:1,optimization step:1,step but:1,cover straightforward:1,straightforward C:1,optimizations at:1,the mind-bending:1,mind-bending stuff:1,stuff a:1,later Right:1,now let’s:1,optimizations Listing:1,C optimized:1,17.4 and:1,17.3 are:1,functionally the:1,how next_generation:1,implemented Only:1,Only next_generation:1,17.4 the:1,is otherwise:1,otherwise identical:1,17.4 applies:1,applies the:1,to next_generation:1,next_generation The:1,The neighbor-counting:1,neighbor-counting code:1,is brought:1,into next_generation:1,next_generation eliminating:1,eliminating many:1,many function:1,calculations all:1,all multiplies:1,multiplies are:1,and addition:1,all cells:1,accessed directly:1,via pointers:1,masks eliminating:1,remaining function:1,achieved the:1,desired 18:1,second albeit:1,albeit only:1,at 96x96:1,96x96 The:1,The define:1,define that:1,that enables:1,enables code:1,code limiting:1,to 18:1,18 Hz:1,Hz which:1,which seemed:1,seemed ridiculous:1,ridiculous in:1,actually useful:1,for keeping:1,the generations:1,generations from:1,from iterating:1,iterating too:1,quickly when:1,486 especially:1,small cellmap:1,cellmap like:1,like 48x48:1,48x48 We’ve:1,We’ve sped:1,sped things:1,increase our:1,our speed:1,speed another:1,another ten:1,reach our:1,our goal:1,of 200x200:1,200x200 at:1,at 18:1,386 It’s:1,It’s undoubtedly:1,undoubtedly possible:1,17.4 further:1,by fine-tuning:1,fine-tuning the:1,no tremendous:1,way Once:1,Once you’ve:1,you’ve reached:1,fine-tuning pointer:1,pointer usage:1,C you’ve:1,you’ve become:1,become compiler-dependent:1,compiler-dependent you:1,you therefore:1,therefore might:1,well go:1,McCoy We’re:1,We’re still:1,not ready:1,though what:1,that lends:1,to vastly:1,The Life:1,Life program:1,section is:1,seven times:1,Listing 17.4—and:1,17.4—and it’s:1,C How:1,this possible:1,possible Here:1,some hints:1,hints After:1,dozen generations:1,generations most:1,cellmap consists:1,the off:1,off state:1,state There:1,cellmap representations:1,representations other:1,one bit-per-pixel:1,bit-per-pixel Cells:1,Cells change:1,state relatively:1,relatively infrequently:1,infrequently Bringing:1,Bringing In:1,the Right:1,Right Brain:1,Brain In:1,previous section:1,section we:1,program could:1,times simply:1,in straightforward:1,straightforward ways:1,ways Now:1,how right-brain:1,right-brain non-linear:1,non-linear optimization:1,four times—and:1,times—and make:1,code simpler:1,simpler Now:1,Now that’s:1,that’s Zen:1,Zen code:1,two objectives:1,achieve in:1,chapter First:1,language up:1,to conceptual:1,conceptual design:1,language kicks:1,in pretty:1,pretty late:1,process Second:1,Second I:1,to saturate:1,saturate your:1,brain with:1,particular optimization:1,problem then:1,then make:1,make space:1,brain to:1,problem Re-Examining:1,Re-Examining the:1,the Task:1,Task Earlier:1,Earlier in:1,straightforward Game:1,implementation then:1,then increased:1,increased performance:1,implementation a:1,less abstract:1,less general:1,general We:1,We made:1,small change:1,format adding:1,adding padding:1,arithmetic would:1,would always:1,major optimizations:1,optimizations were:1,were moving:1,pointers rather:1,than member:1,functions whenever:1,took what:1,already knew:1,knew and:1,efficient Now:1,to re-examine:1,re-examine the:1,this programming:1,programming task:1,task from:1,for things:1,don’t yet:1,yet know:1,to review:1,review what:1,Life consists:1,basic task:1,is evolving:1,evolving a:1,of on:1,neighbors a:1,has and:1,cell’s own:1,own state:1,state If:1,cell stays:1,an on-cell:1,on-cell is:1,off-cell stays:1,any fool:1,fool can:1,arrange things:1,possible Large:1,Large lookup:1,lookup tables:1,tables oddly:1,oddly encoded:1,encoded cellmaps:1,of bit-twiddling:1,bit-twiddling assembly:1,code spring:1,approaches Can’t:1,just feel:1,feel your:1,your adrenaline:1,adrenaline start:1,to pump:1,pump Relax:1,Relax Step:1,back Try:1,to divine:1,divine the:1,true nature:1,check cell:1,determine when:1,a cell’s:1,cell’s state:1,state must:1,change it:1,it appropriately:1,appropriately and:1,possible What:1,What difference:1,perspective make:1,make Let’s:1,Let’s approach:1,approach it:1,way What:1,typical cellmap:1,cellmap look:1,like As:1,happens after:1,few generations:1,generations the:1,only off:1,off but:1,entirely surrounded:1,by off-cells:1,off-cells Also:1,Also cells:1,state infrequently:1,infrequently in:1,generation after:1,few most:1,cells remain:1,generation Do:1,I’m heading:1,heading Do:1,hear a:1,a whisper:1,of inspiration:1,inspiration from:1,brain The:1,implementation stored:1,stored cell:1,as 1-bits:1,1-bits on:1,or 0-bits:1,0-bits off:1,off For:1,each generation:1,cell it:1,it counted:1,operations per:1,per cell:1,cell per:1,per generation:1,generation Suppose:1,average 10:1,state from:1,one generation:1,actual percentage:1,percentage is:1,even lower:1,lower but:1,for illustration:1,illustration Suppose:1,Suppose also:1,cell with:1,byte storing:1,storing not:1,on-cells for:1,cell Figure:1,this format:1,format Then:1,Then rather:1,than counting:1,counting neighbors:1,neighbors each:1,cell and:1,and operate:1,operate directly:1,that But:1,overhead needed:1,counts Well:1,Well each:1,state eight:1,operations would:1,eight neighboring:1,neighboring cells:1,cells But:1,every ten:1,ten cells:1,cells on:1,on average—so:1,average—so the:1,only one-tenth:1,one-tenth that:1,original approach:1,approach Know:1,data Figure:1,format Figure:1,format Acting:1,Acting on:1,on What:1,What We:1,We Know:1,Know Once:1,Once we’ve:1,we’ve changed:1,store neighbor:1,counts as:1,as states:1,states with:1,cell we:1,another performance:1,boost by:1,again examining:1,examining what:1,about our:1,our data:1,data I:1,off during:1,cells have:1,representation for:1,off-cell that:1,neighbors is:1,byte we:1,over scads:1,scads of:1,of unchanged:1,unchanged cells:1,pop simply:1,bytes This:1,than explicitly:1,explicitly testing:1,testing cell:1,and neighbor:1,and lends:1,itself beautifully:1,beautifully to:1,implementation as:1,as REPZ:1,SCASB or:1,little cleverness:1,cleverness REPZ:1,REPZ SCASW:1,SCASW Unfortunately:1,no C:1,scan memory:1,byte that’s:1,that’s non-zero:1,non-zero Listing:1,a Game:1,neighbor-count cell:1,format and:1,about 4.5:1,calculating generations:1,generations that:1,is 4.5:1,faster I’m:1,I’m ignoring:1,text display:1,display than:1,17.4 which:1,no slouch:1,slouch On:1,about 3.5:1,3.5 times:1,17.4 This:1,17.5 must:1,compiled using:1,model Imagine:1,Imagine that—getting:1,that—getting a:1,a four:1,speed-up while:1,while switching:1,switching from:1,The large:1,the 96x96:1,96x96 cellmap:1,17.5 However:1,seeing a:1,fast 200x200:1,two 200x200:1,cellmaps can’t:1,can’t fit:1,single segment:1,segment This:1,be worked:1,for cellmaps:1,cellmaps up:1,size beyond:1,size cellmap:1,cellmap scanning:1,scanning becomes:1,becomes pretty:1,pretty complex:1,efficiently implemented:1,clever programming:1,programming Anyway:1,Anyway using:1,model helps:1,helps illustrate:1,illustrate that:1,data representation:1,representation and:1,processing approach:1,approach you:1,choose that:1,matter most:1,most Optimization:1,Optimization details:1,details like:1,like memory:1,memory models:1,and segments:1,and in-line:1,in-line functions:1,language are:1,are important:1,important but:1,but secondary:1,secondary Let:1,Let your:1,mind roam:1,roam creatively:1,creatively before:1,coding Otherwise:1,writing well-tuned:1,well-tuned slow:1,code Take:1,close look:1,17.5 You:1,17.4 To:1,extent that’s:1,that’s because:1,to hard-wire:1,hard-wire the:1,to wrap:1,wrap around:1,one edge:1,cellmap to:1,other it’s:1,interesting that:1,way but:1,lot easier:1,neighbor-count model:1,model There’s:1,no complex:1,complex mask:1,and pointer:1,pointer management:1,only thing:1,really needs:1,is scanning:1,bytes And:1,haven’t optimized:1,optimized even:1,loop it:1,should really:1,really be:1,be REPZ:1,SCASB In:1,truth none:1,well-optimized and:1,program must:1,large cellmaps:1,cellmaps Also:1,Also of:1,C note:1,note well:1,assembly here:1,here We’ve:1,We’ve gotten:1,gotten more:1,30-times speedup:1,speedup simply:1,by removing:1,removing a:1,abstraction that:1,C encourages:1,encourages and:1,storing and:1,a manner:1,manner appropriate:1,typical nature:1,itself In:1,done some:1,some linear:1,linear left-brained:1,left-brained optimization:1,optimization using:1,and reducing:1,reducing calls:1,some non-linear:1,non-linear right-brained:1,right-brained optimization:1,optimization understanding:1,and listening:1,creative whisper:1,of non-obvious:1,non-obvious solutions:1,solutions No:1,doubt we:1,times improvement:1,improvement with:1,assembly code—but:1,code—but that’s:1,that’s dwarfed:1,dwarfed by:1,30-times improvement:1,improvement so:1,level must:1,come first:1,Challenge That:1,That Ate:1,Ate My:1,My Life:1,recent optimization:1,laid my:1,my community:1,community of:1,of readers:1,possible Game:1,Life generation:1,engine By:1,By engine:1,engine I:1,in input:1,input or:1,or output:1,output only:1,to next-generation:1,next-generation The:1,The time:1,spent updating:1,updating the:1,cellmap was:1,wanted people:1,on Here:1,rules I:1,laid down:1,down for:1,challenge Readers:1,Readers could:1,17.5 except:1,as change:1,representation any:1,way they:1,they liked:1,liked However:1,17.5 under:1,win Engine:1,Engine code:1,in total:1,total excluding:1,excluding the:1,video-related code:1,17.2 Submissions:1,Submissions had:1,to compile/assemble:1,compile/assemble with:1,either C:1,C mode:1,desired and/or:1,and/or TASM:1,TASM All:1,All submissions:1,handle cellmaps:1,cellmaps at:1,least 200x200:1,200x200 in:1,size Assembly:1,language could:1,program C:1,C rather:1,C was:1,was legal:1,legal as:1,as entered:1,entered implementations:1,implementations produced:1,produced the:1,17.5 and:1,17.2 together:1,long All:1,All entries:1,entries would:1,timed on:1,same 33:1,a 256K:1,256K external:1,cache That:1,readers Little:1,Little did:1,realize the:1,challenge it:1,would lay:1,me Entries:1,Entries poured:1,poured in:1,four corners:1,the globe:1,globe Some:1,Some were:1,were plain:1,plain some:1,were brilliant:1,brilliant some:1,were well:1,well berserk:1,berserk Many:1,Many didn’t:1,even work:1,work But:1,But all:1,all had:1,gone through:1,through examined:1,examined for:1,for adherence:1,adherence to:1,rules read:1,read compiled:1,compiled linked:1,linked run:1,and judged:1,judged I:1,a lot—about:1,lot—about a:1,things not:1,process or:1,of laying:1,laying down:1,down challenges:1,challenges to:1,to readers:1,readers Who:1,Who won:1,won What:1,I learn:1,learn To:1,out read:1,on Chapter:1,Chapter 18:1,18 It’s:1,plain Wonderful:1,Wonderful Life:1,Life Optimization:1,Optimization beyond:1,the Pale:1,Pale When:1,school my:1,my gym:1,gym teacher:1,teacher had:1,had us:1,us run:1,a race:1,race around:1,the soccer:1,soccer field:1,field or:1,or rather:1,rather around:1,course marked:1,marked with:1,with cones:1,cones that:1,that roughly:1,roughly outlined:1,outlined the:1,field I:1,quickly settled:1,settled into:1,into second:1,second place:1,place behind:1,behind Dwight:1,Dwight Chamberlin:1,Chamberlin We:1,We cruised:1,cruised around:1,far corner:1,corner Dwight:1,Dwight cut:1,corner inside:1,a cone:1,cone placed:1,placed awkwardly:1,awkwardly far:1,far out:1,the others:1,others I:1,I followed:1,followed and:1,else cut:1,cut inside:1,the cone:1,cone too—except:1,too—except the:1,the pear-shaped:1,pear-shaped kid:1,kid bringing:1,bringing up:1,rear who:1,who plodded:1,plodded his:1,around every:1,single cone:1,cone on:1,to finishing:1,finishing about:1,a lap:1,lap behind:1,behind When:1,the laggard:1,laggard finally:1,finally crossed:1,the finish:1,finish line:1,the coach:1,coach named:1,named him:1,him the:1,winner to:1,my considerable:1,considerable irritation:1,irritation After:1,fastest wasn’t:1,it Actually:1,wasn’t The:1,fastest according:1,limitations placed:1,placed upon:1,contest This:1,a crucial:1,crucial distinction:1,distinction although:1,although usually:1,usually taken:1,granted Would:1,Would it:1,it have:1,been legitimate:1,legitimate if:1,had cut:1,field If:1,had ridden:1,ridden a:1,a bike:1,bike If:1,broken the:1,world record:1,meters by:1,by dropping:1,dropping 100:1,meters from:1,plane Competition:1,Competition has:1,has meaning:1,meaning only:1,a carefully:1,carefully circumscribed:1,circumscribed arena:1,arena Why:1,I telling:1,First because:1,useful lesson:1,lesson for:1,programming All:1,All programming:1,performed within:1,within limitations:1,limitations some:1,be bent:1,bent or:1,or changed:1,changed but:1,which cannot:1,cannot You:1,You cannot:1,cannot change:1,bandwidth of:1,maximum instruction:1,execution rate:1,486 That:1,stunning 3D:1,3D demos:1,demos you:1,at SIGGRAPH:1,SIGGRAPH have:1,only passing:1,passing relevance:1,relevance to:1,to everyday:1,everyday life:1,the desktop:1,desktop A:1,A rule:1,Intel’s chip:1,chip designers:1,designers cannot:1,cannot break:1,break is:1,is 8086:1,8086 compatibility:1,compatibility much:1,as I’m:1,sure they’d:1,they’d like:1,but of:1,although RISC:1,RISC chips:1,chips are:1,technically superior:1,superior they:1,they command:1,command but:1,small fraction:1,market raw:1,the arena:1,arena of:1,of competition:1,competition Similarly:1,Similarly you:1,be unable:1,the specifications:1,specifications for:1,implement Breaking:1,Breaking the:1,the Rules:1,other reason:1,the anecdote:1,anecdote has:1,way my:1,Challenge worked:1,worked itself:1,itself out:1,out If:1,If you’ll:1,devise the:1,possible version:1,Life cellular:1,cellular automata:1,automata simulation:1,simulation game:1,gave an:1,example laid:1,and stood:1,stood aside:1,aside Good:1,Good thing:1,too Apres:1,Apres moi:1,moi le:1,le deluge:1,deluge And:1,the dust:1,dust had:1,had settled:1,settled I:1,was left:1,the uneasy:1,uneasy realization:1,realization that:1,every submitted:1,submitted entry:1,entry broke:1,broke the:1,rules Every:1,Every single:1,single entry:1,entry The:1,The rules:1,rules clearly:1,clearly stated:1,stated that:1,that submitted:1,submitted code:1,code must:1,must produce:1,my example:1,example implementation:1,implementation under:1,win I:1,there can:1,what exactly:1,output means:1,means It:1,same colors:1,same places:1,places on:1,same points:1,Life simulations:1,simulations that:1,was capable:1,running Period:1,Period And:1,And not:1,entries met:1,met that:1,standard Some:1,Some submitted:1,submitted listings:1,were more:1,long Some:1,didn’t display:1,generation number:1,number at:1,right side:1,screen didn’t:1,didn’t draw:1,same pixel:1,or didn’t:1,with magnification:1,magnification Some:1,Some had:1,had bugs:1,bugs Some:1,didn’t support:1,cellmap widths:1,heights up:1,to 200x200:1,200x200 requiring:1,requiring widths:1,heights that:1,were specific:1,specific multiples:1,that lent:1,lent itself:1,last mission:1,mission is:1,brilliant approach:1,it yielded:1,yielded the:1,two fastest:1,submissions but:1,not within:1,contest Some:1,the rule-breaking:1,rule-breaking was:1,was major:1,major some:1,very minor:1,minor and:1,some had:1,Life engine:1,itself but:1,rules were:1,were clear:1,clear where:1,not with:1,with exact:1,exact compliance:1,compliance And:1,was fully:1,fully prepared:1,line rigorously:1,rigorously disqualifying:1,disqualifying some:1,some mind-bending:1,mind-bending submissions:1,submissions in:1,let lesser:1,lesser but:1,entries win—until:1,win—until I:1,no fully:1,entries Given:1,I heaved:1,heaved a:1,a sigh:1,sigh of:1,of relief:1,relief threw:1,threw away:1,and picked:1,picked a:1,a winner:1,winner in:1,true spirit:1,contest raw:1,speed Two:1,Two winners:1,winners in:1,fact Peter:1,Klerings a:1,programmer for:1,for Turck:1,Turck GmbH:1,GmbH in:1,in Munich:1,Munich Germany:1,Germany whose:1,entry just:1,plain runs:1,runs like:1,a bat:1,bat out:1,of hell:1,hell and:1,and David:1,winner of:1,International whose:1,slower mainly:1,didn’t optimize:1,drawing part:1,full accordance:1,accordance with:1,contest rules:1,rules which:1,which specifically:1,specifically excluded:1,excluded drawing:1,from consideration:1,consideration Unfortunately:1,Unfortunately Peter’s:1,Peter’s generation:1,generation code:1,so tightly:1,tightly intertwined:1,intertwined that:1,to separate:1,separate them:1,hence not:1,really possible:1,out whose:1,whose generation:1,faster Anyway:1,Anyway at:1,at 180:1,180 to:1,to 200:1,200 generations:1,second including:1,including drawing:1,for 200x200:1,of 1000:1,1000 gps:1,gps for:1,for 96x96:1,96x96 cellmaps:1,cellmaps the:1,implementation they’re:1,submissions I:1,received They’re:1,They’re both:1,final optimized:1,optimized C:1,C Life:1,implementation shown:1,17 and:1,than 300:1,300 times:1,original perfectly:1,perfectly functional:1,functional Life:1,implementation Not:1,Not 300:1,300 percent—300:1,percent—300 times:1,times Cell:1,Cell generations:1,generations scud:1,scud across:1,screen like:1,like clouds:1,clouds and:1,and walkers:1,walkers shoot:1,shoot out:1,like bullets:1,bullets Each:1,Each is:1,a worthy:1,worthy winner:1,feel confident:1,true objective:1,challenge has:1,been met:1,met pure:1,pure breathtaking:1,breathtaking speed:1,speed Notwithstanding:1,Notwithstanding mea:1,culpa The:1,I lay:1,will define:1,rules with:1,with scrupulous:1,scrupulous care:1,care Even:1,another cycle-counting:1,cycle-counting contest:1,contest We’re:1,We’re fortunate:1,be privy:1,privy to:1,a startling:1,startling demonstration:1,demonstration of:1,optimizer anyone:1,yet devised—you:1,devised—you That’s:1,specific you:1,quite up:1,the optimizing:1,optimizing level:1,specific David:1,Stafford or:1,or Peter:1,Klerings Onward:1,code Table-Driven:1,Table-Driven Magic:1,Magic David:1,Stafford won:1,won my:1,Challenge by:1,huge look-up:1,an incredible:1,incredible state:1,machine driven:1,table didn’t:1,didn’t cause:1,cause David’s:1,David’s entry:1,to exceed:1,exceed the:1,line limit:1,limit because:1,because David’s:1,David’s submission:1,submission included:1,included code:1,the build:1,process David:1,done himself:1,better this:1,his QLIFE:1,QLIFE program:1,program not:1,does his:1,his build:1,process generate:1,table but:1,also generates:1,generates virtually:1,of 17000-plus:1,17000-plus lines:1,language spanning:1,spanning another:1,another 64K:1,64K What:1,What David:1,done is:1,a bitblt:1,bitblt compiler:1,Life one:1,might in:1,fact call:1,Life compiler:1,compiler What:1,What David’s:1,code generates:1,takes arbitrary:1,arbitrary seed:1,seed values:1,of generations:1,generations so:1,if David:1,David simply:1,simply hardwired:1,hardwired the:1,successive screen:1,is exquisitely:1,exquisitely tailored:1,task it:1,QLIFE are:1,Listings 18.1:1,18.1 through:1,through 18.5:1,18.5 as:1,follows Listing:1,Listing 18.1:1,18.1 is:1,is BUILD.BAT:1,BUILD.BAT the:1,the batch:1,Listing 18.2:1,18.2 is:1,is LCOMP.C:1,LCOMP.C the:1,data file:1,file QLIFE.ASM:1,QLIFE.ASM Listing:1,Listing 18.3:1,18.3 is:1,is MAIN.C:1,MAIN.C the:1,for QLIFE:1,Listing 18.4:1,18.4 is:1,is VIDEO.C:1,VIDEO.C the:1,video-related functions:1,Listing 18.5:1,18.5 is:1,is LIFE.H:1,LIFE.H the:1,The following:1,following sidebar:1,sidebar contains:1,contains David’s:1,David’s build:1,build instructions:1,instructions exactly:1,wrote them:1,them I:1,have room:1,discuss all:1,the marvelous:1,marvelous intricacies:1,listings until:1,them thoroughly:1,thoroughly it:1,took me:1,pick them:1,them apart:1,that operates:1,efficient tightly:1,tightly integrated:1,integrated level:1,level than:1,again One:1,One hint:1,hint It:1,It helps:1,run LCOMP.C:1,LCOMP.C redirect:1,redirect its:1,to QLIFE.ASM:1,QLIFE.ASM and:1,that file:1,file This:1,the entirety:1,entirety of:1,David’s generation:1,it’s almost:1,visualize its:1,its operation:1,operation without:1,actually seeing:1,seeing it:1,it How:1,How To:1,To Build:1,Build Qlife:1,Qlife QLIFE:1,QLIFE is:1,it shouldn’t:1,convert it:1,C To:1,To build:1,QLIFE run:1,the BUILD.BAT:1,BUILD.BAT batch:1,file with:1,grid on:1,line see:1,see below:1,command-line options:1,options are:1,are WIDTH:1,WIDTH 32:1,32 Sets:1,cells divided:1,by 3:1,3 HEIGHT:1,HEIGHT 96:1,96 Sets:1,cells NOCOUNTER:1,NOCOUNTER Turns:1,generation counter:1,counter optional:1,optional NODRAW:1,NODRAW Turns:1,off drawing:1,map optional:1,optional GEN:1,GEN 1000:1,1000 Calculates:1,Calculates 1000:1,generations optional:1,optional These:1,These must:1,in uppercase:1,uppercase For:1,minimum you:1,is WIDTH:1,WIDTH 40:1,40 HEIGHT:1,HEIGHT 120:1,120 I:1,used WIDTH:1,WIDTH 46:1,46 HEIGHT:1,HEIGHT 138:1,138 NOCOUNTER:1,NOCOUNTER NODRAW:1,NODRAW GEN:1,GEN 7000:1,7000 during:1,during testing:1,testing If:1,selected the:1,the GEN:1,GEN option:1,option you:1,to press:1,press a:1,exit QLIFE:1,QLIFE when:1,could visually:1,visually compare:1,of N:1,under QLIFE:1,with N:1,under Abrash’s:1,Abrash’s original:1,original life:1,life program:1,program You:1,listing contains:1,small bug:1,bug which:1,it appear:1,appear that:1,not generate:1,generate identical:1,identical results:1,original program:1,cell until:1,changes so:1,alive on:1,first generation:1,never dies:1,dies then:1,displayed This:1,This bug:1,not present:1,in QLIFE:1,QLIFE You:1,trouble running:1,running QLIFE:1,with cell:1,cell grids:1,grids up:1,to 210x200:1,210x200 You:1,run QLIFE:1,QLIFE The:1,386 features:1,uses are:1,not integral:1,integral to:1,algorithm they’re:1,a convenience:1,convenience for:1,so feel:1,modify QLIFE:1,QLIFE to:1,earlier CPUs:1,CPUs if:1,wish QLIFE:1,QLIFE works:1,works best:1,large CPU:1,cache 256K:1,256K is:1,is recommended:1,recommended Keeping:1,Keeping Track:1,Track of:1,of Change:1,Change with:1,a Change:1,Change List:1,List In:1,earlier optimizations:1,Life described:1,Life cellmap:1,cellmap are:1,dead and:1,cases all:1,the neighbors:1,dead as:1,well This:1,This observation:1,observation enabled:1,enabled me:1,major speed-up:1,speed-up by:1,cellmap for:1,few non-zero:1,bytes cells:1,were either:1,either alive:1,alive or:1,have neighbors:1,are alive:1,alive Although:1,Although that:1,big improvement:1,improvement it:1,still required:1,required my:1,touch every:1,check its:1,its state:1,state David:1,has improved:1,improved on:1,to cells:1,generation Only:1,Only those:1,neighbors need:1,checked or:1,or touched:1,touched in:1,generation saving:1,many cache:1,misses due:1,that cellmaps:1,cellmaps are:1,too big:1,big to:1,cache During:1,During a:1,generation David:1,changes for:1,process generates:1,generation That’s:1,this being:1,being David:1,Stafford it’s:1,simple of:1,course I’ll:1,let him:1,him tell:1,how his:1,implementation works:1,words I’ve:1,I’ve edited:1,edited David’s:1,David’s text:1,text a:1,added my:1,own comments:1,comments in:1,square brackets:1,brackets so:1,so blame:1,any errors:1,errors Each:1,Each three:1,grid are:1,are packed:1,18.1 So:1,So it:1,convenient if:1,even multiple:1,three There’s:1,that prevents:1,prevents it:1,from supporting:1,supporting any:1,arbitrary size:1,simpler this:1,So if:1,200x200 grid:1,grid I:1,recommend just:1,just using:1,a 201x200:1,201x200 grid:1,be happy:1,extra free:1,free column:1,column Otherwise:1,edge wrapping:1,wrapping code:1,code gets:1,complex Since:1,Since every:1,has from:1,neighbors you:1,be wondering:1,them with:1,three bits:1,bits Each:1,cell really:1,really has:1,of seven:1,neighbors since:1,neighbors outside:1,current cell:1,word That:1,if cell:1,cell B:1,B changes:1,state then:1,cells A:1,C Updating:1,Updating is:1,when David:1,David picks:1,word representing:1,representing three:1,cells has:1,other cells:1,a neighbor:1,neighbor and:1,that neighbor:1,neighbor is:1,stored right:1,18.1 Therefore:1,Therefore the:1,given cell:1,cell never:1,reflect more:1,neighbors because:1,because at:1,neighbors states:1,already encoded:1,encoded in:1,word Figure:1,storage Figure:1,storage The:1,basic idea:1,array Each:1,Each change:1,list element:1,element points:1,word which:1,time scanning:1,scanning every:1,cell since:1,them do:1,change Two:1,Two passes:1,passes are:1,made through:1,pass updates:1,cell display:1,display on:1,screen sets:1,life/death status:1,cell for:1,and updates:1,adjacent cells:1,cells There:1,some efficiencies:1,efficiencies gained:1,using cell:1,cell triplets:1,triplets rather:1,individual cells:1,cells since:1,usually don’t:1,neighbors Again:1,word are:1,are implied:1,cells The:1,pass sets:1,the next-generation:1,next-generation states:1,states for:1,the cells:1,process builds:1,generation Processing:1,Processing each:1,little complex:1,fast A:1,A 64K:1,64K block:1,code exists:1,exists with:1,with routines:1,each 256-byte:1,256-byte boundary:1,boundary Generally:1,Generally speaking:1,the entry:1,entry point:1,point corresponds:1,corresponds to:1,word This:1,This byte:1,life/death values:1,indicate if:1,edge condition:1,condition During:1,with 0XFE00:1,0XFE00 and:1,address During:1,with 0xFE00:1,0xFE00 OR:1,with 0x0100:1,0x0100 and:1,address Therefore:1,are 128:1,128 possible:1,possible jump:1,targets on:1,and 128:1,128 more:1,second all:1,on 256-byte:1,256-byte boundaries:1,all keyed:1,keyed off:1,high 7:1,7 bits:1,triplet state:1,state because:1,because bit:1,the jump:1,jump index:1,index is:1,second there:1,no conflict:1,conflict The:1,The lower:1,lower bit:1,bit isn’t:1,other purposes:1,six life/death:1,life/death state:1,state bits:1,bits matter:1,for jumping:1,jumping into:1,into David’s:1,David’s state:1,other nine:1,nine bits:1,bits used:1,counts are:1,step Determining:1,Determining which:1,changes must:1,and surprisingly:1,surprisingly quick:1,quick There’s:1,no counting:1,counting Instead:1,Instead I:1,table indexed:1,triplet itself:1,table entry:1,byte should:1,generation If:1,this value:1,current high:1,then no:1,no changes:1,cell Otherwise:1,Otherwise it:1,list Look:1,the Test:1,Test and:1,and Fix:1,Fix functions:1,done This:1,This step:1,important as:1,is obscure:1,obscure David:1,table organized:1,organized so:1,word describing:1,describing a:1,triplet as:1,lookup index:1,index the:1,byte you:1,will read:1,read will:1,words David’s:1,David’s table:1,table is:1,bit the:1,life/death states:1,three neighbor:1,count fields:1,fields form:1,form an:1,index to:1,byte describing:1,generation state:1,triplet In:1,practice only:1,generation field:1,changes Then:1,if another:1,another change:1,nearby cell:1,cell tries:1,to nudge:1,nudge that:1,cell into:1,into changing:1,changing again:1,again David’s:1,code sees:1,sees that:1,not add:1,again Segment:1,Segment usage:1,usage in:1,David’s assembly:1,is summarized:1,Listing 18.6:1,18.6 LISTING:1,LISTING 18.6:1,18.6 QLIFE:1,QLIFE Assembly:1,Assembly Segment:1,Segment Usage:1,Usage CS:1,CS 64K:1,64K code:1,code table:1,of routines:1,on 256:1,256 byte:1,boundaries DS:1,DS DGROUP:1,DGROUP 1st:1,1st pass:1,pass 64K:1,64K cell:1,cell life/death:1,life/death classification:1,classification table:1,table second:1,pass ES:1,ES Change:1,Change list:1,list SS:1,SS DGROUP:1,DGROUP the:1,life cell:1,cell grid:1,and row/column:1,row/column table:1,table FS:1,FS Video:1,Video segment:1,segment GS:1,GS Unused:1,Unused A:1,A Layperson’s:1,Layperson’s Overview:1,Overview of:1,QLIFE Most:1,Most likely:1,likely you’re:1,you’re scratching:1,scratching your:1,head right:1,in bemusement:1,bemusement I:1,blame you:1,felt the:1,way myself:1,myself at:1,first It’s:1,though once:1,it Basically:1,Basically David:1,list visiting:1,visiting every:1,cell that’s:1,that’s due:1,generation setting:1,state drawing:1,and adjusting:1,its neighbors:1,neighbors David:1,separate assembly:1,assembly routine:1,possible change:1,he jumps:1,proper routine:1,routine by:1,address where:1,appropriate code:1,perform that:1,particular change:1,state resides:1,resides He:1,every entry:1,generation has:1,and updated:1,updated Now:1,Now David:1,every changed:1,David looks:1,all affected:1,neighbors to:1,generation He:1,He tests:1,condition by:1,potentially changed:1,aforementioned lookup:1,state matches:1,generation then:1,not added:1,list If:1,match then:1,David checks:1,cells for:1,for change:1,change by:1,that checks:1,checks only:1,relevant cells:1,cells around:1,current change:1,that branching:1,bits setting:1,1-bit and:1,routine at:1,address As:1,this amazing:1,amazing program:1,program this:1,least possible:1,possible work:1,desired result—just:1,result—just three:1,instructions cb187-1:1,cb187-1 mov:1,mov dh:1,dh bp:1,bp 1:1,1 cb187-2:1,cb187-2 or:1,or dh1:1,dh1 cb187-3:1,cb187-3 jmp:1,jmp dx:1,dx These:1,These suffice:1,suffice to:1,proper minimum-work:1,minimum-work code:1,next cell:1,triplet that:1,neighbors For:1,astonishing economy:1,of effort:1,effort as:1,as execution:1,execution glides:1,glides through:1,list without:1,a wasted:1,wasted instruction:1,instruction Alas:1,discuss Peter:1,Klerings equally:1,equally remarkable:1,remarkable Life:1,implementation here:1,here I’ll:1,I’ll close:1,a quote:1,quote from:1,from Terje:1,Mathisen one:1,finest optimizers:1,optimizers it:1,meet who:1,who after:1,after looking:1,over David’s:1,David’s and:1,and Peter’s:1,Peter’s entries:1,entries said:1,an eye-opening:1,eye-opening experience:1,experience for:1,I honestly:1,honestly thought:1,possible approach:1,approach TANSTATFC:1,Code Chapter:1,Chapter 19:1,19 Pentium:1,Pentium Not:1,Not the:1,the Same:1,Same Old:1,Old Song:1,Song Learning:1,Learning a:1,a Whole:1,Whole Different:1,Different Set:1,Set of:1,Rules I:1,still remember:1,did my:1,first 8088:1,8088 programming:1,moved over:1,over from:1,the distantly:1,distantly related:1,related Z80:1,Z80 so:1,8088 wasn’t:1,wasn’t totally:1,totally alien:1,alien but:1,was nonetheless:1,nonetheless an:1,incredibly exciting:1,exciting processor:1,8088’s instruction:1,set was:1,was vastly:1,varied than:1,the Z80’s:1,Z80’s and:1,as someone:1,who thrives:1,thrives on:1,on puzzles:1,puzzles of:1,sorts from:1,from crosswords:1,crosswords to:1,to Freecell:1,Freecell to:1,to jigsaws:1,jigsaws to:1,was delighted:1,8088 made:1,optimization universe:1,universe an:1,more complicated—and:1,complicated—and correspondingly:1,interesting Well:1,years went:1,the Z80:1,Z80 just:1,just died:1,optimization got:1,got ever:1,and intriguing:1,intriguing as:1,8088’s cycle-eaters:1,cycle-eaters By:1,time 1989:1,1989 rolled:1,rolled around:1,written Zen:1,Language in:1,described all:1,and concluded:1,that 8088:1,of infinite:1,infinite subtlety:1,subtlety Unfortunately:1,standard with:1,386 coming:1,less amenable:1,to hand:1,surely was:1,was then:1,386 was:1,was downright:1,downright unfriendly:1,unfriendly Sure:1,Sure assembly:1,optimization could:1,buy some:1,some performance:1,20 30:1,30 40:1,or so—a:1,so—a far:1,far cry:1,cry from:1,100 to:1,400 percent:1,time compiler:1,technology was:1,was improving:1,improving quickly:1,the days:1,of hand:1,hand tuning:1,tuning seemed:1,seemed numbered:1,numbered Happily:1,486 traveled:1,traveled to:1,the beat:1,beat of:1,different drum:1,drum The:1,486 had:1,had some:1,interesting internal:1,internal pipeline:1,pipeline hazards:1,hazards as:1,an internal:1,made cycle:1,counting more:1,more meaningful:1,meaningful than:1,code massaging:1,massaging sometimes:1,sometimes yielded:1,yielded startling:1,startling results:1,results Nonetheless:1,486 was:1,still too:1,too simple:1,mark a:1,a return:1,the golden:1,golden age:1,age of:1,optimization The:1,The Return:1,Optimization as:1,as Art:1,Art Then:1,Pentium came:1,came around:1,filled our:1,hazards and:1,and life:1,life was:1,was good:1,good again:1,again The:1,two execution:1,execution pipelines:1,pipelines and:1,and enough:1,enough rules:1,and exceptions:1,bring joy:1,joy to:1,the hardest-core:1,hardest-core assembly:1,assembly junkie:1,junkie For:1,change Intel:1,Intel documented:1,documented most:1,and spread:1,much spelunking:1,spelunking of:1,predecessors They’ve:1,They’ve done:1,suspect largely:1,highly dependent:1,on properly:1,properly optimized:1,is dormant:1,dormant most:1,Pentium won’t:1,won’t perform:1,Pentium’s other:1,other advantages:1,advantages such:1,as branch:1,prediction write-back:1,write-back cache:1,cache 64-bit:1,64-bit full:1,speed external:1,and dual:1,caches can:1,can kick:1,loop hand:1,can double:1,double or:1,even triple:1,triple performance:1,over 486-optimized:1,486-optimized code—and:1,code—and that’s:1,of algorithmic:1,design optimizations:1,are routinely:1,routinely performed:1,processor Good:1,Good compilers:1,difference on:1,Pentium too:1,some gotchas:1,gotchas there:1,return later:1,later It’s:1,time coming:1,coming but:1,but hard-core:1,hard-core big-payoff:1,big-payoff assembly:1,is back:1,in style:1,be delving:1,delving into:1,the Byzantine:1,Byzantine wonders:1,overview then:1,then cover:1,smaller Pentium:1,optimization topics:1,topics In:1,the 900-pound:1,900-pound gorilla:1,gorilla of:1,optimization superscalar:1,superscalar dual:1,dual execution:1,pipe programming:1,programming Trust:1,me this’ll:1,this’ll be:1,fun Listen:1,Listen do:1,secret This:1,This lead-in:1,lead-in has:1,been brought:1,brought to:1,rock another:1,saying music:1,music Baby:1,Baby Boomers:1,Boomers listened:1,they cared:1,cared more:1,about music:1,music than:1,than 401Ks:1,401Ks and:1,regular flossing:1,flossing There:1,us Boomers:1,Boomers that:1,our music:1,music even:1,never go:1,away When:1,When we’re:1,we’re 90:1,90 years:1,old propped:1,propped up:1,our Kraftmatic:1,Kraftmatic adjustable:1,adjustable beds:1,beds and:1,and surfing:1,surfing the:1,the 5000-channel:1,5000-channel information:1,information superhighway:1,superhighway from:1,one infomercial:1,infomercial to:1,sound system:1,system in:1,the retirement:1,retirement community:1,community will:1,be piping:1,piping in:1,a Muzak:1,Muzak version:1,of Louie:1,Louie Louie:1,Louie while:1,the holovid:1,holovid Country:1,Country Joe:1,Joe McDonald:1,McDonald and:1,the Fish:1,Fish pitch:1,pitch Preparation:1,Preparation H:1,H I:1,can hardly:1,hardly wait:1,wait Gimme:1,Gimme a:1,a P:1,P The:1,Pentium An:1,An Overview:1,Overview Architecturally:1,Architecturally the:1,different in:1,ways from:1,those differences:1,to programmers:1,programmers After:1,whole idea:1,as previous:1,but faster:1,faster otherwise:1,otherwise Intel:1,Intel could:1,faster cheaper:1,cheaper RISC:1,RISC processor:1,processor Still:1,Still knowledge:1,architecture is:1,perform and:1,the architectural:1,architectural differences:1,most decidedly:1,decidedly not:1,programmers The:1,essentially one:1,486 execution:1,unit EU:1,EU plus:1,second stripped-down:1,stripped-down 486:1,486 EU:1,EU on:1,first EU:1,EU is:1,is referred:1,U execution:1,or U-pipe:1,second more:1,limited one:1,of executing:1,simultaneously have:1,have separate:1,write buffers:1,even access:1,cache simultaneously:1,simultaneously although:1,although with:1,certain limitations:1,limitations that:1,Pentium it:1,instructions even:1,clock The:1,given pipe:1,pipe both:1,pipes process:1,process instructions:1,speed are:1,are comparable:1,some instructions—notably:1,instructions—notably MUL:1,MUL the:1,the repeated:1,and rotates—have:1,rotates—have gotten:1,gotten faster:1,faster My:1,first thought:1,thought upon:1,upon hearing:1,Pentium’s dual:1,dual pipes:1,pipes was:1,queue stalls:1,bytes given:1,be twice:1,twice that:1,rarely indeed:1,single 8K:1,8K cache:1,that stores:1,stores both:1,both code:1,and prefetching:1,prefetching can:1,stall if:1,if data:1,data fetching:1,fetching doesn’t:1,allow time:1,for prefetching:1,prefetching to:1,occur although:1,this rarely:1,rarely happens:1,practice The:1,Pentium on:1,separate 8K:1,caches one:1,code prefetches:1,prefetches can:1,never collide:1,collide with:1,data fetches:1,stall only:1,fetched isn’t:1,internal code:1,code cache:1,cache And:1,yes self-modifying:1,self-modifying code:1,code still:1,still works:1,Pentium changes:1,the dual:1,dual caches:1,caches introduce:1,introduce no:1,no incompatibilities:1,with 386/486:1,386/486 code:1,code Also:1,data caches:1,separate code:1,driven out:1,cache in:1,data unlike:1,Pentium expands:1,expands the:1,486’s 32-byte:1,32-byte prefetch:1,bytes In:1,prediction feature:1,feature described:1,described next:1,next which:1,prefetch properly:1,branches this:1,this larger:1,queue means:1,pipes should:1,better fed:1,fed than:1,processor Crossing:1,Crossing Cache:1,Cache Lines:1,Lines There:1,other characteristics:1,healthy supply:1,supply of:1,bytes One:1,can prefetch:1,prefetch instructions:1,instructions across:1,across cache:1,lines Unlike:1,486 where:1,3-cycle penalty:1,for branching:1,spans a:1,size the:1,cache or:1,or main:1,miss on:1,is 32:1,bytes twice:1,486’s cache:1,miss causes:1,longer run:1,cache than:1,third is:1,Pentium’s external:1,as wide:1,486’s at:1,at 64:1,64 bits:1,at 66:1,MHz so:1,fetch both:1,cache four:1,running flat-out:1,flat-out with:1,generally consume:1,consume only:1,486 so:1,processing power:1,much improved:1,improved although:1,although real-world:1,real-world performance:1,are mostly:1,Pentium maxes:1,maxes out:1,out somewhere:1,somewhere around:1,around twice:1,486 When:1,are missed:1,lot the:1,get as:1,faster due:1,superior external:1,and bigger:1,bigger caches:1,caches Most:1,this won’t:1,affect how:1,about instruction:1,fetching It’s:1,caches because:1,high cache:1,is crucial:1,crucial to:1,performance Cache:1,Cache misses:1,misses are:1,are vastly:1,vastly slower:1,than cache:1,cache hits:1,hits anywhere:1,slow depending:1,misses as:1,Pentium can’t:1,executed out:1,working sets:1,of critical:1,caches One:1,definitely do:1,is superscalar:1,execution Utilization:1,Utilization of:1,can range:1,range from:1,from near:1,near zero:1,zero percent:1,percent depending:1,have amazing:1,amazing effects:1,effects Maxing:1,Maxing out:1,out V-pipe:1,V-pipe use:1,trivial task:1,task I’ll:1,spend all:1,chapter discussing:1,discussing it:1,cover it:1,meantime two:1,two good:1,good references:1,Pentium information:1,are Intel’s:1,Manual Volume:1,Volume 3:1,3 Architecture:1,Architecture and:1,and Programming:1,Programming Manual:1,Manual ISBN:1,ISBN 1-55512-195-0:1,1-55512-195-0 Intel:1,Intel order:1,order number:1,number 241430-001:1,241430-001 and:1,article Optimizing:1,Optimizing Pentium:1,Pentium Code:1,Code by:1,by Mike:1,Mike Schmidt:1,Schmidt in:1,Journal for:1,for January:1,January 1994:1,1994 Cache:1,Cache Organization:1,Organization There:1,interesting changes:1,Pentium’s cache:1,cache organization:1,organization First:1,is two-way:1,two-way set-associative:1,set-associative whereas:1,whereas the:1,is four-way:1,four-way set-associative:1,set-associative The:1,The details:1,this don’t:1,don’t matter:1,simply put:1,this combined:1,the 32-byte:1,size means:1,has somewhat:1,somewhat coarser:1,coarser granularity:1,granularity in:1,both space:1,packing bytes:1,cache although:1,total cache:1,now bigger:1,bigger There’s:1,a loop’s:1,loop’s working:1,set into:1,cache Second:1,be configured:1,configured by:1,or OS:1,OS you:1,for write-back:1,write-back rather:1,than write-through:1,write-through operation:1,that writes:1,cache don’t:1,necessarily get:1,get propagated:1,propagated to:1,bus until:1,until other:1,other demands:1,demands for:1,for cache:1,space force:1,cache making:1,making repeated:1,repeated writes:1,as loop:1,loop counters:1,counters cheaper:1,cheaper on:1,average than:1,as registers:1,on Pentium:1,Pentium architecture:1,architecture for:1,stalls what:1,calls AGIs:1,AGIs for:1,for Address:1,Interlocks that:1,book see:1,12 are:1,they’re there:1,in spades:1,spades on:1,two pipelines:1,pipelines mean:1,now slow:1,down execution:1,that’s three:1,AGI because:1,because four:1,cycles So:1,takes three:1,cycles rather:1,take because:1,because EDX:1,EDX was:1,modified on:1,cycle two:1,two before:1,AGI had:1,had time:1,to clear—even:1,clear—even though:1,actually involved:1,AGI Rearranging:1,Rearranging the:1,like makes:1,it functionally:1,functionally identical:1,identical but:1,but cuts:1,to 2—a:1,2—a 50:1,improvement Clearly:1,Clearly avoiding:1,avoiding AGIs:1,AGIs becomes:1,rewarding game:1,a superscalar:1,superscalar world:1,world one:1,chapter Faster:1,Faster Addressing:1,More I’ll:1,chapter covering:1,covering a:1,optimization tips:1,tips For:1,starters effective:1,calculations that:1,scaling required:1,memory operand’s:1,operand’s address:1,EBX ECX*2:1,ECX*2 4:1,4 never:1,never take:1,Pentium other:1,than possibly:1,possibly an:1,AGI cycle:1,cycle even:1,of base:1,MOV ESI:1,ESI EDI:1,EDI EAX:1,EAX or:1,or scaling:1,scaling 2:1,8 as:1,INC ARRAY[ESI*4:1,ARRAY[ESI*4 On:1,latter cases:1,cases cause:1,penalty The:1,faster effective:1,making LEA:1,LEA very:1,instruction LEA:1,add any:1,registers one:1,be multiplied:1,one two:1,eight plus:1,any register—all:1,register—all in:1,cycle apart:1,from AGIs:1,AGIs Not:1,chapter LEA:1,pipe whereas:1,whereas SHL:1,SHL can:1,U-pipe so:1,so LEA:1,a superior:1,superior choice:1,three four:1,four five:1,five eight:1,eight or:1,or nine:1,nine ADD:1,two If:1,use LEA:1,LEA for:1,for arithmetic:1,arithmetic do:1,do remember:1,unlike ADD:1,SHL it:1,flags As:1,486 memory:1,more alignment:1,alignment boundaries:1,boundaries than:1,than absolutely:1,Word operands:1,word-aligned dword:1,dword operands:1,and qword:1,qword operands:1,operands double-precision:1,double-precision variables:1,be qword-aligned:1,qword-aligned Spanning:1,Spanning a:1,dword boundary:1,boundary as:1,in costs:1,costs three:1,hand as:1,above branch:1,targets can:1,now span:1,span cache:1,with impunity:1,impunity so:1,Pentium there’s:1,good argument:1,the paragraph:1,paragraph that:1,is 16-byte:1,16-byte alignment:1,Intel recommends:1,recommends for:1,for 486:1,486 jump:1,targets The:1,The 32-byte:1,32-byte alignment:1,alignment might:1,for slightly:1,efficient Pentium:1,cache usage:1,make code:1,much bigger:1,bigger overall:1,overall In:1,most jump:1,targets aren’t:1,aren’t in:1,in performance-critical:1,performance-critical code:1,a compelling:1,compelling argument:1,for aligning:1,aligning branch:1,targets even:1,486 I’d:1,no alignment:1,alignment except:1,except possibly:1,possibly where:1,target lies:1,most dword:1,dword alignment:1,alignment for:1,plenty and:1,can shrink:1,shrink code:1,size considerably:1,considerably Instruction:1,Instruction prefixes:1,prefixes are:1,are awfully:1,awfully expensive:1,expensive avoid:1,can These:1,These include:1,include size:1,addressing prefixes:1,prefixes segment:1,LOCK and:1,0FH prefixes:1,prefixes that:1,that extend:1,as MOVSX:1,MOVSX The:1,are conditional:1,jumps a:1,fast special:1,case At:1,minimum a:1,byte generally:1,generally takes:1,cycle effectively:1,effectively costing:1,costing as:1,although prefix:1,prefix cycles:1,with previous:1,previous multicycle:1,multicycle instructions:1,or AGIs:1,AGIs as:1,486 This:1,addressing or:1,32-bit operands:1,versa makes:1,for bigger:1,bigger code:1,that’s significantly:1,slower So:1,generally avoid:1,avoid 16-bit:1,16-bit variables:1,variables shorts:1,shorts in:1,if using:1,32-bit variables:1,variables where:1,where they’re:1,not needed:1,needed makes:1,data space:1,space get:1,lot bigger:1,bigger you:1,with shorts:1,shorts especially:1,since longs:1,longs use:1,cache less:1,less efficiently:1,efficiently than:1,than shorts:1,shorts The:1,The trade-off:1,trade-off depends:1,that reference:1,reference that:1,data eight-bit:1,eight-bit variables:1,as chars:1,chars have:1,used freely:1,freely although:1,less desirable:1,desirable than:1,than longs:1,longs for:1,for compilers:1,compilers that:1,to promote:1,promote variables:1,variables to:1,to longs:1,longs when:1,calculations Likewise:1,possible avoid:1,avoid putting:1,putting data:1,and referring:1,referring to:1,a CS:1,CS prefix:1,prefix or:1,otherwise using:1,using segment:1,LOCK is:1,particularly costly:1,costly instruction:1,instruction especially:1,on multiprocessor:1,multiprocessor machines:1,it locks:1,hardware be:1,a synchronized:1,synchronized state:1,cost varies:1,and system:1,system but:1,but LOCK:1,LOCK can:1,an INC:1,INC mem:1,mem instruction:1,which normally:1,cycles 5:1,5 10:1,slower Most:1,Most programmers:1,programmers will:1,never use:1,use LOCK:1,LOCK on:1,on purpose—it’s:1,purpose—it’s primarily:1,primarily an:1,system instruction—but:1,instruction—but there’s:1,hidden gotcha:1,gotcha here:1,XCHG instruction:1,instruction always:1,always locks:1,bus when:1,operand XCHG:1,XCHG is:1,a tempting:1,tempting instruction:1,example exchanging:1,exchanging with:1,a popular:1,popular way:1,single instruction—but:1,instruction—but it’s:1,idea As:1,Pentium using:1,using MOV:1,write memory:1,faster anyway:1,486 my:1,my measurements:1,indicate a:1,a five-cycle:1,five-cycle tax:1,tax for:1,for LOCK:1,LOCK in:1,a nine-cycle:1,nine-cycle execution:1,for XCHG:1,memory Avoid:1,Avoid XCHG:1,can As:1,486 don’t:1,use ENTER:1,ENTER or:1,or LEAVE:1,LEAVE which:1,equivalent discrete:1,instructions Also:1,Also start:1,start using:1,using TEST:1,TEST regreg:1,regreg instead:1,AND regreg:1,regreg or:1,OR regreg:1,regreg to:1,reason as:1,21 is:1,that TEST:1,TEST unlike:1,unlike AND:1,OR never:1,never modifies:1,register Although:1,Although in:1,case AND:1,OR don’t:1,don’t modify:1,knowing that:1,that ahead:1,if AND:1,OR goes:1,Pentium may:1,to shut:1,avoid potential:1,dependencies on:1,TEST suffers:1,such potential:1,dependencies Branch:1,Branch Prediction:1,Prediction One:1,One brand-spanking-new:1,brand-spanking-new feature:1,is branch:1,prediction whereby:1,Pentium tries:1,to guess:1,guess based:1,past history:1,history which:1,for conditional:1,jumps whether:1,will jump:1,jump at:1,each branch:1,and prefetches:1,prefetches along:1,the likelier:1,likelier path:1,path If:1,1 cycle—2:1,cycle—2 cycles:1,cycles less:1,is wrong:1,wrong the:1,U or:1,or V-pipe:1,V-pipe respectively:1,respectively 1:1,486 Branch:1,Branch prediction:1,is unprecedented:1,unprecedented in:1,x86 and:1,and fundamentally:1,fundamentally alters:1,of pedal-to-the-metal:1,renders unrolled:1,loops largely:1,largely obsolete:1,obsolete Rare:1,Rare indeed:1,indeed is:1,spare even:1,even 1:1,0 yes:1,yes zero:1,zero cycles:1,per iteration:1,iteration for:1,loop counting:1,how low:1,low the:1,Pentium Also:1,Also unrolled:1,loops are:1,are bigger:1,normal loops:1,are extra:1,extra and:1,and expensive:1,expensive cache:1,misses the:1,loop isn’t:1,cache then:1,too an:1,an unrolled:1,loop will:1,will shoulder:1,shoulder other:1,internal and:1,and external:1,external caches:1,caches If:1,If in:1,loop you:1,absolutely need:1,loop control:1,need an:1,extra register:1,freed by:1,then by:1,means unroll:1,loop Don’t:1,Don’t expect:1,of speed-up:1,speed-up you:1,this on:1,or especially:1,386 though:1,effects You:1,wonder exactly:1,Pentium correctly:1,correctly predicts:1,predicts branching:1,branching Alas:1,Alas this:1,has declined:1,declined to:1,to document:1,document beyond:1,beyond saying:1,should endeavor:1,choice That’s:1,good advice:1,advice on:1,processor anyway:1,worth following:1,following Also:1,pretty safe:1,start guessing:1,guessing the:1,right branch:1,branch direction:1,direction at:1,loop pretty:1,pretty quickly:1,quickly so:1,can treat:1,treat loop:1,loop branches:1,as one-cycle:1,instructions It’s:1,equally safe:1,bad move:1,a conditional:1,conditional branch:1,goes both:1,ways on:1,a random:1,random basis:1,basis it’s:1,Pentium could:1,could consistently:1,consistently predict:1,predict such:1,such branches:1,branches correctly:1,correctly and:1,mispredicted branches:1,branches are:1,might appear:1,a mispredicted:1,mispredicted branch:1,branch take:1,as 8:1,or 10:1,10 instructions:1,that time—3:1,time—3 times:1,during its:1,its branch:1,branch time—so:1,time—so correct:1,correct branch:1,prediction or:1,or eliminating:1,eliminating branch:1,branch instructions:1,loops Note:1,it falls:1,falls through:1,Pentium you:1,or either:1,either 4:1,given iteration:1,iteration As:1,As things:1,things currently:1,currently stand:1,stand branch:1,an annoyance:1,annoyance for:1,certain exactly:1,perform until:1,sure exactly:1,cycles went:1,went All:1,consistent in:1,your branching:1,branching if:1,not Miscellaneous:1,Miscellaneous Pentium:1,Pentium Topics:1,Topics The:1,486 plus:1,few new:1,ones One:1,One much-needed:1,much-needed instruction:1,has finally:1,finally made:1,is CPUID:1,CPUID which:1,allows your:1,what processor:1,processor it’s:1,on CPUID:1,CPUID is:1,is 15:1,years late:1,late but:1,least it’s:1,it’s finally:1,finally here:1,here Another:1,Another new:1,new instruction:1,is CMPXCHG8B:1,CMPXCHG8B which:1,and conditional:1,conditional exchange:1,exchange on:1,a qword:1,qword CMPXCHG8B:1,CMPXCHG8B doesn’t:1,useful instruction:1,sure Intel:1,Intel wouldn’t:1,have added:1,added it:1,reason if:1,a use:1,it please:1,please pass:1,me 486:1,486 versus:1,versus Pentium:1,Optimization Many:1,Many Pentium:1,optimizations help:1,help or:1,least don’t:1,don’t hurt:1,486 Many:1,Many but:1,not all—and:1,all—and many:1,many do:1,do hurt:1,various Pentium:1,will attempt:1,detail would:1,would double:1,these discussions:1,discussions and:1,them hard:1,follow In:1,general I’d:1,recommend reserving:1,reserving Pentium:1,even there:1,there it’s:1,two code:1,paths one:1,486/Pentium It’s:1,486 before:1,after Pentium-optimizing:1,Pentium-optimizing it:1,haven’t hurt:1,be after:1,important processor:1,processor over:1,next couple:1,years With:1,Pentium even:1,even worthwhile:1,worthwhile today:1,today That:1,That depends:1,application and:1,its market—but:1,market—but if:1,want absolutely:1,your DOS:1,and Windows:1,Windows apps:1,apps on:1,fastest hardware:1,hardware Pentium:1,code scream:1,scream Going:1,Going Superscalar:1,Superscalar In:1,single biggest:1,biggest element:1,performance cranking:1,cranking up:1,pipe This:1,which compiler:1,most touted:1,touted for:1,two thoughts:1,thoughts apparently:1,apparently being:1,1 most:1,most existing:1,existing code:1,so recompiling:1,recompiling to:1,pipe better:1,better is:1,an automatic:1,automatic win:1,so complicated:1,optimize Pentium:1,it well:1,reasonable one:1,does suffer:1,one flaw:1,flaw for:1,large programs:1,than 486:1,or 386-optimized:1,386-optimized code:1,chapter Larger:1,Larger code:1,code means:1,means more:1,more page:1,page faults:1,faults and:1,while most:1,performance compilers:1,compilers optimize:1,optimize code:1,code indiscriminately:1,indiscriminately The:1,that Pentium:1,Pentium compiler:1,optimization not:1,only expands:1,expands code:1,less beneficial:1,beneficial than:1,than expected:1,expected or:1,cases What:1,makes more:1,sense is:1,is enabling:1,enabling Pentium:1,optimization only:1,for key:1,key code:1,code Better:1,yet you:1,could hand-tune:1,hand-tune the:1,important code—and:1,code—and yes:1,yes you:1,can absolutely:1,absolutely do:1,small critical:1,loop than:1,any PC:1,PC compiler:1,seen or:1,or expect:1,see Sure:1,keep hearing:1,great each:1,new compiler:1,compiler generation:1,and compilers:1,compilers certainly:1,play by:1,same rules:1,rules we:1,we’re more:1,we’re doing—and:1,doing—and now:1,the wonderfully:1,wonderfully complex:1,powerful Pentium:1,Pentium upon:1,to loose:1,loose our:1,our carbon-based:1,carbon-based optimizers:1,optimizers A:1,A compiler:1,generates better:1,programmer That’ll:1,That’ll be:1,Chapter 20:1,20 Pentium:1,Pentium Rules:1,Rules How:1,How Your:1,Your Carbon-Based:1,Carbon-Based Optimizer:1,Optimizer Can:1,Can Put:1,the Super:1,Super in:1,in Superscalar:1,Superscalar At:1,the 1983:1,1983 West:1,Coast Computer:1,Computer Faire:1,Faire my:1,Illowsky Andy:1,Andy Greenberg:1,Greenberg co-author:1,co-author of:1,of Wizardry:1,Wizardry at:1,the best-selling:1,best-selling computer:1,computer game:1,game ever:1,ever and:1,discussion about:1,about starting:1,starting a:1,company in:1,the then-budding:1,then-budding world:1,microcomputer software:1,software One:1,One hot:1,hot new:1,new software:1,software category:1,category at:1,was educational:1,software and:1,hottest new:1,new educational:1,software companies:1,companies was:1,was Spinnaker:1,Spinnaker Software:1,Software Andy:1,Andy used:1,used Spinnaker:1,Spinnaker as:1,been aimed:1,good market:1,market and:1,started up:1,up properly:1,was succeeding:1,succeeding as:1,result Dan:1,Dan didn’t:1,didn’t buy:1,buy this:1,this his:1,his point:1,that Spinnaker:1,Spinnaker had:1,been given:1,a bundle:1,bundle of:1,money to:1,ground and:1,growing only:1,spending a:1,that money:1,move its:1,its products:1,products Heck:1,Heck said:1,said Dan:1,Dan I:1,of market:1,market share:1,share too:1,gave away:1,away a:1,a fifty-dollar:1,bill with:1,my games:1,games Remember:1,Remember this:1,program two:1,two diskette:1,diskette drives:1,drives for:1,for duplicating:1,duplicating disks:1,disks and:1,of ads:1,ads were:1,were enough:1,start a:1,company and:1,fact Dan:1,Dan built:1,company out:1,I’ll never:1,forget coming:1,visit one:1,finding his:1,his apartment:1,apartment stuffed:1,stuffed literally:1,literally to:1,and ceiling:1,ceiling with:1,with boxes:1,boxes of:1,of diskettes:1,diskettes and:1,game packages:1,packages he:1,had left:1,narrow path:1,so his:1,his wife:1,his mother:1,mother could:1,to duplicate:1,duplicate disks:1,disks Back:1,field was:1,wide open:1,open with:1,every competent:1,competent programmer:1,programmer thinking:1,of striking:1,striking out:1,own to:1,make their:1,their fortune:1,fortune and:1,and Dan:1,and Andy:1,Andy and:1,no exceptions:1,exceptions In:1,short we:1,perfectly normal:1,normal conversation:1,conversation and:1,and Dan’s:1,Dan’s comment:1,comment was:1,both appropriate:1,appropriate and:1,in retrospect:1,retrospect accurate:1,accurate Appropriate:1,Appropriate save:1,thing We:1,having this:1,this conversation:1,conversation while:1,a low-rent:1,low-rent section:1,of Market:1,Francisco at:1,at night:1,night A:1,A bum:1,bum sitting:1,sitting against:1,nearby building:1,building overheard:1,overheard Dan:1,and rose:1,rose up:1,up shouting:1,shouting in:1,a quavering:1,quavering voice:1,voice loud:1,loud enough:1,to wake:1,wake the:1,dead Fifty-dollar:1,bill Fifty-dollar:1,bill He’s:1,He’s giving:1,giving away:1,away fifty-dollar:1,fifty-dollar bills:1,bills We:1,We ignored:1,ignored him:1,him undaunted:1,undaunted he:1,he followed:1,followed us:1,good half:1,half mile:1,mile stopping:1,stopping every:1,few feet:1,feet to:1,to bellow:1,bellow fifty-dollar:1,bill No:1,one else:1,else seemed:1,notice and:1,one hassled:1,hassled us:1,was mighty:1,mighty happy:1,the sanctuary:1,sanctuary of:1,the Fairmont:1,Fairmont Hotel:1,Hotel and:1,and slip:1,slip inside:1,inside The:1,most actions:1,actions aren’t:1,aren’t inherently:1,inherently good:1,good or:1,or bad:1,bad it’s:1,it’s all:1,of context:1,If Dan:1,Dan had:1,had uttered:1,uttered the:1,words fifty-dollar:1,bill on:1,the West:1,Coast Faire’s:1,Faire’s show:1,show floor:1,floor no:1,have batted:1,batted an:1,eye If:1,If he:1,had said:1,slightly worse:1,worse part:1,of town:1,town than:1,learned just:1,three of:1,run Similarly:1,Similarly there’s:1,as inherently:1,inherently fast:1,code only:1,only fast:1,context At:1,moment the:1,sizable number:1,x86 optimization:1,optimization tricks:1,are obsolete:1,obsolete on:1,Pentium True:1,Pentium contains:1,contains what:1,about one-and-a-half:1,one-and-a-half 486s:1,486s but:1,that optimized:1,like optimized:1,optimized 486:1,fast 486:1,runs particularly:1,Pentium Fast:1,Fast Pentium:1,hand does:1,run well:1,only major:1,major downsides:1,downsides are:1,it’s larger:1,largely free:1,expensive on:1,486 So:1,So discard:1,discard your:1,your x86:1,x86 preconceptions:1,preconceptions as:1,into superscalar:1,this one-of-a-kind:1,one-of-a-kind processor:1,processor An:1,An Instruction:1,Instruction in:1,in Every:1,Every Pipe:1,Pipe In:1,Pentium’s optimization:1,rules Now:1,key rules:1,rules those:1,those having:1,Pentium’s most:1,most unique:1,unique and:1,powerful feature:1,execute more:1,instruction per:1,as superscalar:1,has heretofore:1,heretofore been:1,sole province:1,province of:1,fast RISC:1,RISC CPUs:1,CPUs The:1,units called:1,V-pipe which:1,simultaneously potentially:1,potentially doubling:1,doubling performance—but:1,performance—but only:1,only under:1,proper conditions:1,conditions There:1,separate floating-point:1,unit that:1,book Your:1,conditions needed:1,superscalar performance:1,sure they’re:1,they’re met:1,met and:1,next chapters:1,not independent:1,independent processors:1,processors housed:1,housed in:1,not like:1,like having:1,having two:1,486s in:1,single computer:1,computer Rather:1,are integral:1,integral parallel:1,parallel parts:1,same processor:1,processor They:1,They operate:1,same instruction:1,stream with:1,V-pipe simply:1,simply executing:1,U-pipe would:1,have handled:1,20.1 What:1,What the:1,Pentium does:1,does pure:1,simple is:1,is execute:1,possible take:1,two waiting:1,waiting instructions:1,execute both:1,both at:1,more capable:1,pipes able:1,execute any:1,set A:1,actually use:1,use both:1,once Logically:1,Logically though:1,as U-pipe:1,optimization model:1,execute all:1,always active:1,active with:1,objective being:1,being to:1,V-pipe also:1,also working:1,generally similar:1,both capabilities:1,counts The:1,The V-pipe:1,486 subset:1,subset able:1,execute simple:1,and ADD:1,ADD but:1,but unable:1,handle MUL:1,MUL DIV:1,DIV string:1,or shift:1,even ADC:1,ADC or:1,or SBB:1,SBB Figure:1,pipes Getting:1,Getting two:1,executing simultaneously:1,pipes is:1,sounds not:1,handle only:1,because those:1,handle are:1,certain U-pipe:1,example MOVSD:1,MOVSD uses:1,uses both:1,pipes so:1,no instruction:1,with MOVSD:1,MOVSD The:1,pipes does:1,does make:1,make MOVSD:1,MOVSD nearly:1,nonetheless slower:1,using equivalent:1,equivalent simpler:1,simpler instructions:1,execution Stick:1,Stick to:1,Pentium’s RISC-like:1,RISC-like instructions—the:1,instructions—the pairable:1,instructions I’ll:1,discuss next—when:1,next—when you’re:1,you’re seeking:1,seeking maximum:1,as REP:1,MOVS and:1,STOS Trickier:1,Trickier yet:1,yet register:1,contention can:1,can shut:1,given cycle:1,Interlocks AGIs:1,AGIs can:1,stall either:1,pipe at:1,view execution:1,execution as:1,V-pipes and:1,possible instruction:1,instruction mixes:1,mixes that:1,action In:1,difficult The:1,only hard:1,is keeping:1,long list:1,rules governing:1,governing instruction:1,instruction pairing:1,pairing The:1,begin is:1,V-pipe V-Pipe-Capable:1,V-Pipe-Capable Instructions:1,Instructions Any:1,Any instruction:1,for practical:1,always executing:1,are when:1,U-pipe execution:1,miss and:1,instruction finishes:1,a paired:1,paired V-pipe:1,below Only:1,20.1 can:1,V-pipe In:1,instruction only:1,instructions listed:1,U-pipe superscalar:1,possible while:1,while any:1,instruction not:1,U-pipe So:1,SHR EDXCL:1,EDXCL which:1,execute no:1,if on:1,SHR EDX10:1,EDX10 it:1,execute concurrently:1,concurrently in:1,V-pipe As:1,similar instruction:1,sequences can:1,have vastly:1,characteristics on:1,Pentium Basically:1,Basically after:1,current instruction:1,finished that:1,once neither:1,U nor:1,nor V-pipe:1,executing anything:1,Pentium sends:1,instruction through:1,U-pipe If:1,handle if:1,is pairable:1,pairable and:1,if register:1,contention doesn’t:1,occur then:1,V-pipe starts:1,executing that:1,20.2 Otherwise:1,instruction waits:1,then executes:1,U-pipe possibly:1,possibly pairing:1,pairing with:1,in line:1,all pairing:1,pairing conditions:1,conditions are:1,met Can’t:1,Can’t execute:1,in V-pipe:1,displacement Table:1,20.1 Instructions:1,handle is:1,of U-pipe:1,U-pipe pairable:1,longer but:1,but these:1,these actually:1,actually constitute:1,PC software:1,software As:1,result a:1,of pairing:1,pairing happens:1,happens even:1,normal non-Pentium-optimized:1,non-Pentium-optimized code:1,This fact:1,fact plus:1,the 64-bit:1,64-bit 66:1,MHz bus:1,bus branch:1,prediction dual:1,caches and:1,Pentium features:1,features together:1,together mean:1,speed even:1,even without:1,without Pentium-specific:1,Pentium-specific optimization:1,optimization contrary:1,some reports:1,reports Besides:1,Besides almost:1,all operations:1,by combinations:1,of pairable:1,example PUSH:1,mem is:1,either list:1,list but:1,both MOV:1,MOV reg:1,reg are:1,proper instruction:1,stream the:1,the discrete:1,operation effectively:1,cycle taking:1,taking one-half:1,for 2*0.5:1,2*0.5 1:1,Figure 20.3—a:1,20.3—a full:1,than PUSH:1,mem which:1,cycles Can’t:1,Can’t pair:1,pair if:1,displacement Includes:1,Includes shift-by-1:1,shift-by-1 forms:1,instructions Table:1,20.2 Instructions:1,when executed:1,U-pipe allow:1,allow V-pipe-executable:1,V-pipe-executable instructions:1,simultaneously pair:1,V-pipe A:1,A fundamental:1,it pays:1,break complex:1,into equivalent:1,equivalent simple:1,then shuffle:1,shuffle the:1,V-pipe This:1,true partly:1,the pairable:1,because breaking:1,breaking instructions:1,into pieces:1,pieces allows:1,allows more:1,more freedom:1,freedom to:1,rearrange code:1,the AGIs:1,pipes One:1,One downside:1,this RISCification:1,RISCification turning:1,turning complex:1,simple RISC-like:1,RISC-like ones:1,ones of:1,of Pentium-optimized:1,for substantially:1,substantially larger:1,larger code:1,byte smaller:1,sequence Figure:1,cycle A:1,more telling:1,telling example:1,following cb195-1:1,cb195-1 add:1,add MemVar:1,MemVar eax:1,eax versus:1,equivalent cb196-1:1,cb196-1 mov:1,mov edx:1,edx MemVar:1,MemVar cb196-2:1,cb196-2 add:1,add edxeax:1,edxeax cb196-3:1,cb196-3 mov:1,mov MemVar:1,MemVar edx:1,edx The:1,single complex:1,complex instruction:1,proper sequencing:1,sequencing interleaving:1,use EDX:1,EDX or:1,or Mem:1,Mem Var:1,Var the:1,the three-instruction:1,three-instruction sequence:1,sequence can:1,to 1.5:1,is 14:1,14 bytes:1,long It’s:1,not unusual:1,unusual for:1,double both:1,size at:1,important loop:1,loop go:1,a program-wide:1,program-wide basis:1,size bears:1,bears watching:1,watching Lockstep:1,Lockstep Execution:1,Execution You:1,why anyone:1,would bother:1,bother breaking:1,breaking ADD:1,ADD MemVar:1,MemVar EAX:1,EAX into:1,instructions given:1,equal ease:1,ease The:1,MOV PUSH:1,POP listed:1,20.1 that:1,is INC/DEC:1,INC/DEC mem:1,mem ADD/SUB/XOR/AND/OR/CMP/ADC/SBB:1,ADD/SUB/XOR/AND/OR/CMP/ADC/SBB reg:1,and ADD/SUB/XOR/AND/OR/CMP/ADC/SBB:1,ADD/SUB/XOR/AND/OR/CMP/ADC/SBB mem:1,mem reg/immed:1,reg/immed can:1,paired they:1,percent overlap:1,overlap that:1,seek If:1,at Tables:1,Tables 20.1:1,20.1 and:1,and 20.2:1,20.2 you:1,instructions taking:1,taking from:1,pair However:1,any pair:1,instructions goes:1,lockstep This:1,means for:1,if ADD:1,EBX EDX:1,EDX is:1,and INC:1,V-pipe the:1,V-pipe will:1,be idle:1,U-pipe takes:1,execute its:1,20.4 Out:1,Out of:1,theoretical 6:1,done during:1,during this:1,actually get:1,percent utilization:1,utilization Even:1,though these:1,pair then:1,sequence fails:1,fails to:1,make maximum:1,Pentium’s horsepower:1,pair both:1,both execution:1,units are:1,are tied:1,tied up:1,until both:1,have finished:1,finished which:1,means at:1,longer of:1,execute plus:1,plus possibly:1,possibly some:1,for pairable:1,can’t fully:1,fully overlap:1,logical conclusion:1,conclusion would:1,pair instructions:1,lengths but:1,not correct:1,correct The:1,actual rule:1,pair one-cycle:1,most two-cycle:1,not three-cycle:1,three-cycle instructions:1,turn leads:1,the corollary:1,corollary that:1,general use:1,use mostly:1,optimizing Figure:1,V-pipe Figure:1,V-pipe Here’s:1,Here’s why:1,handling instructions:1,use memory:1,once Each:1,Each pipe:1,pipe has:1,own write:1,FIFO which:1,which buffers:1,few writes:1,out while:1,Pentium continues:1,processing The:1,Pentium also:1,a write-back:1,write-back internal:1,so data:1,frequently changed:1,changed doesn’t:1,cache very:1,often This:1,This combination:1,combination means:1,that unless:1,write large:1,Pentium should:1,pipes memory:1,writes without:1,without stalling:1,stalling execution:1,also designed:1,satisfy both:1,pipes needs:1,needs for:1,for reading:1,reading memory:1,operands with:1,little waiting:1,waiting The:1,This feat:1,feat is:1,by organizing:1,organizing the:1,cache as:1,as eight-banked:1,eight-banked memory:1,20.5 with:1,each 32-byte:1,line consisting:1,8 dwords:1,dwords 1:1,each bank:1,bank The:1,The banks:1,banks are:1,are independent:1,V-pipes don’t:1,don’t try:1,bank on:1,cycle both:1,read memory:1,If there:1,bank collision:1,collision the:1,instruction stalls:1,cycle Normally:1,Normally you:1,won’t pay:1,pay close:1,close attention:1,eight dword:1,dword banks:1,banks your:1,your paired:1,paired memory:1,accesses fall:1,fall in—that’s:1,in—that’s just:1,much work—but:1,work—but you:1,for simultaneously:1,simultaneously read:1,read addresses:1,for address:1,address Figure:1,cache Figure:1,cache bits:1,4 fall:1,fall in:1,bank in:1,should also:1,also avoid:1,avoid sequences:1,sequences like:1,like because:1,both operands:1,operands will:1,bank An:1,place another:1,sequence By:1,reason a:1,single word:1,is attractive:1,attractive in:1,loading BX:1,BX takes:1,takes 1.5:1,1.5 to:1,prefix can’t:1,different Pentium:1,be from:1,from everything:1,predecessors The:1,with pairing:1,pairing non-single-cycle:1,non-single-cycle instructions:1,instructions arises:1,a pipe:1,executes an:1,MOV that:1,operand I’ll:1,instructions They’re:1,They’re the:1,than branches:1,cycle We’ve:1,the pipes:1,lockstep if:1,EBX while:1,a single-cycle:1,single-cycle instruction:1,faster instruction:1,will sit:1,sit idle:1,for part:1,time wasting:1,wasting cycles:1,if both:1,pipes execute:1,execute complex:1,length then:1,neither would:1,would lie:1,lie idle:1,idle but:1,case Two:1,Two two-cycle:1,instructions instructions:1,with register:1,register destination:1,indeed pair:1,it’s okay:1,okay to:1,pair two:1,as these:1,these However:1,this beneficial:1,beneficial pairing:1,pairing does:1,not extend:1,extend to:1,to non:1,non MOV:1,with explicit:1,memory destination:1,operands such:1,EAX The:1,Pentium executes:1,executes only:1,such memory:1,if two:1,two memory-destination:1,memory-destination complex:1,instructions get:1,get paired:1,paired first:1,first the:1,instruction with:1,20.6 I:1,to guarantee:1,pipes will:1,never perform:1,perform out-of-order:1,out-of-order access:1,given memory:1,location Thus:1,Thus even:1,though AND:1,AL pairs:1,with AND:1,AND ECX:1,ECX DL:1,DL the:1,take 5:1,of idle:1,idle time—2:1,time—2 in:1,in all—are:1,all—are incurred:1,incurred in:1,process Figure:1,and interleave:1,interleave them:1,20.7 which:1,which accomplishes:1,accomplishes the:1,task in:1,cycles with:1,no idle:1,idle cycles:1,cycles whatsoever:1,whatsoever Figure:1,20.7 is:1,what optimized:1,code generally:1,generally looks:1,like mostly:1,instructions mixed:1,together so:1,progress at:1,once It’s:1,easiest code:1,write but:1,get both:1,pipes running:1,at capacity:1,capacity Superscalar:1,Superscalar Notes:1,Notes You:1,interleave operations:1,20.7 It:1,seems simpler:1,of dependency:1,dependency Before:1,Before the:1,execute AND:1,DLAL it:1,in DL:1,DL and:1,can’t know:1,it loads:1,loads DL:1,DL from:1,address pointed:1,by EBX:1,EBX Therefore:1,Therefore AND:1,DLAL can’t:1,after MOV:1,DL EBX:1,EBX executes:1,executes Likewise:1,result can’t:1,stored until:1,after AND:1,DLAL has:1,as written:1,written can’t:1,possibly pair:1,same three:1,as AND:1,AL Now:1,Now it:1,clear why:1,why AND:1,AL takes:1,interleave these:1,use other:1,other registers:1,this set:1,pipe while:1,other unrelated:1,unrelated set:1,set executes:1,pipe as:1,20.7 What:1,What we’ve:1,just seen:1,the read-after-write:1,read-after-write form:1,the superscalar:1,superscalar hazard:1,hazard known:1,as register:1,contention in:1,short items:1,items about:1,execution Register:1,Register Starvation:1,Starvation The:1,above examples:1,examples should:1,it pretty:1,pretty clear:1,that effective:1,effective superscalar:1,programming puts:1,puts a:1,of strain:1,strain on:1,set There:1,only seven:1,seven general-purpose:1,strongly suggest:1,suggest using:1,using EBP:1,EBP in:1,not help:1,to sacrifice:1,sacrifice one:1,storage on:1,each complex:1,memory operation:1,in pre-superscalar:1,pre-superscalar days:1,days we:1,employ those:1,those handy:1,handy CISC:1,CISC memory:1,stuff without:1,extra registers:1,More problematic:1,problematic still:1,maximum pairing:1,pairing you’ll:1,you’ll typically:1,typically have:1,operations proceeding:1,proceeding at:1,once one:1,pipe and:1,difficult indeed:1,indeed There’s:1,There’s not:1,this other:1,than clever:1,and Spartan:1,Spartan register:1,major element:1,programming Also:1,prefixes of:1,every sort:1,sort with:1,sole exception:1,0FH prefix:1,on non-short:1,non-short conditional:1,jumps always:1,always execute:1,no pairing:1,pairing can:1,byte executes:1,executes As:1,chapter my:1,experiments indicate:1,rule doesn’t:1,always apply:1,to multiple-cycle:1,still won’t:1,go far:1,far wrong:1,wrong by:1,by assuming:1,above rule:1,eliminate prefix:1,bytes A:1,A prefix:1,takes one:1,execute after:1,actual prefixed:1,instruction itself:1,itself will:1,are mutually:1,mutually pairable:1,pairable then:1,then they:1,will pair:1,pair Nonetheless:1,Nonetheless prefix:1,expensive effectively:1,taking at:1,possibly if:1,a prefixed:1,instruction could:1,could otherwise:1,have paired:1,paired in:1,V-pipe with:1,three normal:1,20.8 Finally:1,Finally bear:1,executed have:1,not already:1,executed at:1,were loaded:1,cache they:1,first U-pipe:1,pairable but:1,also exactly:1,includes only:1,only INC:1,INC reg:1,reg DEC:1,DEC reg:1,reg PUSH:1,reg Knowing:1,why sometimes:1,sometimes timing:1,timing reveals:1,runs slower:1,should although:1,generally occur:1,occur only:1,cache working:1,you’re timing:1,of 8K:1,8K or:1,or more—an:1,more—an awful:1,optimize It:1,be excruciatingly:1,excruciatingly clear:1,your Pentium-optimized:1,you’re to:1,any hope:1,hope of:1,knowing if:1,are there:1,many details:1,details involved:1,sure your:1,properly without:1,without checking:1,checking My:1,My most:1,most basic:1,rule has:1,to grab:1,grab the:1,and measure:1,measure actual:1,and nowhere:1,nowhere is:1,this more:1,Pentium Don’t:1,Don’t believe:1,believe it:1,it until:1,delays Chapter:1,21 Unleashing:1,Unleashing the:1,Pentium’s V-Pipe:1,V-Pipe Focusing:1,Focusing on:1,on Keeping:1,Keeping Both:1,Both Pentium:1,Pentium Pipes:1,Pipes Full:1,Full The:1,daughter suggested:1,we each:1,each draw:1,the prettiest:1,prettiest picture:1,picture we:1,see whose:1,whose was:1,was prettier:1,prettier I:1,won’t comment:1,comment on:1,on who:1,who won:1,won except:1,except to:1,that apparently:1,apparently a:1,a bolt:1,bolt of:1,of lightning:1,lightning zipping:1,zipping toward:1,a moose:1,moose with:1,with antlers:1,antlers that:1,that bear:1,bear an:1,an unfortunate:1,unfortunate resemblance:1,a propeller:1,propeller beanie:1,beanie isn’t:1,win me:1,any scholarships:1,scholarships to:1,to art:1,art school:1,school if:1,drift Anyway:1,my drawing:1,drawing happened:1,to feature:1,word chartreuse:1,chartreuse because:1,it rhymed:1,rhymed with:1,with moose:1,moose and:1,and Zeus:1,Zeus hence:1,the lightning:1,lightning more:1,at liberty:1,liberty to:1,to divulge:1,divulge and:1,she wanted:1,the moose:1,moose was:1,actually chartreuse:1,chartreuse I:1,to admit:1,know so:1,we went:1,the dictionary:1,dictionary whereupon:1,whereupon we:1,that chartreuse:1,chartreuse is:1,a pale:1,pale apple-green:1,apple-green color:1,color Then:1,Then she:1,she brought:1,brought up:1,the Windows:1,Windows Control:1,Control Panel:1,Panel pointed:1,of predefined:1,predefined colors:1,asked Which:1,those is:1,is chartreuse:1,chartreuse and:1,still didn’t:1,know Some:1,Some things:1,described perfectly:1,perfectly with:1,with words:1,but others:1,others just:1,be experienced:1,experienced Color:1,Color is:1,such category:1,another I’ve:1,chapters detailing:1,detailing the:1,spend half:1,one doing:1,well That’s:1,fundamentals we:1,optimizing well:1,that later:1,chapter after:1,should go:1,some Pentium:1,own Optimization:1,about from:1,from reading:1,reading but:1,but ultimately:1,ultimately it:1,to sink:1,sink into:1,your pores:1,pores as:1,do it—especially:1,it—especially Pentium:1,rewarding chip:1,seen In:1,the dual-execution-pipe:1,dual-execution-pipe nature:1,and learned:1,learned which:1,could pair:1,pair execute:1,pipes Now:1,at AGIs:1,register contention—two:1,contention—two hazards:1,hazards that:1,prevent otherwise:1,otherwise properly:1,properly written:1,written code:1,from taking:1,taking full:1,full advantage:1,pipes and:1,can thereby:1,thereby keep:1,from pushing:1,to maximum:1,performance Address:1,Interlocks The:1,is advertised:1,advertised as:1,a five-stage:1,five-stage pipeline:1,its execution:1,units All:1,pipe this:1,this overlapping:1,speed so:1,Pentium’s pipelining:1,pipelining directly:1,directly affects:1,of AGIs:1,register dependencies:1,dependencies AGIs:1,are Address:1,Interlocks a:1,a fancy:1,fancy way:1,is EBX:1,EBX in:1,instruction cb203-1:1,cb203-1 mov:1,mov ebx:1,ebx eax:1,eax and:1,set far:1,enough ahead:1,ahead for:1,calculations before:1,instruction needs:1,will stall:1,pipe in:1,executing until:1,value becomes:1,available and:1,performed Remember:1,Remember also:1,lockstep on:1,pipe stalls:1,cycle making:1,making its:1,instruction take:1,take one:1,cycle longer:1,longer that:1,that extends:1,extends by:1,pipe can:1,begin its:1,its next:1,AGIs is:1,simple If:1,cycle you:1,during either:1,either that:1,will simply:1,simply stall:1,that tries:1,memory until:1,until two:1,modified This:1,Pentium’s new:1,new twist:1,twist is:1,since more:1,cycle an:1,stall an:1,that’s as:1,changing of:1,also cause:1,stall that:1,costs as:1,21.2 This:1,that AGIs:1,both much:1,cause and:1,must keep:1,sharp eye:1,them It:1,worth calculating:1,pointer several:1,instructions ahead:1,its actual:1,use Unfortunately:1,this tends:1,the lifetimes:1,lifetimes of:1,of pointer:1,pointer registers:1,to span:1,span a:1,greater number:1,instructions making:1,set seem:1,seem even:1,even smaller:1,smaller Figure:1,later Figure:1,later As:1,of AGI:1,AGI that’s:1,that’s new:1,Pentium consider:1,following test:1,pointer followed:1,pointer if:1,not NULL:1,NULL This:1,This commonplace:1,commonplace code:1,U-pipe cycle:1,AGI caused:1,by AND:1,EBXEBX followed:1,the attempt:1,attempt two:1,later to:1,use EBX:1,a V-pipe:1,V-pipe cycle:1,because lockstep:1,execution won’t:1,won’t let:1,next V-pipe:1,instruction execute:1,the paired:1,paired U-pipe:1,that suffered:1,suffered the:1,AGI finishes:1,finishes The:1,use TEST:1,TEST EBXEBX:1,EBXEBX instead:1,AND TEST:1,TEST can’t:1,can’t modify:1,EBX so:1,no AGI:1,AGI occurs:1,occurs Sure:1,Sure AND:1,EBXEBX doesn’t:1,EBX either:1,either but:1,Pentium doesn’t:1,AGI Figure:1,should keep:1,a careful:1,careful eye:1,AGIs involving:1,pointer Implicit:1,Implicit modifiers:1,modifiers of:1,of ESP:1,ESP such:1,as PUSH:1,POP are:1,special-cased so:1,about AGIs:1,AGIs However:1,you explicitly:1,explicitly modify:1,ESP with:1,example or:1,popular you:1,get AGIs:1,AGIs if:1,you attempt:1,memory either:1,either explicitly:1,explicitly with:1,or via:1,via PUSH:1,that implicitly:1,implicitly use:1,register On:1,486 any:1,had both:1,addressing displacement:1,displacement such:1,as suffered:1,suffered a:1,penalty taking:1,cycles Such:1,Such instructions:1,they cannot:1,cannot pair:1,expensive sort:1,of MOV:1,MOV Knowing:1,as zeroing:1,zeroing two:1,two memory:1,variables as:1,should potentially:1,be 0.5:1,0.5 cycles:1,six bytes:1,bytes smaller:1,sequence Note:1,experiments thus:1,two writes:1,writes in:1,first case:1,case don’t:1,actually pair:1,pair possibly:1,possibly because:1,variables have:1,read into:1,insert an:1,MOV s—and:1,s—and of:1,always measure:1,code’s actual:1,performance Register:1,Contention Finally:1,major component:1,of superscalar:1,optimization register:1,contention The:1,premise here:1,simple You:1,two inherently:1,inherently sequential:1,sequential ways:1,cycle For:1,cycle AND:1,AND EBXEAX:1,EBXEAX can’t:1,in EAX:1,until INC:1,done Consequently:1,V-pipe idles:1,idles while:1,EAX executes:1,U-pipe We:1,saw this:1,discussed splitting:1,splitting instructions:1,common sort:1,contention known:1,as read-after-write:1,read-after-write register:1,contention Read-after-write:1,Read-after-write register:1,reason we:1,interleave independent:1,maximum V-pipe:1,V-pipe usage:1,usage The:1,other sort:1,as write-after-write:1,write-after-write Write-after-write:1,Write-after-write register:1,contention happens:1,happens when:1,instructions try:1,cycle While:1,useful operation:1,happen when:1,when subregisters:1,subregisters are:1,following where:1,where an:1,attempt is:1,both EAX:1,EAX and:1,its AL:1,AL subregister:1,subregister on:1,cycle Write-after-write:1,Write-after-write contention:1,contention implies:1,instructions comprising:1,above substitute:1,for MOVZX:1,MOVZX should:1,one unrelated:1,unrelated instruction:1,when SUB:1,SUB EAXEAX:1,EAXEAX executes:1,V-pipe Exceptions:1,Exceptions to:1,to Register:1,Contention Intel:1,has special-cased:1,special-cased some:1,useful exceptions:1,to register:1,contention Happily:1,Happily write-after-read:1,write-after-read operations:1,operations do:1,cause contention:1,contention Such:1,Such operations:1,in are:1,free of:1,of charge:1,charge Also:1,Also stack-related:1,stack-related instructions:1,that modify:1,implicitly without:1,without ESP:1,any explicit:1,operand do:1,cause AGIs:1,they cause:1,contention with:1,implicitly such:1,instructions include:1,include PUSH:1,PUSH reg/immed:1,reg/immed POP:1,and CALL:1,CALL However:1,However these:1,do cause:1,contention on:1,on ESP—but:1,ESP—but not:1,not AGIs—with:1,AGIs—with instructions:1,ESP explicitly:1,explicitly such:1,EAX ESP:1,ESP 4:1,4 Without:1,Without this:1,this special:1,sequence would:1,would hardly:1,hardly use:1,V-pipe at:1,But in:1,fact all:1,pair even:1,though ESP:1,modified five:1,final register-contention:1,register-contention special:1,both remarkable:1,remarkable and:1,and remarkably:1,remarkably important:1,important There:1,V-pipe branches:1,branches Any:1,Any near:1,or conditional:1,conditional or:1,or unconditional:1,unconditional near:1,near jump:1,jump can:1,V-pipe paired:1,any pairable:1,pairable U-pipe:1,sequence Branches:1,Branches can’t:1,U-pipe a:1,that executes:1,U-pipe runs:1,runs alone:1,alone with:1,idle If:1,or jump:1,is correctly:1,correctly predicted:1,predicted by:1,Pentium’s branch:1,prediction circuitry:1,chapter it:1,cycle pairing:1,pairing if:1,if mispredicted:1,mispredicted conditional:1,V-pipe and:1,mispredicted calls:1,and unconditional:1,unconditional jumps:1,pipe Note:1,that RET:1,RET can’t:1,pair Who’s:1,Who’s in:1,in First:1,First One:1,the trickiest:1,trickiest things:1,stream can:1,different speed:1,speed depending:1,pipe where:1,starts execution:1,execution because:1,because which:1,which instruction:1,instruction goes:1,U-pipe first:1,first determines:1,pair If:1,add one:1,more instruction:1,through different:1,different pipes:1,pipes than:1,than previously:1,whole to:1,take 50:1,longer even:1,only added:1,added 25:1,pipes just:1,just back:1,or can:1,work forward:1,there given:1,easiest thing:1,for is:1,is branches:1,branches All:1,All branch:1,target instructions:1,U-pipe as:1,as do:1,instructions after:1,after conditional:1,conditional branches:1,through Instructions:1,with prefix:1,generally good:1,good U-pipe:1,markers although:1,although they’re:1,they’re expensive:1,expensive instructions:1,avoided whenever:1,one aberration:1,aberration with:1,with regard:1,to pipe:1,pipe usage:1,usage as:1,below Shifts:1,Shifts rotates:1,rotates ADC:1,SBB and:1,instructions not:1,20.1 in:1,likewise U-pipe:1,markers Pentium:1,Action Now:1,simplest tightest:1,tightest pieces:1,code imaginable:1,imaginable and:1,what our:1,new Pentium:1,Pentium perspective:1,perspective reveals:1,reveals Listing:1,21.1 shows:1,loop implementing:1,checksum a:1,checksum that:1,that wraps:1,wraps carries:1,carries around:1,low bit:1,is endian-independent:1,endian-independent This:1,perform checksums:1,checksums on:1,on blocks:1,data regardless:1,the endian:1,endian characteristics:1,the machines:1,machines on:1,which those:1,generated and:1,and received:1,received Thanks:1,to fellow:1,fellow performance:1,performance enthusiast:1,enthusiast Terje:1,Mathisen for:1,for suggesting:1,suggesting this:1,this checksum:1,checksum as:1,as fertile:1,fertile ground:1,ground for:1,ibm.pc/fast.code forum:1,forum on:1,Bix The:1,21.1 consists:1,exactly five:1,instructions it’s:1,be wrung:1,wrung from:1,snippet right:1,right Wrong:1,wrong As:1,As detailed:1,detailed in:1,21.1 this:1,take 6:1,a ridiculously:1,ridiculously high:1,high number:1,number for:1,Pentium You’ll:1,You’ll see:1,say should:1,take not:1,not takes:1,takes shortly:1,shortly We:1,should lose:1,lose 2:1,pipe to:1,two size:1,prefixes because:1,ADD s:1,another 2:1,contention that:1,that arises:1,when ADC:1,AX0 has:1,ESI Then:1,too even:1,though DEC:1,JNZ can:1,prediction for:1,for JNZ:1,JNZ is:1,is presumably:1,presumably correct:1,correct virtually:1,maybe we:1,something about:1,21.1 to:1,verify our:1,our analysis:1,analysis When:1,I unleashed:1,unleashed the:1,timer on:1,21.1 I:1,checksum word:1,word processed:1,processed not:1,not six:1,six A:1,more experimentation:1,experimentation revealed:1,revealed that:1,prefix to:1,the two-cycle:1,two-cycle ADD:1,EAX ESI:1,ESI instruction:1,doesn’t cost:1,anything certainly:1,prefix is:1,take More:1,More experimentation:1,experimentation showed:1,showed that:1,that prefix:1,bytes do:1,do cost:1,cost the:1,documented extra:1,with one-cycle:1,MOV At:1,point my:1,my preliminary:1,preliminary conclusion:1,prefixes can:1,pair with:1,some multiple-cycle:1,instructions Determining:1,Determining exactly:1,exactly why:1,happens will:1,take further:1,further research:1,research on:1,my part:1,important conclusion:1,must measure:1,first obvious:1,obvious thing:1,thing we:1,21.1 is:1,change ADC:1,AX0 to:1,to ADC:1,ADC EAX0:1,EAX0 eliminating:1,and saving:1,cycle Now:1,from five:1,cycles What:1,next Listing:1,21.2 shows:1,shows one:1,one interesting:1,interesting alternative:1,alternative that:1,really buy:1,us anything:1,anything Here:1,we’ve eliminated:1,all size:1,prefixes by:1,doing byte-sized:1,byte-sized MOVs:1,MOVs and:1,and ADDs:1,ADDs but:1,ESI for:1,whatever reason:1,reason didn’t:1,didn’t cost:1,21.1 our:1,our efforts:1,efforts are:1,no avail—Listing:1,avail—Listing 21.2:1,21.2 still:1,word What’s:1,What’s worth:1,noting about:1,21.2 is:1,and reordered:1,reordered so:1,avoid size:1,prefixes register:1,contention AGIs:1,bank conflicts:1,conflicts the:1,latter because:1,both ESI:1,ESI and:1,ESI 1:1,same cache:1,cache data:1,sophisticated attempt:1,checksum calculation:1,calculation Here:1,a hallmark:1,optimization two:1,operations the:1,checksumming of:1,current and:1,and next:1,next pair:1,words interleaved:1,interleaved together:1,allow both:1,pipes to:1,at near:1,near maximum:1,maximum capacity:1,capacity Another:1,Another hallmark:1,hallmark that’s:1,that’s apparent:1,than 486-optimized:1,486-optimized code:1,the careful:1,careful mixing:1,mixing of:1,of byte-sized:1,avoid AGIs:1,AGIs register:1,bank collisions:1,collisions in:1,byte reads:1,are interspersed:1,the additions:1,additions to:1,avoid register:1,the placement:1,placement of:1,ADD ESI4:1,ESI4 to:1,AGI The:1,The checksum:1,21.3 takes:1,21.2 at:1,at 6:1,versus 4:1,Listing 21.2—but:1,21.2—but Listing:1,21.3 does:1,does two:1,two checksum:1,checksum operations:1,those 6:1,we’ve cut:1,checksum addition:1,addition from:1,from 4:1,this small:1,small an:1,improvement doesn’t:1,doesn’t justify:1,additional complexity:1,21.3 but:1,a one-third:1,one-third speedup:1,speedup well:1,critical loop—and:1,loop—and in:1,critical there’s:1,in hand-tuning:1,hand-tuning it:1,it That’s:1,the non-inner-loop:1,non-inner-loop code:1,21.3 it’s:1,only executed:1,executed once:1,checksum so:1,it’s unlikely:1,two saved:1,saved there:1,make any:1,real-world difference:1,21.3 could:1,some loop:1,unrolling but:1,little return:1,return Instead:1,Instead why:1,big return:1,return Listing:1,21.4 does:1,loading one:1,one dword:1,word prefix:1,prefix of:1,the multiple:1,multiple byte-sized:1,21.3 An:1,obvious drawback:1,complexity needed:1,the dword:1,are dword-aligned:1,dword-aligned remember:1,that unaligned:1,unaligned dword:1,accesses cost:1,cost three:1,handle buffer:1,buffer lengths:1,lengths that:1,aren’t dword:1,dword multiples:1,multiples I’ve:1,I’ve handled:1,handled these:1,by requiring:1,requiring that:1,buffer be:1,dword multiple:1,multiple in:1,length which:1,course not:1,world However:1,listings is:1,illustrate Pentium:1,Pentium optimization—dword:1,optimization—dword issues:1,issues being:1,being non-inner-loop:1,non-inner-loop stuff:1,stuff are:1,are solvable:1,solvable details:1,aren’t germane:1,germane to:1,focus In:1,In any:1,and assumptions:1,well justified:1,justified by:1,code three:1,or 1.5:1,word more:1,actual order:1,arranged is:1,is dictated:1,various optimization:1,Pentium Listing:1,21.5 improves:1,improves upon:1,upon Listing:1,21.4 by:1,processing 2:1,2 dwords:1,dwords per:1,loop thereby:1,thereby bringing:1,21.5 basically:1,basically does:1,but unroll:1,unroll Listing:1,Listing 21.4’s:1,21.4’s loop:1,time demonstrating:1,the venerable:1,venerable optimization:1,of loop:1,unrolling still:1,some life:1,life left:1,cost for:1,usual increased:1,undeniably intricate:1,intricate code:1,thing one:1,course On:1,it’s five:1,the tight:1,tight seemingly-speedy:1,seemingly-speedy loop:1,21.1 would:1,been if:1,the prefix:1,byte had:1,had behaved:1,behaved as:1,expected That’s:1,wring out:1,a five-instruction:1,five-instruction loop:1,checksum is:1,fact used:1,by network:1,network software:1,software an:1,a five-times:1,five-times speedup:1,speedup might:1,overall system:1,system performance:1,performance I:1,don’t claim:1,a TCP/IP:1,checksum on:1,isn’t Unrolling:1,Unrolling the:1,time together:1,trick of:1,Terje’s that:1,advance ESI:1,ESI neither:1,neither LEA:1,LEA nor:1,nor DEC:1,DEC affects:1,carry flag:1,flag allowing:1,allowing Terje:1,Terje to:1,previous loop:1,iteration into:1,next iteration’s:1,iteration’s checksum:1,checksum via:1,via ADC:1,ADC produces:1,version that’s:1,full 33:1,33 percent:1,faster Nonetheless:1,Nonetheless Listings:1,Listings 21.1:1,21.1 through:1,through 21.5:1,21.5 illustrate:1,illustrate many:1,techniques and:1,and considerations:1,considerations in:1,in Pentium:1,optimization Hand-optimization:1,Hand-optimization for:1,Pentium isn’t:1,isn’t simple:1,requires careful:1,careful measurement:1,measurement to:1,the efficacy:1,efficacy of:1,optimizations so:1,so reserve:1,reserve it:1,need it—but:1,it—but when:1,it bad:1,bad A:1,A Quick:1,Quick Note:1,486 I’ve:1,does fine:1,always so:1,386 On:1,at 9:1,at 2.5:1,2.5 cycles:1,healthy 3.6-times:1,3.6-times speedup:1,speedup On:1,at 22:1,22 cycles:1,word Listing:1,at 7:1,a 3.1-times:1,3.1-times speedup:1,speedup As:1,case Pentium:1,optimization helped:1,Chapter 22:1,22 Zenning:1,Zenning and:1,the Flexible:1,Mind Taking:1,a Spin:1,Spin through:1,through What:1,What You’ve:1,You’ve Learned:1,Learned And:1,our journey:1,journey for:1,least What:1,What follows:1,follows is:1,modest bit:1,optimization one:1,one which:1,which originally:1,originally served:1,served to:1,show readers:1,Language that:1,learned more:1,just bits:1,and pieces:1,had also:1,also begun:1,begun to:1,flexible mind—unconventional:1,mind—unconventional broadly:1,broadly integrative:1,integrative thinking—to:1,thinking—to approaching:1,approaching high-level:1,high-level optimization:1,the algorithmic:1,design levels:1,levels You:1,You of:1,such reassurance:1,reassurance having:1,just spent:1,spent 21:1,21 chapters:1,mind in:1,many guises:1,guises but:1,example instructive:1,instructive nonetheless:1,nonetheless Try:1,optimization rises:1,rises from:1,from instruction:1,instruction elimination:1,elimination to:1,instruction substitution:1,substitution to:1,more creative:1,creative solutions:1,solutions that:1,involve broader:1,broader understanding:1,understanding and:1,and redesign:1,redesign We’ll:1,by compacting:1,compacting individual:1,end we’ll:1,very structure:1,structure of:1,subroutine with:1,instruction carefully:1,carefully integrated:1,integrated into:1,a remarkably:1,remarkably compact:1,compact whole:1,whole It’s:1,neat example:1,how optimization:1,optimization operates:1,levels some:1,some much:1,less determininstic:1,determininstic than:1,than others—and:1,others—and besides:1,besides it’s:1,plain fun:1,fun Enjoy:1,Enjoy Zenning:1,Zenning In:1,In Jeff:1,Duntemann’s excellent:1,book Borland:1,Borland Pascal:1,Pascal From:1,From Square:1,Square One:1,One Random:1,Random House:1,House 1993:1,1993 there’s:1,small assembly:1,subroutine that’s:1,a Turbo:1,Pascal program:1,a systemscreen:1,systemscreen buffer:1,specified character/attribute:1,character/attribute pair:1,This subroutine:1,subroutine involves:1,only 21:1,21 instructions:1,however with:1,can compact:1,compact the:1,subroutine tremendously:1,tremendously and:1,To coin:1,coin a:1,a verb:1,verb we:1,can Zen:1,Zen this:1,this already-tight:1,already-tight assembly:1,astonishing degree:1,degree In:1,process I:1,hope you’ll:1,how advanced:1,advanced your:1,assembly skills:1,skills have:1,become Jeff’s:1,Jeff’s original:1,code follows:1,follows as:1,22.1 with:1,some text:1,text converted:1,to lowercase:1,lowercase in:1,the style:1,style of:1,the comments:1,comments are:1,are mine:1,notice about:1,ClearS uses:1,STOSW instruction:1,instruction That:1,any great:1,great amount:1,amount no:1,how clever:1,clever we:1,are While:1,While we:1,eliminate some:1,one repeated:1,that Does:1,be Hardly:1,Hardly While:1,good there’s:1,another side:1,optimization equation:1,equation size:1,size The:1,is 52:1,52 bytes:1,it stands—but:1,stands—but as:1,size is:1,hardly set:1,in stone:1,stone Where:1,with ClearS:1,ClearS For:1,starters there’s:1,no earthly:1,earthly purpose:1,purpose MOV:1,MOV SPBP:1,SPBP SP:1,be equal:1,BP at:1,point anyway:1,why reload:1,same value:1,value Removing:1,Removing that:1,instruction saves:1,saves us:1,us two:1,bytes Well:1,Well that:1,was certainly:1,certainly easy:1,enough We’re:1,more totally:1,totally non-functional:1,non-functional instructions:1,ClearS however:1,some serious:1,serious optimizing:1,optimizing We’ll:1,look first:1,first for:1,better instructions:1,for particular:1,tasks than:1,were chosen:1,chosen For:1,example there’s:1,register whether:1,whether segment:1,or general:1,general through:1,BX we:1,eliminate two:1,directly as:1,Listing 22.2:1,22.2 The:1,The OnStack:1,OnStack structure:1,structure definition:1,definition doesn’t:1,our examples:1,examples so:1,going clutter:1,clutter up:1,by reproducing:1,reproducing it:1,ClearS Okay:1,Okay loading:1,directly saves:1,saves another:1,bytes We’ve:1,We’ve squeezed:1,squeezed a:1,of 6:1,6 bytes—about:1,bytes—about 11:1,11 percent—out:1,percent—out of:1,ClearS What:1,next Well:1,Well LES:1,LES would:1,serve better:1,for loading:1,DI as:1,Listing 22.3:1,22.3 That’s:1,another three:1,bytes We’re:1,We’re down:1,to 43:1,43 bytes:1,and counting:1,counting We:1,save 3:1,3 more:1,bytes by:1,low and:1,high bytes:1,and BX:1,BX respectively:1,respectively by:1,using SUB:1,SUB reg8reg8:1,reg8reg8 rather:1,than ANDing:1,ANDing 16-bit:1,16-bit values:1,Listing 22.4:1,22.4 Now:1,40 bytes—more:1,bytes—more than:1,percent smaller:1,That’s pretty:1,optimizations It:1,into AX:1,away AL:1,AL Likewise:1,Likewise it:1,into BX:1,away BH:1,BH However:1,those steps:1,steps are:1,two modified:1,modified word:1,word values:1,are ORed:1,ORed into:1,single character/attribute:1,character/attribute word:1,target buffer:1,buffer Let’s:1,Let’s step:1,does though:1,though All:1,is load:1,load one:1,another byte:1,into AL:1,AL Heck:1,Heck we:1,just do:1,directly Presto—we’ve:1,Presto—we’ve saved:1,saved another:1,another 6:1,into byte-sized:1,Listing 22.5:1,22.5 shows:1,code We:1,code pack:1,pack both:1,the attribute:1,attribute and:1,fill value:1,word but:1,the specification:1,particular routine:1,routine Another:1,Another nifty:1,nifty instruction-rearrangement:1,instruction-rearrangement trick:1,trick saves:1,saves 6:1,bytes ClearS:1,ClearS checks:1,is null:1,null zero:1,the routine…then:1,routine…then loads:1,uses that:1,same far:1,pointer later:1,pointer into:1,into registers:1,it there:1,can check:1,it’s null:1,null with:1,single comparison:1,it later:1,later without:1,to reload:1,Listing 22.6:1,22.6 Well:1,Well Now:1,to 28:1,28 bytes:1,bytes having:1,having reduced:1,this subroutine:1,subroutine by:1,by nearly:1,percent Only:1,Only 13:1,13 instructions:1,instructions remain:1,remain Realistically:1,Realistically how:1,much smaller:1,smaller can:1,code About:1,About one-third:1,one-third smaller:1,smaller yet:1,yet as:1,turns out—but:1,out—but in:1,must stretch:1,stretch our:1,minds and:1,8088’s instructions:1,in unusual:1,unusual ways:1,ways Let:1,ask you:1,What do:1,current version:1,ClearS do:1,They either:1,either load:1,load parameters:1,parameters from:1,parameters can:1,accessed Mind:1,you there’s:1,nothing wrong:1,the stack-frame-oriented:1,stack-frame-oriented instructions:1,ClearS those:1,frame in:1,way exactly:1,the designers:1,8088 intended:1,intended and:1,language would:1,would That:1,we aren’t:1,aren’t going:1,don’t bend:1,bend the:1,rules a:1,bit Let’s:1,Let’s think…the:1,think…the parameters:1,parameters are:1,are sitting:1,sitting on:1,our instruction:1,read bytes:1,with BP-based:1,BP-based addressing…we:1,addressing…we need:1,stack the:1,stack THE:1,THE STACK:1,STACK Ye:1,gods That’s:1,That’s easy—we:1,easy—we can:1,stack rather:1,than BP:1,BP While:1,pointer can’t:1,for mod-reg-rm:1,mod-reg-rm addressing:1,as BP:1,BP can:1,to pop:1,pop data:1,data off:1,the stack—and:1,stack—and POP:1,POP is:1,a one-byte:1,one-byte instruction:1,instruction Instructions:1,Instructions don’t:1,any shorter:1,one detail:1,detail to:1,taken care:1,of before:1,our plan:1,plan into:1,into action:1,The return:1,return address—the:1,address—the address:1,calling code—is:1,code—is on:1,stack so:1,parameters we:1,want can’t:1,reached with:1,with POP:1,POP That’s:1,solved however—we’ll:1,however—we’ll just:1,just pop:1,unused register:1,branch through:1,14 As:1,we pop:1,parameters we’ll:1,be removing:1,stack thereby:1,thereby neatly:1,neatly avoiding:1,to discard:1,discard them:1,return With:1,that problem:1,problem dealt:1,Listing 22.7:1,22.7 shows:1,ClearS At:1,metal This:1,just 19:1,19 bytes:1,long That’s:1,just 37:1,37 percent:1,percent as:1,version without:1,any change:1,change whatsoever:1,whatsoever in:1,functionality that:1,ClearS makes:1,makes available:1,is bound:1,faster too:1,too given:1,and fewer:1,fewer memory:1,accesses All:1,original Probably:1,implementation never:1,never say:1,say never:1,never but:1,an awfully:1,awfully good:1,one Part:1,II Chapter:1,23 Bones:1,Bones and:1,and Sinew:1,Sinew At:1,the Very:1,Very Heart:1,of Standard:1,Standard PC:1,PC Graphics:1,Graphics The:1,is unparalleled:1,unparalleled in:1,most widely-used:1,widely-used graphics:1,standard ever:1,ever the:1,closest we:1,ever come:1,a lingua:1,graphics No:1,standard has:1,has even:1,even come:1,so VGAs:1,use today:1,PC compatible:1,compatible sold:1,today has:1,has full:1,full VGA:1,compatibility built:1,in There:1,accelerators that:1,that outperform:1,becoming hard:1,plain vanilla:1,vanilla VGA:1,VGA anymore—but:1,anymore—but there:1,for accelerators:1,every accelerator:1,accelerator contains:1,a true-blue:1,true-blue VGA:1,its core:1,core What:1,VGA you’ll:1,possible market:1,software In:1,for graphics-based:1,graphics-based software:1,to succeed:1,succeed however:1,well Wringing:1,Wringing the:1,impossible unless:1,VGA works—unless:1,works—unless you:1,internals down:1,cold This:1,about PC:1,levels but:1,but high:1,come so:1,will begin:1,eight chapters:1,of Part:1,II is:1,a guided:1,guided tour:1,you’ve absorbed:1,absorbed what:1,what we’ll:1,we’ll cover:1,next seven:1,seven chapters:1,chapters you’ll:1,understanding just:1,everything the:1,do including:1,the fabled:1,fabled Mode:1,more As:1,through these:1,these first:1,first chapters:1,chapters please:1,the really:1,really exciting:1,exciting stuff—animation:1,stuff—animation 3-D:1,3-D blurry-fast:1,blurry-fast lines:1,and circles:1,and polygons—has:1,polygons—has to:1,fundamentals out:1,So hold:1,hold on:1,and follow:1,follow along:1,along and:1,the fireworks:1,fireworks will:1,well underway:1,underway We’ll:1,exploration with:1,we’ll dive:1,the baseline:1,baseline adapter:1,adapter for:1,for modern:1,modern IBM:1,compatibles present:1,in virtually:1,PC sold:1,today or:1,years Note:1,often nothing:1,a chip:1,chip on:1,a motherboard:1,motherboard with:1,some memory:1,of glue:1,glue chips:1,chips nonetheless:1,nonetheless I’ll:1,an adapter:1,adapter from:1,simplicity It:1,It guarantees:1,documented resolutions:1,resolutions up:1,and 320x200:1,320x200 with:1,as undocumented—but:1,undocumented—but nonetheless:1,nonetheless thoroughly:1,thoroughly standard—resolutions:1,standard—resolutions up:1,to 360x480:1,360x480 in:1,47-49 In:1,to claim:1,claim VGA:1,compatibility it:1,must support:1,few minor:1,minor exceptions:1,exceptions that:1,I’ll note:1,note and:1,hardware currently:1,currently shipping:1,shipping or:1,or shipped:1,shipped since:1,since 1990:1,1990 is:1,fact VGA:1,compatible Therefore:1,Therefore VGA:1,on nearly:1,nearly all:1,so PC:1,compatibles out:1,there with:1,the exceptions:1,exceptions being:1,being almost:1,entirely obsolete:1,obsolete machines:1,machines from:1,the 1980s:1,1980s This:1,good VGA:1,programming expertise:1,expertise valuable:1,valuable commodities:1,commodities indeed:1,indeed Right:1,Right off:1,bat I’d:1,thing perfectly:1,perfectly clear:1,clear The:1,is hard—sometimes:1,hard—sometimes very:1,very hard—to:1,hard—to program:1,performance Hard:1,Hard but:1,not impossible—and:1,impossible—and that’s:1,odd board:1,board It’s:1,a throwback:1,throwback to:1,earlier generation:1,of micros:1,micros when:1,when inventive:1,inventive coding:1,solid understanding:1,hardware were:1,best tools:1,for improving:1,performance Increasingly:1,Increasingly faster:1,powerful coprocessors:1,coprocessors are:1,are seen:1,seen as:1,the sluggish:1,sluggish software:1,software produced:1,by high-level:1,and layers:1,of interface:1,and driver:1,driver code:1,valid approach:1,approach However:1,are tens:1,of VGAs:1,VGAs installed:1,installed right:1,in machines:1,machines ranging:1,from 6-MHz:1,6-MHz 286s:1,286s to:1,to 90-MHz:1,90-MHz Pentiums:1,Pentiums What’s:1,more because:1,the VGAs:1,generally 8:1,best 16-bit:1,16-bit devices:1,devices and:1,states a:1,faster processor:1,processor isn’t:1,a help:1,help as:1,expect The:1,a seasoned:1,seasoned performance:1,who understands:1,understands the:1,VGA through:1,through can:1,board to:1,its fullest:1,fullest potential:1,potential Throughout:1,I’ll explore:1,VGA by:1,specific algorithm:1,algorithm or:1,or feature:1,feature and:1,and implementing:1,implementing code:1,support it:1,VGA examining:1,examining aspects:1,VGA architecture:1,architecture as:1,become relevant:1,relevant You’ll:1,You’ll get:1,see VGA:1,context where:1,more comprehensible:1,comprehensible than:1,IBM’s somewhat:1,somewhat arcane:1,arcane documentation:1,get working:1,modify to:1,needs The:1,The prime:1,prime directive:1,directive of:1,there’s rarely:1,rarely just:1,given purpose:1,purpose Once:1,provides you’ll:1,combine them:1,particular synergy:1,synergy your:1,needs My:1,My VGA:1,VGA routines:1,gospel or:1,show best:1,best implementations:1,implementations but:1,road to:1,VGA Let’s:1,Let’s begin:1,begin An:1,Introduction to:1,Programming Most:1,Most discussions:1,VGA start:1,traditional Here’s:1,block diagram:1,diagram of:1,VGA approach:1,with lists:1,and statistics:1,statistics I’ll:1,eventually but:1,IBM’s VGA:1,VGA documentation:1,other books:1,books Besides:1,Besides it’s:1,it’s numbing:1,numbing to:1,read specifications:1,specifications and:1,and explanations:1,explanations and:1,an exciting:1,exciting adapter:1,kind that:1,get your:1,your hands:1,hands dirty:1,dirty probing:1,probing under:1,hood to:1,write some:1,some nifty:1,nifty code:1,board can:1,do What’s:1,it work:1,let’s jump:1,sample of:1,action getting:1,VGA’s architecture:1,architecture in:1,23.1 is:1,that pans:1,pans around:1,around an:1,animated 16-color:1,16-color medium-resolution:1,medium-resolution 640x350:1,640x350 playfield:1,playfield There’s:1,lot packed:1,into this:1,the VGA-specific:1,VGA-specific aspects:1,aspects so:1,get sidetracked:1,sidetracked I’m:1,is animated:1,animated for:1,example we’ll:1,animation starting:1,42 What:1,is cover:1,features used:1,this program—the:1,program—the virtual:1,screen vertical:1,panning color:1,plane manipulation:1,manipulation multi-plane:1,multi-plane block:1,page flipping—at:1,flipping—at a:1,level letting:1,itself demonstrate:1,details We’ll:1,We’ll return:1,these concepts:1,concepts in:1,more depth:1,depth later:1,book At:1,the Core:1,Core A:1,little background:1,necessary before:1,around four:1,four functional:1,functional blocks:1,blocks named:1,named the:1,Controller CRTC:1,CRTC the:1,the Sequence:1,Controller SC:1,SC the:1,Controller AC:1,AC and:1,GC The:1,The single-chip:1,single-chip VGA:1,treat the:1,one large:1,large set:1,set addressed:1,ports but:1,blocks was:1,chip and:1,the legacy:1,legacy of:1,compatibility is:1,why each:1,separate set:1,is addressed:1,different I/O:1,ports in:1,VGA Each:1,sizable complement:1,complement of:1,registers It:1,particularly important:1,given block:1,block has:1,given register:1,register all:1,entire interface:1,programmer However:1,addressed makes:1,remember which:1,which blocks:1,blocks Most:1,Most VGA:1,addressed as:1,as internally:1,internally indexed:1,internal address:1,given block’s:1,block’s Index:1,the block’s:1,block’s Data:1,example GC:1,0FFH by:1,writing 8:1,port 3CEH:1,3CEH the:1,writing 0FFH:1,port 3CFH:1,3CFH the:1,register Internal:1,Internal indexing:1,indexing makes:1,the 9:1,9 GC:1,GC registers:1,through only:1,two ports:1,ports and:1,interface to:1,be squeezed:1,squeezed into:1,into fewer:1,dozen ports:1,ports The:1,two I/O:1,I/O operations:1,access most:1,The ports:1,ports used:1,VGA are:1,Table 23.1:1,The CRTC:1,CRTC SC:1,SC and:1,and GC:1,respective Index:1,Index registers:1,registers plus:1,one However:1,3C0H The:1,this port:1,port toggles:1,toggles on:1,every OUT:1,and resets:1,resets to:1,next OUT:1,3C0H on:1,mode Table:1,1.1 The:1,The Ports:1,Ports through:1,controlled Register:1,Register Address:1,Address AC:1,AC Index/Data:1,3C0H write:1,with toggle:1,toggle AC:1,3C0H read:1,read AC:1,register 3C1H:1,3C1H read:1,read Miscellaneous:1,3C2H write:1,write 3CCH:1,3CCH read:1,read Input:1,3C2H read:1,read SC:1,SC Index:1,register 3C4H:1,3C4H read/write:1,read/write SC:1,SC Data:1,register 3C5H:1,3C5H read/write:1,register 3CEH:1,3CEH read/write:1,register 3CFH:1,3CFH read/write:1,CRTC Index:1,register 3B4H/3D4H:1,3B4H/3D4H read/write:1,CRTC Data:1,register 3B5H/3D5H:1,3B5H/3D5H read/write:1,read/write Input:1,1 register/AC:1,register/AC Index/Data:1,Index/Data reset:1,reset 3:1,3 BAH/3DAH:1,BAH/3DAH read:1,read Feature:1,Feature Control:1,Control 3BAH/3DAH:1,3BAH/3DAH write:1,write 3CAH:1,3CAH read:1,read 3BAH:1,modes Note:1,all CRTC:1,either 3DXH:1,3DXH or:1,or 3BXH:1,3BXH the:1,former in:1,latter in:1,This provides:1,provides compatibility:1,register addressing:1,addressing of:1,the now-vanished:1,now-vanished Color/Graphics:1,Adapter and:1,and Monochrome:1,Adapter The:1,The method:1,method used:1,set registers:1,index perform:1,OUT increment:1,increment DX:1,AC where:1,where DX:1,DX remains:1,same load:1,OUT A:1,A handy:1,handy shortcut:1,shortcut is:1,index load:1,load AH:1,AH with:1,OUT Since:1,OUT value:1,value goes:1,port DX:1,DX 1:1,first method:1,method but:1,technique does:1,both AC:1,3C0H so:1,so two:1,s must:1,AC Actually:1,Actually word:1,AC do:1,do work:1,they shouldn’t:1,used As:1,above you:1,sure which:1,which mode—Index:1,mode—Index or:1,or Data—the:1,Data—the AC:1,AC is:1,in before:1,do an:1,3C0H you:1,AC to:1,mode How:1,How safe:1,OUT method:1,addressing VGA:1,past run:1,into adapter/computer:1,adapter/computer combinations:1,combinations that:1,had trouble:1,with word:1,s however:1,am aware:1,of have:1,fixed Moreover:1,Moreover a:1,software now:1,now uses:1,uses word:1,s so:1,computer or:1,doesn’t properly:1,properly support:1,support word:1,could scarcely:1,clone at:1,all A:1,A speed:1,speed tip:1,tip The:1,each chip’s:1,chip’s Index:1,same until:1,reprogrammed This:1,are setting:1,same internal:1,register repeatedly:1,repeatedly you:1,that internal:1,register multiple:1,times For:1,often set:1,repeatedly inside:1,standard code:1,is MOV:1,DXAX AH:1,AH contains:1,setting Alternatively:1,could initially:1,DXAL set:1,set GC:1,register INC:1,INC DX:1,DX point:1,repeatedly with:1,the byte-size:1,byte-size OUT:1,instruction OUT:1,DXAL AL:1,AL contains:1,setting which:1,never slower:1,word-sized OUT:1,OUT and:1,require AH:1,AH to:1,set freeing:1,this method:1,method only:1,works if:1,unchanged throughout:1,loop Linear:1,Linear Planes:1,Planes and:1,and True:1,True VGA:1,VGA Modes:1,VGA’s memory:1,four 64K:1,64K planes:1,planes Each:1,these planes:1,bitmap that:1,plane controls:1,controls eight:1,eight adjacent:1,next eight:1,then controls:1,VGA adds:1,powerful twist:1,twist to:1,to linear:1,linear addressing:1,physical width:1,display The:1,The programmer:1,define all:1,all or:1,or part:1,VGA’s large:1,large memory:1,to 4080:1,4080 pixels:1,onto any:1,screen What’s:1,any logical:1,height up:1,the capacity:1,memory Such:1,a spreadsheet:1,spreadsheet or:1,a CAD/CAM:1,CAD/CAM drawing:1,instance As:1,provides excellent:1,excellent hardware:1,moving around:1,screen taken:1,VGA’s smooth:1,panning capabilities:1,capabilities can:1,generate very:1,impressive effects:1,effects All:1,addressed in:1,same 64K:1,64K memory:1,memory space:1,space starting:1,A0000000 Consequently:1,in manipulating:1,manipulating all:1,single memory:1,access so:1,switching between:1,between planes:1,planes Astute:1,Astute use:1,this VGA:1,hardware allows:1,allows VGA:1,VGA software:1,as quadruple:1,quadruple performance:1,parallel Each:1,Each memory:1,plane provides:1,provides one:1,The bits:1,are combined:1,combined into:1,nibble that:1,maps the:1,colors selected:1,23.1 All:1,All sixty-four:1,sixty-four mappings:1,mappings for:1,are independently:1,independently programmable:1,programmable We’ll:1,capabilities in:1,detail starting:1,33 The:1,supports several:1,several graphics:1,6 in:1,which VGA:1,memory appears:1,appears not:1,planes These:1,These modes:1,modes exist:1,for CGA:1,CGA compatibility:1,compatibility only:1,not true:1,modes use:1,need CGA-type:1,CGA-type operation:1,ignore them:1,VGA’s special:1,special features:1,16-color true-VGA:1,true-VGA modes:1,0DH 320x200:1,320x200 0EH:1,0EH 640x200:1,640x200 10H:1,640x350 and:1,640x480 that:1,will concentrate:1,concentrate in:1,book There:1,13H that:1,linear plane:1,plane but:1,47-49 of:1,a polite:1,polite fiction—and:1,fiction—and discarding:1,discarding that:1,that fiction:1,fiction gives:1,to unleash:1,unleash the:1,for vastly:1,performance VGA:1,which feature:1,feature soft:1,soft fonts:1,matter entirely:1,entirely upon:1,touch from:1,from time:1,pixel With:1,background out:1,23.1 I:1,program before:1,continuing since:1,the explanations:1,explanations will:1,mean far:1,you if:1,action Smooth:1,Smooth Panning:1,Panning The:1,notice upon:1,upon running:1,the remarkable:1,remarkable smoothness:1,smoothness with:1,display pans:1,pans from:1,from side-to-side:1,side-to-side and:1,and up-and-down:1,up-and-down That:1,That the:1,display can:1,can pan:1,pan at:1,two VGA:1,features 256K:1,screen capability:1,capability Even:1,most memory-hungry:1,memory-hungry of:1,modes mode:1,640x480 uses:1,only 37.5K:1,of 150K:1,150K out:1,total 256K:1,The medium-resolution:1,medium-resolution mode:1,640x350 requires:1,only 28K:1,28K per:1,of 112K:1,112K Consequently:1,store more:1,full screens:1,screens of:1,uses and:1,displayed In:1,program memory:1,two virtual:1,virtual screens:1,screens each:1,of 672x384:1,672x384 as:1,23.2 The:1,begin fetching:1,fetching video:1,data this:1,registers Start:1,High CRTC:1,and Start:1,Low CRTC:1,register 0DH:1,0DH Together:1,registers make:1,16-bit display:1,CRTC begins:1,begins fetching:1,fetching data:1,each video:1,video frame:1,frame Increasing:1,Increasing the:1,address causes:1,causes higher-memory:1,higher-memory areas:1,displayed For:1,80H and:1,Low register:1,to 00H:1,00H in:1,reflect memory:1,plane rather:1,default offset:1,0 Figure:1,23.1 Figure:1,available As:1,VGA scans:1,scans display:1,it progresses:1,address toward:1,toward higher:1,higher memory:1,completed Consequently:1,increased lines:1,lines farther:1,farther toward:1,screen are:1,scroll up:1,allows redefinition:1,redefinition of:1,memory considered:1,line Normally:1,Normally 40:1,memory constitute:1,constitute a:1,CRTC scans:1,scans these:1,these 40:1,for 640:1,advances 40:1,words from:1,that displayed:1,are contiguous:1,contiguous in:1,are logically:1,logically wider:1,wider or:1,or narrower:1,narrower for:1,their displayed:1,displayed width:1,width The:1,to 2AH:1,2AH making:1,screen 42:1,42 words:1,or 42:1,42 2:1,2 8:1,8 672:1,672 pixels:1,as contrasted:1,contrasted with:1,actual width:1,10h screen:1,screen 40:1,or 640:1,is 384:1,384 this:1,accomplished simply:1,by reserving:1,reserving 84:1,84 384:1,384 contiguous:1,screen where:1,where 84:1,84 is:1,and 384:1,384 is:1,height in:1,to panning:1,panning around:1,display panning:1,panning down:1,line requires:1,address be:1,logical scan:1,line width:1,bytes which:1,register times:1,times two:1,well allowing:1,allowing horizontal:1,case only:1,only relatively:1,relatively coarse:1,byte-sized adjustments—panning:1,adjustments—panning by:1,a time—are:1,time—are supported:1,supported Smooth:1,13H working:1,address Up:1,of single:1,panning of:1,7 This:1,This exhausts:1,exhausts the:1,motion possible:1,next pixel’s:1,pixel’s worth:1,of smooth:1,by incrementing:1,incrementing the:1,address by:1,and resetting:1,resetting the:1,0 Smooth:1,panning should:1,of fine:1,fine adjustments:1,adjustments in:1,the 8-pixel:1,8-pixel range:1,range between:1,between coarse:1,byte-sized adjustments:1,adjustments A:1,A horizontal:1,panning oddity:1,oddity Alone:1,Alone among:1,among VGA:1,modes text:1,cases has:1,has 9:1,character clock:1,clock Smooth:1,Smooth panning:1,requires cycling:1,register through:1,values 8:1,8 0:1,7 8:1,the no:1,no panning:1,setting There:1,one annoying:1,annoying quirk:1,quirk about:1,AC When:1,set only:1,lower five:1,five bits:1,index The:1,next most:1,5 controls:1,data sent:1,monitor by:1,RAM derived:1,pixels this:1,is normal:1,operation When:1,data does:1,time bit:1,is during:1,register since:1,RAM when:1,0 Some:1,Some VGAs:1,VGAs do:1,not enforce:1,enforce this:1,RAM just:1,be safe:1,safe Immediately:1,after setting:1,RAM however:1,however 20h:1,20h or:1,other value:1,5 set:1,1 should:1,restore normal:1,normal video:1,times bit:1,5 should:1,way palette:1,interrupt interrupt:1,10H Whenever:1,Whenever an:1,an VGA:1,VGA function:1,performed reasonably:1,well through:1,RAM it:1,in reinventing:1,wheel and:1,well mask:1,incompatibilities between:1,clones Color:1,Color Plane:1,Plane Manipulation:1,Manipulation The:1,for manipulating:1,planes Two:1,Two features:1,features illustrated:1,four bytes—one:1,each plane—with:1,plane—with a:1,register SC:1,SC register:1,2 selects:1,selects which:1,writes If:1,RAM address:1,address If:1,then CPU:1,0 Bits:1,Bits 1:1,register similarly:1,similarly control:1,control CPU:1,planes 1:1,3 respectively:1,respectively Any:1,of enabled:1,and disabled:1,disabled planes:1,selected Beware:1,Beware however:1,however of:1,not zeroed:1,zeroed Planes:1,Planes that:1,not altered:1,altered by:1,writes so:1,so old:1,new images:1,can mix:1,mix on:1,screen producing:1,producing unwanted:1,unwanted color:1,as say:1,say three:1,image mix:1,mix with:1,program solves:1,solves this:1,by ensuring:1,memory written:1,zeroed A:1,the colored:1,ball to:1,enabling one:1,ball for:1,plane Each:1,Each image:1,same VGA:1,VGA addresses:1,addresses only:1,different You:1,the ball’s:1,ball’s image:1,four colored:1,colored overlays:1,overlays which:1,enabling all:1,the zero:1,VGA planes:1,planes simultaneously:1,simultaneously The:1,a nondisplayed:1,nondisplayed portion:1,useful VGA:1,once As:1,shown by:1,the image-loading:1,image-loading code:1,above four:1,four different:1,and writes—and:1,writes—and several:1,several OUT:1,s as:1,as well—are:1,well—are required:1,same image:1,a non-planar:1,non-planar pixel:1,pixel buffer:1,causes unacceptably:1,performance all:1,memory make:1,it very:1,very desirable:1,s tend:1,selected via:1,via bits:1,GC Mode:1,5 Be:1,Be careful:1,careful to:1,bits 2-7:1,2-7 when:1,23.1 In:1,read loads:1,planes into:1,write writes:1,planes During:1,were previously:1,previously drawn:1,desired area:1,block copy:1,copy operation:1,excellent way:1,reads writes:1,and OUTs:1,OUTs required:1,memory low:1,allow real-time:1,real-time drawing:1,still mask:1,out planes:1,1 All:1,copied in:1,program because:1,still 0Fh:1,0Fh from:1,from when:1,image was:1,was created:1,created The:1,The animated:1,images appear:1,bit jerkily:1,jerkily because:1,are byte-aligned:1,byte-aligned and:1,so must:1,must move:1,solved by:1,storing rotated:1,rotated versions:1,each instance:1,instance drawing:1,correct rotation:1,alignment at:1,drawn we’ll:1,action in:1,49 Don’t:1,not catching:1,catching everything:1,complicated beast:1,beast and:1,an iterative:1,iterative process:1,process We’ll:1,We’ll be:1,be going:1,features again:1,different contexts:1,contexts over:1,book Page:1,Flipping When:1,When animated:1,drawn directly:1,no intermediate:1,intermediate frame-composition:1,frame-composition stage:1,image typically:1,typically flickers:1,flickers and/or:1,and/or ripples:1,ripples an:1,unavoidable result:1,data The:1,VGA makes:1,eliminates such:1,The modifications:1,modifications never:1,never affect:1,affect an:1,no undesirable:1,undesirable side:1,effects occur:1,occur Once:1,the modification:1,modification is:1,modified buffer:1,display causing:1,single frame’s:1,frame’s time:1,time typically:1,typically 1/60th:1,1/60th or:1,or 1/70th:1,1/70th of:1,other buffer:1,then available:1,for modification:1,modification As:1,has 64K:1,plane enough:1,hold two:1,10H but:1,12H For:1,For page:1,flipping two:1,two non-overlapping:1,non-overlapping areas:1,uses two:1,pages each:1,each 32256:1,32256 bytes:1,long one:1,A0000000 and:1,at A0007E00:1,A0007E00 Flipping:1,Flipping between:1,display area:1,the other—but:1,other—but as:1,sounds The:1,The timing:1,between pages:1,to achieving:1,achieving flicker-free:1,flicker-free animation:1,animation It:1,program never:1,be modifying:1,modifying an:1,data Achieving:1,Achieving this:1,surprisingly complicated:1,complicated on:1,internal circuitry:1,circuitry exactly:1,frame typically:1,typically but:1,clones at:1,pulse The:1,The vertical:1,fact available:1,register addressable:1,addressable at:1,at 3BAH:1,or 3DAH:1,3DAH color:1,color Unfortunately:1,observed by:1,address for:1,frame has:1,been latched:1,latched having:1,having happened:1,instant the:1,pulse began:1,began That:1,begin then:1,address if:1,did that:1,drawing because:1,page wouldn’t:1,wouldn’t flip:1,flip until:1,until then:1,then Clearly:1,Clearly what:1,pulse at:1,flipped However:1,wait because:1,extreme misfortune:1,misfortune to:1,registers before:1,after resulting:1,in mismatched:1,mismatched halves:1,nasty jump:1,jump of:1,image for:1,frame One:1,pick a:1,lower byte:1,byte so:1,register ever:1,ever needs:1,23.1 I’ve:1,gone for:1,for generality:1,generality and:1,both bytes:1,bytes To:1,avoid mismatched:1,as indicated:1,indicated by:1,status this:1,us we’re:1,we’re somewhere:1,frame far:1,from vertical:1,sync so:1,address will:1,will get:1,get used:1,sync Once:1,observed the:1,address waits:1,happen sets:1,panning state:1,then continues:1,continues drawing:1,drawing Don’t:1,details right:1,now page:1,up again:1,again at:1,at considerably:1,greater length:1,side note:1,note be:1,run DOS:1,DOS software:1,software under:1,a multitasking:1,multitasking environment:1,NT timeslicing:1,timeslicing delays:1,delays can:1,make mismatched:1,or mismatched:1,and pel:1,settings much:1,likely for:1,interrupted at:1,although much:1,less likely:1,likely under:1,under non-multitasking:1,non-multitasking environments:1,environments such:1,as DOS:1,DOS because:1,because strategically:1,strategically placed:1,placed interrupts:1,same sorts:1,problems there:1,there For:1,should disable:1,interrupts around:1,your page-flipping:1,page-flipping code:1,although here:1,if interrupts:1,disabled from:1,we start:1,Enable until:1,register they:1,off for:1,and keyboard:1,mouse and:1,and network:1,network events:1,events will:1,will potentially:1,lost Also:1,Also disabling:1,interrupts won’t:1,won’t help:1,true multitasking:1,multitasking environments:1,environments which:1,which never:1,never let:1,program hog:1,hog the:1,entire CPU:1,that pel:1,although indubitably:1,indubitably flashy:1,flashy isn’t:1,isn’t widely:1,be reserved:1,it’s absolutely:1,necessary Waiting:1,pulse has:1,causing program:1,program execution:1,execution to:1,to synchronize:1,synchronize to:1,VGA’s frame:1,70 frames:1,second depending:1,This synchronization:1,synchronization has:1,useful consequence:1,CPU that:1,draw fast:1,just idles:1,idles for:1,frame that:1,finished displaying:1,previous frame:1,frame An:1,point illustrated:1,far larger:1,more versatile:1,versatile than:1,with earlier:1,earlier adapters:1,adapters it:1,resource and:1,used judiciously:1,judiciously The:1,uses VGA:1,store two:1,pages leaving:1,only 1024:1,1024 bytes:1,bytes free:1,store images:1,images In:1,only images:1,images needed:1,needed are:1,blank block:1,erase it:1,applications require:1,require dozens:1,images The:1,The tradeoffs:1,tradeoffs between:1,between virtual:1,virtual page:1,page size:1,size page:1,storage must:1,designing programs:1,program run:1,in 640x200:1,640x200 16-color:1,mode comment:1,comment out:1,the EQU:1,EQU line:1,for MEDRES_VIDEO_MODE:1,MEDRES_VIDEO_MODE The:1,VGA Clones:1,Clones Earlier:1,doesn’t support:1,functionality covered:1,book can’t:1,can’t properly:1,properly be:1,called VGA:1,compatible I:1,also noted:1,some exceptions:1,exceptions however:1,just come:1,most prominent:1,prominent one:1,one You:1,VGAs really:1,IBM VGA’s:1,VGA’s functionality:1,functionality when:1,pixels into:1,else involved:1,with manipulating:1,manipulating display:1,memory really:1,way on:1,clones That:1,That compatibility:1,compatibility isn’t:1,as airtight:1,airtight when:1,to scanning:1,scanning pixels:1,certain infrequently-used:1,infrequently-used ways:1,ways however:1,The areas:1,of incompatibility:1,incompatibility of:1,I’m aware:1,aware are:1,may in:1,have caused:1,caused you:1,see some:1,some glitches:1,glitches when:1,you ran:1,ran Listing:1,problem which:1,which arises:1,arises only:1,on certain:1,certain VGAs:1,VGAs is:1,some settings:1,the Row:1,Row Offset:1,register cause:1,cause some:1,be dropped:1,dropped or:1,or displaced:1,displaced to:1,wrong place:1,place on:1,screen often:1,often this:1,certain start:1,address settings:1,settings In:1,experience only:1,only VRAM:1,VRAM Video:1,Video RAM:1,RAM based:1,based VGAs:1,VGAs exhibit:1,exhibit this:1,problem no:1,doubt due:1,from VRAM:1,VRAM in:1,blocks Panning:1,Panning and:1,large virtual:1,reliably by:1,careful selection:1,bitmap sizes:1,addresses but:1,difficult that’s:1,most commercial:1,commercial software:1,software does:1,use these:1,features although:1,games do:1,use oversized:1,oversized virtual:1,and pan:1,pan around:1,them you:1,take great:1,great care:1,of VRAM:1,VRAM and:1,and DRAM-based:1,DRAM-based VGAs:1,VGAs Just:1,Just the:1,the Beginning:1,Beginning That:1,That pretty:1,well covers:1,covers the:1,important points:1,23.1 There:1,features we:1,even touch:1,the variety:1,features available:1,convey the:1,the flexibility:1,flexibility and:1,VGA’s resources:1,initial sense:1,like Starting:1,Starting with:1,VGA systematically:1,systematically on:1,detailed basis:1,The Macro:1,Macro Assembler:1,Assembler The:1,both C:1,think C:1,good development:1,environment but:1,easiest to:1,write or:1,most reliable:1,reliable is:1,family given:1,given segments:1,the asymmetric:1,asymmetric and:1,limited register:1,complex board:1,board like:1,VGA there’s:1,there’s really:1,other choice:1,lowest-level code:1,code Before:1,Before I’m:1,I’m deluged:1,deluged with:1,with protests:1,protests from:1,C devotees:1,devotees let:1,me add:1,my productive:1,productive work:1,C no:1,no programmer:1,is immune:1,immune to:1,the laws:1,laws of:1,more time-efficient:1,time-efficient environment:1,develop particularly:1,programming team:1,team In:1,however we’re:1,non of:1,PC graphics—performance—and:1,graphics—performance—and we:1,language Now:1,VGA looks:1,in broad:1,broad strokes:1,strokes and:1,depth In:1,assistance the:1,access There:1,those chips:1,chips along:1,some useful:1,useful masks:1,and comparators:1,comparators and:1,hardware that’s:1,between sluggish:1,sluggish performance:1,VGA get:1,and dance:1,dance Chapter:1,24 Parallel:1,Parallel Processing:1,Processing with:1,VGA Taking:1,Taking on:1,Graphics Memory:1,Memory Four:1,Four Bytes:1,Bytes at:1,a Time:1,Time This:1,This heading:1,heading refers:1,manipulate up:1,once In:1,provides four:1,ALUs Arithmetic:1,Arithmetic Logic:1,Logic Units:1,Units to:1,this hardware:1,tremendous resource:1,resource in:1,of manipulating:1,VGA’s sizable:1,sizable frame:1,complex data:1,flow architecture:1,VGA but:1,since they’re:1,they’re involved:1,all memory:1,access operations:1,operations they’re:1,begin VGA:1,Programming ALUs:1,and Latches:1,Latches I’m:1,our detailed:1,detailed tour:1,the flow:1,ALUs built:1,VGA’s Graphics:1,GC circuitry:1,circuitry The:1,ALUs one:1,ORing ANDing:1,and XORing:1,XORing CPU:1,data together:1,as masking:1,off some:1,from affecting:1,affecting the:1,result All:1,ALUs perform:1,same logical:1,logical operation:1,different display:1,byte Recall:1,address All:1,bytes operated:1,operated on:1,on are:1,was read:1,This arrangement:1,arrangement allows:1,allows four:1,write which:1,must often:1,be preceded:1,see The:1,The benefit:1,benefit is:1,CPU had:1,via OUT:1,four logical:1,operations itself:1,itself VGA:1,crawl Figure:1,24.1 is:1,simplified depiction:1,depiction of:1,flow around:1,ALUs Each:1,ALU has:1,latch which:1,which holds:1,plane during:1,last CPU:1,plane wasn’t:1,CPU actually:1,access Only:1,CPU with:1,single display:1,plane supplying:1,supplying the:1,specified address:1,read when:1,respective latches:1,latches Each:1,ALU logically:1,combines the:1,byte stored:1,the matching:1,latch according:1,well which:1,cover next:1,neither ALU:1,ALU operand:1,operand comes:1,comes directly:1,The temptation:1,temptation is:1,ALUs as:1,as combining:1,combining CPU:1,address being:1,actually combine:1,combine CPU:1,last display:1,location read:1,which need:1,indeed to:1,modify a:1,write that:1,modifies it:1,it Omission:1,Omission of:1,read results:1,that logically:1,combines CPU:1,data n:1,whatever data:1,normally undesirable:1,undesirable Figure:1,flow Occasionally:1,the independence:1,independence of:1,to can:1,to great:1,great advantage:1,advantage The:1,perform 4-byte-at-a-time:1,4-byte-at-a-time one:1,plane block:1,source area:1,area and:1,destination area:1,unmodified in:1,By selecting:1,selecting write:1,this see:1,written The:1,complex area:1,area fill:1,pattern used:1,The mechanism:1,First generate:1,desired pattern:1,pattern across:1,address Generating:1,Generating the:1,pattern requires:1,plane’s byte:1,byte will:1,be unique:1,unique Next:1,Next read:1,pattern in:1,times by:1,using either:1,either write:1,mask since:1,performed If:1,pattern does:1,each plane—that:1,plane—that is:1,black and:1,and white—filling:1,white—filling can:1,performed more:1,easily by:1,simply fanning:1,fanning the:1,byte out:1,set/reset registers:1,with fanning:1,fanning out:1,of two-color:1,two-color patterns:1,patterns More:1,Listing 24.1:1,24.1 fills:1,with horizontal:1,horizontal bars:1,bars then:1,then illustrates:1,four ALU:1,ALU logical:1,functions by:1,vertical 80-pixel-wide:1,80-pixel-wide box:1,solid empty:1,horizontal bar:1,bar patterns:1,patterns over:1,over that:1,background using:1,turn When:1,When observing:1,four vertical:1,vertical boxes:1,with exactly:1,same code—only:1,code—only the:1,effect differs:1,from box:1,to box:1,box All:1,All graphics:1,graphics in:1,in black-and-white:1,black-and-white by:1,ALUs most:1,most clearly:1,clearly Selective:1,Selective enabling:1,enabling of:1,planes via:1,and/or set/reset:1,set/reset would:1,produce color:1,effects in:1,functions must:1,be evaluated:1,evaluated on:1,a plane-by-plane:1,plane-by-plane basis:1,basis since:1,the enabled:1,enabled planes:1,operation Logical:1,Logical function:1,function 0:1,which writes:1,unmodified is:1,ALUs In:1,is combined:1,data by:1,data entirely:1,entirely Expressed:1,Expressed as:1,function this:1,this could:1,considered CPU:1,data ANDed:1,or ORed:1,use whenever:1,place CPU:1,memory replacing:1,contents entirely:1,entirely It:1,latch display:1,latches must:1,loaded even:1,chapter Logical:1,Logical functions:1,functions 1:1,3 cause:1,be ANDed:1,ANDed ORed:1,ORed and:1,and XORed:1,XORed with:1,data respectively:1,respectively Of:1,Of these:1,these XOR:1,useful since:1,since exclusive-ORing:1,exclusive-ORing is:1,The uses:1,OR logical:1,obvious AND:1,blank area:1,area into:1,off those:1,overlap an:1,existing display:1,memory image:1,image OR:1,OR could:1,memory over:1,existing image:1,image To:1,honest I:1,haven’t encountered:1,encountered any:1,any particularly:1,particularly valuable:1,valuable applications:1,for AND:1,OR but:1,of building-block:1,building-block features:1,context so:1,so keep:1,mind Notes:1,the ALU/Latch:1,ALU/Latch Demo:1,Program VGA:1,settings such:1,select should:1,restored to:1,default condition:1,condition before:1,to output:1,output text:1,text or:1,or draw:1,BIOS does:1,set most:1,registers except:1,except on:1,many compatible:1,BIOSes around:1,IBM BIOS:1,reliable guide:1,guide For:1,instance when:1,text it’s:1,be illegible:1,illegible if:1,default state:1,state Similarly:1,Similarly a:1,set should:1,performed before:1,before exiting:1,exiting a:1,that tinkers:1,tinkers with:1,settings Along:1,same lines:1,explicitly set:1,writing The:1,10H leaves:1,leaves all:1,planes enabled:1,not bother:1,other register:1,register besides:1,besides the:1,matter However:1,of compatible:1,BIOSes means:1,means there:1,small risk:1,risk in:1,in relying:1,leave registers:1,registers set:1,set properly:1,properly For:1,the highly:1,highly safety-conscious:1,safety-conscious the:1,best course:1,course would:1,program data:1,data control:1,registers such:1,and Read:1,Read Mask:1,Mask explicitly:1,explicitly before:1,their contents:1,contents On:1,hand any:1,function the:1,provides explicitly—as:1,explicitly—as part:1,the interface:1,interface specification—such:1,specification—such as:1,directly whenever:1,mask hardware:1,hardware differences:1,between VGA:1,VGA implementations:1,implementations The:1,vertical box:1,program reads:1,memory immediately:1,operation loads:1,irrelevant as:1,concerned The:1,present only:1,read without:1,without placing:1,some 8-bit:1,be destroyed:1,destroyed Under:1,circumstances a:1,single logical:1,as XOR:1,XOR or:1,or AND:1,perform both:1,modify display:1,CPU registers:1,on All:1,All text:1,by VGA:1,function 13H:1,This function:1,also present:1,AT’s BIOS:1,BIOS but:1,the XT’s:1,XT’s or:1,or PC’s:1,PC’s and:1,always available:1,available if:1,installed however:1,however Text:1,Text drawn:1,If speed:1,program can:1,text directly:1,BIOS write:1,an uncomplicated:1,uncomplicated way:1,get text:1,screen reliably:1,reliably in:1,color over:1,over any:1,any background:1,The expression:1,expression used:1,load DX:1,DX in:1,the TEXT_UP:1,TEXT_UP macro:1,macro in:1,strange but:1,time DX:1,DX is:1,that’s composed:1,two independent:1,independent immediate:1,immediate byte:1,with cb234-1:1,cb234-1 MOV:1,MOV DLVALUE1:1,DLVALUE1 cb234-2:1,cb234-2 MOV:1,MOV DHVALUE2:1,DHVALUE2 which:1,bytes By:1,By shifting:1,shifting the:1,MASM’s shift-left:1,shift-left operator:1,operator SHL:1,SHL 100H:1,100H would:1,work also:1,also and:1,then logically:1,logically combining:1,values with:1,MASM’s OR:1,OR operator:1,operator or:1,ADD operator:1,operator both:1,of DX:1,DX can:1,in cb235-1:1,cb235-1 MOV:1,MOV DX:1,DX VALUE2:1,VALUE2 SHL:1,SHL 8:1,8 OR:1,OR VALUE1:1,VALUE1 which:1,faster being:1,performance penalty:1,for 16-bit:1,MOV above:1,above see:1,macro is:1,ideal place:1,technique the:1,macro invocation:1,invocation can:1,can refer:1,values making:1,making matters:1,matters easier:1,easier for:1,programmer while:1,macro itself:1,itself can:1,can combine:1,single word-sized:1,word-sized constant:1,constant A:1,minor optimization:1,optimization tip:1,tip illustrated:1,of INC:1,DEC AX:1,AX in:1,the DrawVerticalBox:1,DrawVerticalBox subroutine:1,subroutine when:1,only AL:1,AL actually:1,actually needs:1,modified Word-sized:1,Word-sized register:1,or dword-sized:1,dword-sized instructions:1,while byte-size:1,byte-size register:1,long Consequently:1,Consequently when:1,when size:1,size counts:1,counts it:1,whole 16-bit:1,16-bit or:1,register instead:1,for INC:1,INC and:1,DEC if:1,upper portion:1,other purpose:1,purpose or:1,the INC:1,INC or:1,or DEC:1,DEC won’t:1,upper part:1,are central:1,high-performance VGA:1,allow programs:1,process across:1,planes without:1,and read/write:1,read/write operations:1,operations It:1,always easy:1,arrange a:1,to exploit:1,exploit this:1,this power:1,power however:1,limited than:1,CPU In:1,many instances:1,instances however:1,however additional:1,additional hardware:1,VGA including:1,set/reset features:1,shifter can:1,can assist:1,in controlling:1,controlling data:1,25 VGA:1,Data Machinery:1,Machinery The:1,The Barrel:1,Barrel Shifter:1,Shifter Bit:1,Set/Reset Mechanisms:1,Mechanisms In:1,examined a:1,simplified model:1,flow within:1,GC portion:1,VGA featuring:1,ALUs Now:1,to expand:1,expand that:1,shifter bit:1,capabilities leaving:1,be explored:1,chapters VGA:1,Data Rotation:1,Rotation Figure:1,expanded model:1,GC data:1,flow featuring:1,circuitry Let’s:1,shifter first:1,first A:1,A barrel:1,is circuitry:1,circuitry capable:1,of shifting—or:1,shifting—or rotating:1,rotating in:1,VGA’s case—data:1,case—data an:1,shift only:1,position at:1,shifter in:1,rotate incoming:1,incoming CPU:1,data up:1,right toward:1,bit with:1,0 wrapping:1,to bit:1,7 after:1,VGA continues:1,normally processes:1,processes unrotated:1,unrotated CPU:1,data Thanks:1,of barrel:1,barrel shifters:1,shifters this:1,this rotation:1,rotation requires:1,over unrotated:1,unrotated VGA:1,VGA operations:1,which CPU:1,is shifted:1,shifted is:1,bits 2-0:1,2-0 of:1,register 3:1,also contains:1,ALU function:1,select bits:1,bits data:1,unmodified AND:1,XOR that:1,at in:1,Controller Figure:1,Controller The:1,is powerful:1,as sometimes:1,sometimes happens:1,this business:1,business it:1,sounds more:1,GC can:1,rotate CPU:1,data a:1,performing Two:1,Two OUT:1,given rotation:1,rotation one:1,with careful:1,careful programming:1,programming it’s:1,Index always:1,always pointing:1,needed Even:1,often easier:1,easier and/or:1,and/or faster:1,data of:1,interest CL:1,CL times:1,register Bear:1,single OUT:1,OUT takes:1,from 11:1,11 to:1,to 31:1,31 cycles:1,a 486—and:1,486—and longer:1,longer if:1,is sluggish:1,sluggish at:1,at responding:1,responding to:1,to OUTs:1,OUTs as:1,are If:1,rotate latched:1,data then:1,then there:1,for rotation:1,rotation but:1,but sadly:1,sadly only:1,only CPU:1,rotated The:1,The drawing:1,of bit-mapped:1,one use:1,that application:1,application below:1,don’t knock:1,knock yourself:1,yourself out:1,out trying:1,work data:1,rotation into:1,your programs—it:1,programs—it just:1,isn’t all:1,that useful:1,Mask The:1,has bit:1,The four:1,masks operate:1,all driven:1,same mask:1,operation so:1,they’re generally:1,generally referred:1,the singular:1,singular as:1,mask Figure:1,circuitry occurs:1,occurs eight:1,memory Briefly:1,Briefly the:1,mask determines:1,determines on:1,basis whether:1,ALU for:1,by GC:1,memory unchanged:1,actual bit:1,that’s applied:1,logical AND:1,AND of:1,26 The:1,allow updating:1,updating of:1,bits within:1,latched the:1,or bits:1,mask preserving:1,the indicated:1,indicated latched:1,and allowing:1,allowing ALU:1,bits Remember:1,alter selected:1,byte directly:1,directly the:1,be latched:1,keep selected:1,latched byte:1,byte unchanged:1,rotation capabilities:1,GC to:1,draw bitmapped:1,any screen:1,screen location:1,location The:1,The BIOS:1,BIOS only:1,only draws:1,draws characters:1,character boundaries:1,boundaries in:1,640x480 graphics:1,boundaries horizontally:1,16 scan:1,lines vertically:1,vertically However:1,with direct:1,direct bitmapped:1,25.1 it’s:1,any font:1,font of:1,size anywhere:1,than via:1,than bit-aligned:1,bit-aligned fonts:1,fonts For:1,fast pixel:1,drawing such:1,35 It’s:1,of primitives:1,primitives such:1,that potentially:1,potentially involve:1,involve modifying:1,modifying some:1,memory Basically:1,handy whenever:1,whenever only:1,changed because:1,allows full:1,full use:1,VGA’s four-way:1,four-way parallel:1,parallel processing:1,processing capabilities:1,capabilities for:1,without interfering:1,alternative would:1,be plane-by-plane:1,plane-by-plane processing:1,processing which:1,which from:1,perspective would:1,be undesirable:1,undesirable indeed:1,indeed It’s:1,out again:1,mask operates:1,latches not:1,a flexible:1,flexible resource:1,little imagination:1,imagination can:1,interesting purposes:1,solid background:1,color by:1,color somewhere:1,then reading:1,mask through:1,a foreground:1,color stencilled:1,stencilled into:1,without reading:1,memory first:1,first This:1,This only:1,writing whole:1,time clipped:1,clipped bytes:1,bytes require:1,mask unfortunately:1,unfortunately we’re:1,already using:1,for stencilling:1,stencilling in:1,case but:1,eliminates reading:1,does foreground-plus-background:1,foreground-plus-background drawing:1,one blurry-fast:1,blurry-fast pass:1,pass This:1,This last-described:1,last-described example:1,how I’d:1,you approach:1,VGA As:1,a rich:1,rich collection:1,hardware resources:1,resources that:1,can profitably:1,profitably be:1,some non-obvious:1,non-obvious ways:1,ways Don’t:1,be limited:1,obvious applications:1,latches bit:1,mask write:1,modes read:1,modes map:1,mask ALUs:1,circuitry Instead:1,Instead try:1,could work:1,work together:1,whatever task:1,task you:1,to need:1,made my:1,Chapters 47-49:1,47-49 demonstrates:1,demonstrates The:1,Rotate and:1,and Bit:1,as complete:1,complete as:1,The case:1,where text:1,is byte-aligned:1,byte-aligned could:1,detected and:1,performed much:1,faster without:1,Mask or:1,or Data:1,Rotate registers:1,four to:1,character spans:1,spans Likewise:1,Likewise non-aligned:1,non-aligned text:1,be streamlined:1,byte by:1,and combine:1,directly rather:1,25.1 was:1,illustrate VGA:1,bit masking:1,masking rather:1,text We’ll:1,see faster:1,faster text-drawing:1,code soon:1,soon One:1,One excellent:1,excellent rule:1,thumb is:1,all types:1,types especially:1,especially reads:1,reads which:1,than writes:1,Also in:1,25.1 it:1,lookup to:1,masks for:1,character rather:1,shifts used:1,example For:1,complex example:1,drawing bit-mapped:1,VGA see:1,see John:1,John Cockerham’s:1,Cockerham’s article:1,article Pixel:1,Pixel Alignment:1,Alignment of:1,EGA Fonts:1,Fonts PC:1,1987 Parenthetically:1,Parenthetically I’d:1,pass along:1,along John’s:1,John’s comment:1,comment about:1,VGA everything:1,complex He’s:1,He’s got:1,point there:1,VGA’s Set/Reset:1,Set/Reset Circuitry:1,Circuitry At:1,At last:1,final aspect:1,GC on:1,0 writes:1,circuitry Figure:1,25.3 shows:1,shows data:1,flow on:1,between this:1,this figure:1,figure and:1,and Figure:1,plane potentially:1,potentially the:1,data passes:1,not replace:1,data Briefly:1,circuitry enables:1,enables the:1,to elect:1,elect to:1,independently replace:1,either 00:1,00 or:1,0FFH What:1,feature Well:1,standard way:1,enable writes:1,color For:1,register would:1,to 09H:1,09H to:1,in high-intensity:1,high-intensity blue:1,blue here:1,here bits:1,operation Remember:1,that planes:1,not written:1,or modified:1,way This:1,memory being:1,zeroed if:1,if however:1,memory already:1,already contains:1,contains non-zero:1,non-zero data:1,data will:1,planes disabled:1,contain old:1,old data:1,data In:1,control using:1,Mask does:1,not force:1,problem A:1,A green:1,green pattern:1,pattern plane:1,1 planes:1,3 set:1,first written:1,memory Display:1,then filled:1,blue only:1,only plane:1,a Map:1,01H Where:1,blue crosses:1,crosses the:1,green cyan:1,is produced:1,produced rather:1,than blue:1,blue because:1,01H that:1,produces blue:1,blue leaves:1,green plane:1,1 unchanged:1,generate blue:1,blue unconditionally:1,unconditionally it:1,0FH clear:1,clear memory:1,fill with:1,blue Setting:1,Setting All:1,All Planes:1,Planes to:1,a Single:1,Single Color:1,Color The:1,to 0-bits:1,0-bits and:1,others to:1,to 1-bits:1,1-bits during:1,write while:1,while letting:1,letting CPU:1,data go:1,to still:1,so provides:1,circuitry works:1,bits 0-3:1,0-3 in:1,is extended:1,byte 0:1,and replaces:1,plane For:1,unchanged for:1,operation For:1,to 05H:1,05H then:1,replaced for:1,0 only:1,with is:1,is 0FFH:1,0FFH bit:1,register extended:1,byte Note:1,case bits:1,bits 1-3:1,1-3 of:1,register have:1,circuitry directly:1,in Graphics:1,Controller data:1,flow Refer:1,Refer back:1,25.3 to:1,circuitry passes:1,transformed by:1,ALU and:1,mask before:1,must enable:1,write When:1,When using:1,using set/reset:1,set/reset it:1,generally desirable:1,enable all:1,controlling since:1,those memory:1,planes which:1,register cannot:1,modified and:1,of enabling:1,enabling set/reset:1,force that:1,circuitry Listing:1,Listing 25.3:1,25.3 illustrates:1,written This:1,25.2 except:1,set/reset rather:1,The preexisting:1,preexisting pattern:1,completely overwritten:1,overwritten this:1,circuitry writes:1,writes 0-bytes:1,0-bytes to:1,off as:1,as 0FFH-bytes:1,0FFH-bytes to:1,on Manipulating:1,Manipulating Planes:1,Planes Individually:1,Individually Listing:1,25.4 illustrates:1,control only:1,some rather:1,than all:1,planes Here:1,circuitry forces:1,forces plane:1,0 Because:1,Because bit:1,0 however:1,however set/reset:1,set/reset does:1,data goes:1,goes unchanged:1,unchanged to:1,1 ALU:1,ALU Consequently:1,1 Given:1,other three:1,planes this:1,1 generates:1,a brown:1,brown pixel:1,bit that:1,pixel Writing:1,Writing alternating:1,alternating bytes:1,of 07H:1,07H and:1,and 0E0H:1,0E0H then:1,then creates:1,a vertically:1,vertically striped:1,striped pattern:1,of brown:1,brown and:1,and red:1,red In:1,25.4 note:1,vertical bars:1,bars are:1,10 and:1,wide and:1,not start:1,boundaries Although:1,Although set/reset:1,set/reset replaces:1,replaces an:1,entire byte:1,and CPU:1,above can:1,control individual:1,pixels There:1,no clearly:1,clearly defined:1,defined role:1,role for:1,say the:1,cases set/reset:1,largely interchangeable:1,interchangeable with:1,data particularly:1,2 write:1,2 operates:1,operates similarly:1,similarly to:1,27 The:1,powerful use:1,applications such:1,25.4 where:1,to certain:1,certain planes:1,though think:1,set/reset as:1,more tool:1,tool you:1,your disposal:1,disposal in:1,you force:1,either zero:1,zero or:1,or one:1,or pass:1,pass CPU:1,unchanged on:1,each write:1,memory As:1,As tools:1,tools go:1,go set/reset:1,handy one:1,it’ll pop:1,pop up:1,up often:1,book Notes:1,on Set/Reset:1,Set/Reset The:1,active in:1,modes 1:1,The Enable:1,is inactive:1,inactive in:1,3 but:1,primary drawing:1,chapter Be:1,because set/reset:1,set/reset directly:1,necessarily have:1,entire display:1,0FFH even:1,is replacing:1,replacing CPU:1,80H the:1,only modify:1,modify bit:1,plane since:1,other seven:1,plane Similarly:1,ALU Once:1,again this:1,this illustrates:1,set/reset merely:1,merely replaces:1,for selected:1,that CPU:1,data normally:1,normally is:1,A Brief:1,Brief Note:1,on Word:1,Word OUTs:1,OUTs In:1,early days:1,considerable debate:1,was safe:1,do word:1,s OUT:1,DXAX to:1,set Index/Data:1,register pairs:1,pairs in:1,instruction Long:1,Long ago:1,ago there:1,with buses:1,buses that:1,weren’t quite:1,quite PC-compatatible:1,PC-compatatible in:1,OUT went:1,order Data:1,register first:1,then Index:1,with predictably:1,predictably disastrous:1,disastrous results:1,generally wrote:1,wrote my:1,use two:1,set indexed:1,registers Later:1,on I:1,use macros:1,macros that:1,do either:1,one 16-bit:1,OUT or:1,s depending:1,assemble the:1,find both:1,of dealing:1,s sprinkled:1,sprinkled through:1,book Using:1,Using macros:1,macros for:1,for word:1,word OUTs:1,OUTs is:1,no harm:1,opinion it’s:1,Word OUT:1,standard now:1,them causing:1,causing any:1,problems Chapter:1,26 VGA:1,The Write:1,Mode That:1,That Grows:1,Grows on:1,on You:1,You Over:1,last three:1,path from:1,from stem:1,stem to:1,to stern—with:1,stern—with one:1,exception Thus:1,only looked:1,how writes:1,writes work:1,straightforward workhorse:1,workhorse mode:1,which each:1,memory fans:1,fans out:1,out across:1,planes Actually:1,also took:1,at write:1,always copied:1,copied unmodified:1,unmodified but:1,since exactly:1,little real:1,real significance:1,significance Write:1,useful mode:1,of VGA’s:1,VGA’s most:1,interesting capabilities:1,capabilities involve:1,involve the:1,two write:1,examine write:1,especially write:1,3 We’ll:1,but right:1,be confusing:1,confusing at:1,but turns:1,initially think:1,think A:1,A Mode:1,Mode Born:1,Born in:1,in Strangeness:1,Strangeness Write:1,is strange:1,strange indeed:1,obvious The:1,encountered write:1,understood immediately:1,immediately how:1,it functioned:1,functioned but:1,but could:1,few useful:1,As time:1,time passed:1,the atrocious:1,atrocious performance:1,pattern drawing:1,well write:1,3 grew:1,grew considerably:1,my estimation:1,estimation In:1,fact my:1,my esteem:1,esteem for:1,mode ultimately:1,ultimately reached:1,where in:1,major chunk:1,wrote write:1,3 was:1,used more:1,than write:1,0 overall:1,overall excluding:1,excluding simple:1,simple pixel:1,pixel copying:1,copying So:1,So write:1,using but:1,first understand:1,understand it:1,it Here’s:1,3 set/reset:1,automatically enabled:1,ignored The:1,then ANDed:1,register alone:1,used If:1,back at:1,25 There’s:1,3 without:1,path first:1,first That’s:1,3 does—but:1,does—but what:1,for It:1,that write:1,is excellent:1,excellent for:1,of purposes:1,the bane:1,bane of:1,performance OUT:1,s Some:1,Some uses:1,3 include:1,include lines:1,and two-color:1,two-color pattern:1,fills Most:1,Most importantly:1,importantly write:1,for transparent:1,mode quickly:1,quickly without:1,without wiping:1,wiping out:1,process As:1,chapter write:1,potentially terrific:1,for opaque:1,opaque text—text:1,text—text drawn:1,in with:1,solid color—as:1,color—as well:1,25 That:1,data rotate:1,mask features:1,process gains:1,gains the:1,useful ability:1,background into:1,drawn Where:1,code drew:1,entire character:1,box for:1,character with:1,0 bits:1,pattern causing:1,causing a:1,appear around:1,26.1 affects:1,when 1:1,pattern are:1,characters appear:1,be painted:1,painted into:1,background rather:1,than over:1,it Another:1,characters can:1,16 available:1,available colors:1,understanding Listing:1,indicating where:1,where character:1,appear The:1,The Data:1,to pixel-align:1,pixel-align it:1,it since:1,since without:1,without rotation:1,rotation characters:1,boundaries As:1,that that’s:1,efficient The:1,OUT that:1,sets that:1,is time-consuming:1,time-consuming especially:1,for proportional:1,proportional text:1,character Also:1,Also if:1,code performs:1,performs full-byte:1,full-byte accesses:1,display memory—that:1,memory—that is:1,it combines:1,combines pieces:1,one byte—whenever:1,byte—whenever possible:1,for efficiency:1,efficiency the:1,CPU generally:1,do extra:1,to prepare:1,prepare the:1,VGA’s rotator:1,rotator can:1,handle it:1,that portion:1,accessed that:1,character falls:1,that other:1,other characters:1,characters and/or:1,and/or graphics:1,data won’t:1,be wiped:1,wiped out:1,mask that:1,original character:1,character pattern:1,pattern rotated:1,and masked:1,masked to:1,CPU all:1,bits come:1,come straight:1,latches should:1,have previously:1,previously been:1,been loaded:1,address so:1,ultimate synthesized:1,synthesized bit:1,that correspond:1,that falls:1,pixels set:1,register Whew:1,Whew It:1,It sounds:1,sounds complex:1,given an:1,data rotator:1,rotator set/reset:1,set/reset and:1,mask do:1,do it’s:1,bad One:1,text-drawing program:1,25.1 back:1,26.1 differs:1,that program:1,program It’s:1,results generated:1,26.1 could:1,been accomplished:1,accomplished without:1,without write:1,3 Write:1,0 could:1,cost Instead:1,Instead of:1,letting write:1,3 rotate:1,CPU could:1,have rotated:1,rotated the:1,and ANDed:1,ANDed it:1,value Additionally:1,Additionally enable:1,been forced:1,forced on:1,planes emulating:1,emulating what:1,3 approach:1,26.1 can:1,efficiently extended:1,drawing large:1,text For:1,of 8-pixel-wide:1,8-pixel-wide bit-mapped:1,text 40:1,characters long:1,long We:1,left portion:1,each bit-aligned:1,bit-aligned character:1,the portion:1,byte boundary:1,left portions:1,portions only:1,right portion:1,right portions:1,VGA’s fast:1,fast rotator:1,rotator would:1,all rotation:1,only OUT:1,be those:1,those required:1,rotation This:1,technique could:1,well outperform:1,outperform single-character:1,single-character bit-mapped:1,text drivers:1,drivers such:1,26.1 by:1,significant margin:1,margin Listing:1,26.2 illustrates:1,one implementation:1,approach Incidentally:1,Incidentally note:1,8x14 ROM:1,26.2 rather:1,8x8 ROM:1,font used:1,26.1 There:1,an 8x16:1,8x16 font:1,in ROM:1,ROM along:1,the tables:1,tables used:1,8x14 and:1,and 8x16:1,8x16 ROM:1,ROM fonts:1,fonts into:1,into 9x14:1,9x14 and:1,and 9x16:1,9x16 fonts:1,fonts In:1,I’ve tried:1,for rather:1,than providing:1,providing polished:1,polished optimized:1,optimized plug-it-in-and-go:1,plug-it-in-and-go code:1,code Like:1,path write:1,a resource:1,to lock:1,lock you:1,as useful:1,one context:1,context Instead:1,Instead you:1,to thoroughly:1,then when:1,do VGA:1,programming think:1,hand Because:1,Because I:1,I focused:1,on illustrating:1,3 neither:1,neither listing:1,listing in:1,result For:1,26.2 could:1,made nearly:1,fast by:1,simply having:1,rotate mask:1,and join:1,join the:1,from adjacent:1,characters then:1,combined bytes:1,operation Similarly:1,Similarly Listing:1,illustrate write:1,25.1 in:1,25 rather:1,made considerably:1,efficient If:1,going for:1,performance we’d:1,CPU not:1,position but:1,also do:1,the masking:1,masking by:1,by ANDing:1,ANDing in:1,software Even:1,significantly we:1,CPU combine:1,combine adjacent:1,into complete:1,complete rotated:1,rotated bytes:1,bytes whenever:1,one drawing:1,operation would:1,memory modified:1,modified By:1,By doing:1,all per-character:1,per-character OUT:1,would minimize:1,accesses approximately:1,approximately doubling:1,doubling text-drawing:1,text-drawing speed:1,note consider:1,that non-transparent:1,non-transparent text:1,text could:1,accelerated with:1,latches could:1,background text:1,text box:1,box color:1,color set/reset:1,foreground text:1,text color:1,turn monochrome:1,monochrome text:1,text bytes:1,CPU into:1,into characters:1,write per:1,byte There:1,are complications:1,drawing partial:1,partial bytes:1,and rotating:1,to align:1,align the:1,characters which:1,we’ll revisit:1,revisit later:1,55 while:1,library Nonetheless:1,performance benefit:1,four times—all:1,times—all thanks:1,quirky but:1,flexible write:1,3 A:1,on Preserving:1,Preserving Register:1,Register Bits:1,Bits If:1,look you’ll:1,the readable:1,readable register:1,register feature:1,preserve reserved:1,bits other:1,those being:1,modified Older:1,Older adapters:1,adapters such:1,EGA had:1,had few:1,few readable:1,register whenever:1,whenever that:1,modified Happily:1,Happily all:1,readable which:1,of immediate:1,immediate interest:1,general I:1,I highly:1,highly recommend:1,recommend doing:1,doing exactly:1,since IBM:1,IBM or:1,or clone:1,manufacturers may:1,well someday:1,someday use:1,those reserved:1,or change:1,the meanings:1,meanings of:1,use Chapter:1,27 Yet:1,Yet Another:1,Another VGA:1,Mode Write:1,2 Chunky:1,Chunky Bitmapsand:1,Bitmapsand Text-Graphics:1,Text-Graphics Coexistence:1,Coexistence In:1,the markedly:1,markedly peculiar:1,peculiar write:1,after having:1,having spent:1,spent three:1,learning the:1,0 touching:1,23 In:1,supports four:1,write modes—write:1,modes—write modes:1,and 3—and:1,3—and read:1,well Which:1,leaves two:1,two burning:1,burning questions:1,questions What:1,heck do:1,memory Write:1,unusual but:1,really hard:1,understand particularly:1,you followed:1,the description:1,25 Reading:1,be stranger:1,stranger than:1,ever imagine:1,imagine Let’s:1,easy stuff:1,stuff write:1,chapter Write:1,Set/Reset Remember:1,how set/reset:1,set/reset works:1,works Good:1,Good because:1,much how:1,2 works:1,works You:1,remember Well:1,Well I’ll:1,brief refresher:1,refresher but:1,you go:1,back through:1,through Chapters:1,VGA Recall:1,planes affects:1,By replacing:1,replacing it:1,transformation for:1,bits The:1,The enable:1,selects whether:1,replaced or:1,replaced if:1,the enable:1,independently force:1,force any:1,any none:1,all ones:1,ones or:1,all zeros:1,zeros on:1,writes As:1,25 this:1,appear no:1,being overwritten:1,overwritten are:1,are Set/reset:1,Set/reset also:1,also allows:1,circuitry controls:1,planes Write:1,a set/reset-type:1,set/reset-type mode:1,with enable:1,set/reset always:1,coming directly:1,CPU Put:1,CPU are:1,thereby becoming:1,value Put:1,Put yet:1,way bit:1,ALU if:1,0 byte:1,ALU while:1,a 0FFH:1,input likewise:1,likewise bit:1,2 thoroughly:1,thoroughly at:1,point nonetheless:1,nonetheless I:1,additional explanation:1,an admittedly:1,admittedly non-obvious:1,non-obvious mode:1,mode wouldn’t:1,hurt Let’s:1,Let’s follow:1,2 step:1,step by:1,by step:1,step A:1,A Byte’s:1,Byte’s Progress:1,Progress in:1,in Write:1,27.1 shows:1,byte comes:1,separate bits:1,plane Bits:1,Bits 7-4:1,7-4 of:1,byte vanish:1,vanish into:1,bit bucket:1,bucket never:1,heard from:1,from again:1,again Speculation:1,Speculation long:1,long held:1,held that:1,4 unused:1,unused bits:1,bits indicated:1,indicated that:1,IBM would:1,would someday:1,someday come:1,an 8-plane:1,8-plane adapter:1,supported 256:1,colors When:1,When IBM:1,IBM did:1,did finally:1,finally come:1,VGA it:1,be planar:1,planar at:1,upper nibble:1,byte remains:1,remains unused:1,unused in:1,byte sent:1,byte depending:1,respective plane’s:1,ALU From:1,From this:1,path is:1,0 data:1,path As:1,earlier articles:1,articles the:1,other ALU:1,ALU input:1,ALU either:1,either ANDs:1,ANDs ORs:1,ORs or:1,or XORs:1,XORs the:1,simply passes:1,passes the:1,CPU-side byte:1,through The:1,byte generated:1,ALU then:1,then goes:1,ALU byte:1,byte Finally:1,plane if:1,2 It’s:1,noting two:1,two differences:1,between write:1,standard write:1,VGA First:1,First rotation:1,rotation of:1,byte does:1,2 Second:1,and Enable:1,2 Now:1,2 we:1,can step:1,for View:1,View bits:1,colors Next:1,Next imagine:1,that nibble:1,nibble turned:1,turned sideways:1,sideways and:1,planes one:1,plane Finally:1,Finally expand:1,expand each:1,Figure 27.2:1,27.2 so:1,that 8:1,color selected:1,byte Within:1,Within the:1,paths that’s:1,2 does:1,does By:1,paths I:1,mean the:1,ALUs the:1,mask As:1,As Figure:1,27.1 indicates:1,indicates the:1,ALUs can:1,color written:1,to Actually:1,mask simply:1,simply substitutes:1,substitutes latch:1,latch bits:1,for ALU:1,ALU bits:1,are normally:1,normally loaded:1,destination display:1,usually to:1,byte These:1,really constraints:1,constraints at:1,rather features:1,I simply:1,simply want:1,set 8:1,rather simple:1,simple special:1,case among:1,which write:1,2 can:1,feed data:1,path Write:1,0 respectively:1,respectively Since:1,Since VGA:1,readable the:1,select write:1,2 on:1,off bits:1,0 OR:1,OR in:1,in 00000010b:1,00000010b 02H:1,02H and:1,register thereby:1,thereby leaving:1,register undisturbed:1,undisturbed Copying:1,Copying Chunky:1,Chunky Bitmaps:1,Bitmaps to:1,Memory Using:1,2 Let’s:1,two examples:1,27.1 presents:1,in chunky:1,In chunky:1,format adjacent:1,adjacent bits:1,byte make:1,pixel mode:1,mode 4:1,a 2-bit-per-pixel:1,2-bit-per-pixel chunky:1,an 8-bit-per-pixel:1,8-bit-per-pixel chunky:1,mode Chunky:1,Chunky format:1,convenient since:1,byte consequently:1,consequently chunky:1,store bitmaps:1,memory Unfortunately:1,Unfortunately VGA:1,planar rather:1,than chunky:1,0DH through:1,through 12H:1,pixel spread:1,across four:1,from chunky:1,chunky to:1,to planar:1,nuisance requiring:1,bit manipulation:1,2 however:1,conversion becomes:1,a snap:1,snap as:1,27.1 Once:1,byte a:1,single 4-bit:1,4-bit chunky:1,pixel become:1,become eight:1,eight planar:1,planar pixels:1,color As:1,mask makes:1,to narrow:1,narrow the:1,write down:1,pixel Given:1,above conversion:1,a chunky:1,chunky 4-bit-per-pixel:1,4-bit-per-pixel bitmap:1,is trivial:1,trivial First:1,memory bits:1,bits corresponding:1,two stored:1,first chunky:1,bitmap byte:1,modified Next:1,Next the:1,latches Then:1,byte containing:1,containing two:1,two chunky:1,chunky pixels:1,rotated four:1,in position:1,position This:1,This rotated:1,byte since:1,since write:1,active each:1,pixel goes:1,modified a:1,then repeated:1,repeated for:1,rightmost chunky:1,pixel if:1,and repeated:1,repeated again:1,image That’s:1,interesting application:1,2 you:1,well say:1,say but:1,really useful:1,useful While:1,convert chunky:1,chunky bitmaps:1,bitmaps into:1,VGA bitmaps:1,bitmaps does:1,its uses:1,uses Listing:1,27.1 is:1,is primarily:1,primarily intended:1,2 For:1,For performance:1,store 16-color:1,16-color bitmaps:1,in pre-separated:1,pre-separated four-plane:1,four-plane format:1,copy one:1,screen Ideally:1,Ideally such:1,such bitmaps:1,bitmaps should:1,planes completed:1,completed for:1,next I:1,when entire:1,entire images:1,time nasty:1,nasty transient:1,transient color:1,occur as:1,plane becomes:1,becomes visibly:1,visibly changed:1,changed before:1,before other:1,planes have:1,modified Drawing:1,Drawing Color-Patterned:1,Color-Patterned Lines:1,more serviceable:1,serviceable use:1,27.2 The:1,program draws:1,draws multicolored:1,multicolored horizontal:1,lines basing:1,basing the:1,color patterns:1,on passed:1,color tables:1,tables Write:1,ideal because:1,application color:1,2 all:1,CPU Set/reset:1,Set/reset could:1,achieve the:1,s would:1,color Similarly:1,color but:1,case not:1,would an:1,s be:1,required but:1,data already:1,memory wouldn’t:1,wouldn’t interfere:1,drawn since:1,register allows:1,27.2 is:1,hardly a:1,a comprehensive:1,comprehensive line:1,drawing program:1,program It:1,It draws:1,special line:1,line cases:1,handle those:1,cases because:1,a dot-plot:1,dot-plot routine:1,draws horizontal:1,pixel rather:1,time Write:1,would however:1,however serve:1,serve just:1,full-blown line:1,drawing routine:1,routine For:1,For any:1,any type:1,of patterned:1,patterned line:1,basic approach:1,approach remains:1,same Use:1,draw When:1,Use Write:1,and When:1,Use Set/Reset:1,Set/Reset As:1,As indicated:1,indicated earlier:1,earlier write:1,set/reset are:1,interchangeable Write:1,2 lends:1,efficient implementations:1,implementations when:1,color changes:1,changes frequently:1,27.2 Set/reset:1,Set/reset tends:1,be superior:1,superior when:1,succession are:1,color since:1,set/reset enabled:1,color data:1,whatever byte:1,it wishes:1,wishes For:1,an OR:1,planes thus:1,thus both:1,both loading:1,instruction secure:1,it writes:1,writes is:1,color Set/reset:1,Set/reset is:1,choice whenever:1,fixed value:1,value while:1,while allowing:1,modify other:1,operation when:1,planes Mode:1,Mode 13H—320x200:1,13H—320x200 with:1,256 Colors:1,Colors I’m:1,a minute—and:1,minute—and I:1,mean a:1,a minute—to:1,minute—to discuss:1,mode Frankly:1,Frankly there’s:1,it especially:1,especially compared:1,the convoluted:1,convoluted 16-color:1,we’ve explored:1,last five:1,chapters Mode:1,13H offers:1,offers the:1,simplest programming:1,graphics A:1,A linear:1,A0000000 consisting:1,bytes each:1,each controlling:1,0 controls:1,left pixel:1,offset 319:1,319 controls:1,upper right:1,offset 320:1,320 controls:1,pixel down:1,down at:1,offset 63999:1,63999 controls:1,lower right:1,it it’s:1,spend any:1,program especially:1,listings later:1,book such:1,the antialiasing:1,antialiasing code:1,Chapter F:1,F on:1,CD-ROM use:1,use mode:1,13H Flipping:1,Flipping Pages:1,Pages from:1,from Text:1,Text to:1,to Graphics:1,and Back:1,Back A:1,interesting letter:1,from Phil:1,Coleman of:1,of La:1,La Jolla:1,Jolla who:1,wrote Suppose:1,640x350 16-color:1,preserve some:1,I temporarily:1,temporarily switch:1,give my:1,my user:1,user a:1,a Help:1,Help screen:1,screen Naturally:1,Naturally memory:1,is scarce:1,scarce so:1,I’d rather:1,rather not:1,video buffer:1,A000H to:1,digress to:1,the Help:1,Help text:1,BIOS says:1,be cleared:1,cleared on:1,set if:1,set Yet:1,Yet if:1,try that:1,writing text:1,text into:1,the B800H:1,B800H buffer:1,buffer trashes:1,trashes much:1,4K bytes:1,page when:1,10H ghosts:1,ghosts appear:1,of colored:1,colored dots:1,dots When:1,When in:1,4K buffer:1,at B800H:1,B800H before:1,before showing:1,showing the:1,help and:1,I restore:1,4K before:1,before switching:1,switching back:1,10H Is:1,Is there:1,mode A:1,is Where:1,the 64/128/256K:1,64/128/256K of:1,EGA memory:1,memory hide:1,hide when:1,mode Some:1,Some I:1,store character:1,character sets:1,rather how:1,I protect:1,protect it:1,it Those:1,good questions:1,questions Alas:1,Alas answering:1,answering them:1,full would:1,require extensive:1,extensive explanation:1,have little:1,little general:1,general application:1,application so:1,that However:1,image certainly:1,certainly rates:1,rates a:1,short discussion:1,discussion complete:1,some working:1,discussion and:1,code apply:1,apply just:1,EGA with:1,few differences:1,differences in:1,VGA’s highmode:1,highmode as:1,below Phil:1,Phil is:1,his observation:1,AL instructs:1,instructs the:1,BIOS not:1,also correct:1,in surmising:1,surmising that:1,bitmap occupies:1,occupies the:1,first 28000:1,bitmap takes:1,first 38400:1,character/attribute memory:1,map resides:1,and green:1,green planes:1,10H The:1,standard font:1,red plane:1,10H Neither:1,Neither mode:1,3 nor:1,nor any:1,other text:1,mode makes:1,makes use:1,10H if:1,necessary plane:1,as scratch:1,scratch memory:1,mode Consequently:1,under 16K:1,16K bytes—the:1,bytes—the first:1,8K bytes:1,plane 2—when:1,2—when going:1,or mode:1,restored on:1,on returning:1,That’s hardly:1,hardly all:1,from text:1,without bitmap:1,bitmap corruption:1,corruption though:1,to A0008000:1,A0008000 simply:1,address programmed:1,at CRT:1,0DH to:1,8000H You:1,then access:1,at A8008000:1,A8008000 instead:1,normal A0000000:1,display exactly:1,exactly like:1,of normal:1,10H There:1,are BIOS:1,BIOS issues:1,issues since:1,BIOS doesn’t:1,doesn’t automatically:1,automatically access:1,its drawing:1,BIOS that’s:1,bitmap can’t:1,at A0008000:1,A0008000 because:1,long that:1,say A0006000:1,A0006000 where:1,would fit:1,fit without:1,without conflicting:1,conflicting with:1,font or:1,mode memory:1,map although:1,would overlap:1,overlap two:1,upper pages:1,pages available:1,use but:1,but rarely:1,by text-mode:1,text-mode programs:1,programs At:1,rate once:1,mode bitmap:1,is relocated:1,relocated flipping:1,back becomes:1,becomes painless:1,painless The:1,3 doesn’t:1,doesn’t overlap:1,the relocated:1,relocated mode:1,unless additional:1,additional portions:1,font memory:1,loaded so:1,AL on:1,modes Another:1,Another interesting:1,about flipping:1,flipping from:1,graphics to:1,map doesn’t:1,map actually:1,only takes:1,every even:1,even byte:1,4000 in:1,left untouched:1,untouched This:1,about 12K:1,saved when:1,27.3 flips:1,flips from:1,back saving:1,saving only:1,those 12K:1,saved This:1,code saves:1,saves and:1,and restores:1,font area:1,area while:1,but performs:1,restore of:1,the 4000:1,the character/attribute:1,map while:1,mode because:1,actually stored:1,even bytes:1,respectively appear:1,are easily:1,easily saved:1,saved as:1,block Explaining:1,Explaining why:1,why only:1,other byte:1,why characters:1,attributes appear:1,bytes when:1,actually in:1,explanation I’m:1,into now:1,now One:1,One bit:1,of fallout:1,fallout from:1,flip to:1,and preserve:1,graphics bitmap:1,bitmap using:1,the mechanism:1,mechanism illustrated:1,27.3 you:1,shouldn’t write:1,page other:1,don’t write:1,any offset:1,memory above:1,above 3999:1,3999 in:1,or alter:1,Page Select:1,Select bit:1,3C2H while:1,allow completely:1,completely unfettered:1,unfettered access:1,text pages:1,pages it:1,save every:1,hand this:1,allow up:1,16 text:1,text screens:1,screens to:1,stored simultaneously:1,simultaneously with:1,one displayable:1,displayable instantly:1,instantly Moreover:1,Moreover if:1,any fonts:1,fonts other:1,2 that:1,particular fonts:1,into would:1,saved up:1,all 64K:1,2 In:1,full 128K:1,128K would:1,potentially used:1,by text:1,said Phil:1,Phil Coleman’s:1,Coleman’s question:1,interesting one:1,only touched:1,the intriguing:1,intriguing possibilities:1,possibilities arising:1,arising from:1,various configurations:1,configurations of:1,modes Right:1,though we’ve:1,we’ve still:1,still got:1,the remarkably:1,remarkably complex:1,but rewarding:1,rewarding VGA:1,cover Chapter:1,28 Reading:1,Memory Read:1,Read Modes:1,Modes 0:1,Care Register:1,Register Well:1,it’s taken:1,taken five:1,chapters but:1,we’ve finally:1,finally covered:1,data write:1,path and:1,VGA Now:1,VGA’s two:1,two read:1,modes While:1,modes aren’t:1,aren’t as:1,modes they’re:1,they’re nothing:1,to sneeze:1,sneeze at:1,at In:1,particular read:1,rather unusual:1,unusual and:1,all intuitive:1,intuitive You:1,ask isn’t:1,isn’t anything:1,VGA straightforward:1,straightforward Well…no:1,Well…no But:1,then clearing:1,clearing up:1,the mysteries:1,mysteries of:1,started Read:1,Mode 0:1,0 Read:1,relatively uncomplicated:1,uncomplicated given:1,strongly urge:1,urge you:1,Chapters 23-27:1,23-27 before:1,continuing with:1,chapter Read:1,mode counterpart:1,counterpart of:1,0 lets:1,time Read:1,0 When:1,When read:1,that supplies:1,supplies the:1,data when:1,4 When:1,0 CPU:1,contains blue:1,blue pixel:1,1 CPU:1,2 CPU:1,3 CPU:1,3 That:1,That all:1,all seems:1,seems simple:1,enough in:1,register acts:1,acts as:1,a selector:1,selector among:1,planes determining:1,will supply:1,value returned:1,slight complication:1,complication however:1,plane Why:1,that Well:1,Well in:1,0 one:1,select reads:1,contrast in:1,any write:1,mode any:1,planes may:1,can fan:1,fan out:1,planes Consequently:1,not four:1,four but:1,but sixteen:1,sixteen possible:1,is 8:1,8 As:1,for accessing:1,plane don’t:1,match The:1,28.1 illustrates:1,28.1 simply:1,simply copies:1,a sixteen-color:1,sixteen-color image:1,then animates:1,animates by:1,repeatedly copying:1,image back:1,memory again:1,again one:1,time clearing:1,differing settings:1,registers By:1,28.1 is:1,intended only:1,illustrate read:1,poor way:1,animation since:1,and tends:1,flicker Later:1,book we’ll:1,some far:1,better VGA:1,techniques As:1,expect neither:1,mode nor:1,register affects:1,affects CPU:1,way An:1,point regarding:1,regarding reading:1,reading VGA:1,memory involves:1,latches stores:1,stores a:1,memory allowing:1,allowing fast:1,fast copying:1,and efficient:1,efficient pixel:1,pixel masking:1,masking Whenever:1,reads a:1,plane Even:1,CPU only:1,only receives:1,receives data:1,values read:1,read are:1,latches This:1,short whenever:1,any read:1,always loaded:1,loaded Read:1,Mode 1:1,1 Read:1,the workhorse:1,workhorse read:1,it’s got:1,an annoying:1,annoying limitation:1,limitation Whenever:1,0 you:1,perform four:1,reads one:1,then interpret:1,interpret the:1,bytes you’ve:1,as eight:1,eight 16-color:1,16-color pixels:1,pixels That’s:1,slowly all:1,standard IBM:1,VGA takes:1,of 1.1:1,0 requires:1,four reads:1,planes not:1,mention the:1,even greater:1,greater amount:1,planes 1.1:1,microseconds may:1,much but:1,a 66-MHz:1,66-MHz 486:1,486 it’s:1,it’s 73:1,73 clock:1,cycles Local-bus:1,Local-bus VGAs:1,VGAs can:1,deal faster:1,fastest local-bus:1,local-bus adapter:1,adapter I’ve:1,seen would:1,still cost:1,10 486/66:1,486/66 cycles:1,cycles Read:1,determining whether:1,color With:1,single read:1,can determine:1,even specify:1,specify any:1,as don’t:1,comparison Read:1,simplest form:1,form read:1,1 compares:1,compares the:1,the cross-plane:1,cross-plane value:1,returns a:1,position of:1,match That’s:1,That’s certainly:1,certainly interesting:1,what’s read:1,1 good:1,for One:1,obvious application:1,in implementing:1,implementing flood-fill:1,flood-fill algorithms:1,since read:1,1 makes:1,a boundary:1,boundary color:1,color Another:1,Another application:1,in detecting:1,detecting on-screen:1,on-screen object:1,object collisions:1,collisions as:1,28.2 When:1,When all:1,all Planes:1,Planes Don’t:1,Care Still:1,Still and:1,aren’t all:1,for basic:1,basic color:1,compare operations:1,operations There:1,a genuinely:1,genuinely odd:1,odd application:1,of read:1,1 that’s:1,that’s worth:1,knowing about:1,about but:1,first look:1,the don’t:1,care aspect:1,compare operation:1,operation As:1,earlier during:1,during read:1,memory But—and:1,But—and it’s:1,big but—any:1,but—any plane:1,compare match:1,match regardless:1,plane’s bits:1,register Let’s:1,A given:1,plane Normally:1,Normally when:1,is 0FH:1,0FH the:1,0 bit:1,pixel must:1,must match:1,return a:1,CPU However:1,any bit:1,is unconditionally:1,unconditionally considered:1,register You:1,selecting exactly:1,planes should:1,should matter:1,given read:1,read At:1,extreme if:1,reads will:1,0FFH since:1,match all:1,pixels Now:1,we’re all:1,all prone:1,using tools:1,right way—that:1,way—that is:1,were intended:1,used By:1,that token:1,token the:1,clearly intended:1,mask one:1,more planes:1,planes out:1,such has:1,limited use:1,use However:1,register becomes:1,becomes far:1,interesting in:1,extreme case:1,case described:1,above where:1,planes become:1,become don’t:1,planes Why:1,Well as:1,said when:1,are don’t:1,planes read:1,reads always:1,0FFH Now:1,Now when:1,you AND:1,AND any:1,value remains:1,unchanged and:1,be awfully:1,awfully handy:1,handy when:1,modify selected:1,selected pixels:1,memory Recall:1,mask Traditionally:1,Traditionally two:1,separate instructions—a:1,instructions—a read:1,read followed:1,a write—are:1,write—are used:1,this task:1,28.2 uses:1,uses this:1,approach Suppose:1,0 meaning:1,meaning all:1,all reads:1,0FFH Under:1,Under these:1,these circumstances:1,both read:1,since ANDing:1,ANDing any:1,0FFH leaves:1,value unchanged:1,illustrates an:1,with read:1,a Color:1,The mask:1,mask in:1,passed directly:1,VGA’s bit:1,3 works—see:1,works—see Chapter:1,4 for:1,details Because:1,always returns:1,returns 0FFH:1,instruction loads:1,AL unmodified:1,VGA where:1,mask This:1,and register-efficient:1,register-efficient than:1,using separate:1,write although:1,count because:1,Pentium MOV:1,1-cycle instruction:1,but AND:1,AND with:1,3-cycle instruction:1,However given:1,states it:1,approaches run:1,approach frees:1,frees up:1,up can:1,can frequently:1,frequently be:1,case By:1,excellent pixel:1,and line-drawing:1,hope I’ve:1,given you:1,good feel:1,Color compare:1,mode isn’t:1,particularly easy:1,that complicated:1,complicated in:1,actual operation:1,certainly useful:1,times take:1,to study:1,study the:1,few experiments:1,experiments of:1,code A:1,note The:1,The Read:1,Compare and:1,and Color:1,Care registers:1,effect either:1,either in:1,memory And:1,by gosh:1,gosh we’re:1,accessing VGA:1,to worry—that:1,worry—that still:1,still leaves:1,interesting VGA:1,VGA topics:1,topics including:1,including smooth:1,panning and:1,and scrolling:1,scrolling the:1,screen color:1,selection page:1,X And:1,mention actual:1,actual uses:1,put including:1,including lines:1,circles polygons:1,favorite animation:1,of challenging:1,rewarding ground—and:1,ground—and we’ve:1,only just:1,just begun:1,begun Chapter:1,29 Saving:1,Saving Screens:1,Screens and:1,Other VGA:1,VGA Mysteries:1,Mysteries Useful:1,Useful Nuggets:1,Nuggets from:1,VGA Zen:1,Zen File:1,File There:1,graphics topics:1,topics that:1,aren’t quite:1,quite involved:1,involved enough:1,to warrant:1,warrant their:1,own chapters:1,chapters yet:1,yet still:1,still cause:1,of programmer:1,programmer headscratching—and:1,headscratching—and thus:1,thus deserve:1,deserve treatment:1,treatment somewhere:1,book This:1,and during:1,on saving:1,restoring 16-color:1,16-color EGA:1,VGA screens:1,screens the:1,the 16-out-of-64:1,16-out-of-64 colors:1,colors issue:1,issue and:1,techniques involved:1,writing VGA:1,VGA control:1,registers That’s:1,cover so:1,started Saving:1,Saving and:1,and Restoring:1,Restoring EGA:1,VGA Screens:1,Screens The:1,architectures of:1,similar enough:1,treat both:1,both together:1,saving EGA:1,VGA 16-color:1,screens is:1,is astonishingly:1,astonishingly simple:1,simple Write:1,disk separately:1,separately Let’s:1,provides 16:1,at 640x350:1,640x350 All:1,is enable:1,the 28000:1,disk then:1,then enable:1,file that’s:1,that’s 112000:1,112000 28000:1,28000 4:1,planes stored:1,four distinct:1,distinct 28000-byte:1,28000-byte blocks:1,29.1 The:1,shown later:1,29.1 does:1,here putting:1,into mode:1,10H putting:1,some bittext:1,bittext so:1,the 112K:1,112K file:1,file SNAPSHOT.SCR:1,SNAPSHOT.SCR which:1,visible portion:1,buffer Figure:1,29.1 that’s:1,that’s even:1,even remotely:1,remotely tricky:1,make each:1,memory readable:1,readable in:1,turn The:1,write 28000:1,disk four:1,and 28000:1,A0000000 are:1,disk each:1,time thanks:1,changing setting:1,is unclear:1,unclear refer:1,29.1 you:1,to reread:1,reread Chapter:1,28 to:1,to brush:1,brush up:1,reading EGA:1,general Of:1,course we’ll:1,restore what:1,we’ve saved:1,saved and:1,29.2 reverses:1,action of:1,29.1 selecting:1,selecting mode:1,loading 28000:1,from SNAPSHOT.SCR:1,SNAPSHOT.SCR into:1,text change:1,change as:1,29.2 runs:1,runs Note:1,not itself:1,itself draw:1,rather simply:1,simply loads:1,map saved:1,29.1 back:1,buffer If:1,compare Listings:1,29.2 you:1,plane does:1,while only:1,time anywhere:1,once consequently:1,consequently Read:1,plane selections:1,selections from:1,3 while:1,while Map:1,plane masks:1,masks from:1,15 where:1,0 setting:1,1 setting:1,on Again:1,Again Chapter:1,28 provides:1,detailed explanation:1,registers Screen:1,Screen saving:1,restoring is:1,simple eh:1,eh There:1,few caveats:1,caveats of:1,but nothing:1,nothing serious:1,serious First:1,adapter’s registers:1,programmed properly:1,for screen:1,restoring to:1,work For:1,saving you:1,no telling:1,telling what:1,what bit:1,pattern you’ll:1,save but:1,desired screen:1,image For:1,screen restoring:1,restoring you:1,0 with:1,0 no:1,no data:1,function set:1,unchanged While:1,While these:1,you’re simply:1,simply calling:1,save an:1,program they:1,they pose:1,considerable problem:1,you’re designing:1,a hot-key:1,hot-key operated:1,operated TSR:1,can capture:1,capture a:1,EGA specifically:1,specifically there’s:1,tell what:1,what state:1,in since:1,readable More:1,this issue:1,issue later:1,chapter As:1,result any:1,any TSR:1,on runs:1,of interfering:1,program that’s:1,already running:1,running What’s:1,solution Frankly:1,Frankly the:1,get VGA-specific:1,VGA-specific A:1,A TSR:1,TSR designed:1,interest program:1,program those:1,needed save:1,original settings:1,settings From:1,perspective readable:1,certainly near:1,to like:1,like about:1,remaining installed:1,installed base:1,base of:1,EGAs is:1,is steadily:1,steadily dwindling:1,dwindling and:1,a market:1,market today:1,today as:1,couldn’t even:1,two ago:1,ago If:1,are going:1,a hi-res:1,hi-res VGA:1,capture program:1,program be:1,the increased:1,increased size:1,12H bit:1,map The:1,screen uses:1,uses 37.5K:1,size equate:1,equate in:1,29.2 should:1,to DISPLAYED_SCREEN_SIZEequ(640/8:1,DISPLAYED_SCREEN_SIZEequ(640/8 480:1,480 Similarly:1,you’re capturing:1,capturing a:1,graphics screen:1,offset other:1,A000H you:1,offset used:1,disk functions:1,match You:1,desire read:1,memory providing:1,providing the:1,information shown:1,registers CRT:1,0DH these:1,readable even:1,EGA Finally:1,capture and:1,restore programs:1,only appropriate:1,for EGA/VGA:1,EGA/VGA modes:1,0FH 010H:1,010H and:1,and 012H:1,012H since:1,assume a:1,a fourconfiguration:1,fourconfiguration of:1,of EGA/VGA:1,EGA/VGA memory:1,in CGA:1,and 13H:1,13H as:1,linear block:1,memory just:1,normal array:1,array While:1,While Listings:1,principles they:1,illustrate apply:1,apply equally:1,languages In:1,fact there’s:1,when saving:1,saving an:1,an EGA/VGA:1,EGA/VGA screen:1,language you’re:1,using can:1,perform direct:1,direct port:1,port I/O:1,I/O to:1,directly One:1,One tip:1,tip if:1,language on:1,EGA though:1,though After:1,After you’ve:1,you’ve completed:1,save or:1,or restore:1,restore operation:1,operation be:1,put any:1,you’ve changed:1,changed back:1,default settings:1,settings Some:1,Some high-level:1,well assume:1,that various:1,various registers:1,certain state:1,state so:1,EGA it’s:1,their most:1,state On:1,course you:1,just read:1,registers out:1,out before:1,change them:1,them then:1,you’re done:1,done 16:1,16 Colors:1,Colors out:1,64 How:1,one produce:1,colors displayed:1,chosen The:1,enough There’s:1,you select:1,possible pixel:1,colors Let’s:1,Let’s lay:1,lay out:1,background before:1,before proceeding:1,proceeding however:1,EGA sends:1,sends pixel:1,monitor on:1,on 6:1,6 pins:1,pins This:1,the 6th:1,6th or:1,generate However:1,However for:1,with premonitors:1,premonitors in:1,in 200-scan-line:1,modes Enhanced:1,Enhanced Color:1,Color Displaymonitors:1,Displaymonitors ignore:1,ignore two:1,the signals:1,signals As:1,in CGA-compatible:1,CGA-compatible modes:1,200-scan-line versions:1,3 you:1,from only:1,colors although:1,be remapped:1,remapped as:1,below If:1,not hooked:1,hooked up:1,monitor capable:1,displaying 350:1,350 scan:1,lines such:1,old IBM:1,IBM Color:1,Color Display:1,Display you:1,never select:1,colors since:1,those monitors:1,monitors only:1,only accept:1,accept four:1,input signals:1,signals For:1,we’ll assume:1,assume we’re:1,the 350-scan:1,350-scan line:1,line color:1,modes a:1,group which:1,includes mode:1,350-scan-line versions:1,3 Each:1,Each pixel:1,mode out:1,the attribute-handling:1,attribute-handling portion:1,EGA as:1,value denoting:1,denoting 1:1,colors In:1,In graphics:1,made up:1,with 8:1,data stored:1,byte address:1,memory Normally:1,Normally we:1,that pixel’s:1,color so:1,black a:1,a built-in:1,built-in feature:1,EGA Actually:1,Actually though:1,the correspondence:1,correspondence of:1,absolutely arbitrary:1,arbitrary depending:1,depending solely:1,solely on:1,the colorportion:1,colorportion of:1,EGA containing:1,programmed If:1,you cared:1,cared to:1,have color:1,0 be:1,be bright:1,bright red:1,1 be:1,be black:1,black that:1,be arranged:1,arranged as:1,could a:1,a mapping:1,colors were:1,were yellow:1,yellow What’s:1,more these:1,these mappings:1,mappings affect:1,affect text-mode:1,text-mode characters:1,characters as:1,as readily:1,readily as:1,do graphics-mode:1,graphics-mode pixels:1,pixels so:1,could map:1,map text:1,white and:1,attribute 15:1,black to:1,black on:1,on white:1,white display:1,display if:1,wished Each:1,registers stores:1,possible 6-bit:1,6-bit pixel:1,monitor as:1,29.2 A:1,A 4-bit:1,1 causes:1,Since there:1,input bits:1,available at:1,are six:1,six output:1,output bits:1,bits however:1,however those:1,those 16:1,The mapping:1,16 pixel:1,values is:1,lower six:1,corresponding palette:1,29.3 Secondary:1,Secondary red:1,are less-intense:1,less-intense versions:1,blue although:1,although their:1,their exact:1,exact effects:1,effects vary:1,from monitor:1,to monitor:1,colors look:1,like on:1,your monitor:1,monitor is:1,see them:1,29.3 which:1,shortly lets:1,registers How:1,one go:1,about setting:1,registers Well:1,addressing them:1,at registers:1,through 0FH:1,0FH of:1,Controller However:1,bit tricky—bit:1,tricky—bit 5:1,0 while:1,and glitches:1,glitches can:1,occur if:1,the updating:1,updating doesn’t:1,place during:1,blanking interval—and:1,interval—and besides:1,besides it:1,hardware on:1,one Conveniently:1,provides us:1,which supports:1,supports setting:1,setting either:1,either any:1,single video:1,interrupt Video:1,Video function:1,is invoked:1,performing an:1,an INT:1,AH set:1,to 10H:1,0 subfunction:1,then BL:1,and BH:1,1 subfunction:1,then BH:1,overscan border:1,to Finally:1,if AL:1,2 subfunction:1,2 then:1,then ESDX:1,ESDX points:1,set palette:1,registers 0-15:1,0-15 and:1,to For:1,For completeness:1,completeness although:1,it’s unrelated:1,registers there:1,more subfunction:1,subfunction of:1,AL 3:1,3 subfunction:1,subfunction 3:1,3 bit:1,select blinking:1,blinking or:1,select highreverse:1,highreverse video:1,video Figure:1,register Listing:1,29.3 uses:1,uses video:1,all 64:1,colors This:1,up 16:1,bars one:1,values then:1,then changing:1,mapping provided:1,different group:1,64 each:1,pressed Initially:1,Initially colors:1,0-15 are:1,displayed then:1,then 1-16:1,1-16 then:1,then 2-17:1,2-17 and:1,color 3FH:1,3FH wrapping:1,wrapping around:1,colors 0-14:1,0-14 and:1,finally back:1,0-15 By:1,way at:1,set time:1,0-15 but:1,to 0H:1,0H 1H:1,1H 2H:1,2H H:1,H 4H:1,4H 5H:1,5H 14H:1,14H 7H:1,7H 38H:1,38H 39H:1,39H 3AH:1,3AH 3BH:1,3BH 3CH:1,3CH 3DH:1,3DH 3EH:1,3EH and:1,and 3FH:1,3FH respectively:1,respectively Bits:1,Bits 6:1,6 5:1,and 4—secondary:1,4—secondary red:1,and blue—are:1,blue—are all:1,registers 8-15:1,8-15 in:1,produce high-intensity:1,high-intensity colors:1,colors Palette:1,Palette register:1,register 6:1,6 is:1,to 14H:1,14H to:1,produce brown:1,brown rather:1,the yellow:1,yellow that:1,expected value:1,of 6H:1,6H would:1,produce When:1,29.3 you’ll:1,screen changes:1,changes color:1,color as:1,selected This:1,This occurs:1,0 selecting:1,we’re reprogramming:1,reprogramming palette:1,0 right:1,right along:1,other 15:1,15 palette:1,registers It’s:1,29.3 the:1,never changed:1,after initialization:1,initialization The:1,only change:1,6-bit data:1,data going:1,monitor For:1,it’s technically:1,technically inaccurate:1,inaccurate to:1,as representing:1,representing colors:1,colors more:1,more accurately:1,accurately they:1,represent attributes:1,attributes in:1,0-15 which:1,colors 0-3FH:1,0-3FH by:1,registers Overscan:1,Overscan While:1,While we’re:1,on overscan:1,overscan Overscan:1,Overscan is:1,rectangular area:1,monitor that’s:1,the region:1,region displaying:1,displaying active:1,active video:1,data but:1,but inside:1,blanking area:1,The overscan:1,overscan or:1,or border:1,setting Attribute:1,register 11H:1,11H directly:1,or calling:1,calling video:1,On ECD-compatible:1,ECD-compatible monitors:1,monitors however:1,there’s too:1,little scan:1,scan time:1,proper border:1,in 350-scan-line:1,350-scan-line mode:1,so overscan:1,overscan should:1,0 black:1,black unless:1,in 200-scanmode:1,200-scanmode Note:1,easily display:1,border on:1,a VGA-compatible:1,VGA-compatible monitor:1,monitor and:1,fact programmed:1,an 8-pixel-wide:1,8-pixel-wide border:1,border in:1,modes all:1,overscan color:1,border A:1,Bonus Blanker:1,Blanker An:1,interesting bonus:1,bonus The:1,The Attribute:1,Controller provides:1,very convenient:1,aforementioned bit:1,3C0H after:1,1 register—3DAH:1,register—3DAH in:1,color 3BAH:1,in monochrome—has:1,monochrome—has been:1,3C0H thereafter:1,thereafter Whenever:1,Whenever bit:1,is cut:1,cut off:1,off effectively:1,effectively blanking:1,screen Setting:1,Index back:1,1 restores:1,restores video:1,data immediately:1,immediately Listing:1,Listing 29.4:1,29.4 illustrates:1,but effective:1,effective form:1,screen blanking:1,blanking Does:1,selection Yes:1,no For:1,EGA we’ve:1,color selection—but:1,selection—but not:1,can emulate:1,emulate everything:1,we’ve discussed:1,discussed but:1,performs one:1,one 4-bit:1,8-bit translation:1,translation except:1,simultaneously available:1,available followed:1,by yet:1,another translation:1,translation this:1,one 8-bit:1,18-bit What’s:1,flip instantly:1,instantly through:1,as 16:1,16 16-color:1,16-color sets:1,sets The:1,selection capabilities:1,capabilities which:1,functions can:1,produce stunning:1,stunning color:1,we cover:1,cover them:1,them starting:1,33 Modifying:1,Modifying VGA:1,VGA Registers:1,Registers EGA:1,readable VGA:1,readable This:1,This revelation:1,revelation will:1,as news:1,programmers still:1,still insist:1,insist on:1,on setting:1,setting entire:1,registers even:1,they’re modifying:1,modifying only:1,EGA This:1,This comes:1,mind because:1,recently received:1,a query:1,query inquiring:1,inquiring why:1,why write:1,copied directly:1,memory didn’t:1,X I’ll:1,detail later:1,book Actually:1,Actually write:1,1 does:1,X it:1,work when:1,particular correspondent:1,correspondent enabled:1,enabled it:1,did so:1,so by:1,value 01H:1,01H to:1,mode field:1,field is:1,several fields:1,fields in:1,29.4 In:1,modes one:1,other fields—bit:1,fields—bit 6:1,6 which:1,which enables:1,enables 256-color:1,pixel formatting—is:1,formatting—is not:1,not 0:1,0 messes:1,messes up:1,screen quite:1,thoroughly The:1,The correct:1,field within:1,VGA register:1,field insert:1,desired setting:1,this This:1,nuisance than:1,simply setting:1,whole register:1,it’s safer:1,safer It’s:1,also slower:1,field repeatedly:1,repeatedly it:1,be repeatedly:1,repeatedly read:1,port This:1,especially attractive:1,attractive because:1,because IN:1,IN s:1,than memory:1,accesses on:1,486 machines:1,machines Astute:1,Astute readers:1,readers may:1,didn’t put:1,delay sequence:1,as JMP:1,2 between:1,the IN:1,IN and:1,OUT involving:1,register There:1,all guidelines:1,guidelines from:1,from IBM:1,IBM specifying:1,specifying that:1,certain period:1,period should:1,to elapse:1,elapse before:1,second access:1,an I/O:1,I/O port:1,port is:1,is attempted:1,attempted because:1,all devices:1,devices can:1,can respond:1,respond as:1,or faster:1,faster CPU:1,a port:1,port My:1,My answer:1,delay isn’t:1,needed I’ve:1,never found:1,that required:1,required one:1,delay specification:1,specification has:1,with motherboard:1,like and:1,sure hate:1,delay time:1,necessary However:1,However I’ve:1,find anyone:1,the definitive:1,definitive word:1,whether delays:1,delays might:1,might ever:1,truth or:1,a VGA/processor:1,VGA/processor combo:1,combo that:1,does require:1,require delays:1,delays please:1,know by:1,by contacting:1,contacting me:1,publisher You’d:1,You’d be:1,a favor:1,favor for:1,whole generation:1,graphics programmers:1,who aren’t:1,aren’t sure:1,they’re skating:1,skating on:1,on thin:1,thin ice:1,ice without:1,without those:1,those legendary:1,legendary delays:1,fields Figure:1,fields Chapter:1,30 Video:1,Video Est:1,Est Omnis:1,Omnis Divisa:1,Divisa The:1,The Joys:1,Joys and:1,and Galling:1,Galling Problems:1,Problems of:1,of Using:1,Using Split:1,Screens on:1,two largely:1,largely independent:1,independent portions:1,portions one—displayed:1,one—displayed above:1,other on:1,the screen—is:1,screen—is one:1,more intriguing:1,intriguing capabilities:1,screen feature:1,feature can:1,for popups:1,popups including:1,including popups:1,popups that:1,that slide:1,slide smoothly:1,smoothly onto:1,simply to:1,separate portions:1,single screen:1,screen While:1,effects purely:1,software without:1,screen software:1,software solutions:1,and hard:1,implement By:1,simple once:1,you grasp:1,various coding:1,coding tricks:1,tricks required:1,pull it:1,and pitfalls—like:1,pitfalls—like the:1,screen implementation:1,buggy Furthermore:1,Furthermore panning:1,screen enabled:1,enabled is:1,seem All:1,some ground:1,cover Let’s:1,screen How:1,Screen Works:1,Works The:1,A split:1,programmed into:1,two EGA:1,three VGA:1,on exactly:1,moment At:1,circuitry begins:1,scan display:1,data starting:1,address specified:1,would When:1,circuitry encounters:1,scanning video:1,data onto:1,it completes:1,completes that:1,line normally:1,normally then:1,then resets:1,which addresses:1,read for:1,zero Display:1,memory from:1,from address:1,address zero:1,zero onward:1,onward is:1,then scanned:1,usual way:1,way progressing:1,memory At:1,scan is:1,is reloaded:1,reloaded from:1,process starts:1,starts over:1,over The:1,zero are:1,displayed starting:1,line following:1,30.1 It’s:1,following scan:1,line So:1,at scan:1,line 1:1,screen If:1,line There:1,screen cover:1,entire screen—it:1,screen—it always:1,always comes:1,line short:1,short Figure:1,So where:1,where is:1,line stored:1,varies a:1,bit depending:1,you’re talking:1,a 9-bit:1,9-bit value:1,bits 7-0:1,7-0 stored:1,the Line:1,Line Compare:1,register 18H:1,18H and:1,8 stored:1,bit 4:1,register 7:1,7 Other:1,Other bits:1,register serve:1,high bits:1,other values:1,values such:1,vertical total:1,blanking start:1,start Since:1,Since EGA:1,registers are—alas:1,are—alas not:1,readable you:1,correct settings:1,Overflow registers:1,EGA Fortunately:1,Fortunately there:1,two standard:1,standard Overflow:1,settings on:1,EGA 11H:1,for 200-scan-line:1,and 1FH:1,1FH for:1,for 350-scan-line:1,course presents:1,presents no:1,has readable:1,registers However:1,a 10-bit:1,10-bit split:1,bits 8-0:1,8-0 stored:1,stored just:1,9 stored:1,the Maximum:1,register 9:1,9 Turning:1,Turning the:1,start appearing:1,appearing Of:1,course you’ll:1,probably want:1,address before:1,screen otherwise:1,otherwise you’ll:1,you’ll just:1,up displaying:1,zero twice:1,screen Turning:1,Turning off:1,value equal:1,or greater:1,line displayed:1,the safest:1,safest such:1,1 That:1,value programmed:1,BIOS during:1,Screen in:1,Action All:1,these points:1,30.1 Listing:1,30.1 fills:1,text identifying:1,identifying the:1,8000H with:1,graphics pattern:1,8000H At:1,still set:1,BIOS default:1,setting with:1,off with:1,pixels based:1,8000H The:1,between offset:1,and offset:1,offset 7FFFH:1,7FFFH are:1,not visible:1,30.1 then:1,then slides:1,slides the:1,up from:1,screen one:1,screen slides:1,slides halfway:1,halfway up:1,screen bounces:1,bounces down:1,a quarter:1,screen advances:1,advances another:1,another half-screen:1,half-screen drops:1,drops another:1,another quarter-screen:1,quarter-screen and:1,finally slides:1,slides all:1,top If:1,action you:1,30.1 the:1,the smooth:1,smooth overlapping:1,striking effect:1,effect Listing:1,30.1 isn’t:1,isn’t done:1,done just:1,just yet:1,yet however:1,however After:1,a keypress:1,30.1 demonstrates:1,demonstrates how:1,turn the:1,screen off:1,1 After:1,After another:1,30.1 shows:1,never cover:1,then flipping:1,a split:1,zero Both:1,same text:1,displays it:1,it one:1,line lower:1,lower because:1,doesn’t start:1,a jittering:1,jittering effect:1,program switches:1,switches the:1,off On:1,screen may:1,may display:1,two scan:1,lines lower:1,lower for:1,shortly Finally:1,Finally after:1,30.1 halts:1,halts VGA:1,EGA Split-Screen:1,Split-Screen Operation:1,Operation Don’t:1,Don’t Mix:1,Mix You:1,the IS_VGA:1,IS_VGA equate:1,30.1 correctly:1,correctly for:1,perform properly:1,properly This:1,This equate:1,equate determines:1,by SetSplitScreenRow:1,SetSplitScreenRow If:1,0 specifying:1,specifying an:1,EGA target:1,then bit:1,entire Overflow:1,to 1FH:1,1FH this:1,EGA If:1,1 specifying:1,specifying a:1,VGA target:1,then bits:1,bits 8:1,registers they:1,they reside:1,in changing:1,split-screen-related bits:1,modified settings:1,settings back:1,respective registers:1,EGA because:1,because EGA:1,readable The:1,VGA both:1,because VGA:1,monitors require:1,require different:1,different vertical:1,vertical settings:1,settings than:1,than EGA:1,EGA monitors:1,monitors and:1,version doesn’t:1,short there:1,support both:1,both VGA:1,with common:1,common code:1,code separate:1,separate drivers:1,required This:1,that split:1,so rarely:1,30.1 operates:1,10H because:1,highest-resolution mode:1,EGA share:1,share That’s:1,later Setting:1,the Split-Screen-Related:1,Split-Screen-Related Registers:1,Registers Setting:1,split-screen-related registers:1,simple a:1,matter as:1,as merely:1,merely outputting:1,outputting the:1,right values:1,right registers:1,registers timing:1,also important:1,important The:1,checked against:1,displayed which:1,line potentially:1,potentially takes:1,is displaying:1,displaying scan:1,line 15:1,16 that:1,change will:1,be picked:1,up immediately:1,immediately and:1,start after:1,is markedly:1,markedly different:1,from changes:1,address which:1,effect only:1,The instantly-effective:1,instantly-effective nature:1,problem not:1,not because:1,appears as:1,is set—that:1,set—that seems:1,an advantage—but:1,advantage—but because:1,can appear:1,appear before:1,set Remember:1,three registers:1,the incompletely-changed:1,incompletely-changed value:1,value matches:1,rest For:1,frame you’ll:1,a wrong:1,wrong place—possibly:1,place—possibly a:1,very wrong:1,wrong place—resulting:1,place—resulting in:1,in jumping:1,scan line—during:1,line—during vertical:1,One safe:1,safe time:1,time that’s:1,pulse which:1,typically pretty:1,approach I’ve:1,I’ve followed:1,followed in:1,30.1 I’ve:1,also disabled:1,disabled interrupts:1,period when:1,isn’t absolutely:1,not done:1,done there’s:1,interrupt will:1,occur between:1,between register:1,and delay:1,delay the:1,later register:1,sets until:1,until display:1,time again:1,again causing:1,causing flicker:1,flicker One:1,interesting effect:1,of synchronizing:1,synchronizing the:1,adapter’s frame:1,rate No:1,computer running:1,30.1 may:1,move at:1,for regulating:1,regulating execution:1,execution speed:1,speed over:1,hardware performance:1,performance ranges:1,ranges however:1,supports 70:1,rates in:1,all non-480-scan-line:1,non-480-scan-line modes:1,modes while:1,in 480-scan-line-modes:1,480-scan-line-modes and:1,all color:1,support 60:1,rates The:1,The Problem:1,Problem with:1,EGA Split:1,Screen I:1,buggy How:1,How you:1,ask particularly:1,particularly given:1,30.1 illustrates:1,screen seems:1,seems pretty:1,pretty functional:1,functional The:1,split screen—the:1,screen—the scan:1,display memory—is:1,memory—is displayed:1,displayed not:1,not once:1,but twice:1,of split:1,is replicated:1,replicated one:1,one unnecessary:1,unnecessary time:1,time pushing:1,pushing all:1,lines down:1,one That’s:1,a fatal:1,fatal bug:1,bug of:1,course In:1,few scan:1,are identical:1,identical it’s:1,even noticeable:1,noticeable The:1,The EGA’s:1,bug can:1,produce visible:1,visible distortion:1,distortion given:1,given certain:1,certain patterns:1,patterns however:1,top few:1,lines identical:1,identical if:1,possible when:1,designing split-screen:1,split-screen images:1,on EGAs:1,case check:1,check how:1,your split-screens:1,split-screens look:1,look on:1,both VGAs:1,and EGAs:1,EGAs I:1,important caution:1,caution here:1,here Don’t:1,Don’t count:1,don’t rely:1,being doubled:1,doubled when:1,your split:1,screens IBM:1,IBM designed:1,original EGA:1,of companies:1,companies cloned:1,cloned it:1,all EGA:1,EGA clones:1,clones copy:1,the bug:1,bug It:1,certainty at:1,VGA didn’t:1,didn’t copy:1,copy it:1,another respect:1,respect in:1,is inferior:1,inferior to:1,panning when:1,on This:1,a bug—it’s:1,bug—it’s just:1,VGA’s designers:1,designers learned:1,went the:1,EGA one:1,better Split:1,and Panning:1,Panning Back:1,23 I:1,performed smooth:1,smooth horizontal:1,panning Smooth:1,panning consists:1,parts byte-by-byte:1,byte-by-byte 8-pixel:1,8-pixel panning:1,and pixel-by-pixel:1,pixel-by-pixel intrabyte:1,intrabyte panning:1,adjust alignment:1,alignment by:1,pixels IBM:1,IBM prefers:1,prefers its:1,own jargon:1,jargon and:1,word pel:1,pel instead:1,their documentation:1,documentation hence:1,hence pel:1,panning Then:1,Then there’s:1,there’s DASD:1,DASD a.k.a:1,a.k.a Direct:1,Direct Access:1,Access Storage:1,Storage Device—IBM-speak:1,Device—IBM-speak for:1,for hard:1,disk Horizontal:1,Horizontal smooth:1,panning works:1,fine although:1,although I’ve:1,always harbored:1,harbored some:1,some doubts:1,doubts that:1,one horizontal-smooth-panning:1,horizontal-smooth-panning approach:1,properly on:1,display board:1,board clones:1,clones More:1,this later:1,later There’s:1,catch when:1,using horizontal:1,up though:1,serious catch:1,catch You:1,can’t byte-pan:1,byte-pan the:1,always starts:1,zero no:1,can pel-pan:1,pel-pan the:1,screen Put:1,normal portion:1,is horizontally:1,horizontally smooth-panned:1,smooth-panned the:1,screen portion:1,portion moves:1,moves a:1,until it’s:1,then jumps:1,jumps back:1,byte As:1,top part:1,screen moves:1,moves smoothly:1,smoothly about:1,jump move:1,jump over:1,over Believe:1,Believe me:1,pretty sight:1,sight What’s:1,done On:1,EGA nothing:1,nothing Unless:1,users eyes:1,eyes doing:1,the jitterbug:1,jitterbug don’t:1,scrolling while:1,is up:1,up Byte:1,Byte panning:1,is fine—just:1,fine—just don’t:1,setting On:1,is recourse:1,recourse A:1,A VGA-only:1,VGA-only bit:1,10H turns:1,off pel:1,screen In:1,this bit:1,1 pel:1,zero before:1,and remains:1,remains zero:1,zero until:1,horizontally mind:1,mind you—there’s:1,you—there’s no:1,do that—but:1,that—but it:1,does let:1,you pan:1,screen stays:1,stays rock-solid:1,rock-solid This:1,attractive streaming:1,streaming tape:1,tape effect:1,display non-moving:1,non-moving information:1,and Horizontal:1,Horizontal Panning:1,Panning An:1,Example Listing:1,the suppression:1,suppression of:1,of pel:1,30.2 creates:1,screen 1024:1,1024 pixels:1,across by:1,64 sets:1,scan video:1,data beginning:1,beginning far:1,enough up:1,leave room:1,screen starting:1,zero turns:1,and split:1,with distinctive:1,distinctive patterns:1,patterns Next:1,Next Listing:1,30.2 pans:1,horizontally without:1,without setting:1,screen jerks:1,jerks about:1,about quite:1,quite horribly:1,horribly After:1,press Listing:1,30.2 sets:1,sets bit:1,and pans:1,screen again:1,again This:1,doesn’t budge:1,budge an:1,an inch:1,inch if:1,if IS_VGA:1,30.2 the:1,will assemble:1,assemble in:1,EGA Pel:1,Pel panning:1,suppression in:1,version however:1,EGA lacks:1,that feature:1,feature When:1,version runs:1,screen simply:1,simply jerks:1,jerks back:1,forth during:1,during both:1,both panning:1,panning sessions:1,sessions Notes:1,on Setting:1,Setting and:1,and Reading:1,Reading Registers:1,few interesting:1,points regarding:1,regarding setting:1,reading registers:1,30.2 First:1,First bit:1,1 whenever:1,whenever palette:1,not being:1,set which:1,say all:1,because palette:1,should normally:1,BIOS When:1,longer sent:1,solid color—not:1,color—not normally:1,desirable state:1,of affairs:1,affairs Recall:1,Recall also:1,both written:1,at I/O:1,I/O address:1,the toggle:1,toggle that:1,that determines:1,switching state:1,state on:1,every write:1,3C0H this:1,this toggle:1,toggle is:1,each read:1,modes 3BAH:1,at 3C1H:1,3C1H on:1,so steer:1,steer clear:1,clear of:1,that practice:1,practice On:1,VGA reading:1,reading AC:1,from writing:1,from 3C0H:1,register currently:1,from 3C1H:1,3C1H reading:1,reading does:1,AC index/data:1,toggle Listing:1,registers Finally:1,Finally setting:1,0DH has:1,its complications:1,complications As:1,set together:1,without interruption:1,interruption at:1,partial setting:1,setting being:1,frame However:1,was with:1,registers because:1,not clear:1,clear when:1,used You:1,EGA’s or:1,or VGA’s:1,pointer once:1,then advanced:1,advanced byte-by-byte:1,byte-by-byte and:1,and line-by-line:1,line-by-line until:1,possible resetting:1,resetting to:1,screen line:1,reached and:1,then reloaded:1,reloaded for:1,frame That’s:1,enough the:1,real question:1,is Exactly:1,Exactly when:1,when is:1,address loaded:1,loaded In:1,In his:1,his excellent:1,book Programmer’s:1,Systems Microsoft:1,Press Richard:1,Wilton says:1,pulse Wilton:1,Wilton calls:1,calls it:1,it vertical:1,retrace which:1,mean vertical:1,he’s testing:1,register I:1,I assume:1,assume he:1,he means:1,sync Consequently:1,he waits:1,registers confident:1,address won’t:1,won’t take:1,frame I’m:1,sure Richard:1,Richard is:1,McCoy IBM:1,I’m less:1,less confident:1,every clone:1,clone out:1,there loads:1,sync For:1,very reason:1,generally advise:1,advise people:1,panning unless:1,can test:1,test their:1,their software:1,the makes:1,makes of:1,on I’ve:1,used Richard’s:1,Richard’s approach:1,Listings 30.1:1,30.1 and:1,and 30.2:1,30.2 and:1,are potential:1,potential albeit:1,albeit unproven:1,unproven hazards:1,to relying:1,specific time:1,The interaction:1,is worthy:1,worthy of:1,of note:1,note After:1,After waiting:1,30.2 I:1,I wait:1,register That’s:1,address doesn’t:1,setting takes:1,effect at:1,next line:1,address we’d:1,we’d get:1,old start:1,settings mixed:1,together causing:1,jump As:1,registers it’s:1,during non-display:1,maximum reliability:1,reliability we’d:1,pel planning:1,planning setting:1,setting to:1,sure an:1,interrupt doesn’t:1,cause us:1,thus get:1,a mismatched:1,mismatched pel:1,pel panning/start:1,panning/start address:1,address pair:1,frame although:1,for modularity:1,modularity I:1,30.2 Also:1,Also doing:1,so would:1,require disabling:1,time What:1,you wanted:1,pan faster:1,faster Well:1,Well you:1,course just:1,move two:1,ever notice:1,you’re panning:1,second Split:1,Screens in:1,in Other:1,Other Modes:1,Modes So:1,10H What:1,other modes:1,modes Generally:1,Generally the:1,basic rule:1,screen matches:1,zero I’ve:1,found this:1,in oddball:1,oddball modes:1,as line-doubled:1,line-doubled CGA:1,line repeated:1,repeated For:1,For split-screen:1,split-screen purposes:1,EGA seem:1,count purely:1,in rows:1,rows or:1,or doubled:1,doubled scan:1,like However:1,into small:1,small anomalies:1,anomalies in:1,those modes:1,modes on:1,haven’t tested:1,tested all:1,modes nor:1,nor lord:1,knows all:1,clones so:1,careful when:1,than modes:1,modes 0DH-12H:1,0DH-12H and:1,hardware Come:1,Come to:1,I warn:1,running fancy:1,fancy VGA:1,clones pretty:1,pretty often:1,often don’t:1,don’t I:1,I Ah:1,Ah well—just:1,well—just one:1,the diversity:1,diversity and:1,and competition:1,competition of:1,market It:1,a fact:1,of life:1,life though—if:1,though—if you’re:1,commercial developer:1,developer and:1,don’t test:1,your video:1,video code:1,dozen VGAs:1,VGAs you’re:1,you’re living:1,living dangerously:1,dangerously What:1,What of:1,mode It:1,It works:1,only resets:1,internal memory:1,also resets:1,text scan:1,line counter—which:1,counter—which marks:1,marks which:1,which line:1,font you’re:1,you’re on—to:1,on—to zero:1,zero so:1,full row:1,text There’s:1,There’s only:1,one trick:1,trick with:1,mode When:1,When split:1,suppression is:1,setting is:1,is forced:1,frame Unfortunately:1,Unfortunately 0:1,the no-panning:1,no-panning setting:1,setting for:1,for 9-dot-wide:1,9-dot-wide text:1,text 8:1,you turn:1,on split:1,suppression the:1,won’t pan:1,pan with:1,as intended:1,also display:1,the undesirable:1,undesirable characteristic:1,left Whether:1,causes any:1,any noticeable:1,noticeable on-screen:1,effects depends:1,text displayed:1,of blanks:1,blanks on:1,side How:1,How Safe:1,Safe So:1,how safe:1,screen My:1,My opinion:1,opinion is:1,perfectly safe:1,safe although:1,although I’d:1,I’d welcome:1,welcome input:1,from people:1,with extensive:1,extensive split:1,screen experience—and:1,experience—and the:1,are striking:1,striking enough:1,using in:1,certain applications:1,applications I’m:1,more leery:1,scrolling with:1,with or:1,screen Still:1,the Wilton:1,Wilton book:1,book doesn’t:1,doesn’t advise:1,advise any:1,particular caution:1,caution and:1,haven’t heard:1,heard any:1,any horror:1,horror stories:1,stories from:1,field lately:1,lately so:1,manufacturers must:1,must finally:1,finally have:1,right I:1,I vividly:1,vividly remember:1,remember some:1,some early:1,early clones:1,clones years:1,didn’t quite:1,quite get:1,right So:1,So on:1,on balance:1,balance I’d:1,scrolling if:1,fast animation:1,animation you:1,often get:1,with byte:1,byte scrolling:1,scrolling which:1,easier faster:1,and safer:1,safer I:1,recently saw:1,that scrolled:1,scrolled as:1,as smoothly:1,ever want:1,want It:1,by stopping:1,stopping it:1,with Ctrl-NumLock:1,Ctrl-NumLock that:1,fact byte:1,byte panning:1,panning not:1,not pel:1,panning In:1,the fancy:1,fancy stuff—but:1,stuff—but only:1,have Chapter:1,31 Higher:1,Higher 256-Color:1,256-Color Resolution:1,Resolution on:1,When Is:1,Is 320x200:1,320x200 Really:1,Really 320x400:1,320x400 One:1,more appealing:1,is its:1,its ability:1,display 256:1,colors Unfortunately:1,Unfortunately one:1,less appealing:1,resolution 320x200:1,320x200 of:1,the IBM-standard:1,IBM-standard BIOS:1,supports There:1,course higher:1,resolution 256-color:1,the legion:1,legion of:1,of SuperVGAs:1,SuperVGAs but:1,means a:1,and differences:1,between seemingly:1,seemingly identical:1,identical modes:1,modes from:1,manufacturers can:1,be vexing:1,vexing More:1,More colors:1,often compensate:1,for less:1,less resolution:1,resolution but:1,resolution difference:1,the 640x480:1,great that:1,programmers must:1,must regretfully:1,regretfully decide:1,decide that:1,they simply:1,simply can’t:1,never just:1,things With:1,VGA alternatives:1,alternatives always:1,always exist:1,clever programmer:1,with 256-color:1,mode Not:1,high 256-color:1,resolution there:1,are lots:1,of higher:1,resolutions going:1,to 360x480—and:1,360x480—and that’s:1,that’s with:1,the vanilla:1,vanilla IBM:1,favorite 256-color:1,provides 320x400:1,320x400 resolution:1,little reprogramming:1,discuss higher-resolution:1,and starting:1,47 I’ll:1,high-performance Mode:1,X 256-color:1,use So:1,So Let’s:1,started Why:1,Why 320x200:1,320x200 Only:1,Only IBM:1,IBM Knows:1,Knows for:1,for Sure:1,Sure The:1,get higher:1,resolutions out:1,VGA After:1,no unused:1,unused higher:1,resolutions to:1,CGA Hercules:1,Hercules card:1,card or:1,or EGA:1,another question:1,did IBM:1,IBM not:1,easily capable:1,of twice:1,200-scan-line vertical:1,and IBM:1,IBM clearly:1,clearly made:1,decision not:1,a higher-resolution:1,fact mode:1,does display:1,display 400:1,each row:1,two successive:1,successive scan:1,lines resulting:1,same scan-doubling:1,scan-doubling approach:1,the CGA’s:1,CGA’s 200-scan-line:1,CGA has:1,has long:1,long been:1,at 200:1,lines so:1,so IBM:1,IBM had:1,had no:1,choice with:1,to scan-double:1,scan-double the:1,lines Mode:1,such historical:1,historical limitation—it’s:1,limitation—it’s the:1,first 256-color:1,mode ever:1,ever offered:1,offered by:1,by IBM:1,IBM if:1,and unlamented:1,unlamented Professional:1,Professional Graphics:1,Controller PGC:1,PGC Why:1,would IBM:1,IBM choose:1,13H There’s:1,good guess:1,IBM wanted:1,wanted a:1,mode across:1,all PS/2:1,computers for:1,created and:1,highest-resolution 256-color:1,the bill:1,bill You:1,see each:1,each 256-color:1,pixel requires:1,requires one:1,a 320x200:1,requires 64000:1,has 256K:1,stretch for:1,MCGA of:1,30 since:1,MCGA comes:1,only 64K:1,64K On:1,smaller display:1,memory size:1,MCGA also:1,also limits:1,colors supported:1,supported in:1,to 2:1,2 rather:1,16 supported:1,though IBM:1,IBM simply:1,simply created:1,created two:1,made both:1,both available:1,mode 11H:1,640x480 2-color:1,2-color graphics:1,for 256-color:1,256-color graphics—but:1,graphics—but wasn’t:1,wasn’t Why:1,Why I:1,know Maybe:1,Maybe IBM:1,IBM just:1,just didn’t:1,didn’t like:1,320x400 graphics:1,mode Maybe:1,Maybe they:1,map in:1,memory Heck:1,Heck maybe:1,maybe they:1,they made:1,mistake in:1,designing the:1,chip Whatever:1,reason mode:1,mode masquerading:1,masquerading as:1,a 200-scan-line:1,200-scan-line mode:1,readily end:1,end that:1,that masquerade:1,masquerade 320x400:1,320x400 256-Color:1,Mode Okay:1,Okay what’s:1,what’s so:1,great about:1,mode Two:1,things easy:1,easy safe:1,safe mode:1,flipping As:1,above mode:1,mode albeit:1,line doubled:1,doubled to:1,320x200 That:1,change any:1,display timings:1,timings widths:1,widths or:1,or heights:1,heights in:1,to tweak:1,tweak mode:1,320x400 mode—and:1,mode—and that:1,makes 320x400:1,320x400 a:1,a safe:1,safe choice:1,choice Basically:1,Basically 320x400:1,mode differs:1,13H only:1,bits which:1,are sure:1,consistent from:1,which work:1,work equally:1,all monitors:1,monitors The:1,other hi-res:1,hi-res 256-color:1,modes differ:1,differ from:1,13H not:1,and dimension:1,dimension registers:1,particularly not:1,all multisync:1,monitors Because:1,Because multisyncs:1,multisyncs sometimes:1,sometimes shrink:1,shrink the:1,active area:1,modes some:1,some VGAs:1,VGAs use:1,use alternate:1,alternate register:1,for multisync:1,monitors that:1,that adjust:1,Controller timings:1,for displaying:1,displaying pixels:1,other good:1,supported Each:1,Each 320x400:1,requires 128000:1,128000 bytes:1,barely manage:1,mode one:1,8000H Those:1,Those two:1,largest pair:1,of pages:1,can fit:1,VGA’s 256K:1,256K though:1,use still:1,still larger:1,larger bitmaps:1,bitmaps areas:1,control pixels:1,screen can’t:1,support two:1,book paging:1,for off-screen:1,off-screen construction:1,construction of:1,fast smooth:1,animation That’s:1,how display:1,organized in:1,simple Display:1,Memory Organization:1,Organization in:1,320x400 Mode:1,Mode First:1,organized differently:1,mode than:1,The designers:1,VGA intentionally:1,intentionally limited:1,limited the:1,64K thereby:1,thereby limiting:1,limiting resolution:1,was accomplished:1,to 320x400:1,a shame:1,shame because:1,simplest bitmap:1,any mode—one:1,mode—one long:1,long linear:1,pixel We:1,can’t have:1,that organization:1,organization though:1,acceptable substitute:1,substitute if:1,resolution We’re:1,course there:1,actually several:1,several bitmap:1,bitmap organizations:1,organizations that:1,use higher:1,resolutions than:1,like best:1,best is:1,31.1 Each:1,Each byte:1,pixel Pixel:1,Pixel 0:1,0 pixel:1,pixel 1:1,pixel 2:1,2 pixel:1,pixel 3:1,3 pixel:1,pixel 4:1,4 is:1,address 1:1,way Ideally:1,one long:1,long bitmap:1,left Well:1,Well that’s:1,that’s true:1,case too:1,pixel’s address:1,address View:1,View the:1,pixel numbers:1,numbers on:1,as increasing:1,increasing from:1,next Then:1,n of:1,address address:1,is Figure:1,mode n:1,n address:1,address 4:1,4 plane:1,plane To:1,To turn:1,turn that:1,that around:1,by address:1,address n:1,n 4:1,pixel n:1,by plane:1,plane n:1,n modulo:1,4 Basically:1,full address:1,pixel its:1,its pixel:1,two components:1,plane By:1,way because:1,because 320x400:1,significantly different:1,organization from:1,BIOS text:1,text routines:1,mode you’ll:1,ROM and:1,text yourself:1,yourself Likewise:1,BIOS read:1,because I’ll:1,provide equivalent:1,equivalent routines:1,section Our:1,next task:1,convert standard:1,That’s accomplished:1,by undoing:1,undoing some:1,up especially:1,13H so:1,that from:1,VGA reverts:1,reverts to:1,straightforward planar:1,planar model:1,means taking:1,VGA out:1,of chain:1,chain 4:1,4 mode:1,and doubleword:1,doubleword mode:1,mode turning:1,turning off:1,double display:1,sure chain:1,chain mode:1,mode odd/even:1,odd/even mode:1,word mode:1,selecting byte:1,data display:1,display All:1,31.1 which:1,discuss next:1,next Reading:1,Reading and:1,and Writing:1,Pixels The:1,are functions:1,write single:1,single pixels:1,pixels Any:1,Any more:1,these primitives:1,primitives although:1,that’s rarely:1,rarely the:1,speediest solution:1,solution What’s:1,more once:1,functions you’ve:1,you’ve got:1,got all:1,knowledge you:1,create functions:1,functions Consequently:1,Consequently we’ll:1,with pixel-at-a-time:1,pixel-at-a-time line:1,31.1 draws:1,draws 8:1,8 multicolored:1,multicolored octagons:1,octagons in:1,turn drawing:1,new one:1,old one:1,The main-loop:1,main-loop code:1,31.1 should:1,be easily:1,understood a:1,diagonal horizontal:1,drawn one:1,time based:1,line descriptors:1,descriptors with:1,the draw:1,draw colors:1,colors incremented:1,incremented for:1,successive time:1,31.1 are:1,three First:1,subroutine selects:1,selects 320x400:1,set followed:1,by then:1,then putting:1,into standard:1,standard planar:1,planar byte:1,mode Set320x400Mode:1,Set320x400Mode zeros:1,zeros display:1,set because:1,set clears:1,clears only:1,mode leaving:1,leaving 192K:1,192K of:1,memory untouched:1,untouched The:1,colored pixel:1,any xy:1,xy addressable:1,addressable location:1,location on:1,screen Although:1,because I’ve:1,I’ve optimized:1,little the:1,simple First:1,pixel’s display:1,SCREEN_WIDTH 4:1,4 x:1,4 which:1,which might:1,more recognizable:1,recognizable as:1,SCREEN_WIDTH x:1,4 There:1,are 4:1,mode hence:1,4 Then:1,pixel’s plane:1,as plane:1,The pixel’s:1,addressed plane:1,plane That’s:1,third item:1,item of:1,the ReadPixel:1,ReadPixel subroutine:1,subroutine ReadPixel:1,ReadPixel is:1,to WritePixel:1,WritePixel save:1,in ReadPixel:1,ReadPixel the:1,programmed with:1,plane number:1,number while:1,while WritePixel:1,WritePixel uses:1,that difference:1,difference merely:1,merely reflects:1,reflects a:1,fundamental difference:1,If that’s:1,that’s Greek:1,you refer:1,to Chapters:1,Chapters 23-30:1,23-30 for:1,a refresher:1,programming ReadPixel:1,ReadPixel isn’t:1,31.1 but:1,but I’ve:1,I’ve included:1,included it:1,because as:1,functions together:1,whole host:1,host of:1,functions How:1,does 320x400:1,mode stack:1,as regards:1,regards performance:1,drawing pretty:1,much on:1,a par:1,par with:1,13H When:1,31.1 you’ll:1,you’ll no:1,doubt notice:1,drawn quite:1,quite rapidly:1,rapidly In:1,still with:1,a dedicated:1,dedicated line-drawing:1,would avoid:1,multiplication associated:1,31.1 In:1,In 320x400:1,not significantly:1,and selection:1,target plane:1,is quickly:1,quickly accomplished:1,accomplished As:1,13H 320x400:1,mode benefits:1,benefits tremendously:1,tremendously from:1,byte-per-pixel organization:1,time-consuming pixel-masking:1,pixel-masking of:1,modes Most:1,Most important:1,important byte-per-pixel:1,byte-per-pixel modes:1,modes never:1,never require:1,require read-modify-write:1,read-modify-write operations:1,To draw:1,pixel you:1,store its:1,its color:1,display memory—what:1,memory—what could:1,simpler More:1,More sophisticated:1,sophisticated operations:1,operations than:1,than pixel:1,drawing are:1,less easy:1,accomplish in:1,little ingenuity:1,ingenuity it:1,a reasonably:1,efficient version:1,any useful:1,useful graphics:1,function A:1,A fast:1,fast line:1,be simple:1,simple although:1,13H Fast:1,Fast image:1,copies could:1,copying one-quarter:1,plane one-quarter:1,one-quarter to:1,that sequential:1,processing requires:1,you’re really:1,really into:1,into performance:1,performance you:1,store your:1,0 grouped:1,grouped together:1,together followed:1,just four:1,four REP:1,instructions copying:1,whole image:1,of cases:1,fact 320x400:1,13H because:1,draw four:1,even eight:1,access I’ll:1,13H non-chain:1,non-chain 4:1,4 modes:1,47 It’s:1,bit complicated:1,complicated but:1,say you:1,adequately fast—and:1,fast—and often:1,often very:1,very fast—version:1,fast—version for:1,whatever graphics:1,need If:1,that concerned:1,speed WritePixel:1,WritePixel and:1,and ReadPixel:1,ReadPixel should:1,should meet:1,needs Two:1,Two 256-Color:1,256-Color Pages:1,Pages Listing:1,31.2 demonstrates:1,demonstrates the:1,drawing slanting:1,bars slanting:1,slanting the:1,and flipping:1,next key:1,press Note:1,accessed starting:1,and is—unsurprisingly—displayed:1,is—unsurprisingly—displayed by:1,8000H Finally:1,31.2 draws:1,draws vertical:1,vertical color:1,and flips:1,flips back:1,0 when:1,when another:1,another key:1,color bar:1,bar routines:1,routines don’t:1,subroutine from:1,31.1 they:1,they go:1,memory instead:1,instead for:1,improved speed:1,above better:1,better speed:1,speed yet:1,yet could:1,a color-bar:1,color-bar algorithm:1,on thereby:1,thereby avoiding:1,of constantly:1,constantly reprogramming:1,31.2 note:1,smooth edges:1,and fine:1,fine gradations:1,color especially:1,the screens:1,with slanting:1,bars The:1,The displays:1,displays produced:1,31.2 make:1,produce effects:1,mode Something:1,Something to:1,to Think:1,Think About:1,About You:1,wish use:1,in 320x200:1,320x200 mode:1,modifying Set320x400Mode:1,Set320x400Mode to:1,setting at:1,of Set320x400Mode:1,Set320x400Mode in:1,Listings 31.1:1,31.1 and:1,and 31.2:1,31.2 forces:1,0 doubling:1,screen Why:1,Why would:1,that For:1,then choose:1,choose from:1,from not:1,four 320x200:1,pages starting:1,0 4000H:1,4000H 8000H:1,8000H and:1,and 0C000H:1,0C000H in:1,another having:1,having only:1,can as:1,as double:1,double drawing:1,drawing speeds:1,speeds that’s:1,games run:1,320x200 and:1,then often:1,often limit:1,active display:1,display drawing:1,drawing area:1,screen Chapter:1,Chapter 32:1,32 Be:1,Be It:1,It Resolved:1,Resolved 360x480:1,360x480 Taking:1,Taking 256-Color:1,Modes About:1,About as:1,as Far:1,Far as:1,the Standard:1,Standard VGA:1,VGA Can:1,Can Take:1,Take Them:1,Them In:1,to coax:1,coax 320x400:1,resolution out:1,VGA At:1,actually capable:1,of supporting:1,supporting 256-color:1,resolutions as:1,as 360x480:1,360x480 but:1,didn’t pursue:1,topic further:1,further preferring:1,preferring to:1,the versatile:1,versatile and:1,and easy-to-set:1,easy-to-set 320x400:1,mode instead:1,instead Some:1,was sent:1,sent a:1,useful item:1,item from:1,Bridges a:1,a longtime:1,longtime correspondent:1,correspondent and:1,excellent programmer:1,complete mode:1,domain In:1,addition John:1,wrote I:1,of freeware:1,freeware free:1,free but:1,not public:1,domain utilities:1,utilities out:1,there including:1,including PICEM:1,PICEM which:1,which displays:1,displays PIC:1,PIC PCX:1,PCX and:1,and GIF:1,GIF images:1,images not:1,in 360x480x256:1,360x480x256 but:1,in 640x350x256:1,640x350x256 640x400x256:1,640x400x256 640x480x256:1,640x480x256 and:1,and 800x600x256:1,800x600x256 on:1,SuperVGAs In:1,combine John’s:1,John’s mode:1,with appropriately:1,appropriately modified:1,modified versions:1,the dot-plot:1,dot-plot code:1,we’ll develop:1,develop in:1,35 Together:1,Together those:1,routines will:1,pretty nifty:1,nifty demo:1,mode Extended:1,Extended 256-Color:1,Modes What’s:1,What’s Not:1,to Like:1,Like When:1,left 256-color:1,programming we:1,had found:1,which officially:1,officially offers:1,offers 320x200:1,resolution actually:1,actually displays:1,displays 400:1,400 not:1,not 200:1,with line-doubling:1,line-doubling used:1,320x200 By:1,By tweaking:1,tweaking a:1,mode registers:1,registers we:1,we converted:1,converted mode:1,true 320x400:1,added bonus:1,supports two:1,pages a:1,distinct improvement:1,page supported:1,13H We:1,also learned:1,get four:1,four graphics:1,resolution should:1,needed I:1,I particularly:1,particularly like:1,It supports:1,supports two-page:1,two-page graphics:1,require changing:1,changing any:1,monitor timing:1,timing characteristics:1,we changed:1,produce 320x400:1,much guaranteed:1,same from:1,less certain:1,be constant:1,constant especially:1,for VGAs:1,VGAs that:1,that provide:1,provide special:1,special support:1,extended capabilities:1,various multiscanning:1,multiscanning monitors:1,monitors All:1,good arguments:1,arguments for:1,mode However:1,the counter-argument:1,counter-argument seems:1,seems compelling:1,compelling as:1,as well—nothing:1,well—nothing beats:1,beats higher:1,for producing:1,producing striking:1,striking graphics:1,graphics Given:1,and given:1,Bridges was:1,his mode:1,code available:1,available I’m:1,at 360x480:1,256mode next:1,next However:1,strengths of:1,mode Only:1,and direct:1,the monitorregisters:1,monitorregisters Also:1,Also this:1,a peculiar:1,peculiar and:1,and unique:1,unique aspect:1,ratio with:1,with 480:1,480 pixels:1,as high-resolution:1,12H vertically:1,only 360:1,360 horizontally:1,horizontally That:1,That makes:1,fairly poor:1,poor horizontal:1,and sometimes-jagged:1,sometimes-jagged drawing:1,better in:1,both directions:1,directions than:1,13H itself:1,itself has:1,ratio so:1,seems a:1,bit petty:1,petty to:1,to complain:1,complain The:1,page isn’t:1,drawback if:1,flipping of:1,course so:1,about there:1,flipping don’t:1,The direct:1,matter altogether:1,altogether I:1,how likely:1,likely this:1,produce problems:1,with clone:1,general however:1,put an:1,an older:1,older Video:1,Seven VRAM:1,VRAM VGA:1,into pure:1,pure mode—where:1,mode—where it:1,it treats:1,treats the:1,the VRAMs:1,VRAMs as:1,as DRAMs:1,DRAMs and:1,exactly emulates:1,emulates a:1,a plain-vanilla:1,plain-vanilla IBM:1,IBM VGA—before:1,VGA—before 360x480:1,properly Now:1,was due:1,of VRAMs:1,VRAMs and:1,and shouldn’t:1,shouldn’t occur:1,on Video:1,Seven’s Fastwrite:1,Fastwrite adapter:1,clone Nonetheless:1,Nonetheless 360x480:1,deal different:1,chapter runs:1,runs perfectly:1,other VGAs:1,experience I:1,guarantee its:1,its functionality:1,functionality on:1,particular VGA/monitor:1,VGA/monitor combination:1,combination unlike:1,unlike 320x400:1,mode Mind:1,mode should:1,all VGAs—there:1,VGAs—there are:1,variables involved:1,certain Feedback:1,Feedback from:1,readers with:1,with broad:1,broad 360x480:1,256-color experience:1,welcome The:1,notwithstanding 360x480:1,offers 64:1,nearly three:1,as IBM’s:1,original CGA:1,CGA color:1,color graphics:1,mode making:1,making startlingly:1,startlingly realistic:1,realistic effects:1,effects possible:1,possible No:1,No mode:1,least no:1,no mode:1,documented or:1,or undocumented:1,undocumented offers:1,better combination:1,of resolution:1,color even:1,even 320x400:1,has 26:1,percent fewer:1,fewer pixels:1,words 360x480:1,worth considering—so:1,considering—so let’s:1,look 360x480:1,Mode I’m:1,by showing:1,action after:1,works I:1,mode looks:1,like you’ll:1,than eager:1,32.1 contains:1,three C-callable:1,C-callable assembly:1,assembly functions:1,functions As:1,expect Set360x480Mode:1,Set360x480Mode places:1,places the:1,into 360x480:1,256mode Draw360x480Dot:1,Draw360x480Dot draws:1,location Finally:1,Finally Read360x480Dot:1,Read360x480Dot returns:1,last function:1,function isn’t:1,isn’t actually:1,example program:1,included for:1,for completeness:1,completeness Listing:1,Listing 32.2:1,32.2 contains:1,an adaptation:1,adaptation of:1,C linecode:1,linecode I’ll:1,presenting shortly:1,shortly in:1,35 If:1,you’re reading:1,in serial:1,serial fashion:1,haven’t gotten:1,gotten there:1,yet simply:1,simply take:1,on faith:1,faith If:1,the line-draw:1,works right:1,now by:1,means make:1,short forward:1,forward call:1,and digest:1,digest it:1,The line-draw:1,presented below:1,below has:1,altered to:1,select 360x480:1,cycle through:1,supports drawing:1,good especially:1,is im-plemented:1,im-plemented in:1,C Drawing:1,sometimes actually:1,modes because:1,byte-per-pixel display:1,mode eliminates:1,memory before:1,isolate individual:1,pixels coexisting:1,coexisting within:1,addition 360x480:1,X which:1,we’ll encounter:1,encounter in:1,47 and:1,supports all:1,high-performance features:1,X The:1,second thing:1,notice is:1,that exquisite:1,exquisite shading:1,shading effects:1,mode adjacent:1,adjacent lines:1,lines blend:1,together remarkably:1,remarkably smoothly:1,smoothly even:1,default palette:1,VGA allows:1,select your:1,your 256:1,256K so:1,wished set:1,produce still:1,still finer:1,finer shading:1,shading albeit:1,fewer distinctly:1,different colors:1,colors available:1,available For:1,topics see:1,the coverage:1,coverage of:1,palette reprogramming:1,reprogramming that:1,that begins:1,begins in:1,not notice:1,notice right:1,away is:1,much detail:1,the blending:1,blending of:1,colors tends:1,to obscure:1,obscure the:1,superior resolution:1,mode Each:1,four rectangles:1,rectangles displayed:1,displayed measures:1,measures 180:1,180 pixels:1,by 240:1,240 vertically:1,vertically Put:1,way each:1,rectangles has:1,two-thirds as:1,entire mode:1,13H screen:1,all 360x480:1,has 2.7:1,2.7 times:1,13H As:1,is unevenly:1,unevenly distributed:1,with vertical:1,resolution matching:1,matching that:1,12H but:1,but horizontal:1,resolution barely:1,barely exceeding:1,exceeding that:1,13H—but resolution:1,is hot:1,hot stuff:1,stuff no:1,how it’s:1,it’s laid:1,and 360x480:1,highest 256-color:1,resolution you’re:1,you’re ever:1,see on:1,VGA SuperVGAs:1,SuperVGAs are:1,quite another:1,another matter—but:1,matter—but when:1,you require:1,SuperVGA you’re:1,you’re automatically:1,automatically excluding:1,excluding what:1,what might:1,significant chunk:1,code Now:1,capable let’s:1,works How:1,How 360x480:1,Mode Works:1,Works In:1,In describing:1,describing 360x480:1,mode I’m:1,not go:1,modes have:1,deal in:1,to bore:1,bore you:1,you by:1,repeating myself:1,myself when:1,the goods:1,goods are:1,few page:1,page flips:1,flips the:1,the paper:1,paper kind:1,kind away:1,away 360x480:1,essentially 320x400:1,but stretched:1,stretched in:1,dimensions Let’s:1,vertical stretching:1,stretching first:1,first since:1,two 480:1,480 Scan:1,Scan Lines:1,Lines per:1,per Screen:1,Screen A:1,A Little:1,Little Slower:1,Slower But:1,But No:1,No Big:1,Big Deal:1,Deal There’s:1,nothing unusual:1,unusual about:1,about 480:1,lines standard:1,standard modes:1,12H support:1,that vertical:1,resolution The:1,resolution so:1,so converting:1,converting 320x400:1,320x400 256mode:1,256mode to:1,to 320x480:1,320x480 256-color:1,of reprogramming:1,VGA’s vertical:1,vertical control:1,control registers—which:1,registers—which control:1,lines displayed:1,pulse vertical:1,blanking and:1,scan lines—to:1,lines—to the:1,the 480-scansettings:1,480-scansettings and:1,the polarities:1,polarities of:1,a 480-line:1,480-line screen:1,screen Switching:1,Switching to:1,of slowing:1,screen refresh:1,always displays:1,displays at:1,at 70:1,Hz except:1,in 480-scan-line:1,modes there:1,there due:1,rate slows:1,slows to:1,Hz VGA:1,monitors always:1,always scan:1,scan at:1,rate horizontally:1,horizontally that:1,distance across:1,screen covered:1,beam in:1,modes Consequently:1,Consequently adding:1,frame requires:1,time 60:1,Hz isn’t:1,isn’t bad:1,bad that’s:1,only refresh:1,EGA ever:1,ever supported:1,EGA was:1,the industry:1,industry standard:1,its time—but:1,time—but it:1,flicker a:1,harder on:1,the eyes:1,eyes than:1,than 70:1,Hz 360:1,360 Pixels:1,Pixels per:1,per Scan:1,Line No:1,No Mean:1,Mean Feat:1,Feat Converting:1,Converting from:1,difficult than:1,than converting:1,converting from:1,from 400:1,400 to:1,screen None:1,VGA’s graphics:1,modes supports:1,supports 360:1,anything like:1,standard choices:1,choices are:1,are 320:1,320 and:1,and 640:1,across However:1,does support:1,we seek—360:1,seek—360 pixels—in:1,pixels—in 40-column:1,40-column text:1,settings that:1,that select:1,select those:1,those horizontal:1,resolutions aren’t:1,aren’t directly:1,directly transferable:1,transferable to:1,mode Text:1,Text modes:1,dots the:1,time information:1,while graphics:1,display just:1,just 4:1,8 dots:1,fetch Although:1,bit confusing:1,confusing it’s:1,it’s standard:1,standard terminology:1,terminology to:1,interval required:1,fetch as:1,I’ll follow:1,follow that:1,terminology from:1,on Consequently:1,Consequently both:1,both modes:1,display either:1,either 40:1,40 or:1,or 80:1,80 characters:1,that text:1,display more:1,character Given:1,that graphics:1,modes can’t:1,can’t display:1,character there’s:1,only enough:1,for eight:1,eight 16pixels:1,16pixels or:1,four 256-color:1,256-color pixels:1,we’d seem:1,an impasse:1,impasse The:1,solving this:1,problem lies:1,in recalling:1,recalling that:1,monitor that:1,that sweeps:1,sweeps the:1,beam across:1,speed no:1,what mode:1,in If:1,monitor always:1,always sweeps:1,sweeps at:1,speed how:1,how does:1,VGA manage:1,display both:1,both 640:1,and 720:1,720 pixels:1,modes Good:1,Good question:1,question indeed—and:1,indeed—and the:1,clocks on:1,on board:1,board and:1,those clocks:1,clocks is:1,just sufficiently:1,sufficiently faster:1,other clock:1,clock so:1,extra 80:1,80 or:1,40 pixels:1,pixels can:1,words there’s:1,slow clock:1,about 25:1,get 640:1,640 or:1,or 320:1,screen during:1,second fast:1,fast clock:1,about 28:1,crank out:1,out 720:1,720 or:1,or 360:1,particular 320x400:1,clock I’ll:1,I’m headed:1,headed We:1,clock in:1,in 320x480:1,320x480 256mode:1,256mode in:1,pixels It:1,clocks to:1,produce one:1,get 40:1,40 rather:1,80 extra:1,extra pixels:1,pixels by:1,this bringing:1,bringing our:1,our horizontal:1,desired 360:1,pixels Switching:1,Switching horizontal:1,resolutions sounds:1,sounds easy:1,it Alas:1,Alas it’s:1,not There’s:1,draw 8:1,8 rather:1,than 9:1,character so:1,timing parameters:1,parameters have:1,scratch John:1,to appreciate:1,appreciate that:1,that producing:1,producing this:1,mode took:1,took some:1,The registers:1,registers controlling:1,characters displayed:1,horizontal sync:1,pulse horizontal:1,speed all:1,altered in:1,up 360x480:1,function Set360x480Mode:1,Set360x480Mode in:1,32.1 does:1,control vertical:1,well Once:1,360x480 mode:1,mode awaiting:1,awaiting our:1,our every:1,every high-resolution:1,256-color graphics:1,graphics whim:1,whim Accessing:1,Accessing Display:1,Mode Setting:1,Setting up:1,mode proved:1,task Is:1,Is drawing:1,mode going:1,as difficult:1,difficult No:1,No In:1,conversion between:1,working screen:1,width from:1,pixel reading:1,pixel writing:1,writing code:1,the SCREEN_WIDTH:1,SCREEN_WIDTH equate:1,equate from:1,360 those:1,work perfectly:1,perfectly in:1,The organization:1,almost exactly:1,we covered:1,chapter However:1,refresher each:1,pixel just:1,reprogrammed by:1,pixels lie:1,in adjacent:1,adjacent planes:1,memory Look:1,Look back:1,31.1 in:1,bytes controlling:1,controlling those:1,pixels run:1,run cross-plane:1,cross-plane advancing:1,address only:1,The address:1,at screen:1,coordinate xy:1,xy is:1,is address:1,y 360:1,360 x:1,is plane:1,4 A:1,every 360:1,or 90:1,90 bytes:1,32.1 This:1,major programming:1,the 360x480:1,360x480 and:1,and 320x400:1,every 80:1,other programming:1,memory mapped:1,longer in:1,only common:1,exact amount:1,is 360:1,360 times:1,times 480:1,480 172800:1,172800 bytes:1,256 Kb:1,Kb memory:1,memory complement:1,complement so:1,so page-flipping:1,page-flipping is:1,couldn’t use:1,screen larger:1,than 360x480:1,360x480 around:1,then scroll:1,scroll if:1,wish That’s:1,mode From:1,than 320x400:1,mode once:1,completed and:1,performance given:1,given some:1,coding It’s:1,not particular:1,particular straightforward:1,implement bitblt:1,bitblt block:1,block move:1,move or:1,or fast:1,extended 256-color:1,be done—and:1,done—and it’s:1,trouble Even:1,small taste:1,taste we’ve:1,gotten of:1,modes shows:1,they put:1,traditional CGA:1,even VGA:1,to shame:1,shame Figure:1,come though:1,though in:1,chapters we’ll:1,to high-resolution:1,tremendous potential:1,time 2-D:1,animation Chapter:1,33 Yogi:1,Yogi Bear:1,Bear and:1,and Eurythmics:1,Eurythmics Confront:1,Confront VGA:1,VGA Colors:1,Colors The:1,Basics of:1,Color Generation:1,Generation Kevin:1,Kevin Mangis:1,Mangis wants:1,VGA’s 4-bit:1,18-bit color:1,translation Mansur:1,Mansur Loloyan:1,Loloyan would:1,table containing:1,containing 256:1,palette And:1,And surely:1,surely they:1,the tip:1,the iceberg:1,iceberg hordes:1,hordes of:1,screaming programmers:1,programmers from:1,planet are:1,doubt tearing:1,tearing the:1,place up:1,and venting:1,venting their:1,their frustration:1,frustration at:1,my mailbox:1,mailbox Let’s:1,Let’s have:1,it they’ve:1,they’ve said:1,said clearly:1,clearly and:1,considerable numbers:1,numbers As:1,As Eurythmics:1,Eurythmics might:1,say who:1,who is:1,this humble:1,humble writer:1,writer to:1,to disagree:1,disagree On:1,hand I:1,you all:1,all know:1,you’re getting:1,into To:1,To paraphrase:1,paraphrase Yogi:1,Yogi the:1,is smarter:1,smarter and:1,more confusing:1,confusing than:1,average board:1,board There’s:1,There’s the:1,basic 8-bit:1,18-bit translation:1,EGA-compatible 4-bit:1,4-bit color:1,paging register:1,to pad:1,pad 6:1,6 or:1,there’s 256-color:1,mode Fear:1,end but:1,take us:1,additional chapters:1,get there—so:1,there—so let’s:1,started Before:1,begin though:1,must refer:1,Michael Covington’s:1,Covington’s excellent:1,excellent article:1,article Color:1,Color Vision:1,Vision and:1,the June/July:1,June/July 1990:1,TECHNIQUES Michael:1,Michael one:1,most brilliant:1,brilliant people:1,people it:1,meet is:1,an expert:1,expert in:1,about including:1,including linguistics:1,linguistics and:1,and artificial:1,artificial intelligence:1,intelligence Add:1,perception for:1,his article:1,article superbly:1,superbly describes:1,mechanisms by:1,we perceive:1,perceive color:1,ties that:1,VGA’s capabilities:1,capabilities After:1,After reading:1,reading Michael’s:1,article you’ll:1,what colors:1,why Our:1,Our topic:1,chapter complements:1,complements Michael’s:1,article nicely:1,nicely Where:1,Where he:1,he focused:1,perception we’ll:1,we’ll focus:1,generation that:1,generate those:1,those colors:1,its capabilities:1,capabilities To:1,VGA can’t:1,generate as:1,as pure:1,pure a:1,red as:1,an LED:1,LED read:1,read Michael’s:1,article If:1,between 16:1,16 different:1,colors though:1,don’t touch:1,that dial:1,dial I:1,be remiss:1,remiss if:1,didn’t point:1,more articles:1,articles these:1,July 1990:1,Journal Super:1,Programming by:1,by Chris:1,Chris Howard:1,Howard provides:1,useful information:1,about SuperVGA:1,SuperVGA chipsets:1,chipsets modes:1,programming Circles:1,Circles and:1,the Digital:1,Digital Differential:1,Differential Analyzer:1,Analyzer by:1,by Tim:1,Tim Paterson:1,Paterson is:1,fast circle:1,circle drawing:1,topic we’ll:1,we’ll tackle:1,tackle soon:1,soon All:1,dog days:1,of 1990:1,1990 were:1,were good:1,good times:1,graphics VGA:1,Color Basics:1,Basics Briefly:1,circuitry takes:1,one 4:1,or 8-bit:1,8-bit pixel:1,and translates:1,blue that:1,are converted:1,to corresponding:1,corresponding analog:1,analog levels:1,levels and:1,monitor Seems:1,Seems simple:1,enough doesn’t:1,it Unfortunately:1,Unfortunately nothing:1,nothing is:1,ever that:1,simple on:1,translation is:1,no exception:1,exception The:1,The Palette:1,color path:1,VGA involves:1,stages as:1,first stage:1,stage fetches:1,fetches a:1,and feeds:1,feeds it:1,so called:1,called because:1,is functionally:1,functionally equivalent:1,RAM color:1,circuitry of:1,which translates:1,sends it:1,translation involves:1,registers a:1,0 selects:1,1 selects:1,selects register:1,Each palette:1,register stores:1,stores 6:1,incoming 4-bit:1,value 6:1,sent out:1,RAM was:1,described back:1,29 The:1,mode except:1,each 4-bit:1,generated based:1,the character’s:1,character’s font:1,and attribute:1,attribute In:1,to eventually:1,eventually the:1,factor from:1,left alone:1,alone The:1,DAC Once:1,RAM has:1,has fulfilled:1,fulfilled its:1,its karma:1,karma and:1,performed 4-bit:1,DAC Digital/Analog:1,Digital/Analog Converter:1,Converter The:1,DAC performs:1,18-bit conversion:1,conversion in:1,RAM converts:1,the 18-bit:1,18-bit result:1,signals 6:1,each signal:1,signal and:1,three analog:1,signals to:1,chip external:1,an integral:1,integral part:1,VGA standard:1,present on:1,VGA Figure:1,path Figure:1,path I’d:1,can’t speak:1,translation process:1,The 4-bit:1,memory 6-bit:1,and 8-bit:1,values sent:1,DAC are:1,all attributes:1,attributes not:1,not colors:1,colors because:1,they’re subject:1,to translation:1,translation by:1,later stage:1,stage For:1,pixel with:1,isn’t black:1,black it’s:1,it’s attribute:1,0 It:1,It will:1,be translated:1,3FH if:1,if palette:1,3FH but:1,color white:1,white just:1,another attribute:1,attribute The:1,value 3FH:1,3FH coming:1,DAC isn’t:1,isn’t white:1,white either:1,register 63:1,63 is:1,red 7:1,7 green:1,actual color:1,color displayed:1,was 0:1,be dim:1,dim red:1,red It:1,isn’t color:1,color until:1,DAC says:1,says it’s:1,it’s color:1,256 18-bit:1,18-bit storage:1,storage registers:1,registers used:1,to translate:1,translate one:1,possible 8-bit:1,256K 262144:1,262144 to:1,precise 18-bit:1,The 18-bit:1,actually composed:1,blue for:1,the higher:1,higher the:1,number the:1,the brighter:1,brighter the:1,0 turning:1,turning that:1,color off:1,off in:1,and 63:1,63 3FH:1,3FH making:1,making that:1,color maximum:1,maximum brightness:1,brightness Got:1,Got all:1,that Color:1,Color Paging:1,Paging with:1,Select Register:1,Register Wait:1,Wait a:1,minute you:1,say bemusedly:1,bemusedly Aren’t:1,Aren’t you:1,you missing:1,missing some:1,some bits:1,bits between:1,DAC Indeed:1,Indeed I:1,am The:1,RAM puts:1,puts out:1,out 6:1,DAC takes:1,missing bits—bits:1,bits—bits 6:1,7 going:1,going into:1,the DAC—are:1,DAC—are supplied:1,register Attribute:1,register 14H:1,14H This:1,implications In:1,modes pixel:1,EGA palette:1,RAM translates:1,translates into:1,attributes Normally:1,Normally those:1,those 64:1,attributes look:1,up colors:1,from registers:1,through 63:1,63 in:1,DAC because:1,because bits:1,both zero:1,zero By:1,By changing:1,other 64:1,64 color:1,sets can:1,selected instantly:1,instantly I’ll:1,of flipping:1,flipping through:1,through color:1,paging That’s:1,That’s interesting:1,but frankly:1,seems somewhat:1,somewhat half-baked:1,half-baked why:1,bother expanding:1,expanding 16:1,attributes before:1,before looking:1,DAC What:1,What we’d:1,attributes straight:1,straight through:1,RAM without:1,without changing:1,changing them:1,and supply:1,upper 4:1,bits going:1,register giving:1,us 16:1,color pages:1,pages As:1,happens all:1,happen is:1,register register:1,1 Once:1,done bits:1,register go:1,to bits:1,4 through:1,through 7:1,only bits:1,3 through:1,through 0:1,0 coming:1,used bits:1,5 from:1,ignored In:1,RAM effectively:1,effectively contains:1,contains 4-bit:1,4-bit rather:1,than 6-bit:1,6-bit registers:1,RAM will:1,pass pixel:1,values through:1,unchanged by:1,having register:1,a configuration:1,configuration in:1,upper two:1,same zero:1,therefore irrelevant:1,irrelevant As:1,you’ll generally:1,generally want:1,this pass-through:1,state when:1,color whether:1,using color:1,paging or:1,not Why:1,state It’s:1,idea because:1,to EGA-compatible:1,EGA-compatible settings:1,first 64:1,64 DAC:1,are programmed:1,display during:1,during mode:1,sets for:1,for 16-color:1,EGA programs:1,it’s useless:1,useless if:1,to tinker:1,VGA’s colors:1,colors As:1,programmer you:1,turn it:1,an 18-bit:1,18-bit RGB:1,value you:1,to pass-through:1,values effectively:1,takes it:1,the circuit:1,circuit and:1,and simplifies:1,simplifies life:1,life something:1,something wonderful:1,wonderful The:1,RAM exists:1,exists solely:1,solely for:1,for EGA:1,compatibility and:1,and serves:1,useful purpose:1,purpose that:1,of for:1,for VGA-only:1,VGA-only color:1,color programming:1,programming 256-Color:1,Mode So:1,I’ve spoken:1,spoken only:1,modes what:1,what of:1,rule in:1,is Don’t:1,Don’t tinker:1,palette Period:1,Period You:1,select any:1,any colors:1,colors you:1,want by:1,by reprogramming:1,guarantee as:1,you mess:1,mess around:1,RAM There’s:1,benefit that:1,to changing:1,RAM in:1,effect may:1,may vary:1,don’t do:1,know something:1,don’t On:1,hand feel:1,settings to:1,settings can:1,displayed simultaneously:1,simultaneously By:1,bits sent:1,sent from:1,DAC come:1,paging in:1,mode Of:1,mode Setting:1,programmed either:1,through BIOS:1,10H I:1,interrupt a:1,clone BIOS:1,with genuine:1,IBM silicon:1,silicon Such:1,Such incompatibilities:1,incompatibilities could:1,could include:1,include anything:1,anything from:1,from flicker:1,flicker to:1,to trashing:1,trashing the:1,or they:1,not exist:1,exist at:1,why find:1,hard way:1,way My:1,My policy:1,policy is:1,BIOS unless:1,clear reason:1,reason not:1,so and:1,such reason:1,of in:1,case When:1,programming specifically:1,RAM needs:1,the pass-through:1,values 0:1,15 in:1,15 Setting:1,entire palette:1,accomplished easily:1,enough with:1,with subfunction:1,2 AL:1,AL 2:1,10H A:1,subfunction sets:1,sets all:1,17 bytes:1,bytes pointed:1,by ESDX:1,ESDX with:1,with ESDX:1,ESDX pointing:1,0 ESDX:1,ESDX 1:1,1 pointing:1,to ESDX:1,ESDX 16:1,16 which:1,overscan value:1,value The:1,registers store:1,store 6:1,each so:1,first 16:1,the 17-byte:1,17-byte block:1,block are:1,are significant:1,significant The:1,The Overscan:1,specifies what’s:1,what’s displayed:1,displayed between:1,screen that’s:1,that’s controlled:1,the blanked:1,blanked region:1,region at:1,however Alternatively:1,Alternatively any:1,0 AL:1,AL 0:1,10H For:1,subfunction BL:1,of BH:1,BH contain:1,register Having:1,let’s leave:1,RAM behind:1,behind presumably:1,presumably in:1,DAC which:1,right place:1,do color:1,VGA Setting:1,DAC Like:1,RAM the:1,set either:1,BIOS Again:1,complications here:1,that varying:1,varying degrees:1,screen bounce:1,bounce occur:1,VGAs when:1,BIOS That’s:1,then left:1,left that:1,33.1 which:1,changed rapidly:1,rapidly cycled:1,cycled to:1,produce on-screen:1,as rippling:1,rippling colors:1,colors My:1,My limited:1,limited experience:1,colors cleanly:1,cleanly although:1,although input:1,readers who:1,worked extensively:1,extensively with:1,welcome At:1,BIOS DAC-setting:1,DAC-setting functions:1,functions next:1,next Later:1,Later I’ll:1,an upcoming:1,upcoming chapter:1,discuss color:1,cycling An:1,An individual:1,individual DAC:1,by interrupt:1,AH 10:1,10 subfunction:1,subfunction 10H:1,10H AL:1,AL 10H:1,with BX:1,BX indicating:1,set stored:1,in DH:1,DH 6-bit:1,component CH:1,CH 6-bit:1,and CL:1,CL 6-bit:1,component A:1,A block:1,of sequential:1,sequential DAC:1,registers ranging:1,ranging in:1,size from:1,register up:1,256 can:1,12H AL:1,10H In:1,case BX:1,BX contains:1,CX contains:1,and ESDX:1,ESDX contains:1,color entries:1,entries to:1,which DAC:1,registers BX:1,BX through:1,BX CX-1:1,CX-1 are:1,color entry:1,entry for:1,register consists:1,third byte:1,component as:1,33.1 If:1,If You:1,You Can’t:1,Can’t Call:1,Call the:1,BIOS Who:1,Who Ya:1,Ya Gonna:1,Gonna Call:1,Call Although:1,registers should:1,BIOS whenever:1,possible there:1,choice or:1,choice at:1,a protected-mode:1,protected-mode program:1,have access:1,BIOS Also:1,earlier it:1,directly when:1,performing color:1,cycling Therefore:1,Therefore I’ll:1,CD-ROM I’ll:1,discuss programming:1,are Attribute:1,15 They:1,first reading:1,or 3BAH:1,monochrome mode:1,Controller toggle:1,toggle to:1,mode then:1,loaded Do:1,you normally:1,rather set:1,0 Setting:1,0 allows:1,allows values:1,also causes:1,blank so:1,should wait:1,loading palette:1,registers if:1,flicker Do:1,BIOS Then:1,Then write:1,desired register:1,3C0H which:1,now toggled:1,toggled to:1,Controller Data:1,register Write:1,Write any:1,additional register:1,register number/register:1,number/register data:1,data pairs:1,3C0H then:1,write 20H:1,20H to:1,3C0H to:1,to unblank:1,unblank the:1,registers depends:1,proper sequence:1,sequence being:1,being followed:1,followed if:1,or index/data:1,toggle data:1,gets changed:1,process you’ll:1,probably end:1,a hideous:1,hideous display:1,display or:1,no display:1,all Consequently:1,interrupts while:1,to prevent:1,prevent any:1,a TSR:1,TSR or:1,that alters:1,Controller in:1,3C8H then:1,writing three:1,three bytes—the:1,bytes—the 6-bit:1,that order—to:1,order—to the:1,3C9H The:1,then autoincrements:1,autoincrements so:1,write another:1,another three-byte:1,register it’ll:1,it’ll go:1,on indefinitely:1,indefinitely you:1,256 registers:1,sending 256*3:1,256*3 768:1,768 bytes:1,Data Register:1,Register Loading:1,as sequence-dependent:1,sequence-dependent and:1,potentially susceptible:1,to interference:1,interference as:1,is loading:1,palette so:1,so my:1,personal inclination:1,inclination is:1,of disabling:1,interrupts loading:1,a three-byte:1,value separately:1,register although:1,feature it:1,be least:1,least susceptible:1,to outside:1,outside influences:1,influences It:1,even better:1,entire duration:1,register loading:1,loading but:1,leave interrupts:1,off However:1,no hard:1,hard evidence:1,evidence to:1,offer in:1,in support:1,support of:1,my conservative:1,conservative approach:1,an uneasy:1,uneasy feeling:1,feeling so:1,hearing from:1,any readers:1,readers A:1,loading both:1,registers involves:1,involves performing:1,performing multiple:1,multiple OUT:1,register Many:1,people whose:1,whose opinions:1,opinions I:1,I respect:1,respect recommend:1,recommend delaying:1,delaying between:1,port by:1,a JMP:1,2 jumping:1,jumping flushes:1,flushes the:1,and forces:1,forces a:1,memory access—or:1,access—or at:1,cache access—to:1,access—to fetch:1,people recommend:1,recommend two:1,two JMP:1,port and:1,three jumps:1,jumps between:1,port that:1,in opposite:1,opposite directions:1,directions OUT:1,OUT followed:1,by IN:1,IN or:1,or IN:1,IN followed:1,by OUT:1,OUT This:1,clearly necessary:1,necessary when:1,accessing some:1,some motherboard:1,chips but:1,how applicable:1,applicable it:1,so make:1,it what:1,will Input:1,Input from:1,from knowledgeable:1,knowledgeable readers:1,readers is:1,is eagerly:1,eagerly solicited:1,solicited In:1,meantime if:1,DAC do:1,potential complications:1,directly An:1,Example of:1,of Setting:1,DAC This:1,gotten about:1,as big:1,big as:1,chapter really:1,really ought:1,ought to:1,color saga:1,saga will:1,continue in:1,few Quickly:1,Quickly then:1,then Listing:1,simple example:1,that gives:1,the spectacular:1,spectacular effects:1,translation makes:1,possible There’s:1,complex about:1,33.1 it:1,just selects:1,selects 256-color:1,mode fills:1,with one-pixel-wide:1,one-pixel-wide concentric:1,concentric diamonds:1,diamonds drawn:1,with sequential:1,sequential attributes:1,blue Run:1,program I:1,stunning display:1,display this:1,this short:1,program produces:1,produces Clever:1,Clever color:1,color manipulation:1,manipulation is:1,produce truly:1,truly eye-catching:1,eye-catching effects:1,PC Note:1,the corners:1,33.1 This:1,This shows:1,how coarse:1,coarse the:1,13H actually:1,actually is:1,is Now:1,Now look:1,how smoothly:1,smoothly the:1,colors blend:1,how careful:1,careful color:1,can boost:1,boost perceived:1,perceived resolution:1,42 Finally:1,Finally note:1,screen turns:1,turns green:1,green when:1,33.1 reprograms:1,reprograms DAC:1,to green:1,border attribute:1,attribute in:1,register happens:1,border comes:1,out green:1,green even:1,register Normally:1,Normally attribute:1,black causing:1,border to:1,vanish but:1,border is:1,8-bit attribute:1,attribute that:1,as subject:1,to DAC:1,DAC color:1,translation as:1,not affected:1,we traced:1,traced the:1,complex path:1,path by:1,turns a:1,into RGB:1,RGB analog:1,signals headed:1,monitor In:1,and Chapter:1,CD-ROM we’ll:1,that plays:1,plays with:1,color We’ll:1,We’ll explore:1,explore in:1,we’ll observe:1,observe color:1,paging and:1,and cycling:1,cycling in:1,action Chapter:1,Chapter 34:1,34 Changing:1,Changing Colors:1,Colors without:1,without Writing:1,Pixels Special:1,Special Effects:1,Effects through:1,through Realtime:1,Realtime Manipulation:1,Manipulation of:1,DAC Colors:1,Colors Sometimes:1,Sometimes strange:1,strange as:1,seem the:1,the harder:1,harder you:1,less you:1,you accomplish:1,accomplish Brute:1,Brute force:1,force is:1,fine when:1,suffices but:1,always suffice:1,suffice and:1,not finesse:1,finesse and:1,and alternative:1,alternative approaches:1,called for:1,for Such:1,with rapidly:1,rapidly cycling:1,through colors:1,repeatedly loading:1,VGA’s Digital:1,Digital to:1,to Analog:1,Analog Converter:1,Converter DAC:1,DAC No:1,just can’t:1,can’t reliably:1,reliably load:1,whole DAC:1,DAC cleanly:1,cleanly in:1,best find:1,find other:1,colors What’s:1,more BIOS:1,BIOS support:1,for DAC:1,loading is:1,so inconsistent:1,inconsistent that:1,it’s unusable:1,unusable for:1,cycling direct:1,direct loading:1,loading through:1,the I/O:1,ports is:1,go We’ll:1,why next:1,next as:1,we explore:1,explore color:1,then finish:1,section by:1,by cleaning:1,cleaning up:1,some odds:1,odds and:1,ends about:1,about VGA:1,color There’s:1,about loading:1,let’s dive:1,complications lie:1,lie Color:1,Cycling As:1,in past:1,past chapters:1,chapters the:1,VGA’s DAC:1,256 storage:1,each holding:1,holding one:1,one 18-bit:1,18-bit value:1,value representing:1,representing an:1,color triplet:1,triplet organized:1,color Each:1,Each and:1,pixel generated:1,is fed:1,fed into:1,value refer:1,CD-ROM to:1,how pixels:1,pixels become:1,become 8-bit:1,each 8-bit:1,256 values:1,The looked-up:1,looked-up value:1,then converted:1,signals and:1,form one:1,pixel That’s:1,we’ve produced:1,produced some:1,pretty impressive:1,impressive color:1,then playing:1,playing with:1,8-bit path:1,path into:1,DAC Now:1,generate color:1,by dynamically:1,call color:1,cycling should:1,obvious Smooth:1,Smooth motion:1,motion can:1,be simulated:1,simulated by:1,an appropriate:1,appropriate pattern:1,be produced:1,produced without:1,altering a:1,a sunset:1,sunset can:1,and darken:1,darken by:1,locations containing:1,the sunset:1,sunset or:1,a river:1,river can:1,to flow:1,flow by:1,river Another:1,Another use:1,in providing:1,providing more:1,realistic displays:1,displays for:1,applications like:1,like realtime:1,games where:1,like many:1,settings from:1,color demands:1,demands of:1,the rendered:1,rendered scene:1,scene Which:1,we load:1,DAC smoothly:1,smoothly in:1,realtime Actually:1,Actually so:1,know you:1,can’t At:1,can’t load:1,entire DAC—all:1,DAC—all 256:1,256 locations—frame:1,locations—frame after:1,after frame:1,frame without:1,producing distressing:1,distressing on-screen:1,In non-256:1,modes it:1,DAC quickly:1,quickly enough:1,all displayed:1,displayed colors:1,are 16:1,16 or:1,or fewer:1,fewer so:1,cycling could:1,used successfully:1,successfully to:1,all colors:1,such modes:1,modes On:1,hand color:1,paging which:1,which flips:1,flips among:1,among a:1,sets stored:1,CD-ROM can:1,produce many:1,considerably simpler:1,more reliable:1,reliable then:1,then color:1,cycling so:1,generally superior:1,cycling whenever:1,whenever it’s:1,it’s available:1,available In:1,the method:1,for dynamic:1,dynamic color:1,effects only:1,256-color mode—but:1,mode—but regrettably:1,regrettably color:1,its least:1,least reliable:1,reliable and:1,and capable:1,capable in:1,The Heart:1,the Problem:1,Problem Here’s:1,with loading:1,repeatedly The:1,color storage:1,each loaded:1,loaded via:1,either 3:1,4 OUT:1,instructions more:1,that next:1,least 768:1,DAC That:1,That many:1,s take:1,are painfully:1,Pentiums and:1,frequently on:1,the ISA:1,bus although:1,although VLB:1,PCI are:1,are increasingly:1,increasingly common:1,common where:1,inserted in:1,fast computers:1,AT 768:1,s alone:1,take 288:1,288 microseconds:1,data loading:1,loading and:1,looping that:1,take in:1,ballpark of:1,of 1800:1,1800 microseconds:1,microseconds more:1,2 milliseconds:1,milliseconds total:1,total As:1,DAC should:1,loaded during:1,blanking that:1,bottom border:1,border and:1,top border:1,when no:1,no video:1,video information:1,being sent:1,DAC Otherwise:1,Otherwise small:1,small dots:1,dots of:1,of snow:1,snow appear:1,an occasional:1,occasional dot:1,dot of:1,sort wouldn’t:1,the constant:1,constant DAC:1,loading required:1,by color:1,cycling would:1,a veritable:1,veritable snowstorm:1,snowstorm on:1,screen By:1,mean border:1,border not:1,not frame:1,overscan pixels:1,pixels pass:1,even load:1,displayed without:1,without getting:1,getting snow:1,blanking itself:1,detect via:1,via bit:1,active Conveniently:1,pulse starts:1,starts partway:1,partway through:1,too far:1,far into:1,into vertical:1,blanking so:1,it serves:1,handy way:1,DAC without:1,producing snow:1,snow on:1,we wait:1,pulse then:1,then begin:1,DAC There’s:1,catch though:1,On many:1,many computers—Pentiums:1,computers—Pentiums 486s:1,and 386s:1,386s sometimes:1,sometimes 286s:1,286s most:1,and 8088s:1,8088s all:1,the time—there:1,time—there just:1,enough time:1,pulse and:1,blanking to:1,locations That’s:1,the crux:1,crux of:1,and shortly:1,shortly we’ll:1,you explore:1,explore for:1,yourself the:1,interested First:1,must address:1,address another:1,another DAC:1,loading problem:1,BIOS Loading:1,DAC via:1,BIOS The:1,loaded either:1,through subfunctions:1,subfunctions 10H:1,10H for:1,or 12H:1,video service:1,service interrupt:1,10H described:1,33 For:1,For cycling:1,the block-load:1,block-load function:1,function invoked:1,executing INT:1,and AL:1,CX DAC:1,locations starting:1,at location:1,location BX:1,BX from:1,RGB triplets—3:1,triplets—3 bytes:1,per triplet—starting:1,triplet—starting at:1,at ESDX:1,ESDX into:1,DAC would:1,better of:1,two due:1,BIOS once:1,times At:1,rate we’d:1,use one:1,cycling because:1,possible one:1,to accessing:1,accessing hardware:1,of avoiding:1,avoiding compatibility:1,compatibility problems:1,cycling however:1,is emphatically:1,emphatically not:1,have problems:1,problems Serious:1,Serious problems:1,difficulty is:1,this IBM’s:1,IBM’s BIOS:1,BIOS specification:1,specification describes:1,describes exactly:1,parameters passed:1,BIOS control:1,all clone:1,clone BIOSes:1,BIOSes meet:1,meet that:1,that specification:1,specification scrupulously:1,scrupulously which:1,you invoke:1,invoke INT:1,given set:1,of parameters:1,parameters you:1,values loaded:1,same DAC:1,locations on:1,all vendors:1,vendors IBM’s:1,IBM’s spec:1,spec does:1,however describe:1,describe whether:1,whether vertical:1,retrace should:1,be waited:1,for before:1,DAC nor:1,it mention:1,mention whether:1,whether video:1,video should:1,enabled while:1,DAC leaving:1,leaving cloners:1,cloners to:1,choose whatever:1,whatever approach:1,approach they:1,they desire—and:1,desire—and alas:1,alas every:1,VGA cloner:1,cloner seems:1,tested four:1,four clone:1,manufacturers some:1,machine and:1,286 machine:1,machine Two:1,four waited:1,DAC two:1,two didn’t:1,didn’t Two:1,four blanked:1,blanked the:1,display while:1,DAC resulting:1,in flickering:1,flickering bars:1,bars across:1,screen One:1,One showed:1,showed speckled:1,speckled pixels:1,pixels spattered:1,spattered across:1,DAC was:1,loaded Also:1,Also not:1,without showing:1,showing some:1,the BIOS’s:1,BIOS’s fault:1,fault it’s:1,problem endemic:1,endemic to:1,VGA These:1,These findings:1,findings lead:1,lead me:1,me inexorably:1,inexorably to:1,DAC dynamically:1,dynamically That:1,graphics session—sort:1,session—sort of:1,DAC mode:1,mode set—by:1,set—by all:1,means load:1,load by:1,BIOS No:1,some garbage:1,frame heck:1,heck I:1,have boards:1,boards that:1,that bounce:1,bounce and:1,show garbage:1,garbage every:1,garbage produced:1,less noticeable:1,noticeable If:1,repeatedly for:1,cycling avoid:1,DAC load:1,load functions:1,functions like:1,plague They:1,They will:1,will bring:1,only heartache:1,heartache As:1,As but:1,the unsuitability:1,unsuitability of:1,BIOS DAC-loading:1,DAC-loading functions:1,cycling imagine:1,colors 70:1,second which:1,accomplish that:1,normally wait:1,sync signal:1,signal marking:1,DAC On:1,On some:1,some boards—boards:1,boards—boards with:1,with BIOSes:1,BIOSes that:1,don’t wait:1,the DAC—that:1,DAC—that will:1,work pretty:1,well you:1,will in:1,fact load:1,frame On:1,On other:1,other boards:1,boards however:1,very poorly:1,poorly indeed:1,indeed your:1,BIOS will:1,sync with:1,result being:1,DAC gets:1,gets loaded:1,frames Sadly:1,Sadly there’s:1,way short:1,actually profiling:1,profiling the:1,DAC loads:1,loads for:1,which sort:1,installed in:1,particular computer:1,so unless:1,always control:1,the brand:1,brand of:1,VGA your:1,software will:1,really can’t:1,BIOS Which:1,directly is:1,a picnic:1,picnic either:1,either as:1,next Loading:1,DAC Directly:1,Directly So:1,must load:1,perform color:1,loaded directly:1,sending with:1,loaded to:1,3C8H and:1,performing three:1,three OUT:1,3C9H This:1,approach must:1,be repeated:1,repeated 256:1,DAC requiring:1,requiring over:1,thousand OUT:1,all There:1,another somewhat:1,its risks:1,risks After:1,After an:1,register automatically:1,automatically increments:1,this repeats:1,repeats indefinitely:1,indefinitely as:1,as successive:1,successive RGB:1,triplets are:1,DAC By:1,By taking:1,this feature:1,just 769:1,769 OUT:1,s one:1,and 768:1,register So:1,So what’s:1,the drawback:1,drawback Well:1,Well imagine:1,DAC an:1,an interrupt-driven:1,interrupt-driven TSR:1,TSR such:1,program switcher:1,switcher or:1,or multitasker:1,multitasker activates:1,activates and:1,DAC you:1,a mess:1,mess on:1,screen especially:1,program resumes:1,resumes and:1,continues writing:1,the DAC—but:1,DAC—but in:1,all likelihood:1,likelihood to:1,wrong locations:1,locations No:1,problem you:1,say just:1,just disable:1,duration Good:1,Good idea—but:1,idea—but it:1,DAC than:1,than interrupts:1,interrupts should:1,for If:1,separately you:1,can disable:1,interrupts 256:1,times once:1,loaded without:1,problems As:1,commented in:1,any gruesome:1,gruesome tale:1,tale to:1,that mandates:1,mandates taking:1,slower but:1,but safer:1,safer road:1,separately while:1,while interrupts:1,disabled I’m:1,I’m merely:1,merely hypothesizing:1,hypothesizing as:1,what ghastly:1,ghastly mishaps:1,mishaps could:1,could happen:1,happen However:1,that anything:1,PC does:1,happen eventually:1,eventually there:1,too dang:1,dang many:1,many PCs:1,PCs out:1,there for:1,be otherwise:1,otherwise However:1,However load:1,DAC any:1,like just:1,me if:1,call from:1,from someone:1,someone who’s:1,who’s claims:1,claims that:1,program sometimes:1,sometimes turns:1,turns their:1,their screen:1,into something:1,something resembling:1,resembling month-old:1,month-old yogurt:1,yogurt It’s:1,really your:1,your fault:1,fault of:1,of course—but:1,course—but try:1,try explaining:1,explaining that:1,A Test:1,Test Program:1,Program for:1,Cycling Anyway:1,Anyway the:1,yours Given:1,not providing:1,providing you:1,any hard-and-fast:1,hard-and-fast rules:1,rules mainly:1,there don’t:1,don’t seem:1,any what:1,tool so:1,can experiment:1,with various:1,what you’ll:1,34.1 Listing:1,34.1 draws:1,a band:1,band of:1,lines each:1,pixel wide:1,wide across:1,The attribute:1,attribute of:1,one greater:1,preceding line:1,of attributes:1,attributes from:1,Once everything:1,program starts:1,starts cycling:1,colors stored:1,are specified:1,the CYCLE_SIZE:1,CYCLE_SIZE equate:1,equate as:1,cycled Actually:1,Actually CYCLE_SIZE:1,CYCLE_SIZE 1:1,1 locations:1,are cycled:1,cycled because:1,because location:1,kept constant:1,constant in:1,background and:1,and border:1,border colors:1,changing but:1,but CYCLE_SIZE:1,CYCLE_SIZE locations:1,of locations:1,locations we:1,can load:1,load without:1,in The:1,big question:1,does Listing:1,34.1 cycle:1,colors Via:1,Via the:1,or directly:1,directly With:1,With interrupts:1,enabled or:1,or disabled:1,disabled Et:1,Et cetera:1,cetera However:1,like actually:1,actually Four:1,Four equates:1,equates at:1,34.1 select:1,cycling performed:1,changing these:1,these equates:1,equates and:1,and CYCLE_SIZE:1,CYCLE_SIZE you:1,well various:1,cycling work:1,whatever combination:1,computer system:1,test The:1,The USE_BIOS:1,USE_BIOS equate:1,Set USE_BIOS:1,USE_BIOS to:1,DAC through:1,the block-load-DAC:1,block-load-DAC BIOS:1,s If:1,other equate:1,equate of:1,is WAIT_VSYNC:1,WAIT_VSYNC If:1,If WAIT_VSYNC:1,DAC if:1,if WAIT_VSYNC:1,program doesn’t:1,doesn’t wait:1,wait before:1,loading The:1,setting or:1,not setting:1,setting WAIT_VSYNC:1,WAIT_VSYNC depends:1,BIOS of:1,on waits:1,DAC You:1,a double:1,double wait:1,wait causing:1,causing color:1,to proceed:1,at half:1,wait at:1,all causing:1,causing cycling:1,occur far:1,too rapidly:1,rapidly and:1,certainly with:1,with hideous:1,hideous on-screen:1,actually end:1,up cycling:1,cycling at:1,proper one-cycle-per-frame:1,one-cycle-per-frame rate:1,rate If:1,0 WAIT_VSYNC:1,WAIT_VSYNC still:1,still applies:1,applies However:1,always want:1,set WAIT_VSYNC:1,WAIT_VSYNC to:1,when USE_BIOS:1,0 otherwise:1,otherwise cycling:1,cycling will:1,of continuous:1,continuous on-screen:1,on-screen garbage:1,make itself:1,itself evident:1,evident as:1,program loads:1,DAC non-stop:1,non-stop If:1,0 GUARD_AGAINST_INTS:1,GUARD_AGAINST_INTS determines:1,process being:1,being interrupted:1,interrupted is:1,is guarded:1,guarded against:1,against by:1,write index:1,index once:1,location loaded:1,the DAC’s:1,DAC’s autoincrementing:1,is relied:1,upon or:1,not If:1,If GUARD_AGAINST_INTS:1,sequence is:1,followed for:1,turn Interrupts:1,Interrupts are:1,set appropriately:1,appropriately the:1,triplet for:1,enabled This:1,but safe:1,safe approach:1,earlier Matters:1,Matters get:1,get still:1,if GUARD_AGAINST_INTS:1,0 In:1,if NOT_8088:1,an autoincrementing:1,autoincrementing load:1,load is:1,fashion the:1,first location:1,load and:1,DAC by:1,three LODSB/OUT:1,LODSB/OUT DXAL:1,DXAL pairs:1,LOOP repeating:1,the locations:1,turn If:1,however NOT_8088:1,better perhaps:1,perhaps AT_LEAST_286:1,AT_LEAST_286 would:1,better name:1,name then:1,initial DAC:1,Index value:1,all 768:1,768 DAC:1,OUTSB This:1,fastest approach:1,risk albeit:1,albeit remote:1,remote that:1,sequence will:1,interrupted and:1,registers will:1,become garbled:1,garbled My:1,My own:1,own experience:1,34.1 indicates:1,256 locations:1,cleanly but:1,but sometimes:1,bus speed:1,as whether:1,whether autoincrementation:1,autoincrementation and:1,OUTSB are:1,used I’m:1,to report:1,report how:1,locations I:1,successfully load:1,load with:1,enough data:1,data points:1,make reliable:1,reliable suggestions:1,suggestions and:1,you acting:1,my comments:1,into trouble:1,trouble down:1,pike You:1,a versatile:1,versatile tool:1,to probe:1,probe the:1,approaches use:1,perform your:1,own tests:1,tests on:1,slowest hardware:1,hardware configurations:1,configurations you:1,expect your:1,then leave:1,a generous:1,generous safety:1,margin One:1,One thing’s:1,thing’s for:1,sure though—you’re:1,though—you’re not:1,cleanly once:1,reliable basis:1,basis across:1,of PCs:1,PCs That’s:1,that brute:1,force isn’t:1,isn’t appropriate:1,appropriate to:1,cycling That:1,cycling can’t:1,used just:1,that subtler:1,subtler approaches:1,approaches must:1,be employed:1,employed Let’s:1,those alternatives:1,alternatives Color:1,Cycling Approaches:1,Approaches that:1,that Work:1,Work First:1,when color:1,cycling does:1,work it’s:1,beauty Assemble:1,Assemble Listing:1,34.1 so:1,doesn’t use:1,DAC doesn’t:1,doesn’t guard:1,uses 286-specific:1,computer supports:1,supports them:1,them Then:1,Then tinker:1,with CYCLE_SIZE:1,CYCLE_SIZE until:1,perfectly clean:1,clean on:1,computer Color:1,cycling looks:1,looks stunningly:1,stunningly smooth:1,smooth doesn’t:1,And this:1,is crude:1,crude color:1,cycling working:1,set switch:1,switch over:1,that gradually:1,gradually works:1,works its:1,through various:1,various hues:1,hues and:1,and saturations:1,saturations and:1,get something:1,looks for:1,world like:1,like true-color:1,true-color animation:1,animation albeit:1,albeit working:1,full spectrum:1,spectrum at:1,time Given:1,that how:1,cycling within:1,simplest approach:1,favorite is:1,of cycling:1,cycling a:1,other non-cycling:1,non-cycling purposes:1,might allocate:1,allocate 32:1,32 DAC:1,aforementioned sunset:1,sunset reserve:1,reserve 160:1,160 additional:1,additional locations:1,static mountain:1,mountain scene:1,and employ:1,remaining 64:1,64 locations:1,planes cars:1,foreground The:1,The 32:1,32 sunset:1,sunset colors:1,cycled cleanly:1,cleanly and:1,other 224:1,224 colors:1,colors would:1,would remain:1,or would:1,only occasionally:1,occasionally That:1,That suggests:1,suggests a:1,second possibility:1,possibility If:1,have several:1,sets to:1,cycled interleave:1,interleave the:1,loading so:1,is cycled:1,cycled per:1,frame Suppose:1,are animating:1,animating a:1,a night:1,night scene:1,scene with:1,with stars:1,stars twinkling:1,twinkling in:1,background meteors:1,meteors streaking:1,streaking across:1,sky and:1,a spaceship:1,spaceship moving:1,moving across:1,its jets:1,jets flaring:1,flaring One:1,produce most:1,necessary effects:1,little effort:1,effort would:1,stars in:1,several attributes:1,attributes draw:1,the meteor:1,meteor paths:1,paths in:1,successive attributes:1,attributes one:1,jets The:1,only remaining:1,remaining task:1,task would:1,the spaceship:1,spaceship across:1,to getting:1,getting all:1,example however:1,however would:1,assign each:1,cycling task:1,different part:1,DAC with:1,part cycled:1,cycled independently:1,independently as:1,needed If:1,If as:1,likely the:1,locations cycled:1,cycled proved:1,great to:1,manage in:1,frame you:1,simply cycle:1,stars after:1,the meteors:1,meteors after:1,jets after:1,after yet:1,another frame:1,to cycling:1,stars By:1,By splitting:1,splitting up:1,manner and:1,and interleaving:1,the cycling:1,cycling tasks:1,seemingly complex:1,complex color:1,color animation:1,animation without:1,without loading:1,loading very:1,frame Yet:1,and somewhat:1,somewhat odder:1,odder workaround:1,only 128:1,128 DAC:1,flipping Page:1,modes involves:1,involves using:1,modes see:1,31 43:1,43 and:1,and 47:1,47 for:1,details In:1,operation you’d:1,you’d first:1,first display:1,drawn entirely:1,entirely with:1,with colors:1,0-127 Then:1,Then you’d:1,you’d draw:1,draw page:1,look just:1,like page:1,0 except:1,that colors:1,colors 128-255:1,128-255 are:1,instead You’d:1,You’d load:1,locations 128-255:1,128-255 with:1,the 128:1,colors you’re:1,using then:1,then you’d:1,you’d switch:1,page with:1,colors Then:1,needed drawing:1,0-127 load:1,locations 0-127:1,0-127 with:1,next color:1,those DAC:1,not used:1,display any:1,current screen:1,generate garbage:1,modifying undisplayed:1,undisplayed DAC:1,fact you:1,a spot:1,interference will:1,location displayed:1,displayed or:1,not during:1,load only:1,blanking before:1,DAC when:1,when page:1,flipping with:1,with 128:1,since none:1,locations you’re:1,you’re modifying:1,modifying is:1,displayed you:1,can spread:1,loading out:1,more vertical:1,blanking periods—however:1,periods—however long:1,takes If:1,the 128-color:1,128-color page:1,get odd:1,odd on-screen:1,as some:1,colors changed:1,frame some:1,some after:1,so on—or:1,on—or you:1,not changing:1,chunks over:1,frames is:1,possibility worth:1,considering Yet:1,blanking period:1,period Combine:1,Combine that:1,with counting:1,counting scan:1,could vastly:1,vastly expand:1,expand the:1,of simultaneous:1,simultaneous on-screen:1,on-screen colors:1,cycling colors:1,displayed so:1,set changes:1,from scan:1,The possibilities:1,possibilities are:1,are endless:1,endless However:1,However were:1,were I:1,be writing:1,writing 256-color:1,256-color software:1,used color:1,cycling I’d:1,I’d find:1,cycled after:1,slowest computer:1,computer I:1,on I’d:1,I’d lop:1,lop off:1,least 10:1,a safety:1,margin and:1,I’d structure:1,structure my:1,cycling set:1,set exceeded:1,exceeded that:1,size interleaving:1,interleaving several:1,several color:1,cycling sets:1,sets if:1,necessary That’s:1,what I’d:1,I’d do:1,do Don’t:1,be held:1,held back:1,back by:1,my limited:1,limited imagination:1,imagination though:1,though Color:1,cycling may:1,complicated of:1,control techniques:1,powerful Odds:1,Ends In:1,experience when:1,when relying:1,feature while:1,the Write:1,register wraps:1,wraps back:1,from 255:1,255 to:1,likewise when:1,BIOS So:1,a characteristic:1,consistent also:1,also Richard:1,Wilton documents:1,documents this:1,this behavior:1,behavior for:1,VGA bible:1,bible Programmer’s:1,Systems Second:1,Edition Microsoft:1,Press so:1,that DAC:1,DAC index:1,index wrapping:1,especially useful:1,your resources:1,resources behave:1,behave and:1,might come:1,serviceable application:1,particular quirk:1,quirk The:1,Mask There’s:1,haven’t mentioned:1,mentioned yet:1,at 03C6H:1,03C6H The:1,this register:1,but powerful:1,powerful it:1,can mask:1,information coming:1,VGA Whenever:1,in looking:1,screen Whenever:1,corresponding pixel:1,all look-ups:1,look-ups of:1,triplets At:1,extreme a:1,ignored so:1,so DAC:1,is looked:1,makes setting:1,screen Reading:1,Reading the:1,read directly:1,at 3C7H:1,3C7H and:1,3C9H in:1,written directly:1,Index register—complete:1,register—complete with:1,with autoincrementing:1,autoincrementing the:1,after every:1,every three:1,three reads:1,reads Everything:1,Everything I’ve:1,about writing:1,DAC applies:1,DAC In:1,fact reading:1,even cause:1,cause snow:1,snow just:1,as loading:1,DAC does:1,blanking The:1,ways INT:1,subfunction 15H:1,15H AL:1,AL 15H:1,15H reads:1,BX this:1,function returns:1,triplet stored:1,of DH:1,DH the:1,of CH:1,CH and:1,of CL:1,CL INT:1,subfunction 17H:1,17H AL:1,AL 17H:1,17H reads:1,of length:1,length CX:1,CX starting:1,BX ESDX:1,ESDX must:1,must point:1,RGB values:1,specified block:1,The form:1,this buffer:1,buffer RGB:1,RGB with:1,per RGB:1,RGB triple:1,triple is:1,buffer used:1,34.1 illustrates:1,DAC both:1,both through:1,BIOS block-read:1,block-read function:1,the direct-read:1,direct-read code:1,code capable:1,of conditionally:1,conditionally assembling:1,assembling to:1,either guard:1,interrupts or:1,REP INSB:1,INSB or:1,not As:1,see reading:1,much symmetric:1,symmetric with:1,with setting:1,DAC Cycling:1,Cycling Down:1,Down And:1,control on:1,been more:1,anyone might:1,have imagined:1,has also:1,also been:1,been most:1,rewarding There’s:1,There’s as:1,much obscure:1,obscure but:1,real potential:1,control as:1,is anywhere:1,very great:1,potential indeed:1,indeed Put:1,Put color:1,cycling or:1,or color:1,paging together:1,drawing techniques:1,techniques explored:1,explored elsewhere:1,you’ll leave:1,the audience:1,audience gasping:1,gasping and:1,and wondering:1,wondering How:1,heck did:1,did they:1,that Chapter:1,35 Bresenham:1,Bresenham Is:1,Fast and:1,Is Good:1,Good Implementing:1,Implementing and:1,and Optimizing:1,Optimizing Bresenham’s:1,Algorithm For:1,graphics design:1,programming surprisingly:1,surprisingly few:1,few primitive:1,primitive functions:1,functions lie:1,software Heavily:1,Heavily used:1,used primitives:1,primitives include:1,include routines:1,draw dots:1,dots circles:1,circles area:1,area fills:1,fills bit:1,bit block:1,block logical:1,logical transfers:1,transfers and:1,course lines:1,lines For:1,years computer:1,graphics were:1,created primarily:1,primarily with:1,with specialized:1,specialized line-drawing:1,the lingua:1,graphics Lines:1,Lines are:1,microcomputer graphics:1,graphics applications:1,applications today:1,today notably:1,notably CAD/CAM:1,CAD/CAM and:1,and computer-aided:1,computer-aided engineering:1,engineering Probably:1,Probably the:1,the best-known:1,best-known formula:1,computer display:1,called Bresenham’s:1,algorithm We:1,be specific:1,specific here:1,a less-well-known:1,less-well-known Bresenham’s:1,Bresenham’s circle-drawing:1,circle-drawing algorithm:1,algorithm In:1,present two:1,implementations for:1,provides decent:1,decent line:1,and excellent:1,excellent drawing:1,in rather:1,rather plain:1,plain C:1,in not-so-plain:1,not-so-plain assembly:1,both pretty:1,is damned:1,damned good:1,fact but:1,fastest Bresenham’s:1,Bresenham’s implementation:1,implementation possible:1,must tell:1,isn’t First:1,bit by:1,shuffling and:1,various error-term:1,error-term manipulations:1,manipulations but:1,truly cryptic:1,cryptic code:1,wanted you:1,relate the:1,original algorithm:1,final code:1,I skipped:1,skipped those:1,those optimizations:1,optimizations Also:1,Also write:1,for considerably:1,drawing I’ve:1,described write:1,recommend its:1,in VGA-only:1,VGA-only line:1,drawing Second:1,Second horizontal:1,be special-cased:1,special-cased since:1,lines require:1,require little:1,drawn very:1,rapidly This:1,drawn 8:1,time Third:1,Third run-length:1,to significantly:1,of calculations:1,calculations required:1,demonstrate in:1,chapters Finally:1,Finally unrolled:1,loops and/or:1,and/or duplicated:1,duplicated code:1,final assembly:1,because x86:1,at branching:1,branching that:1,make quite:1,in unrolled:1,and similar:1,similar assembly:1,assembly techniques:1,techniques I:1,book That:1,point Even:1,were further:1,implementation I’d:1,I’d assume:1,were As:1,the experienced:1,experienced assembly:1,programmers among:1,among you:1,tackle any:1,and someone:1,else always:1,always seems:1,trick that:1,you I’ve:1,I’ve incorporated:1,incorporated a:1,a suggestion:1,suggestion made:1,Mackraz in:1,other tricks:1,tricks or:1,or tips:1,tips you:1,have Notwithstanding:1,Notwithstanding the:1,plenty fast:1,purposes so:1,discussion underway:1,underway The:1,The Task:1,Task at:1,at Hand:1,Hand There:1,important characteristics:1,any line-drawing:1,reasonable approximation:1,A computer:1,must actually:1,actually approximate:1,approximate a:1,straight line:1,generally proceeds:1,proceeds in:1,desired direction:1,direction That:1,That pattern:1,must reliably:1,reliably suggest:1,suggest to:1,eye the:1,it represents:1,represents Second:1,Second to:1,be usable:1,usable a:1,fast Minicomputers:1,Minicomputers and:1,and mainframes:1,mainframes generally:1,have hardware:1,performs line:1,drawing but:1,most microcomputers:1,microcomputers offer:1,offer no:1,such assistance:1,assistance True:1,True nowadays:1,nowadays graphics:1,the S3:1,S3 and:1,and ATI:1,ATI chips:1,chips have:1,have line:1,drawing hardware:1,other accelerators:1,don’t when:1,latter sort:1,of chip:1,chip when:1,drawing sorts:1,not supported:1,by line-drawing:1,PC’s CPU:1,many users:1,users of:1,of graphics-oriented:1,graphics-oriented software:1,software know:1,slow process:1,process indeed:1,indeed Line:1,speed derive:1,derive from:1,factors The:1,that algorithm:1,C that:1,chapter illustrates:1,good rate:1,second implementation:1,and callable:1,callable directly:1,from Borland:1,C draws:1,at extremely:1,extremely high:1,to six:1,version Between:1,Between them:1,implementations illuminate:1,illuminate Bresenham’s:1,and provide:1,provide high-performance:1,high-performance line-drawing:1,line-drawing capability:1,difficulty in:1,line lies:1,reasonable facsimile:1,facsimile of:1,line Only:1,Only horizontal:1,and 11:1,11 diagonal:1,drawn precisely:1,precisely along:1,being represented:1,represented all:1,lines must:1,be approximated:1,approximated from:1,given video:1,supports as:1,35.1 Considerable:1,Considerable thought:1,thought has:1,gone into:1,of line-drawing:1,drawing high-quality:1,high-quality lines:1,developed Unfortunately:1,Unfortunately most:1,these techniques:1,techniques were:1,were developed:1,for powerful:1,powerful expensive:1,expensive graphics:1,graphics workstations:1,workstations and:1,resolution a:1,large color:1,palette and/or:1,and/or floating-point:1,floating-point hardware:1,hardware These:1,These techniques:1,techniques tend:1,perform poorly:1,poorly and:1,and produce:1,produce less:1,less visually:1,visually impressive:1,results on:1,the best-endowed:1,best-endowed PCs:1,PCs Bresenham’s:1,is uniquely:1,to microcomputer:1,microcomputer implementation:1,operations no:1,divides and:1,no multiplies:1,multiplies inside:1,loop Moreover:1,Moreover it:1,with surprisingly:1,surprisingly little:1,code Bresenham’s:1,to grasping:1,grasping Bresenham’s:1,a finite-resolution:1,finite-resolution display:1,display each:1,will lie:1,lie either:1,either exactly:1,drawn deviates:1,point As:1,line progresses:1,error can:1,when given:1,accurate approximation:1,pixel one:1,unit of:1,resolution away:1,predecessor in:1,vertical direction:1,direction or:1,or both:1,both Figure:1,array Figure:1,array Let’s:1,line where:1,or X:1,X length:1,vertical or:1,Y length:1,both lengths:1,0 For:1,are drawing:1,from 00:1,to 52:1,52 as:1,35.2 Note:1,that Figure:1,35.2 shows:1,upper-left-hand corner:1,as 00:1,00 rather:1,than placing:1,placing 00:1,00 at:1,its more:1,more traditional:1,traditional lower-left-hand:1,lower-left-hand corner:1,corner location:1,location Due:1,PC’s graphics:1,within this:1,this framework:1,framework although:1,a translation:1,translation of:1,of Y:1,Y from:1,from increasing:1,increasing downward:1,downward to:1,to increasing:1,increasing upward:1,upward could:1,be effected:1,effected easily:1,simply subtracting:1,height minus:1,traditional coordinate:1,system feel:1,Listings 35.1:1,35.1 and:1,and 35.3:1,35.3 In:1,line fall:1,fall exactly:1,on displayed:1,pixels However:1,However no:1,line squarely:1,squarely intersects:1,pixel meaning:1,other pixels:1,pixels will:1,be plotted:1,plotted as:1,as approximations:1,approximations of:1,to approximation:1,approximation that:1,that Bresenham’s:1,algorithm takes:1,takes is:1,move exactly:1,drawn while:1,while moving:1,moving 1:1,dimension each:1,line moves:1,moves more:1,dimension In:1,dimension This:1,that 6:1,6 dots:1,dots one:1,coordinates 0:1,5 will:1,correct Y:1,to accompany:1,accompany those:1,those X:1,coordinates Figure:1,endpoints Figure:1,endpoints It’s:1,coordinates by:1,by eye:1,35.2 The:1,The appropriate:1,appropriate Y:1,2 2:1,2 based:1,coordinate closest:1,closest to:1,coordinate Bresenham’s:1,algorithm makes:1,same selections:1,selections based:1,same criterion:1,criterion The:1,The manner:1,running record:1,record of:1,the line—that:1,line—that is:1,coordinate is—at:1,is—at each:1,35.3 When:1,line indicates:1,coordinate deviates:1,coordinate would:1,be closer:1,coordinate Let’s:1,steps Bresenham’s:1,algorithm would:1,would go:1,at 00:1,00 the:1,line At:1,0 Since:1,Since X:1,dimension the:1,The Y:1,this pixel:1,be whichever:1,last Y:1,coordinate or:1,coordinate in:1,this X:1,is B:1,B minus:1,A as:1,35.3 This:1,This amount:1,amount is:1,1/2 that:1,coordinate so:1,coordinate does:1,change at:1,at X:1,X equal:1,1 Consequently:1,at 10:1,10 The:1,A which:1,1/2 and:1,therefore closer:1,next than:1,at 21:1,21 and:1,adjustment of:1,of 3:1,is E:1,E minus:1,coordinate doesn’t:1,at 31:1,31 The:1,is F:1,F minus:1,advances The:1,at 42:1,42 and:1,minus F:1,F Finally:1,sixth pixel:1,This pixel:1,5 The:1,minus G:1,G or:1,0 indicating:1,is squarely:1,point so:1,coordinate remains:1,at 52:1,52 and:1,complete That’s:1,closest possible:1,dimension The:1,dimension must:1,remain as:1,above description:1,dimension Y:1,dimensions are:1,zero is:1,readily generalized:1,generalized to:1,which lines:1,above discussion:1,discussion summarizes:1,summarizes the:1,nature rather:1,exact mechanism:1,brief seat-of-the-pants:1,seat-of-the-pants discussion:1,action when:1,full mathematical:1,mathematical treatment:1,treatment I:1,to pages:1,pages 433-436:1,433-436 of:1,Van Dam’s:1,Dam’s Fundamentals:1,Graphics Addison-Wesley:1,Addison-Wesley 1982:1,1982 or:1,or pages:1,pages 72-78:1,72-78 of:1,second edition:1,edition of:1,that book:1,was published:1,published under:1,name Computer:1,Practice Addison-Wesley:1,1990 These:1,These sources:1,sources provide:1,the integer-only:1,integer-only divide-free:1,divide-free version:1,as Pascal:1,possible octants:1,octants Strengths:1,Strengths and:1,and Weaknesses:1,Weaknesses The:1,The overwhelming:1,overwhelming strength:1,strength of:1,is speed:1,speed With:1,With no:1,divides no:1,for variables:1,perfectly suited:1,suited for:1,PCs The:1,The weakness:1,it produces:1,produces relatively:1,relatively low-quality:1,low-quality lines:1,lines by:1,other line-drawing:1,algorithms In:1,lines generated:1,algorithm can:1,can tend:1,little jagged:1,jagged On:1,however jagged:1,an inevitable:1,inevitable consequence:1,relatively low:1,low resolution:1,small color:1,algorithm don’t:1,look all:1,from lines:1,ways Besides:1,Besides in:1,applications users:1,users are:1,overall picture:1,picture than:1,the primitive:1,primitive elements:1,that picture:1,built As:1,general rule:1,rule any:1,any collection:1,that trend:1,trend from:1,from point:1,A to:1,point B:1,straight fashion:1,fashion is:1,line Bresenham’s:1,is successfully:1,successfully used:1,many current:1,current PC:1,this wide:1,wide acceptance:1,certainly good:1,enough Then:1,too users:1,users hate:1,hate waiting:1,their computer:1,drawing By:1,By any:1,performance Bresenham’s:1,algorithm excels:1,excels An:1,Implementation in:1,C It’s:1,for modes:1,VGA called:1,called as:1,as function:1,function EVGALine:1,EVGALine Listing:1,35.2 is:1,EVGALine Looking:1,Looking at:1,at EVGALine:1,The EVGALine:1,EVGALine function:1,function itself:1,itself performs:1,performs four:1,four operations:1,operations EVGALine:1,EVGALine first:1,first sets:1,pixels drawn:1,setting two:1,VGA’s registers:1,Set/Reset to:1,0FH as:1,EVGALine causes:1,produce pixels:1,color contained:1,Set/Reset setting:1,of 0FH:1,0FH causes:1,functions it:1,summary setting:1,way causes:1,color EVGALine:1,EVGALine next:1,next performs:1,simple check:1,to cut:1,cut in:1,orientations that:1,handled separately:1,separately Figure:1,35.4 shows:1,orientations among:1,among which:1,a Bresenham’s:1,algorithm implementation:1,implementation must:1,must distinguish:1,distinguish In:1,In interpreting:1,interpreting Figure:1,35.4 assume:1,that lines:1,lines radiate:1,radiate outward:1,outward from:1,the figure:1,figure falling:1,falling into:1,octants delineated:1,delineated by:1,vertical axes:1,two diagonals:1,diagonals The:1,categorize lines:1,into these:1,these octants:1,octants falls:1,the major/minor:1,major/minor axis:1,axis nature:1,algorithm the:1,are distinguished:1,distinguished by:1,which coordinate:1,coordinate forms:1,forms the:1,by whether:1,Y increases:1,increases or:1,or decreases:1,end A:1,A moment:1,thought will:1,show however:1,redundant Each:1,which DeltaY:1,DeltaY the:1,Y component:1,coordinate can:1,coordinate simply:1,direction EVGALine:1,swapping X0Y0:1,X0Y0 the:1,with X1Y1:1,X1Y1 the:1,coordinates whenever:1,whenever Y0:1,Y0 is:1,than Y1:1,Y1 This:1,This accomplished:1,accomplished EVGALine:1,EVGALine must:1,still distinguish:1,distinguish among:1,four remaining:1,remaining line:1,orientations Those:1,Those four:1,orientations form:1,major categories:1,categories orientations:1,Y dimension:1,axis As:1,35.4 octants:1,2 where:1,finish fall:1,and differ:1,differ in:1,one respect:1,respect the:1,changes Handling:1,Handling of:1,cases as:1,the symmetry:1,symmetry of:1,lines differing:1,differing only:1,DeltaX the:1,line Consequently:1,where DeltaX:1,made negative:1,negative and:1,term calculations:1,calculations Similarly:1,Similarly octants:1,0 where:1,finish differ:1,changes The:1,between line:1,and line:1,3 since:1,since X:1,line dictates:1,dictates In:1,In octants:1,error dictates:1,dictates since:1,since Y:1,orientations Figure:1,orientations There:1,3 Octant0:1,2 Octant1:1,Octant1 A:1,single function:1,with if:1,if statements:1,statements could:1,four octants:1,octants but:1,cost There:1,hand very:1,cost to:1,to grouping:1,grouping octants:1,3 together:1,and octants:1,2 together:1,together since:1,two octants:1,pair differ:1,coordinate EVGALine:1,EVGALine determines:1,which line-drawing:1,what value:1,coordinate based:1,two criteria:1,criteria whether:1,whether DeltaX:1,DeltaX DeltaX:1,DeltaY or:1,35.5 Recall:1,of DeltaY:1,be non-negative:1,non-negative as:1,earlier elimination:1,orientations After:1,After calling:1,appropriate function:1,line more:1,functions shortly:1,shortly EVGALine:1,EVGALine restores:1,zero In:1,this state:1,effect so:1,well EVGALine:1,EVGALine also:1,also restores:1,see is:1,by EVGADot:1,EVGADot the:1,the pixel-drawing:1,pixel-drawing routine:1,routine actually:1,lines produced:1,0FFH While:1,more modular:1,modular to:1,have EVGADot:1,EVGADot restore:1,after drawing:1,pixel it:1,said of:1,having EVGADot:1,EVGADot set:1,pixel While:1,While modularity:1,modularity would:1,improve speed:1,speed would:1,suffer markedly:1,markedly Figure:1,logic Figure:1,logic Drawing:1,Each Line:1,Line The:1,The Octant0:1,Octant1 functions:1,functions draw:1,DeltaY respectively:1,The parameters:1,parameters to:1,to Octant0:1,Octant1 are:1,each dimension:1,and XDirection:1,XDirection the:1,changed when:1,moves XDirection:1,XDirection must:1,screen No:1,No value:1,since DeltaY:1,DeltaY is:1,be positive:1,positive the:1,coordinate always:1,always changes:1,changes by:1,pixel Octant0:1,Octant0 draws:1,drawn differs:1,for Octant0:1,Octant0 to:1,octant 0:1,octant 3:1,3 Whenever:1,1 Octant1:1,Octant1 draws:1,For these:1,1 greater:1,pixel Whenever:1,next X:1,for Octant1:1,Octant1 to:1,octant 1:1,octant 2:1,2 Drawing:1,Each Pixel:1,Pixel At:1,Octant1 is:1,function EVGADot:1,EVGADot draws:1,specified coordinates:1,VGA happens:1,for As:1,earlier since:1,entire line:1,color line-drawing:1,is improved:1,hardware up:1,up once:1,EVGALine before:1,color via:1,via EVGADot:1,EVGADot makes:1,makes certain:1,certain assumptions:1,screen First:1,given row:1,row on:1,is 80:1,row immediately:1,immediately above:1,words this:1,EVGADot only:1,for screens:1,screens configured:1,configured to:1,be 80:1,wide Since:1,Since this:1,standard configuration:1,the modes:1,modes EVGALine:1,of 80:1,row should:1,problem If:1,problem however:1,however EVGADot:1,EVGADot could:1,retrieve the:1,BIOS integer:1,integer variable:1,variable at:1,address 0040004A:1,0040004A which:1,row for:1,current video:1,mode Second:1,Second EVGADot:1,EVGADot assumes:1,address A0000000:1,screen controlled:1,right controlled:1,6 the:1,the ninth:1,ninth pixel:1,pixel controlled:1,on Further:1,Further it:1,graphics adapter’s:1,adapter’s hardware:1,configured such:1,allow modification:1,then ORing:1,ORing a:1,of 0FEH:1,0FEH with:1,pixel correctly:1,correctly without:1,other dots:1,dots Note:1,that 0FEH:1,used rather:1,than 0FFH:1,0 because:1,some optimizing:1,compilers turn:1,turn ORs:1,ORs with:1,latter values:1,into simpler:1,simpler operations:1,or optimize:1,optimize them:1,them away:1,away entirely:1,entirely As:1,As explained:1,explained later:1,later however:1,that’s ORed:1,ORed that:1,matters given:1,way we’ve:1,hardware it’s:1,the act:1,ORing itself:1,0FEH forces:1,OR operation:1,operation Again:1,normal way:1,which modes:1,12H operate:1,operate As:1,earlier EVGADot:1,EVGADot also:1,also assumes:1,above-mentioned manner:1,manner will:1,correct color:1,Given those:1,assumptions EVGADot:1,EVGADot becomes:1,surprisingly simple:1,simple function:1,First EVGADot:1,EVGADot builds:1,pointer that:1,memory controlling:1,drawn Second:1,Second a:1,generated consisting:1,zeros for:1,drawn Third:1,mask so:1,written all:1,that controls:1,left unmodified:1,unmodified Finally:1,Finally 0FEH:1,is ORed:1,drawn ORing:1,ORing with:1,with 0FEH:1,0FEH first:1,first reads:1,memory thereby:1,thereby loading:1,0FEH Because:1,the unusual:1,paths work:1,which EVGALine:1,EVGALine sets:1,VGA’s Enable:1,ignored Instead:1,Instead the:1,actually gets:1,gets placed:1,was passed:1,to EVGALine:1,and placed:1,was set:1,step three:1,three above:1,above allows:1,this color:1,value For:1,various machineries:1,machineries the:1,VGA brings:1,brings to:1,data look:1,EVGALine EVGADot:1,EVGADot may:1,seem excessively:1,excessively complex:1,draw one:1,but programming:1,VGA isn’t:1,isn’t trivial:1,trivial as:1,early chapters:1,part Besides:1,Besides while:1,EVGADot is:1,is lengthy:1,lengthy the:1,five lines:1,long Line:1,drawing would:1,EVGADot were:1,were made:1,made an:1,an inline:1,inline part:1,Octant1 thereby:1,thereby saving:1,of preparing:1,preparing parameters:1,function Feel:1,Feel free:1,wish I:1,I maintained:1,maintained EVGADot:1,EVGADot as:1,for ease:1,of inserting:1,different graphics:1,adapter should:1,be desired:1,desired If:1,do install:1,install a:1,different adapter:1,fundamentally different:1,different mode:1,SuperVGA mode:1,mode remember:1,the hardware-dependent:1,hardware-dependent outportb:1,outportb lines:1,EVGALine itself:1,itself Comments:1,Comments on:1,C Implementation:1,Implementation EVGALine:1,no error:1,checking whatsoever:1,whatsoever My:1,My assumption:1,assumption in:1,writing EVGALine:1,EVGALine was:1,be ultimately:1,ultimately used:1,lowest-level primitive:1,primitive of:1,software package:1,package with:1,with operations:1,as error:1,checking and:1,clipping performed:1,level Similarly:1,Similarly EVGALine:1,VGA’s screen:1,to 639199:1,639199 in:1,mode 0EH:1,0EH 00:1,to 639349:1,639349 in:1,modes 0FH:1,0FH and:1,and 10H:1,or 00:1,to 639479:1,639479 in:1,corner considered:1,be 00:1,00 Again:1,Again transformation:1,any coordinate:1,system used:1,EVGALine can:1,level EVGALine:1,specifically designed:1,thing draw:1,VGA Additional:1,Additional functionality:1,functionality can:1,be supplied:1,EVGALine shown:1,be Inclusion:1,Inclusion of:1,EVGADot directly:1,into Octant0:1,Octant1 and:1,indeed inclusion:1,inclusion of:1,Octant1 directly:1,into EVGALine:1,would speed:1,speed execution:1,and parameter:1,parameter passing:1,passing Handpicked:1,Handpicked register:1,variables might:1,might speed:1,speed performance:1,s rather:1,than byte:1,s A:1,more significant:1,increase would:1,from eliminating:1,eliminating separate:1,separate calculation:1,pixel Since:1,pixel relative:1,known the:1,adjusted from:1,next rather:1,than recalculated:1,recalculated from:1,scratch These:1,These enhancements:1,enhancements are:1,not incorporated:1,incorporated into:1,35.1 for:1,reasons One:1,One reason:1,algorithm be:1,be clearly:1,clearly visible:1,for learning:1,learning purposes:1,purposes Once:1,is understood:1,understood rewriting:1,rewriting it:1,would certainly:1,worthwhile exercise:1,exercise Another:1,when flat-out:1,flat-out speed:1,needed assembly:1,go Why:1,Why produce:1,produce hard-to-understand:1,hard-to-understand C:1,boost speed:1,speed a:1,bit when:1,when assembly-language:1,assembly-language code:1,speed Given:1,a high-speed:1,high-speed assembly:1,logical next:1,step Bresenham’s:1,Bresenham’s Algorithm:1,Algorithm in:1,in Assembly:1,Assembly Listing:1,high-performance implementation:1,algorithm written:1,is callable:1,callable from:1,C just:1,35.1 with:1,name EVGALine:1,same parameters:1,parameters Either:1,Either of:1,two can:1,EVGALine since:1,be identical:1,versions is:1,35.2 runs:1,over three:1,an ISA-bus:1,the assembly-language:1,assembly-language version:1,EVGALine as:1,as when:1,difference would:1,greater yet:1,yet on:1,3 Link:1,Link each:1,each version:1,version with:1,35.2 and:1,and compare:1,compare performance—the:1,performance—the difference:1,is startling:1,startling An:1,An explanation:1,35.3 would:1,lengthy one:1,be redundant:1,redundant since:1,no different:1,35.1 although:1,much changed:1,changed due:1,also due:1,to designing:1,designing for:1,clarity Given:1,35.1 the:1,35.3 which:1,is well-commented:1,well-commented should:1,itself One:1,do want:1,35.3 incorporates:1,incorporates a:1,clever notion:1,notion for:1,which credit:1,credit is:1,due Jim:1,Mackraz who:1,who described:1,notion in:1,letter written:1,wrote long:1,ago in:1,and lamented:1,lamented Programmer’s:1,Journal Jim’s:1,Jim’s suggestion:1,DeltaY bits:1,bits set:1,be accumulated:1,accumulated in:1,register rather:1,pixel individually:1,individually All:1,all pixel:1,processing associated:1,been completed:1,completed This:1,save many:1,writes when:1,drawing nearly-horizontal:1,nearly-horizontal lines:1,because EGAs:1,VGAs hold:1,CPU up:1,considerable period:1,each I/O:1,I/O operation:1,All too:1,many PC:1,programmers fall:1,the high-level-language:1,high-level-language trap:1,algorithm guarantees:1,guarantees good:1,performance Not:1,so As:1,As our:1,our two:1,implementations of:1,algorithm graphically:1,graphically illustrate:1,illustrate pun:1,pun not:1,not originally:1,originally intended:1,but allowed:1,stand once:1,once recognized:1,recognized truly:1,truly great:1,great PC:1,35.3 we’ve:1,we’ve got:1,got y-oh-my:1,y-oh-my isn’t:1,it fun:1,fun Chapter:1,Chapter 36:1,36 The:1,Good the:1,Bad and:1,the Run-Sliced:1,Run-Sliced Faster:1,Faster Bresenham:1,Bresenham Lines:1,Lines with:1,with Run-Length:1,Drawing Years:1,that asked:1,write blazingly:1,blazingly fast:1,an AutoCAD:1,driver I:1,basic Bresenham’s:1,algorithm streamlined:1,streamlined it:1,possible special-cased:1,special-cased horizontal:1,horizontal diagonal:1,diagonal and:1,lines broke:1,broke out:1,separate optimized:1,optimized routines:1,each octant:1,octant and:1,and massively:1,massively unrolled:1,loops When:1,had line:1,drawing down:1,mere five:1,five or:1,or six:1,I handed:1,handed the:1,code over:1,the AutoCAD:1,driver person:1,person content:1,had pushed:1,theoretical limits:1,the Bresenham’s:1,80x86 architecture:1,PC That:1,That feeling:1,feeling lasted:1,lasted for:1,week until:1,until Dave:1,Miller who:1,who these:1,days is:1,a Windows:1,Windows display-driver:1,display-driver whiz:1,whiz at:1,at Engenious:1,Engenious Solutions:1,Solutions casually:1,casually mentioned:1,mentioned Bresenham’s:1,Bresenham’s faster:1,faster run-length:1,algorithm Remember:1,Remember Bill:1,Bill Murray’s:1,Murray’s safety:1,tip in:1,in Ghostbusters:1,Ghostbusters It:1,goes something:1,this Harold:1,Harold Ramis:1,Ramis tells:1,tells the:1,the Ghostbusters:1,Ghostbusters not:1,the beams:1,beams of:1,the antighost:1,antighost guns:1,guns Why:1,Why Murray:1,Murray asks:1,asks It:1,be bad:1,bad Ramis:1,Ramis says:1,says Murray:1,Murray says:1,I’m fuzzy:1,whole good/bad:1,good/bad thing:1,thing What:1,exactly do:1,you mean:1,what Ramis:1,Ramis means:1,universe Important:1,Important safety:1,tip Murray:1,Murray comments:1,comments dryly:1,dryly I:1,learned two:1,safety tips:1,tips from:1,line-drawing experience:1,experience neither:1,neither involves:1,possible destruction:1,nonetheless worth:1,mind First:1,First never:1,never think:1,think you’ve:1,you’ve written:1,code Odds:1,Odds are:1,haven’t Run:1,Run your:1,code past:1,past another:1,another good:1,she will:1,probably say:1,say But:1,you’ll realize:1,could indeed:1,indeed do:1,faster Or:1,Or relax:1,code later:1,well see:1,see another:1,another faster:1,approach There:1,a million:1,million ways:1,can almost:1,always find:1,to Second:1,Second when:1,matters never:1,code perform:1,same calculation:1,calculation more:1,This sounds:1,sounds obvious:1,it’s astonishing:1,astonishing how:1,often it’s:1,it’s ignored:1,ignored For:1,snippet of:1,code cb265-1:1,cb265-1 for:1,for i:1,i 0:1,0 i:1,i RunLength:1,RunLength i:1,i cb265-2:1,cb265-2 cb265-3:1,cb265-3 WorkingScreenPtr:1,WorkingScreenPtr Color:1,Color cb265-4:1,cb265-4 if:1,if XDelta:1,XDelta 0:1,0 cb265-5:1,cb265-5 cb265-6:1,cb265-6 WorkingScreenPtr:1,WorkingScreenPtr cb265-7:1,cb265-7 cb265-8:1,cb265-8 else:1,else cb265-9:1,cb265-9 cb265-10:1,cb265-10 WorkingScreenPtr:1,WorkingScreenPtr cb265-11:1,cb265-11 cb265-12:1,cb265-12 Here:1,knows which:1,going before:1,loop begins—but:1,begins—but nonetheless:1,nonetheless performs:1,performs that:1,that test:1,test every:1,when calculating:1,pixel Far:1,Far better:1,test only:1,once outside:1,here Think:1,A program:1,machine It:1,of inputs:1,and produces:1,a corresponding:1,corresponding set:1,of outputs:1,outputs by:1,passing through:1,of states:1,states Your:1,Your primary:1,primary job:1,machine Your:1,Your additional:1,additional job:1,the paths:1,paths through:1,machine This:1,means performing:1,performing as:1,many tests:1,and calculations:1,calculations as:1,possible outside:1,loops themselves:1,little work—that:1,work—that is:1,is pass:1,as few:1,few states—as:1,states—as possible:1,possible Which:1,us full:1,full circle:1,circle to:1,a minimized:1,minimized state:1,machine In:1,you’re fuzzy:1,the good/bad:1,good/bad performance:1,performance thing:1,thing that’s:1,fast Run-Length:1,Slice Fundamentals:1,Fundamentals First:1,First off:1,off I:1,a confession:1,confession to:1,make I’m:1,discuss is:1,actually precisely:1,precisely Bresenham’s:1,algorithm It’s:1,this algorithm:1,intervening years:1,I’ve misplaced:1,misplaced Bresenham’s:1,Bresenham’s article:1,been unable:1,to unearth:1,unearth it:1,result I:1,scratch which:1,was admittedly:1,admittedly more:1,fun than:1,reading about:1,also ensured:1,ensured that:1,understood it:1,it inside:1,discuss may:1,be Bresenham’s:1,slice algorithm—but:1,algorithm—but it:1,surely is:1,begin understanding:1,algorithm I:1,algorithm at:1,standard approach:1,longer dimension:1,line while:1,term that:1,indicates at:1,each major-axis:1,major-axis step:1,step how:1,advancing halfway:1,36.1 illustrates:1,illustrates standard:1,test are:1,performed once:1,The run-length:1,algorithm rotates:1,rotates matters:1,matters 90:1,degrees with:1,with salubrious:1,salubrious results:1,the shorter:1,shorter dimension:1,dimension while:1,term indicating:1,advancing an:1,36.2 Consider:1,this When:1,you’re called:1,an X-dimension:1,of 35:1,a Y-dimension:1,Y-dimension of:1,10 you:1,available some:1,ignored by:1,by standard:1,Bresenham’s In:1,the slope:1,slope is:1,between 1/3:1,1/3 and:1,and 1/4:1,1/4 you:1,single run—a:1,run—a run:1,same minor-axis:1,minor-axis coordinate—must:1,coordinate—must be:1,either three:1,long No:1,other length:1,36.3 apart:1,runs which:1,are special:1,cases that:1,shortly Therefore:1,Therefore for:1,an error-term:1,error-term calculation:1,pixel Instead:1,just perform:1,perform one:1,test per:1,per run:1,run to:1,long thereby:1,eliminating about:1,drawing this:1,line Take:1,behind run-length:1,drawing soak:1,soak in:1,in Periodic:1,Periodic decisions:1,decisions must:1,control pixel:1,placement The:1,make those:1,those decisions:1,decisions as:1,infrequently and:1,possible Of:1,each pixel—that’s:1,pixel—that’s standard:1,Bresenham’s However:1,those per-pixel:1,per-pixel decisions:1,redundant and:1,information before:1,begin drawing:1,the redundant:1,redundant decisions:1,decisions Run-length:1,to standard:1,Bresenham’s but:1,it pares:1,pares the:1,the decision-making:1,decision-making process:1,process down:1,minimum It’s:1,It’s somewhat:1,somewhat analogous:1,between finding:1,common divisor:1,divisor of:1,two numbers:1,numbers using:1,using Euclid’s:1,finding it:1,trying every:1,possible divisor:1,divisor Both:1,approaches produce:1,that which:1,takes maximum:1,maximum advantage:1,available information:1,and minimizes:1,minimizes redundant:1,redundant work:1,is preferable:1,preferable Figure:1,line Run-Length:1,Slice Implementation:1,Implementation We:1,any line:1,given run:1,run will:1,possible lengths:1,lengths How:1,How though:1,which length:1,length to:1,select Surprisingly:1,Surprisingly this:1,determine For:1,following discussion:1,discussion assume:1,1/3.5 so:1,axis however:1,discussion also:1,also applies:1,to Y-major:1,Y-major lines:1,Y reversed:1,reversed The:1,The minimum:1,length for:1,any run:1,an X-major:1,X-major line:1,int(XDelta/YDelta where:1,where XDelta:1,XDelta is:1,the X-dimension:1,and YDelta:1,YDelta is:1,the Y-dimension:1,Y-dimension The:1,int(XDelta/YDelta 1:1,lengths to:1,select for:1,run To:1,this selection:1,selection refer:1,36.4 For:1,one-pixel step:1,axis Y:1,Y in:1,advance at:1,full advance:1,advance distance:1,actually three-plus:1,three-plus pixels:1,portion to:1,the advance:1,a single-pixel:1,single-pixel Y:1,Y step:1,step This:1,This fractional:1,to deciding:1,deciding when:1,The fraction:1,fraction indicates:1,indicates what:1,what portion:1,axis during:1,parts we:1,to needing:1,needing an:1,pixel when:1,fractional sum:1,sum reaches:1,reaches 1:1,1 it’s:1,run Then:1,can subtract:1,subtract 1:1,1 from:1,sum because:1,just advanced:1,advanced one:1,continue on:1,length Figure:1,length Practically:1,with fractions:1,fractions because:1,is imprecise:1,imprecise Therefore:1,Therefore we:1,a cue:1,cue from:1,from standard:1,Bresenham’s and:1,and scale:1,scale all:1,error-term calculations:1,calculations up:1,integers The:1,The fractional:1,X major:1,advance per:1,per one-pixel:1,one-pixel Y:1,Y minor:1,of XDelta/YDelta:1,XDelta/YDelta This:1,to XDelta:1,YDelta YDelta:1,YDelta We’ll:1,We’ll scale:1,scale this:1,this up:1,multiplying it:1,by YDelta*2:1,YDelta*2 so:1,term up:1,one-pixel minor-axis:1,minor-axis advance:1,is XDelta:1,2 We’ll:1,We’ll similarly:1,similarly scale:1,term down:1,after it:1,over so:1,our downward:1,downward error-term:1,error-term adjustment:1,adjustment is:1,is YDelta*2:1,YDelta*2 Therefore:1,Therefore before:1,add XDelta:1,term If:1,term runs:1,over reaches:1,reaches one:1,full pixel:1,pixel we’ll:1,we’ll lengthen:1,lengthen the:1,and subtract:1,subtract YDelta*2:1,YDelta*2 from:1,term All:1,All values:1,are multiplied:1,2 so:1,term which:1,a 0.5:1,0.5 term:1,term can:1,integer as:1,discussed next:1,next This:1,process it:1,only integer:1,integer addition:1,subtraction and:1,single test:1,it lends:1,varied optimizations:1,optimizations For:1,could break:1,break out:1,out hardwired:1,hardwired optimizations:1,optimizations for:1,possible pair:1,of run:1,lengths For:1,aforementioned line:1,1/3.5 for:1,one routine:1,routine hardwired:1,another hardwired:1,pixels These:1,These routines:1,ideally have:1,no looping:1,looping but:1,instructions customized:1,at maximum:1,speed Each:1,Each routine:1,would know:1,only possibilities:1,next run:1,run would:1,be three:1,four so:1,could increment:1,term then:1,then jump:1,jump directly:1,appropriate one:1,routines depending:1,term turned:1,over Properly:1,Properly implemented:1,average per-run:1,per-run overhead:1,to less:1,branch with:1,two additions:1,tests the:1,of runs:1,runs must:1,down plus:1,subtraction half:1,486 this:1,this amounts:1,of 150:1,150 nanoseconds:1,nanoseconds of:1,pixel exclusive:1,exclusive of:1,actually write:1,good Run-Length:1,Slice Details:1,Details A:1,details yet:1,yet remain:1,remain First:1,First is:1,how error-term:1,error-term turnover:1,turnover is:1,detected This:1,Bresenham’s The:1,maintained as:1,negative valve:1,valve and:1,advances for:1,term reaches:1,run This:1,for carry:1,carry after:1,term to:1,run Actually:1,chapter tests:1,term being:1,being greater:1,efficient carry:1,carry approach:1,difficult detail:1,is balancing:1,balancing the:1,the runs:1,they’re centered:1,centered around:1,therefore draw:1,Bresenham’s would:1,draw If:1,just drew:1,drew full-length:1,full-length runs:1,start we’d:1,we’d end:1,an unbalanced:1,unbalanced line:1,36.5 Instead:1,pixel plus:1,full run:1,possible between:1,runs of:1,and adjust:1,term appropriately:1,initial half-run:1,half-run The:1,by one-half:1,normal per-step:1,per-step fractional:1,advance because:1,initial step:1,one-half pixel:1,axis This:1,This half-step:1,half-step gets:1,gets us:1,axis All:1,error-term adjustments:1,adjustments are:1,times precisely:1,can scale:1,this halved:1,halved error:1,term for:1,initial run:1,thereby make:1,integer The:1,other trick:1,odd number:1,are allocated:1,allocated between:1,last partial:1,partial runs:1,runs we’ll:1,we’ll end:1,pixel since:1,are unable:1,a half-pixel:1,half-pixel This:1,This odd:1,is accounted:1,adding half:1,term That’s:1,to run-length:1,the partial:1,partial first:1,part Listing:1,a run-length:1,C This:1,optimized implementation:1,implementation nor:1,nor is:1,meant to:1,this listing:1,provided so:1,algorithm works:1,version but:1,now Listing:1,36.1 will:1,balanced Figure:1,balanced Notwithstanding:1,Notwithstanding that:1,not optimized:1,optimized Listing:1,fast If:1,Listing 36.2:1,36.2 a:1,sample line-drawing:1,line-drawing program:1,to test-drive:1,test-drive Listing:1,36.1 you:1,as surprised:1,surprised as:1,quickly the:1,fills with:1,with vectors:1,vectors considering:1,some redundant:1,redundant divides:1,divides Or:1,perhaps you:1,be surprised—in:1,surprised—in which:1,case I:1,you not:1,not miss:1,Chapter 37:1,37 Dead:1,Dead Cats:1,and Lightning:1,Lightning Lines:1,Lines Optimizing:1,Optimizing Run-Length:1,a Major:1,Major Way:1,Way As:1,the wife:1,wife the:1,the kid:1,I are:1,the throes:1,throes of:1,another lightning-quick:1,lightning-quick transcontinental:1,transcontinental move:1,move this:1,Redmond Washington:1,Washington to:1,for You:1,Know Who:1,Who Moving:1,Moving is:1,never fun:1,it worse:1,worse for:1,the pets:1,pets Getting:1,Getting them:1,into kennels:1,kennels and:1,the airport:1,airport is:1,hard there’s:1,to fly:1,fly because:1,the weather:1,weather and:1,all they:1,it Animals:1,Animals don’t:1,don’t usually:1,usually end:1,up injured:1,injured or:1,or dead:1,dead but:1,happen In:1,a not:1,not notably:1,notably successful:1,successful effort:1,to cheer:1,cheer me:1,prospect of:1,shipping my:1,my animals:1,animals a:1,friend told:1,following story:1,story which:1,he swears:1,swears actually:1,actually happened:1,his I:1,don’t know—to:1,know—to me:1,an urban:1,urban legend:1,legend which:1,story but:1,never track:1,person it:1,really happened:1,to it’s:1,friend But:1,and anyway:1,anyway it’s:1,story This:1,This friend:1,friend henceforth:1,henceforth referred:1,as FOF:1,FOF worked:1,worked in:1,an air-freight:1,air-freight terminal:1,terminal Consequently:1,he handled:1,handled a:1,of animals:1,animals which:1,was fine:1,fine by:1,by him:1,him because:1,he liked:1,liked animals:1,animals in:1,had quite:1,few cats:1,cats at:1,home You:1,imagine his:1,his dismay:1,a kennel:1,kennel off:1,the cat:1,cat it:1,it carried:1,carried was:1,thoroughly dead:1,dead No:1,No it:1,wasn’t resting:1,resting nor:1,nor pining:1,pining for:1,the fjords:1,fjords this:1,this cat:1,cat was:1,was bloody:1,bloody deceased:1,deceased FOF:1,FOF knew:1,knew how:1,how upset:1,upset the:1,make everything:1,everything better:1,better At:1,home he:1,a cat:1,cat of:1,size shape:1,shape and:1,and markings:1,markings He:1,He would:1,would substitute:1,substitute that:1,that cat:1,cat and:1,all cats:1,cats treat:1,treat all:1,all humans:1,equal disdain:1,disdain the:1,difference and:1,never suffer:1,suffer the:1,the trauma:1,trauma of:1,her cat:1,cat So:1,So FOF:1,FOF drove:1,drove home:1,home got:1,got his:1,his cat:1,cat put:1,and waited:1,owner to:1,show up—at:1,up—at which:1,point she:1,she took:1,took one:1,one look:1,isn’t my:1,my cat:1,cat My:1,My cat:1,cat is:1,is dead:1,dead As:1,she had:1,had shipped:1,shipped her:1,her recently:1,recently deceased:1,deceased feline:1,feline home:1,be buried:1,buried History:1,History does:1,not record:1,record how:1,how our:1,our FOF:1,FOF dug:1,dug himself:1,one Okay:1,Okay but:1,isn’t broken:1,broken don’t:1,don’t fix:1,right too:1,too Which:1,us neat:1,neat as:1,a pin:1,pin to:1,serious hurry:1,hurry Fast:1,Fast Run-Length:1,Drawing In:1,axis It’s:1,turn theory:1,theory into:1,into useful:1,useful practice:1,practice by:1,by developing:1,version Listing:1,form that’s:1,that’s plug-compatible:1,chapter How:1,How Fast:1,Fast Your:1,Your first:1,following Just:1,Just how:1,37.1 Is:1,it optimized:1,the hilt:1,hilt or:1,or just:1,just pretty:1,pretty fast:1,The quick:1,quick answer:1,is It’s:1,It’s fast:1,nearly 1:1,1 million:1,486/33 and:1,of still:1,The heavily:1,optimized AutoCAD:1,AutoCAD line-drawing:1,chapter drew:1,drew 150000:1,150000 pixels:1,a 386/16:1,386/16 and:1,had died:1,and gone:1,gone to:1,to Heaven:1,Heaven Such:1,is progress:1,progress The:1,full answer:1,complicated one:1,ties in:1,that’s okay—and:1,okay—and to:1,looking before:1,you leap:1,leap also:1,as profiling:1,profiling before:1,optimize When:1,up run-length:1,lines I:1,I initially:1,initially manually:1,manually converted:1,chapter’s C:1,assembly Then:1,I streamlined:1,streamlined the:1,STOS wherever:1,wherever possible:1,possible Listing:1,point line:1,drawing was:1,surely faster:1,faster although:1,faster Equally:1,Equally surely:1,surely there:1,were significant:1,significant optimizations:1,optimizations yet:1,was itching:1,itching to:1,were bound:1,interesting than:1,a basic:1,basic C-to-assembly:1,C-to-assembly port:1,port Ego:1,Ego intervened:1,intervened at:1,speed-up I:1,already gotten:1,gotten so:1,compared it:1,code To:1,my horror:1,horror I:1,had not:1,not gotten:1,gotten even:1,improvement I:1,couldn’t understand:1,could be—the:1,be—the C:1,was decidedly:1,decidedly unoptimized—until:1,unoptimized—until I:1,I hit:1,of measuring:1,memory speed:1,drawing Bingo:1,Bingo The:1,The Paradise:1,486/33 is:1,single display-memory:1,display-memory write:1,write because:1,it buffers:1,data lets:1,CPU go:1,go on:1,its merry:1,and finishes:1,finishes the:1,ready However:1,adapter turns:1,every microsecond:1,microsecond Put:1,only write:1,write one:1,this adapter:1,adapter every:1,every 33:1,33 clock:1,486/33 Therefore:1,Therefore no:1,never draw:1,draw more:1,1000000 pixels:1,system The:1,already drawing:1,half that:1,rate so:1,potential speed-up:1,speed-up for:1,was limited:1,times which:1,pretty close:1,37.1 did:1,fact achieve:1,achieve When:1,I compared:1,compared the:1,assembly implementations:1,implementations drawing:1,actually four:1,fact Listing:1,draws VGA:1,VGA lines:1,about 92:1,rate in:1,my system—that:1,system—that is:1,draws very:1,hardware will:1,allow All:1,faster line:1,line drawing—and:1,drawing—and only:1,all overhead:1,overhead an:1,an unlikely:1,unlikely proposition:1,proposition at:1,best The:1,isn’t fully:1,optimized but:1,what Now:1,faster line-drawing:1,more beneficial:1,beneficial on:1,faster VGAs:1,especially local-bus:1,local-bus VGAs:1,in slower:1,slower systems:1,systems For:1,I’ll list:1,list a:1,potential optimizations:1,37.1 On:1,of 2.2:1,2.2 million:1,486 33:1,33 given:1,given fast:1,enough VGA:1,drive almost:1,any non-local-bus:1,non-local-bus VGA:1,at nearly:1,nearly full:1,many systems:1,systems further:1,time Profile:1,optimize Further:1,Further Optimizations:1,Optimizations Following:1,Following is:1,possible further:1,37.1 The:1,The run-handling:1,run-handling loops:1,loops could:1,unrolled more:1,current two:1,times However:1,two-times unrolling:1,unrolling gets:1,maximum unrolling:1,unrolling benefit:1,benefit with:1,less overhead:1,overhead than:1,heavily unrolled:1,loop BX:1,BX could:1,Y-major code:1,by breaking:1,separate loops:1,advances of:1,1 DX:1,DX could:1,using AH:1,AH as:1,counter for:1,run loops:1,loops although:1,would limit:1,maximum line:1,line length:1,length that:1,handled The:1,The freed:1,keep more:1,the whole-step:1,whole-step and:1,error variables:1,registers Alternatively:1,the freed:1,esoteric approaches:1,approaches like:1,like unrolling:1,Y-major inner:1,loop such:1,such unrolling:1,unrolling could:1,two run:1,given line:1,line Strangely:1,Strangely enough:1,486 it:1,worth unrolling:1,X-major inner:1,STOSB because:1,slow start-up:1,start-up time:1,REP relative:1,branching on:1,that processor:1,processor Special:1,Special code:1,with integral:1,integral slopes:1,slopes because:1,all runs:1,X-major code:1,an aligned:1,aligned word:1,some 16-bit:1,16-bit VGAs:1,VGAs One:1,One weakness:1,slopes between:1,between 0.5:1,average run:1,two rendering:1,rendering run-length:1,run-length slicing:1,slicing ineffective:1,ineffective This:1,be remedied:1,remedied by:1,viewing lines:1,range as:1,being composed:1,diagonal rather:1,or vertical:1,vertical runs:1,runs I:1,haven’t space:1,this idea:1,idea any:1,very complicated:1,it guarantees:1,guarantees a:1,minimum run:1,which renders:1,renders run:1,run drawing:1,drawing considerably:1,efficient and:1,makes techniques:1,techniques such:1,as unrolling:1,inner run-drawing:1,run-drawing loops:1,loops more:1,attractive Finally:1,that run-length:1,long lines:1,lines because:1,slower setup:1,setup than:1,draw including:1,divide Run-length:1,slice is:1,100-pixel lines:1,necessarily for:1,for 20-pixel:1,20-pixel lines:1,for 3-pixel:1,3-pixel lines:1,lines Both:1,if line-drawing:1,critical whether:1,whether you’ll:1,you’ll want:1,use run-length:1,slice or:1,or standard:1,Bresenham’s depends:1,typical lengths:1,lines you’ll:1,be drawing:1,For lines:1,of widely:1,widely varying:1,varying lengths:1,lengths you:1,implement both:1,both approaches:1,line depending:1,line length—assuming:1,length—assuming of:1,your display:1,application demanding:1,demanding enough:1,that level:1,optimization worthwhile:1,worthwhile If:1,looks broken:1,broken from:1,perspective think:1,think before:1,you fix:1,particular cat:1,cat may:1,be dead:1,dead for:1,I’ll say:1,again Profile:1,optimize Chapter:1,38 The:1,The Polygon:1,Polygon Primeval:1,Primeval Drawing:1,Polygons Efficiently:1,Efficiently and:1,and Quickly:1,Quickly Give:1,one firm:1,firm spot:1,spot on:1,stand and:1,Earth Archimedes:1,Archimedes Were:1,Were Archimedes:1,Archimedes alive:1,alive today:1,today he:1,say Give:1,one fast:1,fast polygon-fill:1,polygon-fill routine:1,routine on:1,Earth Programmers:1,Programmers often:1,often think:1,graphics primitive:1,primitive but:1,but filled:1,equally fundamental:1,fundamental and:1,useful Filled:1,Filled polygons:1,for constructs:1,constructs as:1,as diverse:1,diverse as:1,3-D surface:1,virtually everything:1,between I’ll:1,several developing:1,developing routines:1,draw filled:1,and building:1,building more:1,sophisticated graphics:1,graphics operations:1,operations atop:1,atop those:1,routines Once:1,that foundation:1,foundation I’ll:1,2-D manipulation:1,manipulation and:1,polygon-based entities:1,as preface:1,preface to:1,graphics You:1,without laying:1,laying some:1,some groundwork:1,groundwork though:1,I’ll begin:1,polygon considerably:1,faster That’s:1,That’s my:1,my general:1,general approach:1,of topic:1,topic High-level:1,High-level exploration:1,topic first:1,speedy hardware-specific:1,hardware-specific implementation:1,implementation for:1,IBM PC/VGA:1,PC/VGA combination:1,combination the:1,used graphics:1,graphics system:1,system around:1,around Abstract:1,Abstract machine-independent:1,machine-independent graphics:1,beauty but:1,understanding graphics:1,all levels:1,levels including:1,you boost:1,performance into:1,the realm:1,realm of:1,the sublime:1,sublime And:1,And slow:1,slow computer:1,scarcely worth:1,the bother:1,bother Filled:1,Filled Polygons:1,Polygons A:1,a shape:1,shape formed:1,formed by:1,lines laid:1,laid end:1,continuous closed:1,closed path:1,path A:1,filled by:1,polygon’s boundaries:1,boundaries to:1,color or:1,or pattern:1,pattern For:1,polygons filled:1,solid colors:1,colors You:1,can divide:1,divide polygons:1,categories convex:1,polygons include:1,include what:1,what you’d:1,you’d normally:1,normally think:1,concerned a:1,polygon encounters:1,once excluding:1,excluding horizontal:1,zero-length edge:1,edge segments:1,segments Put:1,way neither:1,right nor:1,nor left:1,polygon ever:1,ever reverses:1,direction from:1,from up:1,to down:1,down or:1,or vice-versa:1,vice-versa Also:1,polygon may:1,cross one:1,another although:1,may touch:1,touch so:1,edge never:1,never crosses:1,crosses over:1,edge Check:1,38.3 which:1,normal sense:1,sense The:1,whatever directions:1,directions they:1,they please:1,please so:1,they never:1,cross Complex:1,any boundaries:1,boundaries you:1,imagine which:1,for interesting:1,interesting problems:1,which interior:1,interior spaces:1,spaces to:1,fill Each:1,Each category:1,category is:1,a superset:1,superset of:1,one See:1,41 for:1,detailed discussion:1,polygon types:1,and naming:1,naming Why:1,polygons Easy:1,Easy performance:1,performance especially:1,polygons We’re:1,with filled:1,filled convex:1,polygons they’re:1,they’re widely:1,widely useful:1,serve well:1,to introduce:1,the subtler:1,subtler complexities:1,drawing not:1,the slippery:1,slippery concept:1,of inside:1,inside Which:1,Which Side:1,Side Is:1,Is Inside:1,Inside The:1,is decomposing:1,decomposing each:1,lines one:1,horizontal row:1,or scan:1,process I’ll:1,call scan:1,scan conversion:1,conversion and:1,lines I’ll:1,entire process:1,process as:1,as rasterization:1,rasterization Rasterization:1,Rasterization of:1,and tracing:1,tracing down:1,sides one:1,line one:1,one vertical:1,vertical pixel:1,time filling:1,extent between:1,line until:1,reached At:1,At first:1,first glance:1,glance rasterization:1,rasterization does:1,particularly complicated:1,complicated although:1,is inadequate:1,inadequate for:1,for nonconvex:1,polygons There:1,of complications:1,complications however:1,The lesser:1,lesser complication:1,rasterize the:1,polygon efficiently:1,efficiently given:1,write fast:1,that simultaneously:1,simultaneously traces:1,traces two:1,space between:1,to decouple:1,decouple the:1,of scan-converting:1,lines One:1,One device-independent:1,device-independent routine:1,can trace:1,trace along:1,beginning and:1,second device-specific:1,device-specific routine:1,list after:1,entire polygon:1,been scanned:1,scanned We’ll:1,action shortly:1,second greater:1,greater complication:1,complication arises:1,arises because:1,are within:1,complicated matter:1,imagine You:1,that scan-converting:1,scan-converting an:1,one vertex:1,next but:1,so A:1,a one-dimensional:1,one-dimensional construct:1,construct and:1,such is:1,is approximated:1,approximated on:1,display by:1,line serving:1,boundary on:1,a two-dimensional:1,two-dimensional object:1,object When:1,When filling:1,standard vertex-to-vertex:1,vertex-to-vertex line-drawing:1,draw many:1,38.2 It’s:1,It’s no:1,no crime:1,crime to:1,use standard:1,polygon rather:1,only interior:1,interior pixels:1,fact there:1,certain advantages:1,unfilled Such:1,Such polygons:1,they’re supposed:1,on raster:1,raster displays:1,displays is:1,ideal Figure:1,algorithms Figure:1,algorithms There’s:1,one great:1,great drawback:1,to tracing:1,tracing polygons:1,however Adjacent:1,Adjacent polygons:1,together properly:1,38.3 If:1,use six:1,six equilateral:1,equilateral triangles:1,a hexagon:1,hexagon for:1,will overlap:1,overlap when:1,when traced:1,traced with:1,more recently:1,recently drawn:1,drawn triangles:1,will wipe:1,wipe out:1,out portions:1,their predecessors:1,predecessors Worse:1,still odd:1,odd color:1,effects will:1,up along:1,polygon boundaries:1,boundaries if:1,if XOR:1,XOR drawing:1,used Consequently:1,Consequently filling:1,filling out:1,boundary lines:1,just won’t:1,images composed:1,of fitted-together:1,fitted-together polygons:1,polygons And:1,And because:1,because fitting:1,fitting polygons:1,together is:1,mind we:1,approach How:1,How Do:1,You Fit:1,Fit Polygons:1,Polygons Together:1,Together How:1,you fit:1,fit polygons:1,together Very:1,Very carefully:1,carefully First:1,the line-tracing:1,line-tracing algorithm:1,algorithm must:1,adjusted so:1,it selects:1,selects only:1,are truly:1,truly inside:1,This basically:1,basically requires:1,requires shifting:1,algorithm horizontally:1,one half-pixel:1,half-pixel toward:1,polygon’s interior:1,interior That:1,handle points:1,and points:1,once To:1,To deal:1,adopt the:1,rules Points:1,on nonhorizontal:1,nonhorizontal edges:1,right left:1,drawn right:1,aren’t Figure:1,problem Figure:1,problem Points:1,on horizontal:1,horizontal edges:1,directly below:1,below them:1,them horizontal:1,horizontal top:1,top edges:1,drawn horizontal:1,horizontal bottom:1,aren’t A:1,A vertex:1,lines ending:1,point meet:1,above conditions:1,conditions no:1,edges end:1,end at:1,point All:1,All edges:1,polygon except:1,except those:1,are flat:1,flat tops:1,tops or:1,or flat:1,flat bottoms:1,bottoms will:1,considered either:1,either right:1,or left:1,edges regardless:1,of slope:1,slope The:1,The left:1,starts with:1,leftmost line:1,These rules:1,rules ensure:1,no pixel:1,drawn more:1,once when:1,when adjacent:1,filled and:1,polygons cover:1,full 360-degree:1,360-degree range:1,range around:1,pixel then:1,only once—just:1,once—just what:1,need in:1,fit filled:1,together seamlessly:1,seamlessly This:1,of non-overlapping:1,non-overlapping polygon:1,filling isn’t:1,all purposes:1,purposes Polygons:1,are skewed:1,skewed toward:1,only introduces:1,introduces drawing:1,drawing error:1,error relative:1,ideal polygon:1,polygon won’t:1,unfilled Narrow:1,Narrow wedges:1,wedges and:1,and one-pixel-wide:1,one-pixel-wide polygons:1,up spottily:1,spottily All:1,of polygon-filling:1,polygon-filling approach:1,approach depends:1,depends entirely:1,used For:1,purposes nonoverlapping:1,nonoverlapping polygons:1,go so:1,them Filling:1,Filling Non-Overlapping:1,Non-Overlapping Convex:1,Polygons Without:1,38.1 contains:1,function FillConvexPolygon:1,that accepts:1,of points:1,describe a:1,point assumed:1,to connect:1,scans it:1,fill then:1,function DrawHorizontalLineList:1,DrawHorizontalLineList in:1,38.2 Listing:1,38.3 is:1,calls FillConvexPolygon:1,FillConvexPolygon to:1,sorts and:1,Listing 38.4:1,38.4 is:1,a header:1,file included:1,other listings:1,listings Here:1,listings we’ll:1,we’ll pick:1,up discussion:1,discussion on:1,side Listing:1,38.2 isn’t:1,interesting it:1,it merely:1,merely draws:1,the passed-in:1,passed-in list:1,No that:1,fundamental primitive:1,primitive in:1,I’ll replace:1,38.2 with:1,faster version:1,with individual:1,38.1 is:1,chapter Our:1,Our goal:1,points inside:1,no points:1,points outside:1,points located:1,boundary are:1,on right:1,edges That’s:1,That’s precisely:1,38.1 does:1,does Here’s:1,38.1 first:1,first finds:1,finds the:1,then works:1,top point:1,different locations:1,is flat:1,flat which:1,two implications:1,implications First:1,First it’s:1,starting vertices:1,directions through:1,edges To:1,To scan-convert:1,scan-convert them:1,properly we:1,first determine:1,is which:1,which Second:1,polygon should:1,pixel because:1,horizontal edge:1,makes up:1,location the:1,is pointed:1,pointed In:1,drawn it’s:1,it’s part:1,the right-edge:1,right-edge line:1,vertex It’s:1,It’s part:1,a left-edge:1,left-edge line:1,line too:1,edge overrides:1,overrides When:1,flat it’s:1,tell in:1,which direction:1,direction through:1,edges go:1,go because:1,edges start:1,vertex The:1,slopes from:1,lines coming:1,leftmost The:1,The calculations:1,38.1 involving:1,various deltas:1,deltas do:1,this using:1,a rearranged:1,rearranged form:1,the slope-based:1,slope-based equation:1,equation DeltaYN/DeltaXN:1,DeltaYN/DeltaXN DeltaYP/DeltaXP:1,DeltaYP/DeltaXP Once:1,starts in:1,list we:1,can scan-convert:1,scan-convert it:1,bottom vertex:1,reached Each:1,Each point:1,starting X:1,coordinate for:1,list we’ll:1,we’ll pass:1,pass to:1,DrawHorizontalLineList The:1,The nearest:1,nearest X:1,coordinate on:1,line that’s:1,selected The:1,segment making:1,making up:1,edge isn’t:1,isn’t scan-converted:1,scan-converted producing:1,producing two:1,two desirable:1,desirable effects:1,effects First:1,avoids drawing:1,vertex twice:1,twice two:1,lines come:1,into every:1,every vertex:1,vertex but:1,scan-convert each:1,vertex only:1,once Second:1,Second not:1,not scan-converting:1,line causes:1,bottom scan:1,polygon not:1,as required:1,our rules:1,rules The:1,also skipped:1,skipped if:1,flat Now:1,scan-convert the:1,edge into:1,the ending:1,ending X:1,coordinate fields:1,edge except:1,every line:1,is moved:1,left before:1,being scan-converted:1,scan-converted Why:1,Why We:1,edge so:1,edge itself:1,itself isn’t:1,happens drawing:1,line moved:1,its original:1,original location:1,location Sketch:1,Sketch it:1,mean Once:1,are scan-converted:1,scan-converted the:1,drawn Finis:1,Finis Oddball:1,Oddball Cases:1,Cases Listing:1,38.1 handles:1,handles zero-length:1,zero-length segments:1,segments multiple:1,multiple vertices:1,location by:1,ignoring them:1,them which:1,useful down:1,road because:1,because scaled-down:1,scaled-down polygons:1,can end:1,with nearby:1,nearby vertices:1,vertices moved:1,location Horizontal:1,Horizontal line:1,are fine:1,fine anywhere:1,polygon too:1,too Basically:1,Basically Listing:1,38.1 scan-converts:1,scan-converts between:1,between active:1,that define:1,both horizontal:1,zero-length lines:1,are non-active:1,non-active neither:1,neither advances:1,advances to:1,another scan:1,scanned I’ve:1,I’ve limited:1,limited this:1,to merely:1,merely demonstrating:1,demonstrating the:1,listings given:1,given are:1,means fast:1,we’ll spice:1,spice things:1,and pixel-at-a-time:1,pixel-at-a-time drawing:1,and tossing:1,tossing a:1,language into:1,mix Chapter:1,39 Fast:1,Polygons Filling:1,Filling Polygons:1,Polygons in:1,Hurry In:1,surprisingly intricate:1,intricate process:1,polygons Now:1,fill them:1,them an:1,magnitude or:1,so faster:1,faster Two:1,Two thoughts:1,thoughts may:1,point Oh:1,Oh no:1,no he’s:1,he’s not:1,and device-dependent:1,device-dependent code:1,is he:1,he and:1,and Why:1,polygon filling—or:1,filling—or indeed:1,indeed any:1,drawing primitives—anyway:1,primitives—anyway Isn’t:1,Isn’t that:1,what GUIs:1,GUIs and:1,and third-party:1,third-party libraries:1,libraries are:1,for To:1,I answer:1,answer Well:1,am and:1,and If:1,ask you’ve:1,you’ve missed:1,missed the:1,microcomputer programming:1,programming Actually:1,Actually both:1,both questions:1,questions ask:1,is Why:1,Why should:1,programmer have:1,program actually:1,works Put:1,sounds a:1,little different:1,different doesn’t:1,it GUIs:1,GUIs reusable:1,code portable:1,portable code:1,in high-level:1,and object-oriented:1,object-oriented programming:1,the rage:1,rage now:1,and promise:1,promise to:1,remain so:1,The thrust:1,thrust of:1,to enhance:1,enhance the:1,development process:1,by offloading:1,offloading as:1,much responsibility:1,responsibility as:1,other programmers:1,writing all:1,remaining code:1,in modular:1,modular generic:1,generic form:1,form This:1,This modular:1,modular code:1,code then:1,reused endlessly:1,endlessly without:1,without another:1,actually lies:1,lies inside:1,inside GUIs:1,GUIs also:1,also reduce:1,reduce development:1,making many:1,many interface:1,interface choices:1,choices for:1,you That:1,turn makes:1,create quickly:1,and reliably:1,reliably programs:1,easy for:1,new users:1,users to:1,so software:1,software becomes:1,becomes easier:1,both produce:1,produce and:1,learn This:1,without question:1,question a:1,a Good:1,The black:1,box approach:1,approach does:1,however necessarily:1,necessarily cause:1,software itself:1,become faster:1,faster smaller:1,smaller or:1,more innovative:1,innovative quite:1,opposite I:1,suspect I’ll:1,I’ll reserve:1,reserve judgement:1,judgement on:1,whether that:1,thing or:1,I’ll make:1,a prediction:1,prediction In:1,short run:1,aforementioned techniques:1,techniques will:1,will lead:1,to noticeably:1,noticeably larger:1,slower programs:1,programs as:1,programmers understand:1,understand less:1,key parts:1,their programs:1,programs do:1,and rely:1,rely increasingly:1,increasingly on:1,on general-purpose:1,people In:1,run programs:1,be bigger:1,bigger and:1,slower yet:1,but computers:1,computers will:1,have so:1,care Over:1,time PC:1,also come:1,more similar:1,one another—and:1,another—and to:1,to programs:1,other platforms:1,platforms such:1,the Mac—as:1,Mac—as regards:1,regards both:1,both user:1,user interface:1,performance Again:1,Again I:1,is bad:1,does however:1,have major:1,major implications:1,future nature:1,will directly:1,you earn:1,earn your:1,your livings:1,livings Not:1,so very:1,long from:1,now graphics:1,graphics programming—all:1,programming—all programming:1,that matter—will:1,matter—will become:1,become mostly:1,mostly a:1,of assembling:1,assembling in:1,ways components:1,components written:1,people and:1,will cease:1,cease to:1,the all-inclusively:1,all-inclusively creative:1,creative mindbendingly:1,mindbendingly complex:1,complex pursuit:1,is today:1,today Using:1,Using legally:1,legally certified:1,certified black:1,boxes is:1,one direction:1,patent lawyers:1,lawyers are:1,are leading:1,leading us:1,us legal:1,legal considerations:1,considerations may:1,final nail:1,nail in:1,the coffin:1,coffin of:1,of homegrown:1,homegrown code:1,still within:1,within your:1,your power:1,power as:1,PC programmer:1,even control:1,control every:1,single thing:1,computer if:1,realize any:1,any vision:1,vision you:1,have Take:1,Take advantage:1,this unique:1,unique window:1,of opportunity:1,create some:1,some magic:1,magic Neither:1,Neither does:1,it hurt:1,what’s involved:1,drawing say:1,polygon even:1,a GUI:1,GUI You:1,will better:1,better understand:1,available GUI:1,GUI functions:1,any gaps:1,functions provided:1,provided You:1,even find:1,the GUI:1,GUI on:1,on occasion:1,occasion by:1,doing your:1,own drawing:1,memory bitmap:1,bitmap then:1,this under:1,under Windows:1,Windows by:1,WinG library:1,library available:1,Microsoft You:1,why various:1,various quirks:1,quirks exist:1,exist and:1,System follows:1,drawing rules:1,rules described:1,not obvious:1,obvious from:1,System documentation:1,documentation if:1,you understood:1,understood the:1,discussion you’re:1,good shape:1,polygons under:1,under X:1,short even:1,though doing:1,so runs:1,runs counter:1,counter to:1,current trends:1,trends it:1,how things:1,things work:1,you develop:1,develop That:1,said let’s:1,about filling:1,polygons Fast:1,Convex Polygon:1,Filling In:1,In addressing:1,implementation we:1,with met:1,met all:1,our functional:1,functional requirements:1,requirements In:1,it met:1,met stringent:1,stringent rules:1,that guaranteed:1,guaranteed that:1,have gaps:1,gaps at:1,at shared:1,shared edges:1,edges an:1,consideration when:1,when building:1,building polygon-based:1,polygon-based images:1,images Unfortunately:1,also slow:1,molasses In:1,up polygon-filling:1,that’s fast:1,be truly:1,truly usable:1,usable Our:1,original polygon:1,code involved:1,involved three:1,three major:1,major tasks:1,tasks each:1,each performed:1,function Tracing:1,Tracing each:1,coordinate list:1,list performed:1,function ScanEdge:1,ScanEdge Drawing:1,the scanned-out:1,scanned-out horizontal:1,that constitute:1,polygon DrawHorizontalLineList:1,and Characterizing:1,Characterizing the:1,and coordinating:1,coordinating the:1,drawing FillConvexPolygon:1,FillConvexPolygon The:1,program spent:1,these areas:1,areas is:1,39.1 As:1,see half:1,other half:1,half was:1,spent tracing:1,tracing the:1,FillConvexPolygon was:1,was relatively:1,relatively minuscule:1,minuscule so:1,our choice:1,where to:1,begin optimizing:1,optimizing Fast:1,Fast Drawing:1,Drawing Let’s:1,easily sped:1,a double-nested:1,double-nested loop:1,that called:1,a draw-pixel:1,draw-pixel function:1,plot each:1,polygon individually:1,individually That’s:1,a ridiculous:1,ridiculous approach:1,offers linearly:1,linearly mapped:1,mapped memory:1,does VGA:1,working At:1,could point:1,in quick:1,quick succession:1,succession using:1,using something:1,something along:1,of ScrPtr:1,ScrPtr FillColor:1,FillColor inside:1,seems silly:1,silly to:1,instruction REP:1,STOS that’s:1,that’s uniquely:1,filling linear:1,linear memory:1,buffers There’s:1,STOS directly:1,the memset:1,memset library:1,function uses:1,STOS so:1,could greatly:1,greatly enhance:1,enhance performance:1,using memset:1,single shot:1,shot That:1,That however:1,easier said:1,The memset:1,memset function:1,function linked:1,the library:1,small which:1,includes Tiny:1,Tiny Small:1,Small or:1,or Medium:1,Medium data:1,models memset:1,memset accepts:1,accepts only:1,only near:1,pointers so:1,access screen:1,Consequently a:1,large which:1,includes Compact:1,Compact Large:1,Large or:1,or Huge:1,Huge data:1,model must:1,allow memset:1,display memory—a:1,memory—a clear:1,clear case:1,tail wagging:1,wagging the:1,dog This:1,why although:1,do virtually:1,virtually anything:1,anything it’s:1,sometimes much:1,39.1 for:1,DrawHorizontalLineList that:1,uses memset:1,call When:1,When linked:1,38’s test:1,39.1 increases:1,increases pure:1,pure drawing:1,speed disregarding:1,disregarding edge:1,other nondrawing:1,nondrawing time:1,magnitude over:1,over Chapter:1,38’s draw-pixel-based:1,draw-pixel-based code:1,code despite:1,39.1 requires:1,large in:1,the Compact:1,Compact data:1,model Listing:1,39.1 works:1,fine with:1,other compilers:1,compilers for:1,it relies:1,relies on:1,aforementioned interaction:1,between memset:1,the selected:1,selected memory:1,model Table:1,39.1 Polygon:1,Polygon fill:1,fill performance:1,performance Implementation:1,Implementation Total:1,Total Polygon:1,Filling Time:1,Time DrawHorizontal:1,DrawHorizontal LineList:1,LineList ScanEdge:1,ScanEdge FillConvex:1,FillConvex Polygon:1,Polygon Drawing:1,mode 13h:1,13h C:1,point scan/DrawPixel:1,scan/DrawPixel drawing:1,38 small:1,model 11.69:1,11.69 5.80:1,5.80 seconds:1,seconds 50:1,50 of:1,total 5.86:1,5.86 50:1,50 0.03:1,0.03 1:1,point scan/memset:1,39.1 compact:1,model 6.64:1,6.64 0.49:1,0.49 7:1,7 6.11:1,6.11 92:1,92 0.04:1,0.04 1:1,model 0.60:1,0.60 0.49:1,0.49 82:1,82 0.07:1,0.07 12:1,12 0.04:1,0.04 7:1,7 C:1,39.2 Listing:1,39.3 small:1,model 0.45:1,0.45 0.36:1,0.36 80:1,80 0.06:1,0.06 13:1,13 0.03:1,7 ASM:1,40.3 Listing:1,40.4 small:1,model 0.42:1,0.42 0.36:1,0.36 86:1,86 0.03:1,7 0.03:1,7 Drawing:1,memory C:1,model 0.31:1,0.31 0.20:1,0.20 65:1,65 0.07:1,0.07 23:1,23 0.04:1,0.04 13:1,13 ASM:1,39.3 Listing:1,39.4 small:1,model 0.13:1,0.13 0.07:1,0.07 54:1,54 0.03:1,23 0.03:1,23 All:1,seconds as:1,no math:1,coprocessor installed:1,installed Note:1,in main:1,main is:1,included C:1,with maximum:1,optimization G:1,G O:1,O Z:1,Z r:1,r a:1,a assembly:1,was assembled:1,assembled with:1,TASM Percentages:1,Percentages of:1,of combined:1,combined times:1,nearest percent:1,percent so:1,three percentages:1,percentages does:1,always equal:1,equal 100:1,100 At:1,that benchmarks:1,benchmarks are:1,notoriously unreliable:1,unreliable the:1,39.1 are:1,are accurate:1,accurate only:1,particular system:1,system Results:1,Results could:1,be vastly:1,different if:1,if smaller:1,smaller larger:1,larger or:1,or slower:1,slower computer/VGA:1,computer/VGA combination:1,combination were:1,used These:1,These factors:1,factors notwithstanding:1,does fill:1,fill a:1,of varying:1,varying complexity:1,complexity sized:1,sized from:1,to small:1,and certainly:1,certainly the:1,magnitude difference:1,between Listing:1,39.1 and:1,DrawHorizontalLineList is:1,clear indication:1,indication of:1,which code:1,superior Anyway:1,Anyway Listing:1,39.1 has:1,of vastly:1,vastly improving:1,time There:1,cycles yet:1,as tracing:1,tracing polygon:1,edges now:1,now takes:1,takes 92:1,it’s logical:1,logical to:1,code next:1,next Fast:1,Fast Edge:1,Tracing There’s:1,no secret:1,secret as:1,to why:1,why last:1,chapter’s ScanEdge:1,ScanEdge was:1,slow It:1,It used:1,used floating:1,calculations One:1,One secret:1,secret of:1,using integer:1,integer or:1,or fixed-point:1,calculations instead:1,instead Sure:1,coprocessor were:1,were installed:1,installed but:1,alternatives besides:1,besides why:1,why require:1,coprocessor when:1,to Both:1,Both integer:1,cases fixed-point:1,fixed-point is:1,but integer:1,integer calculations:1,one tremendous:1,tremendous virtue:1,virtue They’re:1,They’re completely:1,completely accurate:1,accurate The:1,The tiny:1,tiny imprecision:1,imprecision inherent:1,either fixed:1,fixed or:1,or floating-point:1,calculations can:1,in occasional:1,occasional pixels:1,being one:1,position off:1,great tragedy:1,tragedy but:1,after going:1,to so:1,much trouble:1,trouble to:1,overlap at:1,at common:1,edges why:1,it exactly:1,right In:1,tested out:1,comparing an:1,an integer-based:1,integer-based test:1,test image:1,one produced:1,calculations two:1,screen differed:1,differed leading:1,to suspect:1,suspect a:1,integer code:1,however that’s:1,cases the:1,point results:1,were sufficiently:1,sufficiently imprecise:1,imprecise to:1,creep from:1,just over:1,the ceil:1,ceil function:1,function returned:1,returned a:1,coordinate that:1,one too:1,large Floating:1,Floating point:1,very accurate—but:1,accurate—but it:1,precise Integer:1,Integer calculations:1,calculations properly:1,properly performed:1,performed are:1,are Listing:1,39.2 shows:1,tracing Vertical:1,Vertical and:1,are trivial:1,trace are:1,special-cased Other:1,Other lines:1,are broken:1,two categories:1,categories Y-major:1,Y-major closer:1,to vertical:1,X-major closer:1,to horizontal:1,The handlers:1,handlers for:1,Y-major and:1,X-major cases:1,cases operate:1,pixels advanced:1,advanced per:1,X delta:1,delta of:1,Y delta:1,delta Listing:1,original floating:1,point implementation:1,not painfully:1,painfully so:1,that complexity:1,80 times:1,at scanning:1,scanning edges—and:1,edges—and as:1,just mentioned:1,mentioned it’s:1,code Ya:1,Ya gotta:1,gotta love:1,love that:1,that integer:1,integer arithmetic:1,arithmetic The:1,The Finishing:1,Finishing Touch:1,Touch Assembly:1,Language The:1,now nearly:1,nearly 20:1,original which:1,purposes Still:1,models be:1,for memset:1,obvious next:1,is assembly:1,DrawHorizontalLineList In:1,In actual:1,it proved:1,be about:1,about 36:1,36 percent:1,39.1 better:1,a poke:1,poke in:1,sharp stick:1,stick but:1,barely There’s:1,these timing:1,results than:1,than meets:1,meets that:1,that eye:1,eye though:1,though Display:1,generally responds:1,responds much:1,memory especially:1,systems That:1,processor forced:1,to idle:1,idle by:1,If instead:1,39.3 drew:1,drew to:1,more substantial:1,substantial advantage:1,code And:1,buffer both:1,language versions:1,versions get:1,get 0.29:1,0.29 seconds:1,seconds faster:1,that being:1,states With:1,those wait:1,states factored:1,factored out:1,DrawHorizontalLineList becomes:1,becomes almost:1,almost three:1,code There:1,here An:1,An optimization:1,optimization has:1,no fixed:1,fixed payoff:1,payoff its:1,its value:1,value fluctuates:1,fluctuates according:1,used There’s:1,There’s relatively:1,little benefit:1,further optimizing:1,already spends:1,spends half:1,half its:1,memory no:1,good your:1,optimizations you’ll:1,two-times speedup:1,speedup at:1,hand potential:1,for tremendous:1,your drawing:1,occur optimizations:1,39.3 are:1,effort Know:1,the environments:1,those environments:1,environments Maximizing:1,Maximizing REP:1,STOS Listing:1,39.3 doesn’t:1,STOSB to:1,line instead:1,STOSW to:1,fill as:1,many pixel:1,pairs as:1,via word-sized:1,accesses using:1,using STOSB:1,STOSB only:1,do odd:1,bytes Word:1,Word accesses:1,addresses are:1,always split:1,processor into:1,into 2-byte:1,2-byte accesses:1,accesses Such:1,Such word:1,39.3 makes:1,makes sure:1,all word:1,accesses occur:1,addresses by:1,leading STOSB:1,STOSB first:1,first if:1,the environment:1,run Extra:1,Extra code:1,perform aligned:1,aligned word-at-a-time:1,word-at-a-time filling:1,filling resulting:1,in extra:1,For very:1,or narrow:1,narrow polygons:1,overhead might:1,might overwhelm:1,time making:1,making plain:1,old REP:1,STOSB faster:1,faster Faster:1,Faster Edge:1,Tracing Finally:1,ScanEdge Listing:1,relatively straightforward:1,nonetheless about:1,39.2 The:1,ScanEdge in:1,39.4 could:1,up still:1,loops FillConvexPolygon:1,FillConvexPolygon the:1,overall coordination:1,coordination routine:1,routine hasn’t:1,hasn’t even:1,even been:1,been converted:1,language so:1,well I:1,bothered with:1,with these:1,optimizations because:1,than DrawHorizontalLineList:1,DrawHorizontalLineList takes:1,only 14:1,overall polygon:1,potential return:1,return on:1,optimizing nondrawing:1,simply isn’t:1,isn’t great:1,effort Part:1,profiler is:1,stop optimizing:1,optimizing with:1,Listings 39.3:1,39.3 and:1,and 39.4:1,39.4 in:1,than two-thirds:1,out However:1,However further:1,optimization might:1,worthwhile when:1,memory where:1,the nondrawing:1,significant portion:1,portion 46:1,46 percent:1,Again know:1,go By:1,way note:1,ScanEdge and:1,and FillConvexPolygon:1,we’ve looked:1,at are:1,are adapter-independent:1,adapter-independent and:1,also machine-independent:1,machine-independent all:1,all adapter-specific:1,adapter-specific code:1,is isolated:1,isolated in:1,in DrawHorizontalLineList:1,DrawHorizontalLineList This:1,add support:1,graphics systems:1,systems such:1,the 8514/A:1,8514/A the:1,the XGA:1,XGA or:1,completely non-PC:1,non-PC system:1,system Chapter:1,40 Of:1,Of Songs:1,Songs Taxes:1,Taxes and:1,the Simplicity:1,Simplicity of:1,of Complex:1,Complex Polygons:1,Polygons Dealing:1,Dealing with:1,with Irregular:1,Irregular Polygonal:1,Polygonal Areas:1,Areas Every:1,often my:1,daughter asks:1,asks me:1,to sing:1,sing her:1,sleep If:1,you’ve ever:1,heard me:1,me sing:1,sing this:1,may cause:1,cause you:1,you concern:1,concern about:1,about either:1,either her:1,her hearing:1,hearing or:1,her judgement:1,judgement but:1,but love:1,love knows:1,knows no:1,no bounds:1,bounds As:1,any parent:1,parent is:1,aware singing:1,singing a:1,a young:1,young child:1,child to:1,sleep can:1,take several:1,several hours:1,hours or:1,or until:1,until sunrise:1,sunrise whichever:1,whichever comes:1,comes last:1,last One:1,One night:1,night running:1,running low:1,low on:1,on children’s:1,children’s songs:1,songs I:1,I switched:1,a Beatles:1,Beatles medley:1,medley and:1,last her:1,her breathing:1,breathing became:1,became slow:1,regular At:1,I softly:1,softly sang:1,sang A:1,Night then:1,then quietly:1,quietly stood:1,stood up:1,leave As:1,I tiptoed:1,tiptoed out:1,a voice:1,voice not:1,even faintly:1,faintly tinged:1,tinged with:1,with sleep:1,sleep Dad:1,Dad what:1,they mean:1,mean working:1,working like:1,a dog:1,dog Chasing:1,Chasing a:1,a stick:1,stick That:1,sense people:1,don’t chase:1,chase sticks:1,sticks That:1,That led:1,us into:1,of idioms:1,idioms which:1,much sense:1,her as:1,an explanation:1,of quantum:1,quantum mechanics:1,mechanics Finally:1,fell back:1,my standard:1,standard explanation:1,Universe which:1,it simply:1,simply doesn’t:1,sense As:1,general principle:1,that explanation:1,explanation holds:1,up remarkably:1,fact having:1,my taxes:1,taxes I:1,think Earth:1,Earth is:1,actually run:1,by blob-creatures:1,blob-creatures from:1,planet Mrxx:1,Mrxx who:1,are helplessly:1,helplessly doubled:1,with laughter:1,laughter at:1,the ridiculous:1,ridiculous things:1,things they:1,make us:1,do Let’s:1,Let’s make:1,them get:1,get Social:1,Social Security:1,Security numbers:1,numbers for:1,their pets:1,pets next:1,year they’re:1,they’re saying:1,saying right:1,now gasping:1,gasping for:1,for breath:1,breath Occasionally:1,the rare:1,rare pleasure:1,finding a:1,Universe that:1,sense where:1,everything fits:1,fits together:1,if preordained:1,preordained Filling:1,Filling arbitrary:1,arbitrary polygons:1,case Filling:1,Filling Arbitrary:1,Arbitrary Polygons:1,Polygons In:1,described three:1,polygons convex:1,The RenderMan:1,RenderMan Companion:1,Companion a:1,terrific book:1,by Steve:1,Steve Upstill:1,Upstill Addison-Wesley:1,1990 has:1,an intuitive:1,intuitive definition:1,a rubber:1,rubber band:1,band stretched:1,polygon touches:1,touches all:1,order they’re:1,they’re defined:1,defined then:1,is convex:1,has intersecting:1,edges it’s:1,complex If:1,polygon doesn’t:1,have intersecting:1,but isn’t:1,convex it’s:1,it’s nonconvex:1,nonconvex Nonconvex:1,Nonconvex is:1,convex is:1,nonconvex Which:1,Which I’m:1,I’m well:1,aware makes:1,makes nonconvex:1,nonconvex a:1,lousy name—noncomplex:1,name—noncomplex would:1,been better—but:1,better—but I’m:1,I’m following:1,following X:1,System nomenclature:1,nomenclature here:1,for distinguishing:1,distinguishing between:1,these three:1,more specialized:1,specialized types:1,types can:1,with markedly:1,markedly faster:1,approaches Complex:1,slowest approach:1,serve to:1,fill any:1,sort Nonconvex:1,require less:1,less sorting:1,cross Convex:1,filled fastest:1,simply scanning:1,two sides:1,saw in:1,39 Before:1,we dive:1,dive into:1,filling I’d:1,chapter like:1,seen requires:1,caller describe:1,filled Often:1,caller doesn’t:1,what type:1,polygon it’s:1,it’s passing:1,passing or:1,or specifies:1,specifies complex:1,simplicity because:1,filler will:1,slow complex-fill:1,complex-fill code:1,code even:1,41 I’ll:1,discuss one:1,situation Active:1,Edges The:1,we determine:1,determine all:1,all intersections:1,intersections between:1,then fill:1,spans between:1,the intersections:1,intersections as:1,40.1 Section:1,Section 3.6:1,3.6 of:1,Graphics Second:1,Edition provides:1,filling There:1,several rules:1,which spans:1,which aren’t:1,aren’t we’ll:1,odd/even rule:1,rule which:1,drawing turns:1,on after:1,after odd-numbered:1,odd-numbered intersections:1,intersections first:1,first third:1,off after:1,after even-numbered:1,even-numbered intersections:1,intersections The:1,becomes how:1,we most:1,efficiently determine:1,where As:1,happens there:1,of coherence:1,coherence from:1,next in:1,given Y:1,continues unbroken:1,unbroken until:1,it ends:1,ends In:1,words edges:1,don’t leap:1,leap about:1,start randomly:1,randomly the:1,consistent delta:1,delta from:1,that edge’s:1,edge’s X:1,coordinate at:1,is consistent:1,consistent for:1,edges This:1,for intersection:1,intersection on:1,for intersections:1,intersections with:1,active edges—edges:1,edges—edges that:1,line plus:1,earlier above:1,above scan:1,haven’t ended:1,ended yet—as:1,yet—as shown:1,40.2 This:1,This suggests:1,bottom keeping:1,running list:1,of currently:1,active edges—called:1,edges—called the:1,table AET:1,AET with:1,edges sorted:1,simply fill:1,turn according:1,lines Maintaining:1,Maintaining the:1,next involves:1,steps First:1,must add:1,AET any:1,AET X-sorted:1,X-sorted for:1,for efficient:1,efficient odd/even:1,odd/even scanning:1,scanning Second:1,must remove:1,line Third:1,Third we:1,must advance:1,of error:1,error term-based:1,term-based Bresenham’s-like:1,Bresenham’s-like approach:1,polygons again:1,again ensuring:1,is X-sorted:1,X-sorted after:1,edges Advancing:1,easy For:1,edge we’ll:1,we’ll store:1,current X:1,required error:1,term information:1,we’ll resort:1,resort the:1,needed Removing:1,Removing edges:1,they end:1,also easy:1,easy we’ll:1,just count:1,each active:1,remove an:1,edge when:1,zero Adding:1,Adding edges:1,their tops:1,tops are:1,are encountered:1,encountered is:1,complex While:1,While there:1,efficient approach:1,putting all:1,polygon sorted:1,increasing Y:1,coordinate into:1,list called:1,table GET:1,GET Then:1,Then as:1,encountered all:1,that begin:1,begin on:1,AET because:1,is Y-sorted:1,Y-sorted there’s:1,entire GET:1,GET For:1,For still:1,efficiency edges:1,common Y:1,increasing X:1,coordinate this:1,this ensures:1,AET per:1,ever needed:1,when adding:1,adding new:1,AET sorted:1,X order:1,order What:1,What form:1,form should:1,and AET:1,AET take:1,take Linked:1,edge structures:1,structures as:1,40.3 With:1,With linked:1,lists all:1,move edges:1,AET as:1,active sort:1,AET and:1,been fully:1,fully drawn:1,the exchanging:1,exchanging of:1,pointers In:1,summary we’ll:1,we’ll initially:1,initially store:1,in Y-primary/X-secondary:1,Y-primary/X-secondary sort:1,sort order:1,GET complete:1,with initial:1,initial X:1,coordinates error:1,error terms:1,terms and:1,term adjustments:1,adjustments lengths:1,lengths and:1,directions of:1,movement for:1,edge Once:1,built we’ll:1,following 1:1,first edge:1,GET 2:1,2 Move:1,Move all:1,and maintaining:1,the X-sorted:1,X-sorted order:1,AET 3:1,3 Draw:1,Draw all:1,all odd-to-even:1,odd-to-even spans:1,AET at:1,coordinate 4:1,4 Count:1,Count down:1,removing any:1,remaining edges:1,line 5:1,5 Sort:1,Sort the:1,coordinate 6:1,6 Advance:1,Advance the:1,coordinate by:1,line 7:1,7 If:1,If either:1,AET or:1,or GET:1,GET isn’t:1,isn’t empty:1,empty go:1,lists Figure:1,lists That’s:1,it Compare:1,Compare Listing:1,that contrary:1,to expectation:1,expectation complex:1,more sane:1,sane and:1,and sensible:1,sensible corners:1,universe Complex:1,Complex Polygon:1,Filling An:1,Implementation Listing:1,40.1 just:1,just shown:1,shown presents:1,function FillPolygon:1,FillPolygon that:1,that fills:1,fills polygons:1,all shapes:1,shapes If:1,If CONVEX_FILL_LINKED:1,CONVEX_FILL_LINKED is:1,defined the:1,39 is:1,is linked:1,draw convex:1,polygons Otherwise:1,Otherwise convex:1,were complex:1,complex Nonconvex:1,also handled:1,necessary as:1,discussed shortly:1,shortly Listing:1,40.1 is:1,a faithful:1,faithful implementation:1,approach just:1,described with:1,separate functions:1,functions corresponding:1,the tasks:1,and X-sorting:1,X-sorting the:1,AET Listing:1,40.2 provides:1,actual drawing:1,fill spans:1,spans built:1,a draw:1,draw pixel:1,pixel routine:1,only hardware:1,hardware dependency:1,dependency anywhere:1,40.3 is:1,code note:1,expanded version:1,39 They:1,name but:1,same file:1,file Listing:1,40.4 is:1,when linked:1,to Listings:1,Listings 40.1:1,40.1 and:1,and 40.2:1,40.2 demonstrates:1,demonstrates drawing:1,sorts Listing:1,40.4 illustrates:1,illustrates several:1,filling The:1,and third:1,third polygons:1,drawn illustrate:1,odd/even fill:1,rule The:1,drawn illustrates:1,how holes:1,holes can:1,created in:1,seemingly solid:1,objects an:1,edge runs:1,edges comprising:1,hole are:1,defined and:1,same edge:1,move back:1,outside because:1,edges join:1,join seamlessly:1,seamlessly the:1,rectangle appears:1,solid boundary:1,boundary around:1,hole The:1,The set:1,of V-shaped:1,V-shaped polygons:1,40.4 demonstrate:1,polygons sharing:1,sharing common:1,edges meet:1,meet but:1,not overlap:1,This characteristic:1,characteristic which:1,38 is:1,trivial matter:1,matter it:1,allows polygons:1,together without:1,without fear:1,fear of:1,overlapping or:1,or missed:1,missed pixels:1,general Listing:1,40.1 guarantees:1,filled such:1,that common:1,common boundaries:1,and vertices:1,the side-effect:1,side-effect for:1,any individual:1,individual polygon:1,not drawing:1,lie exactly:1,boundaries or:1,that terminate:1,terminate bottom:1,boundaries By:1,not seen:1,seen polygon:1,filling handled:1,handled precisely:1,way elsewhere:1,elsewhere The:1,The boundary:1,in Foley:1,Dam is:1,similar but:1,but seems:1,not draw:1,all boundary:1,and vertex:1,vertex pixels:1,pixels once:1,once More:1,on Active:1,Edges Edges:1,Edges of:1,zero height—horizontal:1,height—horizontal edges:1,edges defined:1,two vertices:1,same location—never:1,location—never even:1,even make:1,40.1 A:1,zero height:1,height can:1,only run:1,run along:1,span it:1,runs along:1,along is:1,defined not:1,that edge:1,edge but:1,that connect:1,endpoints Performance:1,Performance Considerations:1,Considerations How:1,40.1 When:1,When drawing:1,drawing triangles:1,triangles on:1,20-MHz 386:1,than one-fifth:1,one-fifth the:1,pixels when:1,40.2 is:1,assembly line:1,segment drawing:1,40.5 performance:1,improves by:1,one-half times:1,code Even:1,Even after:1,after conversion:1,40.5 DrawHorizontalLineSeg:1,DrawHorizontalLineSeg still:1,takes more:1,remaining time:1,out fairly:1,fairly evenly:1,evenly over:1,various subroutines:1,subroutines in:1,40.1 Consequently:1,no single:1,to greatly:1,maximum additional:1,additional improvement:1,improvement that’s:1,possible looks:1,looks to:1,reason and:1,limitations I’m:1,assembly However:1,many edges:1,especially one:1,many active:1,time relatively:1,be spent:1,spent traversing:1,lists In:1,In such:1,case conversion:1,assembly which:1,processing could:1,could pay:1,off reasonably:1,to X-sort:1,X-sort the:1,performance consideration:1,consideration Listing:1,40.1 uses:1,sort usually:1,poor choice:1,However bubble:1,sorts perform:1,well when:1,already almost:1,almost sorted:1,X coherence:1,next that’s:1,that’s generally:1,AET An:1,sort might:1,faster depending:1,AET when:1,when any:1,particular sort:1,sort occurs:1,occurs but:1,generally do:1,fine An:1,scans backward:1,backward through:1,than forward:1,AET could:1,edges rarely:1,rarely move:1,move more:1,two positions:1,positions through:1,AET However:1,However scanning:1,scanning backward:1,backward requires:1,list rather:1,the singly:1,list used:1,40.1 I’ve:1,list partly:1,requirements double-linking:1,double-linking requires:1,extra pointer:1,pointer field:1,because supporting:1,supporting back:1,links would:1,potential rewards:1,rewards for:1,of back:1,links and:1,and insertion:1,insertion sorting:1,sorting aren’t:1,aren’t great:1,enough profiling:1,profiling a:1,polygons reveals:1,that less:1,AET The:1,potential 1:1,speedup gained:1,optimizing AET:1,AET sorting:1,sorting just:1,demanding application—a:1,application—a good:1,overall perspective:1,perspective when:1,when comparing:1,theoretical characteristics:1,approaches Nonconvex:1,Nonconvex Polygons:1,Polygons Nonconvex:1,filled somewhat:1,than complex:1,polygons Because:1,Because edges:1,cross or:1,or switch:1,switch positions:1,positions with:1,other edges:1,edges once:1,once they’re:1,AET the:1,AET for:1,a nonconvex:1,nonconvex polygon:1,polygon needs:1,when new:1,added In:1,though edges:1,in strict:1,strict left-to-right:1,left-to-right order:1,order Complications:1,Complications arise:1,same point:1,because slopes:1,slopes must:1,leftmost This:1,certainly doable:1,doable but:1,limited performance:1,performance returns:1,returns I:1,haven’t implemented:1,40.1 Details:1,Details Details:1,Details Every:1,programming demon:1,demon that:1,I’d thought:1,thought I’d:1,I’d forever:1,forever laid:1,laid to:1,to rest:1,rest arises:1,arises to:1,haunt me:1,me once:1,again A:1,minor example:1,of this—an:1,this—an imp:1,imp if:1,mean which:1,done all:1,past and:1,and am:1,am sure:1,sure I’ll:1,do again:1,again That’s:1,That’s minor:1,minor deviltry:1,deviltry though:1,though compared:1,greater evils:1,evils of:1,personal scourges:1,scourges of:1,was recently:1,recently reminded:1,reminded anew:1,anew too-close:1,too-close attention:1,to detail:1,detail Not:1,Not seeing:1,the forest:1,forest for:1,the trees:1,trees Looking:1,Looking low:1,low when:1,looked high:1,high Missing:1,Missing the:1,picture if:1,drift Thoreau:1,Thoreau said:1,it best:1,best Our:1,Our life:1,life is:1,is frittered:1,frittered away:1,away by:1,by detail:1,detail Simplify:1,Simplify simplify:1,simplify That:1,That quote:1,quote sprang:1,sprang to:1,letter a:1,from Anton:1,Anton Treuenfels:1,Treuenfels of:1,of Fridley:1,Fridley Minnesota:1,Minnesota thanking:1,thanking me:1,for clarifying:1,clarifying the:1,filling adjacent:1,adjacent convex:1,my ongoing:1,ongoing writings:1,writings on:1,programming You’ll:1,chapters Anton:1,Anton then:1,then went:1,own method:1,polygons Anton’s:1,Anton’s approach:1,approach had:1,had its:1,its virtues:1,virtues and:1,and drawbacks:1,drawbacks foremost:1,foremost among:1,virtues being:1,a simplicity:1,simplicity Thoreau:1,Thoreau would:1,have admired:1,admired For:1,instance in:1,my polygon-filling:1,spent quite:1,quite some:1,edge was:1,right finally:1,finally settling:1,settling on:1,on comparing:1,polygon wasn’t:1,wasn’t flat:1,flat and:1,and comparing:1,starting points:1,top was:1,was flat:1,flat Anton:1,Anton simplified:1,simplified this:1,this tremendously:1,tremendously by:1,not bothering:1,bothering to:1,left instead:1,instead scanning:1,whatever order:1,order he:1,he found:1,code test:1,necessary swap:1,fill so:1,that filling:1,filling started:1,leftmost edge:1,edge This:1,little slower:1,approach although:1,almost surely:1,surely negligible:1,negligible but:1,makes quite:1,code go:1,away What:1,that example:1,others like:1,in Anton’s:1,Anton’s letter:1,letter did:1,did was:1,was kick:1,kick my:1,mind into:1,it hadn’t—but:1,hadn’t—but should:1,should have—been:1,have—been in:1,wonder How:1,How else:1,I simplify:1,simplify this:1,code what:1,might call:1,call Occam’s:1,Occam’s Razor:1,Razor mode:1,mode You:1,I created:1,created the:1,convex polygon-drawing:1,polygon-drawing code:1,first writing:1,writing pseudocode:1,pseudocode then:1,writing C:1,finally writing:1,writing assembly:1,the pseudocode:1,pseudocode was:1,was finished:1,finished I:1,stopped thinking:1,the interactions:1,interactions of:1,became so:1,so absorbed:1,absorbed in:1,in individual:1,individual details:1,I forgot:1,forgot to:1,whole That:1,mistake and:1,an embarrassing:1,embarrassing one:1,for someone:1,who constantly:1,constantly preaches:1,preaches that:1,that programmers:1,programmers should:1,perspectives the:1,shows just:1,difference thinking:1,picture can:1,make May:1,May my:1,my embarrassment:1,embarrassment be:1,enlightenment The:1,not whether:1,whether in:1,final analysis:1,analysis my:1,or Anton’s:1,Anton’s code:1,better both:1,their advantages:1,was programming:1,programming with:1,a deck:1,deck because:1,so fixated:1,fixated on:1,single type:1,implementation I:1,relatively hard-to-write:1,hard-to-write complex:1,complex code:1,and missed:1,missed out:1,many potentially:1,potentially useful:1,useful optimizations:1,optimizations by:1,by being:1,being so:1,so focused:1,focused It’s:1,big world:1,world out:1,many subtle:1,subtle approaches:1,problem so:1,so relax:1,picture in:1,implement your:1,programs Your:1,Your code:1,will likely:1,be not:1,only better:1,also simpler:1,simpler And:1,And whenever:1,see me:1,me walking:1,walking across:1,across hot:1,hot coals:1,coals in:1,or elsewhere:1,elsewhere when:1,an easier:1,easier way:1,go please:1,know Thanks:1,Thanks Anton:1,Anton Chapter:1,41 Those:1,Those Way-Down:1,Way-Down Polygon:1,Polygon Nomenclature:1,Nomenclature Blues:1,Blues Names:1,Names Do:1,Do Matter:1,Matter when:1,when You:1,You Conceptualize:1,Conceptualize a:1,a Data:1,Data Structure:1,Structure After:1,on polygons:1,Journal that:1,became Chapters:1,Chapters 38-40:1,38-40 long-time:1,long-time reader:1,reader Bill:1,Huber wrote:1,take me:1,to task—and:1,task—and a:1,a well-deserved:1,well-deserved kick:1,the fanny:1,fanny it:1,might add—for:1,add—for my:1,my use:1,of non-standard:1,non-standard polygon:1,polygon terminology:1,those columns:1,columns Unix’s:1,Unix’s X-Window:1,X-Window System:1,System XWS:1,XWS defines:1,defines three:1,categories of:1,polygons complex:1,complex nonconvex:1,convex These:1,These three:1,categories each:1,each a:1,specialized subset:1,preceding category:1,category not-so-coincidentally:1,not-so-coincidentally map:1,map quite:1,nicely to:1,three increasingly:1,increasingly fast:1,fast polygon:1,techniques Therefore:1,Therefore I:1,the XWS:1,XWS names:1,names to:1,techniques The:1,those names:1,names don’t:1,don’t accurately:1,accurately describe:1,techniques are:1,drawing Convex:1,no interior:1,interior angle:1,degrees The:1,The convex:1,convex drawing:1,drawing approach:1,previous few:1,chapters actually:1,actually handles:1,handles a:1,polygon through:1,no horizontal:1,that intersects:1,boundary more:1,boundary reverses:1,direction exactly:1,twice disregarding:1,disregarding polygons:1,have degenerated:1,degenerated into:1,into horizontal:1,ignore Bill:1,Bill was:1,send me:1,pages out:1,of Computational:1,Computational Geometry:1,Geometry An:1,Introduction Springer-Verlag:1,Springer-Verlag 1988:1,1988 that:1,correct terminology:1,terminology such:1,fact monotone:1,line which:1,which unfortunately:1,unfortunately makes:1,rather long:1,long define:1,define variable:1,variable Actually:1,Actually to:1,precise I’d:1,I’d call:1,them monotone:1,simple where:1,where simple:1,simple means:1,not self-intersecting:1,self-intersecting Similarly:1,polygon type:1,type I:1,called nonconvex:1,nonconvex is:1,actually simple:1,suppose what:1,called complex:1,complex should:1,as nonsimple:1,nonsimple or:1,maybe just:1,just none:1,like nit-picking:1,nit-picking but:1,actually it:1,isn’t what:1,what it’s:1,really about:1,tremendous importance:1,a shared:1,shared language:1,language In:1,books Richard:1,Richard Feynman:1,Feynman describes:1,describes having:1,having developed:1,developed his:1,own mathematical:1,mathematical framework:1,framework complete:1,own notation:1,notation and:1,and terminology:1,school When:1,he got:1,to college:1,college and:1,started working:1,his level:1,level he:1,suddenly understood:1,understood that:1,people can’t:1,can’t share:1,ideas effectively:1,effectively unless:1,they speak:1,speak the:1,same language:1,language otherwise:1,otherwise they:1,they waste:1,waste a:1,on misunderstandings:1,misunderstandings and:1,explanation Or:1,as Bill:1,Huber put:1,adopt your:1,own terminology:1,terminology when:1,it suits:1,suits your:1,your purposes:1,purposes well:1,well But:1,But you:1,risk losing:1,losing or:1,or confusing:1,confusing those:1,among your:1,most astute:1,astute readers—those:1,readers—those who:1,who already:1,been trained:1,trained in:1,same or:1,a related:1,related field:1,field Ditto:1,Ditto Likewise:1,Likewise D’accord:1,D’accord And:1,And mea:1,culpa I:1,I shall:1,shall endeavor:1,watch my:1,my language:1,future Nomenclature:1,Nomenclature in:1,Action Just:1,Just to:1,difference proper:1,proper description:1,description and:1,and interchange:1,interchange of:1,of ideas:1,make consider:1,of identifying:1,identifying convex:1,polygons When:1,about polygons:1,DDJ a:1,a nonfunctional:1,nonfunctional method:1,for identifying:1,identifying such:1,such polygons—checking:1,polygons—checking for:1,two X:1,X direction:1,two Y:1,changes around:1,the perimeter:1,perimeter of:1,the polygon—crept:1,polygon—crept into:1,column by:1,by accident:1,accident That:1,That method:1,method as:1,noted in:1,later column:1,column does:1,work That’s:1,won’t find:1,book Still:1,Still a:1,fast method:1,be highly:1,desirable because:1,39 rather:1,slow general-purpose:1,40 Now:1,consider Bill’s:1,Bill’s point:1,drawing convex:1,our convex:1,actually handle:1,any simple:1,simple polygon:1,line Additionally:1,Additionally consider:1,consider Anton:1,Anton Treuenfels’s:1,Treuenfels’s point:1,point made:1,made back:1,40 that:1,that life:1,life gets:1,gets simpler:1,simpler if:1,stop worrying:1,and instead:1,instead just:1,at whichever:1,whichever edge:1,left-most Now:1,Now what:1,have What:1,approach passed:1,Kent of:1,Animator fame:1,fame If:1,we modify:1,check which:1,left-most on:1,drawing there:1,described then:1,line regardless:1,cross I’ll:1,this monotone-vertical:1,monotone-vertical from:1,anyone wants:1,to correct:1,correct that:1,terminology jump:1,then handle:1,handle nonsimple:1,nonsimple polygons:1,are monotone-vertical:1,monotone-vertical self-intersection:1,self-intersection is:1,problem We:1,scan around:1,polygon’s perimeter:1,perimeter looking:1,two direction:1,direction reversals:1,reversals along:1,axis only:1,that proves:1,proves to:1,speed Figure:1,shows polygons:1,a monotone-vertical:1,monotone-vertical capable:1,capable filler:1,filler Figure:1,41.2 shows:1,some that:1,cannot Listing:1,Listing 41.1:1,is appropriately:1,appropriately monotone:1,monotone Listings:1,Listings 41.2:1,41.2 and:1,and 41.3:1,41.3 are:1,are variants:1,variants of:1,39 modified:1,all monotone-vertical:1,monotone-vertical polygons:1,polygons including:1,including nonsimple:1,nonsimple ones:1,ones the:1,39 remains:1,shown again:1,again here:1,here Figure:1,almost identical:1,40.1 from:1,40 I’ve:1,I’ve modified:1,modified Listing:1,the vertical-monotone:1,vertical-monotone detection:1,detection test:1,test we’ve:1,been talking:1,fast vertical-monotone:1,vertical-monotone drawing:1,code whenever:1,is Note:1,40.5 from:1,40 is:1,link Listing:1,Listing 41.5:1,41.5 is:1,appropriately updated:1,updated version:1,the POLYGON.H:1,POLYGON.H header:1,file Is:1,Is monotone-vertical:1,monotone-vertical polygon:1,polygon detection:1,detection worth:1,this trouble:1,trouble Under:1,you bet:1,bet In:1,situation where:1,application either:1,either doesn’t:1,they’re monotone-vertical:1,monotone-vertical or:1,are performance:1,increased considerably:1,considerably if:1,most polygons:1,fact monotone-vertical:1,monotone-vertical This:1,This potential:1,helped along:1,the surprising:1,surprising fact:1,that Jim’s:1,Jim’s test:1,for monotone-vertical:1,monotone-vertical status:1,original nonfunctional:1,nonfunctional test:1,for convexity:1,convexity See:1,See what:1,what accurate:1,accurate terminology:1,terminology and:1,and effective:1,effective communication:1,communication can:1,42 Wu’ed:1,Wu’ed in:1,in Haste:1,Haste Fried:1,Fried Stewed:1,Stewed at:1,at Leisure:1,Leisure Fast:1,Fast Antialiased:1,Antialiased Lines:1,Using Wu’s:1,Wu’s Algorithm:1,thought first:1,first popped:1,head as:1,I unenthusiastically:1,unenthusiastically picked:1,picked through:1,the salad:1,salad bar:1,bar at:1,local family:1,restaurant trying:1,the meatballs:1,meatballs the:1,the fried:1,fried clams:1,clams or:1,the lasagna:1,lasagna was:1,was likely:1,to shorten:1,shorten my:1,life the:1,decided on:1,the chicken:1,chicken in:1,in mystery:1,mystery sauce:1,sauce The:1,thought recurred:1,recurred when:1,daughter asked:1,asked Dad:1,Dad is:1,that fried:1,it’s stewed:1,chicken It:1,like fried:1,chicken Maybe:1,Maybe it’s:1,it’s fried:1,chicken my:1,wife volunteered:1,volunteered hopefully:1,hopefully I:1,a bite:1,bite It:1,indeed fried:1,now unhesitatingly:1,unhesitatingly and:1,without reservation:1,reservation recommend:1,you avoid:1,avoid fried:1,chicken at:1,costs The:1,had was:1,good food:1,food Not:1,a profound:1,profound thought:1,thought but:1,it raises:1,raises an:1,interesting question:1,I eating:1,eating in:1,this restaurant:1,restaurant The:1,to borrow:1,borrow a:1,a phrase:1,phrase from:1,from E.F:1,E.F Schumacher:1,Schumacher is:1,is appropriate:1,technology For:1,a family:1,family on:1,a budget:1,budget with:1,small child:1,child tired:1,of staring:1,staring at:1,other over:1,kitchen table:1,table this:1,perfect place:1,eat It:1,was cheap:1,cheap it:1,had greasy:1,greasy food:1,food and:1,and ice:1,cream no:1,one cared:1,cared if:1,if children:1,children dropped:1,dropped things:1,things or:1,or talked:1,talked loudly:1,loudly or:1,or walked:1,walked around:1,important of:1,wasn’t home:1,the food:1,was lousy:1,lousy Good:1,Good food:1,a luxury:1,luxury a:1,bonus everything:1,everything on:1,above list:1,list was:1,necessary A:1,A family:1,restaurant was:1,appropriate dining-out:1,dining-out technology:1,technology given:1,parameters within:1,work When:1,through SIGGRAPH:1,SIGGRAPH proceedings:1,proceedings and:1,other state-of-the-art:1,state-of-the-art computer-graphics:1,computer-graphics material:1,material all:1,often I:1,like I’m:1,I’m dining:1,dining at:1,a four-star:1,four-star restaurant:1,restaurant with:1,with two-year-old:1,two-year-old triplets:1,triplets and:1,empty wallet:1,wallet We’re:1,talking incredibly:1,incredibly inappropriate:1,inappropriate technology:1,graphics here:1,here Sure:1,Sure I:1,to myself:1,myself as:1,an antialiasing:1,that sounds:1,sounds wonderful—if:1,wonderful—if I:1,had 24-bpp:1,24-bpp color:1,and dedicated:1,dedicated hardware:1,one image:1,image Yes:1,surface removal—in:1,removal—in a:1,hardware z-buffering:1,z-buffering Most:1,the journal:1,journal Computer:1,Graphics is:1,is riveting:1,riveting but:1,alas pretty:1,much useless:1,useless on:1,PCs When:1,When an:1,an x86:1,work speed:1,speed becomes:1,overriding parameter:1,parameter especially:1,real-time graphics:1,graphics Literature:1,Literature that’s:1,that’s applicable:1,fast PC:1,hard enough:1,is above-average:1,above-average image:1,quality combined:1,no literature:1,literature of:1,sort around:1,around There:1,some however:1,are right:1,example alert:1,alert reader:1,reader Michael:1,Michael Chaplin:1,Chaplin of:1,San Diego:1,Diego wrote:1,might enjoy:1,enjoy the:1,the line-antialiasing:1,line-antialiasing algorithm:1,in Xiaolin:1,Xiaolin Wu’s:1,article An:1,An Efficient:1,Efficient Antialiasing:1,Antialiasing Technique:1,Technique in:1,July 1991:1,Graphics Michael:1,Michael was:1,was dead-on:1,dead-on right:1,right This:1,great algorithm:1,algorithm combining:1,combining excellent:1,excellent antialiased:1,quality with:1,speed that’s:1,that’s close:1,of non-antialiased:1,non-antialiased Bresenham’s:1,of algorithm:1,a wire-frame:1,wire-frame animation:1,good those:1,those smooth:1,smooth lines:1,motion Wu:1,wonderful example:1,what can:1,accomplished on:1,on inexpensive:1,inexpensive mass-market:1,mass-market hardware:1,hardware with:1,proper programming:1,perspective In:1,short it’s:1,a splendid:1,splendid example:1,of appropriate:1,PCs Wu:1,Antialiasing Antialiasing:1,Antialiasing as:1,discussing for:1,chapters is:1,of smoothing:1,smoothing lines:1,appear less:1,less jagged:1,jagged Antialiasing:1,Antialiasing is:1,is partly:1,an aesthetic:1,aesthetic issue:1,images more:1,attractive It’s:1,also partly:1,accuracy issue:1,to position:1,with effectively:1,effectively more:1,more precision:1,precision than:1,display Finally:1,it’s partly:1,partly a:1,a flat-out:1,flat-out necessity:1,necessity to:1,the horrible:1,horrible crawling:1,crawling jagged:1,jagged edges:1,of temporal:1,aliasing when:1,performing animation:1,almost ridiculously:1,simple As:1,algorithm steps:1,steps one:1,pixel unit:1,unit at:1,pixels bracketing:1,bracketing the:1,point Each:1,a weighted:1,weighted fraction:1,the weighting:1,weighting for:1,pixel equal:1,one minus:1,pixel’s distance:1,axis from:1,line Yes:1,Yes it’s:1,a mouthful:1,mouthful but:1,but Figure:1,The intensities:1,that bracket:1,bracket the:1,are selected:1,selected so:1,always sum:1,one fully:1,fully illuminated:1,illuminated pixel:1,aggregate full-pixel:1,full-pixel intensity:1,intensity means:1,same brightness:1,brightness it:1,pixel were:1,location Moreover:1,Moreover thanks:1,weighting that:1,that brightness:1,brightness is:1,is centered:1,centered at:1,line Not:1,coincidentally a:1,with pixel:1,aggregate single-pixel:1,single-pixel intensity:1,intensity centered:1,is perceived:1,jagged collection:1,pairs but:1,line centered:1,line Thus:1,Thus by:1,by weighting:1,weighting the:1,the bracketing:1,step we:1,readily produce:1,produce what:1,what looks:1,right location:1,location rather:1,that non-antialiased:1,algorithms such:1,as Bresenham’s:1,Bresenham’s see:1,Chapters 35:1,35 36:1,36 and:1,and 37:1,37 trace:1,out Figure:1,antialiasing Figure:1,antialiasing You:1,antialiasing would:1,would fall:1,distinct areas:1,areas tracing:1,tracing out:1,is finding:1,appropriate pixel:1,and calculating:1,appropriate weightings:1,weightings for:1,pair Not:1,so however:1,The weighting:1,weighting calculations:1,calculations involve:1,few shifts:1,shifts XORs:1,XORs and:1,purposes tracing:1,and weighting:1,weighting are:1,are rolled:1,rolled into:1,one step—and:1,step—and a:1,fast step:1,step it:1,a 33-MHz:1,33-MHz 486:1,VGA a:1,not maxed-out:1,maxed-out assembly:1,antialiasing draws:1,than respectable:1,respectable 5000:1,5000 150-pixel-long:1,150-pixel-long vectors:1,vectors per:1,especially impressive:1,about 1500000:1,1500000 actual:1,actual pixels:1,drawn per:1,second meaning:1,that Wu:1,memory bandwidth—half:1,bandwidth—half the:1,fastest theoretically:1,possible drawing:1,drawing speed—of:1,speed—of an:1,an AT-bus:1,AT-bus VGA:1,short Wu:1,fast an:1,an antialiased:1,line approach:1,ever hope:1,find for:1,VGA Tracing:1,Tracing and:1,and Intensity:1,Intensity in:1,in One:1,One Horizontal:1,Horizontal vertical:1,lines do:1,require Wu:1,antialiasing because:1,they pass:1,pixel they:1,they meet:1,meet such:1,fast special-case:1,cases Wu:1,Wu lines:1,are traced:1,out one:1,one step:1,step at:1,axis by:1,simple fixed-point:1,fixed-point algorithm:1,one-pixel move:1,line slope:1,slope for:1,slopes less:1,1 1/slope:1,1/slope for:1,slopes greater:1,integer divide:1,divide This:1,value called:1,fixed-point fraction:1,fraction in:1,format that:1,are fractional:1,fractional and:1,the decimal:1,decimal point:1,15 An:1,An error:1,accumulator also:1,is initialized:1,initialized to:1,0 Then:1,drawn no:1,no weighting:1,needed because:1,intersects its:1,endpoints exactly:1,exactly Now:1,accumulator The:1,accumulator indicates:1,indicates how:1,far between:1,has progressed:1,progressed along:1,given step:1,over it’s:1,advance one:1,axis At:1,the major-axis:1,advances by:1,draw are:1,simply the:1,axis For:1,instance if:1,if X:1,current major-axis:1,current minor-axis:1,minor-axis coordinate:1,coordinate the:1,drawn are:1,are XY:1,XY and:1,and XY:1,XY 1:1,draw involves:1,than advancing:1,axis adding:1,accumulator and:1,axis when:1,over So:1,far nothing:1,nothing special:1,special but:1,true wonder:1,antialiasing We:1,which pair:1,two proper:1,proper intensities:1,intensities which:1,be inversely:1,inversely proportional:1,to distance:1,and sum:1,potentially time-consuming:1,time-consuming operation:1,operation Let’s:1,assume however:1,of possible:1,possible intensity:1,levels to:1,for weighting:1,value NumLevels:1,NumLevels 2:1,n for:1,some integer:1,integer n:1,minimum weighting:1,weighting 0:1,value 2:1,maximum weighting:1,weighting 100:1,0 Given:1,that lo:1,lo and:1,and behold:1,behold the:1,significant n:1,accumulator select:1,proper intensity:1,42.2 Better:1,yet 2:1,1 minus:1,pixel selects:1,the pair:1,pair because:1,the intensities:1,must sum:1,happens this:1,this result:1,obtained simply:1,the n:1,n least-significant:1,least-significant bits:1,value All:1,because what:1,accumulator accumulates:1,accumulates is:1,ideal line’s:1,line’s current:1,current distance:1,pixels Figure:1,calculations Figure:1,The intensity:1,describe than:1,that’s involved:1,involved is:1,accumulator to:1,to right-justify:1,right-justify the:1,desired intensity:1,weighting bits:1,an XOR:1,XOR to:1,the least-significant:1,least-significant n:1,second pixel’s:1,illustrates just:1,how efficient:1,efficient Wu:1,three statements:1,entire Wu:1,Wu line-drawing:1,only nine:1,nine statements:1,statements long:1,long Of:1,single C:1,C statement:1,statement can:1,can hide:1,hide a:1,complexity but:1,42.6 an:1,implementation shows:1,15 instructions:1,per step:1,major axis—and:1,axis—and the:1,to ten:1,ten by:1,by special-casing:1,special-casing and:1,and loop:1,unrolling Make:1,it Wu:1,fast Sample:1,Sample Wu:1,Antialiasing The:1,The true:1,true test:1,any antialiasing:1,looks so:1,at Wu:1,42.1 is:1,antialiasing Listing:1,Listing 42.2:1,42.2 is:1,of Wu-antialiased:1,lines followed:1,by non-antialiased:1,comparison Listing:1,42.3 contains:1,contains DrawPixel:1,DrawPixel and:1,and SetMode:1,SetMode functions:1,mode Finally:1,Listing 42.4:1,42.4 is:1,simple non-antialiased:1,line-drawing routine:1,routine Link:1,Link these:1,these four:1,four listings:1,listings together:1,see both:1,both Wu-antialiased:1,Wu-antialiased and:1,and non-antialiased:1,lines Listing:1,fast because:1,calls DrawPixel:1,DrawPixel for:1,hand DrawPixel:1,DrawPixel makes:1,try out:1,modes just:1,just adapt:1,adapt the:1,42.3 for:1,support For:1,Listing 42.5:1,42.5 shows:1,draw Wu-antialiased:1,640x480 256-color:1,SuperVGAs built:1,the Tseng:1,Tseng Labs:1,Labs ET4000:1,ET4000 chip:1,chip with:1,least 512K:1,512K of:1,memory installed:1,installed It’s:1,worth checking:1,checking out:1,antialiasing at:1,640x480 Although:1,Although antialiased:1,much smoother:1,smoother than:1,normal lines:1,resolution they’re:1,they’re far:1,perfect because:1,so big:1,big that:1,eye can’t:1,can’t blend:1,blend them:1,properly At:1,At 640x480:1,640x480 however:1,however Wu-antialiased:1,look fabulous:1,fabulous from:1,of feet:1,away they:1,look as:1,as straight:1,straight and:1,smooth as:1,a ruler:1,ruler Listing:1,42.1 requires:1,DAC palette:1,palette be:1,a NumLevel:1,NumLevel long:1,long block:1,palette entries:1,entries contains:1,contains linearly:1,linearly decreasing:1,decreasing intensities:1,block is:1,is programmable:1,programmable but:1,a power:1,more intensity:1,better Wu:1,Wu says:1,that 32:1,32 intensities:1,intensities are:1,are enough:1,system eight:1,eight and:1,even four:1,four levels:1,levels looked:1,looked pretty:1,that gamma:1,gamma correction:1,correction which:1,gives linearly:1,linearly spaced:1,spaced intensity:1,steps improved:1,improved antialiasing:1,antialiasing quality:1,quality significantly:1,significantly Fortunately:1,Fortunately we:1,with gamma-corrected:1,gamma-corrected values:1,work Listing:1,fast so:1,implemented Wu:1,assembly hard-coded:1,hard-coded for:1,full in:1,42.6 High-speed:1,High-speed graphics:1,fast VGAs:1,VGAs go:1,go together:1,together like:1,like peanut:1,peanut butter:1,butter and:1,and jelly:1,jelly which:1,say very:1,well indeed:1,implementation ran:1,ran more:1,my 486:1,486 Enough:1,said Notes:1,on Wu:1,Antialiasing Wu:1,antialiasing can:1,any curve:1,curve for:1,calculate at:1,the positions:1,positions and:1,and intensities:1,pixels although:1,implementation will:1,be nowhere:1,as efficient:1,lines However:1,However Wu’s:1,article in:1,in Computer:1,Graphics does:1,does describe:1,describe an:1,efficient algorithm:1,antialiased circles:1,circles Wu:1,Wu also:1,technique for:1,antialiasing solids:1,solids such:1,filled circles:1,polygons Wu’s:1,Wu’s approach:1,approach biases:1,biases the:1,of filled:1,filled objects:1,objects outward:1,outward Although:1,for adjacent:1,rendering it’s:1,accurate polygon-antialiasing:1,polygon-antialiasing approach:1,approach around:1,around Wu’s:1,Wu’s basic:1,basic weighting:1,weighting technique:1,technique The:1,results would:1,as more:1,sophisticated antialiasing:1,antialiasing techniques:1,results obtained:1,by Wu:1,antialiasing are:1,only so-so:1,so-so by:1,by theoretical:1,theoretical measures:1,measures Wu:1,antialiasing amounts:1,simple box:1,box filter:1,filter placed:1,placed over:1,fixed-point step:1,step approximation:1,that process:1,process introduces:1,introduces a:1,of deviation:1,deviation from:1,ideal On:1,hand Wu:1,Wu notes:1,percent error:1,intensity doesn’t:1,doesn’t lead:1,to noticeable:1,noticeable loss:1,of image:1,lines up:1,to 1K:1,1K pixels:1,length the:1,under 10:1,percent If:1,is good—and:1,good—and it:1,good With:1,16-bit error:1,accumulator fixed-point:1,inaccuracy becomes:1,lines longer:1,than 1K:1,1K For:1,lines you:1,should switch:1,32-bit error:1,error values:1,values which:1,you handle:1,handle lines:1,any practical:1,practical length:1,to truncate:1,truncate rather:1,than round:1,round the:1,the error-adjust:1,error-adjust value:1,This increases:1,intensity error:1,but guarantees:1,that fixed-point:1,inaccuracy won’t:1,won’t cause:1,advance past:1,endpoint Overrunning:1,Overrunning the:1,endpoint would:1,the line’s:1,line’s bounding:1,box and:1,potentially even:1,access pixels:1,pixels off:1,bitmap Finally:1,as published:1,published Wu’s:1,Wu’s algorithm:1,algorithm draws:1,lines symmetrically:1,symmetrically from:1,ends at:1,once I:1,that symmetric:1,an inefficient:1,inefficient way:1,span banks:1,banks on:1,on banked:1,banked Super-VGAs:1,Super-VGAs Banking:1,Banking aside:1,aside however:1,however symmetric:1,potentially faster:1,eliminates half:1,it cuts:1,cuts cumulative:1,well With:1,With or:1,without symmetrical:1,symmetrical processing:1,processing Wu:1,antialiasing beats:1,beats fried:1,chicken hands-down:1,hands-down Trust:1,one Chapter:1,Chapter 43:1,43 Bit-Plane:1,Animation A:1,Simple and:1,and Extremely:1,Extremely Fast:1,Fast Animation:1,Animation Method:1,Method for:1,for Limited:1,Limited Color:1,Color When:1,to computers:1,computers my:1,first love:1,love is:1,is animation:1,a miniature:1,miniature reality:1,reality simply:1,rearranging a:1,memory What:1,makes animation:1,happen fast:1,without blinking:1,blinking and:1,and flickering:1,flickering or:1,or else:1,else you:1,risk destroying:1,and solidity:1,solidity Those:1,Those constraints:1,constraints make:1,make animation:1,toughest graphics:1,graphics challenge—and:1,challenge—and also:1,rewarding It:1,It pains:1,pains me:1,hear industry:1,industry pundits:1,pundits rag:1,rag on:1,PC when:1,animation Okay:1,Okay I’ll:1,a Silicon:1,Silicon Graphics:1,Graphics workstation:1,workstation and:1,never will:1,else on:1,market The:1,VGA offers:1,offers good:1,good resolution:1,hardware wasn’t:1,wasn’t designed:1,mean we:1,that capacity:1,capacity One:1,One lesson:1,good PC:1,graphics or:1,programmer learns:1,learns quickly:1,quickly is:1,it’s what:1,can do—not:1,do—not what:1,was intended:1,to do—that’s:1,do—that’s important:1,important By:1,pick one:1,to dump:1,dump on:1,be sound:1,sound not:1,not animation:1,The PC’s:1,PC’s sound:1,sound circuity:1,circuity really:1,is lousy:1,lousy and:1,cheap sound:1,sound chip—which:1,chip—which even:1,the almost-forgotten:1,almost-forgotten PC/jr/had—would:1,PC/jr/had—would have:1,changed everything:1,guess IBM:1,IBM figured:1,figured serious:1,serious computer:1,computer users:1,users would:1,put off:1,computer that:1,make fun:1,fun noises:1,noises Anyway:1,my point:1,PC’s animation:1,animation capabilities:1,good There’s:1,trick though:1,its animation:1,animation limits:1,limits by:1,by stretching:1,using some:1,unorthodox approaches:1,fact stretching:1,producing good:1,task on:1,the PC—that’s:1,PC—that’s the:1,book For:1,most software:1,software however:1,fatal if:1,isn’t excellent—there’s:1,excellent—there’s slow:1,but functional:1,functional software:1,software all:1,place When:1,animation though:1,won’t get:1,first base:1,base without:1,clever approach:1,approach So:1,what clever:1,clever approaches:1,approaches do:1,mind All:1,sorts The:1,The resources:1,resources of:1,even its:1,its now-ancient:1,now-ancient predecessor:1,predecessor the:1,EGA are:1,varied and:1,applied and:1,and combined:1,in hundreds:1,produce effective:1,effective animation:1,animation For:1,example refer:1,23 for:1,flipping Or:1,1986 issue:1,which describes:1,basic block-move:1,block-move animation:1,technique or:1,the August:1,August 1987:1,a software-sprite:1,software-sprite scheme:1,scheme built:1,EGA’s vertical:1,vertical interrupt:1,interrupt and:1,the AND-OR:1,AND-OR image:1,drawing technique:1,technique Or:1,contains dozens:1,of tips:1,tips and:1,and tricks:1,animation including:1,including Mode:1,Mode X-based:1,X-based techniques:1,techniques starting:1,47 that:1,many commercial:1,commercial games:1,games This:1,chapter adds:1,adds yet:1,list We’re:1,the bit-plane:1,bit-plane architecture:1,develop an:1,animation architecture:1,architecture that:1,several overlapping:1,virtually perfect:1,perfect visual:1,quality This:1,technique produces:1,overlap effects:1,possible method:1,method to:1,draw images—the:1,images—the REP:1,instruction It:1,It has:1,its limitations:1,limitations but:1,unlike Mode:1,techniques the:1,be important:1,some applications:1,applications As:1,any technique:1,technique on:1,PC there:1,are tradeoffs:1,tradeoffs involved:1,animation While:1,While bit-plane:1,extremely attractive:1,as performance:1,and visual:1,quality are:1,concerned it:1,somewhat limited:1,limited Bit-plane:1,animation supports:1,supports only:1,colors plus:1,preferable that:1,color not:1,not intersect:1,intersect It:1,matter if:1,if bit-plane:1,isn’t perfect:1,all applications:1,applications though:1,real point:1,of showing:1,you bit-plane:1,bring home:1,the reality:1,reality that:1,complex adapter:1,adapter with:1,with many:1,many resources:1,do remarkable:1,things if:1,understand those:1,those resources:1,with creative:1,creative ways:1,tasks Bit-Planes:1,Bit-Planes The:1,Basics The:1,The underlying:1,underlying principle:1,extremely simple:1,simple The:1,separate bit:1,12H Plane:1,Plane 0:1,contains data:1,1 normally:1,contains green:1,green pixel:1,data plane:1,2 red:1,3 intensity:1,intensity pixel:1,pixel data—but:1,data—but we’re:1,mix that:1,moment so:1,simply refer:1,as planes:1,3 from:1,Each bit:1,bit plane:1,independently The:1,generate pixels:1,planes However:1,stage on:1,to becoming:1,becoming pixels—they’re:1,pixels—they’re used:1,6-bit color:1,the sixteen:1,sixteen palette:1,planes feed:1,feed into:1,VGA specifically:1,specifically the:1,registers goes:1,DAC for:1,additional look-up:1,stage as:1,Chapters 33:1,and 34:1,34 and:1,also Chapter:1,CD-ROM Take:1,good look:1,43.1 Any:1,Any light:1,light bulbs:1,bulbs going:1,on over:1,head yet:1,yet If:1,not consider:1,The general:1,general problem:1,and time-consuming:1,as most:1,most do:1,avoid interference:1,interference problems:1,images intersect:1,intersect since:1,images share:1,same bits:1,memory Since:1,from independently:1,independently it:1,display images:1,plane independently:1,independently of:1,whatever images:1,planes we:1,could manipulate:1,manipulate very:1,easily There:1,There would:1,interference effects:1,effects between:1,between images:1,plane wouldn’t:1,wouldn’t share:1,share bits:1,another plane:1,plane What’s:1,image would:1,would reside:1,do away:1,the cumbersome:1,cumbersome programming:1,VGA’s complex:1,complex hardware:1,color All:1,deal if:1,43.2 However:1,However a:1,problem arises:1,planes overlap:1,The combined:1,combined bits:1,from overlapping:1,images generate:1,generate new:1,colors so:1,the overlapping:1,overlapping parts:1,images don’t:1,like they:1,they belong:1,belong to:1,two images:1,images What:1,want of:1,other It:1,yet if:1,the rearward:1,rearward image:1,image showed:1,showed through:1,through any:1,any transparent:1,transparent that:1,is background-colored:1,background-colored parts:1,the forward:1,forward image:1,image Can:1,that You:1,bet Figure:1,colors Figure:1,colors Stacking:1,Stacking the:1,Palette Registers:1,Registers Suppose:1,of viewing:1,of sixteen:1,sixteen colorswe:1,colorswe view:1,colors If:1,0 say:1,say red:1,red The:1,1 would:1,1 say:1,say green:1,green the:1,color 2:1,2 say:1,say blue:1,color 3:1,3 say:1,say white:1,white Whenever:1,Whenever more:1,the lowest-numbered:1,lowest-numbered plane:1,would determine:1,ignored Finally:1,any 1:1,all would:1,color say:1,say black:1,black That:1,us four:1,us nifty:1,nifty image:1,precedence with:1,0 appearing:1,planes images:1,1 appearing:1,would even:1,even give:1,us transparency:1,transparency where:1,where rearward:1,rearward images:1,would show:1,holes within:1,within and:1,in forward:1,forward planes:1,planes Finally:1,Finally and:1,most importantly:1,importantly it:1,would meet:1,meet all:1,the criteria:1,criteria needed:1,plane letting:1,us manipulate:1,images very:1,no reprogramming:1,hardware other:1,few OUT:1,instructions required:1,to Which:1,get this:1,this magical:1,magical pixel-precedence:1,pixel-precedence scheme:1,scheme to:1,is reprogram:1,reprogram the:1,precedence determines:1,colors described:1,above are:1,are summarized:1,43.1 Remember:1,4-bit values:1,values coming:1,memory select:1,which palette:1,actual pixel:1,rightmost 1-bit:1,1-bit of:1,bits coming:1,43.1 selects:1,red no:1,43.4 If:1,settings we:1,we instantly:1,instantly have:1,have exactly:1,want which:1,that keeps:1,keeps images:1,from interfering:1,while providing:1,providing precedence:1,precedence and:1,and transparency:1,transparency Table:1,43.1 Palette:1,animation Bit:1,Bit Value:1,Value For:1,For Plane:1,Plane 3:1,3 2:1,2 1:1,0 Palette:1,Register setting:1,setting 0:1,black 0:1,1 3CH:1,2 3AH:1,3 3CH:1,4 39H:1,5 3CH:1,0 6:1,6 3AH:1,1 7:1,7 3CH:1,0 8:1,8 3FH:1,3FH white:1,white 1:1,1 9:1,9 3CH:1,0 10:1,10 3AH:1,1 11:1,11 3CH:1,0 12:1,12 39H:1,blue 1:1,1 13:1,13 3CH:1,0 14:1,14 3AH:1,1 15:1,15 3CH:1,red Figure:1,works Figure:1,works Seems:1,Seems almost:1,almost too:1,too easy:1,it Nonetheless:1,beautifully as:1,see very:1,shortly First:1,nothing sacred:1,sacred about:1,about plane:1,0 having:1,having precedence:1,precedence We:1,settings so:1,any plane:1,plane had:1,precedence followed:1,order I’ve:1,make plane:1,precedence only:1,seems simplest:1,simplest to:1,as appearing:1,appearing in:1,3 Bit-Plane:1,Action Without:1,shows bit-plane:1,43.1 animates:1,animates 13:1,13 rather:1,rather large:1,images each:1,each 32:1,32 pixels:1,side over:1,complex background:1,background at:1,good clip:1,clip even:1,a primordial:1,PC Five:1,Five of:1,move very:1,quickly while:1,other 8:1,8 bounce:1,bounce back:1,forth at:1,steady pace:1,pace For:1,who haven’t:1,haven’t experienced:1,experienced the:1,the frustrations:1,frustrations of:1,animation programming:1,PC there’s:1,animation going:1,43.1 What’s:1,virtually flicker-free:1,flicker-free partly:1,partly thanks:1,really erased:1,erased but:1,rather are:1,simply overwritten:1,overwritten The:1,principle behind:1,redrawing each:1,image with:1,fringe around:1,fringe erases:1,erases the:1,image doesn’t:1,doesn’t overwrite:1,overwrite For:1,animation see:1,above-mentioned PC:1,Journal July:1,1986 article:1,article Better:1,red images:1,images take:1,blue images:1,the white:1,white backdrop:1,backdrop and:1,all obscured:1,obscured images:1,images show:1,43.1 accomplishes:1,accomplishes everything:1,wished for:1,technique If:1,43.1 The:1,animation may:1,a revelation:1,revelation to:1,to weak:1,weak slow:1,slow animation:1,PCs with:1,VGA adapters:1,adapters Bit-plane:1,PC look:1,look an:1,lot like—dare:1,like—dare I:1,a games:1,games machine:1,machine Listing:1,43.1 was:1,absolute fastest:1,fastest speed:1,mentioned it:1,it puts:1,puts in:1,pretty amazing:1,amazing performance:1,slowest PCs:1,PCs of:1,all Assuming:1,Assuming you’ll:1,be running:1,43.1 on:1,an faster:1,faster computer:1,computer you’ll:1,the DELAY:1,DELAY equate:1,reasonable pace:1,pace It’s:1,good game:1,game where:1,pieces are:1,a continual:1,continual blur:1,blur Even:1,on something:1,as modest:1,modest as:1,a 286-based:1,AT Listing:1,runs much:1,fast without:1,substantial delay:1,delay although:1,does look:1,look rather:1,rather interesting:1,interesting at:1,at warp:1,warp speed:1,speed We:1,problems eh:1,eh In:1,images past:1,past 20:1,20 on:1,that old:1,old AT:1,hundreds on:1,a cutting-edge:1,cutting-edge local-bus:1,local-bus 486:1,Pentium I’m:1,43.1 in:1,very thoroughly:1,thoroughly commented:1,commented and:1,the individual:1,individual components:1,Listing 43.1—the:1,43.1—the Map:1,register mode:1,sets word:1,word versus:1,versus byte:1,the VGA—have:1,VGA—have been:1,been covered:1,chapters Do:1,Do notice:1,notice however:1,43.1 sets:1,palette exactly:1,earlier This:1,array 1:1,interrupt INT:1,2 Bit-plane:1,animation does:1,have inherent:1,inherent limitations:1,limitations which:1,second One:1,One limitation:1,limitation that:1,not inherent:1,inherent to:1,a shortcoming:1,shortcoming of:1,43.1 is:1,somewhat choppy:1,choppy horizontal:1,horizontal motion:1,motion In:1,both clarity:1,and keeping:1,keeping Listing:1,reasonable length:1,length I:1,to byte-align:1,byte-align all:1,images horizontally:1,many tables:1,tables needed:1,the 7:1,7 non-byte-aligned:1,non-byte-aligned rotations:1,rotations of:1,code needed:1,support rotation:1,rotation Unfortunately:1,smallest possible:1,possible horizontal:1,horizontal movement:1,movement was:1,was 8:1,noticeable at:1,at certain:1,certain speeds:1,speeds The:1,The situation:1,situation is:1,however easily:1,easily correctable:1,additional rotations:1,code We’ll:1,fully rotated:1,generalize nicely:1,49 Vertically:1,Vertically where:1,no byte-alignment:1,byte-alignment issue:1,issue the:1,move 4:1,6 pixels:1,a times:1,times resulting:1,in considerably:1,considerably smoother:1,smoother animation:1,support rotated:1,also open:1,door to:1,for internal:1,image changes:1,changes over:1,active entity:1,entity For:1,example propellers:1,propellers could:1,could whirl:1,whirl jaws:1,jaws could:1,could snap:1,snap and:1,and jets:1,jets could:1,could flare:1,flare Bit-plane:1,with bit-aligned:1,bit-aligned images:1,look truly:1,truly spectacular:1,spectacular It’s:1,a sight:1,sight worth:1,worth seeing:1,seeing particularly:1,who doubt:1,doubt the:1,PC’s worth:1,worth when:1,animation Limitations:1,of Bit-Plane:1,Animation As:1,said bit-plane:1,starters bit-plane:1,12H Also:1,the reprogramming:1,provides image:1,precedence also:1,available color:1,normal 16:1,just 5:1,5 one:1,color per:1,plane plus:1,color Worse:1,still each:1,consist entirely:1,entirely of:1,colors Mixing:1,Mixing colors:1,colors within:1,within an:1,not allowed:1,allowed since:1,are limited:1,can therefore:1,therefore select:1,color Finally:1,Finally all:1,same precedence:1,precedence must:1,color limitations:1,limitations to:1,extent by:1,while reserving:1,for multi-color:1,multi-color drawing:1,use plane:1,using planes:1,planes 0-2:1,0-2 for:1,for normal:1,normal 8-color:1,8-color drawing:1,then appear:1,the 8-color:1,8-color images:1,images If:1,wanted the:1,be yellow:1,yellow we:1,could set:1,43.2 As:1,color yellow:1,yellow is:1,displayed whenever:1,a pixel’s:1,pixel’s bit:1,3 precedence:1,precedence while:1,while leaving:1,leaving us:1,8 normal:1,normal low-intensity:1,low-intensity colors:1,images drawn:1,drawn across:1,other 3:1,3 planes:1,43.5 Of:1,approach provides:1,provides only:1,3 high-precedence:1,high-precedence planes:1,good tradeoff:1,for being:1,draw multi-colored:1,multi-colored images:1,a backdrop:1,backdrop to:1,the high-precedence:1,high-precedence images:1,images For:1,right application:1,application high-speed:1,high-speed flicker-free:1,flicker-free plane:1,images moving:1,moving in:1,an 8-color:1,8-color backdrop:1,backdrop could:1,potent combination:1,combination indeed:1,indeed Another:1,Another limitation:1,if images:1,images stored:1,plane never:1,other Why:1,Because when:1,images do:1,do cross:1,fringe Table:1,43.2 Palette:1,for two-plane:1,two-plane animation:1,animation Palette:1,Register Setting:1,Setting 0:1,black 1:1,1 01H:1,01H blue:1,blue 2:1,2 02H:1,02H green:1,green 3:1,3 03H:1,03H cyan:1,cyan 4:1,4 04H:1,04H red:1,red 5:1,5 05H:1,05H magenta:1,magenta 6:1,6 14H:1,14H brown:1,brown 7:1,7 07H:1,07H light:1,light gray:1,gray 8:1,8 3EH:1,yellow 9:1,9 3EH:1,yellow 10:1,10 3EH:1,yellow 11:1,11 13EH:1,13EH yellow:1,yellow 12:1,12 3EH:1,yellow 13:1,13 3EH:1,yellow 14:1,14 3EH:1,yellow 15:1,15 3EH:1,yellow around:1,can temporarily:1,temporarily erase:1,the overlapped:1,overlapped parts:1,other image:1,image or:1,or images:1,images resulting:1,in momentary:1,momentary flicker:1,flicker While:1,fatal it:1,certainly detracts:1,detracts from:1,the rock-solid:1,rock-solid animation:1,animation effect:1,animation Not:1,Not allowing:1,allowing images:1,actually less:1,a limitation:1,limitation than:1,seems Run:1,Run Listing:1,43.1 again:1,again Unless:1,Unless you:1,were looking:1,it you’d:1,you’d never:1,color almost:1,never overlap—there’s:1,overlap—there’s plenty:1,to distract:1,distract the:1,the trajectories:1,trajectories of:1,color are:1,full range:1,motion without:1,without running:1,only exception:1,the chain:1,chain of:1,which occasionally:1,occasionally doubles:1,doubles back:1,on itself:1,itself when:1,it bounces:1,bounces directly:1,corner and:1,and reverses:1,direction Here:1,moving so:1,so quickly:1,quickly that:1,the brief:1,brief moment:1,moment during:1,one image’s:1,image’s fringe:1,fringe blanks:1,blanks a:1,another image:1,is noticeable:1,noticeable only:1,upon close:1,close inspection:1,inspection and:1,particularly unaesthetic:1,unaesthetic even:1,then Figure:1,only Figure:1,only When:1,has such:1,such tremendous:1,tremendous visual:1,advantages as:1,does bit-plane:1,animation it:1,it behooves:1,behooves you:1,your animation:1,animation software:1,software so:1,technique don’t:1,way For:1,might design:1,a shooting:1,shooting gallery:1,gallery game:1,game with:1,plane marching:1,marching along:1,along in:1,continuous band:1,band The:1,images could:1,overlap so:1,so bit-plane:1,high image:1,quality Shearing:1,Shearing and:1,and Page:1,Flipping As:1,As Listing:1,runs you:1,occasionally see:1,image shear:1,shear with:1,image briefly:1,briefly offset:1,offset This:1,a consequence:1,data Occasionally:1,Occasionally the:1,scans a:1,given area:1,changing that:1,same memory:1,memory If:1,scans memory:1,memory faster:1,modify that:1,been already:1,changed pass:1,currently drawing:1,start scanning:1,out bytes:1,that haven’t:1,yet been:1,result Mismatched:1,Mismatched upper:1,lower portions:1,image If:1,scans more:1,modify memory:1,memory likely:1,likely with:1,386 a:1,and narrow:1,narrow images:1,images then:1,can rip:1,rip right:1,right past:1,controller with:1,same net:1,of mismatched:1,mismatched top:1,out first:1,first unchanged:1,unchanged bytes:1,then changed:1,changed bytes:1,bytes Basically:1,Basically shear:1,shear will:1,will occasionally:1,occasionally occur:1,occur unless:1,and CRT:1,CRT proceed:1,rate which:1,most unlikely:1,unlikely Shear:1,Shear is:1,fewer but:1,but larger:1,larger images:1,images since:1,more apparent:1,apparent when:1,larger screen:1,is sheared:1,sheared and:1,to spot:1,spot one:1,three large:1,images momentarily:1,momentarily shearing:1,shearing than:1,of twenty:1,twenty small:1,images Image:1,Image shear:1,shear isn’t:1,isn’t terrible—I’ve:1,terrible—I’ve written:1,and sold:1,sold several:1,several games:1,which images:1,images occasionally:1,occasionally shear:1,shear and:1,never heard:1,heard anyone:1,anyone complain—but:1,complain—but neither:1,it ideal:1,ideal One:1,One solution:1,which drawing:1,a non-displayed:1,saw page:1,23 we’ll:1,heavily starting:1,47 When:1,the newly-drawn:1,newly-drawn part:1,displayed page:1,page so:1,becomes visible:1,visible all:1,no shearing:1,shearing or:1,switched back:1,page Page:1,animation although:1,although page:1,flipping does:1,does diminish:1,diminish some:1,unique advantages:1,animation Page:1,flipping produces:1,produces animation:1,highest visual:1,quality whether:1,whether bit-plane:1,used or:1,flipping however:1,however Page:1,buffers one:1,time Unfortunately:1,Unfortunately in:1,12H there:1,enough memory:1,two buffers:1,buffers so:1,so page:1,an option:1,option in:1,mode Also:1,both buffers:1,buffers up:1,date which:1,drawing Finally:1,Finally page:1,flipped before:1,page Otherwise:1,up modifying:1,modifying a:1,while it’s:1,displayed defeating:1,defeating the:1,flipping Waiting:1,flip takes:1,slow overall:1,significantly What’s:1,more it’s:1,sometimes difficult:1,sure when:1,flipped since:1,since not:1,clones implement:1,adapter status:1,status bits:1,flip timing:1,timing identically:1,identically To:1,To sum:1,sum up:1,up bit-plane:1,good In:1,flipping bit-plane:1,little better:1,scheme is:1,bit less:1,less reliable:1,reliable on:1,computers Beating:1,Beating the:1,the Odds:1,Odds in:1,the Jaw-Dropping:1,Jaw-Dropping Contest:1,Contest Bit-plane:1,stuff Heck:1,Heck good:1,sort is:1,good a:1,any well:1,well almost:1,any to:1,make people’s:1,people’s jaws:1,drop Certainly:1,Certainly it’s:1,go if:1,of jaws:1,drop Don’t:1,let anyone:1,anyone tell:1,do good:1,PC You:1,you stretch:1,stretch your:1,find ways:1,applications Bit-plane:1,isn’t for:1,every task:1,task neither:1,neither are:1,are page:1,flipping exclusive-ORing:1,exclusive-ORing pixel:1,panning or:1,have available:1,available One:1,One or:1,more tricks:1,tricks from:1,that grab-bag:1,grab-bag should:1,you what:1,need though:1,bigger your:1,your grab-bag:1,grab-bag the:1,better your:1,programs Chapter:1,Chapter 44:1,44 Split:1,Screens Save:1,Save the:1,Flipped Day:1,Day 640x480:1,640x480 Page:1,Flipped Animation:1,in 64K…Almost:1,64K…Almost Almost:1,Almost doesn’t:1,doesn’t count:1,count they:1,they say—at:1,say—at least:1,in horseshoes:1,horseshoes and:1,few other:1,things This:1,in digital:1,digital circles:1,circles where:1,where if:1,need 12:1,12 MB:1,of hard:1,disk to:1,to install:1,install something:1,something and:1,have 10:1,10 MB:1,MB left:1,situation that:1,be some:1,of eternal:1,eternal law:1,law you’re:1,you’re stuck:1,stuck And:1,only infuriating:1,infuriating until:1,you dredge:1,dredge up:1,the gumption:1,gumption to:1,and free:1,some space:1,space How:1,How would:1,feel if:1,against an:1,an almost-but-not-quite:1,almost-but-not-quite kind:1,be breached:1,breached by:1,by freeing:1,something elsewhere:1,elsewhere Suppose:1,were within:1,few KB:1,KB of:1,of implementing:1,wonderful VGA:1,that provided:1,provided lots:1,space square:1,pixels smooth:1,smooth motion:1,than adequate:1,adequate speed—but:1,speed—but all:1,is What:1,What would:1,do Scream:1,Scream a:1,little Or:1,Or throw:1,throw something:1,won’t break:1,break easily:1,let your:1,brain do:1,do Sure:1,Sure enough:1,little VGA:1,VGA secret:1,secret called:1,called page:1,page splitting:1,splitting can:1,day for:1,mode But:1,But to:1,to lay:1,little groundwork:1,groundwork first:1,first Or:1,Or maybe:1,of groundwork:1,groundwork No:1,No horseshoes:1,horseshoes here:1,here A:1,A Plethora:1,Plethora of:1,of Challenges:1,Challenges In:1,simplest terms:1,terms computer:1,animation consists:1,of rapidly:1,rapidly redrawing:1,redrawing similar:1,similar images:1,at slightly:1,slightly differing:1,differing locations:1,locations so:1,eye interprets:1,interprets the:1,the successive:1,object in:1,motion over:1,an analog:1,analog realm:1,realm and:1,images displayed:1,screen consist:1,discrete pixels:1,pixels updated:1,updated at:1,Hz is:1,irrelevant your:1,your eye:1,can interpret:1,interpret both:1,both real-world:1,real-world images:1,that One:1,key problems:1,redraw a:1,screen time:1,bitmap controlling:1,intermediate state:1,state with:1,possibly many:1,many objects:1,objects erased:1,others half-drawn:1,half-drawn Even:1,only briefly:1,briefly displayed:1,displayed a:1,a partially-updated:1,partially-updated screen:1,cause flicker:1,flicker at:1,at worst:1,worst can:1,motion entirely:1,entirely Another:1,must update:1,update often:1,that motion:1,motion appears:1,appears continuous:1,continuous A:1,A moving:1,moving object:1,that moves:1,moves just:1,every second:1,second shifting:1,shifting by:1,by hundreds:1,does move:1,move will:1,jump not:1,move smoothly:1,smoothly Therefore:1,two overriding:1,overriding requirements:1,requirements for:1,for smooth:1,animation 1:1,bitmap must:1,updated quickly:1,quickly once:1,per frame—60:1,frame—60 to:1,to 70:1,70 Hz—is:1,Hz—is ideal:1,ideal although:1,although 30:1,Hz will:1,redrawing the:1,be invisible:1,invisible to:1,user only:1,result should:1,seen Both:1,Both of:1,met by:1,44.2 A:1,A Page:1,Flipping Animation:1,Animation Demonstration:1,Demonstration The:1,listings taken:1,sample animation:1,bounces endlessly:1,endlessly off:1,off other:1,of bounces:1,bounces displayed:1,screen I’ll:1,44.2 during:1,article The:1,listings are:1,and involve:1,involve too:1,much VGA:1,animation knowledge:1,for for:1,discuss it:1,in exhaustive:1,exhaustive detail:1,I’ve covered:1,stuff earlier:1,book instead:1,instead I’ll:1,major elements:1,elements leaving:1,the finer:1,finer points—and:1,points—and hope:1,and expand:1,expand on:1,provide Listing:1,44.1 is:1,could equally:1,then have:1,been somewhat:1,However wanted:1,made again:1,indeed optimization:1,general is:1,critical portions:1,slow Only:1,Only in:1,highly performance-sensitive:1,performance-sensitive situation:1,situation would:1,boost resulting:1,from converting:1,converting Listing:1,44.1 to:1,assembly justify:1,the bugs:1,likely creep:1,creep in—and:1,in—and the:1,program already:1,already updates:1,frame even:1,a 1985-vintage:1,1985-vintage 8-MHz:1,AT In:1,case faster:1,faster performance:1,result only:1,longer wait:1,flip Write:1,bitmap very:1,efficiently on:1,draw up:1,up drawing:1,This article:1,article makes:1,makes considerable:1,considerable use:1,particularly unusual:1,unusual hardware:1,feature write:1,3 We:1,We discussed:1,discussed write:1,3 back:1,26 but:1,ground since:1,since then—so:1,then—so I’m:1,3 Some:1,Some background:1,background In:1,standard VGA’s:1,which this:1,controls 8:1,8 adjacent:1,turn controlled:1,bits spread:1,not concern:1,concern ourselves:1,ourselves with:1,here Now:1,Now there:1,be times:1,change some:1,particular byte:1,not easily:1,write half:1,or such:1,such to:1,memory it’s:1,whole byte:1,all You:1,using AND:1,OR to:1,manipulate individual:1,bits could:1,could solve:1,problem Alas:1,Alas not:1,so ANDing:1,work if:1,VGA had:1,had only:1,original monochrome:1,monochrome Hercules:1,Adapter but:1,and ANDing:1,we selected:1,selected and:1,and manipulated:1,manipulated each:1,plane separately:1,separately a:1,be hideously:1,slow No:1,No with:1,features or:1,well forget:1,forget about:1,real-time screen:1,updates altogether:1,altogether Write:1,3 will:1,trick for:1,present needs:1,needs Write:1,useful when:1,set some:1,color That:1,color write:1,it Write:1,works like:1,First set:1,3 Look:1,44.2 for:1,does everything:1,everything described:1,here Next:1,Next set:1,0-15 It:1,to explicitly:1,explicitly enable:1,set/reset via:1,register write:1,that automatically:1,automatically Then:1,Then to:1,draw individual:1,byte simply:1,1-bits where:1,0-bits where:1,current bitmap:1,bitmap contents:1,contents to:1,preserved Note:1,data actually:1,CPU doesn’t:1,operation latches:1,latches all:1,planes data:1,described way:1,24 So:1,if write:1,1 blue:1,blue then:1,operations will:1,first 4:1,left nibble:1,to blue:1,will leave:1,next 4:1,right nibble:1,0 unchanged:1,unchanged Using:1,Using one:1,one MOV:1,efficient on:1,processors In:1,44.2 I:1,I instead:1,instead use:1,use XCHG:1,XCHG which:1,in Again:1,actual value:1,that’s read:1,irrelevant In:1,XCHG approach:1,earlier processors:1,but slower:1,Pentiums If:1,If all:1,read before:1,writing because:1,byte needs:1,preserved a:1,simple write:1,doubt aware:1,2 by:1,register requires:1,often slower:1,accesses especially:1,and 486s:1,486s One:1,the great:1,great virtues:1,requires virtually:1,no OUT:1,is therefore:1,therefore substantially:1,substantially faster:1,for masking:1,masking than:1,short write:1,for single-color:1,single-color drawing:1,drawing that:1,modifies individual:1,within display:1,bytes Not:1,coincidentally the:1,application draws:1,only single-color:1,single-color objects:1,objects within:1,area this:1,allows write:1,in keeping:1,keeping with:1,our desire:1,desire for:1,for speedy:1,speedy screen:1,updates Drawing:1,Drawing Text:1,Text We’ll:1,We’ll need:1,need text:1,3 Sometimes:1,case Each:1,Each character:1,1-bits representing:1,representing character:1,0-bits representing:1,representing background:1,pixels Since:1,Since we’ll:1,8x8 font:1,ROM a:1,BIOS service:1,service as:1,44.2 each:1,exactly 8:1,byte wide:1,wide We’ll:1,We’ll further:1,further insist:1,insist that:1,that characters:1,characters be:1,boundaries that:1,their left:1,edges only:1,at pixels:1,8 this:1,character bytes:1,automatically aligned:1,no rotation:1,or clipping:1,characters is:1,needed Finally:1,Finally we’ll:1,we’ll draw:1,in white:1,white Given:1,above assumptions:1,assumptions drawing:1,easy we:1,simply copy:1,copy each:1,appropriate location:1,and voila:1,voila we’re:1,done Text:1,Text copying:1,once hence:1,hence 1-bits:1,1-bits turn:1,into white:1,white color:1,0FH with:1,1-bits in:1,0-bits turn:1,into black:1,black color:1,3 because:1,because write:1,3 requires:1,a read/write:1,read/write of:1,least preloading:1,preloading the:1,color while:1,memory Is:1,Is write:1,0 always:1,do text:1,text Not:1,above draws:1,draws both:1,both foreground:1,box forcing:1,black at:1,it forces:1,white If:1,pixels not:1,the surrounding:1,surrounding background:1,box write:1,ideal Also:1,Also matters:1,get far:1,complicated if:1,aren’t 8:1,wide are:1,characters are:1,drawn starting:1,at arbitrary:1,arbitrary pixel:1,the multiple-of-8:1,multiple-of-8 column:1,column restriction:1,restriction so:1,and masking:1,masking are:1,required Lastly:1,Lastly the:1,colors other:1,than white—but:1,white—but only:1,black Otherwise:1,data remaining:1,remaining in:1,planes protected:1,protected by:1,Mask will:1,remain and:1,can interfere:1,text being:1,drawn I’m:1,delve any:1,any deeper:1,deeper into:1,considerable issues:1,issues of:1,drawing VGA:1,I just:1,just want:1,to sensitize:1,sensitize you:1,approaches other:1,the ones:1,ones used:1,44.2 On:1,something you:1,do there:1,there probably:1,probably are:1,10 ways:1,it each:1,unique strengths:1,weaknesses Your:1,Your mission:1,mission should:1,accept it:1,your particular:1,application Page:1,Flipping Now:1,screen reasonably:1,reasonably quickly:1,quickly it’s:1,stuff Page:1,flipping answers:1,second requirement:1,keeping bitmap:1,bitmap changes:1,changes off:1,screen until:1,until they’re:1,they’re complete:1,complete In:1,words page:1,flipping guarantees:1,that partially:1,partially updated:1,updated bitmaps:1,bitmaps are:1,seen How:1,update a:1,bitmap without:1,without seeing:1,changes as:1,they’re made:1,made Easy—with:1,Easy—with page:1,flipping there:1,two bitmaps:1,bitmaps the:1,program shows:1,shows you:1,bitmap while:1,it updates:1,other Conceptually:1,Conceptually it’s:1,practice unfortunately:1,unfortunately it’s:1,must look:1,turns bytes:1,into pixels:1,VGA bitmap:1,linear 64:1,K block:1,memory True:1,True most:1,most adapters:1,adapters nowadays:1,nowadays are:1,are SuperVGAs:1,SuperVGAs with:1,but every:1,every make:1,own way:1,letting you:1,going beyond:1,beyond standard:1,a daunting:1,daunting and:1,and difficult:1,task Also:1,large frame:1,frame buffers:1,buffers of:1,modes fast:1,animation Normally:1,Normally the:1,VGA picks:1,corresponding 8:1,then picks:1,next 8:1,memory picked:1,up during:1,not fixed:1,at 0:1,rather programmable:1,programmable by:1,High and:1,and Low:1,Low registers:1,together store:1,16-bit offset:1,displayed during:1,frame starts:1,starts So:1,enough bitmap:1,complete screen:1,memory offsets:1,through 27999:1,27999 and:1,another full:1,full bitmap:1,bitmap could:1,offsets 28000:1,28000 through:1,through 55999:1,55999 as:1,44.1 I’m:1,I’m discussing:1,discussing 640x350:1,moment for:1,reason we’ll:1,640x480 shortly:1,shortly When:1,first bitmap:1,bitmap or:1,or page:1,displayed when:1,to 28000:1,28000 the:1,second bitmap:1,displayed Page:1,Page flipped:1,by displaying:1,on ad:1,infinitum Figure:1,flipping Knowing:1,to Flip:1,Flip There’s:1,a hitch:1,that hitch:1,hitch is:1,knowing exactly:1,The page:1,page doesn’t:1,doesn’t flip:1,instant that:1,starting offset:1,registers once:1,once before:1,before starting:1,starting each:1,then pays:1,pays those:1,registers no:1,no nevermind:1,nevermind until:1,frame comes:1,around This:1,registers whenever:1,you want—but:1,want—but the:1,page actually:1,actually being:1,displayed doesn’t:1,loads that:1,new offset:1,problem should:1,obvious Suppose:1,you’re updating:1,0 You:1,You finish:1,to displaying:1,displayed Or:1,current frame:1,frame displaying:1,registers then:1,then page:1,frame no:1,1 right:1,any changes:1,changes you:1,make may:1,well show:1,0 hasn’t:1,yet flipped:1,page 1—and:1,1—and that:1,that defeats:1,defeats the:1,flipping To:1,problem it:1,is mandatory:1,The Start:1,are according:1,tests loaded:1,Sync signal:1,signal although:1,The Vertical:1,Sync status:1,flip a:1,new Start:1,registers wait:1,Sync pulse:1,your merry:1,way Almost—but:1,Almost—but not:1,quite Do:1,Do I:1,I hear:1,hear teeth:1,teeth gnashing:1,gnashing in:1,this Suppose:1,by coincidence:1,coincidence you:1,Sync and:1,other right:1,right after:1,Sync Why:1,then for:1,High value:1,page would:1,Low value:1,and depending:1,address values:1,could appear:1,shift any:1,single horrible:1,horrible frame:1,This must:1,never happen:1,happen The:1,you’re certain:1,certain Vertical:1,Sync is:1,not about:1,start The:1,register being:1,being active:1,active that:1,that bitmap-controlled:1,bitmap-controlled pixels:1,scanned onto:1,since Vertical:1,Sync happens:1,non-display portion:1,frame Vertical:1,Sync can:1,anywhere nearby:1,nearby if:1,if Display:1,Enable is:1,active Note:1,good alternative:1,up both:1,pages with:1,256 and:1,Sync with:1,no Display:1,Enable wait:1,wait required:1,required So:1,So to:1,flip pages:1,must complete:1,complete all:1,the non-displayed:1,page wait:1,Enable to:1,active set:1,Sync to:1,active At:1,fully confident:1,just flipped:1,flipped off:1,not displayed:1,safely invisibly:1,invisibly be:1,updated A:1,A side:1,side benefit:1,will automatically:1,automatically have:1,constant time:1,time base:1,which new:1,drawn synchronized:1,synchronized to:1,display typically:1,typically 60:1,Hz However:1,However complex:1,complex updates:1,updates may:1,complete especially:1,slower processors:1,processors this:1,be compensated:1,screens drawn:1,and cross-referencing:1,cross-referencing that:1,BIOS timer:1,count periodically:1,periodically accelerating:1,accelerating the:1,overall pace:1,pace of:1,animation moving:1,moving farther:1,farther each:1,like if:1,if updates:1,updates are:1,are happening:1,happening too:1,too slowly:1,slowly Enter:1,Screen So:1,discussed page:1,that 640x350:1,highest-resolution standard:1,there’s enough:1,enough display:1,pages on:1,a non-standard:1,non-standard 640x400:1,pages but:1,limit One:1,One 640x480:1,640x480 page:1,page takes:1,takes 38400:1,and clearly:1,clearly there:1,enough room:1,in 64:1,monster pages:1,pages And:1,yet 640x480:1,640x480 is:1,wonderful mode:1,ratio square:1,provides by:1,best resolution:1,visual appeal:1,Surely there:1,there is—but:1,is—but it’s:1,odd solution:1,solution indeed:1,feature known:1,VGA fetches:1,fetches video:1,data back:1,0 after:1,after any:1,desired scan:1,line For:1,scan through:1,through display:1,usual until:1,finishes scan:1,number 338:1,338 and:1,for scan:1,number 339:1,339 from:1,turn allows:1,to divvy:1,divvy up:1,up display:1,three areas:1,areas as:1,44.2 The:1,to 11279:1,11279 is:1,from 11280:1,11280 to:1,to 38399:1,38399 is:1,from 38400:1,38400 to:1,to 65519:1,65519 is:1,top 339:1,lines about:1,bottom 141:1,141 scan:1,for non-animation:1,non-animation purposes:1,as showing:1,showing scores:1,scores instructions:1,instructions statuses:1,statuses and:1,and suchlike:1,suchlike Note:1,and number:1,are dictated:1,the desire:1,many page-flipped:1,page-flipped scan:1,possible you:1,may if:1,wish have:1,fewer page-flipped:1,page-flipped lines:1,reserve part:1,other uses:1,uses such:1,as off-screen:1,images Figure:1,flipping exactly:1,The playfield:1,playfield through:1,bounces is:1,page-flipped portion:1,rectangle at:1,bottom containing:1,the bounce:1,bounce count:1,not animatable:1,animatable portion:1,screen Of:1,user it:1,all looks:1,one screen:1,screen There:1,visible boundaries:1,two unless:1,create them:1,them Very:1,Very few:1,few animation:1,applications use:1,animation If:1,by with:1,with 339:1,animation split-screen:1,split-screen page:1,flipping gives:1,of square:1,So Is:1,Is VGA:1,animation worth:1,fuss Mais:1,Mais oui:1,oui Run:1,seen aggressive:1,aggressive VGA:1,animation before:1,before you’ll:1,how smooth:1,smooth it:1,Not every:1,every square:1,square millimeter:1,millimeter of:1,every animated:1,animated screen:1,in constant:1,constant motion:1,motion Most:1,Most graphics:1,screens need:1,little quiet:1,quiet space:1,display scores:1,scores coordinates:1,coordinates file:1,file names:1,names or:1,else fails:1,fails company:1,company logos:1,logos If:1,don’t tell:1,user he’s/she’s:1,he’s/she’s only:1,only getting:1,getting 339:1,animation he’ll/she’ll:1,he’ll/she’ll probably:1,probably never:1,know Chapter:1,Chapter 45:1,45 Dog:1,Dog Hair:1,Hair and:1,and Dirty:1,Rectangles Different:1,Different Angles:1,Angles on:1,on Animation:1,Animation We:1,We brought:1,brought our:1,our pets:1,pets with:1,with us:1,to Seattle:1,Seattle At:1,At about:1,time our:1,our Golden:1,Golden Retriever:1,Retriever Sam:1,Sam observed:1,observed his:1,his third:1,third birthday:1,birthday Sam:1,Sam is:1,relatively intelligent:1,intelligent in:1,clearly smarter:1,smarter than:1,a banana:1,banana slug:1,slug although:1,he were:1,room with:1,with Jeff:1,Duntemann’s dog:1,dog Mr:1,Byte there’s:1,reasonable chance:1,chance that:1,would mistake:1,mistake Mr:1,Byte for:1,something edible:1,edible a:1,includes rocks:1,rocks socks:1,socks and:1,surprising number:1,things too:1,too disgusting:1,disgusting to:1,mention and:1,and Jeff:1,Jeff would:1,new source:1,about But:1,But that’s:1,important now:1,now What:1,is that—and:1,that—and I:1,this up—this:1,up—this morning:1,I managed:1,of socks:1,socks Sam:1,hadn’t chewed:1,chewed holes:1,in And:1,And what’s:1,three he:1,he calmed:1,calmed down:1,down amazingly:1,amazingly We:1,been waiting:1,magic transformation:1,transformation since:1,since Sam:1,the age:1,age at:1,most puppies:1,puppies turn:1,into normal:1,normal dogs:1,dogs who:1,who lie:1,lie around:1,lot waking:1,waking up:1,eat their:1,their Science:1,Science Diet:1,Diet motto:1,motto The:1,The dog:1,dog food:1,food that:1,costs more:1,average neurosurgeon:1,neurosurgeon makes:1,makes in:1,year before:1,before licking:1,licking themselves:1,in embarrassing:1,embarrassing places:1,going back:1,sleep When:1,When Sam:1,remained hopelessly:1,hopelessly out:1,of control:1,control we:1,said Goldens:1,Goldens take:1,years to:1,calm down:1,down as:1,clue When:1,remained undeniably:1,undeniably Sam:1,Sam we:1,said Any:1,Any day:1,three we:1,were reduced:1,about seven:1,seven more:1,more years:1,years until:1,he expired:1,expired at:1,the fur:1,fur he:1,had shed:1,shed in:1,his lifetime:1,lifetime and:1,and weave:1,weave ourselves:1,ourselves some:1,some clothes:1,clothes without:1,without holes:1,in them:1,them or:1,or quite:1,possibly a:1,house But:1,But miracle:1,miracle of:1,miracles we:1,Sam instantly:1,instantly turned:1,dog we:1,thought we’d:1,we’d gotten:1,gotten when:1,we forked:1,forked over:1,over 500—calm:1,500—calm sweet:1,sweet and:1,and obedient:1,obedient Weeks:1,Weeks went:1,Sam was:1,was if:1,if anything:1,anything better:1,ever Clearly:1,was permanent:1,permanent And:1,took Sam:1,Sam to:1,the vet:1,vet for:1,his annual:1,annual check-up:1,check-up and:1,an ear:1,ear infection:1,infection Thanks:1,of modern:1,modern animal:1,animal medicine:1,medicine a:1,5 bottle:1,bottle of:1,of liquid:1,liquid restored:1,restored his:1,health in:1,two days:1,days And:1,health we:1,got as:1,old Sam:1,Sam You:1,see Sam:1,hadn’t changed:1,changed He:1,just tired:1,tired from:1,sick Now:1,Now he:1,he once:1,again joyously:1,joyously knocks:1,knocks down:1,down any:1,any stranger:1,stranger who:1,who makes:1,of glancing:1,glancing in:1,his direction:1,will quite:1,be booked:1,booked any:1,any day:1,on suspicion:1,suspicion of:1,of homicide:1,homicide by:1,by licking:1,licking Plus:1,Plus ça:1,ça Change:1,Change Okay:1,Okay you:1,you give:1,up What:1,exactly does:1,graphics I’m:1,glad you:1,you asked:1,asked The:1,from Sam:1,Sam The:1,The Dog:1,Dog With:1,With A:1,A Brain:1,Brain The:1,The Size:1,Size Of:1,Of A:1,A Walnut:1,Walnut is:1,while things:1,things may:1,may look:1,they’ve changed:1,often haven’t:1,haven’t Take:1,Take VGA:1,SuperVGA you’ll:1,get performance:1,performance that:1,that knocks:1,knocks your:1,your socks:1,socks off:1,off especially:1,run Windows:1,Windows Things:1,are liable:1,liable to:1,you’ll figure:1,figure the:1,the SuperVGA:1,to deserve:1,deserve some:1,the credit:1,credit Well:1,Well maybe:1,does if:1,a local-bus:1,local-bus VGA:1,VGA But:1,is local:1,local bus—and:1,bus—and it:1,certainly doesn’t:1,doesn’t if:1,an ISA:1,no ISA:1,about 300:1,300 nanoseconds:1,nanoseconds per:1,VGAs capable:1,that speed:1,speed have:1,been common:1,common for:1,now Your:1,Your 486:1,486 VGA:1,VGA system:1,fast almost:1,entirely because:1,it 486:1,systems with:1,the ATI:1,ATI Ultra:1,Ultra or:1,or Diamond:1,Diamond Stealth:1,Stealth are:1,another story:1,story altogether:1,altogether Underneath:1,Underneath it:1,still painfully:1,painfully slow—and:1,slow—and if:1,old VGA:1,or IBM’s:1,original PS/2:1,PS/2 motherboard:1,motherboard VGA:1,VGA it’s:1,it’s incredibly:1,fastest ISA-bus:1,to twenty:1,twenty times:1,slowest VGA:1,slower In:1,days the:1,rule was:1,was Display:1,avoided Nowadays:1,Nowadays the:1,is Display:1,but should:1,should still:1,avoided So:1,say sometimes:1,sometimes things:1,change Of:1,course sometimes:1,sometimes they:1,change For:1,just 49:1,49 dog:1,fully expect:1,own at:1,of underwear:1,underwear without:1,single hole:1,hole in:1,it Which:1,us deus:1,deus ex:1,ex machina:1,machina and:1,the creek:1,creek don’t:1,don’t rise:1,to yet:1,another animation:1,animation method:1,method dirty-rectangle:1,animation VGA:1,VGA Access:1,Access Times:1,Times Actually:1,Actually before:1,to dirty:1,rectangles I’d:1,take you:1,I/O access:1,times I:1,this partly:1,slow access:1,VGA make:1,make dirty-rectangle:1,attractive and:1,partly as:1,a public:1,public service:1,service because:1,because even:1,even I:1,was shocked:1,shocked by:1,some I/O:1,tests I:1,recently ran:1,ran Table:1,45.1 shows:1,aforementioned I/O:1,tests as:1,as run:1,two 486/33:1,486/33 SuperVGA:1,SuperVGA systems:1,systems under:1,Lap 386:1,386 DOS-Extender:1,DOS-Extender The:1,The systems:1,are unnamed:1,unnamed because:1,a not-very-scientific:1,not-very-scientific spot:1,spot test:1,to unfairly:1,unfairly malign:1,malign say:1,VGA whose:1,whose only:1,only sin:1,sin is:1,being plugged:1,plugged into:1,lousy motherboard:1,motherboard or:1,versa Under:1,Under Phar:1,Lap 32-bit:1,32-bit protected-mode:1,protected-mode apps:1,apps run:1,privileges meaning:1,I measured:1,measured had:1,best official:1,official cycle:1,times possible:1,486 10:1,OUT officially:1,and officially:1,a mind-boggling:1,mind-boggling 30:1,mode if:1,if running:1,running without:1,without full:1,privileges as:1,normally the:1,protected-mode applications:1,applications Basically:1,Basically I/O:1,I/O is:1,plain slow:1,486 As:1,As slow:1,OUT one:1,only wish:1,wish that:1,that VGA:1,I/O were:1,were actually:1,actually that:1,fastest measured:1,measured OUT:1,45.1 is:1,is 26:1,slowest is:1,is 126—this:1,126—this for:1,an operation:1,operation that’s:1,that’s supposed:1,cycles To:1,To put:1,context MUL:1,MUL takes:1,13 to:1,to 42:1,42 cycles:1,normal MOV:1,takes exactly:1,short OUT:1,normal memory:1,generally two:1,even display:1,accesses although:1,are exceptions:1,exceptions Of:1,course VGA:1,memory has:1,own performance:1,fastest ISA:1,can at:1,best support:1,support sustained:1,sustained write:1,write times:1,word-sized write:1,write on:1,486/33 15:1,15 or:1,common even:1,relatively fast:1,fast SuperVGAs:1,SuperVGAs the:1,is 65:1,65 cycles:1,byte However:1,However intermittent:1,intermittent writes:1,writes mixed:1,and cache-only:1,cache-only code:1,effectively execute:1,cycle thanks:1,caching design:1,486’s 4-deep:1,4-deep write:1,write buffer:1,which stores:1,stores pending:1,pending writes:1,writes while:1,CPU continues:1,continues executing:1,instructions Display:1,reads tend:1,longer because:1,because coprocessing:1,coprocessing isn’t:1,isn’t possible—one:1,possible—one microsecond:1,reasonable rule:1,thumb for:1,for VGA:1,VGA reads:1,reads although:1,although there’s:1,considerable variation:1,variation So:1,So VGA:1,as VGA:1,I/O but:1,but lord:1,knows it:1,isn’t good:1,good OUT:1,OUT Time:1,Time in:1,in Microseconds:1,Microseconds and:1,and Cycles:1,Cycles Table:1,45.1 Results:1,Results of:1,tests run:1,Phar Lap386:1,Lap386 DOS-Extender:1,DOS-Extender OUT:1,OUT Instruction:1,Instruction Official:1,Official Time:1,Time 486:1,486 1/16-bit:1,1/16-bit VGA:1,VGA 1:1,1 486:1,486 2/16-bit:1,2/16-bit VGA:1,VGA 2:1,2 OUT:1,maximum byte:1,cycles 2.546s:1,2.546s 84:1,84 cycles:1,cycles 0.813s:1,0.813s 27:1,maximum word:1,cycles 3.820s:1,3.820s 126:1,126 cycles:1,cycles 1.066s:1,1.066s 35:1,35 cycles:1,random byte:1,cycles 1.610s:1,1.610s 53:1,53 cycles:1,cycles 0.780s:1,0.780s 26:1,random word:1,cycles 2.830s:1,2.830s 93:1,93 cycles:1,cycles 1.010s:1,1.010s 33:1,general are:1,lousy on:1,only took:1,took three:1,286 OUT:1,particularly lousy:1,lousy Display:1,pretty poor:1,poor especially:1,reads The:1,The conclusions:1,are obvious:1,obvious I:1,hope Structure:1,Structure your:1,general all:1,all 486:1,avoid OUT:1,s For:1,For graphics:1,graphics this:1,this especially:1,especially means:1,means using:1,3 rather:1,the bit-mask:1,bit-mask register:1,mask arrange:1,arrange drawing:1,drawing so:1,mask once:1,drawing with:1,mask For:1,example draw:1,whole edge:1,middle then:1,mask several:1,and middle:1,middle bytes:1,together Don’t:1,Don’t read:1,to Write:1,pixel once:1,once It:1,a strange:1,strange concept:1,is staying:1,staying away:1,adapter as:1,possible Dirty-Rectangle:1,Animation The:1,The relative:1,relative slowness:1,slowness of:1,the appeal:1,call dirty-rectangle:1,complete copy:1,in offscreen:1,offscreen system:1,All drawing:1,this system:1,buffer As:1,As offscreen:1,offscreen drawing:1,maintained of:1,bounding rectangles:1,the drawn-to:1,drawn-to areas:1,areas these:1,rectangles dirty:1,dirty in:1,longer match:1,screen After:1,completed all:1,a burst:1,burst and:1,off-screen drawing:1,drawing begins:1,begins again:1,again Why:1,Why exactly:1,exactly would:1,this complication:1,complication rather:1,place The:1,is visual:1,quality If:1,screen there’d:1,there’d be:1,were erased:1,then redrawn:1,redrawn Similarly:1,Similarly overlapped:1,which farther:1,objects obscure:1,obscure them:1,them would:1,would flicker:1,as farther:1,visible for:1,for short:1,short periods:1,periods With:1,With dirty-rectangle:1,animation only:1,the finished:1,finished pixels:1,given frame:1,frame ever:1,ever appear:1,screen intermediate:1,intermediate results:1,visible Figure:1,45.1 illustrates:1,visual problems:1,problems associated:1,45.2 shows:1,how dirty-rectangle:1,animation solves:1,solves these:1,problems Figure:1,animation Figure:1,animation So:1,So Why:1,Why Not:1,Not Use:1,Use Page:1,Flipping Well:1,good visual:1,quality why:1,use page:1,flipping For:1,thing not:1,The CGA:1,and MCGA:1,MCGA don’t:1,don’t and:1,VGA’s 640x480:1,16-color or:1,or 320x200:1,or many:1,many SuperVGA:1,contrast all:1,adapters support:1,support dirty-rectangle:1,animation Another:1,faster While:1,strange that:1,draw off-screen:1,off-screen and:1,because dirty-rectangle:1,animation usually:1,usually reduces:1,hardware needs:1,be touched:1,touched especially:1,This reduction:1,reduction comes:1,comes about:1,about because:1,when dirty:1,erased it’s:1,memory not:1,most objects:1,their full:1,full width:1,width that:1,and old:1,positions overlap:1,overlap display:1,to fewer:1,fewer times:1,modes this:1,the parallelism:1,parallelism obtained:1,obtained from:1,planar hardware:1,hardware Also:1,Also read/modify/write:1,fast system:1,than slow:1,slow display:1,so display:1,memory rarely:1,rarely needs:1,read This:1,reads than:1,flipping wastes:1,wastes a:1,flip at:1,frame Dirty-rectangle:1,animation never:1,anything because:1,because partially:1,never present:1,memory Actually:1,Actually in:1,sense partially:1,sometimes present:1,present because:1,be partially:1,drawn when:1,scanning raster:1,reaches that:1,appear partially:1,drawn for:1,frame producing:1,a phenomenon:1,phenomenon I:1,call shearing:1,shearing Fortunately:1,Fortunately shearing:1,shearing tends:1,particularly distracting:1,distracting especially:1,images but:1,copying large:1,large areas:1,areas This:1,which dirty-rectangle:1,animation falls:1,falls short:1,flipping has:1,has perfect:1,perfect display:1,quality never:1,never showing:1,showing anything:1,anything other:1,completely finished:1,finished frame:1,frame Similarly:1,Similarly dirty-rectangle:1,dirty-rectangle copying:1,copying may:1,more frame:1,frame times:1,if shearing:1,shearing doesn’t:1,happen it’s:1,still possible:1,various dirty:1,rectangles show:1,up non-simultaneously:1,non-simultaneously In:1,this latter:1,latter phenomenon:1,phenomenon is:1,do be:1,it Dirty:1,Rectangles in:1,45.1 demonstrates:1,demonstrates dirty-rectangle:1,simple implementation:1,several respects:1,respects For:1,it’s written:1,animation fairly:1,language For:1,another thing:1,uses far:1,pointers which:1,C often:1,often handles:1,handles with:1,optimal efficiency:1,efficiency especially:1,haven’t used:1,used library:1,fill memory:1,this so:1,model Also:1,Also Listing:1,45.1 doesn’t:1,doesn’t attempt:1,to coalesce:1,coalesce rectangles:1,accesses instead:1,it copies:1,copies each:1,each dirty:1,overlaps with:1,another rectangle:1,rectangle so:1,copied multiple:1,times Listing:1,45.1 runs:1,runs pretty:1,well considering:1,its failings:1,failings on:1,486/33 10:1,10 11x11:1,11x11 images:1,images animate:1,animate at:1,very respectable:1,respectable clip:1,clip One:1,45.1 has:1,same dimensions:1,dimensions as:1,screen bitmap:1,bitmap that’s:1,a requirement:1,requirement and:1,two the:1,is bigger:1,area displayed:1,screen it’s:1,visible area:1,buffer Or:1,Or alternatively:1,alternatively the:1,desired window:1,window representing:1,representing a:1,window into:1,virtual buffer:1,buffer We:1,desired portion:1,bitmap into:1,buffer then:1,effect will:1,having panned:1,panned the:1,window to:1,location Another:1,Another argument:1,argument in:1,small viewing:1,viewing window:1,window is:1,it restricts:1,restricts the:1,memory actually:1,to Restricting:1,Restricting the:1,animation reduces:1,accesses which:1,turn boosts:1,boosts overall:1,also improves:1,whole window:1,window has:1,redrawn or:1,or copied:1,copied If:1,close watch:1,watch you’ll:1,many high-performance:1,animation games:1,games similarly:1,similarly restrict:1,restrict their:1,their full-featured:1,full-featured animation:1,small region:1,region Often:1,Often it’s:1,tell that:1,is surrounded:1,by flashy:1,flashy digitized:1,digitized graphics:1,by items:1,items such:1,as scoreboards:1,scoreboards and:1,and status:1,status screens:1,screens but:1,but look:1,closely and:1,region in:1,your favorite:1,favorite game:1,game isn’t:1,isn’t smaller:1,you thought:1,thought Hi-Res:1,Hi-Res VGA:1,VGA Page:1,Flipping On:1,VGA hi-res:1,12H which:1,which offers:1,offers 640x480:1,640x480 resolution:1,resolution with:1,colors That’s:1,nice mode:1,and square:1,square ones:1,ones at:1,it lacks:1,lacks one:1,one thing—page:1,thing—page flipping:1,is 150:1,150 K:1,K in:1,only 256:1,K total:1,total too:1,little memory:1,monster mode:1,12H pages:1,pages With:1,With only:1,obviously out:1,without page:1,flipping top-flight:1,top-flight hi-res:1,hi-res animation:1,animation can’t:1,implemented The:1,standard fallback:1,fallback is:1,flipping but:1,offers sharply:1,sharply lower:1,lower vertical:1,it’s lousy:1,lousy for:1,handling scaled-up:1,scaled-up CGA:1,graphics because:1,fractional multiple—1.75:1,multiple—1.75 times:1,be exact—of:1,exact—of that:1,CGA CGA:1,CGA resolution:1,resolution may:1,seem important:1,important these:1,days but:1,many images:1,images were:1,were originally:1,created for:1,CGA as:1,as were:1,were many:1,many graphics:1,graphics packages:1,packages and:1,and games:1,least convenient:1,handle CGA:1,graphics easily:1,too 640x350:1,poor multiple:1,the 200:1,popular 320x200:1,VGA There:1,if imperfect:1,imperfect solutions:1,of hi-res:1,hi-res page:1,flipping One:1,enable page:1,flipping only:1,top two-thirds:1,screen see:1,details and:1,flipping generally:1,generally This:1,CGA problem:1,does yield:1,yield square:1,full 640x480:1,are flippable:1,flippable and:1,thus animatable:1,animatable A:1,second solution:1,mode Such:1,memory 64000:1,actually you:1,add another:1,another few:1,really wanted:1,thereby provides:1,highest resolution:1,fully page-flipped:1,page-flipped display:1,display It:1,It maps:1,maps well:1,to CGA:1,13H resolutions:1,resolutions being:1,being either:1,either identical:1,identical or:1,or double:1,double in:1,dimensions As:1,benefit it:1,it offers:1,offers an:1,an easy-on-the-eyes:1,easy-on-the-eyes 70-Hz:1,70-Hz frame:1,rate as:1,the 60:1,Hz that:1,best that:1,12H can:1,can offer:1,offer due:1,of standard:1,monitors Best:1,Best of:1,all perhaps:1,perhaps is:1,that 640x400:1,to 640x400:1,heart a:1,mode What:1,10H the:1,Vertical Total:1,Total register:1,lines both:1,both displayed:1,and nondisplayed:1,nondisplayed is:1,to 447:1,447 exactly:1,VGA’s text:1,fact support:1,support 400:1,lines A:1,A properly:1,properly sized:1,sized and:1,and centered:1,centered display:1,is achieved:1,achieved in:1,10H by:1,the polarity:1,polarity of:1,scan vertically:1,vertically at:1,make fewer:1,lines fill:1,overscan after:1,after 350:1,350 lines:1,and blanking:1,blanking pulses:1,pulses appropriately:1,faster vertical:1,vertical scanning:1,scanning rate:1,rate Changing:1,Changing those:1,those settings:1,turn mode:1,10H into:1,Listing 45.2:1,45.2 which:1,provides mode:1,for 640x400:1,In 640x400:1,mode page:1,0 runs:1,offset 31999:1,31999 7CFFH:1,7CFFH and:1,1 runs:1,offset 32000:1,32000 7D00H:1,7D00H to:1,to 63999:1,63999 0F9FFH:1,0F9FFH Page:1,Page 1:1,0CH the:1,high 8:1,0DH the:1,to 7D00H:1,7D00H Actually:1,Actually because:1,can page:1,flip simply:1,writing 0:1,or 7DH:1,7DH to:1,0CH this:1,of eliminating:1,nasty class:1,potential synchronization:1,synchronization bugs:1,both registers:1,set Listing:1,Listing 45.3:1,45.3 illustrates:1,illustrates simple:1,simple 640x400:1,640x400 page:1,flipping After:1,described 640x400:1,magazine article:1,article Bill:1,Bill Lindley:1,Lindley of:1,of Mesa:1,Mesa Arizona:1,Arizona wrote:1,a nonstandard:1,nonstandard mode:1,BIOS about:1,size for:1,thing pop-up:1,pop-up utilities:1,utilities often:1,often use:1,BIOS variables:1,variables Bill’s:1,Bill’s memory-resident:1,memory-resident screen:1,screen printer:1,printer EGAD:1,EGAD Screen:1,Screen Print:1,Print determines:1,print by:1,multiplying the:1,BIOS number:1,text rows:1,rows variable:1,variable times:1,character height:1,height variable:1,variable For:1,BIOS itself:1,itself may:1,may do:1,poor job:1,displaying text:1,text if:1,not given:1,given proper:1,proper information:1,information the:1,active text:1,text area:1,area may:1,screen dimensions:1,dimensions or:1,an inappropriate:1,inappropriate graphics:1,graphics font:1,font may:1,used Of:1,BIOS isn’t:1,text anyway:1,anyway in:1,in highly:1,highly nonstandard:1,in slightly:1,slightly nonstandard:1,as 640x400:1,the 640x400:1,model described:1,described a:1,little earlier:1,earlier Bill:1,Bill suggests:1,Listing 45.4:1,45.4 be:1,after putting:1,BIOS that:1,with 25:1,25 rows:1,of 16-pixel-high:1,16-pixel-high text:1,think this:1,excellent suggestion:1,suggestion it:1,can’t hurt:1,hurt and:1,may save:1,save you:1,from getting:1,getting aggravating:1,aggravating tech:1,tech support:1,support calls:1,calls down:1,road The:1,The 640x400:1,mode I’ve:1,here isn’t:1,isn’t exactly:1,exactly earthshaking:1,and CGA:1,CGA emulation:1,emulation and:1,it useful:1,another Another:1,Another Interesting:1,Interesting Twist:1,Twist on:1,on Page:1,Flipping I’ve:1,time exploring:1,exploring various:1,animation I:1,had pegged:1,pegged all:1,animation exclusive-ORing:1,exclusive-ORing simply:1,and erasing:1,erasing objects:1,objects drawing:1,drawing objects:1,fringe to:1,erase them:1,old locations:1,finally drawing:1,local memory:1,dirty modified:1,modified rectangles:1,chapter To:1,surprise someone:1,someone threw:1,threw me:1,and useful:1,useful twist:1,twist on:1,animation not:1,not long:1,ago which:1,a cross:1,cross between:1,between page:1,and dirty-rectangle:1,animation That:1,That someone:1,someone was:1,was Serge:1,Serge Mathieu:1,Mathieu of:1,of Concepteva:1,Concepteva Inc:1,Inc in:1,in Rosemere:1,Rosemere Quebec:1,Quebec who:1,who informed:1,informed me:1,he designs:1,designs everything:1,everything from:1,game point:1,point de:1,de vue:1,vue In:1,In normal:1,normal page:1,display one:1,page Then:1,new page:1,other This:1,pages current:1,current can:1,of bookkeeping:1,bookkeeping and:1,possibly extra:1,drawing especially:1,where only:1,are redrawn:1,redrawn each:1,time Serge:1,Serge didn’t:1,that bookkeeping:1,bookkeeping in:1,his animation:1,applications so:1,he came:1,following approach:1,I’ve reworded:1,reworded amplified:1,amplified and:1,slightly modified:1,the summary:1,summary here:1,here 1:1,3 Set:1,newly drawn:1,page then:1,4 Copy:1,previous screen:1,one 5:1,5 Set:1,now identical:1,1 6:1,great benefit:1,only page:1,being block-copied:1,block-copied to:1,1 Only:1,page needs:1,be maintained:1,maintained and:1,maintaining two:1,separate pages:1,pages vanish:1,vanish entirely:1,approach may:1,than standard:1,flipping depending:1,maintain two:1,pages or:1,not My:1,My guess:1,will usually:1,slower owing:1,display-memory copying:1,copying involved:1,involved and:1,double page-flip:1,page-flip per:1,frame There’s:1,doubt however:1,is every:1,as standard:1,flipping Given:1,Given page:1,page flipping’s:1,flipping’s fair:1,fair degree:1,of complication:1,complication this:1,tool especially:1,for less-experienced:1,less-experienced animation:1,animation programmers:1,programmers An:1,interesting variation:1,variation on:1,on Serge’s:1,doesn’t page:1,flip nor:1,nor wait:1,sync 1:1,3 Copy:1,last screen:1,4 Go:1,2 This:1,approach totally:1,totally eliminates:1,eliminates page:1,can consume:1,consume a:1,images may:1,may shear:1,shear for:1,frame if:1,they’re only:1,partially copied:1,copied when:1,the raster:1,reaches them:1,standard dirty-rectangle:1,dirty-rectangle approach:1,approach except:1,drawing buffer:1,memory Whether:1,memory depends:1,benefit you:1,hardware such:1,Mask the:1,rectangles is:1,to outweigh:1,outweigh the:1,extra display-memory:1,accesses involved:1,copying since:1,since display:1,slow Finally:1,any scheme:1,involves changing:1,the display-memory:1,display-memory start:1,clever trick:1,potentially reduce:1,flip Normally:1,Normally it’s:1,enable to:1,active then:1,two start:1,finally wait:1,active so:1,address has:1,taken effect:1,The start-address:1,start-address registers:1,set around:1,time vertical:1,accepted at:1,start or:1,or end:1,the EGAs:1,VGAs I’m:1,I’m familiar:1,with because:1,a half-changed:1,half-changed start:1,register loaded:1,other not:1,yet loaded:1,would jump:1,jump for:1,frame Avoiding:1,Avoiding this:1,condition is:1,the motivation:1,motivation for:1,for waiting:1,enable because:1,active only:1,when vertical:1,not become:1,active for:1,while Suppose:1,you arrange:1,arrange your:1,your page:1,they both:1,a low-byte:1,low-byte value:1,0 page:1,0 starts:1,at 0000H:1,0000H and:1,1 starts:1,at 8000H:1,8000H for:1,example Page:1,done simply:1,new high:1,then waiting:1,sync This:1,address can:1,be mismatched:1,mismatched page:1,often involve:1,involve less:1,less waiting:1,waiting because:1,enable becomes:1,becomes inactive:1,inactive long:1,long before:1,before vertical:1,sync becomes:1,becomes active:1,active Using:1,approach reclaims:1,reclaims all:1,enable and:1,sync for:1,for doing:1,doing useful:1,useful work:1,The steps:1,steps I’ve:1,for Serge’s:1,Serge’s animation:1,animation approach:1,approach assume:1,the single-byte:1,single-byte approach:1,use that’s:1,never waited:1,for In:1,original dirty-rectangle:1,dirty-rectangle algorithm:1,and goose:1,goose it:1,little with:1,some assembly:1,what dirty-rectangle:1,really made:1,of Probably:1,not dog:1,dog hair:1,hair Chapter:1,Chapter 46:1,46 Who:1,Image Optimizing:1,Optimizing Dirty-Rectangle:1,Animation Programming:1,process One:1,One statement:1,statement or:1,or instruction:1,instruction follows:1,follows another:1,in predictable:1,predictable sequences:1,sequences with:1,with tiny:1,tiny building:1,blocks strung:1,make thinking:1,course A:1,Thing Still:1,large chunk:1,human mind:1,linear fashion:1,fashion I’ve:1,written elsewhere:1,elsewhere about:1,of nonlinear/right-brain/lateral/what-have-you:1,nonlinear/right-brain/lateral/what-have-you thinking:1,solving tough:1,tough programming:1,as debugging:1,debugging or:1,or optimization:1,it bears:1,bears repeating:1,repeating The:1,The mind:1,mind can:1,an awesome:1,awesome pattern-matching:1,pattern-matching and:1,and extrapolation:1,extrapolation tool:1,tool if:1,you let:1,let it:1,day was:1,was grinding:1,grinding my:1,difficult bit:1,debugging The:1,mind there’s:1,nothing worse:1,than debugging:1,debugging someone:1,else’s code:1,the nasty:1,nasty feeling:1,don’t quite:1,quite know:1,know what’s:1,what’s going:1,overall operation:1,code wouldn’t:1,wouldn’t come:1,come clear:1,head no:1,long stared:1,stared at:1,it leaving:1,leaving me:1,me with:1,rising sense:1,of frustration:1,frustration and:1,a determination:1,determination not:1,to quit:1,quit until:1,until got:1,bug In:1,the midst:1,midst of:1,a coworker:1,coworker poked:1,poked his:1,head through:1,me he:1,had something:1,something had:1,to listen:1,to Reluctantly:1,Reluctantly went:1,his office:1,office whereupon:1,whereupon he:1,he played:1,a tape:1,tape of:1,is surely:1,surely one:1,most bizarre:1,bizarre 911:1,911 calls:1,in history:1,history No:1,doubt some:1,have heard:1,heard this:1,this tape:1,tape which:1,will briefly:1,describe as:1,as involving:1,involving a:1,a deer:1,deer destroying:1,and biting:1,biting a:1,the neck:1,neck Perhaps:1,Perhaps you:1,it funny:1,funny perhaps:1,perhaps not—but:1,not—but as:1,it hit:1,hit me:1,me exactly:1,right started:1,started laughing:1,laughing helplessly:1,helplessly tears:1,tears rolling:1,rolling down:1,down my:1,my face:1,When went:1,to work—presto:1,work—presto the:1,the debugging:1,debugging puzzle:1,puzzle had:1,had come:1,come together:1,work went:1,went quickly:1,easily Obviously:1,Obviously my:1,mind needed:1,break from:1,from linear:1,linear left-brain:1,left-brain push-it-out:1,push-it-out thinking:1,thinking so:1,of integrating:1,integrating work:1,so well—but:1,well—but that:1,rarely willing:1,do under:1,under conscious:1,conscious control:1,control It:1,was exactly:1,exactly this:1,thinking had:1,when titled:1,titled my:1,1989 optimization:1,optimization book:1,book of:1,Language Although:1,Although must:1,that few:1,people seem:1,connection and:1,to field:1,field a:1,of questions:1,whether I’m:1,Zen disciple:1,disciple I’m:1,I’m not—actually:1,not—actually I’m:1,I’m more:1,a Dave:1,Barry disciple:1,disciple If:1,who Dave:1,Barry is:1,should he’s:1,he’s good:1,brain Give:1,break once:1,while and:1,bet you’ll:1,productive We’re:1,We’re strange:1,strange thinking:1,thinking machines:1,machines but:1,but we’re:1,we’re the:1,best ones:1,ones yet:1,yet invented:1,worth learning:1,tap our:1,our full:1,full potential:1,potential And:1,it’s back:1,to dirty-rectangle:1,animation Dirty-Rectangle:1,Animation Continued:1,Continued In:1,chapter Introduced:1,Introduced the:1,flipping that’s:1,that’s capable:1,producing animation:1,high visual:1,quality without:1,all from:1,from video:1,extra nondisplayed:1,nondisplayed video:1,makes dirty-rectangle:1,animation more:1,more widely:1,widely usable:1,usable than:1,many adapters:1,adapters don’t:1,flipping Dirty-rectangle:1,animation also:1,also tends:1,of A:1,potentially somewhat:1,because display-memory:1,accesses can:1,can theoretically:1,theoretically be:1,The speed:1,was entirely:1,entirely theoretical:1,theoretical in:1,chapter because:1,was completely:1,completely in:1,The visual:1,45’s animation:1,also less:1,we’ll explore:1,explore shortly:1,Listings 46.1:1,46.1 and:1,and 46.2:1,46.2 addresses:1,45’s code:1,46.2 implements:1,drawing routines:1,language which:1,which boosts:1,boosts performance:1,deal For:1,convert more:1,46.1 into:1,call isn’t:1,isn’t required:1,each animated:1,animated image:1,performance could:1,by streamlining:1,streamlining the:1,46.2 goes:1,toward boosting:1,boosting animation:1,now supports:1,supports snappy:1,snappy animation:1,15 images:1,10 for:1,software presented:1,now two:1,pixels wider:1,wider That:1,That level:1,more impressive:1,I’ve converted:1,using rectangular:1,using masked:1,images Masked:1,Masked Images:1,Images Masked:1,rendered by:1,an object’s:1,object’s pixels:1,mask pixels:1,mask specifies:1,allowed This:1,draw nonrectangular:1,nonrectangular objects:1,don’t improperly:1,improperly interfere:1,another when:1,overlap Masked:1,images also:1,also make:1,areas windows:1,windows within:1,within objects:1,objects Masked:1,images produce:1,produce far:1,animation than:1,do rectangular:1,therefore are:1,more desirable:1,desirable Unfortunately:1,Unfortunately masked:1,also considerably:1,to draw—however:1,draw—however a:1,toward making:1,making masked:1,draw rapidly:1,rapidly enough:1,enough as:1,code Masked:1,as sprites:1,sprites some:1,some video:1,hardware supports:1,supports sprites:1,sprites directly:1,directly but:1,PC it’s:1,handle sprites:1,sprites in:1,software Masked:1,images make:1,render scenes:1,scenes so:1,image convincingly:1,convincingly appears:1,behind other:1,so images:1,in z-order:1,z-order by:1,distance By:1,By consistently:1,consistently drawing:1,are supposed:1,be farther:1,away before:1,drawing nearer:1,images the:1,images will:1,because masked:1,only precisely:1,correct pixels:1,blank pixels:1,rectangle there’s:1,interference between:1,between overlapping:1,to destroy:1,illusion In:1,having separate:1,separate paired:1,paired masks:1,images Another:1,Another quite:1,to masking:1,masking is:1,specify a:1,not requiring:1,requiring separate:1,less complex:1,full masking:1,masking I’ve:1,implemented On:1,color approach:1,less flexible:1,flexible because:1,makes one:1,color undrawable:1,undrawable Also:1,Also with:1,same base:1,but use:1,use different:1,different masks:1,masks because:1,mask information:1,is embedded:1,image data:1,data Internal:1,Internal Animation:1,Animation I’ve:1,I’ve added:1,added another:1,another feature:1,feature essential:1,producing convincing:1,animation internal:1,animation which:1,object over:1,as distinguished:1,object Internal:1,Internal animation:1,images look:1,look active:1,and alive:1,alive I’ve:1,possible form:1,Listing 46.1—alternation:1,46.1—alternation between:1,two images—but:1,images—but even:1,animation greatly:1,the feel:1,images cycled:1,through simply:1,of InternalAnimateMax:1,InternalAnimateMax for:1,given entity:1,entity You:1,also implement:1,complex image-selection:1,image-selection logic:1,produce more:1,less predictable:1,predictable internal-animation:1,internal-animation effects:1,as jumping:1,jumping ducking:1,ducking running:1,like Dirty-Rectangle:1,Dirty-Rectangle Management:1,Management As:1,above dirty-rectangle:1,code didn’t:1,it copied:1,all portions:1,every dirty:1,screen regardless:1,overlap between:1,between rectangles:1,rectangles The:1,other extreme:1,extreme taking:1,taking great:1,great pains:1,pains never:1,draw overlapped:1,overlapped portions:1,rectangles more:1,overlap whenever:1,When overlap:1,existing rectangle:1,to between:1,four nonoverlapping:1,nonoverlapping rectangles:1,rectangles Those:1,Those rectangles:1,then again:1,again considered:1,for addition:1,may again:1,reduced if:1,if additional:1,additional overlap:1,detected A:1,nonoverlapped dirty:1,list Is:1,certainly can:1,46.1 probably:1,not For:1,thing you’d:1,need larger:1,larger heavily:1,heavily overlapped:1,overlapped objects:1,objects for:1,big Besides:1,Besides this:1,is mostly:1,and spends:1,spends a:1,doing things:1,things other:1,than actually:1,actually accessing:1,also takes:1,time just:1,the nonoverlapped:1,nonoverlapped list:1,the looping:1,looping intersecting:1,intersecting and:1,calling required:1,list eats:1,eats up:1,often Nonetheless:1,Nonetheless fully:1,nonoverlapped drawing:1,useful under:1,46.1 so:1,have something:1,to should:1,go this:1,this route:1,route There:1,additional techniques:1,try if:1,wring maximum:1,performance out:1,try coalescing:1,coalescing rectangles:1,rectangles as:1,you generate:1,the dirty-rectangle:1,dirty-rectangle list:1,list That:1,could detect:1,detect pairs:1,be joined:1,into larger:1,that fewer:1,fewer larger:1,rectangles would:1,copied This:1,would boost:1,the efficiency:1,low-level copying:1,code albeit:1,albeit at:1,the dirty-list:1,dirty-list management:1,management code:1,code You:1,also try:1,try taking:1,the natural:1,natural coherence:1,screens In:1,rectangle used:1,erase an:1,location often:1,often overlaps:1,overlaps the:1,rectangle within:1,image resides:1,its new:1,location you:1,just directly:1,directly generate:1,three nonoverlapped:1,nonoverlapped rectangles:1,rectangles required:1,copy both:1,rectangle and:1,the new-image:1,new-image rectangle:1,any single:1,single moving:1,moving image:1,The calculation:1,these rectangles:1,rectangles could:1,efficient given:1,know in:1,in advance:1,images Handling:1,Handling this:1,particular overlap:1,overlap case:1,case would:1,most overlapped:1,a minimal:1,minimal cost:1,cost You:1,then decide:1,ignore overlapped:1,drawing between:1,different images:1,both less:1,handle Drawing:1,Drawing Order:1,Order and:1,and Visual:1,on dirty-rectangle:1,animation concerns:1,concerns the:1,simply stuffed:1,stuffed dirty:1,rectangles into:1,order they:1,they became:1,became dirty:1,dirty and:1,then copied:1,rectangles in:1,order Unfortunately:1,caused all:1,erase rectangles:1,copied first:1,rectangles of:1,locations Consequently:1,significant delay:1,delay between:1,rectangle A:1,A byproduct:1,byproduct was:1,a partially:1,partially complete—part:1,complete—part old:1,old part:1,part new—image:1,new—image was:1,was visible:1,visible long:1,noticed In:1,short although:1,pixels ended:1,up correct:1,intermediate incorrect:1,a sufficient:1,sufficient period:1,animation look:1,look wrong:1,wrong This:1,This violated:1,violated a:1,animation No:1,No pixel:1,pixel should:1,a perceptibly:1,perceptibly incorrect:1,state To:1,To correct:1,problem I’ve:1,I’ve sorted:1,sorted the:1,rectangles first:1,first by:1,by Y:1,and secondly:1,secondly by:1,coordinate This:1,updates from:1,from to:1,image should:1,drawn nearly:1,nearly simultaneously:1,simultaneously Run:1,chapter you’ll:1,see quite:1,in appearance:1,appearance Avoid:1,Avoid the:1,thinking animation:1,merely a:1,another Animation:1,the art:1,right times:1,brain see:1,want them:1,see Animation:1,challenging than:1,than merely:1,merely cranking:1,cranking out:1,out pixels:1,purely linear:1,process Chapter:1,256-Color VGA:1,VGA Magic:1,Magic Introducing:1,Introducing the:1,VGA’s Undocumented:1,Undocumented Animation-Optimal:1,Animation-Optimal Mode:1,Mode At:1,signing for:1,attractive young:1,young woman:1,woman came:1,me holding:1,holding my:1,said You’re:1,You’re Michael:1,Abrash aren’t:1,I confessed:1,confessed that:1,was prepared:1,to respond:1,respond in:1,appropriately modest:1,modest yet:1,yet proud:1,proud way:1,the compliments:1,compliments I:1,would follow:1,follow It:1,own book:1,signing after:1,out quite:1,way though:1,thing out:1,was Mode:1,stupid name:1,name for:1,my jaw:1,jaw started:1,drop she:1,she added:1,added And:1,And you:1,didn’t invent:1,invent the:1,mode either:1,either My:1,My husband:1,husband did:1,did And:1,And they:1,say there:1,no groupies:1,groupies in:1,programming Well:1,never claimed:1,invented the:1,a 320x256-color:1,320x256-color mode:1,very special:1,special properties:1,properties as:1,shortly I:1,did discover:1,discover it:1,it independently:1,independently but:1,so did:1,did other:1,game business:1,business some:1,doubt before:1,did The:1,those other:1,people held:1,held onto:1,onto this:1,this powerful:1,powerful mode:1,a trade:1,trade secret:1,secret while:1,didn’t instead:1,instead I:1,I spread:1,as broadly:1,broadly as:1,Journal on:1,people knew:1,more valuable:1,valuable it:1,be And:1,I succeeded:1,succeeded as:1,this now:1,now widely-used:1,widely-used mode:1,is universally:1,universally known:1,known by:1,name I:1,DDJ Mode:1,X Neither:1,think that’s:1,bad name:1,name it’s:1,it’s short:1,short catchy:1,catchy and:1,remember and:1,it befits:1,befits the:1,mystery status:1,was omitted:1,omitted entirely:1,entirely from:1,from IBM’s:1,IBM’s documentation:1,documentation of:1,is said:1,said and:1,and done:1,done Mode:1,favorite accomplishments:1,accomplishments I:1,that Charles:1,Charles Schultz:1,Schultz creator:1,creator of:1,of Peanuts:1,Peanuts was:1,was particularly:1,particularly proud:1,proud of:1,having introduced:1,introduced the:1,phrase security:1,security blanket:1,blanket to:1,language I:1,feel much:1,way about:1,X it’s:1,a firmly:1,firmly entrenched:1,entrenched part:1,computer lexicon:1,lexicon and:1,that And:1,mention all:1,excellent games:1,been as:1,without Mode:1,X So:1,end I’m:1,I’m thoroughly:1,thoroughly pleased:1,did cost:1,cost me:1,my one:1,potential female:1,female fan:1,fan Contrary:1,Contrary to:1,to popular:1,popular belief:1,belief the:1,the lives:1,lives of:1,computer columnists:1,columnists and:1,and rock:1,rock stars:1,stars are:1,not repeat:1,repeat not:1,that similar:1,similar This:1,This and:1,following two:1,are based:1,started it:1,all back:1,1991 three:1,three columns:1,that generated:1,tremendous amount:1,and spawned:1,spawned a:1,a ton:1,ton of:1,still regularly:1,regularly get:1,get letters:1,and e-mail:1,e-mail Ladies:1,Ladies and:1,and gentlemen:1,gentlemen I:1,I give:1,give you…Mode:1,you…Mode X:1,X What:1,What Makes:1,Makes Mode:1,X Special:1,Special Consider:1,the strange:1,strange case:1,VGA’s 320x256-color:1,320x256-color mode—Mode:1,mode—Mode X—which:1,X—which is:1,undeniably complex:1,even documented:1,by IBM—but:1,IBM—but which:1,nonetheless perhaps:1,best mode:1,offer especially:1,32 but:1,X itself:1,itself Most:1,performance tips:1,tips I’ll:1,discuss for:1,mode also:1,also apply:1,other non-standard:1,non-standard 256-color:1,modes however:1,however Five:1,Five features:1,features set:1,set Mode:1,X apart:1,modes First:1,ratio resulting:1,equal pixel:1,spacing horizontally:1,vertically that:1,is square:1,pixels Square:1,Square pixels:1,pixels make:1,most attractive:1,attractive displays:1,avoid considerable:1,considerable programming:1,programming effort:1,effort that:1,adjust graphics:1,graphics primitives:1,the screen’s:1,screen’s pixel:1,spacing For:1,with square:1,pixels a:1,circle can:1,circle otherwise:1,an ellipse:1,ellipse that:1,that corrects:1,corrects for:1,the aspect:1,aspect ratio—a:1,ratio—a slower:1,and considerably:1,contrast mode:1,only documented:1,documented 256-color:1,a nonsquare:1,nonsquare 320x200:1,resolution Second:1,Second Mode:1,flipping a:1,a prerequisite:1,prerequisite for:1,the smoothest:1,smoothest possible:1,possible animation:1,not allow:1,allow page:1,flipping nor:1,does mode:1,high-resolution 640x480:1,mode Third:1,Third Mode:1,process pixels:1,parallel improving:1,over mode:1,13H Fourth:1,Fourth like:1,like mode:1,13H but:1,unlike all:1,modes Mode:1,a byte-per-pixel:1,byte-per-pixel mode:1,memory eliminating:1,slow read-before-write:1,read-before-write and:1,and bit-masking:1,bit-masking operations:1,operations often:1,often required:1,memory represents:1,represents more:1,to cutting:1,half this:1,486/Pentium write:1,FIFO and:1,memory caching:1,schemes used:1,clones speed:1,up writes:1,writes more:1,than reads:1,reads Fifth:1,Fifth unlike:1,unlike mode:1,13H Mode:1,X has:1,has plenty:1,of offscreen:1,memory free:1,for image:1,storage This:1,particularly effective:1,effective in:1,latches together:1,the off-screen:1,memory allow:1,allow images:1,screen four:1,a sixth:1,sixth feature:1,X that’s:1,so terrific:1,terrific It’s:1,program efficiently:1,efficiently As:1,As Chapters:1,through 30:1,30 of:1,book demonstrates:1,demonstrates 16-color:1,be demanding:1,demanding Mode:1,as demanding:1,demanding as:1,as 16-color:1,16-color programming:1,and operates:1,operates by:1,turns everything:1,mode sideways:1,sideways Programming:1,Programming Mode:1,nothing like:1,like programming:1,nice flat:1,13H or:1,flat linear:1,linear albeit:1,albeit banked:1,banked bitmap:1,bitmap used:1,by 256-color:1,modes I’t’s:1,I’t’s important:1,X works:1,VGAs not:1,just SuperVGAs:1,SuperVGAs Many:1,Many programmers:1,programmers I:1,I talk:1,to love:1,love the:1,bitmap model:1,ideal organization:1,so straightforward:1,program Here:1,is opportunity—opportunity:1,opportunity—opportunity for:1,appearance the:1,offer If:1,do 256-color:1,use animation:1,animation you’re:1,the boat:1,boat if:1,using Mode:1,X Although:1,Although some:1,some developers:1,developers have:1,taken advantage:1,X its:1,not universal:1,universal being:1,being entirely:1,entirely undocumented:1,undocumented only:1,an experienced:1,experienced VGA:1,slightest inkling:1,inkling that:1,even exists:1,exists and:1,and figuring:1,perform beyond:1,write pixel/read:1,pixel/read pixel:1,pixel level:1,mean feat:1,feat Little:1,Little other:1,my DDJ:1,columns has:1,been published:1,published about:1,it although:1,although John:1,has widely:1,widely distributed:1,distributed his:1,of undocumented:1,resolutions and:1,the influence:1,influence of:1,routine presented:1,chapter Given:1,tremendous advantages:1,X over:1,documented mode:1,13H I’d:1,I’d very:1,many developers:1,developers as:1,exploring this:1,odd but:1,but worthy:1,worthy mode:1,mode I’ll:1,provide mode:1,code delineate:1,delineate the:1,basic write:1,pixel operations:1,operations work:1,work Then:1,Then I’ll:1,magic stuff:1,stuff rectangle:1,fills screen:1,screen clears:1,clears scrolls:1,scrolls image:1,copies pixel:1,pixel inversion:1,inversion and:1,yes polygon:1,polygon fills:1,fills just:1,different driver:1,driver for:1,polygon code:1,all blurry:1,blurry fast:1,fast hardware:1,hardware raster:1,raster ops:1,ops and:1,end I’ll:1,I’ll build:1,working animation:1,that shows:1,shows many:1,logical place:1,begin Selecting:1,Selecting 320x240:1,320x240 256-Color:1,Mode We:1,wished write:1,write our:1,own mode:1,from scratch—but:1,scratch—but why:1,bother Instead:1,Instead we’ll:1,BIOS do:1,work by:1,having it:1,it set:1,we’ll then:1,then turn:1,changing a:1,few registers:1,47.1 does:1,47.1 has:1,version had:1,serves up:1,lesson The:1,original DDJ:1,DDJ version:1,version made:1,made images:1,images roll:1,roll on:1,on IBM’s:1,IBM’s fixed-frequency:1,monitors a:1,my attention:1,attention until:1,print and:1,and shipped:1,to 100000:1,100000 readers:1,readers The:1,bug came:1,came about:1,VGA’s 28-MHz:1,28-MHz clock:1,clock Mode:1,X should:1,have used:1,clock a:1,3C2H to:1,0 instead:1,1 Alas:1,I neglected:1,neglected to:1,so frames:1,been however:1,however both:1,my monitors:1,monitors are:1,are multifrequency:1,multifrequency types:1,they automatically:1,automatically compensated:1,faster frame:1,rate Consequently:1,Consequently my:1,my clock-selection:1,clock-selection bug:1,bug was:1,was invisible:1,and innocuous—until:1,innocuous—until it:1,was distributed:1,distributed broadly:1,broadly and:1,and everybody:1,everybody started:1,started banging:1,banging on:1,it IBM:1,IBM makes:1,makes only:1,only fixed-frequency:1,monitors which:1,specific frame:1,rates if:1,get what:1,you’ve told:1,told them:1,to expect:1,image rolls:1,rolls The:1,The corrected:1,corrected version:1,one shown:1,47.1 it:1,does select:1,clock and:1,on fixed-frequency:1,fixed-frequency monitors:1,monitors Why:1,Why didn’t:1,I catch:1,catch this:1,bug Neither:1,Neither I:1,I nor:1,nor a:1,single one:1,my testers:1,testers had:1,a fixed-frequency:1,fixed-frequency monitor:1,monitor This:1,This nicely:1,difficult it:1,is these:1,PC-compatible environments:1,particularly severe:1,severe for:1,small developers:1,developers who:1,who can’t:1,buy every:1,every model:1,every hardware:1,hardware component:1,every manufacturer:1,manufacturer just:1,just imagine:1,imagine trying:1,test network-aware:1,network-aware software:1,possible configurations:1,configurations When:1,When people:1,people ask:1,why software:1,software isn’t:1,isn’t bulletproof:1,bulletproof why:1,it crashes:1,crashes or:1,or doesn’t:1,doesn’t coexist:1,certain programs:1,programs why:1,why PC:1,PC clones:1,clones aren’t:1,always compatible:1,compatible why:1,why in:1,the myriad:1,myriad irritations:1,irritations of:1,PC exist—this:1,exist—this is:1,big part:1,guess that’s:1,price we:1,we pay:1,the unfettered:1,unfettered creativity:1,creativity and:1,and vast:1,vast choice:1,market After:1,After setting:1,13H Listing:1,47.1 alters:1,vertical counts:1,and timings:1,select 480:1,480 visible:1,visible scan:1,lines There’s:1,horizontal values:1,values because:1,X both:1,have 320-pixel:1,320-pixel horizontal:1,resolutions The:1,The Maximum:1,double scan:1,scan each:1,is repeat:1,line twice:1,twice however:1,effective vertical:1,of 240:1,240 scan:1,lines It:1,get 400:1,400 or:1,or 480:1,480 independent:1,independent scan:1,32 however:1,however 400-scan-line:1,400-scan-line modes:1,lack square:1,support simultaneous:1,simultaneous off-screen:1,flipping Furthermore:1,Furthermore 480-scan-line:1,lack page:1,flipping altogether:1,altogether due:1,memory constraints:1,constraints At:1,47.1 programs:1,VGA’s bitmap:1,planar organization:1,organization that:1,and utterly:1,utterly different:1,the linear:1,The bizarre:1,bizarre bitmap:1,47.1 The:1,X blessedly:1,blessedly has:1,has in:1,common with:1,byte eliminating:1,pixel immediately:1,immediately to:1,cycle continues:1,each group:1,pixels spread:1,address The:1,The offset:1,offset M:1,M of:1,is M:1,M N/4:1,N/4 and:1,plane P:1,is P:1,P N:1,N mod:1,mod 4:1,4 For:1,For display:1,bit P:1,to P:1,P It:1,one ugly:1,ugly bitmap:1,organization requiring:1,Listing 47.2:1,47.2 must:1,must determine:1,appropriate plane:1,select that:1,Listing 47.3:1,47.3 Calculating:1,Calculating and:1,and mapping:1,written is:1,scarcely a:1,a recipe:1,recipe for:1,right though:1,software spends:1,spends little:1,little time:1,time drawing:1,pixels I’ve:1,routines as:1,as basic:1,basic primitives:1,organized but:1,the building:1,high-performance graphics:1,software are:1,are fills:1,fills copies:1,and bitblts:1,bitblts and:1,X shines:1,shines Figure:1,organization Figure:1,organization Designing:1,Designing from:1,X Perspective:1,Perspective Listing:1,47.4 shows:1,shows Mode:1,X rectangle:1,drawing cycling:1,3 then:1,then wrapping:1,that stems:1,stems from:1,a write-pixel:1,write-pixel line:1,thinking it:1,it reflects:1,reflects not:1,unique perspective:1,X demands:1,demands and:1,looks reasonably:1,efficient it:1,slowest graphics:1,see I’ve:1,provided Listing:1,47.4 partly:1,purposes but:1,mostly so:1,the substantial:1,substantial speed-up:1,speed-up that’s:1,major weaknesses:1,47.4 both:1,both result:1,from selecting:1,pixel basis:1,basis First:1,First endless:1,endless OUT:1,s which:1,particularly slow:1,386s 486s:1,Pentiums much:1,than accesses:1,second REP:1,STOS can’t:1,used Listing:1,47.5 overcomes:1,overcomes both:1,both these:1,by tailoring:1,tailoring the:1,fill technique:1,technique to:1,one burst:1,burst before:1,five OUT:1,STOS can:1,indeed be:1,used I’ve:1,STOSB in:1,Listings 47.5:1,47.5 and:1,47.6 REP:1,STOSW could:1,VGAs however:1,however REP:1,STOSW requires:1,small rectangles:1,rectangles especially:1,on 8-bit:1,8-bit VGAs:1,VGAs Note:1,that doing:1,entire plane:1,effect for:1,all columns:1,drawn before:1,any columns:1,through once:1,line rather:1,entire rectangle:1,rectangle Listing:1,47.4 at:1,a Paradise:1,VGA Although:1,Although Listing:1,equivalent mode:1,13H fill:1,be it’s:1,not grievously:1,grievously so:1,general performing:1,performing plane-at-a-time:1,plane-at-a-time operations:1,make almost:1,any Mode:1,X operation:1,worst nearly:1,13H although:1,X programming:1,admittedly fairly:1,complex In:1,to organize:1,organize data:1,mind For:1,example icons:1,icons could:1,be prearranged:1,prearranged in:1,pixels organized:1,organized into:1,four plane-oriented:1,plane-oriented sets:1,sets or:1,or again:1,sets per:1,avoid a:1,effect to:1,facilitate copying:1,screen a:1,MOVS Hardware:1,Hardware Assist:1,Assist from:1,an Unexpected:1,Unexpected Quarter:1,Quarter Listing:1,47.5 illustrates:1,of designing:1,designing code:1,software aspect:1,X optimization:1,which suffices:1,make Mode:1,X about:1,13H That:1,That alone:1,alone makes:1,makes Mode:1,attractive mode:1,mode given:1,given its:1,its square:1,pixels page:1,and offscreen:1,but superior:1,would nonetheless:1,nonetheless be:1,a pleasant:1,pleasant addition:1,list Superior:1,Superior performance:1,although oddly:1,enough it:1,comes courtesy:1,hardware which:1,never designed:1,modes All:1,some are:1,useful The:1,feature that’s:1,that’s truly:1,X performance:1,process four:1,planes worth:1,parallel this:1,this includes:1,fan data:1,For rectangular:1,rectangular fills:1,fills we’ll:1,just need:1,fan the:1,to various:1,various planes:1,planes so:1,I’ll defer:1,defer a:1,other hardware:1,ALUs bit:1,also available:1,13H—but parallel:1,parallel data:1,not In:1,In planar:1,X a:1,memory may:1,actually go:1,anywhere between:1,47.2 Each:1,1 receives:1,receives the:1,not modified:1,modified In:1,modes each:1,contains one-quarter:1,pixel spanning:1,spanning all:1,planes Not:1,X Look:1,47.1 again:1,again each:1,contains one:1,plane Still:1,register does:1,same job:1,X as:1,modes set:1,0FH all:1,1-bits and:1,access Thus:1,single Mode:1,X byte-sized:1,potentially speeding:1,up operations:1,like rectangle:1,fills by:1,times Figure:1,register And:1,out four-plane:1,four-plane parallelism:1,parallelism works:1,works quite:1,nicely indeed:1,indeed Listing:1,another rectangle-fill:1,rectangle-fill routine:1,routine this:1,per STOS:1,STOS The:1,any left:1,left or:1,isn’t aligned:1,aligned to:1,a multiple-of-four:1,multiple-of-four pixel:1,pixel column:1,column at:1,one four-pixel:1,set ends:1,next begins:1,begins must:1,clipped via:1,register because:1,address containing:1,modified Performance:1,Performance is:1,expected Listing:1,nearly ten:1,47.4 and:1,Listing 47.5—and:1,47.5—and also:1,also about:1,same rectangle:1,13H Understanding:1,display hardware:1,X does:1,does indeed:1,indeed pay:1,pay Note:1,from Mode:1,X’s parallelism:1,parallelism is:1,always 4x:1,4x some:1,some adapters:1,adapters lack:1,underlying memory:1,fast However:1,X parallel:1,parallel access:1,access should:1,13H access:1,only question:1,question on:1,given adapter:1,faster Just:1,Just so:1,see Mode:1,47.7 is:1,that selects:1,selects Mode:1,rectangles Listing:1,47.7 links:1,links to:1,fill routines:1,routines I’ve:1,presented And:1,hope you’re:1,you’re beginning:1,why I’m:1,wonders that:1,and parallel:1,parallel plane:1,plane hardware:1,on scrolls:1,scrolls copies:1,copies blits:1,blits and:1,fills Chapter:1,Chapter 48:1,48 Mode:1,X Marks:1,Marks the:1,the Latch:1,Latch The:1,The Internals:1,Internals of:1,of Animation’s:1,Animation’s Best:1,Best Video:1,Video Display:1,Display Mode:1,Mode In:1,introduced you:1,call Mode:1,VGA Mode:1,is distinguished:1,documented 320x200:1,it supports:1,supports page:1,flipping makes:1,makes off-screen:1,available has:1,has square:1,and above:1,all lets:1,increase performance:1,times Of:1,times come:1,come at:1,and demanding:1,demanding programming:1,programming to:1,be sure—but:1,sure—but end:1,how hard:1,hard the:1,X delivers:1,delivers results:1,way In:1,speed solid:1,solid fills:1,fills That’s:1,nice technique:1,move up:1,big guns—the:1,guns—the VGA:1,latches one:1,Each latch:1,latch stores:1,stores exactly:1,48.1 Furthermore:1,Furthermore whenever:1,read all:1,planes bytes:1,address are:1,and stored:1,corresponding latches:1,latches regardless:1,which plane:1,plane supplied:1,supplied the:1,byte returned:1,else about:1,make little:1,little sense:1,VGA neophytes:1,neophytes but:1,this By:1,By reading:1,reading one:1,byte 4:1,4 bytes—one:1,each plane—can:1,plane—can be:1,latches at:1,once Any:1,written anywhere:1,single byte-sized:1,48.2 Figure:1,latches make:1,data around:1,another 32:1,bits four:1,a time—four:1,time—four times:1,as normal:1,normal Recall:1,Recall from:1,stored one:1,row stored:1,successive planes:1,pixel per:1,plane However:1,one latch:1,so an:1,an individual:1,individual latch:1,pixels 0:1,4 8:1,5 9:1,9 and:1,latches aren’t:1,aren’t intended:1,intended for:1,256-color mode—they:1,mode—they were:1,allow individual:1,16-color mode—but:1,mode—but they:1,nonetheless very:1,X particularly:1,for patterned:1,and screen-to-screen:1,screen-to-screen copies:1,copies including:1,including scrolls:1,scrolls Patterned:1,Patterned filling:1,start because:1,because patterns:1,in windowing:1,windowing environments:1,environments for:1,for desktops:1,desktops window:1,window backgrounds:1,backgrounds and:1,and scroll:1,scroll bars:1,bars and:1,for textures:1,color dithering:1,dithering in:1,game software:1,software Fast:1,Fast Mode:1,X fills:1,fills using:1,using patterns:1,width can:1,pattern once:1,one address:1,memory reading:1,pattern into:1,latches setting:1,specify that:1,bits drawn:1,memory should:1,performing the:1,fill pretty:1,previous chapter—except:1,chapter—except that:1,pattern must:1,filled Listings:1,Listings 48.1:1,48.1 and:1,and 48.2:1,48.2 together:1,together demonstrate:1,fast Mode:1,X four-by-four:1,four-by-four pattern:1,fills The:1,set function:1,Listing 48.1:1,48.1 is:1,is from:1,listings Four-pixel-wide:1,Four-pixel-wide patterns:1,imagine There:1,actually 2128:1,2128 possible:1,possible patterns:1,patterns 16:1,with 28:1,28 possible:1,certainly large:1,most color-dithering:1,color-dithering purposes:1,and includes:1,includes many:1,many often-used:1,often-used patterns:1,patterns such:1,as halftones:1,halftones diagonal:1,diagonal stripes:1,stripes and:1,and crosshatches:1,crosshatches Furthermore:1,Furthermore eight-wide:1,eight-wide patterns:1,used can:1,passes one:1,pattern This:1,This principle:1,be extended:1,to patterns:1,of arbitrary:1,arbitrary multiple-of-four:1,widths Widths:1,Widths that:1,aren’t multiples:1,are considerably:1,handle because:1,wide one:1,is expanding:1,expanding such:1,such patterns:1,patterns via:1,via repetition:1,repetition until:1,until they:1,are multiple-of-four:1,widths Allocating:1,Allocating Memory:1,X Listing:1,48.2 raises:1,raises some:1,interesting questions:1,48.2 whenever:1,first drawn:1,entirety at:1,very end:1,then loaded:1,that copy:1,pattern before:1,actual fill:1,fill is:1,drawn Why:1,Why this:1,this double:1,pattern stored:1,particular area:1,The double:1,Remember there’s:1,get information:1,information must:1,some location:1,memory By:1,to off-screen:1,about interfering:1,for why:1,stored exactly:1,is that’s:1,that’s part:1,a master:1,master memory:1,memory allocation:1,allocation plan:1,plan that:1,to fruition:1,fruition in:1,I implement:1,this master:1,master plan:1,plan the:1,each 76800:1,long spanning:1,spanning 19200:1,19200 addresses—that:1,addresses—that is:1,is 19200:1,19200 pixel:1,pixel quadruplets—in:1,quadruplets—in display:1,also 76800:1,long is:1,for storing:1,background which:1,the holes:1,holes left:1,left after:1,last 16:1,pixels four:1,four addresses:1,pattern buffer:1,remaining 31728:1,31728 pixels:1,pixels 7932:1,7932 addresses:1,for storage:1,storage of:1,of icons:1,icons images:1,images temporary:1,temporary buffers:1,buffers or:1,or whatever:1,whatever Figure:1,layout Figure:1,layout This:1,efficient organization:1,certainly many:1,other possible:1,possible setups:1,setups For:1,solid-colored background:1,could dispense:1,dispense with:1,page instead:1,instead using:1,solid rectangle:1,background after:1,move freeing:1,up another:1,another 76800:1,buffers You:1,could even:1,even eliminate:1,eliminate page-flipping:1,page-flipping altogether:1,altogether if:1,you needed:1,to free:1,with enough:1,enough free:1,X to:1,bitmap three:1,times larger:1,screen becoming:1,a scrolling:1,scrolling window:1,onto that:1,that larger:1,larger bitmap:1,bitmap This:1,good effect:1,animated games:1,games with:1,X Copying:1,Copying Pixel:1,Pixel Blocks:1,Blocks within:1,within Display:1,Memory Another:1,Another fine:1,fine use:1,is copying:1,copying pixels:1,another Whenever:1,destination share:1,is their:1,addresses modulo:1,same it:1,but quite:1,quite easy:1,that copies:1,copies via:1,latches When:1,destination do:1,not share:1,alignment the:1,latches cannot:1,destination planes:1,pixel differ:1,differ In:1,source plane:1,plane Then:1,Then copy:1,plane repeating:1,repeating for:1,planes Although:1,Although copying:1,copying through:1,speedy technique:1,technique especially:1,slower VGAs:1,VGAs it’s:1,win Reading:1,Reading video:1,than writing:1,VLB or:1,or PCI:1,PCI adapter:1,memory via:1,48.3 has:1,limitation It:1,guarantee proper:1,handling when:1,destination overlap:1,a downward:1,downward scroll:1,scroll for:1,48.3 performs:1,performs top-to-bottom:1,left-to-right copying:1,copying Downward:1,Downward scrolls:1,require bottom-to-top:1,bottom-to-top copying:1,copying likewise:1,likewise rightward:1,rightward horizontal:1,horizontal scrolls:1,require right-to-left:1,right-to-left copying:1,copying As:1,happens my:1,my intended:1,intended use:1,48.3 is:1,images between:1,between off-screen:1,and on-screen:1,on-screen memory:1,save areas:1,areas under:1,under pop-up:1,pop-up menus:1,menus and:1,don’t really:1,need overlap:1,overlap handling—and:1,handling—and I:1,do really:1,discussion down:1,down However:1,surely want:1,add overlap:1,overlap handling:1,you plan:1,perform arbitrary:1,arbitrary scrolling:1,scrolling and:1,memory Now:1,images around:1,draw icons:1,icons and:1,13H depending:1,you’re worried:1,worried about:1,the nibble-alignment:1,nibble-alignment limitation:1,limitation on:1,fast copies:1,copies don’t:1,don’t be:1,be I’ll:1,that fully:1,fully in:1,in due:1,due time:1,the secret:1,possible rotations:1,rotations in:1,then select:1,correct one:1,each copy:1,copy However:1,However before:1,before our:1,our fast:1,fast display:1,us any:1,good we:1,patterns from:1,copied with:1,fast copy:1,routine Copying:1,Copying to:1,to Display:1,Memory The:1,to display-memory-copy-routine:1,display-memory-copy-routine shown:1,48.4 This:1,This routine:1,routine assumes:1,that pixels:1,will ultimately:1,ultimately appear:1,same linear:1,linear order:1,13H uses:1,uses It:1,plane first:1,avoided but:1,make images:1,rather hard:1,create And:1,images is:1,general often:1,critical performance:1,performance factor:1,factor the:1,copying images:1,particularly critical:1,critical in:1,X Important:1,Important images:1,and copied:1,screen via:1,latches much:1,speediest system:1,routine could:1,manage I’m:1,perform Mode:1,X copies:1,copies from:1,straightforward inverse:1,inverse of:1,48.4 Who:1,Image Copier:1,Copier At:1,be time:1,X tools:1,tools we’ve:1,developed together:1,more tool—masked:1,tool—masked image:1,image copying—and:1,copying—and the:1,remaining unexplored:1,unexplored feature:1,X page:1,done you’ll:1,you’ll agree:1,agree with:1,animate on:1,PC In:1,truth though:1,matters less:1,less whether:1,animate than:1,users think:1,way based:1,on results:1,results end:1,you produced:1,produced them:1,them For:1,my writing:1,writing you:1,end users—and:1,users—and notice:1,notice how:1,how remarkably:1,remarkably little:1,little you:1,book gets:1,and produced:1,produced You:1,You care:1,the bookstore:1,bookstore and:1,contents but:1,you sure:1,heck don’t:1,it got:1,got that:1,a bin:1,bin of:1,tree pulp:1,pulp When:1,a creator:1,creator the:1,process matters:1,matters When:1,a buyer:1,buyer results:1,are everything:1,everything All:1,All important:1,important Sine:1,Sine qua:1,non The:1,whole enchilada:1,enchilada If:1,drift Chapter:1,49 Mode:1,256-Color Animation:1,Animation How:1,to Make:1,Make the:1,VGA Really:1,Really Get:1,Get up:1,and Dance:1,Dance Okay—no:1,Okay—no amusing:1,amusing stories:1,stories or:1,or informative:1,informative anecdotes:1,anecdotes to:1,to kick:1,chapter lotta:1,lotta ground:1,cover gotta:1,gotta hurry—you’re:1,hurry—you’re impatient:1,impatient I:1,can smell:1,smell it:1,won’t talk:1,friend made:1,of loudly:1,loudly saying:1,saying 100:1,100 bill:1,bill during:1,during an:1,discussion while:1,walking among:1,the bums:1,bums on:1,on Market:1,Francisco one:1,night thereby:1,thereby graphically:1,graphically illustrating:1,illustrating that:1,can’t spare:1,spare a:1,daughter thinks:1,thinks my:1,my 11-year-old:1,11-year-old floppy-disk-based:1,floppy-disk-based CP/M:1,CP/M machine:1,machine is:1,its 100-MB:1,100-MB hard:1,disk because:1,the CP/M:1,CP/M machine’s:1,machine’s word:1,processor loads:1,386’s Windows-based:1,Windows-based word:1,processor demonstrating:1,that progress:1,progress is:1,the neat:1,neat exponential:1,exponential curve:1,curve we’d:1,that features:1,often conflicting:1,conflicting notions:1,notions And:1,And lord:1,knows I:1,can’t take:1,the habits:1,habits of:1,small white:1,white dogs:1,dogs notwithstanding:1,notwithstanding that:1,such dogs:1,dogs seem:1,be relevant:1,every aspect:1,computing as:1,as Jeff:1,Duntemann’s writings:1,writings make:1,make manifest:1,manifest No:1,No lighthearted:1,lighthearted fluff:1,fluff for:1,have real:1,for today:1,today we:1,we animate:1,animate with:1,X Masked:1,Copying Over:1,past two:1,we’ve put:1,together most:1,tools needed:1,implement animation:1,256-color Mode:1,X We:1,have mode:1,code solid:1,and 4x4:1,4x4 pattern:1,fills system:1,copies The:1,a nonrectangular:1,nonrectangular image:1,this masked:1,copying Masked:1,Masked copying:1,like drawing:1,drawing through:1,a stencil:1,stencil in:1,only certain:1,certain pixels:1,destination rectangle:1,rectangle are:1,fit the:1,image seamlessly:1,seamlessly into:1,background without:1,rectangular fringe:1,fringe that:1,when nonrectangular:1,nonrectangular images:1,copying their:1,their bounding:1,rectangle This:1,second rectangular:1,rectangular bitmap:1,bitmap separate:1,but corresponding:1,basis to:1,unchanged With:1,properly belonging:1,image fits:1,fits perfectly:1,no rectangular:1,rectangular border:1,border In:1,fact masked:1,copying even:1,even makes:1,areas within:1,within images:1,images Note:1,achieve this:1,implement copying:1,doesn’t get:1,get copied:1,copied but:1,rather leaves:1,destination unchanged:1,unchanged Transparent:1,Transparent copying:1,copying makes:1,compact images:1,a software-only:1,software-only implementation:1,implementation However:1,X supports:1,supports masked:1,copying but:1,use masked:1,memory masked:1,49.1 implements:1,implements masked:1,fashion In:1,main drawing:1,drawing loop:1,corresponding mask:1,is consulted:1,consulted as:1,copied only:1,is nonzero:1,nonzero As:1,the system-to-display:1,system-to-display code:1,presented Listing:1,49.1 is:1,not heavily:1,optimized because:1,it’s inherently:1,slow there’s:1,go when:1,that’s to:1,hardware Faster:1,Faster Masked:1,Copying In:1,X We’ve:1,We’ve further:1,further seen:1,copied That’s:1,perform fast:1,masked copies:1,copies we:1,off-screen display:1,appropriate mask:1,as up:1,time are:1,copied There’s:1,destination left:1,edge coordinates:1,coordinates modulo:1,each properly:1,properly positioned:1,positioned for:1,possible destination-left-edge-modulo-four:1,destination-left-edge-modulo-four cases:1,cases These:1,These aligned:1,images must:1,be accompanied:1,accompanied by:1,image mask:1,mask stored:1,memory Given:1,alignments masked:1,the alignment:1,alignment that’s:1,that’s appropriate:1,edge then:1,Mask with:1,4-bit mask:1,mask corresponding:1,each four-pixel:1,we copy:1,49.2 performs:1,performs fast:1,copying This:1,code expects:1,to receive:1,receive a:1,a MaskedImage:1,structure which:1,turn points:1,four AlignedMaskedImage:1,AlignedMaskedImage structures:1,possible image:1,alignments The:1,The aligned:1,the aligned:1,aligned masks:1,memory further:1,further the:1,the masks:1,are predigested:1,predigested into:1,into Map:1,Mask register-compatible:1,register-compatible form:1,that ready-to-use:1,ready-to-use data:1,data Listing:1,49.2 selects:1,selects and:1,appropriate image-mask:1,image-mask pair:1,edge alignment:1,alignment It:1,mask generates:1,alignments and:1,the MaskedImage:1,structure Listing:1,49.3 together:1,the include:1,Listing 49.4:1,49.4 and:1,memory block-copy:1,block-copy routine:1,48.4 in:1,chapter does:1,that It:1,if Listing:1,49.3 were:1,that generating:1,generating aligned:1,images needs:1,fast in:1,cases I:1,prefer to:1,C for:1,reasons of:1,coding speed:1,speed fewer:1,fewer bugs:1,and maintainability:1,maintainability Notes:1,on Masked:1,Copying Listings:1,49.2 like:1,all Mode:1,X code:1,presented perform:1,clipping because:1,because clipping:1,listings too:1,much While:1,While clipping:1,clipping can:1,implemented directly:1,routines at:1,instance another:1,another potentially:1,potentially simpler:1,simpler approach:1,perform clipping:1,level modifying:1,and dimensions:1,dimensions passed:1,to low-level:1,low-level routines:1,routines such:1,as Listings:1,49.2 as:1,desired clipping:1,clipping It:1,for precisely:1,routines support:1,support programmable:1,programmable start:1,than assuming:1,assuming 00:1,00 likewise:1,the distinction:1,draw Also:1,Also it:1,up structures:1,destination bitmaps:1,bitmaps with:1,with dimensions:1,dimensions and:1,coordinates built:1,simply pass:1,pass pointers:1,these structures:1,structures to:1,level rather:1,than passing:1,passing many:1,many separate:1,parameters as:1,used separate:1,simplicity and:1,flexibility Be:1,as nifty:1,nifty as:1,X hardware-assisted:1,hardware-assisted masked:1,than software-only:1,software-only masked:1,masked or:1,or transparent:1,copying depends:1,depends upon:1,adapter The:1,X masked:1,32-bit parallelism:1,parallelism the:1,disadvantages are:1,OUT for:1,pixels OUT:1,slow 486/Pentium:1,486/Pentium instruction:1,VGAs respond:1,respond to:1,to OUT:1,s much:1,writes Animation:1,Animation Gosh:1,Gosh There’s:1,There’s just:1,just no:1,can discuss:1,discuss high-level:1,high-level animation:1,animation fundamentals:1,fundamentals in:1,any detail:1,detail here:1,here I:1,could spend:1,entire and:1,and entirely:1,entirely separate:1,techniques alone:1,alone You:1,Chapters 43:1,43 through:1,through 46:1,46 before:1,attacking the:1,present volume:1,volume I:1,chapter Basically:1,Basically I’m:1,bitmap large:1,hold a:1,full screen:1,to When:1,newly modified:1,modified page:1,the other—now:1,other—now invisible—page:1,invisible—page is:1,process repeats:1,repeats ad:1,infinitum For:1,information some:1,good places:1,places to:1,start are:1,Dam Addison-Wesley:1,Addison-Wesley Principles:1,Sproull McGraw:1,McGraw Hill:1,Hill and:1,and Real-Time:1,Real-Time Animation:1,Animation by:1,by Rahner:1,Rahner James:1,James January:1,January 1990:1,1990 Dr:1,Journal Some:1,chapter was:1,was adapted:1,adapted for:1,Chapter 44—yet:1,44—yet another:1,chapter before:1,before finishing:1,finishing this:1,one Mode:1,X Animation:1,49.5 ties:1,ties together:1,together everything:1,discussed about:1,compact but:1,powerful animation:1,package Listing:1,49.5 first:1,first uses:1,uses solid:1,and patterned:1,and system-memory-to-screen-memory:1,system-memory-to-screen-memory masked:1,static background:1,background containing:1,a mountain:1,mountain a:1,a sun:1,sun a:1,plain water:1,water and:1,house with:1,with puffs:1,puffs of:1,of smoke:1,smoke coming:1,the chimney:1,chimney and:1,four alignments:1,masked kite:1,kite image:1,The background:1,is transferred:1,transferred to:1,both display:1,20 kite:1,kite images:1,page using:1,using fast:1,copying begins:1,begins After:1,images have:1,newly updated:1,updated screen:1,kites are:1,page which:1,displayed Kites:1,Kites are:1,erased at:1,positions in:1,page by:1,copying from:1,page See:1,discussion in:1,organization used:1,49.5 So:1,concerned there:1,any hint:1,hint of:1,flicker or:1,or disturbance:1,disturbance of:1,background This:1,continues at:1,60 times:1,second until:1,until Esc:1,Esc is:1,pressed to:1,exit the:1,program See:1,See Figure:1,screen shot:1,resulting image—add:1,image—add the:1,imagination Figure:1,screen Here’s:1,Here’s something:1,something worth:1,noting The:1,smooth on:1,386 It:1,more jerky:1,286 because:1,only 30:1,frames a:1,second can:1,processed If:1,If animation:1,looks jerky:1,your PC:1,PC try:1,try reducing:1,of kites:1,kites The:1,The kites:1,kites draw:1,draw perfectly:1,fringe thanks:1,to masked:1,copying In:1,kites also:1,also cross:1,cross with:1,interference the:1,the last-drawn:1,last-drawn kite:1,kite is:1,front although:1,not readily:1,apparent because:1,same anyway:1,moving fast:1,49.5 isn’t:1,isn’t inherently:1,inherently limited:1,to kites:1,kites create:1,create your:1,own images:1,and initialize:1,initialize the:1,The external:1,external functions:1,functions called:1,49.5 can:1,49.1 49.2:1,49.2 49.3:1,49.3 and:1,and 49.6:1,49.6 and:1,chapters Works:1,Works Fast:1,Fast Looks:1,Looks Great:1,Great We:1,now end:1,end our:1,although we’ll:1,again shortly:1,shortly for:1,X admittedly:1,admittedly has:1,its complexities:1,complexities that’s:1,why I’ve:1,provided a:1,a broad:1,broad and:1,flexible primitive:1,primitive set:1,set Still:1,Still so:1,complex Take:1,49.5 in:1,action That:1,of colorful:1,colorful high-performance:1,worth jumping:1,jumping through:1,few hoops:1,hoops for:1,drawing 20:1,20 or:1,10 fair-sized:1,fair-sized objects:1,Hz with:1,no flicker:1,flicker interference:1,fringe is:1,mean accomplishment:1,accomplishment even:1,386 There’s:1,with animation:1,particular but:1,to new:1,new challenges:1,challenges In:1,In closing:1,closing I’d:1,features including:1,the built-in:1,built-in AND:1,XOR functions:1,X just:1,modes If:1,12H try:1,try applying:1,applying that:1,X you:1,find you:1,50 Adding:1,a Dimension:1,Dimension 3-D:1,Animation Using:1,Using Mode:1,X When:1,first started:1,started programming:1,micros more:1,than 11:1,11 years:1,ago now:1,now there:1,there wasn’t:1,much money:1,or visibility:1,visibility or:1,could call:1,a promising:1,promising career:1,career Sometimes:1,accomplish things:1,gotten done:1,otherwise because:1,because minicomputer:1,minicomputer time:1,time cost:1,cost too:1,much other:1,times it:1,it paid:1,paid the:1,the rent:1,rent mostly:1,mostly though:1,fun Given:1,Given free:1,free computer:1,computer time:1,life I:1,wild writing:1,writing versions:1,software I:1,had seen:1,seen on:1,on mainframes:1,mainframes in:1,in arcades:1,arcades wherever:1,wherever It:1,wonderful way:1,how computers:1,computers work:1,work Trial:1,Trial and:1,an environment:1,environment where:1,where nobody:1,nobody minded:1,minded the:1,errors with:1,no meter:1,meter ticking:1,ticking Many:1,Many sorts:1,software demanded:1,demanded no:1,particular skills:1,skills other:1,quick mind:1,experiment Space:1,Space Invaders:1,Invaders for:1,instance or:1,or full-screen:1,full-screen operating:1,system shells:1,shells Others:1,Others such:1,as compilers:1,compilers required:1,required a:1,of formal:1,formal knowledge:1,knowledge Still:1,Still others:1,others required:1,required not:1,only knowledge:1,knowledge but:1,also more:1,more horse-power:1,horse-power than:1,had available:1,latter I:1,I filed:1,away on:1,my ever-growing:1,ever-growing wish:1,wish list:1,then forgot:1,forgot about:1,about for:1,while Three-dimensional:1,most alluring:1,alluring of:1,passed over:1,over long:1,ago The:1,The information:1,do rotation:1,rotation projection:1,projection rendering:1,rendering and:1,like was:1,was neither:1,neither so:1,well developed:1,nor widely:1,widely so:1,so available:1,available then:1,then as:1,now although:1,truth it:1,more intimidating:1,intimidating than:1,it ultimately:1,ultimately proved:1,be Even:1,Even had:1,I possessed:1,possessed the:1,knowledge though:1,seems unlikely:1,have coaxed:1,coaxed satisfactory:1,satisfactory 3-D:1,animation out:1,a 4:1,4 MHz:1,MHz Z80:1,Z80 system:1,with 160x72:1,160x72 monochrome:1,monochrome graphics:1,graphics In:1,days 3-D:1,3-D was:1,much limited:1,to outrageously:1,outrageously expensive:1,expensive terminals:1,terminals attached:1,to minis:1,minis or:1,or mainframes:1,mainframes Times:1,Times change:1,change and:1,computer technology:1,technology than:1,other parts:1,universe A:1,A 486:1,of decent:1,decent 3-D:1,animation owing:1,its integrated:1,integrated math:1,coprocessor not:1,the class:1,say an:1,an i860:1,i860 but:1,good nonetheless:1,nonetheless A:1,A 386:1,less satisfactory:1,satisfactory though:1,387 is:1,486’s coprocessor:1,coprocessor and:1,systems lack:1,lack coprocessors:1,coprocessors However:1,not lost:1,lost 32-bit:1,and built-in:1,built-in integer:1,divide hardware:1,hardware make:1,interesting 3-D:1,arithmetic Actually:1,surprising amount:1,on lesser:1,lesser x86:1,article will:1,perform real-time:1,animation admittedly:1,admittedly very:1,but nonetheless:1,nonetheless real-time:1,real-time and:1,286 without:1,a 287:1,287 even:1,in real-mode:1,real-mode C:1,uses floating-point:1,is considerable:1,considerable With:1,we kick:1,off an:1,family Mind:1,drawing performed:1,performed on-the-fly:1,on-the-fly Generating:1,Generating frames:1,frames ahead:1,and playing:1,playing them:1,excellent technique:1,I’m interested:1,seeing how:1,can push:1,push purely:1,purely real-time:1,animation Granted:1,Granted we’re:1,of Terminator:1,Terminator 2:1,fun nonetheless:1,nonetheless The:1,final section:1,book may:1,seem pretty:1,pretty basic:1,basic to:1,you experienced:1,experienced with:1,time 3-D:1,3-D neophytes:1,neophytes will:1,be distressed:1,distressed at:1,of material:1,I skip:1,skip or:1,or skim:1,skim over:1,over That:1,That can’t:1,helped but:1,least there’ll:1,there’ll be:1,the references:1,references mentioned:1,mentioned later:1,some explanation:1,be enough:1,3-D Animating:1,Animating in:1,three dimensions:1,dimensions is:1,task so:1,largest single:1,single section:1,with later:1,chapters building:1,building on:1,this first:1,first 3-D:1,3-D chapter:1,will rely:1,on polygon:1,and page-flip:1,page-flip code:1,I’ve saved:1,for last:1,last because:1,because to:1,mind real-time:1,most exciting:1,exciting things:1,things of:1,any stripe:1,stripe that:1,a computer—and:1,computer—and because:1,with today’s:1,today’s hardware:1,hardware it:1,done Nay:1,Nay it:1,done amazingly:1,amazingly well:1,well References:1,References on:1,Drawing There:1,several good:1,good sources:1,for information:1,graphics Foley:1,Edition Addison-Wesley:1,1990 provides:1,lengthy discussion:1,many references:1,further study:1,study Unfortunately:1,is heavy:1,heavy going:1,going at:1,more approachable:1,approachable discussion:1,discussion is:1,provided in:1,in Principles:1,Sproull McGraw-Hill:1,McGraw-Hill 1979:1,1979 Although:1,latter book:1,book lacks:1,last decade’s:1,decade’s worth:1,graphics developments:1,developments it:1,nonetheless provides:1,good overview:1,of basic:1,3-D techniques:1,techniques including:1,including many:1,approaches likely:1,A source:1,source that:1,not find:1,useful is:1,books on:1,C graphics:1,graphics by:1,by Lee:1,Lee Adams:1,Adams as:1,by High-Performance:1,High-Performance CAD:1,CAD Graphics:1,Graphics in:1,C Windcrest/Tab:1,Windcrest/Tab 1986:1,1986 I:1,all six:1,books discuss:1,discuss 3-D:1,four I’ve:1,seen do:1,do To:1,honest this:1,book has:1,problems including:1,including Relatively:1,Relatively little:1,little theory:1,explanation incomplete:1,sometimes erroneous:1,erroneous discussions:1,hardware use:1,but global:1,with cryptic:1,cryptic names:1,names like:1,like array3:1,array3 and:1,and B21:1,B21 and—well:1,and—well you:1,idea On:1,book at:1,least touches:1,have spoken:1,spoken warmly:1,warmly to:1,of Adams:1,Adams books:1,their introduction:1,wouldn’t recommend:1,recommend these:1,as your:1,your only:1,only 3-D:1,3-D references:1,references but:1,just starting:1,starting out:1,out you:1,helps you:1,you bridge:1,bridge the:1,the gap:1,gap between:1,Drawing Pipeline:1,Pipeline Each:1,Each 3-D:1,we’ll handle:1,handle will:1,that represent:1,object Figure:1,50.1 shows:1,the stages:1,stages a:1,polygon goes:1,through enroute:1,enroute to:1,present we’ll:1,we’ll avoid:1,clipping lighting:1,shading First:1,is transformed:1,transformed from:1,3-D universe:1,universe Transformation:1,Transformation may:1,may involve:1,involve rotating:1,rotating scaling:1,polygon Fortunately:1,Fortunately applying:1,desired transformation:1,to transforming:1,transforming the:1,words transformation:1,transform every:1,every point:1,vertices Likewise:1,Likewise transformation:1,object fully:1,fully transforms:1,object Once:1,must again:1,transformed this:1,time into:1,defined such:1,at 000:1,000 looking:1,axis straight:1,axis off:1,Once in:1,be perspective-projected:1,perspective-projected to:1,vertices finally:1,finally being:1,polygon That’s:1,to basic:1,drawing transformation:1,screen Next:1,transformation One:1,One note:1,note I’ll:1,purely right-handed:1,right-handed convention:1,convention for:1,for coordinate:1,systems Right-handed:1,Right-handed means:1,you hold:1,hold your:1,right hand:1,fingers curled:1,curled and:1,thumb sticking:1,sticking out:1,thumb points:1,fingers point:1,50.2 Rotations:1,Rotations about:1,are counter-clockwise:1,counter-clockwise as:1,viewed looking:1,down an:1,axis toward:1,The handedness:1,handedness of:1,a convention:1,convention and:1,and left-handed:1,left-handed would:1,do equally:1,however right-handed:1,right-handed is:1,and world:1,space Sometimes:1,the handedness:1,handedness is:1,flipped for:1,for view:1,that increasing:1,increasing Z:1,Z equals:1,equals increasing:1,increasing distance:1,sight but:1,here to:1,avoid confusion:1,confusion Therefore:1,Therefore Z:1,Z decreases:1,decreases as:1,as distance:1,sight increases:1,increases a:1,space coordinate:1,00 1000:1,1000 is:1,directly ahead:1,ahead twice:1,away as:1,00 500:1,500 Figure:1,system Figure:1,system Projection:1,Projection Working:1,Working backward:1,image we:1,as transformed:1,project them:1,to 2-D:1,2-D coordinates:1,coordinates on:1,which for:1,projection purposes:1,purposes is:1,be centered:1,and perpendicular:1,space at:1,some distance:1,screen We’re:1,We’re after:1,after visual:1,visual realism:1,realism so:1,projection in:1,that farther:1,objects look:1,look smaller:1,than nearer:1,view will:1,will widen:1,widen with:1,with distance:1,distance This:1,by scaling:1,scaling the:1,point proportionately:1,proportionately to:1,Z distance:1,viewer a:1,50.3 It:1,really matter:1,far down:1,be what:1,what matters:1,This ratio:1,ratio defines:1,of divergence:1,divergence of:1,viewing pyramid—the:1,pyramid—the full:1,full field:1,of view—and:1,view—and is:1,performing all:1,all perspective:1,perspective projections:1,projections Once:1,Once perspective:1,performed all:1,remains before:1,filler is:1,to integers:1,integers appropriately:1,appropriately clipped:1,and adjusted:1,adjusted as:1,to center:1,center the:1,origin on:1,otherwise map:1,window if:1,desired Translation:1,Translation Translation:1,Translation means:1,adding X:1,X Y:1,and Z:1,Z offsets:1,offsets to:1,it linearly:1,linearly through:1,space Translation:1,requires nothing:1,an addition:1,example used:1,move objects:1,objects from:1,typically the:1,origin 000:1,000 into:1,space where:1,object may:1,be located:1,located anywhere:1,anywhere Figure:1,projection Rotation:1,Rotation Rotation:1,Rotation is:1,of circularly:1,circularly moving:1,moving coordinates:1,coordinates around:1,origin For:1,present purposes:1,purposes it’s:1,necessary only:1,rotate objects:1,objects about:1,about their:1,their centers:1,centers in:1,desired attitude:1,attitude before:1,before translating:1,translating them:1,space Rotation:1,Rotation of:1,by transforming:1,transforming it:1,it according:1,the formulas:1,formulas shown:1,50.4 These:1,These formulas:1,formulas map:1,useful matrix-multiplication:1,matrix-multiplication forms:1,forms also:1,also shown:1,50.4 Matrix:1,Matrix representation:1,representation is:1,concatenate multiple:1,multiple rotations:1,rotations into:1,multiplying them:1,desired order:1,matrix can:1,rotations more:1,efficiently Figure:1,formulas Figure:1,formulas Second:1,Second 3x3:1,matrices can:1,can become:1,upper-left-hand portions:1,of 4x4:1,matrices that:1,perform translation:1,scaling as:1,won’t need:1,need scaling:1,scaling in:1,future as:1,4x4 matrix:1,sort utilizes:1,utilizes homogeneous:1,coordinates that’s:1,topic way:1,way beyond:1,beyond this:1,basically homogeneous:1,coordinates allow:1,handle both:1,both rotations:1,translations with:1,with 4x4:1,matrices thereby:1,concatenate a:1,long series:1,translations into:1,matrix that:1,same transformation:1,transformation as:1,and transformations:1,transformations There’s:1,about transformations:1,the supporting:1,supporting matrix:1,math but:1,I’ll leave:1,leave that:1,be discussed:1,need arises:1,arises A:1,Simple 3-D:1,3-D Example:1,Example At:1,know enough:1,simple working:1,working 3-D:1,animation example:1,example will:1,do nothing:1,it sits:1,sits in:1,space rotating:1,rotating around:1,axis To:1,make things:1,interesting we’ll:1,user move:1,the arrow:1,A away:1,T toward:1,toward keys:1,keys The:1,program requires:1,two sorts:1,functionality The:1,space onto:1,screen 3-D:1,3-D functionality:1,projected polygon:1,with clipping:1,other details:1,animation 2-D:1,2-D functionality:1,functionality Figure:1,Matrix Figure:1,Matrix Happily:1,Happily and:1,not coincidentally:1,coincidentally we:1,we put:1,nice 2-D:1,framework back:1,49 during:1,during our:1,our exploratory:1,exploratory discussion:1,of non-3-D:1,non-3-D details:1,details Basically:1,use Mode:1,X 320x240:1,320x240 256:1,we’ll flip:1,pages drawing:1,one while:1,other is:1,displayed One:1,One new:1,new 2-D:1,element that:1,clip polygons:1,polygons while:1,while we:1,moment by:1,by restricting:1,restricting the:1,stays fully:1,fully on:1,screen certainly:1,certainly in:1,handle partially:1,or fully:1,clipped polygons:1,50.1 is:1,X polygon:1,supports clipping:1,clipping The:1,high-level polygon:1,mode independent:1,independent and:1,that presented:1,38 39:1,and 40:1,40 as:1,noted further:1,further on:1,implemented at:1,by trimming:1,trimming the:1,Y extent:1,list up:1,front then:1,turn This:1,fast approach:1,to clipping—ideally:1,clipping—ideally the:1,polygon would:1,clipped before:1,was scanned:1,scanned into:1,list avoiding:1,avoiding potentially:1,potentially wasted:1,wasted scanning:1,scanning and:1,the line-by-line:1,line-by-line X:1,X clipping—but:1,clipping—but it’s:1,see polygon:1,filling performance:1,our worries:1,worries at:1,moment The:1,other 2-D:1,element we:1,location before:1,and redrawn:1,redrawn We’ll:1,We’ll do:1,rectangle of:1,drawn then:1,then erasing:1,erasing by:1,clearing that:1,area with:1,fill With:1,2-D side:1,picture well:1,under control:1,control we’re:1,stuff Listings:1,Listings 50.2:1,50.2 through:1,through 50.5:1,50.5 are:1,Listing 50.2:1,50.2 provides:1,provides matrix:1,multiplication functions:1,fashion Listing:1,50.3 transforms:1,transforms projects:1,projects and:1,Listing 50.4:1,50.4 is:1,main animation:1,program Other:1,Other modules:1,modules required:1,required are:1,38.1 in:1,necessary code:1,code modules:1,file are:1,are present:1,disk whether:1,chapters as:1,well where:1,where listings:1,listings from:1,are referenced:1,referenced This:1,This scheme:1,scheme may:1,confusion Notes:1,Animation Example:1,Example The:1,program transforms:1,vertices from:1,earlier In:1,case world:1,are congruent—we’re:1,congruent—we’re looking:1,looking right:1,the negative:1,of world:1,world space—so:1,space—so the:1,matrix from:1,from world:1,the identity:1,identity matrix:1,matrix you:1,changing this:1,this matrix:1,matrix to:1,viewpoint The:1,uses 4x4:1,4x4 homogeneous:1,homogeneous coordinate:1,coordinate matrices:1,perform transformations:1,transformations as:1,above Floating-point:1,Floating-point arithmetic:1,all 3-D:1,3-D calculations:1,calculations Setting:1,appropriate entry:1,fourth column:1,matrix Setting:1,almost as:1,simple requiring:1,requiring only:1,four matrix:1,Y rotation:1,the sines:1,cosines of:1,desired rotation:1,rotation However:1,However rotations:1,rotations involving:1,involving more:1,axis require:1,require multiple:1,multiple rotation:1,matrices one:1,axis rotated:1,rotated around:1,around those:1,those matrices:1,then concatenated:1,concatenated together:1,transformation This:1,initially appear:1,maximum translation:1,translation along:1,40 this:1,this keeps:1,from extending:1,extending past:1,to positive:1,would wreak:1,wreak havoc:1,havoc with:1,and 2-D:1,require 3-D:1,clipping which:1,2-D We’ll:1,limit all:1,to negative:1,polygon does:1,does get:1,get mighty:1,mighty close:1,viewpoint though:1,though run:1,the T:1,T key:1,as possible—the:1,possible—the near:1,near vertex:1,vertex swinging:1,swinging past:1,past provides:1,striking sense:1,perhaps surprisingly:1,surprisingly good:1,good clocking:1,clocking in:1,at 16:1,16 frames:1,of average:1,average speed:1,no 387:1,387 although:1,course only:1,drawn rather:1,hundreds or:1,or thousands:1,thousands we’d:1,we’d ultimately:1,ultimately like:1,like What’s:1,What’s far:1,goes Even:1,polygon 73:1,73 percent:1,for transformation:1,projection An:1,An additional:1,additional 7:1,7 percent:1,screen Only:1,Only 20:1,other activity—and:1,activity—and only:1,spent actually:1,actually drawing:1,polygons Clearly:1,Clearly we’ll:1,tackle transformation:1,projection first:1,first when:1,up Note:1,coprocessor would:1,would considerably:1,considerably decrease:1,calculations In:1,50.3 when:1,later erasure:1,erasure purposes:1,purposes that:1,that extent:1,extent is:1,47.5 in:1,47 the:1,problem would:1,would more:1,more appropriately:1,appropriately be:1,putting clipping:1,clipping into:1,unfortunately I:1,here Finally:1,Finally observe:1,observe the:1,the jaggies:1,it rotates:1,rotates This:1,is temporal:1,aliasing at:1,its finest:1,finest We:1,We won’t:1,won’t address:1,address antialiasing:1,antialiasing further:1,further realtime:1,realtime antialiasing:1,antialiasing being:1,being decidedly:1,decidedly nontrivial:1,nontrivial but:1,why antialiasing:1,so desirable:1,desirable An:1,An Ongoing:1,Ongoing Journey:1,Journey In:1,we’ll assign:1,assign fronts:1,fronts and:1,and backs:1,backs to:1,viewer That:1,handle convex:1,polyhedrons such:1,as tetrahedrons:1,tetrahedrons and:1,cubes We’ll:1,also look:1,at interactively:1,interactively controllable:1,controllable rotation:1,complex rotations:1,rotations than:1,simple rotation:1,axis that:1,In time:1,time we’ll:1,some shading:1,mapping The:1,The journey:1,journey has:1,only begun:1,begun we’ll:1,more soon:1,soon Chapter:1,Chapter 51:1,51 Sneakers:1,Sneakers in:1,Space Using:1,Using Backface:1,Removal to:1,to Eliminate:1,Eliminate Hidden:1,Surfaces As:1,I’m fond:1,of pointing:1,out computer:1,of mathematically:1,mathematically exact:1,exact modeling:1,modeling or:1,or raw:1,raw technical:1,technical prowess:1,prowess but:1,rather of:1,mind That’s:1,where we’re:1,only trying:1,convince viewers:1,viewers that:1,they’re seeing:1,seeing objects:1,a screen—when:1,screen—when in:1,truth that:1,screen contains:1,no objects:1,only gaggles:1,gaggles of:1,of pixels—but:1,pixels—but we’re:1,we’re also:1,also trying:1,illusion that:1,objects exist:1,three-space possessing:1,possessing four:1,four dimensions:1,dimensions counting:1,counting movement:1,movement over:1,a fourth:1,fourth dimension:1,magic happen:1,happen we:1,provide cues:1,cues for:1,pick out:1,out boundaries:1,boundaries but:1,detect depth:1,depth orientation:1,orientation and:1,and motion:1,motion This:1,involves perspective:1,perspective shading:1,shading proper:1,and rapid:1,rapid and:1,smooth screen:1,pull off:1,off on:1,some senses:1,senses however:1,however 3-D:1,easier than:1,2-D Because:1,Because there’s:1,more going:1,brain tend:1,more assumptions:1,more apt:1,they expect:1,see rather:1,than what’s:1,actually there:1,you’re piloting:1,piloting a:1,virtual ship:1,ship through:1,of asteroids:1,asteroids at:1,speed you’re:1,you’re unlikely:1,unlikely to:1,notice if:1,distant asteroids:1,asteroids occasionally:1,occasionally seem:1,right through:1,the topographic:1,detail on:1,asteroids surfaces:1,surfaces sometimes:1,sometimes shifts:1,shifts about:1,bit You’ll:1,You’ll be:1,be busy:1,busy viewing:1,asteroids in:1,their primary:1,primary role:1,role as:1,be navigated:1,navigated around:1,the mere:1,mere presence:1,of topographic:1,detail will:1,will suffice:1,suffice without:1,being aware:1,you’ll fill:1,the blanks:1,blanks Your:1,Your mind:1,mind will:1,the topography:1,topography peripherally:1,peripherally recognize:1,the landscape:1,landscape does:1,does something:1,something really:1,really obtrusive:1,obtrusive such:1,as vanishing:1,altogether or:1,or suddenly:1,suddenly shooting:1,shooting a:1,a spike:1,spike miles:1,into space:1,space you:1,a bunch:1,bunch of:1,of nicely:1,nicely detailed:1,detailed asteroids:1,asteroids tumbling:1,tumbling around:1,around you:1,you To:1,To what:1,what extent:1,extent can:1,you rely:1,and mind:1,for imperfections:1,imperfections in:1,animation process:1,some areas:1,areas hardly:1,hardly at:1,example jaggies:1,along edges:1,edges stick:1,stick out:1,like red:1,red flags:1,for flicker:1,flicker In:1,areas though:1,human perceptual:1,perceptual system:1,more forgiving:1,forgiving than:1,of Return:1,the Jedi:1,Jedi in:1,the battle:1,battle to:1,end all:1,all battles:1,battles around:1,the Death:1,Death Star:1,Star there:1,five seconds:1,seconds in:1,which several:1,several spaceships:1,spaceships are:1,background One:1,those spaceships:1,spaceships and:1,very far:1,background either:1,either looks:1,unusual What:1,a sneaker:1,sneaker In:1,a sneaker—but:1,sneaker—but unless:1,because your:1,is busy:1,busy making:1,making simplifying:1,scene it’s:1,it’s seeing—and:1,seeing—and one:1,assumptions is:1,that medium-sized:1,medium-sized objects:1,objects floating:1,are spaceships:1,spaceships unless:1,unless proven:1,proven otherwise:1,otherwise Thanks:1,to Chris:1,pointing this:1,out I’d:1,have noticed:1,noticed the:1,the sneaker:1,sneaker myself:1,myself without:1,being tipped:1,tipped off—which:1,off—which is:1,point If:1,for George:1,George Lucas:1,Lucas it’s:1,us And:1,for realtime:1,PC One-sided:1,One-sided Polygons:1,Polygons Backface:1,Removal In:1,pipeline transforming:1,transforming a:1,polygon all:1,its basic:1,basic definition:1,shared 3-D:1,and into:1,viewpoint called:1,called view:1,space From:1,From view:1,we performed:1,then mapped:1,mapped the:1,projected vertices:1,nearest screen:1,filled the:1,polygon Armed:1,that implemented:1,this pipeline:1,pipeline we:1,watch as:1,rotated about:1,its Y:1,space freely:1,freely One:1,chapter’s approach:1,polygon had:1,two visible:1,visible sides:1,sides Why:1,drawback It:1,necessarily but:1,build solid:1,with continuous:1,continuous surfaces:1,context only:1,side always:1,always faces:1,faces the:1,seen It:1,would save:1,save time:1,removal if:1,could quickly:1,easily determine:1,was facing:1,facing us:1,us so:1,could draw:1,polygon only:1,visible that:1,is had:1,face pointing:1,viewer On:1,On average:1,object could:1,be instantly:1,instantly rejected:1,rejected by:1,sort Such:1,Such testing:1,testing of:1,polygon visibility:1,visibility goes:1,goes by:1,of names:1,names in:1,literature including:1,including backplane:1,backplane culling:1,culling backface:1,and assorted:1,assorted variations:1,variations thereon:1,thereon I’ll:1,as backface:1,polyhedron removal:1,aren’t facing:1,viewer would:1,would solve:1,solve all:1,surface problems:1,polyhedron any:1,be obscured:1,that polyhedron:1,polyhedron this:1,this falls:1,polyhedron Likewise:1,visible Therefore:1,polyhedron if:1,you draw:1,polygons facing:1,none facing:1,viewer everything:1,everything will:1,out properly:1,properly with:1,additional checking:1,overlap and:1,surfaces needed:1,needed Unfortunately:1,Unfortunately backface:1,removal completely:1,completely solves:1,the hidden:1,surface problem:1,polyhedrons only:1,polyhedron involved:1,involved when:1,when convex:1,polyhedrons overlap:1,overlap other:1,other methods:1,methods must:1,Nonetheless backface:1,removal does:1,does instantly:1,instantly halve:1,halve the:1,rendering any:1,particular scene:1,scene Backface:1,removal can:1,also speed:1,speed hidden-surface:1,hidden-surface handling:1,if objects:1,polyhedrons In:1,one convex:1,polyhedron to:1,so backface:1,removal alone:1,alone will:1,trick Given:1,I’ve convinced:1,convinced you:1,that backface:1,removal would:1,handy thing:1,have how:1,A logical:1,often implemented:1,PC literature:1,literature would:1,polygon lies:1,lies and:1,plane points:1,points That:1,That works:1,vector shown:1,51.1 One:1,interesting property:1,two original:1,vectors lie:1,lie If:1,vector points:1,points toward:1,viewer We:1,cross-product approach:1,approach work:1,cross-product can:1,actually point:1,point either:1,way depending:1,we evaluate:1,evaluate them:1,must establish:1,establish some:1,some conventions:1,conventions for:1,for defining:1,defining polygons:1,and evaluating:1,evaluating the:1,cross-product Figure:1,vectors We’ll:1,We’ll define:1,define only:1,only convex:1,vertices defined:1,vertices will:1,polygon definition:1,order With:1,assumptions the:1,cross-product becomes:1,easy indicator:1,indicator of:1,orientation with:1,we’ll calculate:1,calculate it:1,last vectors:1,51.2 and:1,it’s pointing:1,visible Actually:1,entire cross-product:1,vector because:1,component alone:1,alone suffices:1,facing positive:1,means visible:1,visible negative:1,The Z:1,component can:1,efficiently with:1,subtraction The:1,question remains:1,remains of:1,proper space:1,removal There’s:1,a temptation:1,perform it:1,space which:1,defined with:1,but view:1,choice Screen:1,Screen space—the:1,space—the space:1,which perspective:1,been performed—is:1,performed—is the:1,choice The:1,The purpose:1,and despite:1,despite its:1,name view:1,space does:1,information unlike:1,unlike screen:1,reflect perspective:1,perspective effects:1,effects Figure:1,normal Backface:1,removal may:1,are integers:1,integers This:1,space coordinates:1,are floating:1,token faster:1,51.3 which:1,shortly backface:1,speed Backface:1,removal as:1,51.3 will:1,reliably if:1,convex if:1,vertices don’t:1,don’t appear:1,order if:1,if either:1,first or:1,or last:1,last edge:1,has zero:1,zero length:1,last edges:1,are collinear:1,collinear These:1,These latter:1,than screen:1,which suffer:1,from rounding:1,rounding problems:1,problems speed:1,speed considerations:1,considerations aside:1,aside Backface:1,Removal in:1,Action Listings:1,Listings 51.1:1,51.1 through:1,through 51.5:1,51.5 together:1,that rotates:1,rotates a:1,in real-time:1,real-time under:1,under user:1,user control:1,control Listing:1,Listing 51.1:1,51.1 is:1,51.2 performs:1,performs transformation:1,projection Listing:1,51.3 performs:1,performs backface:1,draws visible:1,visible faces:1,faces Listing:1,51.4 concatenates:1,concatenates incremental:1,incremental rotations:1,rotations to:1,matrix Listing:1,Listing 51.5:1,51.5 is:1,file Also:1,Also required:1,required from:1,Listings 50.1:1,50.1 and:1,and 50.2:1,50.2 from:1,list matrix:1,math functions:1,functions Listings:1,necessary modules:1,diskette whether:1,confusion The:1,51.3 places:1,places a:1,cube floating:1,three-space under:1,user The:1,The arrow:1,cube left:1,T keys:1,cube away:1,from or:1,or toward:1,The F1:1,F1 and:1,and F2:1,F2 keys:1,axis running:1,running from:1,viewer straight:1,straight into:1,The 4:1,6 keys:1,Y vertical:1,and 8:1,8 keys:1,axis which:1,runs horizontally:1,latter four:1,four keys:1,most conveniently:1,conveniently used:1,the keypad:1,keypad to:1,the numeric:1,numeric state:1,state Figure:1,The demo:1,demo involves:1,involves six:1,six polygons:1,polygons one:1,each side:1,cube Each:1,projected so:1,that 24:1,24 vertices:1,vertices four:1,four for:1,handled but:1,some steps:1,steps have:1,been taken:1,performance All:1,All vertices:1,object have:1,face contains:1,contains not:1,face themselves:1,themselves but:1,rather indexes:1,object’s vertex:1,51.4 This:1,This reduces:1,manipulated from:1,from 24:1,24 to:1,cube with:1,three faces:1,faces sharing:1,sharing each:1,vertex In:1,transformation burden:1,burden is:1,is lightened:1,lightened by:1,by two-thirds:1,two-thirds Also:1,earlier backface:1,floating-point values:1,space Finally:1,the RecalcXForm:1,RecalcXForm flag:1,set whenever:1,user changes:1,transformation Only:1,this flag:1,full object-to-view:1,object-to-view transformation:1,transformation recalculated:1,recalculated and:1,object’s vertices:1,vertices transformed:1,projected again:1,again otherwise:1,values already:1,object are:1,are reused:1,reused In:1,application this:1,this brings:1,brings no:1,no visual:1,visual improvement:1,improvement because:1,one object:1,object but:1,underlying mechanism:1,is sound:1,sound In:1,full-blown 3-D:1,application with:1,with multiple:1,multiple objects:1,objects moving:1,moving about:1,deal to:1,objects had:1,had moved:1,viewer performing:1,new transformation:1,projection only:1,had Figure:1,structure With:1,certainly adequately:1,adequately responsive:1,responsive on:1,386 sans:1,sans 387:1,387 I’m:1,it’s wonderfully:1,wonderfully responsive:1,responsive with:1,coprocessor Still:1,it couldn’t:1,couldn’t quite:1,quite keep:1,the keyboard:1,keyboard when:1,modified it:1,read only:1,key each:1,the loop—and:1,loop—and we’re:1,about only:1,vertices here:1,here This:1,This indicates:1,already near:1,limit of:1,animation complexity:1,our current:1,current approach:1,start rethinking:1,rethinking that:1,approach over:1,over two-thirds:1,in floating-point:1,to attack:1,attack the:1,performance bottleneck:1,bottleneck we:1,find ourselves:1,ourselves up:1,against Incremental:1,Incremental Transformation:1,Transformation Listing:1,51.4 contains:1,functions each:1,each concatenates:1,concatenates an:1,additional rotation:1,around one:1,existing rotation:1,rotation To:1,To improve:1,affected in:1,each particular:1,particular axis:1,are recalculated:1,recalculated all:1,entries in:1,a single-axis:1,single-axis rotation:1,are either:1,50 This:1,This cuts:1,floating-point multiplies:1,multiplies from:1,64 required:1,two 4x4:1,just 12:1,and floating:1,point adds:1,adds from:1,from 48:1,48 to:1,to 6:1,6 Be:1,51.4 performs:1,an incremental:1,incremental rotation:1,rotation on:1,whatever rotation:1,matrix The:1,cube may:1,may already:1,been turned:1,turned left:1,up down:1,and sideways:1,sideways regardless:1,regardless Listing:1,51.4 just:1,just tacks:1,tacks the:1,specified rotation:1,rotation onto:1,onto whatever:1,whatever already:1,already exists:1,exists In:1,matrix contains:1,a history:1,ever specified:1,user concatenated:1,concatenated one:1,another onto:1,original matrix:1,matrix Potential:1,Potential loss:1,precision is:1,problem associated:1,using such:1,long concatenation:1,concatenation of:1,of transformations:1,transformations especially:1,us yet:1,we’ll run:1,it eventually:1,eventually A:1,on Rounding:1,Rounding Negative:1,Negative Numbers:1,Numbers In:1,added 0.5:1,and truncated:1,truncated in:1,round values:1,from floating-point:1,integer format:1,format Here:1,Here in:1,51.2 I’ve:1,I’ve switched:1,adding 0.5:1,floor function:1,function For:1,For positive:1,positive values:1,equivalent for:1,for negative:1,negative values:1,values only:1,floor approach:1,properly Object:1,Object Representation:1,Representation Each:1,object consists:1,faces with:1,face defined:1,by pointers:1,list this:1,transformed exactly:1,once even:1,though several:1,several faces:1,faces may:1,may share:1,share a:1,vertex Each:1,object contains:1,vertices not:1,their original:1,original untransformed:1,untransformed state:1,other forms:1,forms as:1,well transformed:1,transformed to:1,space transformed:1,and converted:1,coordinates Earlier:1,Earlier we:1,coordinates within:1,object so:1,object hasn’t:1,hasn’t moved:1,redrawn without:1,for recalculation:1,recalculation but:1,bother storing:1,view and:1,space forms:1,The screen:1,whether two:1,polygons overlap:1,seen by:1,viewer you:1,viewer accounting:1,perspective screen:1,space provides:1,provides that:1,information So:1,So do:1,final screen:1,coordinates but:1,less accuracy:1,accuracy and:1,any Z:1,Z information:1,The view:1,collision and:1,and proximity:1,proximity detection:1,detection screen:1,used here:1,because objects:1,are distorted:1,distorted by:1,projection into:1,space World:1,World space:1,space would:1,detection but:1,transform directly:1,matrix it’s:1,often preferable:1,over world:1,space It’s:1,not mandatory:1,that vertices:1,vertices be:1,stored for:1,these different:1,different spaces:1,spaces but:1,those spaces:1,spaces have:1,as intermediate:1,intermediate steps:1,steps anyway:1,well keep:1,them around:1,those occasions:1,occasions when:1,needed Chapter:1,Chapter 52:1,52 Fast:1,Fast 3-D:1,Animation Meet:1,Meet X-Sharp:1,The First:1,First Iteration:1,Iteration of:1,a Generalized:1,Generalized 3-D:1,Animation Package:1,Package Across:1,Across the:1,the lake:1,lake from:1,from Vermont:1,Vermont a:1,few miles:1,into upstate:1,upstate New:1,York the:1,the Ausable:1,Ausable River:1,River has:1,has carved:1,fairly impressive:1,impressive gorge:1,gorge known:1,as Ausable:1,Chasm Impressive:1,Impressive for:1,the East:1,East anyway:1,anyway you:1,man’s Grand:1,Grand Canyon:1,Canyon Some:1,the tour:1,tour with:1,and five-year-old:1,five-year-old and:1,was fun:1,fun although:1,I confess:1,confess that:1,didn’t loosen:1,loosen my:1,my grip:1,grip on:1,daughter’s hand:1,hand until:1,for home:1,home that:1,that gorge:1,gorge is:1,is deep:1,deep and:1,the railings:1,railings tend:1,the single-bar:1,single-bar rusted-out:1,rusted-out variety:1,variety New:1,New Yorkers:1,Yorkers can:1,drive straight:1,this wonder:1,of nature:1,nature but:1,but Vermonters:1,Vermonters must:1,must take:1,take their:1,their cars:1,cars across:1,across on:1,ferry the:1,is driving:1,driving three:1,three hours:1,hours around:1,the south:1,south end:1,of Lake:1,Lake Champlain:1,Champlain No:1,ferry ride:1,ride is:1,hour well:1,well spent:1,a beautiful:1,beautiful lake:1,lake Or:1,rather no:1,no problem—once:1,problem—once you’re:1,you’re on:1,ferry Getting:1,Getting to:1,York is:1,found out:1,of cars:1,cars waiting:1,from Ausable:1,Chasm gets:1,gets lengthy:1,lengthy about:1,about mid-afternoon:1,mid-afternoon The:1,The ferry:1,ferry can:1,can hold:1,hold only:1,many cars:1,we wound:1,up spending:1,spending an:1,unexpected hour:1,hour exploring:1,ferry docks:1,docks Not:1,a good-natured:1,good-natured kid:1,an entertaining:1,entertaining mom:1,mom we:1,got ice:1,cream explored:1,the beach:1,beach looked:1,looked through:1,through binoculars:1,binoculars and:1,told stories:1,stories It:1,a fun:1,fun break:1,break actually:1,actually and:1,ferry was:1,was steaming:1,steaming back:1,pick us:1,us up:1,mine an:1,an elementary-school:1,elementary-school teacher:1,teacher helped:1,helped take:1,take 65:1,graders to:1,to Ausable:1,Chasm Never:1,for trouble:1,65 kids:1,kids loose:1,loose on:1,a ferry:1,ferry Never:1,was like:1,like trying:1,to herd:1,herd that:1,that group:1,group around:1,a gorge:1,gorge that:1,to swallow:1,swallow children:1,and small:1,small animals:1,animals without:1,a trace:1,trace The:1,getting back:1,the docks:1,docks and:1,finding they’d:1,they’d have:1,wait an:1,hour for:1,next ferry:1,ferry As:1,friend put:1,it Let:1,me tell:1,eternity with:1,graders screaming:1,screaming the:1,song You:1,You Are:1,Are My:1,My Sunshine:1,Sunshine Apart:1,from reminding:1,reminding you:1,how lucky:1,lucky you:1,a quiet:1,quiet air-conditioned:1,air-conditioned room:1,a gently:1,gently humming:1,humming computer:1,computer free:1,think deep:1,deep thoughts:1,thoughts and:1,and eat:1,eat Cheetos:1,Cheetos to:1,content this:1,story provides:1,the malleable:1,malleable nature:1,time An:1,An hour:1,hour isn’t:1,isn’t just:1,an hour—it:1,hour—it can:1,be forever:1,forever or:1,or it:1,the wink:1,wink of:1,eye Just:1,last hour:1,hour you:1,you spent:1,spent working:1,working under:1,a deadline:1,deadline I:1,bet it:1,it went:1,went past:1,past in:1,flash Which:1,say mind:1,recommend working:1,bus full:1,screaming kids:1,kids in:1,make time:1,time pass:1,pass more:1,slowly there:1,are quality:1,issues here:1,animation work:1,used floating-point:1,arithmetic Floating-point:1,Floating-point arithmetic—even:1,arithmetic—even with:1,a floating-point:1,but especially:1,especially without:1,without one—is:1,one—is the:1,microcomputer animation:1,animation equivalent:1,of working:1,a school:1,school bus:1,bus It:1,takes forever:1,forever to:1,anything and:1,just know:1,know you’re:1,you’re never:1,never going:1,accomplish as:1,to In:1,we’ll address:1,address fixed-point:1,arithmetic which:1,an instant:1,instant order-of-magnitude:1,order-of-magnitude performance:1,boost We’ll:1,give our:1,and extensible:1,extensible framework:1,framework making:1,add new:1,and different:1,objects Taken:1,these alterations:1,alterations will:1,us start:1,some really:1,really interesting:1,interesting real-time:1,This Chapter’s:1,Chapter’s Demo:1,Program Three-dimensional:1,complicated business:1,astonishing amount:1,functionality just:1,the launching:1,launching pad:1,pad page:1,flipping polygon:1,filling clipping:1,clipping transformations:1,transformations list:1,list management:1,forth I’ve:1,been building:1,building toward:1,critical mass:1,animation functionality:1,functionality over:1,code builds:1,builds on:1,no fewer:1,five previous:1,link this:1,chapter’s animation:1,animation demo:1,following Listing:1,50.1 from:1,list Listings:1,The FillConvexPolygon:1,38 Note:1,the struct:1,struct keywords:1,keywords in:1,FillConvexPolygon must:1,removed to:1,to typedefs:1,typedefs in:1,animation header:1,file As:1,always all:1,required files:1,CD-ROM A:1,New Animation:1,Animation Framework:1,Framework X-Sharp:1,52.10 shown:1,earlier represent:1,represent not:1,not merely:1,merely faster:1,faster animation:1,in library:1,library form:1,form but:1,a nearly:1,complete extensible:1,extensible data-driven:1,data-driven animation:1,framework Whereas:1,Whereas much:1,earlier animation:1,was hardwired:1,demonstrate certain:1,certain concepts:1,concepts this:1,solid animation:1,package Objects:1,in customizable:1,customizable structures:1,structures new:1,new structures:1,structures can:1,be devised:1,new sorts:1,objects Drawing:1,Drawing preparing:1,preparing for:1,moving are:1,all vectored:1,vectored functions:1,functions so:1,that variations:1,variations such:1,as shading:1,or texturing:1,texturing or:1,even radically:1,graphics objects:1,as scaled:1,scaled bitmaps:1,bitmaps could:1,supported The:1,cube initialization:1,initialization is:1,entirely data:1,data driven:1,driven more:1,or different:1,cubes or:1,polyhedrons could:1,added by:1,simply changing:1,the initialization:1,initialization data:1,Listing 52.8:1,52.8 Somewhere:1,Somewhere along:1,material that:1,became this:1,useful animation:1,package by:1,tail and:1,and gave:1,name X-Sharp:1,X-Sharp X:1,X sharp:1,sharp because:1,because good:1,looks sharp:1,sharp and:1,well who:1,would want:1,flat animation:1,package Note:1,library as:1,as presented:1,indeed in:1,fully complete:1,complete 3-D:1,library Movement:1,Movement is:1,is supported:1,supported only:1,only along:1,chapter’s version:1,a non-general:1,non-general fashion:1,fashion More:1,interesting movement:1,movement isn’t:1,supported at:1,missing features:1,X-Sharp hidden-surface:1,removal The:1,other missing:1,missing feature:1,is general:1,clipping Without:1,Without hidden:1,removal nothing:1,nothing can:1,safely overlap:1,overlap It:1,perform hidden-surface:1,cubes in:1,different Z:1,Z bands:1,bands and:1,front but:1,this gets:1,gets into:1,into sorting:1,and list:1,list issues:1,issues and:1,complete solution—and:1,solution—and I’ve:1,I’ve crammed:1,crammed as:1,one chapter’s:1,code anyway:1,anyway I’m:1,working toward:1,a goal:1,goal in:1,many lessons:1,lessons to:1,and stories:1,stories to:1,be told:1,told along:1,as X-Sharp:1,X-Sharp grows:1,grows you’ll:1,find its:1,its evolving:1,evolving implementations:1,the chapter:1,subdirectories on:1,diskette This:1,example contains:1,the self-extracting:1,self-extracting archive:1,archive file:1,file XSHARP14.EXE:1,XSHARP14.EXE to:1,extract its:1,contents you:1,simply run:1,that archive:1,archive is:1,of specifically:1,specifically in:1,limitations mentioned:1,above Chapter:1,Chapter 53’s:1,53’s subdirectory:1,subdirectory however:1,however contains:1,file XSHARP15.EXE:1,XSHARP15.EXE which:1,be specifically:1,specifically talking:1,chapter Later:1,Later chapters:1,chapters will:1,own implementations:1,respective chapter:1,subdirectories in:1,in files:1,files of:1,form XSHARPxx.EXE:1,XSHARPxx.EXE where:1,where xx:1,xx is:1,an ascending:1,ascending number:1,number indicating:1,recent X-Sharp:1,version will:1,own subdirectory:1,subdirectory called:1,called XSHARP22:1,XSHARP22 If:1,you’re intending:1,intending to:1,use X-Sharp:1,real project:1,project use:1,you avail:1,avail yourself:1,yourself of:1,all new:1,and bug:1,bug fixes:1,fixes Three:1,Three Keys:1,Keys to:1,to Realtime:1,Realtime Animation:1,Animation Performance:1,rotate move:1,time Not:1,Not too:1,too shabby…but:1,shabby…but the:1,bit further:1,further rotating:1,rotating 12:1,12 solid:1,solid cubes:1,cubes at:1,an update:1,update rate:1,15 frames:1,fps on:1,VGA That’s:1,That’s 12:1,12 transformation:1,matrices 72:1,72 polygons:1,and 96:1,96 vertices:1,vertices being:1,not Star:1,Star Wars:1,Wars granted:1,granted but:1,step beyond:1,beyond a:1,single cube:1,cube Run:1,chance you:1,how effective:1,effective this:1,is I’d:1,case anyone:1,anyone missed:1,fully general:1,3-D I’m:1,any shortcuts:1,shortcuts or:1,or tricks:1,like prestoring:1,prestoring coordinates:1,coordinates or:1,or pregenerating:1,pregenerating bitmaps:1,bitmaps if:1,feed in:1,different rotations:1,rotations or:1,or vertices:1,vertices the:1,change accordingly:1,increase manifested:1,manifested in:1,three The:1,first key:1,is fixed-point:1,we worked:1,floating-point coordinates:1,and transformation:1,matrices Those:1,Those values:1,as 32-bit:1,numbers in:1,form 16.16:1,of whole:1,whole number:1,number 16:1,fraction 32-bit:1,numbers allow:1,allow sufficient:1,sufficient precision:1,manipulated with:1,fast integer:1,operations rather:1,by slow:1,processor operations:1,or excruciatingly:1,excruciatingly slow:1,emulator operations:1,operations Although:1,fixed-point varies:1,a coprocessor:1,coprocessor is:1,present fixed-point:1,multiplication can:1,the emulated:1,emulated floating-point:1,floating-point equivalent:1,equivalent I’d:1,his invaluable:1,invaluable input:1,this area:1,second performance:1,386’s native:1,native 32-bit:1,instructions C:1,compilers operating:1,operating in:1,mode call:1,call library:1,library routines:1,divisions involving:1,involving 32-bit:1,32-bit values:1,those library:1,fairly slow:1,division On:1,386 32-bit:1,32-bit multiplication:1,division can:1,Listing 52.9—and:1,52.9—and most:1,for rounding:1,rounding The:1,third performance:1,is maintaining:1,maintaining and:1,relevant portions:1,matrices and:1,The bottom:1,bottom row:1,every transformation:1,matrix we’ll:1,bother using:1,using or:1,or recalculating:1,recalculating it:1,when concatenating:1,concatenating transforms:1,transforms and:1,and transforming:1,transforming points:1,points Likewise:1,Likewise for:1,fourth element:1,3-D vector:1,in homogeneous:1,always 1:1,1 Basically:1,Basically transformation:1,a 3x3:1,a 3x1:1,3x1 translation:1,translation vector:1,as 3x1:1,3x1 vectors:1,vectors This:1,many multiplications:1,multiplications in:1,of transforming:1,transforming each:1,point Just:1,Just for:1,fun I:1,I reimplemented:1,reimplemented the:1,52.10 with:1,floating-point instructions:1,instructions Together:1,Together the:1,the preceeding:1,preceeding optimizations:1,optimizations improve:1,entire animation—including:1,animation—including drawing:1,and overhead:1,just math—by:1,math—by more:1,emulator Amazing:1,Amazing what:1,what one:1,can accomplish:1,accomplish with:1,a switch:1,switch in:1,in number:1,number format:1,format isn’t:1,it Note:1,the native:1,386 multiply:1,52.10 although:1,course mostly:1,assembly we’ve:1,achieved 12:1,12 cubes:1,cubes animated:1,animated at:1,fps while:1,while doing:1,3-D work:1,work almost:1,still doing:1,doing sine:1,cosine via:1,emulator Happily:1,Happily we’re:1,still nowhere:1,upper limit:1,animation potential:1,PC Drawbacks:1,Drawbacks The:1,The techniques:1,to turbocharge:1,turbocharge 3-D:1,animation are:1,a dark:1,dark side:1,well Obviously:1,Obviously native:1,386 instructions:1,instructions won’t:1,on 8088:1,286 machines:1,machines That’s:1,That’s rectifiable:1,rectifiable equivalent:1,equivalent multiplication:1,division routines:1,routines could:1,reasonable It:1,plug in:1,32-bit IMUL:1,IMUL or:1,or DIV:1,DIV and:1,though More:1,More importantly:1,importantly 32-bit:1,arithmetic has:1,has limitations:1,limitations in:1,in range:1,and accuracy:1,accuracy Points:1,Points outside:1,a 64Kx64Kx64K:1,64Kx64Kx64K space:1,handled imprecision:1,imprecision tends:1,in over:1,multiple matrix:1,matrix concatenations:1,concatenations and:1,the dreaded:1,dreaded divide:1,divide by:1,0 interrupt:1,interrupt if:1,if Z:1,with absolute:1,absolute values:1,values less:1,one are:1,have space:1,discuss these:1,these issues:1,detail but:1,but here:1,some brief:1,brief thoughts:1,thoughts The:1,The working:1,working 64Kx64Kx64K:1,64Kx64Kx64K fixed-point:1,fixed-point space:1,space can:1,be paged:1,paged into:1,virtual space:1,space Imprecision:1,Imprecision of:1,two rarely:1,rarely matters:1,and deterioration:1,of concatenated:1,concatenated rotations:1,rotations can:1,be corrected:1,corrected by:1,by restoring:1,restoring orthogonality:1,orthogonality for:1,by periodically:1,periodically calculating:1,calculating one:1,matrix as:1,two forcing:1,be perpendicular:1,both Alternatively:1,Alternatively transformations:1,transformations can:1,scratch each:1,object or:1,for cumulative:1,error 3-D:1,clipping with:1,less can:1,prevent divide:1,divide overflow:1,overflow Where:1,Time Goes:1,Goes The:1,The distribution:1,longer wildly:1,wildly biased:1,biased toward:1,toward transformation:1,transformation but:1,but sine:1,cosine are:1,still sucking:1,sucking up:1,cycles Likewise:1,is costly:1,costly Much:1,is correctable:1,little carefully:1,crafted assembly:1,table I’ll:1,shortly Regardless:1,Regardless with:1,critical jump:1,a usable:1,usable level:1,serviceable general-purpose:1,general-purpose framework:1,framework From:1,From here:1,stuff Chapter:1,Chapter 53:1,53 Raw:1,Speed and:1,More The:1,The Naked:1,Naked Truth:1,Truth About:1,About Speed:1,Speed in:1,Animation Years:1,ago this:1,this friend:1,of mine—let’s:1,mine—let’s call:1,call him:1,him Bert—went:1,Bert—went to:1,to Hawaii:1,Hawaii with:1,other fellows:1,fellows to:1,to celebrate:1,celebrate their:1,their graduation:1,graduation from:1,school This:1,an unchaperoned:1,unchaperoned trip:1,trip and:1,they behaved:1,behaved pretty:1,as responsibly:1,responsibly as:1,expect four:1,four teenagers:1,teenagers to:1,to behave:1,behave which:1,say not:1,not there’s:1,a rental:1,rental car:1,car that:1,day Bert:1,Bert can’t:1,can’t bring:1,bring himself:1,himself to:1,tell They:1,They had:1,time though:1,though save:1,thing no:1,no girls:1,girls By:1,by they:1,they met:1,met a:1,of girls:1,girls by:1,the pool:1,pool but:1,boys couldn’t:1,get past:1,the hi-howya-doin:1,hi-howya-doin stage:1,stage so:1,they retired:1,retired to:1,their hotel:1,hotel room:1,plot a:1,approach This:1,This being:1,early 70s:1,70s and:1,and them:1,them being:1,being slightly:1,slightly tipsy:1,tipsy teenagers:1,teenagers with:1,with raging:1,raging hormones:1,hormones and:1,effective combined:1,combined IQ:1,IQ of:1,four eggplants:1,eggplants it:1,took them:1,brilliant plan:1,plan streaking:1,streaking The:1,The girls:1,girls had:1,had mentioned:1,mentioned their:1,their room:1,room number:1,number so:1,boys piled:1,elevator pushed:1,the button:1,button for:1,girls floor:1,floor shucked:1,shucked their:1,clothes as:1,and sprinted:1,sprinted to:1,girls door:1,door They:1,They knocked:1,knocked on:1,and ran:1,ran on:1,on down:1,hall As:1,girls opened:1,opened their:1,their door:1,door Bert:1,Bert and:1,his crew:1,crew raced:1,raced past:1,past toward:1,elevator laughing:1,laughing hysterically:1,hysterically Bert:1,Bert was:1,was by:1,all He:1,He whisked:1,whisked between:1,doors just:1,they started:1,to close:1,close by:1,time his:1,friends got:1,got there:1,too late:1,the doors:1,doors slid:1,slid shut:1,shut in:1,their faces:1,faces As:1,elevator began:1,move Bert:1,Bert could:1,the frantic:1,frantic pounding:1,pounding of:1,six fists:1,fists thudding:1,thudding on:1,the closed:1,doors As:1,As Bert:1,Bert stood:1,stood among:1,the clothes:1,clothes littering:1,littering the:1,elevator floor:1,floor the:1,friends stuck:1,hall naked:1,naked as:1,as jaybirds:1,jaybirds was:1,he doubled:1,with helpless:1,helpless laughter:1,laughter tears:1,tears streaming:1,streaming down:1,down his:1,his face:1,face The:1,universe had:1,had blessed:1,blessed him:1,those exceedingly:1,exceedingly rare:1,rare moments:1,moments of:1,of perfect:1,perfect timing:1,universe wasn’t:1,wasn’t done:1,with Bert:1,Bert quite:1,yet though:1,though He:1,still contorted:1,contorted with:1,with laughter—and:1,laughter—and still:1,still quite:1,thoroughly undressed—when:1,undressed—when the:1,doors opened:1,opened again:1,again On:1,the lobby:1,lobby And:1,chapter’s topics:1,topics raw:1,surfaces Raw:1,Part 1:1,1 Assembly:1,to state:1,state here:1,the record:1,record that:1,language fanatic:1,fanatic Frankly:1,Frankly I:1,prefer programming:1,C assembly:1,more done:1,fewer hassles:1,hassles in:1,am a:1,performance fanatic:1,fanatic performance:1,performance being:1,being defined:1,having programs:1,programs be:1,as nimble:1,nimble as:1,user wants:1,wants fast:1,fast response:1,response And:1,of pursuing:1,pursuing performance:1,performance there:1,language goes:1,way We’re:1,We’re now:1,now four:1,four chapters:1,chapters into:1,into development:1,package In:1,In realtime:1,realtime animation:1,animation performance:1,is sine:1,non Latin:1,Latin for:1,for Make:1,it fast:1,or find:1,find another:1,another line:1,some judiciously:1,judiciously applied:1,applied assembly:1,got up:1,serviceable performance:1,performance level:1,by switching:1,switching to:1,to fixed-point:1,math then:1,then implementing:1,division functions:1,386’s 32-bit:1,32-bit capabilities:1,capabilities There’s:1,another area:1,that fairly:1,language matrix:1,math The:1,vector XformVec:1,concatenate matrices:1,matrices ConcatXforms:1,ConcatXforms both:1,both loop:1,loop heavily:1,heavily around:1,around calls:1,FixedMul a:1,looping can:1,converting these:1,these functions:1,to pure:1,53.1 is:1,the module:1,module FIXED.ASM:1,FIXED.ASM from:1,chapter’s iteration:1,X-Sharp with:1,with XformVec:1,ConcatXforms implemented:1,of completely:1,completely unrolling:1,loops via:1,via macros:1,macros so:1,that looping:1,eliminated altogether:1,altogether FIXED.ASM:1,FIXED.ASM is:1,effective the:1,for matrix:1,math is:1,now down:1,fairly minor:1,minor component:1,time representing:1,representing less:1,total It’s:1,turn our:1,optimization sights:1,sights elsewhere:1,elsewhere Raw:1,II Look:1,it Up:1,Up It’s:1,funny thing:1,Profiler Time:1,Time spent:1,C 80x87:1,80x87 emulator:1,emulator doesn’t:1,up directly:1,directly anywhere:1,anywhere that:1,detect it:1,that reports:1,reports what:1,what percent:1,were profiled:1,profiled if:1,you’re profiling:1,profiling all:1,all areas:1,areas whatever’s:1,whatever’s not:1,explicitly accounted:1,for seems:1,emulator time:1,This quirk:1,quirk fooled:1,fooled me:1,while leading:1,think sine:1,cosine weren’t:1,weren’t major:1,drags on:1,the sin:1,cos functions:1,functions spend:1,spend most:1,their time:1,the emulator:1,emulator and:1,time doesn’t:1,Turbo Profiler’s:1,Profiler’s statistics:1,statistics on:1,functions Once:1,Once I:1,only were:1,were sin:1,cos major:1,drags they:1,were taking:1,over half:1,by themselves:1,themselves The:1,53.1 contains:1,called CosSin:1,CosSin that:1,calculates both:1,angle via:1,function accepts:1,accepts angles:1,angles in:1,in tenths:1,degrees I:1,use tenths:1,degrees rather:1,than radians:1,radians because:1,exact angle:1,angle requested:1,requested rather:1,than approximating:1,approximating as:1,required with:1,with radians:1,radians Tenths:1,Tenths of:1,degrees should:1,fine enough:1,control for:1,alter CosSin:1,CosSin for:1,for finer:1,finer gradations:1,gradations yet:1,yet GENCOS.C:1,GENCOS.C the:1,table COSTABLE.INC:1,COSTABLE.INC included:1,53.1 can:1,the XSHARP22:1,XSHARP22 subdirectory:1,diskette GENCOS.C:1,GENCOS.C can:1,a cosine:1,cosine table:1,table with:1,any integral:1,integral number:1,of steps:1,steps per:1,per degree:1,degree FIXED.ASM:1,FIXED.ASM Listing:1,53.1 speeds:1,speeds X-Sharp:1,X-Sharp up:1,performance balance:1,balance a:1,deal When:1,we started:1,animation calculation:1,dragon we:1,we faced:1,faced more:1,spent doing:1,doing matrix:1,projection math:1,math Additional:1,Additional optimizations:1,of math:1,math could:1,made using:1,32-bit multiplies:1,multiplies in:1,the backface-removal:1,backface-removal code:1,but fixed-point:1,math the:1,cosine lookup:1,lookup and:1,and selective:1,selective assembly:1,assembly optimizations:1,optimizations have:1,job already:1,already The:1,by X-Sharp:1,now spent:1,polygons drawing:1,drawing rectangles:1,erase objects:1,flip In:1,we’ve slain:1,slain the:1,math or:1,least wounded:1,wounded it:1,it grievously:1,grievously now:1,we’re back:1,filling We’ll:1,We’ll address:1,address faster:1,faster polygon:1,filling soon:1,soon but:1,moment we:1,than enough:1,enough horsepower:1,horsepower to:1,fun with:1,with First:1,feature hidden:1,surfaces Hidden:1,Surfaces So:1,we’ve made:1,of simplifying:1,assumptions in:1,objects must:1,must currently:1,currently be:1,polyhedrons What’s:1,more right:1,now objects:1,never pass:1,pass behind:1,behind or:1,other What:1,at hidden:1,surfaces There:1,a passel:1,passel of:1,surfaces Way:1,Way off:1,slow end:1,spectrum is:1,is Z-buffering:1,Z-buffering whereby:1,whereby each:1,the frontmost:1,frontmost version:1,at those:1,those coordinates:1,coordinates At:1,other end:1,of farther:1,approach depth:1,one we’ll:1,take today:1,today Actually:1,Actually true:1,true depth:1,sorting involves:1,involves detecting:1,detecting and:1,and resolving:1,resolving possible:1,possible ambiguities:1,ambiguities when:1,objects overlap:1,in Z:1,simply sort:1,on Z:1,Z and:1,that This:1,limited version:1,of depth:1,than perfect:1,nonconvex objects:1,objects so:1,with convex:1,polyhedrons For:1,another there’s:1,what part:1,object to:1,key the:1,center and:1,farthest point:1,point are:1,all possibilities—and:1,possibilities—and whichever:1,whichever point:1,used depth:1,handle some:1,some overlap:1,overlap cases:1,cases properly:1,53.1 illustrates:1,which back-to-front:1,work regardless:1,what point:1,key For:1,For photo-realistic:1,photo-realistic rendering:1,rendering these:1,serious problems:1,problems For:1,For fast:1,fast PC-based:1,PC-based animation:1,animation however:1,however they’re:1,they’re manageable:1,manageable Choose:1,Choose objects:1,aren’t too:1,too elongated:1,elongated arrange:1,arrange their:1,their paths:1,paths of:1,of travel:1,travel so:1,intersect in:1,in problematic:1,problematic ways:1,do overlap:1,overlap incorrectly:1,incorrectly trust:1,the glitch:1,glitch will:1,Listing 53.2:1,53.2 shows:1,shows X-Sharp:1,X-Sharp file:1,file OLIST.C:1,OLIST.C which:1,key routines:1,for depth:1,sorting Objects:1,initial empty:1,list created:1,by InitializeObjectList:1,InitializeObjectList consists:1,sentinel entry:1,entry at:1,either end:1,end one:1,farthest possible:1,possible z:1,nearest New:1,New entries:1,entries are:1,by AddObject:1,AddObject in:1,in z-sorted:1,z-sorted order:1,order Each:1,moved before:1,before they’re:1,locations SortObjects:1,SortObjects is:1,to Z-sort:1,Z-sort the:1,will proceed:1,from back:1,front The:1,The Z-sorting:1,Z-sorting is:1,objects center:1,center points:1,points a:1,a center-point:1,center-point field:1,field has:1,object structure:1,structure to:1,now transformed:1,vertices That’s:1,to depth:1,depth sorting—and:1,sorting—and now:1,have objects:1,properly Rounding:1,Rounding FIXED.ASM:1,FIXED.ASM contains:1,the equate:1,equate ROUNDING-ON:1,ROUNDING-ON When:1,this equate:1,of multiplications:1,divisions are:1,nearest fixed-point:1,fixed-point values:1,values when:1,it’s 0:1,are truncated:1,truncated The:1,results produced:1,most 2:1,2 16:1,16 you:1,wouldn’t think:1,difference now:1,now would:1,you But:1,But it:1,rounding disabled:1,cubes start:1,to distort:1,distort visibly:1,minutes and:1,minutes more:1,run over:1,over In:1,contrast I’ve:1,any significant:1,significant distortion:1,distortion with:1,rounding on:1,a half-hour:1,half-hour or:1,difference with:1,accurate but:1,with truncation:1,truncation the:1,are biased:1,biased and:1,and biased:1,biased errors:1,visible when:1,they’re applied:1,to right-angle:1,right-angle objects:1,objects Even:1,rounding though:1,errors will:1,eventually creep:1,and reorthogonalization:1,reorthogonalization will:1,become necessary:1,necessary at:1,of rounding:1,highly visible:1,visible Still:1,Still truncation:1,truncation errors:1,become significant:1,significant only:1,they accumulate:1,when rotation:1,are repeatedly:1,repeatedly concatenated:1,concatenated over:1,many transformations:1,transformations Some:1,by rounding:1,rounding only:1,cases For:1,example division:1,performed only:1,results do:1,not accumulate:1,disable rounding:1,rounding for:1,division Having:1,Having a:1,a Ball:1,Ball So:1,animation we’ve:1,we’ve had:1,at but:1,but triangles:1,cubes It’s:1,something a:1,more visually:1,visually appealing:1,appealing so:1,now features:1,features a:1,ball What’s:1,What’s particularly:1,interesting about:1,this ball:1,it’s created:1,the GENBALL.C:1,GENBALL.C program:1,the BALL:1,BALL subdirectory:1,faces are:1,are programmable:1,programmable GENBALL.C:1,GENBALL.C spits:1,spits out:1,file all:1,the arrays:1,arrays of:1,and faces:1,faces needed:1,ball ready:1,for inclusion:1,inclusion in:1,INITBALL.C True:1,True if:1,bands you:1,INITBALL.C to:1,tiny detail:1,detail by:1,large the:1,a ball-shaped:1,ball-shaped object:1,now automated:1,automated In:1,fact we’re:1,to ball-shaped:1,ball-shaped objects:1,objects substitute:1,substitute a:1,different vertex:1,face generation:1,generation program:1,for GENBALL.C:1,GENBALL.C and:1,make whatever:1,whatever convex:1,polyhedron you:1,want again:1,again all:1,array correspondingly:1,correspondingly You:1,easily create:1,create multiple:1,multiple versions:1,base object:1,object too:1,too INITCUBE.C:1,INITCUBE.C is:1,this creating:1,creating 11:1,11 different:1,cubes What:1,first glimmer:1,glimmer of:1,an object-editing:1,object-editing system:1,system GENBALL.C:1,GENBALL.C is:1,object definition:1,definition and:1,and INITBALL.C:1,INITBALL.C is:1,for general-purpose:1,general-purpose object:1,object instantiation:1,instantiation Certainly:1,to someday:1,someday have:1,an interactive:1,interactive 3-D:1,object editing:1,and resource:1,resource management:1,management setup:1,setup We:1,our hands:1,hands full:1,full with:1,drawing end:1,things at:1,moment though:1,it’s enough:1,create objects:1,a semiautomated:1,semiautomated way:1,way Chapter:1,Chapter 54:1,54 3-D:1,3-D Shading:1,Shading Putting:1,Putting Realistic:1,Realistic Surfaces:1,Surfaces on:1,on Animated:1,Animated 3-D:1,3-D Objects:1,Objects At:1,chapter X-Sharp:1,X-Sharp had:1,just acquired:1,acquired basic:1,basic hidden-surface:1,hidden-surface capability:1,capability and:1,performance had:1,been vastly:1,improved through:1,add quite:1,more support:1,for 8088:1,80286 PCs:1,PCs a:1,shading That’s:1,chapter actually:1,actually it’ll:1,it’ll spill:1,spill over:1,over into:1,it Support:1,Support for:1,for Older:1,Older Processors:1,Processors To:1,To date:1,date X-Sharp:1,486 because:1,that sub-386:1,sub-386 processors:1,processors don’t:1,support I:1,chose 32-bit:1,reasons They’re:1,They’re much:1,for 16.16:1,16.16 fixed-point:1,arithmetic than:1,any approach:1,short I:1,was after:1,after maximum:1,was perhaps:1,perhaps just:1,little lazy:1,lazy I:1,to sneak:1,sneak this:1,by you:1,common feedback:1,feedback I’ve:1,gotten on:1,on X-Sharp:1,it support:1,286 Well:1,hint as:1,next guy:1,guy Listing:1,54.1 is:1,an improved:1,improved version:1,FIXED.ASM containing:1,containing dual:1,dual 386/8088:1,386/8088 versions:1,of CosSin:1,CosSin XformVec:1,ConcatXforms as:1,as FixedMul:1,FixedDiv Given:1,FIXED.ASM with:1,with USE386:1,USE386 set:1,0 X-Sharp:1,X-Sharp will:1,will now:1,now run:1,processor That’s:1,processor or:1,it used:1,The switch:1,instructions makes:1,makes X-Sharp’s:1,X-Sharp’s fixed-point:1,calculations about:1,about 2.5:1,slower overall:1,overall Since:1,perhaps 40:1,486/33 we’re:1,a hundred-times:1,hundred-times speed:1,speed difference:1,and mainstream:1,mainstream A:1,A 486/33:1,486/33 can:1,animate a:1,ball complete:1,with shading:1,discussed later:1,later at:1,at 60:1,fps with:1,spare an:1,an 8-MHz:1,same ball:1,ball at:1,about 6:1,6 fps:1,fps Clearly:1,animation an:1,application uses:1,uses must:1,be tailored:1,available CPU:1,CPU horsepower:1,multiply using:1,using 8088:1,adding together:1,together four:1,four partial:1,partial products:1,products A:1,A 32-bit:1,32-bit divide:1,simple however:1,54.1 I’ve:1,full 32x32:1,rather only:1,divide The:1,simple performance:1,performance A:1,A 32x16:1,divide can:1,implemented on:1,8088 with:1,two DIV:1,DIV instructions:1,see If:1,If anyone:1,fast 32x32:1,handle signed:1,signed multiplies:1,divides than:1,approach taken:1,54.1 please:1,please drop:1,line care:1,publisher In:1,X-Sharp division:1,divide either:1,either X:1,X or:1,Y by:1,by Z:1,from view:1,merely some:1,some inaccuracy:1,calculating screen:1,coordinates especially:1,objects get:1,get very:1,Z 0:1,0 plane:1,This error:1,not cumulative:1,cumulative that:1,doesn’t carry:1,carry over:1,later frames:1,experience doesn’t:1,doesn’t cause:1,cause noticeable:1,noticeable image:1,image degradation:1,degradation therefore:1,therefore given:1,the already:1,already slow:1,286 I’ve:1,I’ve opted:1,opted for:1,over precision:1,precision At:1,rate please:1,of FixedDiv:1,general-purpose 32x32:1,32x32 fixed-point:1,fixed-point division:1,division routine:1,a divide-by-zero:1,error if:1,if passed:1,passed a:1,fixed-point divisor:1,divisor between:1,between 1:1,explained the:1,of Fixed-Div:1,Fixed-Div is:1,what X-Sharp:1,X-Sharp needs:1,possible Shading:1,Shading So:1,polygons out:1,our animated:1,animated objects:1,objects have:1,been built:1,built have:1,had colors:1,of fixed:1,fixed intensities:1,intensities For:1,a face:1,cube might:1,be blue:1,blue or:1,or green:1,green or:1,or white:1,white but:1,but whatever:1,color it:1,color never:1,never brightens:1,brightens or:1,or dims:1,dims Fixed:1,Fixed colors:1,are easy:1,implement but:1,don’t make:1,very realistic:1,surface varies:1,illuminated The:1,to simulate:1,simulate the:1,the illumination:1,or shading:1,next feature:1,feature we’ll:1,overall shading:1,shading of:1,several types:1,components Ambient:1,by what:1,as background:1,background light:1,light light:1,light that’s:1,that’s coming:1,all directions:1,directions all:1,equally illuminated:1,illuminated by:1,by ambient:1,ambient light:1,light regardless:1,their orientation:1,orientation Directed:1,Directed lighting:1,lighting producing:1,producing diffuse:1,illumination from:1,more specific:1,specific light:1,sources Directed:1,Directed light:1,light has:1,specific direction:1,it lights:1,lights that:1,surface Specular:1,Specular reflection:1,reflection is:1,the tendency:1,tendency of:1,reflect light:1,light in:1,a mirrorlike:1,mirrorlike fashion:1,fashion There:1,including transparency:1,transparency and:1,and atmospheric:1,atmospheric effects:1,effects but:1,and diffuse-shading:1,diffuse-shading components:1,with in:1,X-Sharp Ambient:1,Ambient Shading:1,basic model:1,simple one:1,one Each:1,a reflectivity:1,reflectivity between:1,where 0:1,0 means:1,is absorbed:1,absorbed and:1,1 means:1,is reflected:1,reflected A:1,A certain:1,certain amount:1,energy strikes:1,strikes each:1,The energy:1,energy intensity:1,is expressed:1,expressed such:1,if light:1,intensity 1:1,1 strikes:1,with reflectivity:1,reflectivity 1:1,possible shading:1,surface Complicating:1,Complicating this:1,this somewhat:1,somewhat is:1,support color:1,color we:1,by separating:1,separating reflectance:1,reflectance and:1,shading into:1,three components:1,components each—red:1,each—red green:1,blue—and calculating:1,component separately:1,surface Given:1,Given an:1,an ambient-light:1,ambient-light red:1,of IA_red:1,IA_red and:1,surface red:1,reflectance R_red:1,R_red the:1,red ambient:1,maximum red:1,simply min(IA_red:1,min(IA_red x:1,x R_red:1,R_red 1:1,The green:1,handled similarly:1,similarly That’s:1,to ambient:1,shading although:1,must design:1,design some:1,map displayed:1,displayed color:1,components into:1,available palette:1,colors I’ll:1,chapter Ambient:1,whole shading:1,shading picture:1,picture though:1,fact scenes:1,scenes tend:1,pretty bland:1,bland without:1,without diffuse:1,shading Diffuse:1,Diffuse Shading:1,Shading Diffuse:1,Diffuse shading:1,than ambient:1,shading because:1,effective intensity:1,light falling:1,falling on:1,surface depends:1,surface According:1,to Lambert’s:1,Lambert’s law:1,law the:1,energy from:1,source striking:1,striking a:1,angle measured:1,measured relative:1,54.1 If:1,is ID_red:1,ID_red the:1,reflectance of:1,is R_red:1,R_red and:1,the incoming:1,incoming directed:1,surface’s normal:1,is theta:1,theta then:1,possible red:1,is min:1,min ID_red:1,ID_red xR_red:1,xR_red xcos(θ:1,xcos(θ 1:1,1 That’s:1,That’s easy:1,to calculate—but:1,calculate—but seemingly:1,seemingly slow:1,slow Determining:1,Determining the:1,angle can:1,lookup but:1,there’s also:1,that diffuse:1,be speedy:1,speedy enough:1,purposes Consider:1,however According:1,the properties:1,properties of:1,the operator:1,operator as:1,54.2 cos(q:1,v•w v:1,v x:1,x w:1,w where:1,where v:1,are vectors:1,vectors q:1,between v:1,w and:1,and v:1,v is:1,of v:1,v Suppose:1,that v:1,is vectors:1,vectors exactly:1,long Then:1,to cos(q:1,v•w In:1,cosine between:1,between N:1,N the:1,the unit-normal:1,unit-normal vector:1,vector one-unit-long:1,one-unit-long perpendicular:1,and L:1,L the:1,the reverse:1,reverse of:1,vector describing:1,source with:1,just three:1,adds I’ll:1,the light-direction:1,light-direction vector:1,reversed later:1,later Once:1,easily calculate:1,shading from:1,as min(ID_red:1,min(ID_red xR_red:1,xR_red x(L:1,x(L N:1,components Figure:1,overall red:1,red shading:1,by summing:1,the ambient-shading:1,ambient-shading red:1,component with:1,the diffuse-shading:1,diffuse-shading component:1,in min:1,min IA_red:1,IA_red xR_red:1,xR_red ID_red0:1,ID_red0 xR_red:1,xR_red x(L_0:1,x(L_0 N:1,N ID_red1:1,ID_red1 xR_red:1,xR_red x(L_1:1,x(L_1 N:1,where ID_red0:1,ID_red0 and:1,and L_0:1,L_0 are:1,intensity and:1,the reversed:1,reversed unit-direction:1,unit-direction vector:1,vector respectively:1,respectively for:1,for spotlight:1,spotlight 0:1,54.2 shows:1,X-Sharp module:1,module DRAWPOBJ.C:1,DRAWPOBJ.C which:1,performs ambient:1,shading Toward:1,end you:1,performs shading:1,shading exactly:1,equation first:1,first calculating:1,ambient red:1,shadings then:1,then summing:1,summing that:1,the diffuse:1,diffuse red:1,shadings generated:1,source Shading:1,Shading Implementation:1,Implementation Details:1,Details In:1,between an:1,incoming light:1,a polygon’s:1,first have:1,normal This:1,This could:1,cross-product on:1,two polygon:1,then calculating:1,the normal’s:1,normal’s length:1,normal Unfortunately:1,require taking:1,root so:1,desirable course:1,action Instead:1,Instead I’ve:1,to X-Sharp’s:1,polygon format:1,format Now:1,a shaded:1,shaded polygon’s:1,the end-point:1,end-point of:1,normal that:1,point isn’t:1,isn’t one:1,vertices but:1,vertex Calculating:1,difference vector:1,vector between:1,second points:1,points yields:1,normal Adding:1,a unit-normal:1,unit-normal endpoint:1,isn’t free:1,free each:1,those end-points:1,end-points has:1,time Still:1,scratch Figure:1,vector Figure:1,vector We:1,source The:1,The directed:1,sources I’ve:1,X-Sharp are:1,are spotlights:1,spotlights that:1,is they’re:1,they’re considered:1,be point:1,point light:1,infinitely far:1,away This:1,the simplifying:1,simplifying assumption:1,light rays:1,rays from:1,spotlight are:1,of equal:1,equal intensity:1,intensity throughout:1,displayed universe:1,each spotlight:1,spotlight can:1,represented with:1,single unit:1,single intensity:1,intensity The:1,desired cos(theta:1,cos(theta between:1,polygon unit:1,a spotlight’s:1,vector the:1,the spotlight’s:1,reversed as:1,54.4 This:1,product implicitly:1,implicitly places:1,places vectors:1,vectors with:1,start points:1,location when:1,The light:1,is incoming:1,incoming to:1,polygon surface:1,is outbound:1,outbound so:1,reversing one:1,one vector:1,vector or:1,desired angle:1,angle Given:1,vectors it’s:1,of cake:1,cake to:1,calculate intensities:1,intensities as:1,archive on:1,disk built:1,built by:1,running K1.BAT:1,K1.BAT puts:1,puts the:1,shading code:1,work displaying:1,a rotating:1,ball with:1,with ambient:1,three spot:1,spot lighting:1,user can:1,off What:1,What you’ll:1,DEMO1 is:1,very good—face:1,good—face colors:1,colors change:1,change very:1,very smoothly:1,smoothly indeed—so:1,indeed—so long:1,as only:1,only green:1,green lighting:1,sources are:1,you combine:1,combine spotlight:1,spotlight two:1,two which:1,blue with:1,other light:1,polygon colors:1,colors will:1,shift abruptly:1,abruptly and:1,and unevenly:1,unevenly As:1,As configured:1,demo the:1,palette supports:1,wide range:1,shading intensities:1,intensities for:1,pure version:1,colors but:1,steps four:1,four in:1,component when:1,more primary:1,are mixed:1,mixed While:1,situation can:1,improved it:1,fundamentally a:1,restricted capabilities:1,much that:1,done without:1,larger color:1,I’ll talk:1,some ways:1,256-color shading:1,shading Chapter:1,55 Color:1,Color Modeling:1,Modeling in:1,in 256-Color:1,Mode Pondering:1,Pondering X-Sharp’s:1,X-Sharp’s Color:1,Model in:1,RGB State:1,State of:1,of Mind:1,Mind Once:1,Once she:1,she turned:1,turned six:1,six my:1,daughter wanted:1,wanted some:1,some fairly:1,fairly sophisticated:1,sophisticated books:1,books read:1,her Wind:1,Wind in:1,the Willows:1,Willows Little:1,Little House:1,House on:1,the Prairie:1,Prairie Pretty:1,Pretty heady:1,heady stuff:1,one so:1,so young:1,young and:1,wondered how:1,it she:1,she really:1,really understood:1,understood As:1,an experiment:1,experiment during:1,one reading:1,reading I:1,stopped whenever:1,thought she:1,she might:1,asked her:1,her what:1,meant One:1,such word:1,word was:1,was mulling:1,mulling Do:1,what mulling:1,mulling means:1,means I:1,asked She:1,She thought:1,while then:1,then said:1,said Pondering:1,Pondering Very:1,Very good:1,said more:1,little surprised:1,surprised She:1,She smiled:1,smiled and:1,But Dad:1,Dad how:1,what pondering:1,pondering means:1,means Okay:1,does pondering:1,pondering mean:1,mean Mulling:1,Mulling she:1,this anecdote:1,anecdote tell:1,universe in:1,we live:1,live Well:1,certainly indicates:1,this universe:1,universe is:1,is inhabited:1,inhabited by:1,one comedian:1,comedian and:1,good straight:1,straight man:1,man Beyond:1,Beyond that:1,that though:1,be construed:1,construed as:1,defining things:1,things properly:1,complications inherent:1,VGA Coincidentally:1,Coincidentally VGA:1,modeling just:1,with color:1,modeling in:1,general A:1,A Color:1,Model We’ve:1,We’ve been:1,been developing:1,developing X-Sharp:1,chapters now:1,now In:1,added illumination:1,illumination sources:1,shading that:1,that addition:1,addition makes:1,general-purpose color:1,model so:1,the gradations:1,intensity necessary:1,render illuminated:1,illuminated surfaces:1,surfaces properly:1,a bright:1,bright light:1,is shining:1,shining straight:1,straight at:1,a green:1,green surface:1,surface we:1,display bright:1,bright green:1,that light:1,light dims:1,dims or:1,or tilts:1,tilts to:1,to strike:1,strike the:1,a shallower:1,shallower angle:1,angle we:1,display progressively:1,progressively dimmer:1,dimmer shades:1,shades of:1,green The:1,perform our:1,our shading:1,calculations I’ll:1,dot product-based:1,product-based stuff:1,take is:1,select an:1,ideal representation:1,full color:1,our calculations:1,calculations there:1,really could:1,could display:1,display every:1,possible color:1,color only:1,only as:1,step will:1,each desired:1,color into:1,limited 256-color:1,256-color set:1,color range:1,whatever adapter:1,adapter we:1,we happen:1,with There:1,color models:1,with but:1,both most:1,most familiar:1,familiar and:1,opinion simplest:1,simplest RGB:1,RGB red:1,green blue:1,blue In:1,is modeled:1,modeled as:1,of specific:1,specific fractions:1,fractions of:1,of full:1,full intensities:1,color primaries:1,primaries For:1,possible pure:1,pure blue:1,blue is:1,0.0*R 0.0*G:1,0.0*G 1.0*B:1,1.0*B Half-bright:1,Half-bright cyan:1,0.0*R 0.5*G:1,0.5*G 0.5*B:1,0.5*B Quarter-bright:1,Quarter-bright gray:1,gray is:1,is 0.25*R:1,0.25*R 0.25*G:1,0.25*G 0.25*B:1,0.25*B You:1,cube as:1,55.1 with:1,particular color:1,color lying:1,lying somewhere:1,somewhere inside:1,or on:1,cube RGB:1,for modeling:1,modeling colors:1,colors generated:1,by light:1,sources because:1,because red:1,the additive:1,additive primaries:1,primaries that:1,mixing red:1,blue light:1,sources They’re:1,They’re also:1,primaries for:1,color computer:1,computer displays:1,model maps:1,maps beautifully:1,beautifully onto:1,display capabilities:1,and 24-bpp:1,24-bpp display:1,adapters which:1,represent pixels:1,as RGB:1,RGB combinations:1,combinations in:1,then are:1,are RGB:1,colors represented:1,X-Sharp Each:1,Each color:1,triplet with:1,blue resolution:1,resolution using:1,structure shown:1,Listing 55.1:1,55.1 Here:1,color components—one:1,components—one each:1,blue—and each:1,bits Zero:1,Zero intensity:1,value 255:1,255 This:1,us 256:1,of 16772216:1,16772216 possible:1,colors Holy:1,Holy cow:1,cow Isn’t:1,Isn’t 16000000-plus:1,16000000-plus colors:1,of overkill:1,overkill Actually:1,Actually no:1,no it:1,isn’t At:1,the eighth:1,eighth Annual:1,Annual Computer:1,Graphics Show:1,Show in:1,York Sheldon:1,Sheldon Linker:1,Linker of:1,of Linker:1,Linker Systems:1,Systems related:1,related an:1,interesting tale:1,tale about:1,about color:1,perception research:1,research at:1,the Jet:1,Jet Propulsion:1,Propulsion Lab:1,Lab back:1,the 70s:1,70s The:1,The JPL:1,JPL color:1,color research:1,research folks:1,folks had:1,print more:1,than 50000000:1,50000000 distinct:1,distinct and:1,very precise:1,precise colors:1,on paper:1,paper As:1,test they:1,they tried:1,tried printing:1,printing out:1,out words:1,various colors:1,word printed:1,printed on:1,a background:1,background that:1,that differed:1,differed by:1,by only:1,color index:1,index from:1,the word’s:1,word’s color:1,color No:1,one expected:1,to differentiate:1,differentiate between:1,two colors:1,colors out:1,of 50000000-plus:1,50000000-plus that:1,so similar:1,similar It:1,everyone could:1,could read:1,trouble at:1,surprisingly sensitive:1,sensitive to:1,color gradations:1,gradations and:1,be wonderful:1,wonderful at:1,at detecting:1,detecting edges:1,edges When:1,the JPL:1,JPL team:1,team went:1,the eye’s:1,eye’s sensitivity:1,sensitivity to:1,screen they:1,they found:1,be distinguished:1,distinguished because:1,the color-sensing:1,color-sensing mechanism:1,more compatible:1,with reflective:1,reflective sources:1,as paper:1,paper and:1,and ink:1,ink than:1,with emissive:1,emissive sources:1,as CRTs:1,CRTs Still:1,can distinguish:1,distinguish about:1,believe if:1,eye senses:1,senses each:1,color separately:1,we’re really:1,only talking:1,about detecting:1,detecting 256:1,intensity per:1,primary here:1,here It’s:1,the brain:1,brain that:1,the amazing:1,amazing part:1,part the:1,the 16000000-plus:1,16000000-plus color:1,color capability:1,capability actually:1,actually comes:1,comes not:1,from extraordinary:1,extraordinary sensitivity:1,sensitivity in:1,eye but:1,the brain’s:1,brain’s ability:1,between all:1,the mixes:1,primaries So:1,perfectly reasonable:1,maintain 24:1,24 bits:1,and X-Sharp:1,X-Sharp represents:1,represents colors:1,colors internally:1,internally as:1,as ideal:1,ideal device-independent:1,device-independent 24-bit:1,triplets All:1,All shading:1,these triplets:1,triplets with:1,with 24-bit:1,24-bit color:1,color precision:1,precision It’s:1,final 24-bit:1,RGB drawing:1,calculated that:1,capabilities come:1,play as:1,X-Sharp function:1,function ModelColorToColorIndex:1,ModelColorToColorIndex is:1,desired RGB:1,displaying Of:1,that mapping:1,is adapter-dependent:1,adapter-dependent On:1,a 24-bpp:1,24-bpp device:1,device it’s:1,it’s pretty:1,obvious how:1,internal RGB:1,color format:1,format maps:1,to displayed:1,displayed pixel:1,colors directly:1,directly On:1,On VGAs:1,VGAs with:1,with 15-bpp:1,15-bpp Sierra:1,Sierra Hicolor:1,Hicolor DACS:1,DACS the:1,equally simple:1,simple with:1,the five:1,five upper:1,component mapping:1,mapping straight:1,display pixels:1,pixels But:1,But how:1,how on:1,earth do:1,map those:1,those 16000000-plus:1,16000000-plus RGB:1,colors into:1,256-color space:1,VGA This:1,color definition:1,definition problem:1,problem I:1,is arbitrarily:1,arbitrarily programmable:1,programmable to:1,any set:1,color defined:1,blue intensity:1,intensity In:1,X-Sharp the:1,function InitializePalette:1,InitializePalette can:1,be customized:1,palette however:1,we wish:1,wish this:1,this gives:1,us nearly:1,complete flexibility:1,flexibility in:1,in defining:1,working color:1,set Even:1,with infinite:1,infinite flexibility:1,flexibility however:1,however 256:1,256 out:1,of 16000000:1,16000000 or:1,so possible:1,colors is:1,pretty puny:1,puny selection:1,selection It’s:1,good selection:1,just blue:1,blue intensities:1,intensities or:1,or of:1,just greens:1,greens but:1,modeling there’s:1,there’s simply:1,enough palette:1,go around:1,around One:1,limited simultaneous:1,simultaneous color:1,then bias:1,palette toward:1,toward that:1,DEMO1 sample:1,Listings 55.2:1,55.2 and:1,and 55.3:1,55.3 show:1,of InitializePalette:1,InitializePalette and:1,ModelColorToColorIndex that:1,for DEMO1:1,DEMO1 In:1,In DEMO1:1,DEMO1 three-quarters:1,with 64:1,64 intensity:1,three pure:1,then most:1,only pure:1,resulting rendering:1,primary The:1,this excellent:1,excellent quality:1,three colors:1,blue What:1,are mixes:1,primaries like:1,like cyan:1,cyan or:1,or yellow:1,yellow to:1,of gray:1,gray In:1,DEMO1 color:1,model any:1,any RGB:1,primary is:1,is mapped:1,mapped into:1,space that:1,remaining quarter:1,component or:1,64 general:1,all This:1,is genuinely:1,genuinely lousy:1,lousy color:1,resolution being:1,being only:1,only 1/64th:1,1/64th of:1,component In:1,a staggering:1,staggering 262144:1,262144 colors:1,the 24-bit:1,RGB cube:1,cube map:1,the 2-2-2:1,2-2-2 VGA:1,not impressive:1,impressive the:1,of mixed-primary:1,mixed-primary surfaces:1,surfaces jump:1,jump abruptly:1,abruptly badly:1,badly damaging:1,damaging the:1,of real:1,real illumination:1,illumination To:1,how poor:1,poor a:1,RGB selection:1,look run:1,and press:1,2 key:1,on spotlight:1,spotlight 2:1,spotlight Because:1,green turning:1,spotlight causes:1,causes mixed-primary:1,mixed-primary colors:1,be displayed—and:1,displayed—and the:1,result looks:1,looks terrible:1,terrible because:1,enough color:1,resolution Unfortunately:1,Unfortunately 2-2-2:1,best general:1,resolution the:1,display 3-3-2:1,3-3-2 is:1,gets Another:1,Another approach:1,with reasonably:1,reasonably good:1,good mixes:1,two primaries:1,primaries but:1,no mixes:1,primaries then:1,only two-primary:1,two-primary colors:1,applications no:1,no grays:1,grays or:1,or whites:1,whites or:1,other three-primary:1,three-primary mixes:1,mixes Or:1,could choose:1,shade only:1,selected objects:1,objects using:1,using part:1,good range:1,and reserving:1,the fixed:1,fixed colors:1,other nonshaded:1,nonshaded objects:1,objects Jim:1,Animator suggests:1,suggests dynamically:1,dynamically adjusting:1,frame for:1,by allocating:1,allocating the:1,a first-come:1,first-come first-served:1,first-served basis:1,basis That:1,be trivial:1,for extremely:1,palette Another:1,Another widely:1,used solution:1,2-2-2 3-3-2:1,3-3-2 or:1,or 2.6-2.6-2.6:1,2.6-2.6-2.6 6:1,6 levels:1,levels per:1,primary palette:1,and dither:1,dither colors:1,colors Dithering:1,Dithering is:1,excellent solution:1,solution but:1,but outside:1,book Take:1,at Chapter:1,13 of:1,Van Dam:1,Dam cited:1,cited in:1,in Further:1,Further Readings:1,Readings for:1,an introduction:1,perception and:1,and approximation:1,approximation The:1,The sad:1,sad truth:1,VGA’s 256-color:1,an inadequate:1,inadequate resource:1,resource for:1,RGB shading:1,news is:1,that clever:1,clever workarounds:1,workarounds can:1,make VGA:1,graphics look:1,look nearly:1,as 24-bpp:1,24-bpp graphics:1,the burden:1,burden falls:1,VGA’s limitations:1,limitations To:1,To experiment:1,different 256-color:1,256-color model:1,X-Sharp just:1,change InitializePalette:1,InitializePalette to:1,desired palette:1,ModelColorToColorIndex to:1,map 24-bit:1,triplets into:1,palette you’ve:1,up It’s:1,It’s that:1,be striking:1,striking indeed:1,Bonus from:1,BitMan Finally:1,a note:1,which came:1,a correspondent:1,correspondent who:1,who asked:1,simply as:1,BitMan The:1,The BitMan:1,BitMan passed:1,nifty application:1,VGA’s under-appreciated:1,under-appreciated write:1,3 that:1,proper circumstances:1,55.2 We:1,draw what’s:1,as solid:1,cell around:1,box This:1,to transparent:1,text where:1,without disturbing:1,disturbing the:1,background Assume:1,Assume that:1,character fits:1,fits in:1,an eight-wide:1,eight-wide cell:1,cell as:1,VGA fonts:1,fonts and:1,at byte-aligned:1,byte-aligned locations:1,memory Solid:1,Solid text:1,drawing menus:1,menus text:1,text areas:1,areas and:1,like basically:1,basically it:1,a solid-color:1,solid-color background:1,implement solid:1,rectangle representing:1,box then:1,box However:1,two problems:1,with doing:1,doing solid:1,text this:1,way First:1,First there’s:1,some flicker:1,flicker because:1,text hasn’t:1,yet arrived:1,arrived More:1,the background-followed-by-foreground:1,background-followed-by-foreground approach:1,approach accesses:1,memory three:1,data once:1,box once:1,actually draw:1,pattern Display:1,is incredibly:1,so we’d:1,possible With:1,BitMan’s approach:1,eliminate flicker:1,flicker too:1,too Figure:1,text Figure:1,fast solid:1,text are:1,latches as:1,earlier discussions:1,discussions in:1,internal VGA:1,that hold:1,last bytes:1,bytes read:1,planes every:1,memory loads:1,address across:1,planes Whenever:1,some none:1,memory depending:1,mask which:1,drawing data:1,latches solve:1,solve half:1,our problem:1,can fill:1,color then:1,box The:1,trick now:1,text pixels:1,little complicated:1,complicated In:1,which incidentally:1,incidentally is:1,get written:1,memory Instead:1,turns into:1,mask Actually:1,it’s ANDed:1,result becomes:1,mask but:1,we’ll leave:1,to 0xFF:1,0xFF so:1,CPU value:1,mask The:1,mask selects:1,the previously:1,previously loaded:1,loaded background:1,color Where:1,color come:1,from if:1,CPU From:1,55.3 Thus:1,Thus each:1,CPU font:1,data presumably:1,presumably selects:1,selects foreground:1,foreground or:1,or background:1,all done:1,3 Figure:1,this sounds:1,pretty esoteric:1,esoteric but:1,but think:1,latches hold:1,form suitable:1,writing eight:1,eight background:1,full byte:1,pop Write:1,3 allows:1,to punch:1,punch holes:1,color provided:1,latches holes:1,holes through:1,can flow:1,flow The:1,write draws:1,draws exactly:1,of foreground:1,pixels described:1,each font:1,CPU It:1,Listing 55.4:1,55.4 which:1,shows The:1,action And:1,yes this:1,absolutely worth:1,trouble it’s:1,it’s about:1,the fill-then-draw:1,fill-then-draw approach:1,as transparent:1,text So:1,technique only:1,on full:1,full bytes:1,memory There’s:1,to finer:1,finer precision:1,precision the:1,color will:1,inevitably flood:1,flood all:1,eight destination:1,aren’t selected:1,selected as:1,as foreground:1,pixels This:1,makes The:1,technique most:1,for monospaced:1,monospaced fonts:1,fonts with:1,with characters:1,to byte-aligned:1,byte-aligned addresses:1,technique can:1,other situations:1,situations but:1,apply Chapter:1,Chapter 56:1,56 Pooh:1,the Space:1,Space Station:1,Station Using:1,Using Fast:1,Mapping to:1,to Place:1,Place Pooh:1,Pooh on:1,a Polygon:1,Polygon So:1,So here’s:1,here’s where:1,where Winnie:1,Winnie the:1,Pooh lives:1,Saturn No:1,No really:1,really I:1,it straight:1,an eight-year-old:1,eight-year-old wouldn’t:1,important would:1,would she:1,she One:1,day she:1,she wondered:1,wondered aloud:1,aloud Where:1,Where is:1,Wood exactly:1,exactly and:1,could give:1,give one:1,those boring:1,boring parental:1,parental responses:1,responses about:1,was imaginary—but:1,imaginary—but A.A:1,A.A Milne:1,Milne probably:1,probably imagined:1,be somewhere:1,somewhere near:1,near London—my:1,London—my daughter:1,daughter announced:1,announced that:1,Wood was:1,Saturn and:1,good location:1,Wood leading:1,many exciting:1,exciting adventures:1,adventures for:1,for Pooh:1,Piglet Consider:1,they went:1,went down:1,the Jupiter:1,Jupiter gravity:1,gravity level:1,level we’re:1,talking centrifugal:1,centrifugal force:1,force here:1,is spinning:1,spinning of:1,nearly turned:1,into pancakes:1,pancakes of:1,Piglet varieties:1,varieties respectively:1,respectively Or:1,they drifted:1,drifted out:1,the free-fall:1,free-fall area:1,be rescued:1,rescued by:1,by humans:1,with wings:1,wings strapped:1,strapped on:1,a tip:1,the hat:1,Robert Heinlein:1,Heinlein here:1,here Or:1,were caught:1,current in:1,river through:1,the Wood:1,Wood and:1,and drifted:1,drifted for:1,for weeks:1,weeks around:1,the circumference:1,circumference of:1,station meeting:1,meeting many:1,many cultures:1,cultures and:1,finding many:1,many adventures:1,adventures along:1,way Yes:1,Yes Farmer’s:1,Farmer’s Riverworld:1,Riverworld no:1,one said:1,said the:1,the stories:1,stories you:1,you tell:1,tell your:1,your children:1,children need:1,be purely:1,purely original:1,original just:1,just interesting:1,think Pooh:1,Piglet in:1,tad peculiar:1,peculiar then:1,even mention:1,mention Karla:1,Karla the:1,the woman:1,woman who:1,who invented:1,invented agriculture:1,agriculture medicine:1,medicine sanitation:1,sanitation reading:1,writing peace:1,peace and:1,else while:1,while travelling:1,travelling the:1,the Americas:1,Americas with:1,her mountain:1,mountain lion:1,lion during:1,last Ice:1,Ice Age:1,Age or:1,the Mars:1,Mars Cats:1,their trip:1,trip in:1,in suspended:1,suspended animation:1,the Lesser:1,Lesser Magellenic:1,Magellenic Cloud:1,Cloud and:1,beyond or:1,or most:1,most assuredly:1,assuredly Little:1,Little Whale:1,Whale the:1,the baby:1,baby Universe:1,Universe Whale:1,Whale that:1,is naughty:1,naughty enough:1,eat inhabited:1,inhabited universes:1,universes But:1,digress Anyway:1,Anyway I:1,I bring:1,bring up:1,up Pooh:1,station because:1,time has:1,has come:1,discuss fast:1,mapping Texture:1,mapping an:1,bitmap onto:1,been transformed:1,transformed in:1,drawing Up:1,point each:1,polygon we’ve:1,single solid:1,color Over:1,last couple:1,shade polygons:1,polygons according:1,to lighting:1,color Thus:1,produce any:1,of intricate:1,intricate design:1,many tiny:1,tiny polygons:1,drawn That:1,need another:1,approach One:1,is texture:1,mapping that:1,is mapping:1,bitmap containing:1,desired image:1,image onto:1,pixels contained:1,contained within:1,polygon Done:1,Done properly:1,properly this:1,change X-Sharp’s:1,X-Sharp’s output:1,output from:1,a bland:1,bland collection:1,of monocolor:1,monocolor facets:1,facets to:1,a lively:1,lively detailed:1,detailed and:1,realistic scene:1,scene What:1,What sort:1,scene you:1,ask This:1,where Pooh:1,station came:1,in When:1,sample texture-mapping:1,texture-mapping application:1,application it:1,it occurred:1,the shaded:1,shaded ball:1,ball demo:1,demo we:1,X-Sharp recently:1,recently looked:1,bit like:1,a spinning:1,spinning spherical:1,spherical space:1,single unshaded:1,unshaded yellow:1,yellow polygon:1,polygon looked:1,looked somewhat:1,somewhat like:1,window in:1,nice example:1,if someone:1,someone were:1,were standing:1,standing in:1,window The:1,is history:1,history Principles:1,of Quick-and-Dirty:1,Quick-and-Dirty Texture:1,Mapping The:1,our texture-mapping:1,texture-mapping approach:1,quickly determine:1,what pixel:1,These polygon:1,polygon pixel:1,by mapping:1,mapping each:1,polygon back:1,bitmap via:1,a reverse:1,color resides:1,corresponding location:1,56.1 It:1,seem more:1,map pixels:1,it’s crucial:1,crucial that:1,mapping proceed:1,proceed backward:1,destination to:1,avoid gaps:1,image With:1,right value:1,a backward:1,backward mapping:1,mapping there’s:1,can miss:1,miss any:1,pixels On:1,the forward-mapping:1,forward-mapping method:1,method some:1,some destination:1,or double-drawn:1,double-drawn because:1,one-to-one or:1,or one-to-many:1,one-to-many mapping:1,mapping Although:1,Although we’re:1,it now:1,now mapping:1,mapping back:1,source makes:1,average several:1,several neighboring:1,neighboring image:1,pixels together:1,to antialias:1,antialias the:1,image This:1,can greatly:1,improve texture:1,texture quality:1,quality although:1,slower Figure:1,color Mapping:1,Textures Made:1,Made Easy:1,Easy To:1,map textures:1,textures consider:1,consider Figure:1,56.2 which:1,a bitmapped:1,bitmapped image:1,directly onto:1,polygon Here:1,simply map:1,origin of:1,polygon’s untransformed:1,untransformed coordinate:1,system somewhere:1,somewhere within:1,image then:1,then map:1,corresponding image:1,pixels For:1,For simplicity:1,simplicity I’ll:1,I’ll assume:1,assume in:1,discussion that:1,polygon’s coordinate:1,in units:1,units of:1,pixels but:1,but scaling:1,scaling images:1,is eminently:1,eminently doable:1,doable This:1,clearer when:1,at mapping:1,mapping images:1,images onto:1,onto transformed:1,transformed polygons:1,polygons next:1,next Mapping:1,Mapping the:1,of stepping:1,time advancing:1,edges according:1,normally done:1,polygon Since:1,is untransformed:1,untransformed the:1,the stepping:1,stepping is:1,identical in:1,pixel mapping:1,is one-to-one:1,one-to-one so:1,be block:1,block copied:1,Now matters:1,complicated What:1,rotated in:1,two dimensions:1,dimensions We:1,We no:1,longer have:1,neat direct:1,direct mapping:1,from image:1,image scan:1,to destination:1,lines We:1,We still:1,still want:1,draw across:1,proper source:1,line may:1,may now:1,now track:1,track across:1,56.3 What:1,simple We’ll:1,just map:1,each transformed:1,corresponding vertex:1,bitmap this:1,easy because:1,same indices:1,indices in:1,and transformed:1,vertex lists:1,lists Each:1,polygon we’ll:1,we’ll select:1,corresponding edge:1,well Then—and:1,Then—and this:1,is crucial—each:1,crucial—each time:1,line we’ll:1,we’ll step:1,corresponding source:1,edge an:1,amount Ah:1,Ah but:1,amount Think:1,is 100:1,100 scan:1,lines high:1,high it:1,be stepped:1,stepped 100:1,times Then:1,Then we’ll:1,we’ll divide:1,the SourceXWidth:1,SourceYHeight lengths:1,edge by:1,by 100:1,100 and:1,add those:1,those amounts:1,source edge’s:1,edge’s coordinates:1,coordinates each:1,stepped one:1,line Put:1,usual arranged:1,arranged things:1,step DestYHeight:1,times where:1,where DestYHeight:1,DestYHeight is:1,The this:1,approach arranges:1,arranges to:1,edge DestYHeight:1,times also:1,match what:1,doing Figure:1,track the:1,edges Stepping:1,Stepping across:1,line uses:1,uses precisely:1,same technique:1,56.4 In:1,destination we:1,times across:1,polygon once:1,DestXWidth is:1,horizontal distance:1,scanned on:1,line To:1,To match:1,match this:1,we divide:1,divide SourceXWidth:1,SourceYHeight the:1,edge points:1,points we’ve:1,been tracking:1,tracking as:1,DestXWidth to:1,produce SourceXStep:1,SourceYStep Then:1,just step:1,times adding:1,adding SourceXStep:1,SourceYStep to:1,SourceX and:1,and SourceY:1,SourceY each:1,nearest image:1,SourceX SourceY:1,SourceY to:1,to DestX:1,DestX DestY:1,DestY Note:1,used above:1,above such:1,as SourceXWidth:1,SourceXWidth are:1,for descriptive:1,descriptive purposes:1,necessarily correspond:1,actual variable:1,variable names:1,56.2 That’s:1,rotated polygons—but:1,polygons—but what:1,3-D rotated:1,rotated polygons:1,visible dimensions:1,vary with:1,projection First:1,First I’d:1,that texture:1,mapping takes:1,place from:1,polygon after:1,is projected:1,screen That:1,image will:1,mapped after:1,its final:1,final drawable:1,drawable form:1,approach automatically:1,automatically compensates:1,compensates for:1,all changes:1,the dimensions:1,polygon You:1,approach divides:1,divides source:1,source edges:1,and scan:1,into however:1,many steps:1,steps the:1,polygon requires:1,much narrower:1,narrower than:1,projection we:1,up taking:1,taking bigger:1,bigger steps:1,steps through:1,and skipping:1,skipping a:1,of source:1,56.5 The:1,approach handles:1,handles all:1,all transformations:1,projections effortlessly:1,effortlessly It:1,to scale:1,scale source:1,images up:1,in larger:1,polygons all:1,needed is:1,vertices map:1,else happens:1,automatically In:1,fact mapping:1,any polygonal:1,work given:1,vertices Figure:1,polygon Notes:1,on DDA:1,DDA Texture:1,Mapping That’s:1,to quick-and-dirty:1,quick-and-dirty texture:1,technique basically:1,basically uses:1,a two-stage:1,two-stage digital:1,digital differential:1,differential analyzer:1,analyzer DDA:1,normal scan-line:1,scan-line stepping:1,mapping It’s:1,any trigonometric:1,trigonometric functions:1,functions at:1,two divides:1,divides are:1,perfect approach:1,course For:1,isn’t anywhere:1,drawing solid:1,solid polygons:1,more comparable:1,approach results:1,perfect image:1,quality since:1,since source:1,or selected:1,selected twice:1,twice I:1,trust however:1,how easy:1,easy it:1,by antialiasing:1,antialiasing with:1,approach For:1,simply average:1,four surrounding:1,surrounding pixels:1,did for:1,simple unweighted:1,unweighted antialiasing:1,Chapters F:1,F GChapter:1,GChapter K:1,CD-ROM Or:1,a Wu:1,antialiasing approach:1,approach see:1,57 and:1,axis according:1,to proximity:1,proximity If:1,had cycles:1,waste which:1,which given:1,is real-time:1,PC we:1,don’t we:1,a low-pass:1,low-pass filter:1,filter sized:1,sized in:1,Y according:1,destination dimensions:1,dimensions that:1,is scaled:1,up or:1,or down:1,source Even:1,mapping I’ll:1,X-Sharp doesn’t:1,doesn’t correct:1,correct for:1,perspective That:1,nearly parallel:1,3-space but:1,noticeable bowing:1,bowing of:1,of textures:1,on large:1,screen Perspective:1,Perspective texture:1,complex subject:1,subject that’s:1,its existence:1,existence because:1,because perspective:1,games these:1,days Finally:1,of DDA:1,is display-hardware:1,display-hardware dependent:1,dependent because:1,be compatible:1,destination That’s:1,That’s actually:1,fairly serious:1,serious issue:1,issue One:1,nice things:1,about X-Sharp’s:1,orientation is:1,until now:1,display dependent:1,dependent part:1,from RGB:1,space Compensation:1,Compensation for:1,for aspect:1,ratio resolution:1,all happens:1,automatically in:1,projection Still:1,Still we:1,display detailed:1,to conceive:1,conceive of:1,that’s totally:1,totally hardware:1,hardware independent:1,independent If:1,one let:1,know care:1,publisher For:1,of adequate:1,adequate quality:1,quality which:1,straightforward non-antialiased:1,non-antialiased DDA:1,approach supplies:1,supplies I’m:1,sure there:1,other fast:1,fast approaches:1,said there:1,accurate approaches:1,approaches but:1,but DDA:1,mapping works:1,well given:1,PC’s horsepower:1,horsepower Next:1,at code:1,performs DDA:1,mapping First:1,thank Jim:1,Animator and:1,a frequent:1,frequent correspondent:1,correspondent for:1,for getting:1,approach Fast:1,Mapping An:1,Implementation As:1,expect I’ve:1,implemented DDA:1,are reflected:1,reflected in:1,disk Listing:1,Listing 56.1:1,56.1 shows:1,new header:1,file entries:1,entries and:1,56.2 shows:1,actual texture-mapped:1,polygon drawer:1,drawer The:1,The set-pixel:1,56.2 calls:1,slight modification:1,X set-pixel:1,routine from:1,47 In:1,addition INITBALL.C:1,INITBALL.C has:1,create three:1,three texture-mapped:1,and define:1,texture bitmaps:1,and modifications:1,modifications have:1,user to:1,rotation You:1,will of:1,complete X-Sharp:1,library to:1,see texture:1,action but:1,but Listings:1,Listings 56.1:1,56.1 and:1,and 56.2:1,56.2 are:1,actual texture:1,entirety Here’s:1,major tip:1,tip DDA:1,looks best:1,best on:1,on fast-moving:1,fast-moving surfaces:1,eye doesn’t:1,pick nits:1,nits with:1,shearing and:1,aliasing that’s:1,an inevi:1,inevi table:1,table by-product:1,by-product of:1,a crude:1,crude approach:1,approach Compile:1,Compile DEMO1:1,DEMO1 from:1,initial display:1,display looks:1,looks okay:1,okay but:1,not great:1,great because:1,rotational speed:1,slow Now:1,Now press:1,the S:1,S key:1,key a:1,rotation axes:1,axes I:1,better DDA:1,technique would:1,for mapping:1,textures onto:1,onto hurtling:1,hurtling asteroids:1,asteroids or:1,or jets:1,jets but:1,up short:1,for slow:1,slow finely:1,detailed movements:1,movements No:1,you slice:1,slice it:1,mapping beats:1,beats boring:1,boring single-color:1,single-color polygons:1,polygons nine:1,nine ways:1,to Sunday:1,Sunday The:1,big downside:1,fill move:1,ball close:1,watch things:1,things slow:1,down when:1,those big:1,big texture:1,maps comes:1,around Of:1,that’s partly:1,some well-chosen:1,well-chosen optimizations:1,optimizations would:1,wonders In:1,discuss texture:1,mapping further:1,further crank:1,our texture:1,and attend:1,attend to:1,rough spots:1,spots that:1,that remain:1,mapping implementation:1,implementation most:1,notably in:1,which texture:1,texture pixels:1,pixels map:1,polygon rotates:1,rotates And:1,curious yes:1,yes there:1,DEMO1 I:1,wouldn’t say:1,he looks:1,a Pooh-type:1,Pooh-type bear:1,bear but:1,but he’s:1,he’s a:1,bear nonetheless:1,nonetheless He:1,little startled:1,startled when:1,ball around:1,around so:1,he’s zipping:1,zipping by:1,head but:1,but heck:1,heck you:1,would too:1,too in:1,same situation:1,situation And:1,And remember:1,buy the:1,next VGA:1,VGA megahit:1,megahit Bears:1,Bears in:1,Space you:1,you saw:1,saw it:1,here first:1,first Chapter:1,57 10000:1,10000 Freshly:1,Freshly Sheared:1,Sheared Sheep:1,Sheep on:1,the Screen:1,Screen The:1,The Critical:1,Critical Role:1,Role of:1,of Experience:1,Experience in:1,in Implementing:1,Implementing Fast:1,Fast Smooth:1,Smooth Texture:1,Mapping I:1,recently spent:1,spent an:1,so learning:1,to shear:1,shear a:1,a sheep:1,sheep Among:1,Among other:1,things I:1,I learned—in:1,learned—in great:1,great detail—about:1,detail—about the:1,proper comb:1,comb for:1,your shears:1,shears heard:1,heard about:1,who holds:1,the world’s:1,world’s record:1,for sheep:1,sheep sheared:1,sheared in:1,day more:1,than 600:1,600 if:1,if memory:1,memory serves:1,serves and:1,and discovered:1,discovered Lord:1,Lord help:1,varied ways:1,the New:1,New Zealand:1,Zealand Sheep:1,Sheep Shearing:1,Shearing Board:1,Board improves:1,the approved:1,approved sheep-shearing:1,sheep-shearing method:1,method every:1,every year:1,year The:1,fellow giving:1,the presentation:1,presentation did:1,did his:1,best but:1,let’s face:1,face it:1,it sheep:1,sheep just:1,just aren’t:1,have children:1,children you’ll:1,there if:1,don’t there’s:1,no use:1,use explaining:1,explaining The:1,The chap:1,chap doing:1,shearing did:1,did say:1,that stuck:1,stuck with:1,me although:1,profound Actually:1,pretty silly:1,silly but:1,but bear:1,bear with:1,get really:1,at sheep:1,sheep shearing:1,shearing for:1,for 10:1,or 10000:1,10000 sheep:1,sheep I’ll:1,I’ll buy:1,buy that:1,that In:1,fact to:1,extend that:1,that morsel:1,morsel of:1,wisdom to:1,greater non-ovine-centric:1,non-ovine-centric universe:1,universe it:1,experience before:1,get good:1,at anything:1,anything worthwhile—especially:1,worthwhile—especially graphics:1,First performance:1,experience You:1,can’t speed:1,up PC:1,graphics simply:1,better algorithm:1,code C:1,compilers generate:1,generate assembly:1,optimization VGA:1,various graphics-programming:1,graphics-programming approaches:1,and algorithms:1,algorithms Second:1,Second computer:1,of illusion:1,of convincing:1,convincing the:1,want it:1,see and:1,art based:1,on experience:1,experience Visual:1,A Black:1,Black Hole:1,Hole Er:1,Er Art:1,Art Pleasing:1,Pleasing the:1,with realtime:1,realtime computer:1,science at:1,PC level:1,level where:1,limited color:1,fact sometimes:1,little frustrating:1,frustrating As:1,recall in:1,implemented texture:1,X-Sharp There:1,was plenty:1,experience involved:1,involved there:1,there some:1,didn’t mention:1,mention My:1,was disappointing:1,disappointing the:1,maps shimmied:1,shimmied and:1,and sheared:1,sheared badly:1,badly like:1,a loosely:1,loosely affiliated:1,affiliated flock:1,flock of:1,each marching:1,marching to:1,own drummer:1,drummer Then:1,a control:1,control key:1,rotation what:1,The aliasing:1,aliasing problems:1,problems were:1,rotation the:1,pixels moved:1,moved too:1,aliasing the:1,rotating texture:1,ball as:1,whole crossed:1,the threshold:1,threshold into:1,into being:1,being accepted:1,a viewed:1,viewed object:1,object rather:1,that adequate:1,adequate speed:1,to convincing:1,another less:1,obvious side:1,this lesson:1,lesson though:1,been running:1,texture-mapping demo:1,the beneficial:1,beneficial effects:1,of greater:1,greater animation:1,speed When:1,When some:1,time later:1,ran the:1,The ball:1,ball spun:1,spun so:1,eye couldn’t:1,couldn’t blend:1,blend successive:1,motion much:1,like watching:1,watching a:1,badly flickering:1,flickering movie:1,movie So:1,either too:1,or too:1,much speed:1,speed can:1,illusion Unless:1,you’re antialiasing:1,antialiasing you:1,to tune:1,tune the:1,the shifting:1,shifting of:1,images so:1,of apparent:1,apparent motion:1,motion in:1,is willing:1,the jumping:1,and blend:1,blend the:1,motion Only:1,Only experience:1,experience can:1,that sweet:1,spot Fixed-Point:1,Fixed-Point Arithmetic:1,Arithmetic Redux:1,Redux In:1,added texture:1,X-Sharp but:1,but lacked:1,lacked space:1,explain some:1,its finer:1,finer points:1,points I’ll:1,I’ll pick:1,the thread:1,thread now:1,and cover:1,cover some:1,points here:1,and discuss:1,performance enhancements:1,enhancements that:1,that previous:1,code needed—and:1,needed—and which:1,now present:1,CD-ROM Back:1,time explaining:1,explaining exactly:1,pixels were:1,were inside:1,were outside:1,outside and:1,pixels accordingly:1,accordingly This:1,important I:1,said because:1,a precise:1,precise consistent:1,consistent way:1,defining inside:1,outside would:1,would it:1,draw adjacent:1,polygons without:1,either overlap:1,or gaps:1,them As:1,a corollary:1,corollary I:1,added that:1,all-integer edge-stepping:1,edge-stepping approach:1,filling Fixed-point:1,arithmetic although:1,although alluring:1,alluring for:1,and ease:1,of use:1,use would:1,unacceptable because:1,because round-off:1,round-off error:1,error would:1,in imprecise:1,imprecise pixel:1,placement More:1,year then:1,then passed:1,passed between:1,wrote that:1,that statement:1,statement and:1,implemented X-Sharp’s:1,X-Sharp’s texture:1,mapper during:1,which time:1,my long-term:1,long-term memory:1,memory apparently:1,apparently suffered:1,suffered at:1,least partial:1,partial failure:1,failure When:1,implement texture:1,since transformed:1,destination vertices:1,vertices can:1,can fall:1,fall at:1,at fractional:1,fractional pixel:1,the cleanest:1,cleanest way:1,fixed-point coordinates:1,destination screen:1,screen polygon:1,polygon That:1,of distortion:1,distortion as:1,and moved:1,moved Theoretically:1,Theoretically that:1,made sense:1,sense but:1,small problem:1,problem gaps:1,polygons Yes:1,Yes folks:1,folks I:1,had ignored:1,ignored the:1,experience my:1,own voice:1,voice at:1,own peril:1,peril You:1,be assured:1,assured I:1,not forget:1,forget this:1,particular lesson:1,lesson again:1,again Fixed-point:1,precise That’s:1,fixed-point for:1,polygons if:1,adjacent edges:1,edges share:1,common start:1,and common:1,always stepped:1,stepped in:1,direction all:1,should share:1,same fixed-point:1,fixed-point imprecision:1,imprecision and:1,edges should:1,should fit:1,fit properly:1,properly although:1,although polygons:1,polygons may:1,include exactly:1,pixels What:1,absolutely cannot:1,cannot do:1,is mix:1,mix fixed-point:1,all-integer polygon-filling:1,polygon-filling approaches:1,approaches when:1,57.1 Consequently:1,all-integer approach:1,polygon However:1,kept the:1,fixed-point approach:1,simpler for:1,source Why:1,mix approaches:1,approaches in:1,case Precise:1,Precise pixel:1,placement only:1,matters when:1,drawing otherwise:1,get gaps:1,gaps which:1,visible When:1,When selecting:1,texture however:1,worst that:1,happens is:1,we pick:1,pick the:1,pixel next:1,one we:1,want causing:1,the mapped:1,mapped texture:1,have shifted:1,shifted by:1,pixel given:1,given all:1,and shearing:1,shearing already:1,already going:1,texture-mapping process:1,process a:1,one-pixel mapping:1,mapping error:1,is insignificant:1,insignificant Experience:1,Experience again:1,again It’s:1,between knowing:1,which flaws:1,flaws like:1,like small:1,small texture:1,texture shifts:1,shifts can:1,can reasonably:1,reasonably be:1,which like:1,like those:1,that produce:1,produce gaps:1,avoided at:1,costs Texture:1,Mapping Orientation:1,Orientation Independence:1,Independence The:1,The double-DDA:1,double-DDA texture-mapping:1,chapter worked:1,worked adequately:1,adequately but:1,were two:1,that left:1,left me:1,than satisfied:1,satisfied One:1,One flaw:1,was performance:1,other flaw:1,way textures:1,textures shifted:1,shifted noticeably:1,noticeably as:1,orientations of:1,polygons onto:1,onto which:1,were mapped:1,mapped changed:1,code followed:1,inside/outside rule:1,map were:1,mapped Pixels:1,Pixels that:1,and top:1,top destination:1,be inside:1,and pixels:1,outside That’s:1,copying texture:1,maps it:1,it causes:1,causes different:1,be omitted:1,omitted depending:1,destination orientation:1,orientation because:1,because different:1,map correspond:1,edges depending:1,current rotation:1,rotation Also:1,code truncated:1,truncated to:1,get integer:1,integer source:1,This together:1,orientation problem:1,problem meant:1,texture turned:1,turned upside:1,upside down:1,down it:1,it slowed:1,slowed one:1,new row:1,new column:1,next row:1,and column:1,This asymmetry:1,asymmetry was:1,quite visible:1,effect Figure:1,math Figure:1,math Listing:1,57.1 is:1,one solution:1,problems This:1,the equivalently:1,equivalently named:1,named function:1,function presented:1,disk makes:1,inside/outside rules:1,rules when:1,advances a:1,a half-step:1,half-step into:1,map before:1,so pixels:1,along all:1,are half:1,half included:1,included Rounding:1,Rounding rather:1,than truncation:1,truncation to:1,to texture-map:1,texture-map coordinates:1,also performed:1,map stays:1,stays pretty:1,much centered:1,centered within:1,destination rotates:1,rotates with:1,a much-reduced:1,much-reduced level:1,of orientation-dependent:1,orientation-dependent asymmetry:1,asymmetry Mapping:1,Textures across:1,across Multiple:1,Multiple Polygons:1,Polygons One:1,truly nifty:1,nifty things:1,about double-DDA:1,to mapping:1,texture can:1,mapped across:1,polygons simply:1,having polygons:1,3-space also:1,also share:1,map In:1,archive maps:1,polygons this:1,the blue-on-green:1,blue-on-green pattern:1,that stretches:1,stretches across:1,two panels:1,panels of:1,the spinning:1,spinning ball:1,ball This:1,This capability:1,capability makes:1,produce polygon-based:1,polygon-based objects:1,complex surfaces:1,as banding:1,banding and:1,and insignia:1,insignia on:1,on spaceships:1,spaceships or:1,even human:1,human figures:1,figures Just:1,Just map:1,desired texture:1,underlying polygonal:1,polygonal framework:1,let double-DDA:1,mapping do:1,rest Fast:1,Mapping Of:1,course there’s:1,with mapping:1,across many:1,polygons Texture:1,ball up:1,screen you’ll:1,ball slows:1,slows considerably:1,considerably whenever:1,texture swings:1,swings around:1,around into:1,view To:1,helped because:1,drawn independently:1,independently Nonetheless:1,Nonetheless we:1,certainly improve:1,deal over:1,over what:1,chapter By:1,large there:1,two keys:1,to improving:1,improving PC:1,graphics performance:1,The first—no:1,first—no surprise—is:1,surprise—is assembly:1,second without:1,without which:1,less effective:1,effective is:1,loops In:1,means understanding:1,the bottlenecks:1,bottlenecks are:1,57.1 Apart:1,language this:1,implementation improves:1,by focusing:1,on reducing:1,reducing inner:1,loop bottlenecks:1,bottlenecks In:1,for texture-mapped:1,single scan:1,line Most:1,polygon comes:1,in scanning:1,individual lines:1,lines though:1,appropriate place:1,optimize Within:1,Within Listing:1,57.2 all:1,draws across:1,line near:1,listing One:1,One optimization:1,is elimination:1,routine used:1,57.1 Function:1,Function calls:1,expensive operations:1,operations to:1,avoided when:1,matters Also:1,Also although:1,although Mode:1,mode X-Sharp:1,X-Sharp runs:1,in doesn’t:1,to pixel-oriented:1,pixel-oriented operations:1,like line:1,or texture:1,loop has:1,been set:1,minimize Mode:1,X’s overhead:1,A rotating:1,rotating plane:1,with DX:1,DX pointing:1,register thus:1,thus only:1,a rotate:1,OUT are:1,write cycling:1,through plane:1,and wrapping:1,0 Better:1,yet because:1,we’re simply:1,simply stepping:1,stepping horizontally:1,clever optimization:1,both step:1,and reduce:1,mask Two:1,Two copies:1,copies of:1,current plane:1,mask are:1,are maintained:1,maintained one:1,each nibble:1,AL The:1,register pays:1,pays attention:1,attention only:1,nibble Then:1,Then when:1,one copy:1,rotates out:1,nibble the:1,other copy:1,rotates into:1,nibble and:1,approach eliminates:1,mask wrapping:1,wrapping from:1,carry is:1,when wrapping:1,wrapping occurs:1,occurs and:1,that carry:1,carry can:1,screen pointer:1,pointer Check:1,chapter however:1,however to:1,best Map:1,Mask optimization:1,of all—setting:1,all—setting it:1,it once:1,and leaving:1,full calculation:1,screen address:1,branches This:1,converting full:1,full from-scratch:1,from-scratch calculations:1,to incremental:1,incremental processing:1,whereby only:1,only information:1,last operation:1,operation the:1,mask moving:1,pixel for:1,is recalculated:1,recalculated Incremental:1,Incremental processing:1,knowing where:1,go are:1,both important:1,57.2 speeding:1,the retrieval:1,retrieval of:1,This operation:1,operation looks:1,efficient in:1,57.1 consisting:1,macro GET:1,GET IMAGE-PIXEL:1,IMAGE-PIXEL However:1,those adds:1,adds are:1,are fixed-point:1,fixed-point adds:1,adds so:1,take four:1,instructions apiece:1,apiece and:1,macro hides:1,hides not:1,only conversion:1,from fixed-point:1,fixed-point to:1,integer but:1,a time-consuming:1,time-consuming multiplication:1,multiplication Incremental:1,Incremental approaches:1,are excellent:1,excellent at:1,at avoiding:1,avoiding multiplication:1,multiplication because:1,because cumulative:1,cumulative additions:1,additions can:1,often replace:1,replace multiplication:1,multiplication That’s:1,with stepping:1,texture in:1,57.2 ten:1,ten instructions:1,two branches:1,branches replace:1,replace all:1,texture calculations:1,57.2 simply:1,simply detects:1,detects when:1,source x:1,or y:1,coordinate turns:1,pointer accordingly:1,accordingly As:1,expect all:1,this optimization:1,pretty hard:1,57.2 much:1,57.1 Is:1,trouble Indeed:1,57.1 and:1,when large:1,large texture-mapped:1,texture-mapped areas:1,areas are:1,are animated:1,animated Whether:1,Whether more:1,doubling performance:1,significant is:1,opinion I:1,suppose but:1,but imagine:1,in William:1,William Gibson’s:1,Gibson’s Neuromancer:1,Neuromancer trying:1,to crack:1,crack a:1,a corporate:1,corporate database:1,database Which:1,Which texture-mapping:1,texture-mapping routine:1,you rather:1,rather have:1,have interfacing:1,interfacing you:1,to Cyberspace:1,Cyberspace I’m:1,I’m always:1,always interested:1,getting your:1,your feedback:1,feedback on:1,and hearing:1,hearing about:1,about potential:1,potential improvements:1,improvements to:1,X-Sharp Contact:1,Contact me:1,publisher There:1,no truth:1,truth to:1,the rumor:1,rumor that:1,reached under:1,the alias:1,alias sheep-shearer:1,sheep-shearer at:1,another 9999:1,9999 sheep:1,sheep Chapter:1,Chapter 58:1,58 Heinlein’s:1,Heinlein’s Crystal:1,Crystal Ball:1,Ball Spock’s:1,Brain and:1,the 9-Cycle:1,9-Cycle Dare:1,Dare Using:1,the Whole-Brain:1,Whole-Brain Approach:1,to Accelerate:1,Accelerate Texture:1,Mapping I’ve:1,pleasure recently:1,of rereading:1,rereading several:1,several of:1,the works:1,works of:1,of Robert:1,A Heinlein:1,Heinlein and:1,I’m as:1,as impressed:1,impressed as:1,a teenager—but:1,teenager—but in:1,time around:1,was wowed:1,wowed by:1,sheer romance:1,romance of:1,of technology:1,technology married:1,married to:1,to powerful:1,powerful stories:1,stories this:1,time I’m:1,I’m struck:1,struck most:1,The Master’s:1,Master’s remarkable:1,remarkable prescience:1,prescience Blowups:1,Happen is:1,the risks:1,risks of:1,power and:1,their effects:1,on human:1,human psychology—written:1,psychology—written before:1,a chain:1,chain reaction:1,reaction had:1,happened on:1,this planet:1,planet Solution:1,Unsatisfactory is:1,the unsolvable:1,unsolvable dilemma—ultimate:1,dilemma—ultimate offense:1,offense no:1,no defense—posed:1,defense—posed by:1,by atomic:1,atomic weapons:1,weapons this:1,in 1941:1,1941 And:1,Planets 1951:1,1951 consider:1,this minor:1,minor bit:1,The doctor’s:1,doctor’s phone:1,phone regretted:1,regretted politely:1,politely that:1,that Dr:1,Dr Jefferson:1,Jefferson was:1,home and:1,and requested:1,requested him:1,message He:1,was dictating:1,dictating it:1,warm voice:1,voice interrupted:1,interrupted I’m:1,I’m at:1,you Donald:1,Donald Where:1,Where are:1,you lad:1,lad Predicting:1,Predicting the:1,of answering:1,answering machines:1,machines is:1,so remarkable:1,remarkable but:1,but foreseeing:1,foreseeing that:1,for call:1,call screening:1,screening is:1,is technology:1,to extrapolate:1,extrapolate than:1,are social:1,social patterns:1,patterns Even:1,so Heinlein:1,no prophet:1,prophet his:1,his crystal:1,crystal ball:1,ball was:1,less fuzzy:1,fuzzy than:1,than ours:1,ours The:1,The aforementioned:1,aforementioned call:1,Planets was:1,was placed:1,a viewphone:1,viewphone while:1,that technology:1,technology has:1,has indeed:1,indeed come:1,pass its:1,its widespread:1,use has:1,ultimate weapon:1,weapon in:1,in Solution:1,Unsatisfactory was:1,was radioactive:1,radioactive dust:1,dust not:1,not nuclear:1,nuclear bombs:1,bombs and:1,have somehow:1,somehow survived:1,survived nearly:1,50 years:1,nuclear weapons:1,weapons without:1,either acquiring:1,acquiring a:1,world dictator:1,dictator or:1,or destroying:1,destroying ourselves:1,ourselves Slide:1,Slide rules:1,rules are:1,in Heinlein’s:1,Heinlein’s works:1,one story:1,story the:1,name now:1,now lost:1,memory an:1,an astronaut:1,astronaut straps:1,straps himself:1,himself into:1,massive integral:1,integral calculator:1,calculator computers:1,are nowhere:1,nowhere to:1,found Most:1,Most telling:1,telling I:1,think is:1,in Blowups:1,Happen the:1,engineers running:1,power plant—at:1,plant—at considerable:1,both body:1,body and:1,and sanity—are:1,sanity—are the:1,best highly:1,highly skilled:1,skilled in:1,in math:1,and required:1,to ride:1,ride the:1,nuclear reaction:1,reaction on:1,a second-to-second:1,second-to-second basis:1,basis with:1,explosion that:1,might end:1,end life:1,on Earth:1,surely kill:1,kill them:1,they slip:1,slip Contrast:1,our present-day:1,present-day reality:1,reality of:1,nuclear plants:1,plants run:1,by generally:1,generally competent:1,competent technicians:1,technicians with:1,occasional report:1,report of:1,of shoddy:1,shoddy maintenance:1,and bored:1,bored power-plant:1,power-plant employees:1,employees using:1,using drugs:1,drugs playing:1,playing games:1,and falling:1,falling asleep:1,asleep while:1,on duty:1,duty Heinlein’s:1,Heinlein’s universe:1,universe makes:1,better story:1,it shows:1,the filters:1,filters and:1,and biases:1,biases through:1,he viewed:1,world At:1,print Heinlein:1,an unwavering:1,unwavering believer:1,believer in:1,in science:1,science technology:1,and rationality:1,rationality and:1,his stories:1,stories it:1,usually the:1,and scientists:1,scientists who:1,the heroes:1,heroes and:1,and push:1,push civilization:1,civilization forward:1,forward often:1,often kicking:1,kicking and:1,and screaming:1,screaming In:1,world I:1,have rarely:1,rarely observed:1,observed that:1,case But:1,But of:1,course Heinlein:1,was hardly:1,hardly the:1,only person:1,have his:1,her perceptions:1,perceptions of:1,universe past:1,past present:1,present or:1,or future:1,future blurred:1,blurred by:1,by his:1,his built-in:1,built-in assumptions:1,assumptions you:1,also on:1,that list—and:1,list—and probably:1,probably pretty:1,top at:1,that Performance:1,Performance programming:1,specific special-casing:1,special-casing the:1,more The:1,The greatest:1,greatest impediment:1,impediment to:1,is seeing:1,code currently:1,currently does:1,does or:1,know thereby:1,thereby ignoring:1,ignoring many:1,possible solutions:1,solutions Put:1,way how:1,problem determines:1,you’ll solve:1,it your:1,your assumptions:1,assumptions may:1,may speed:1,also your:1,your limitations:1,limitations Consider:1,example how:1,a seemingly:1,seemingly intractable:1,intractable problem:1,becomes eminently:1,eminently tractable:1,tractable the:1,instant you:1,else has:1,has solved:1,solved it:1,As Exhibit:1,Exhibit 1:1,present my:1,with speeding:1,mapper in:1,X-Sharp Texture:1,Mapping Redux:1,Redux We’ve:1,We’ve spent:1,previous several:1,X Sharp:1,Sharp graphics:1,library something:1,I built:1,built over:1,serious exercise:1,graphics When:1,When X-Sharp:1,X-Sharp reached:1,left it:1,was rather:1,rather pleased:1,with it—with:1,it—with one:1,exception My:1,My last:1,last addition:1,X-Sharp was:1,mapper a:1,that warped:1,warped and:1,and rotated:1,rotated any:1,desired bitmap:1,map onto:1,arbitrary convex:1,polygon Texture:1,Texture mappers:1,mappers are:1,are critical:1,games just:1,few texture-mapped:1,polygons backed:1,backed with:1,with well-drawn:1,well-drawn bitmaps:1,represent more:1,look more:1,realistic than:1,than dozens:1,even hundreds:1,of solid-color:1,solid-color polygons:1,polygons My:1,My X-Sharp:1,X-Sharp texture:1,in reasonable:1,reasonable assembly—pretty:1,assembly—pretty good:1,by most:1,most standards:1,standards and:1,felt comfortable:1,my implementation:1,Miles who:1,time getting:1,getting seriously:1,seriously into:1,game library:1,library Yes:1,Yes you:1,can license:1,license it:1,his company:1,company Non-Linear:1,Non-Linear Arts:1,Arts if:1,if you’d:1,you’d like:1,like John:1,John can:1,reached at:1,at 70322.2457@compuserve.com:1,70322.2457@compuserve.com John:1,follows Hmm:1,Hmm so:1,how texture-mapping:1,texture-mapping works:1,works But:1,But 3:1,3 jumps:1,jumps per:1,pixel Hmph:1,Hmph It:1,the Hmph:1,Hmph that:1,really got:1,me Left-Brain:1,Left-Brain Optimization:1,Optimization That:1,first shot:1,of juice:1,juice for:1,my optimizer:1,optimizer or:1,least blow:1,blow to:1,my ego:1,ego which:1,as productive:1,productive John:1,John went:1,gotten texture:1,mapping down:1,one jump:1,jump per:1,scanline on:1,all cycle:1,times will:1,486 unless:1,unless otherwise:1,otherwise noted:1,noted given:1,about 44:1,2 taken:1,taken jumps:1,jumps plus:1,1 not:1,not taken:1,taken per:1,pixel I:1,original texture-mapping:1,58.1 All:1,single texture-mapped:1,texture-mapped scanline:1,scanline as:1,58.1 an:1,an outer:1,outer loop:1,loop runs:1,runs through:1,the scanlines:1,scanlines in:1,whatever polygon:1,drawn I:1,immediately saw:1,eliminate nearly:1,nearly 10:1,loop obviously:1,obviously John:1,that else:1,else there’s:1,way he:1,could branch:1,branch only:1,scanline By:1,way branching:1,branching only:1,scanline via:1,not generally:1,generally recommended:1,recommended A:1,A branch:1,pixels costs:1,costs relatively:1,unrolled code:1,quickly came:1,but soon:1,soon realized:1,world wasn’t:1,wasn’t going:1,me within:1,within 100:1,John’s performance:1,cycle from:1,next for:1,58.2 shows:1,shows why:1,this cycling:1,necessary In:1,In Mode:1,page-flipped 256-color:1,VGA each:1,successive pixel:1,scanline is:1,different hardware:1,hardware plane:1,plane being:1,to See:1,See Chapters:1,49 for:1,details An:1,An OUT:1,itself takes:1,virtual-86 or:1,or non-privileged:1,non-privileged protected:1,an ROL:1,ROL takes:1,of 18:1,18 cycles:1,cycles double:1,double John’s:1,handle plane:1,plane management:1,management Clearly:1,Clearly getting:1,getting plane:1,loop was:1,was absolutely:1,necessary Figure:1,X Figure:1,X I:1,must confess:1,confess with:1,some embarrassment:1,embarrassment that:1,I threw:1,threw myself:1,myself into:1,into designing:1,that involved:1,involved executing:1,scanline once:1,plane It’s:1,to overstate:1,overstate the:1,involves quadrupling:1,quadrupling the:1,normal pixel-to-pixel:1,pixel-to-pixel increments:1,increments adjusting:1,start value:1,the passes:1,passes and:1,and dealing:1,some nasty:1,nasty boundary:1,cases Make:1,mistake the:1,perfectly doable:1,doable and:1,gotten plane:1,get exactly:1,from substantial:1,substantial overhead:1,overhead Fortunately:1,Fortunately in:1,last sentence:1,sentence I:1,say would:1,not was:1,because my:1,Hecker checker@bix.com:1,checker@bix.com came:1,to toss:1,toss a:1,a figurative:1,figurative bucket:1,of cold:1,cold water:1,water on:1,my right:1,brain which:1,was evidently:1,evidently asleep:1,asleep Or:1,Or possibly:1,possibly stolen:1,stolen by:1,by scantily-clad:1,scantily-clad attractive:1,attractive aliens:1,aliens remember:1,remember Spock’s:1,Brain Chris:1,Chris is:1,WinG Windows:1,Windows game:1,game graphics:1,graphics package:1,package available:1,Microsoft via:1,via FTP:1,FTP CompuServe:1,CompuServe or:1,or MSDN:1,MSDN Level:1,2 if:1,if like:1,like me:1,me you:1,in April:1,April 1994:1,1994 you:1,you along:1,with everyone:1,else were:1,were stunned:1,stunned to:1,see Id’s:1,Id’s megahit:1,DOOM running:1,speed in:1,window thanks:1,to WinG:1,WinG If:1,living run:1,run don’t:1,don’t walk:1,walk to:1,check WinG:1,WinG out:1,Chris listened:1,my proposed:1,proposed design:1,design for:1,of maybe:1,maybe 30:1,30 seconds:1,seconds growing:1,growing visibly:1,visibly more:1,more horrified:1,horrified by:1,moment before:1,before he:1,just draw:1,draw vertical:1,vertical rather:1,horizontal scanlines:1,scanlines Why:1,Why indeed:1,A 90-Degree:1,90-Degree Shift:1,Shift in:1,in Perspective:1,Perspective As:1,earlier how:1,problem defines:1,defines how:1,performance sometimes:1,things from:1,different angle—and:1,angle—and for:1,mapping this:1,was literally:1,literally as:1,as figuratively:1,figuratively true:1,true Chris:1,Chris suggested:1,suggested nothing:1,more nor:1,nor less:1,than scanning:1,out polygons:1,90-degree angle:1,normal starting:1,starting say:1,and texture-mapping:1,texture-mapping vertically:1,vertically along:1,each column:1,58.3 That:1,each texture-mapped:1,texture-mapped column:1,column would:1,would need:1,change planes:1,planes only:1,only between:1,between columns—outside:1,columns—outside the:1,loop A:1,A trivial:1,trivial change:1,not fundamental:1,fundamental in:1,any sense—and:1,sense—and yet:1,yet just:1,change plus:1,plus unrolling:1,loop reduced:1,the 22-cycles-per-pixel:1,22-cycles-per-pixel version:1,version shown:1,58.2 That’s:1,Listing 58.1—and:1,58.1—and given:1,how incredibly:1,slow most:1,at completing:1,completing OUT:1,s the:1,the real-world:1,real-world speedup:1,speedup should:1,greater still:1,fastest byte:1,OUT I’ve:1,ever measured:1,is 29:1,29 cycles:1,slowest more:1,case Listing:1,58.2 would:1,58.1 I’d:1,to emphasize:1,emphasize that:1,that algorithmically:1,algorithmically and:1,and conceptually:1,conceptually there:1,no difference:1,between scanning:1,polygon top:1,top to:1,to bottom:1,scanning it:1,out left:1,right it:1,hardware organization:1,X that:1,scanning direction:1,direction matters:1,least That’s:1,what Zen:1,Zen programming:1,about though:1,though tying:1,tying together:1,together two:1,seemingly unrelated:1,unrelated information:1,good effect—and:1,effect—and that’s:1,do Like:1,Like Robert:1,Robert Heinlein—like:1,Heinlein—like all:1,of us—I:1,us—I had:1,had viewed:1,world through:1,a filter:1,filter composed:1,my ingrained:1,ingrained assumptions:1,my past:1,experience was:1,processing proceeds:1,proceeds left:1,right Eventually:1,would only:1,when and:1,I relaxed:1,and stepped:1,and allowed:1,allowed myself—almost:1,myself—almost dared:1,dared myself—to:1,myself—to think:1,optimizing be:1,leave quiet:1,quiet nondirected:1,nondirected time:1,to conjure:1,conjure up:1,up those:1,those less:1,obvious solutions:1,solutions and:1,and periodically:1,periodically try:1,what assumptions:1,assumptions you’re:1,you’re making—and:1,making—and then:1,then question:1,question them:1,column Figure:1,column There:1,complications with:1,approach not:1,that X-Sharp’s:1,X-Sharp’s polygon-filling:1,polygon-filling convention:1,convention top:1,edges included:1,included bottom:1,edges excluded:1,excluded is:1,reproduce for:1,for column-oriented:1,mapping I:1,I solved:1,version 22:1,22 by:1,allow column-oriented:1,current convention:1,convention You’ll:1,find X-Sharp:1,X-Sharp 22:1,22 on:1,diskette in:1,chapter Chris:1,Chris also:1,also illustrated:1,illustrated another:1,important principle:1,optimization A:1,second pair:1,of eyes:1,eyes is:1,is invaluable:1,invaluable Even:1,us have:1,have blind:1,blind spots:1,spots and:1,get caught:1,particular implementations:1,implementations if:1,you bounce:1,bounce your:1,ideas off:1,off someone:1,them coming:1,coming back:1,back with:1,an unexpected—and:1,unexpected—and welcome—spin:1,welcome—spin That’s:1,That’s Nice—But:1,Nice—But it:1,Sure as:1,as Heck:1,Heck Ain’t:1,Ain’t 9:1,9 Cycles:1,Cycles Excellent:1,Excellent as:1,as Chris’s:1,Chris’s suggestion:1,still had:1,had work:1,do Listing:1,58.2 is:1,John Miles’s:1,Miles’s code:1,code Traditionally:1,Traditionally I:1,with algorithmic:1,algorithmic optimization:1,then try:1,tie the:1,hardware together:1,together for:1,maximum efficiency:1,efficiency and:1,with instruction-by-instruction:1,instruction-by-instruction take-no-prisoners:1,take-no-prisoners optimization:1,optimization We’ve:1,two steps:1,steps so:1,metal Listing:1,58.2 contains:1,three functional:1,functional parts:1,parts Drawing:1,pixel advancing:1,pointer Each:1,three parts:1,parts is:1,is amenable:1,further acceleration:1,acceleration Drawing:1,up given:1,two instructions—difficult:1,instructions—difficult but:1,not impossible:1,impossible True:1,indeed irreducible:1,irreducible but:1,the ES:1,ES prefix:1,prefix and:1,see we:1,can rearrange:1,Pentium Without:1,Without a:1,prefix the:1,follows on:1,Pentium cb358-1:1,cb358-1 MOV:1,MOV AH:1,AH BX:1,BX cycle:1,1 U-pipe:1,U-pipe cb358-2:1,cb358-2 cycle:1,1 V-pipe:1,idle reg:1,reg contention:1,contention cb358-3:1,cb358-3 MOV:1,MOV DI:1,DI AH:1,AH cycle:1,cycle 2:1,2 U-pipe:1,second MOV:1,MOV being:1,being dependent:1,value loaded:1,AH by:1,MOV can’t:1,finished so:1,pipe the:1,V-pipe lies:1,cycle We:1,can reclaim:1,reclaim that:1,cycle simply:1,shuffling another:1,s Advancing:1,up Just:1,Just build:1,next into:1,each pixel-drawing:1,pixel-drawing instruction:1,constant as:1,in cb359-1:1,cb359-1 MOV:1,MOV EDI:1,EDI SCANOFFSET:1,SCANOFFSET AH:1,advance EDI:1,EDI only:1,per unrolled:1,iteration Advancing:1,but correspondingly:1,more rewarding:1,rewarding Listing:1,58.2 uses:1,variant form:1,and increments:1,increments stored:1,in 16.16:1,integer 16:1,fraction format:1,format The:1,The source:1,slightly unusual:1,unusual format:1,format whereby:1,stored and:1,and advanced:1,advanced separately:1,separately but:1,reflect both:1,58.2 the:1,and fractional:1,added into:1,current coordinates:1,and carries:1,carries from:1,from fractional:1,fractional to:1,are detected:1,detected via:1,via conditional:1,58.4 There’s:1,There’s quite:1,lot we:1,pointer First:1,can sum:1,amounts outside:1,them both:1,both to:1,instruction Second:1,can recognize:1,recognize that:1,advances exactly:1,byte when:1,its fractional:1,use ADC:1,X carries:1,carries as:1,58.5 That:1,That single:1,single ADC:1,ADC can:1,in not:1,only any:1,any X:1,X carry:1,carry but:1,amounts as:1,the source-advance:1,source-advance code:1,58.2 Furthermore:1,Furthermore we:1,should somehow:1,somehow be:1,use 32-bit:1,help with:1,arithmetic true:1,true the:1,size override:1,override prefix:1,prefix because:1,will cost:1,per 32-bit:1,32-bit instruction:1,that’s better:1,do 32-bit:1,32-bit arithmetic:1,arithmetic with:1,instructions It:1,isn’t obvious:1,nifty trick:1,trick we:1,use here:1,here again:1,again courtesy:1,of Chris:1,Hecker who:1,who as:1,tell has:1,mapping We:1,current fractional:1,Y source:1,single 32-bit:1,register EDX:1,EDX as:1,58.6 It’s:1,fraction is:1,15 bits:1,EDX always:1,always kept:1,zero this:1,allows bit:1,each Y:1,advance We:1,similarly store:1,in ECX:1,ECX and:1,in BP:1,BP With:1,this arrangement:1,arrangement the:1,EDXECX advances:1,instruction ADC:1,ADC SIBP:1,SIBP finishes:1,finishes advancing:1,X That’s:1,mere 3:1,remains is:1,finish advancing:1,register Actually:1,also advanced:1,advanced the:1,integer amount:1,amount back:1,added BP:1,BP to:1,to SI:1,SI all:1,that’s left:1,detect whether:1,whether our:1,our addition:1,fractional current:1,current coordinate:1,coordinate produced:1,produced a:1,carry That’s:1,by testing:1,testing bit:1,EDX if:1,zero there:1,no carry:1,carry and:1,otherwise Y:1,Y carried:1,carried so:1,reset bit:1,scanline The:1,program flow:1,flow is:1,Figure 58.7:1,58.7 Note:1,X fractional:1,addition we:1,just adding:1,addition because:1,fraction carries:1,carries it:1,it indicates:1,indicates a:1,a move:1,move not:1,next on:1,scanline a:1,byte but:1,next a:1,full scanline:1,scanline width:1,width All:1,optimizations together:1,together get:1,cycles very:1,Miles but:1,yet We:1,more trick:1,trick up:1,our sleeve:1,sleeve though:1,though Suppose:1,Suppose we:1,we point:1,point SS:1,SS to:1,segment containing:1,containing our:1,our textures:1,and point:1,point DS:1,DS to:1,texture segment:1,or ensuring:1,other stack:1,stack activity:1,activity can’t:1,while SS:1,SS points:1,that segment:1,segment Then:1,could swap:1,functions of:1,of SI:1,and BP:1,BP that:1,BP which:1,accesses SS:1,SS by:1,the screen—all:1,screen—all with:1,no segment:1,segment prefixes:1,prefixes at:1,gosh that:1,would bring:1,bring us:1,us down:1,same 9:1,cycles John:1,Miles attained:1,attained Listing:1,58.3 shows:1,last the:1,the Holy:1,Holy Grail:1,Grail attained:1,attained and:1,our honor:1,honor defended:1,defended we:1,can rest:1,Or can:1,we Don’t:1,Don’t Stop:1,Stop Thinking:1,Thinking about:1,about Those:1,Those Cycles:1,Cycles Remember:1,Remember what:1,that knowing:1,knowing something:1,something has:1,done makes:1,do A:1,that pushing:1,pushing past:1,past that:1,point once:1,once attained:1,attained is:1,difficult It’s:1,only natural:1,natural to:1,to relax:1,relax in:1,job well:1,too the:1,work changes:1,changes Getting:1,Getting from:1,from 44:1,cycles down:1,to John’s:1,cycles was:1,huge leap:1,leap but:1,be done—therefore:1,done—therefore the:1,cases like:1,we’re sharp:1,sharp enough:1,are we’re:1,guaranteed eventual:1,eventual gratification:1,gratification Now:1,we’ve reached:1,reached John’s:1,John’s level:1,becomes whether:1,yet and:1,altogether for:1,after thinking:1,while we’ll:1,we’ll conclude:1,can’t Not:1,have wasted:1,also never:1,sure we:1,were right:1,right we’ll:1,know only:1,we couldn’t:1,solution That:1,way lies:1,lies madness:1,madness And:1,yet someone:1,someone has:1,to blaze:1,blaze the:1,the trail:1,trail to:1,to higher:1,higher performance:1,someone might:1,be us:1,us Let’s:1,for weaknesses:1,weaknesses in:1,58.3 None:1,None are:1,are readily:1,apparent the:1,only cycle:1,looks even:1,even slightly:1,slightly wasted:1,wasted is:1,EDXECX As:1,cycle really:1,is wasted:1,wasted for:1,for there’s:1,prefix vanish:1,vanish without:1,instructions Move:1,instructions 32-bit:1,32-bit That’s:1,58.4 does:1,58.3 but:1,but runs:1,a 12.5:1,12.5 percent:1,58.3 Whether:1,Whether Listing:1,58.4 actually:1,actually draws:1,draws more:1,second than:1,58.3 depends:1,whether display:1,handle pixels:1,58.4 can:1,can deliver:1,deliver them:1,That speed:1,speed one:1,pixel every:1,every 122:1,122 nanoseconds:1,nanoseconds on:1,a 486/66:1,486/66 is:1,that ISA:1,ISA adapters:1,can’t hope:1,but fast:1,PCI adapters:1,handle with:1,with ease:1,ease Be:1,aware too:1,too that:1,that cache:1,generally reduce:1,performance below:1,calculated 8-cycles-per-pixel:1,8-cycles-per-pixel level:1,level especially:1,because textures:1,textures which:1,be scanned:1,scanned across:1,across at:1,angle are:1,are rarely:1,rarely accessed:1,accessed at:1,at consecutive:1,consecutive addresses:1,addresses which:1,the arrangement:1,arrangement that:1,fewest cache:1,misses And:1,A five:1,to 10-times:1,10-times speedup:1,decent assembly:1,language texture:1,mapper All:1,took was:1,some help:1,my friends:1,friends a:1,good stiff:1,stiff jolt:1,jolt of:1,of right-brain:1,right-brain thinking:1,some solid:1,solid left-brain:1,left-brain polishing—plus:1,polishing—plus the:1,speedup was:1,was possible:1,possible Treat:1,Treat every:1,every optimization:1,optimization task:1,task as:1,if John:1,Miles has:1,to inform:1,inform you:1,he’s made:1,your wildest:1,wildest dreams:1,dreams and:1,do Texture:1,Mapping Notes:1,Notes Listing:1,58.3 contains:1,no 486:1,stalls it:1,has Pentium:1,much can:1,EDXECX which:1,58.4 on:1,been rearranged:1,rearranged to:1,stalls save:1,one When:1,coordinate fractional:1,ESI advances:1,executes as:1,follows However:1,don’t see:1,see any:1,eliminate this:1,last AGI:1,AGI which:1,which happens:1,happens about:1,Pentium execution:1,58.4 is:1,is 5.5:1,5.5 cycles:1,cycles That’s:1,That’s 61:1,61 nanoseconds—a:1,nanoseconds—a highly:1,highly respectable:1,respectable 16:1,million texture-mapped:1,texture-mapped pixels:1,per second—on:1,second—on a:1,a 90:1,90 MHz:1,mapping discussed:1,both this:1,chapters doesn’t:1,correction when:1,textures Why:1,Why that:1,handle perspective:1,topic for:1,whole separate:1,some large:1,edges themselves:1,themselves drawn:1,be unnaturally:1,unnaturally bowed:1,bowed although:1,although small:1,look fine:1,fine Finally:1,we never:1,last jump:1,jump in:1,mapper yet:1,yet John:1,Miles claimed:1,claimed no:1,no jumps:1,jumps at:1,all How:1,How did:1,he do:1,a two-entry:1,two-entry look-up:1,Y carry:1,carry to:1,Y However:1,couldn’t come:1,any implementation:1,take 0.5:1,0.5 to:1,cycle more:1,the test-and-jump:1,test-and-jump approach:1,so either:1,either I:1,adequately efficient:1,table John:1,John saved:1,saved a:1,cycle somewhere:1,somewhere else:1,else or:1,or perhaps:1,perhaps John:1,John implemented:1,implemented his:1,but used:1,the less-efficient:1,less-efficient table:1,table in:1,his fervor:1,fervor to:1,final jump:1,jump The:1,The knowledge:1,I apparently:1,apparently came:1,different solution:1,solution than:1,than John:1,John highlights:1,highlights that:1,technical aspects:1,John’s implementation:1,implementation were:1,truth totally:1,totally irrelevant:1,my optimization:1,efforts the:1,only actual:1,actual effect:1,effect John’s:1,had on:1,me believe:1,believe a:1,mapper could:1,fast Believe:1,it give:1,give both:1,brain equal:1,equal time—and:1,time—and watch:1,for aliens:1,aliens in:1,short skirts:1,skirts 60’s:1,60’s bouffant:1,bouffant hairdos:1,hairdos and:1,an undue:1,undue interest:1,either half:1,half Chapter:1,59 The:1,The Idea:1,Idea of:1,Trees What:1,What BSP:1,Trees Are:1,Are and:1,and How:1,to Walk:1,Walk Them:1,Them The:1,is Wendy:1,Tucker The:1,question that:1,that answer:1,answer isn’t:1,interesting to:1,anyone but:1,but me—but:1,me—but the:1,spent many:1,my childhood:1,childhood summers:1,summers at:1,at Camp:1,Chingacook on:1,on Lake:1,Lake George:1,George in:1,York It:1,great place:1,some growing:1,growing up:1,with swimming:1,swimming and:1,and sailing:1,sailing and:1,and hiking:1,hiking and:1,was 14:1,14 Camp:1,Chingacook had:1,a mixer:1,mixer with:1,nearby girls:1,girls camp:1,camp As:1,As best:1,recall I:1,had any:1,in girls:1,girls before:1,before but:1,older kids:1,kids had:1,had paired:1,paired up:1,noticed a:1,pretty girl:1,girl looking:1,with considerable:1,considerable trepidation:1,trepidation I:1,I crossed:1,her To:1,my amazement:1,amazement we:1,we hit:1,hit it:1,off terrifically:1,terrifically We:1,We talked:1,talked non-stop:1,non-stop for:1,the evening:1,evening and:1,walked back:1,my cabin:1,cabin floating:1,floating on:1,on air:1,air I:1,a first:1,first tentative:1,tentative step:1,step into:1,into adulthood:1,adulthood and:1,my world:1,same That:1,ever saw:1,saw her:1,her although:1,would occasionally:1,occasionally remember:1,that warm:1,warm glow:1,glow and:1,call up:1,her smiling:1,smiling face:1,face That:1,That happened:1,happened less:1,less frequently:1,years passed:1,had real:1,real girlfriends:1,girlfriends and:1,got married:1,married that:1,particular memory:1,was stashed:1,stashed in:1,some back:1,storeroom of:1,mind I:1,didn’t think:1,her again:1,decade A:1,ago for:1,that mixer:1,mixer popped:1,asleep And:1,wondered for:1,years what:1,that girl’s:1,girl’s name:1,was The:1,The name:1,mind somewhere:1,somewhere I:1,could feel:1,feel the:1,same back:1,storeroom if:1,only I:1,could figure:1,retrieve it:1,I poked:1,poked and:1,and worried:1,worried at:1,memory trying:1,I concentrated:1,concentrated on:1,as hard:1,even started:1,started going:1,the alphabet:1,alphabet one:1,one letter:1,letter at:1,remember if:1,if her:1,her name:1,name started:1,each letter:1,letter After:1,After 15:1,wide awake:1,awake and:1,and totally:1,totally frustrated:1,frustrated I:1,also farther:1,ever from:1,from answering:1,answering the:1,question all:1,the focusing:1,was beginning:1,to blur:1,blur the:1,original imprint:1,imprint At:1,I consciously:1,consciously relaxed:1,made myself:1,myself think:1,about something:1,something completely:1,different Every:1,Every time:1,mind returned:1,mystery girl:1,girl I:1,I gently:1,gently shifted:1,shifted it:1,something else:1,else After:1,to drift:1,drift off:1,sleep and:1,a connection:1,connection was:1,name popped:1,popped unbidden:1,unbidden into:1,mind Wendy:1,Tucker There:1,are amenable:1,the straight-ahead:1,straight-ahead purely:1,purely conscious:1,conscious sort:1,of approach:1,first tried:1,retrieve Wendy’s:1,name Writing:1,code once:1,once it’s:1,it’s designed:1,designed is:1,often like:1,debugging technical:1,technical writing:1,and balancing:1,checkbook I:1,personally find:1,these left-brain:1,left-brain activities:1,activities to:1,very appealing:1,they’re finite:1,finite and:1,and controllable:1,controllable when:1,start one:1,know I’ll:1,make good:1,good progress:1,progress just:1,by plowing:1,plowing along:1,along Inspiration:1,Inspiration and:1,leaps are:1,required The:1,neither you:1,you nor:1,nor I:1,anything great:1,great without:1,without inspiration:1,inspiration and:1,leaps and:1,especially not:1,without stepping:1,stepping away:1,from what’s:1,and venturing:1,venturing into:1,into territories:1,territories beyond:1,beyond The:1,trying harder:1,harder but:1,but paradoxically:1,paradoxically by:1,trying less:1,less hard:1,hard stepping:1,and giving:1,giving your:1,brain room:1,work then:1,then listening:1,and nurturing:1,nurturing whatever:1,comes of:1,that On:1,small scale:1,I remembered:1,remembered Wendy’s:1,name and:1,larger scale:1,how programmers:1,programmers come:1,with products:1,products that:1,than me-too:1,me-too checklist-oriented:1,checklist-oriented software:1,software Which:1,Which for:1,reasons brings:1,topic Binary:1,Partitioning BSP:1,First games:1,are probably:1,probably the:1,the right-brain:1,right-brain element:1,most important—blockbuster:1,important—blockbuster games:1,always breakthroughs:1,or another—and:1,another—and some:1,successful games:1,trees most:1,notably id:1,Software’s megahit:1,DOOM Second:1,Second BSP:1,aren’t intuitively:1,intuitively easy:1,grasp and:1,and considerable:1,considerable ingenuity:1,and inventiveness:1,inventiveness is:1,most from:1,them Before:1,technical wizard:1,wizard behind:1,for generously:1,generously sharing:1,sharing his:1,his knowledge:1,trees with:1,me BSP:1,Trees A:1,A BSP:1,heart nothing:1,isolate features:1,interest Each:1,Each node:1,tree splits:1,splits an:1,a volume:1,volume in:1,or 3-D:1,3-D respectively:1,respectively into:1,parts along:1,plane thus:1,thus the:1,name Binary:1,Partitioning The:1,The subdivision:1,subdivision is:1,is hierarchical:1,hierarchical the:1,subspaces then:1,root’s two:1,children splits:1,splits one:1,parts This:1,subspace being:1,being further:1,further subdivided:1,subdivided until:1,interest each:1,example has:1,assigned its:1,pretty abstract:1,abstract description:1,description but:1,trees will:1,clearer shortly:1,shortly it:1,to glance:1,glance ahead:1,ahead to:1,chapter’s figures:1,figures Building:1,space doesn’t:1,doesn’t sound:1,profound but:1,lot that:1,structure BSP:1,represent shapes:1,shapes and:1,those shapes:1,shapes is:1,of combining:1,combining trees:1,needed this:1,trees a:1,powerful way:1,implement Constructive:1,Constructive Solid:1,Solid Geometry:1,Geometry CSG:1,CSG BSP:1,for hit:1,hit testing:1,testing line-of-sight:1,and collision:1,detection Visibility:1,Visibility Determination:1,Determination For:1,being I’m:1,trees The:1,arbitrary viewpoint:1,viewpoint This:1,of traversal:1,helpful in:1,in determining:1,which parts:1,are occluded:1,occluded from:1,3-D scene:1,scene Thus:1,Thus a:1,tree makes:1,possible an:1,algorithm whereby:1,whereby polygons:1,order with:1,with closer:1,closer polygons:1,polygons overwriting:1,overwriting more:1,distant ones:1,ones that:1,The line:1,segments in:1,Figure 1(a:1,1(a and:1,other figures:1,chapter represent:1,represent vertical:1,above Alternatively:1,Alternatively visibility:1,determination can:1,by front-to-back:1,traversal working:1,some method:1,for remembering:1,remembering which:1,pixels have:1,potential benefit:1,of allowing:1,allowing you:1,to early-out:1,early-out from:1,from traversal:1,database when:1,drawn Back-to-front:1,Back-to-front or:1,traversal in:1,in itself:1,itself wouldn’t:1,so impressive—there:1,impressive—there are:1,do that—were:1,that—were it:1,one additional:1,additional detail:1,The traversal:1,in linear:1,on For:1,can traverse:1,list back-to-front:1,back-to-front from:1,any viewpoint:1,viewpoint simply:1,by walking:1,corresponding BSP:1,tree once:1,once visiting:1,visiting each:1,node one:1,performing only:1,one relatively:1,relatively inexpensive:1,inexpensive test:1,test at:1,node It’s:1,get cheaper:1,cheaper sorting:1,sorting than:1,than linear:1,and BSP-based:1,rendering stacks:1,well against:1,against alternatives:1,alternatives such:1,as z-buffering:1,z-buffering octrees:1,octrees z-scan:1,z-scan sorting:1,polygon sorting:1,sorting Better:1,database represented:1,pyramid very:1,efficiently huge:1,be lopped:1,lopped off:1,off when:1,when clipping:1,pyramid because:1,entire area:1,node lies:1,lies entirely:1,volume then:1,all nodes:1,are children:1,node must:1,must likewise:1,likewise be:1,clear as:1,algorithm Limitations:1,Trees Powerful:1,Powerful as:1,are BSP:1,aren’t perfect:1,perfect By:1,By far:1,greatest limitation:1,they’re time-consuming:1,build enough:1,purposes BSP:1,trees must:1,be precalculated:1,precalculated and:1,and cannot:1,built dynamically:1,dynamically at:1,runtime In:1,perform some:1,some optimization:1,optimization limiting:1,split for:1,take minutes:1,minutes or:1,even hours:1,hours to:1,large world:1,world databases:1,databases A:1,A fixed:1,fixed world:1,for walkthrough:1,walkthrough or:1,or flythrough:1,flythrough applications:1,viewpoint moves:1,moves through:1,static scene:1,for games:1,games or:1,or virtual:1,virtual reality:1,reality where:1,objects constantly:1,constantly move:1,move relative:1,another Consequently:1,Consequently various:1,various workarounds:1,workarounds have:1,developed to:1,allow moving:1,BSP tree-based:1,tree-based scenes:1,scenes DOOM:1,example uses:1,uses 2-D:1,2-D sprites:1,sprites mixed:1,mixed into:1,into BSP-based:1,BSP-based 3-D:1,3-D scenes:1,scenes note:1,note though:1,requires maintaining:1,maintaining z:1,z information:1,information so:1,that sprites:1,sprites can:1,and occluded:1,occluded properly:1,properly Alternatively:1,Alternatively movable:1,movable objects:1,objects could:1,separate BSP:1,and merged:1,merged anew:1,anew into:1,move Dynamic:1,Dynamic merging:1,merging may:1,enough depending:1,but merging:1,merging BSP:1,trees tends:1,be quicker:1,quicker than:1,than building:1,building them:1,trees being:1,being merged:1,merged are:1,already spatially:1,spatially sorted:1,sorted Another:1,Another possibility:1,a per-pixel:1,per-pixel z-buffer:1,z-buffer for:1,it’s rendered:1,rendered to:1,allow dynamically:1,changing objects:1,the BSP-based:1,world In:1,scheme the:1,allow fast:1,fast traversal:1,complex static:1,static world:1,z-buffer would:1,would handle:1,relatively localized:1,localized visibility:1,determination involving:1,a memory-hungry:1,memory-hungry z-buffer:1,z-buffer a:1,typical 640x480:1,640x480 z-buffer:1,z-buffer requires:1,fairly appalling:1,appalling 600K:1,600K with:1,with equally:1,equally appalling:1,appalling cache-miss:1,cache-miss implications:1,performance Yet:1,each dynamic:1,dynamic object:1,object falls:1,static BSP:1,than straddling:1,straddling splitting:1,case dynamic:1,dynamic objects:1,as points:1,points which:1,then just:1,just sorted:1,tree on:1,they move:1,move The:1,other drawbacks:1,of are:1,tree which:1,which amounts:1,pointers per:1,relative complexity:1,debugging BSP-tree:1,BSP-tree compilation:1,and usage:1,usage debugging:1,debugging a:1,set being:1,being processed:1,by recursive:1,recursive code:1,BSP code:1,be can:1,challenge Tools:1,Tools like:1,chapter which:1,which visually:1,of spatial:1,spatial subdivision:1,subdivision as:1,constructed help:1,BSP debugging:1,debugging Building:1,Tree Now:1,bit about:1,helps in:1,in visible:1,its strengths:1,weaknesses are:1,are let’s:1,tree actually:1,works to:1,provide front-to-back:1,back-to-front ordering:1,ordering This:1,into mechanisms:1,mechanisms and:1,details I’m:1,trees from:1,out because:1,grasp than:1,3-D counterparts:1,counterparts Don’t:1,worry though:1,of 2-D:1,using line:1,segments generalize:1,generalize directly:1,using polygons:1,polygons Also:1,Also 2-D:1,quite powerful:1,own right:1,by DOOM:1,DOOM which:1,around 2-D:1,let’s construct:1,simple BSP:1,59.2 shows:1,four lines:1,will constitute:1,constitute our:1,our sample:1,sample world:1,world I’ll:1,these as:1,as walls:1,walls because:1,one easily-visualized:1,easily-visualized context:1,game Think:1,59.2 as:1,as depicting:1,depicting vertical:1,they’re lines:1,wall has:1,side denoted:1,a back:1,side To:1,this sample:1,set we:1,two then:1,part into:1,two again:1,wall resides:1,subspace An:1,obvious question:1,how should:1,we carve:1,59.2 Figure:1,above Figure:1,above There:1,infinitely valid:1,valid ways:1,up Figure:1,simplest is:1,carve along:1,walls themselves:1,themselves with:1,containing one:1,wall This:1,necessarily optimal:1,optimal in:1,producing the:1,smallest tree:1,the virtue:1,generating the:1,lines without:1,without expensive:1,expensive analysis:1,analysis It:1,also saves:1,saves on:1,on data:1,data storage:1,storage because:1,do double:1,double duty:1,duty in:1,in describing:1,well Putting:1,Putting one:1,wall on:1,each splitting:1,line doesn’t:1,actually create:1,subspace for:1,wall but:1,does create:1,subspace boundary:1,boundary for:1,wall as:1,that spatial:1,spatial organization:1,organization provides:1,provides for:1,same unambiguous:1,unambiguous visibility:1,ordering as:1,would Creating:1,Creating a:1,a recursive:1,recursive process:1,process so:1,we’ll perform:1,first split:1,there Figure:1,59.3 shows:1,world carved:1,carved along:1,C into:1,parts walls:1,and walls:1,are behind:1,behind Any:1,walls would:1,equally valid:1,valid choice:1,initial split:1,split we’ll:1,choosing splitting:1,splitting walls:1,splitting into:1,into front:1,the essential:1,essential dualism:1,dualism of:1,C Next:1,Next in:1,59.4 the:1,D This:1,subspace so:1,with wall:1,subspace Figure:1,59.5 shows:1,C being:1,B There’s:1,difference here:1,though Wall:1,A straddles:1,line generated:1,generated from:1,B Does:1,Does wall:1,A belong:1,B Both:1,Both actually:1,actually Wall:1,A gets:1,gets split:1,pieces which:1,call wall:1,and wall:1,wall E:1,E each:1,each piece:1,piece is:1,is assigned:1,appropriate subspace:1,subspace and:1,and treated:1,separate wall:1,wall As:1,59.6 each:1,split pieces:1,pieces then:1,then has:1,subspace to:1,each becomes:1,tree The:1,now complete:1,complete Visibility:1,Visibility Ordering:1,Ordering Now:1,we’ve successfully:1,successfully built:1,tree you:1,might justifiably:1,justifiably be:1,little puzzled:1,puzzled as:1,to how:1,this helps:1,helps with:1,with visibility:1,ordering The:1,can definitively:1,definitively determine:1,its child:1,farther from:1,any and:1,all viewpoints:1,viewpoints applied:1,applied throughout:1,tree this:1,this principle:1,principle makes:1,establish visibility:1,tree no:1,angle Consider:1,59.2 viewed:1,The viewpoint:1,us that:1,walls belonging:1,that descends:1,descends from:1,are nearer:1,nearer along:1,every ray:1,viewpoint than:1,is they:1,be occluded:1,occluded by:1,C All:1,in wall:1,tree are:1,likewise farther:1,away than:1,C along:1,along any:1,any ray:1,ray Thus:1,Thus for:1,this viewpoint:1,we’re using:1,algorithm we:1,tree first:1,then wall:1,tree If:1,viewpoint had:1,been on:1,this order:1,order would:1,been reversed:1,reversed Of:1,more ordering:1,ordering information:1,information than:1,C alone:1,alone can:1,by traversing:1,tree recursively:1,recursively making:1,far-near decision:1,59.8 shows:1,algorithm back-to-front:1,traversal order:1,viewpoint of:1,59.7 At:1,we decide:1,that node’s:1,wall then:1,visit whichever:1,wall’s children:1,children is:1,side from:1,viewpoint draw:1,node’s nearer:1,nearer child:1,child in:1,order Visiting:1,Visiting a:1,is recursive:1,recursive involving:1,far-near visiting:1,visiting order:1,order Figure:1,angle Figure:1,line separates:1,separates all:1,two groups:1,groups relative:1,farther group:1,group is:1,guaranteed not:1,to occlude:1,occlude every:1,nearer By:1,By applying:1,applying this:1,this ordering:1,ordering recursively:1,recursively the:1,traversed to:1,provide back-to-front:1,ordering with:1,node being:1,being visited:1,visited only:1,once Figure:1,59.7 Figure:1,walk used:1,produce front-to-back:1,walk More:1,shortly you’re:1,you’re also:1,of inorder:1,walking in:1,good data:1,structures book:1,only special:1,special aspect:1,BSP walks:1,walks is:1,decision has:1,made at:1,node about:1,facing relative:1,which child:1,child tree:1,farther Listing:1,59.1 shows:1,back-to-front The:1,The decision:1,forward made:1,by WallFacingForward:1,WallFacingForward in:1,59.1 can:1,general be:1,screenspace perspective-corrected:1,perspective-corrected space:1,positive or:1,or negative:1,viewspace non-perspective:1,non-perspective corrected:1,corrected space:1,viewpoint normal:1,wall In:1,In 2-D:1,2-D the:1,decision can:1,by enforcing:1,enforcing the:1,the convention:1,convention that:1,front the:1,leftmost then:1,simple screenspace:1,screenspace comparison:1,right vertices:1,vertices indicates:1,indicates which:1,facing Be:1,made smaller:1,efficient by:1,detecting collinear:1,surfaces like:1,like aligned:1,aligned wall:1,wall segments:1,and generating:1,generating only:1,one BSP:1,the collinear:1,surfaces stored:1,list attached:1,node Collinear:1,Collinear surfaces:1,surfaces partition:1,partition space:1,space identically:1,identically and:1,can’t occlude:1,occlude one:1,one splitting:1,splitting node:1,set Inorder:1,Inorder Walks:1,Walks of:1,Trees It:1,was implementing:1,implementing BSP:1,that got:1,about inorder:1,tree traversal:1,traversal In:1,In inorder:1,inorder traversal:1,traversal the:1,node gets:1,gets visited:1,visited first:1,subtree You:1,You apply:1,sequence recursively:1,children until:1,entire tree:1,tree has:1,visited as:1,59.9 Walking:1,Walking a:1,basically an:1,tree a:1,decision is:1,made before:1,each descent:1,descent as:1,which subtree:1,subtree to:1,visit first:1,first rather:1,simply visiting:1,visiting whatever’s:1,whatever’s pointed:1,left-subtree pointer:1,Conceptually however:1,however an:1,walk is:1,is what’s:1,what’s used:1,discuss normal:1,normal inorder:1,walking with:1,same principles:1,principles apply:1,trees As:1,said again:1,my printed:1,printed works:1,works over:1,years you:1,to dig:1,dig deep:1,deep below:1,to really:1,understand something:1,something if:1,and inorder:1,walking turns:1,it’s such:1,I routinely:1,an interview:1,interview question:1,question for:1,for programmer:1,programmer candidates:1,candidates and:1,my astonishment:1,astonishment not:1,one interviewee:1,interviewee has:1,one yet:1,question in:1,stages and:1,get remarkably:1,remarkably consistent:1,consistent results:1,results First:1,ask for:1,function WalkTree:1,WalkTree that:1,that visits:1,visits each:1,a passed-in:1,passed-in tree:1,in inorder:1,inorder sequence:1,sequence Each:1,Each candidate:1,candidate unhesitatingly:1,unhesitatingly writes:1,writes something:1,and 59.3:1,59.3 shown:1,shown next:1,tree Then:1,ask if:1,faster some:1,some don’t:1,don’t but:1,most point:1,that function:1,pretty expensive:1,expensive Either:1,I then:1,then ask:1,ask them:1,function without:1,without code:1,recursion And:1,I sit:1,sit back:1,and squirm:1,squirm for:1,anyone write:1,functional data-recursion:1,data-recursion inorder:1,walk function:1,several people:1,have simply:1,simply never:1,never gotten:1,all Even:1,them have:1,have fumbled:1,fumbled their:1,their way:1,code sticking:1,sticking in:1,a push:1,push here:1,pop there:1,there then:1,then working:1,through sample:1,sample scenarios:1,scenarios in:1,their head:1,head to:1,what’s broken:1,broken programming:1,error until:1,errors seem:1,gone No:1,ever sure:1,sure they:1,right instead:1,instead when:1,can’t find:1,more bugs:1,bugs they:1,me hopefully:1,hopefully to:1,it’s thumbs-up:1,thumbs-up or:1,or thumbs-down:1,thumbs-down And:1,data-recursive inorder:1,walk implementation:1,implementation has:1,same flowchart:1,flowchart and:1,version they’ve:1,they’ve already:1,already written:1,written They:1,They already:1,fully functional:1,functional model:1,follow with:1,problems solved:1,solved but:1,can’t make:1,connection between:1,they’re trying:1,implement Why:1,this Know:1,Know It:1,It Cold:1,Cold The:1,these people:1,understand inorder:1,through They:1,They understand:1,the concepts:1,concepts of:1,of visiting:1,visiting left:1,right subtrees:1,subtrees and:1,general picture:1,how traversal:1,traversal moves:1,moves about:1,not understand:1,version does:1,does If:1,really comprehended:1,comprehended everything:1,of WalkTree:1,WalkTree how:1,how each:1,each call:1,call saves:1,that implies:1,implies for:1,which operations:1,are performed—they:1,performed—they would:1,would simply:1,simply and:1,without fuss:1,fuss implement:1,59.4 working:1,version as:1,model Take:1,59.4 and:1,relate it:1,59.2 The:1,The structure:1,structure is:1,but upon:1,upon examination:1,examination it:1,becomes clear:1,both listings:1,listings reflect:1,subtree visit:1,subtree And:1,And although:1,although Listing:1,longer that’s:1,that’s mostly:1,mostly because:1,commented it:1,heavily to:1,sure its:1,its workings:1,workings are:1,are understood:1,understood there:1,13 lines:1,59.4 Let’s:1,it another:1,way All:1,59.2 does:1,is say:1,say Here:1,Here I:1,am at:1,node First:1,one then:1,visit this:1,one While:1,I’m visiting:1,visiting the:1,subtree I’ll:1,just push:1,a marker:1,marker on:1,that tells:1,back here:1,here when:1,subtree is:1,If after:1,after visiting:1,visiting a:1,node there:1,children to:1,visit and:1,stack I’m:1,I’m finished:1,this at:1,each node—and:1,node—and that’s:1,does That’s:1,59.4 does:1,does too:1,but people:1,get tangled:1,tangled up:1,in pushes:1,pushes and:1,and pops:1,pops and:1,while loops:1,loops when:1,use data:1,recursion When:1,implementation model:1,model changes:1,are unfamiliar:1,unfamiliar they:1,they abandon:1,abandon the:1,good model:1,model they:1,they used:1,used before:1,to rederive:1,rederive it:1,new context:1,context by:1,the seat:1,seat of:1,their pants:1,pants Here’s:1,secret when:1,you’re faced:1,situation like:1,this Step:1,clear picture:1,code has:1,do Omit:1,Omit no:1,no steps:1,steps You:1,should build:1,so consistent:1,solid that:1,instantly answer:1,answer any:1,should behave:1,behave in:1,any situation:1,situation For:1,example my:1,my interviewees:1,interviewees often:1,often decide:1,decide by:1,distinct types:1,children Right:1,Right children:1,after popping:1,popping back:1,visit a:1,subtree has:1,after descending:1,descending to:1,no left:1,child This:1,the traversal:1,traversal code:1,a mass:1,cases each:1,programmer by:1,trying out:1,out scenarios:1,scenarios Worse:1,Worse you:1,sure with:1,you’ve caught:1,caught all:1,a unifying:1,unifying model:1,model There:1,There aren’t:1,aren’t really:1,really two:1,two types:1,after their:1,their parents:1,parents are:1,visited period:1,period The:1,presence or:1,or absence:1,The possibility:1,right child:1,child may:1,reached via:1,via different:1,different code:1,paths depending:1,child does:1,overall model:1,model While:1,this distinction:1,distinction may:1,seem trivial:1,trivial it:1,fact crucial:1,crucial because:1,model down:1,cold you:1,always tell:1,tell if:1,correct by:1,comparing it:1,model Measure:1,Measure and:1,and Learn:1,Learn How:1,fuss make:1,make anyway:1,anyway Listing:1,59.5 is:1,that builds:1,then calls:1,calls WalkTree:1,WalkTree to:1,walk it:1,it 1000:1,and times:1,times how:1,long this:1,this takes:1,takes Using:1,Using 32-bit:1,32-bit Visual:1,C 1.10:1,1.10 running:1,on Windows:1,NT with:1,with default:1,optimization selected:1,selected Listing:1,59.5 reports:1,59.2 on:1,486/33 a:1,code rearrangement:1,rearrangement especially:1,speedup is:1,is diluted:1,diluted by:1,the Visit:1,Visit function:1,miss that:1,on virtually:1,node access:1,access Listing:1,59.5 builds:1,rather unique:1,unique tree:1,tree one:1,which every:1,children Different:1,Different sorts:1,of trees:1,do produce:1,produce different:1,performance results:1,results Always:1,Always know:1,measuring Things:1,Things change:1,change when:1,when maximum:1,selected however:1,implementations becomes:1,becomes virtually:1,identical How:1,be Part:1,does an:1,an amazingly:1,amazingly good:1,59.2 Most:1,Most impressively:1,impressively when:1,when compiling:1,compiling Listing:1,59.2 the:1,compiler actually:1,actually converts:1,converts all:1,all right-subtree:1,right-subtree descents:1,descents from:1,recursion by:1,simply jumping:1,jumping back:1,left-subtree handling:1,handling code:1,code instead:1,of recursively:1,recursively calling:1,calling WalkTree:1,WalkTree This:1,59.4 has:1,no advantage:1,59.2 in:1,a disadvantage:1,disadvantage because:1,handling right-subtree:1,right-subtree descent:1,descent in:1,somewhat inefficient:1,inefficient but:1,the right-subtree:1,right-subtree code:1,59.2 is:1,a marvel:1,marvel of:1,code generation:1,generation at:1,3 instructions:1,instructions What’s:1,more although:1,although left-subtree:1,left-subtree traversal:1,recursion than:1,recursion the:1,instructions because:1,one parameter:1,parameter is:1,compiler doesn’t:1,bother setting:1,an EBP-based:1,EBP-based stack:1,frame instead:1,uses ESP:1,stack And:1,this cost:1,cost could:1,reduced still:1,NULL pNode:1,pNode at:1,top level:1,level There:1,does with:1,and 59.4:1,59.4 but:1,that’s enough:1,idea It’s:1,compiler might:1,not do:1,implementation could:1,could probably:1,probably speed:1,59.4 enough:1,it measurably:1,measurably faster:1,even close:1,being enough:1,enough faster:1,effort The:1,The moral:1,moral of:1,story apart:1,enable compiler:1,1 Understand:1,Understand what:1,doing through:1,through 2:1,2 Build:1,Build a:1,complete and:1,consistent model:1,head 3:1,3 Design:1,Design from:1,principles that:1,model provides:1,provides 4:1,4 Implement:1,Implement the:1,design 5:1,5 Measure:1,Measure to:1,you’ve wrought:1,wrought 6:1,Go back:1,step 1:1,apply what:1,you’ve just:1,learned With:1,iteration you’ll:1,you’ll dig:1,dig deeper:1,deeper learn:1,improve your:1,your ability:1,where and:1,focus your:1,programming efforts:1,efforts For:1,compilers I:1,used five:1,ago back:1,relative strengths:1,processors then:1,use Listing:1,59.4 would:1,have blown:1,blown away:1,away Listing:1,59.2 While:1,While doing:1,given current:1,current processors:1,and compiler:1,technology data:1,recursion isn’t:1,any big:1,big wins:1,wins and:1,yes that:1,was news:1,me That’s:1,good this:1,information saves:1,saves me:1,from wasted:1,and tells:1,me what:1,what to:1,use recursion:1,recursion Assume:1,nothing keep:1,keep digging:1,digging deeper:1,deeper and:1,never stop:1,stop learning:1,and growing:1,growing The:1,world won’t:1,won’t hold:1,hold still:1,fortunately you:1,just keep:1,keep at:1,it Depths:1,Depths within:1,within depths:1,depths indeed:1,indeed Surfing:1,Surfing Amidst:1,Amidst the:1,the Trees:1,Trees In:1,we’ll build:1,compiler and:1,we’ll put:1,a rendering:1,rendering system:1,system built:1,trees the:1,generates If:1,trees really:1,really grabs:1,grabs your:1,your fancy:1,fancy as:1,care at:1,performance graphics:1,graphics there:1,writing February:1,1996 a:1,a World:1,World Wide:1,Wide Web:1,page on:1,must investigate:1,investigate at:1,at http:1,www.qualia.com/bspfaq http:1,www.qualia.com/bspfaq It’s:1,It’s set:1,familiar Internet:1,Internet Frequently:1,Frequently Asked:1,Asked Questions:1,Questions FAQ:1,FAQ style:1,stuff Related:1,Related Reading:1,Reading Foley:1,Foley J:1,J A:1,A van:1,Dam S:1,S Feiner:1,Feiner and:1,and J:1,J Hughes:1,Hughes Computer:1,Edition Addison:1,Wesley 1990:1,pp 555-557:1,555-557 675-680:1,675-680 Fuchs:1,Fuchs H:1,H Z:1,Z Kedem:1,Kedem and:1,and B:1,B Naylor:1,Naylor On:1,On Visible:1,Surface Generation:1,Generation by:1,by A:1,A Priori:1,Priori Tree:1,Tree Structures:1,Structures Computer:1,Graphics Vol:1,Vol 17(3:1,17(3 June:1,June 1980:1,1980 pp:1,pp 124-133:1,124-133 Gordon:1,Gordon D:1,D and:1,S Chen:1,Chen Front-to-Back:1,Front-to-Back Display:1,Display of:1,Trees IEEE:1,IEEE Computer:1,and Applications:1,Applications September:1,September 1991:1,1991 pp:1,pp 79-85:1,79-85 Naylor:1,Naylor B:1,B Binary:1,Partitioning Trees:1,Trees as:1,an Alternative:1,Alternative Representation:1,Representation of:1,of Polytopes:1,Polytopes Computer:1,Computer Aided:1,Aided Design:1,Design Vol:1,Vol 22(4:1,22(4 May:1,May 1990:1,pp 250-253:1,250-253 Chapter:1,60 Compiling:1,Trees Taking:1,Taking BSP:1,Trees from:1,from Concept:1,Concept to:1,to Reality:1,As long-time:1,long-time readers:1,columns know:1,move my:1,family around:1,the country:1,country quite:1,bit Change:1,Change doesn’t:1,blue so:1,interesting history:1,history to:1,every move:1,move but:1,the roots:1,roots of:1,latest move:1,move go:1,back even:1,even farther:1,than usual:1,usual To:1,wit In:1,In 1986:1,1986 just:1,moved from:1,from Pennsylvania:1,Pennsylvania to:1,to California:1,California I:1,for Programmer’s:1,was paid:1,paid peanuts:1,peanuts for:1,I doubt:1,doubt if:1,if even:1,even 5000:1,5000 people:1,people saw:1,first issues:1,issues the:1,columns appeared:1,in but:1,fun exploring:1,exploring fast:1,By 1991:1,1991 we:1,in Vermont:1,Vermont and:1,Programming column:1,for Dr:1,took all:1,my spare:1,spare nights:1,nights and:1,and weekends:1,weekends to:1,the deadlines:1,deadlines In:1,days I:1,of unsolicited:1,unsolicited evaluation:1,evaluation software:1,software including:1,PC shareware:1,shareware game:1,game called:1,called Commander:1,Keen a:1,a side-scrolling:1,side-scrolling game:1,was every:1,hot Nintendo:1,Nintendo games:1,games of:1,I loved:1,loved the:1,game looked:1,looked and:1,actually drafted:1,drafted a:1,column opening:1,opening about:1,how for:1,years I’d:1,been claiming:1,PC could:1,great game:1,machine in:1,great programmers:1,and here:1,here finally:1,finally was:1,the proof:1,proof in:1,Keen In:1,end though:1,too close:1,a product:1,product review:1,review an:1,observed inflames:1,inflames passions:1,passions in:1,in nonconstructive:1,nonconstructive ways:1,ways so:1,went with:1,different opening:1,opening In:1,In 1992:1,1992 I:1,about my:1,library and:1,and hung:1,on DDJ:1,s bulletin:1,board There:1,was another:1,another guy:1,who hung:1,who knew:1,3-D a:1,named John:1,Carmack who:1,surely the:1,only game:1,game programmer:1,programmer I’d:1,of who:1,who developed:1,developed under:1,under NEXTSTEP:1,NEXTSTEP When:1,Redmond I:1,for BBSs:1,BBSs anymore:1,anymore though:1,In early:1,early 1993:1,1993 I:1,I hired:1,Hecker Later:1,Later that:1,that year:1,year Chris:1,Chris showed:1,alpha copy:1,of DOOM:1,I nearly:1,nearly fell:1,fell out:1,my chair:1,chair About:1,About a:1,later Chris:1,Chris forwarded:1,forwarded me:1,a newsgroup:1,newsgroup post:1,post about:1,about NEXTSTEP:1,NEXTSTEP and:1,said Isn’t:1,Isn’t this:1,guy you:1,you used:1,know on:1,DDJ bulletin:1,board Indeed:1,was John:1,Carmack what’s:1,what’s more:1,written DOOM:1,DOOM I:1,sent him:1,a congratulatory:1,congratulatory piece:1,sent back:1,back some:1,some thoughts:1,thoughts about:1,and somewhere:1,he ever:1,ever came:1,way It:1,had family:1,in Seattle:1,Seattle so:1,he stopped:1,and visited:1,time Over:1,year we:1,we exchanged:1,exchanged some:1,some fascinating:1,fascinating mail:1,became steadily:1,more impressed:1,impressed with:1,with John’s:1,John’s company:1,company id:1,Software Eventually:1,Eventually John:1,John asked:1,if I’d:1,be interested:1,in joining:1,joining id:1,id and:1,of consideration:1,consideration I:1,couldn’t think:1,of anything:1,fun or:1,or teach:1,in Dallas:1,Dallas our:1,our fourth:1,fourth move:1,move of:1,of 2000:1,2000 miles:1,miles or:1,I’ve starting:1,starting writing:1,writing in:1,computer field:1,now I’m:1,I’m writing:1,some seriously:1,seriously cool:1,cool 3-D:1,3-D software:1,software Now:1,I’m here:1,here it’s:1,an eye-opener:1,eye-opener to:1,how events:1,events fit:1,together over:1,last decade:1,decade You:1,John started:1,doing PC:1,PC game:1,game programming:1,programming he:1,he learned:1,learned fast:1,those early:1,early Programmer’s:1,Journal articles:1,articles of:1,The copy:1,Keen that:1,that validated:1,validated my:1,my faith:1,faith in:1,machine was:1,the fruit:1,fruit of:1,those articles:1,articles for:1,an id:1,id game:1,game although:1,then When:1,was hanging:1,hanging out:1,DDJ BBS:1,BBS he:1,done Castle:1,Castle Wolfenstein:1,first great:1,great indoor:1,indoor 3-D:1,do DOOM:1,DOOM If:1,only I’d:1,known that:1,then And:1,And had:1,I not:1,not hired:1,Chris or:1,he not:1,not somehow:1,somehow remembered:1,remembered me:1,me talking:1,that guy:1,who used:1,used NEXTSTEP:1,NEXTSTEP I’d:1,gotten back:1,John and:1,and things:1,things would:1,be different:1,different At:1,be hearing:1,hearing jokes:1,jokes about:1,daughter’s going:1,to grow:1,grow up:1,up saying:1,saying y’all:1,y’all I:1,think there’s:1,worthwhile lesson:1,seen hold:1,people as:1,well If:1,you love:1,love and:1,can good:1,things will:1,eventually come:1,come of:1,necessarily quickly:1,quickly or:1,or easily:1,easily but:1,you stick:1,it they:1,come There:1,are threads:1,threads that:1,our lives:1,lives and:1,time we’ve:1,been adults:1,adults for:1,while practically:1,practically everything:1,happens has:1,has roots:1,roots that:1,run far:1,in time:1,The implication:1,implication should:1,clear If:1,happen in:1,your future:1,future stretch:1,stretch yourself:1,extra effort:1,effort now:1,at whatever:1,care passionately:1,passionately about:1,so those:1,those roots:1,roots will:1,plenty to:1,with down:1,road All:1,surprisingly closely:1,topic BSP:1,trees because:1,because John:1,the fellow:1,who brought:1,brought BSP:1,trees into:1,the spotlight:1,spotlight by:1,building DOOM:1,DOOM around:1,them He:1,He also:1,also got:1,trees by:1,by explaining:1,explaining how:1,how DOOM:1,DOOM worked:1,and getting:1,me interested:1,interested enough:1,experiment the:1,compiler in:1,direct result:1,result Finally:1,Finally John:1,an invaluable:1,invaluable help:1,about BSP:1,become evident:1,evident when:1,discuss BSP:1,optimization Onward:1,to compiling:1,compiling BSP:1,trees Compiling:1,Trees As:1,of binary:1,binary subdivisions:1,subdivisions that:1,that partion:1,partion space:1,into ever-smaller:1,ever-smaller pieces:1,pieces That’s:1,simple data:1,a correspondingly:1,correspondingly simple:1,simple tool:1,tool First:1,it groups:1,groups all:1,surfaces lines:1,3-D together:1,that encompasses:1,encompasses the:1,the database:1,database Then:1,it chooses:1,chooses one:1,uses its:1,its line:1,remaining surfaces:1,subspaces splitting:1,parts if:1,root Each:1,two resultant:1,resultant subspaces:1,subspaces is:1,same fashion:1,on recursively:1,reached where:1,to nodes:1,leaf surface:1,surface subdivides:1,subdivides a:1,empty except:1,surface Put:1,carves space:1,children carve:1,carve each:1,parts into:1,surface carving:1,carving ever:1,ever smaller:1,smaller subspaces:1,subspaces until:1,used Actually:1,Actually there:1,space but:1,current discussion:1,discussion If:1,above confusing:1,confusing and:1,be understandable:1,understandable if:1,case BSP:1,chapter It:1,get hold:1,hold of:1,visual BSP:1,shortly when:1,understanding BSP:1,trees there’s:1,like seeing:1,seeing one:1,one being:1,built So:1,So there:1,two interesting:1,interesting operations:1,in building:1,tree choosing:1,subspace a:1,splitter and:1,assigning surfaces:1,another of:1,current root:1,node splitting:1,any that:1,that straddle:1,straddle the:1,splitter We’ll:1,splitters shortly:1,but first:1,first let’s:1,splitting and:1,assigning To:1,understand parametric:1,lines Parametric:1,Parametric Lines:1,Lines We’re:1,We’re all:1,all familiar:1,with lines:1,lines described:1,in slope-intercept:1,slope-intercept form:1,y mx:1,mx b:1,b but:1,line description:1,description that’s:1,for clipping:1,3-D purposes:1,as curved:1,curved surfaces:1,mapping parametric:1,lines In:1,In parametric:1,lines x:1,are decoupled:1,decoupled from:1,are instead:1,instead described:1,described as:1,parameter t:1,t x:1,x x_start:1,x_start t(x_end:1,t(x_end x_start:1,x_start y:1,y y_start:1,y_start t(y_end:1,t(y_end y_start:1,y_start This:1,be summarized:1,summarized as:1,as L:1,L L_start:1,L_start t(L_end:1,t(L_end L_start:1,L_start where:1,where L:1,L x:1,y Figure:1,a parametric:1,line works:1,works The:1,The t:1,t parameter:1,parameter describes:1,are Note:1,this description:1,description is:1,is valid:1,valid not:1,also for:1,entire infinite:1,infinite line:1,line however:1,only points:1,points with:1,with t:1,values between:1,actually on:1,our 2-D:1,compiler as:1,as you’ll:1,with 2-D:1,2-D trees:1,generalize to:1,3-D we’ll:1,represent our:1,our walls:1,walls all:1,vertical as:1,segments viewed:1,The segments:1,segments will:1,in parametric:1,parametric form:1,two t:1,values describing:1,current possibly:1,possibly clipped:1,clipped segment:1,segment providing:1,complete specification:1,60.2 What:1,us For:1,it keeps:1,keeps clipping:1,clipping errors:1,errors from:1,from creeping:1,creeping in:1,in because:1,because clipped:1,always based:1,segment not:1,not derived:1,from clipped:1,clipped versions:1,versions Also:1,potentially a:1,compact format:1,format because:1,endpoints only:1,segments for:1,for clipped:1,segments we:1,store pairs:1,values along:1,biggest win:1,win however:1,use parametric:1,line clipping:1,very clean:1,clean form:1,clipping indeed:1,compiler Figure:1,compiler Parametric:1,Parametric Line:1,Line Clipping:1,assign a:1,one subspace:1,subspace or:1,splitter we:1,somehow figure:1,out whether:1,segment straddles:1,splitter or:1,or falls:1,other In:1,we first:1,first plug:1,plug the:1,and splitter:1,splitter into:1,following parametric:1,intersection equation:1,equation number:1,number N:1,N L_start:1,L_start S_start:1,S_start Equation:1,1 denom:1,denom N:1,N L_end:1,L_end L_start:1,L_start Equation:1,Equation 2:1,2 t_intersect:1,t_intersect number:1,number denom:1,denom Equation:1,splitter S_start:1,S_start is:1,in standard:1,standard xy:1,form and:1,and L_start:1,L_start and:1,and L_end:1,L_end are:1,in xy:1,form Figure:1,60.3 illustrates:1,intersection calculation:1,calculation Due:1,to lack:1,space I’m:1,present this:1,this equation:1,its implications:1,implications as:1,as fact:1,fact rather:1,than deriving:1,deriving them:1,more there’s:1,excellent explanation:1,explanation on:1,page 117:1,117 of:1,Practice by:1,Dam Addison:1,Wesley ISBN:1,0-201-12110-7 a:1,should certainly:1,your library:1,library If:1,denominator is:1,zero we:1,intersect so:1,don’t divide:1,rather check:1,the numerator:1,numerator which:1,which tells:1,on Otherwise:1,division and:1,60.3 We:1,We then:1,then simply:1,simply compare:1,split If:1,it’s between:1,them that’s:1,segment otherwise:1,line segment’s:1,segment’s t:1,t range:1,range it’s:1,on Simple:1,Simple comparisons:1,comparisons do:1,generating actual:1,actual x:1,y values:1,values If:1,closely at:1,60.1 the:1,compiler you’ll:1,the parametric:1,is exceedingly:1,exceedingly short:1,simple Figure:1,calculated Figure:1,calculated One:1,it generates:1,generates normals:1,surfaces simply:1,by exchanging:1,exchanging the:1,y lengths:1,and negating:1,negating the:1,resultant y:1,y value:1,value thereby:1,thereby rotating:1,line 90:1,degrees In:1,3-D it’s:1,come by:1,normal you:1,or precalculate:1,precalculate it:1,you build:1,database The:1,BSP Compiler:1,Compiler Listing:1,BSP compiler—the:1,compiler—the code:1,actually builds:1,is excerpted:1,excerpted from:1,C CPP:1,CPP file:1,file but:1,I show:1,show here:1,to straight:1,straight C:1,even compile:1,C file:1,file though:1,haven’t checked:1,checked The:1,compiler begins:1,empty tree:1,complete set:1,segments from:1,generated to:1,to SelectBSPTree:1,SelectBSPTree which:1,which chooses:1,chooses a:1,calls BuildBSPTree:1,BuildBSPTree to:1,and generate:1,generate child:1,node’s two:1,subspaces BuildBSPTree:1,BuildBSPTree calls:1,calls SelectBSPTree:1,SelectBSPTree recursively:1,those child:1,this continues:1,continues until:1,assigned nodes:1,nodes SelectBSP:1,SelectBSP uses:1,splitter as:1,and BuildBSPTree:1,BuildBSPTree uses:1,decide which:1,which subspace:1,splitter each:1,line belongs:1,belongs in:1,split lines:1,60.1 isn’t:1,long or:1,or complex:1,it’s somewhat:1,it’s structured:1,allow visual:1,visual display:1,the ongoing:1,ongoing compilation:1,compilation process:1,process That’s:1,because Listing:1,actually just:1,Win32 that:1,that visually:1,the progressive:1,progressive subdivision:1,built Note:1,60.1 might:1,not compile:1,as printed:1,printed I:1,I may:1,have missed:1,missed copying:1,copying some:1,some global:1,uses The:1,The complete:1,complete code:1,print here:1,here in:1,entirety but:1,in file:1,file DDJBSP.ZIP:1,DDJBSP.ZIP Optimizing:1,Optimizing the:1,Tree In:1,I promised:1,promised that:1,I’d discuss:1,about deciding:1,which wall:1,in constructing:1,constructing a:1,tree That:1,That turns:1,problem than:1,think but:1,can’t ignore:1,of splitter:1,splitter can:1,huge difference:1,difference Consider:1,BSP in:1,splits every:1,single other:1,other surface:1,surface in:1,world doubling:1,with Contrast:1,BSP built:1,built from:1,surface set:1,initial splitter:1,splitter doesn’t:1,doesn’t split:1,split anything:1,anything Both:1,Both trees:1,trees provide:1,valid ordering:1,ordering but:1,one tree:1,with twice:1,polygons after:1,node Apply:1,Apply the:1,same difference:1,difference again:1,relative difference:1,and correspondingly:1,correspondingly in:1,in traversal:1,rendering time:1,time soon:1,soon balloons:1,balloons astronomically:1,astronomically So:1,BSP tree—but:1,tree—but what:1,what Before:1,answer that:1,optimize There:1,optimization objectives:1,objectives in:1,BSP compilation:1,compilation We:1,We might:1,to balance:1,possible thereby:1,average depth:1,depth to:1,tree must:1,traversed Alternatively:1,approximately balance:1,volume on:1,each splitter:1,splitter That:1,don’t end:1,with huge:1,some tree:1,tree branches:1,branches and:1,and tiny:1,tiny slivers:1,slivers in:1,in others:1,others and:1,overall processing:1,more consistent:1,consistent Or:1,select planes:1,major axes:1,axes because:1,such planes:1,traversal The:1,BSP metric:1,metric that:1,me however:1,tree Fewer:1,Fewer splits:1,splits is:1,better the:1,smaller with:1,go faster:1,draw due:1,to per-polygon:1,per-polygon overhead:1,overhead There’s:1,the fewest-splits:1,fewest-splits metric:1,metric though:1,though There’s:1,no sure:1,sure way:1,achieve it:1,obvious approach:1,to minimizing:1,minimizing polygon:1,splits would:1,try all:1,possible trees:1,one Unfortunately:1,N as:1,my dismay:1,implemented brute-force:1,my BSP:1,compiler Take:1,operations for:1,the 20-polygon:1,20-polygon set:1,set I:1,tried brute-force:1,I’ll give:1,hint There:1,are 19:1,19 digits:1,digits in:1,20 and:1,operation takes:1,one microsecond:1,microsecond that’s:1,that’s over:1,over 70000:1,70000 years:1,prefer over:1,over 500000:1,500000 dog:1,years Now:1,single game:1,game level:1,have 5000:1,5000 to:1,to 10000:1,polygons there:1,aren’t anywhere:1,near enough:1,enough dog:1,the lifetime:1,lifetime of:1,universe to:1,handle that:1,that We’re:1,on optimal:1,optimal compilation:1,decent heuristic:1,heuristic approach:1,what optimization:1,optimization objective:1,objective we:1,select In:1,60.1 I’ve:1,I’ve applied:1,applied the:1,popular heuristic:1,heuristic of:1,other surfaces:1,being considered:1,node In:1,I choose:1,subspace it’s:1,it’s subdividing:1,subdividing BSP:1,BSP Optimization:1,an Undiscovered:1,Undiscovered Country:1,Country Although:1,Although BSP:1,trees have:1,least 15:1,now they’re:1,still only:1,partially understood:1,understood and:1,a ripe:1,ripe area:1,area for:1,for applied:1,applied research:1,research and:1,general ingenuity:1,ingenuity You:1,try your:1,hand at:1,at inventing:1,inventing new:1,new BSP:1,optimization approaches:1,approaches it’s:1,interesting problem:1,might strike:1,strike paydirt:1,paydirt There:1,many things:1,trees can’t:1,takes so:1,build them—but:1,them—but what:1,do exceedingly:1,exceedingly well:1,better compilation:1,compilation approach:1,that allowed:1,allowed BSP:1,more purposes:1,purposes would:1,be valuable:1,valuable indeed:1,indeed Chapter:1,61 Frames:1,Frames of:1,of Reference:1,Reference The:1,The Fundamentals:1,the Math:1,Math behind:1,behind 3-D:1,3-D Graphics:1,Graphics Several:1,Several years:1,I opened:1,opened a:1,Journal with:1,about singing:1,singing my:1,daughter to:1,sleep with:1,with Beatles:1,songs Beatles:1,songs at:1,ones tend:1,be bouncy:1,bouncy and:1,and pleasant:1,pleasant which:1,them suitable:1,suitable goodnight:1,goodnight fodder—and:1,fodder—and there:1,useful hedge:1,hedge against:1,against terminal:1,terminal boredom:1,boredom So:1,many good:1,reasons Can’t:1,Can’t Buy:1,Buy Me:1,Me Love:1,Love and:1,and A:1,Night and:1,and Help:1,Help and:1,rest were:1,were evening:1,evening staples:1,staples for:1,years No:1,No longer:1,longer though:1,wife some:1,some Beatles:1,Beatles tapes:1,tapes for:1,for Christmas:1,Christmas and:1,we’ve all:1,all been:1,been listening:1,listening to:1,daughter has:1,has heard:1,heard the:1,real thing:1,thing she:1,she can:1,can barely:1,barely stand:1,stand to:1,room much:1,less fall:1,asleep when:1,I sing:1,sing those:1,songs What’s:1,What’s noteworthy:1,noteworthy is:1,only variable:1,variable involved:1,this change:1,reference My:1,My singing:1,singing hasn’t:1,hasn’t gotten:1,gotten any:1,any worse:1,worse over:1,last four:1,years I’m:1,my singing:1,singing to:1,get worse:1,worse All:1,All that:1,changed was:1,songs The:1,universe stayed:1,stayed the:1,in her:1,her mind:1,mind lock:1,lock stock:1,stock and:1,and barrel:1,barrel Often:1,Often the:1,solving a:1,problem or:1,problem efficiently:1,efficiently is:1,proper frame:1,reference The:1,The model:1,model you:1,have of:1,problem you’re:1,you’re tackling:1,tackling often:1,often determines:1,how deeply:1,deeply you:1,how flexible:1,and innovative:1,innovative you’ll:1,solving it:1,it An:1,An excellent:1,discuss toward:1,3-D transformation:1,transformation the:1,converting coordinates:1,way this:1,is traditionally:1,traditionally explained:1,explained is:1,is functional:1,functional but:1,particularly intuitive:1,intuitive and:1,and fairly:1,fairly hard:1,visualize Recently:1,Recently I’ve:1,across another:1,at transforms:1,transforms that:1,be far:1,far easier:1,grasp The:1,technically equivalent:1,equivalent so:1,view things—but:1,things—but sometimes:1,sometimes that’s:1,important sort:1,of difference:1,difference Before:1,about transforming:1,transforming between:1,between coordinate:1,coordinate spaces:1,spaces however:1,need two:1,two building:1,blocks dot:1,products 3-D:1,3-D Math:1,Math At:1,originally going:1,BSP-based renderer:1,to complement:1,complement the:1,compiler I:1,chapter What:1,What changed:1,changed my:1,my plans:1,plans was:1,mail about:1,math that:1,gotten in:1,months In:1,In every:1,every case:1,the writer:1,writer has:1,has bemoaned:1,bemoaned his/her:1,his/her lack:1,of expertise:1,expertise with:1,has asked:1,what books:1,books about:1,math I’d:1,recommend and:1,how else:1,else he/she:1,he/she could:1,could learn:1,more That’s:1,a commendable:1,commendable attitude:1,attitude but:1,math at:1,not when:1,polygon-based realtime:1,3-D that’s:1,PCs You:1,You really:1,need only:1,basic math:1,math tools:1,tools beyond:1,beyond simple:1,simple arithmetic:1,arithmetic dot:1,and really:1,really mostly:1,mostly just:1,former My:1,Hecker points:1,an oversimplification:1,oversimplification he:1,he notes:1,that lots:1,more math-related:1,math-related stuff:1,like BSP:1,trees graphs:1,graphs discrete:1,discrete math:1,math for:1,for edge:1,edge stepping:1,stepping and:1,and affine:1,affine and:1,texture mappings:1,mappings goes:1,a production-quality:1,production-quality game:1,game While:1,surely true:1,true dot:1,products together:1,with matrix:1,projection constitute:1,what most:1,are asking:1,asking about:1,about when:1,they inquire:1,inquire about:1,see are:1,are key:1,key tools:1,useful 3-D:1,the mail:1,mail made:1,made clear:1,clear was:1,people out:1,who don’t:1,either type:1,of product:1,product at:1,least insofar:1,insofar as:1,3-D Since:1,Since much:1,much or:1,even most:1,most advanced:1,advanced 3-D:1,graphics machinery:1,machinery relies:1,relies to:1,greater or:1,or lesser:1,lesser extent:1,extent on:1,on dot:1,products even:1,intersection formula:1,formula I:1,a quotient:1,quotient of:1,of dot:1,spend this:1,chapter examining:1,examining these:1,these basic:1,basic tools:1,3-D applications:1,applications If:1,is old:1,you my:1,to BSP-based:1,rendering in:1,chapter Foundation:1,Foundation Definitions:1,Definitions The:1,products themselves:1,straightforward and:1,require almost:1,no context:1,I need:1,define some:1,some terms:1,terms I’ll:1,use when:1,when describing:1,describing applications:1,applications of:1,the products:1,products so:1,that now:1,with dot:1,assume you:1,math background:1,or we’ll:1,we’ll never:1,never get:1,stuff So:1,So I’m:1,quickly define:1,a magnitude:1,magnitude represented:1,coordinate pair:1,or triplet:1,3-D relative:1,origin That’s:1,pretty sloppy:1,sloppy definition:1,definition but:1,but it’ll:1,it’ll do:1,McCoy I:1,you check:1,out Calculus:1,Calculus and:1,and Analytic:1,Analytic Geometry:1,Geometry by:1,by Thomas:1,Thomas and:1,and Finney:1,Finney Addison-Wesley:1,Addison-Wesley ISBN:1,ISBN 0-201-52929-7:1,0-201-52929-7 So:1,vector V:1,V 5:1,5 0:1,0 5:1,5 has:1,or magnitude:1,magnitude by:1,the Pythagorean:1,Pythagorean theorem:1,theorem of:1,of eq:1,eq 1:1,where vertical:1,vertical double:1,double bars:1,bars denote:1,denote vector:1,vector length:1,z axes:1,axes exactly:1,two axes:1,axes I’ll:1,system whereby:1,whereby if:1,you wrap:1,wrap the:1,hand around:1,your thumb:1,thumb pointing:1,pointing in:1,z direction:1,direction your:1,fingers will:1,will curl:1,curl from:1,axis The:1,The positive:1,runs left:1,runs bottom:1,bottom to:1,to top:1,top across:1,runs into:1,purposes projection:1,mapping coordinates:1,or surface:1,surface Perspective:1,projection projects:1,projects 3-D:1,3-D coordinates:1,a viewplane:1,viewplane scaling:1,scaling coordinates:1,coordinates according:1,their z:1,provide proper:1,proper perspective:1,perspective Objectspace:1,Objectspace is:1,which an:1,defined independent:1,itself Worldspace:1,Worldspace is:1,absolute frame:1,world all:1,objects locations:1,are with:1,worldspace and:1,reference around:1,direction move:1,move Viewspace:1,Viewspace is:1,is worldspace:1,worldspace as:1,viewpoint looking:1,direction Screenspace:1,Screenspace is:1,is viewspace:1,viewspace after:1,after perspective:1,screen Finally:1,Finally transformation:1,converting points:1,into another:1,case that’ll:1,that’ll mean:1,mean rotating:1,and translating:1,moving points:1,from objectspace:1,objectspace or:1,or worldspace:1,viewspace For:1,For additional:1,out Foley:1,Foley van:1,Graphics ISBN:1,0-201-12110-7 or:1,the chapters:1,book dealing:1,library The:1,product Given:1,Given two:1,vectors U:1,U u_1:1,u_1 u_2:1,u_2 u_3:1,u_3 and:1,and V:1,V v_1:1,v_1 v_2:1,v_2 v_3:1,v_3 their:1,their dot:1,the symbol:1,symbol is:1,as eq:1,eq 2:1,2 As:1,a scalar:1,scalar value:1,single real-valued:1,real-valued number:1,number not:1,another vector:1,product what:1,us Not:1,Not much:1,product isn’t:1,isn’t of:1,graphics until:1,start thinking:1,way eq:1,eq 3:1,where q:1,vectors and:1,two terms:1,terms are:1,vectors as:1,61.1 Although:1,obvious equation:1,3 has:1,of applications:1,graphics Dot:1,Dot Products:1,Products of:1,of Unit:1,Unit Vectors:1,Vectors The:1,simplest case:1,both vectors:1,vectors are:1,their lengths:1,one as:1,in Equation:1,case equation:1,3 simplifies:1,simplifies to:1,eq 4:1,them One:1,find angles:1,angles between:1,between unit:1,an inverse:1,inverse cosine:1,cosine function:1,or lookup:1,graphics lies:1,in lighting:1,lighting surfaces:1,between incident:1,incident light:1,the light’s:1,light’s full:1,intensity at:1,illuminated as:1,in eq:1,eq 5:1,5 Figure:1,product where:1,I s:1,I l:1,and q:1,between D:1,l where:1,where D:1,light direction:1,the inverse:1,inverse light:1,normal are:1,both unit:1,vectors then:1,calculation can:1,four multiplies:1,three additions—and:1,additions—and no:1,no explicit:1,explicit cosine:1,cosine calculations—as:1,calculations—as eq:1,eq 6:1,6 where:1,N s:1,and D:1,light unit:1,unit direction:1,61.2 Cross:1,Cross Products:1,Products and:1,the Generation:1,Generation of:1,of Polygon:1,Polygon Normals:1,Normals One:1,One question:1,question equation:1,equation 6:1,6 begs:1,begs is:1,normal comes:1,from One:1,extra data:1,data point:1,point with:1,start being:1,being some:1,and transform:1,transform it:1,advantage that:1,normal starts:1,normal it:1,up that:1,only rotations:1,translations but:1,not scaling:1,and shears:1,shears are:1,with having:1,having an:1,explicit normal:1,remain a:1,a normal—that:1,normal—that is:1,the surface—only:1,surface—only through:1,through viewspace:1,viewspace Rotation:1,Rotation translation:1,scaling preserve:1,preserve right:1,angles which:1,why normals:1,normals are:1,still normals:1,but perspective:1,projection does:1,not preserve:1,preserve angles:1,angles so:1,so vectors:1,were surface:1,surface normals:1,viewspace are:1,longer normals:1,intensity Figure:1,intensity Why:1,this matter:1,matter It:1,matters because:1,hence shouldn’t:1,drawn One:1,identify such:1,they’re facing:1,toward or:1,or away:1,viewer that:1,whether their:1,their normals:1,normals have:1,have negative:1,they’re visible:1,visible or:1,or positive:1,culled However:1,However we’re:1,about screenspace:1,normals here:1,projection can:1,can shift:1,shift a:1,polygon relative:1,although its:1,its viewspace:1,viewspace normal:1,z its:1,its screenspace:1,a positive:1,61.3 So:1,need screenspace:1,normals but:1,those can’t:1,can’t readily:1,worldspace Figure:1,visibility Figure:1,visibility The:1,The formula:1,is eq:1,eq 7:1,7 Note:1,product operation:1,is denoted:1,X Unlike:1,product the:1,vector Not:1,Not just:1,vector either:1,vector generated:1,vectors Thus:1,product can:1,any surface:1,surface for:1,normals we:1,need by:1,61.4 In:1,can cull:1,cull with:1,only one-third:1,one-third the:1,work needed:1,full cross:1,product because:1,interested only:1,skip entirely:1,entirely calculating:1,y components:1,components The:1,only caveat:1,caveat is:1,careful that:1,neither edge:1,edge you:1,choose is:1,is zero-length:1,zero-length and:1,aren’t collinear:1,collinear because:1,product can’t:1,can’t produce:1,cases Figure:1,normal Perhaps:1,often asked:1,asked question:1,about cross:1,is Which:1,Which way:1,way do:1,do normals:1,normals generated:1,by cross:1,products go:1,go In:1,system curl:1,curl the:1,hand so:1,fingers curl:1,curl through:1,angle of:1,of less:1,degrees from:1,second vector:1,vector Your:1,Your thumb:1,thumb now:1,now points:1,two orthogonal:1,orthogonal right-angle:1,right-angle unit:1,vectors the:1,that’s orthogonal:1,orthogonal to:1,you’re generating:1,coordinate space—such:1,space—such as:1,new viewing:1,viewing frame:1,of reference—you:1,reference—you only:1,with unit:1,vectors for:1,axes for:1,use their:1,their cross:1,third axis:1,axis If:1,need unit:1,unit normals:1,normals and:1,vectors being:1,being crossed:1,crossed aren’t:1,aren’t orthogonal:1,vectors you’ll:1,to normalize:1,normalize the:1,resulting vector:1,vector that:1,is divide:1,the vector’s:1,vector’s components:1,components by:1,long Using:1,the Sign:1,Sign of:1,Product The:1,the magnitudes:1,magnitudes of:1,vectors Magnitudes:1,Magnitudes are:1,always positive:1,positive so:1,cosine determines:1,positive if:1,degrees negative:1,negative if:1,it’s greater:1,and zero:1,degrees This:1,product suffices:1,for tests:1,tests involving:1,involving comparisons:1,comparisons of:1,of angles:1,to 90:1,those than:1,culling which:1,using screenspace:1,determine polygon:1,orientation relative:1,requires each:1,then perspective:1,perspective projected:1,screenspace before:1,test can:1,of time-consuming:1,time-consuming calculation:1,calculation Instead:1,perform culling:1,culling way:1,even earlier:1,in objectspace:1,objectspace if:1,we transform:1,transform the:1,viewpoint into:1,reference given:1,viewer Here’s:1,trick Calculate:1,any vertex:1,take its:1,its dot:1,61.5 If:1,negative because:1,degrees If:1,positive and:1,is edge-on:1,edge-on the:1,to it—and:1,it—and this:1,culling happens:1,happens before:1,any transformation:1,transformation or:1,or projection:1,projection at:1,performed saving:1,average that:1,culled Backface:1,of determining:1,plane any:1,same trick:1,applied whenever:1,plane where:1,plane which:1,origin plus:1,normal One:1,in clipping:1,line such:1,Just do:1,origin and:1,and repeat:1,repeat for:1,other line:1,endpoint If:1,same no:1,needed if:1,they differ:1,differ clipping:1,needed And:1,yes the:1,actual clipping:1,product Using:1,Product for:1,for Projection:1,Projection Consider:1,Consider Equation:1,3 again:1,time make:1,vectors say:1,say V:1,V a:1,eq 8:1,8 In:1,that cosine:1,cosine is:1,really just:1,adjacent leg:1,the hypotenuse:1,hypotenuse of:1,all sides:1,triangles scale:1,scale equally:1,equally What:1,all works:1,vector projected:1,61.6 Figure:1,projection This:1,This unlocks:1,unlocks all:1,stuff Want:1,Just dot:1,point P:1,P to:1,origin O:1,O p:1,p with:1,plane unit:1,normal N:1,N p:1,p to:1,then take:1,value distance:1,distance P:1,P Op:1,Op Np:1,Np as:1,61.7 Want:1,plane Calculate:1,one endpoint:1,full length:1,two dot:1,endpoint the:1,that distance:1,endpoint and:1,Listing 61.1:1,61.1 Rotation:1,by Projection:1,Projection We:1,dot product’s:1,product’s projection:1,projection capability:1,at rotation:1,rotation in:1,interesting way:1,way Typically:1,Typically rotations:1,rotations are:1,are represented:1,by matrices:1,matrices This:1,workable representation:1,representation that:1,that encapsulates:1,encapsulates all:1,all aspects:1,transformation in:1,for concatenations:1,concatenations of:1,translations One:1,with matrices:1,matrices though:1,people myself:1,included have:1,hard time:1,time looking:1,of sines:1,and visualizing:1,visualizing what’s:1,on So:1,3-D experts:1,experts John:1,Carmack and:1,and Billy:1,Zelsnack mentioned:1,they think:1,rotation differently:1,worth passing:1,passing on:1,plane Their:1,Their approach:1,this Think:1,as projecting:1,projecting coordinates:1,axes That:1,have points:1,say worldspace:1,worldspace define:1,space viewspace:1,viewspace for:1,rotate to:1,three orthogonal:1,vectors defining:1,then project:1,project each:1,shown for:1,2-D case:1,61.8 In:1,3-D this:1,products per:1,per point:1,point one:1,Translation can:1,done separately:1,separately from:1,from rotation:1,by simple:1,simple addition:1,addition Rotation:1,as rotation:1,rotation via:1,via matrix:1,the rows:1,the orthogonal:1,vectors pointing:1,pointing along:1,axes Rotation:1,projection buys:1,buys us:1,us no:1,no technical:1,technical advantages:1,advantages so:1,not what’s:1,what’s important:1,important here:1,projection together:1,separate translation:1,translation step:1,step gives:1,at transformation:1,I for:1,one find:1,find easier:1,visualize and:1,and experiment:1,with A:1,3-D frames:1,frames of:1,reference if:1,will Three:1,Three things:1,things I’ve:1,a clearer:1,clearer more:1,intuitive model:1,whatever it:1,is you’re:1,you’re working:1,new tools:1,tools or:1,or new:1,new ways:1,use old:1,old tools:1,tools are:1,are Good:1,Good Things:1,Things My:1,product tricks:1,tricks in:1,general offer:1,offer those:1,those sorts:1,of benefits:1,benefits for:1,3-D Figure:1,axes Figure:1,axes Chapter:1,62 One:1,One Story:1,Story Two:1,Two Rules:1,Rules and:1,Renderer Taking:1,a Compiled:1,Compiled BSP:1,Tree from:1,from Logical:1,Logical to:1,to Visual:1,Visual Reality:1,I’ve noted:1,noted before:1,before I’m:1,Software’s follow-up:1,follow-up to:1,DOOM A:1,A month:1,so back:1,back we:1,added page:1,the startling:1,startling discovery:1,discovery that:1,ran nearly:1,fast with:1,did with:1,alternative method:1,copying it:1,were delighted:1,delighted by:1,but baffled:1,baffled I:1,few tests:1,possible explanations:1,explanations including:1,including slow:1,slow writes:1,writes through:1,cache poor:1,poor main:1,frame from:1,memory Although:1,Although each:1,these can:1,indeed affect:1,performance none:1,none seemed:1,speedup so:1,assumed there:1,some hidden:1,hidden hardware:1,hardware interaction:1,interaction at:1,work Anyway:1,Anyway why:1,why was:1,was secondary:1,secondary what:1,really mattered:1,mattered was:1,which meant:1,meant I:1,as widely:1,widely as:1,was using:1,Pentium’s built-in:1,built-in performance:1,to seek:1,out areas:1,areas for:1,for improvement:1,for no:1,particular reason:1,reason checked:1,performed while:1,while copying:1,in non-page-flipped:1,non-page-flipped mode:1,answer was:1,was 64000:1,64000 That:1,That seemed:1,seemed odd:1,odd since:1,were 64000:1,64000 byte-sized:1,byte-sized pixels:1,was calling:1,calling memcpy:1,memcpy which:1,course performs:1,performs copies:1,thought maybe:1,counters report:1,report the:1,written rather:1,fortunately this:1,tested my:1,my assumptions:1,assumptions by:1,an ASM:1,ASM routine:1,frame a:1,of memcpy:1,memcpy This:1,counters reported:1,reported 16000:1,16000 writes:1,writes Whoops:1,Whoops As:1,memcpy routine:1,our compiler:1,compiler gcc:1,gcc inexplicably:1,inexplicably copies:1,copies memory:1,With my:1,my new:1,new routine:1,routine the:1,the non-page-flipped:1,non-page-flipped approach:1,approach suddenly:1,suddenly became:1,became slightly:1,slightly faster:1,first relevant:1,relevant rule:1,obvious Assume:1,nothing Measure:1,Measure early:1,early and:1,often Know:1,Know what’s:1,runs if:1,drift To:1,do otherwise:1,otherwise is:1,to risk:1,risk looking:1,looking mighty:1,mighty foolish:1,foolish The:1,second rule:1,rule When:1,do look:1,look foolish:1,foolish and:1,and trust:1,trust me:1,do challenging:1,challenging work:1,work have:1,good laugh:1,laugh at:1,at yourself:1,a reminder:1,reminder of:1,hadn’t done:1,extra page-flipping:1,page-flipping work:1,work yet:1,yet so:1,didn’t waste:1,waste any:1,time due:1,my faulty:1,faulty assumption:1,that memcpy:1,memcpy performed:1,a maximum-speed:1,maximum-speed copy:1,copy but:1,just luck:1,luck I:1,done experiments:1,experiments until:1,sure I:1,knew what:1,on before:1,drawing any:1,any conclusions:1,conclusions and:1,and acting:1,general make:1,point not:1,a tightly:1,tightly focused:1,focused rut:1,rut stay:1,stay loose:1,loose and:1,of alternative:1,alternative possibilities:1,always keep:1,keep asking:1,asking questions:1,questions It’ll:1,It’ll pay:1,big in:1,hadn’t indulged:1,indulged my:1,my curiosity:1,curiosity by:1,Pentium counter:1,counter test:1,the copy:1,no specific:1,specific reason:1,have discovered:1,memcpy problem—and:1,problem—and by:1,doing I:1,I doubled:1,in five:1,minutes a:1,rare accomplishment:1,accomplishment indeed:1,indeed By:1,in of:1,counters and:1,is Mike:1,Mike Schmit’s:1,Schmit’s book:1,book Pentium:1,Processor Optimization:1,Optimization Tools:1,Tools AP:1,AP Professional:1,Professional ISBN:1,ISBN 0-12-627230-1:1,0-12-627230-1 Onward:1,to rendering:1,tree BSP-based:1,BSP-based Rendering:1,Rendering For:1,chapters I’ve:1,discussing the:1,BSP Binary:1,Partitioning trees:1,60 I:1,trees Now:1,use those:1,those compiled:1,compiled BSP:1,do realtime:1,realtime rendering:1,rendering As:1,compiler took:1,and built:1,walls as:1,62.1 The:1,pieces by:1,root wall:1,then split:1,again by:1,is carved:1,into subspaces:1,subspaces along:1,walls Figure:1,them Our:1,Our objective:1,whenever walls:1,walls overlap:1,overlap we:1,nearer wall:1,each overlapped:1,overlapped pixel:1,simplest way:1,order assuming:1,assuming no:1,interpenetrate or:1,or form:1,form cycles:1,cycles BSP:1,trees guarantee:1,interpenetrate such:1,order Given:1,render a:1,tree all:1,is descend:1,descend the:1,tree deciding:1,deciding at:1,node whether:1,node from:1,viewpoint We:1,We use:1,first recursively:1,recursively descend:1,descend and:1,finally draw:1,nearer subtree:1,node Applied:1,trees this:1,approach guarantees:1,that overlapping:1,overlapping polygons:1,this fashion:1,fashion Because:1,the printed:1,printed page:1,page Listing:1,BSP renderer:1,renderer without:1,program framework:1,framework some:1,math routines:1,routines and:1,rasterizer but:1,as DDJBSP2.ZIP:1,DDJBSP2.ZIP Listing:1,a compressed:1,compressed format:1,format with:1,little whitespace:1,whitespace the:1,full version:1,version on:1,CD-ROM is:1,is formatted:1,formatted normally:1,normally The:1,The Rendering:1,Rendering Pipeline:1,Pipeline Conceptually:1,Conceptually rendering:1,tree really:1,complicated The:1,full rendering:1,rendering pipeline:1,as coordinated:1,coordinated by:1,by UpdateWorld:1,UpdateWorld is:1,this Update:1,Update the:1,location Transform:1,Transform all:1,all wall:1,wall endpoints:1,endpoints into:1,current viewing:1,angle Clip:1,Clip all:1,walls to:1,pyramid Project:1,Project wall:1,coordinates Walk:1,Walk the:1,walls back:1,that lies:1,lies at:1,pyramid perform:1,culling skip:1,skip walls:1,walls facing:1,wall if:1,not culled:1,culled Next:1,pipeline more:1,more closely:1,closely The:1,The pipeline:1,detail Some:1,Some sources:1,reading are:1,Dam ISBN:1,0-201-12110-7 and:1,DDJ Essential:1,Essential Books:1,Books on:1,Programming CD:1,CD Moving:1,Moving the:1,the Viewer:1,Viewer The:1,sample BSP:1,BSP program:1,program performs:1,performs first-person:1,first-person rendering:1,rendering that:1,renders the:1,eyes as:1,The rate:1,by key-handling:1,62.1 however:1,the variables:1,variables set:1,the key-handling:1,in UpdateViewPos:1,UpdateViewPos to:1,location up:1,date Note:1,view position:1,position can:1,z movement:1,movement around:1,the but:1,only viewing:1,viewing horizontally:1,2-D it:1,support looking:1,extent particularly:1,world dataset:1,dataset is:1,is restricted:1,restricted so:1,never two:1,rooms stacked:1,stacked on:1,any tilted:1,tilted walls:1,walls For:1,For simplicity’s:1,simplicity’s sake:1,sake I:1,62.1 but:1,it educational:1,educational to:1,program yourself:1,yourself Transformation:1,Transformation into:1,into Viewspace:1,Viewspace The:1,angle which:1,controls direction:1,movement as:1,can sweep:1,sweep through:1,full 360:1,360 degrees:1,degrees around:1,it remains:1,remains horizontal:1,key handler:1,handler and:1,vector stored:1,in currentorientation:1,currentorientation that:1,that explicitly:1,explicitly defines:1,direction the:1,and implicitly:1,implicitly defines:1,viewspace because:1,that axis:1,at right:1,axis where:1,x increases:1,increases to:1,viewer As:1,chapter rotation:1,system can:1,points onto:1,axes of:1,what TransformVertices:1,TransformVertices does:1,does after:1,after first:1,first translating:1,its origin:1,origin at:1,viewpoint It’s:1,translation first:1,viewing rotation:1,is around:1,viewpoint Note:1,can equivalently:1,equivalently be:1,math operation:1,common way:1,handle transformations:1,transformations At:1,scaled in:1,x according:1,to PROJECTION_RATIO:1,PROJECTION_RATIO to:1,view Larger:1,Larger scale:1,scale values:1,values result:1,in narrower:1,narrower fields:1,view When:1,viewspace ready:1,clipped Clipping:1,walls may:1,anywhere relative:1,front behind:1,behind off:1,side We:1,We only:1,only want:1,that properly:1,properly belong:1,belong on:1,is those:1,parts that:1,pyramid view:1,frustum as:1,62.2 Unclipped:1,Unclipped walls—walls:1,walls—walls that:1,lie entirely:1,the frustum—should:1,frustum—should be:1,entirety fully:1,walls should:1,and partially:1,walls must:1,be trimmed:1,trimmed before:1,62.1 ClipWalls:1,ClipWalls does:1,steps for:1,turn First:1,wall are:1,calculated Remember:1,Remember walls:1,are vertical:1,their ends:1,ends go:1,end have:1,same x:1,coordinates If:1,near side:1,side then:1,isn’t z-clipped:1,z-clipped and:1,unchanged If:1,polygon straddles:1,trimmed to:1,stop at:1,by adjusting:1,nearest endpoint:1,endpoint appropriately:1,appropriately this:1,of scaling:1,scaling by:1,z because:1,distance The:1,for parametric:1,lines was:1,was discussed:1,60 The:1,is further:1,further simplified:1,simplified because:1,as lines:1,lines viewed:1,perform 2-D:1,z this:1,if walls:1,walls sloped:1,sloped or:1,had sloping:1,sloping edges:1,After clipping:1,z we:1,clip by:1,by viewspace:1,viewspace x:1,wall portions:1,lie between:1,screen Like:1,Like z-clipping:1,z-clipping x-clipping:1,x-clipping can:1,2-D clip:1,clip because:1,vertical We:1,We compare:1,compare both:1,and endpoint:1,endpoint of:1,and reject:1,reject accept:1,accept or:1,or clip:1,each wall’s:1,wall’s t:1,values accordingly:1,The test:1,for x:1,x clipping:1,planes where:1,and x:1,z Figure:1,pyramid Figure:1,pyramid The:1,final clip:1,clip stage:1,clipping by:1,by y:1,complicated because:1,because vertical:1,angle in:1,62.3 so:1,so true:1,true 3-D:1,four wall:1,vertices is:1,involved We:1,We handle:1,ClipWalls by:1,detecting trivial:1,rejection in:1,y using:1,using y:1,z as:1,the y:1,y boundaries:1,frustum However:1,leave partial:1,partial clipping:1,clipping problem:1,earlier z-clip:1,z-clip to:1,plane guarantees:1,no remaining:1,remaining polygon:1,have z:1,0 ensuring:1,we project:1,project we’ll:1,we’ll always:1,always pass:1,pass valid:1,valid y-clippable:1,y-clippable screenspace:1,screenspace vertices:1,filler Projection:1,Projection to:1,to Screenspace:1,Screenspace At:1,have viewspace:1,viewspace vertices:1,wall that’s:1,partially visible:1,visible All:1,is project:1,project these:1,these vertices:1,vertices according:1,to z:1,z distance—that:1,distance—that is:1,is perform:1,perform perspective:1,perspective projection—and:1,projection—and scale:1,draw Although:1,this step:1,is logically:1,logically separate:1,from clipping:1,clipping it:1,last step:1,step for:1,for visible:1,visible walls:1,ClipWalls Figure:1,clipping Figure:1,clipping Walking:1,Walking the:1,the Tree:1,Tree Backface:1,Backface Culling:1,and Drawing:1,Drawing Now:1,walls clipped:1,with vertices:1,vertices projected:1,coordinates all:1,draw them:1,front that’s:1,of DrawWallsBackToFront:1,DrawWallsBackToFront Basically:1,Basically this:1,this routine:1,routine walks:1,walks the:1,tree descending:1,descending recursively:1,farther children:1,node first:1,nearer children:1,children In:1,efficiency this:1,implementation performs:1,data-recursive walk:1,more familiar:1,recursion Interestingly:1,Interestingly the:1,performance speedup:1,speedup from:1,from data:1,recursion turned:1,more modest:1,modest than:1,expected based:1,experience see:1,59 for:1,further details:1,wall DrawWallsBackToFront:1,DrawWallsBackToFront first:1,first descends:1,descends to:1,subtree Next:1,Next if:1,and pointing:1,solid polygon:1,filler not:1,filler I:1,38 and:1,and 39:1,39 It’s:1,noting how:1,how backface:1,and front/back:1,front/back wall:1,wall orientation:1,orientation testing:1,testing are:1,performed Note:1,that walls:1,always one-sided:1,one-sided visible:1,visible only:1,front I:1,discussed backface:1,culling in:1,and mentioned:1,mentioned two:1,approaches generating:1,a screenspace:1,seeing which:1,or taking:1,world or:1,or screenspace:1,screenspace dot:1,sign Listing:1,62.1 does:1,does both:1,both but:1,is 2-D:1,viewer is:1,always upright:1,upright we:1,save some:1,work Consider:1,this Walls:1,Walls are:1,stored so:1,left end:1,end as:1,right end:1,vertex There:1,wall can:1,be positioned:1,positioned in:1,then viewed:1,front in:1,vertex or:1,or viewed:1,62.4 So:1,wall we’re:1,seeing and:1,thus backface:1,backface cull:1,cull simply:1,vertices a:1,simple 2-D:1,2-D version:1,The wall:1,wall orinetation:1,orinetation test:1,test used:1,for walking:1,tree performed:1,in WallFacingViewer:1,WallFacingViewer takes:1,and checks:1,viewspace sign:1,wall’s normal:1,normal with:1,wall Again:1,takes advantage:1,2-D nature:1,wall normal:1,normal by:1,swapping x:1,and altering:1,altering signs:1,signs We:1,the quicker:1,quicker screenspace:1,x test:1,test here:1,culling because:1,screenspace for:1,example trying:1,project a:1,at z:1,0 would:1,in division:1,by zero:1,zero All:1,visible front-facing:1,front-facing walls:1,buffer by:1,by DrawWallsBackToFront:1,DrawWallsBackToFront then:1,then UpdateWorld:1,UpdateWorld calls:1,calls Win32:1,Win32 to:1,The frame:1,complete Figure:1,screenspace Notes:1,Renderer Listing:1,from complete:1,complete or:1,or optimal:1,optimal There:1,tiny BSP:1,BSP rendering:1,rendering demo:1,demo because:1,because 3D:1,3D rendering:1,rendering even:1,when based:1,tree requires:1,substantial amount:1,reasonably close:1,minimum rendering:1,specifically intended:1,to illuminate:1,illuminate basic:1,basic BSP:1,BSP principles:1,principles given:1,already larger:1,be Think:1,62.1 as:1,learning tool:1,obvious lack:1,lack in:1,no support:1,ceilings the:1,walls float:1,float in:1,space unsupported:1,unsupported Is:1,a normal-looking:1,normal-looking world:1,world No:1,No Although:1,Although 3-D:1,trees offer:1,offer many:1,many advantages:1,allow arbitrary:1,arbitrary datasets:1,datasets with:1,viewing in:1,arbitrary direction:1,truth aren’t:1,aren’t much:1,for back-to-front:1,drawing they:1,do tend:1,be larger:1,debug and:1,they aren’t:1,aren’t necessary:1,ceilings One:1,get floors:1,ceilings out:1,longer stored:1,splitting nodes:1,nodes Instead:1,Instead each:1,the tree—that:1,tree—that is:1,subspace carved:1,the tree—would:1,tree—would store:1,ceilings that:1,face into:1,The subspace:1,convex because:1,all BSP:1,BSP subspaces:1,automatically convex:1,convex so:1,subspace can:1,order Thus:1,the subspaces:1,subspaces in:1,would each:1,each be:1,turn as:1,convex sets:1,sets back:1,front just:1,polygons back:1,front This:1,tree organized:1,organized around:1,around volumes:1,volumes rather:1,polygons has:1,additional interesting:1,interesting advantages:1,in simulating:1,simulating physics:1,physics detecting:1,detecting collisions:1,collisions doing:1,doing line-of-sight:1,performing volume-based:1,volume-based operations:1,as dynamic:1,dynamic illumination:1,and event:1,event triggering:1,triggering However:1,that discussion:1,until another:1,another day:1,Chapter 63:1,63 Floating-Point:1,Floating-Point for:1,for Real-Time:1,Real-Time 3-D:1,3-D Knowing:1,to Hurl:1,Hurl Conventional:1,Conventional Math:1,Math Wisdom:1,Wisdom Out:1,Out the:1,the Window:1,Window In:1,crisis sometimes:1,your head—but:1,head—but not:1,often When:1,turned 16:1,16 my:1,mother had:1,aging three-cylinder:1,three-cylinder Saab—not:1,Saab—not one:1,the sporty:1,sporty Saabs:1,Saabs that:1,that appeared:1,70s but:1,a blunt-nosed:1,blunt-nosed ungainly:1,ungainly little:1,little wagon:1,wagon that:1,that seated:1,seated up:1,seven people:1,in sardine-like:1,sardine-like comfort:1,comfort with:1,them perched:1,perched on:1,gas tank:1,tank That:1,car I:1,drive on:1,took whenever:1,go somewhere:1,somewhere and:1,mother didn’t:1,didn’t need:1,My father’s:1,father’s car:1,a Volvo:1,sedan only:1,easily the:1,the classiest:1,classiest car:1,car my:1,family had:1,ever owned:1,owned To:1,my recollection:1,recollection as:1,Year’s of:1,never driven:1,driven that:1,that car:1,car However:1,a New:1,Year’s party—in:1,party—in fact:1,to chauffeur:1,chauffeur four:1,four other:1,other people—and:1,people—and for:1,reasons lost:1,the mists:1,mists of:1,was allowed:1,Volvo So:1,So one:1,one crystal:1,crystal clear:1,clear stunningly:1,stunningly cold:1,cold night:1,I picked:1,my passengers:1,passengers who:1,who included:1,included Robin:1,Robin Viola:1,Viola Kathy:1,Kathy Smith:1,Smith Jude:1,Jude Hawron…and:1,Hawron…and Alan:1,Alan whose:1,whose last:1,last name:1,name I’ll:1,I’ll omit:1,omit in:1,case he:1,he wants:1,for president:1,president someday:1,someday The:1,The party:1,party was:1,at Craig:1,Craig Alexander’s:1,Alexander’s house:1,house way:1,of nowhere:1,nowhere and:1,heard Al:1,Al Green:1,Green for:1,much beer:1,beer was:1,was consumed:1,consumed none:1,none by:1,by me:1,me though:1,around 2:1,2 a.m:1,a.m we:1,to head:1,head home:1,we piled:1,Volvo cranked:1,cranked the:1,the heat:1,heat up:1,the max:1,max and:1,set off:1,off We:1,had gone:1,gone about:1,miles when:1,I sensed:1,sensed Alan:1,tell me:1,me something:1,something As:1,turned toward:1,toward him:1,him he:1,said quite:1,quite expressively:1,expressively BLEARGH:1,BLEARGH and:1,and deposited:1,deposited a:1,considerable volume:1,what had:1,had until:1,until recently:1,recently been:1,been beer:1,chips into:1,his lap:1,lap Mind:1,this wasn’t:1,wasn’t just:1,any car:1,car Alan:1,was tossing:1,tossing his:1,his cookies:1,cookies in—it:1,in—it was:1,my father’s:1,father’s prized:1,prized Volvo:1,Volvo My:1,My reactions:1,reactions were:1,task without:1,moment’s hesitation:1,hesitation I:1,I shouted:1,shouted Do:1,Do it:1,window Open:1,Open the:1,window Alan:1,Alan obligingly:1,obligingly rolled:1,rolled the:1,window down:1,with flawless:1,flawless aim:1,aim sent:1,sent some:1,more erstwhile:1,erstwhile beer:1,chips on:1,was here:1,fast decisions:1,necessarily good:1,good decisions:1,decisions A:1,second after:1,the liquid:1,liquid flew:1,flew out:1,window there:1,a loud:1,loud smacking:1,smacking sound:1,sound and:1,a yelp:1,yelp from:1,from Robin:1,Robin as:1,the sodden:1,sodden mass:1,mass hit:1,the slipstream:1,slipstream and:1,and splattered:1,splattered along:1,car At:1,did what:1,place I:1,stopped the:1,so Alan:1,Alan could:1,get out:1,finish being:1,sick in:1,in peace:1,peace while:1,I assessed:1,assessed the:1,full dimensions:1,the disaster:1,disaster Not:1,only was:1,rear half:1,the passenger:1,passenger side—including:1,side—including Robin’s:1,Robin’s window:1,window accounting:1,the yelp—covered:1,yelp—covered but:1,the noxious:1,noxious substance:1,substance had:1,had frozen:1,frozen solid:1,solid It:1,It looked:1,like someone:1,someone had:1,had melted:1,melted an:1,enormous candle:1,candle or:1,possibly put:1,put cake:1,cake frosting:1,frosting on:1,car The:1,next morning:1,morning my:1,was remarkably:1,remarkably good-natured:1,good-natured about:1,thing considering:1,considering although:1,remember ever:1,actually driving:1,Volvo again:1,again My:1,My penance:1,penance consisted:1,of cleaning:1,cleaning the:1,car no:1,no small:1,small punishment:1,punishment considering:1,a hair:1,hair dryer:1,dryer out:1,our unheated:1,unheated garage:1,garage and:1,and melt:1,melt and:1,and clean:1,clean the:1,the gunk:1,gunk one:1,small piece:1,piece at:1,this debacle:1,debacle is:1,pull over:1,over very:1,very very:1,anyone shows:1,shows signed:1,signed of:1,being ill:1,ill a:1,wisdom that:1,proven useful:1,a suprising:1,suprising number:1,years More:1,important though:1,the lesson:1,it almost:1,always pays:1,to size:1,size up:1,crisis situation:1,situation and:1,choose an:1,effective response:1,response and:1,that’s served:1,served me:1,me well:1,well more:1,count There’s:1,close analog:1,analog to:1,programming Often:1,Often when:1,her code:1,programmer’s response:1,response is:1,solution as:1,immediately hack:1,hack it:1,in For:1,problems though:1,are side:1,issues involved:1,involved that:1,be thought:1,thought through:1,through before:1,any coding:1,coding is:1,of bugs:1,other problem:1,problem situations:1,situations as:1,as opportunities:1,reexamine how:1,as chances:1,chances to:1,correct structural:1,structural defects:1,defects I:1,hadn’t previously:1,previously suspected:1,suspected in:1,fact I’m:1,I’m often:1,often able:1,simplify code:1,I fix:1,fix a:1,bug thanks:1,understanding I:1,I gain:1,gain in:1,process Taking:1,Taking that:1,step farther:1,farther it’s:1,reexamine assumptions:1,assumptions periodically:1,periodically even:1,no bugs:1,bugs are:1,involved You:1,quickly assumptions:1,once were:1,were completely:1,completely valid:1,valid can:1,can deteriorate:1,deteriorate For:1,consider floating-point:1,math Not:1,Not Your:1,Your Father’s:1,Father’s Floating-Point:1,Floating-Point Until:1,Until last:1,never done:1,any serious:1,serious floating-point:1,floating-point FP:1,FP math:1,math had:1,been fast:1,write It:1,faith that:1,FP while:1,while undeniably:1,undeniably convenient:1,convenient because:1,its automatic:1,automatic support:1,for constant:1,constant precision:1,precision over:1,enormous range:1,of magnitudes:1,magnitudes was:1,not fast:1,programming so:1,like pretty:1,much everyone:1,else doing:1,3-D expended:1,expended a:1,making fixed-point:1,fixed-point do:1,job That:1,That article:1,faith was:1,true up:1,old assumptions:1,Pentium for:1,reasons faster:1,faster FP:1,a pipelined:1,pipelined floating-point:1,unit FPU:1,a parallel:1,parallel FXCH:1,FXCH Taken:1,these mean:1,FP addition:1,subtraction are:1,as integer:1,FP multiplication:1,division have:1,much faster—all:1,faster—all with:1,precision advantages:1,FP Better:1,FPU has:1,own set:1,eight registers:1,floating-point can:1,help relieve:1,relieve pressure:1,pressure on:1,x86’s integer:1,integer registers:1,One effect:1,Pentium floating-point:1,floating-point on:1,gone from:1,being irrelevant:1,to real-time:1,element Quake:1,uses FP:1,FP all:1,way down:1,span rasterizer:1,rasterizer performing:1,performing several:1,several FP:1,operations every:1,pixels Floating-point:1,Floating-point has:1,only become:1,become important:1,become even:1,more crucial:1,crucial Hardware:1,Hardware accelerators:1,increase feasible:1,feasible scene:1,complexity meaning:1,meaning the:1,do less:1,less bit-twiddling:1,bit-twiddling and:1,more motion:1,motion physics:1,physics and:1,and line-of-sight:1,line-of-sight calculations:1,like as:1,getting you:1,floating-point for:1,3-D in:1,I’ll examine:1,Pentium FP:1,how some:1,some key:1,key mathematical:1,mathematical techniques:1,for 3-D—dot:1,3-D—dot product:1,product cross:1,product transformation:1,and projection—can:1,projection—can be:1,accelerated Pentium:1,Pentium Floating-Point:1,Floating-Point Optimization:1,Optimization I’m:1,assume you’re:1,you’re already:1,already familiar:1,with x86:1,FP code:1,general for:1,for additional:1,information check:1,out Intel’s:1,Manual order:1,order 241430-001:1,241430-001 1-800-548-4725:1,1-800-548-4725 a:1,doing Pentium:1,Pentium programming:1,sort I’d:1,also recommend:1,recommend taking:1,look around:1,around http:1,www.intel.com I’m:1,on six:1,six core:1,section FLD:1,FLD FST:1,FST FADD:1,FMUL and:1,FDIV First:1,at cycle:1,instructions FLD:1,FLD takes:1,is pushed:1,pushed onto:1,FP stack:1,and ready:1,use on:1,cycle FST:1,FST takes:1,cycles although:1,although when:1,when storing:1,storing to:1,potential extra:1,lost as:1,describe shortly:1,shortly FDIV:1,a painfully:1,slow instruction:1,taking 39:1,full precision:1,and 33:1,at double:1,double precision:1,default precision:1,for Visual:1,C 2.0:1,2.0 While:1,While FDIV:1,executes the:1,is occupied:1,occupied and:1,can’t process:1,process subsequent:1,subsequent FP:1,instructions until:1,FDIV finishes:1,finishes However:1,However during:1,executing with:1,cycle during:1,which FDIV:1,FDIV starts:1,simultaneously execute:1,IMUL IMUL:1,IMUL uses:1,only overlap:1,with FDIV:1,cycle this:1,means it’s:1,instructions an:1,executing at:1,happens for:1,example during:1,code There’s:1,limitation though:1,stream following:1,FDIV reaches:1,reaches a:1,a FP:1,an IMUL:1,IMUL then:1,all subsequent:1,subsequent instructions:1,instructions both:1,both integer:1,FP must:1,must wait:1,finished When:1,a FADD:1,FMUL instruction:1,executed it:1,instruction There’s:1,an exception:1,exception If:1,FST to:1,cycle lost:1,lost so:1,it’s 4:1,cycles from:1,instruction until:1,until an:1,FST of:1,value can:1,begin so:1,so takes:1,all Again:1,Again it’s:1,execute integer-unit:1,integer-unit instructions:1,instructions during:1,for FST:1,FST cycles:1,these FP:1,instructions starts:1,starts There’s:1,more exciting:1,exciting possibility:1,possibility here:1,though Given:1,Given properly:1,properly structured:1,structured code:1,of averaging:1,averaging 1:1,per FADD:1,FMUL The:1,The secret:1,is pipelining:1,pipelining Pipelining:1,Pipelining Latency:1,Latency and:1,and Throughput:1,Throughput The:1,Pentium’s FPU:1,first pipelined:1,pipelined x86:1,x86 FPU:1,FPU Pipelining:1,Pipelining means:1,instruction every:1,simultaneously handle:1,of completion:1,completion Only:1,Only certain:1,certain x86:1,instructions allow:1,allow another:1,cycle though:1,though FADD:1,FMUL are:1,are pipelined:1,pipelined but:1,but FST:1,FST and:1,FDIV are:1,not FLD:1,FLD executes:1,pipelining is:1,issue Thus:1,sequence FADD_1:1,FADD_1 can:1,N FSUB:1,FSUB can:1,1 FADD_2:1,FADD_2 can:1,FMUL can:1,3 At:1,of FADD_1:1,FADD_1 is:1,operand because:1,been 3:1,instruction started:1,started FSUB:1,final cycle:1,calculation FADD_2:1,FADD_2 is:1,starting its:1,its second:1,cycle with:1,cycle yet:1,after this:1,issued Each:1,instructions takes:1,starts but:1,they’re simultaneously:1,simultaneously processed:1,processed at:1,different pipeline:1,pipeline stages:1,stages one:1,is issued:1,issued and:1,instruction completes:1,completes every:1,cycle Thus:1,these instructions—that:1,instructions—that is:1,is available—is:1,available—is 3:1,the throughput—the:1,throughput—the rate:1,start new:1,new instructions—is:1,instructions—is 1:1,cycle An:1,An exception:1,an FMUL:1,FMUL only:1,so between:1,instructions there’s:1,1-cycle stall:1,stall and:1,following three:1,execute just:1,above pair:1,pair There’s:1,a caveat:1,caveat here:1,though A:1,A FP:1,instruction can’t:1,issued until:1,until its:1,its operands:1,The FPU:1,can reach:1,a throughput:1,because neither:1,the FLD:1,FLD nor:1,the FSUB:1,FSUB needs:1,the FADD:1,FADD Consider:1,Consider however:1,however where:1,the ST(0:1,ST(0 operand:1,to FSUB:1,by FADD:1,FADD Here:1,Here FSUB:1,FSUB can’t:1,until FADD:1,FADD has:1,completed so:1,2 stall:1,stall cycles:1,cycles between:1,When dependencies:1,dependencies like:1,this occur:1,occur the:1,FPU runs:1,at latency:1,latency rather:1,than throughput:1,throughput speeds:1,can drop:1,drop by:1,as two-thirds:1,two-thirds FXCH:1,FXCH One:1,One piece:1,still missing:1,missing Clearly:1,Clearly to:1,maximum throughput:1,throughput we:1,interleave FP:1,time ideally:1,ideally three:1,pipeline at:1,once Further:1,Further these:1,must not:1,not depend:1,for operands:1,operands But:1,But ST(0:1,ST(0 must:1,the operands:1,operands worse:1,worse FLD:1,FLD can:1,push into:1,and FST:1,FST can:1,only store:1,store from:1,ST(0 How:1,then can:1,keep three:1,three independent:1,independent instructions:1,going The:1,easy answer:1,answer would:1,for Intel:1,Intel to:1,FP registers:1,registers from:1,stack to:1,independent registers:1,registers Since:1,Since they:1,they couldn’t:1,couldn’t do:1,that thanks:1,to compatibility:1,compatibility issues:1,issues they:1,best thing:1,thing They:1,They made:1,which swaps:1,swaps ST(0:1,other FP:1,FP register:1,register virtually:1,virtually free:1,free In:1,if FXCH:1,both preceded:1,preceded and:1,and followed:1,by FP:1,execute Application:1,Application Note:1,Note 500:1,500 Optimizations:1,Optimizations for:1,for Intel’s:1,Intel’s 32-bit:1,32-bit Processors:1,Processors February:1,February 1994:1,1994 available:1,from http:1,www.intel.com describes:1,describes all:1,which FXCH:1,free This:1,target of:1,pending operation:1,operation from:1,ST(0 to:1,time bringing:1,bringing another:1,ST(0 where:1,cost So:1,start three:1,three multiplications:1,multiplications then:1,use FXCH:1,to swap:1,swap back:1,start adding:1,two multiplications:1,multiplications without:1,without incurring:1,incurring any:1,any stalls:1,stalls as:1,Listing 63.1:1,63.1 The:1,at fast:1,fast FP:1,FP for:1,common 3-D:1,operations we’ll:1,product As:1,30 the:1,calculate cosines:1,along vectors:1,as d:1,d u_1:1,u_1 v_1:1,v_1 u_2:1,u_2 v_2:1,u_3 v_3:1,v_3 with:1,three loads:1,loads three:1,multiplies two:1,minimum time:1,63.2 shows:1,straightforward dot:1,product implementation:1,version loses:1,loses 7:1,stalls Listing:1,63.3 cuts:1,doing all:1,three FMULs:1,FMULs first:1,using FXCH:1,third FXCH:1,FXCH aside:1,aside to:1,complete while:1,two FMULs:1,FMULs which:1,have completed:1,completed are:1,added Listing:1,Listing 43.3:1,43.3 still:1,still loses:1,loses 50:1,but unless:1,unless some:1,up Fortunately:1,Fortunately dot:1,in contexts:1,contexts where:1,of interleaving:1,interleaving potential:1,potential as:1,discuss transformation:1,transformation The:1,The Cross:1,Cross Product:1,Product When:1,product we:1,it’s handy:1,for generating:1,that’s normal:1,other vectors:1,The cross:1,as u_2:1,u_2 v_3:1,v_3 u_3:1,u_3 v_2:1,u_3 v_1:1,v_1 u_1:1,u_1 v_3:1,v_3 u_1:1,u_1 v_2:1,v_2 u_2:1,u_2 v_1:1,v_1 The:1,The theoretical:1,minimum cycle:1,63.4 shows:1,calculates each:1,result separately:1,separately losing:1,losing 15:1,stalls We:1,the stalls:1,stalls in:1,with six:1,six inputs:1,one output:1,output it:1,was impossible:1,interleave all:1,the operations:1,operations However:1,three outputs:1,outputs is:1,more amenable:1,optimization In:1,fact three:1,number because:1,three calculation:1,calculation streams:1,streams and:1,of FADD:1,cycles we:1,eliminate almost:1,single stall:1,stall in:1,cross-product calculation:1,calculation as:1,63.5 Listing:1,63.5 loses:1,loses only:1,first FST:1,FST the:1,relevant FSUB:1,FSUB has:1,finished on:1,preceding cycle:1,latency associated:1,with FST:1,FST Listing:1,63.5 is:1,63.4 a:1,striking illustration:1,properly managing:1,managing the:1,Pentium’s FP:1,FP pipeline:1,pipeline Transformation:1,Transformation Transforming:1,Transforming a:1,most heavily:1,used FP:1,3-D Conceptually:1,Conceptually transformation:1,three additions:1,additions as:1,61 Note:1,general 4x4:1,matrix where:1,fourth row:1,row is:1,always implicitly:1,implicitly 0:1,limited form:1,form suffices:1,common transformations:1,does 25:1,percent less:1,less work:1,full 4x4:1,transformation When:1,however transformation:1,from three:1,additions because:1,because once:1,again the:1,number three:1,involved Three:1,Three separate:1,additions would:1,take 60:1,each were:1,were calculated:1,calculated using:1,unoptimized dot-product:1,63.2 and:1,take 54:1,54 cycles:1,if done:1,done one:1,other using:1,faster dot-product:1,63.3 in:1,each case:1,case followed:1,the a:1,final addition:1,addition per:1,per dot:1,product When:1,When fully:1,fully interleaved:1,interleaved however:1,lost again:1,of FST:1,FST latency:1,latency and:1,count drops:1,drops to:1,to 34:1,34 as:1,Listing 63.6:1,63.6 This:1,a 100:1,100 MHz:1,Pentium it’s:1,it’s theoretically:1,do nearly:1,nearly 3000000:1,3000000 transforms:1,second although:1,purely hypothetical:1,hypothetical number:1,number due:1,and set-up:1,set-up costs:1,costs Still:1,Still more:1,1000000 transforms:1,certainly feasible:1,feasible at:1,Hz that’s:1,an impressive:1,impressive 30000:1,30000 transforms:1,frame Projection:1,Projection The:1,optimization we’ll:1,at is:1,is projection:1,screenspace Projection:1,Projection itself:1,basically nothing:1,divide to:1,get 1/z:1,1/z followed:1,multiplies to:1,get x/z:1,x/z and:1,and y/z:1,y/z so:1,there wouldn’t:1,wouldn’t seem:1,optimization possibilities:1,possibilities there:1,there However:1,However remember:1,although FDIV:1,a latency:1,to 39:1,those cycles:1,cycles That:1,find enough:1,enough independent:1,independent integer:1,integer work:1,do before:1,1/z result:1,result we:1,effectively reduce:1,cycle Projection:1,Projection by:1,itself doesn’t:1,doesn’t offer:1,offer much:1,overlap but:1,other work:1,work such:1,as clamping:1,clamping window-relative:1,window-relative adjustments:1,adjustments or:1,or 2-D:1,clipping could:1,next point:1,point Another:1,Another dramatic:1,dramatic speed-up:1,speed-up is:1,precision of:1,FPU down:1,to single:1,single precision:1,precision via:1,via FLDCW:1,FLDCW thereby:1,thereby cutting:1,time FDIV:1,FDIV takes:1,mere 19:1,19 cycles:1,cycles I:1,discuss reduced:1,precision in:1,with potentially:1,potentially greater:1,it carries:1,carries certain:1,certain risks:1,risks as:1,The reduced:1,affects FADD:1,FMUL FDIV:1,and FSQRT:1,FSQRT can:1,subtle differences:1,differences from:1,results you’d:1,get using:1,using compiler:1,compiler defaults:1,defaults If:1,use reduced:1,precision you:1,the alert:1,for precision-related:1,precision-related problems:1,as clipped:1,clipped values:1,that vary:1,vary more:1,expect from:1,the precise:1,precise clip:1,clip point:1,point or:1,using larger:1,larger epsilons:1,epsilons in:1,in comparisons:1,comparisons for:1,for point-on-plane:1,point-on-plane tests:1,tests Rounding:1,Rounding Control:1,Control Another:1,useful area:1,can note:1,note only:1,in passing:1,passing here:1,of leaving:1,FPU in:1,particular rounding:1,rounding mode:1,mode while:1,while performing:1,performing bulk:1,bulk operations:1,sort For:1,example conversion:1,to int:1,int via:1,the FIST:1,FIST instruction:1,instruction requires:1,FPU be:1,in chop:1,the FLDCW:1,FLDCW instruction:1,instruction must:1,FPU into:1,of chop:1,each FLDCW:1,FLDCW takes:1,takes 7:1,cycles meaning:1,compilers often:1,often take:1,least 14:1,each float:1,float int:1,int conversion:1,conversion In:1,the rounding:1,rounding state:1,state or:1,or likewise:1,likewise the:1,for faster:1,faster FDIVs:1,FDIVs once:1,save all:1,those FLDCW:1,FLDCW cycles:1,for ceil:1,ceil which:1,many compilers:1,compilers implement:1,implement as:1,as horrendously:1,horrendously inefficient:1,inefficient subroutines:1,subroutines even:1,are rounding:1,rounding modes:1,both ceil:1,ceil and:1,and floor:1,floor Again:1,though be:1,FP calculations:1,be subtly:1,subtly different:1,from compiler:1,compiler default:1,default behavior:1,behavior while:1,while chop:1,chop ceil:1,ceil or:1,or floor:1,floor mode:1,note There:1,some speed-ups:1,speed-ups to:1,had by:1,by manipulating:1,manipulating FP:1,FP variables:1,instructions Check:1,the February/March:1,February/March 1996:1,1996 issue:1,of Game:1,details A:1,A Farewell:1,Farewell to:1,3-D Fixed-Point:1,Fixed-Point As:1,most optimizations:1,optimizations there:1,both benefits:1,benefits and:1,and hazards:1,floating-point acceleration:1,acceleration especially:1,especially pedal-to-the-metal:1,pedal-to-the-metal optimizations:1,few I’ve:1,mentioned Nonetheless:1,Nonetheless I’ve:1,found floating-point:1,be generally:1,generally both:1,more robust:1,robust and:1,and easier:1,than fixed-point:1,fixed-point even:1,those maximum:1,maximum optimizations:1,that floating-point:1,fixed-point 3-D:1,math from:1,out And:1,won’t miss:1,miss it:1,bit Chapter:1,64 Quake’s:1,Quake’s Visible-Surface:1,Visible-Surface Determination:1,of Separating:1,Separating All:1,Things Seen:1,Seen from:1,from All:1,Things Unseen:1,Unseen Years:1,at Video:1,Seven a:1,a now-vanished:1,now-vanished video:1,adapter manufacturer:1,manufacturer helping:1,helping to:1,clone The:1,was designing:1,designing Video:1,Seven’s VGA:1,chip Tom:1,Wilson had:1,clock for:1,for months:1,his VGA:1,VGA run:1,was confident:1,confident he:1,had pretty:1,As Tom:1,Tom was:1,was putting:1,finishing touches:1,his chip:1,chip design:1,however news:1,news came:1,came fourth-hand:1,fourth-hand that:1,a competitor:1,competitor Paradise:1,had juiced:1,juiced up:1,clone they:1,were developing:1,developing by:1,putting in:1,a FIFO:1,FIFO That:1,he knew:1,knew there:1,no information:1,of FIFO:1,FIFO or:1,helped or:1,else Nonetheless:1,Nonetheless Tom:1,Tom normally:1,normally an:1,an affable:1,affable laid-back:1,laid-back sort:1,sort took:1,the wide-awake:1,wide-awake haunted:1,haunted look:1,man with:1,with too:1,much caffeine:1,caffeine in:1,in him:1,no answers:1,answers to:1,from hopelessly:1,hopelessly thin:1,thin information:1,information what:1,what Paradise:1,done Finally:1,Finally he:1,he concluded:1,that Paradise:1,Paradise must:1,system bus:1,CPU wrote:1,write immediately:1,immediately went:1,on processing:1,processing instead:1,of stalling:1,stalling each:1,it wrote:1,memory Tom:1,Tom couldn’t:1,couldn’t spare:1,the gates:1,gates or:1,full FIFO:1,FIFO but:1,could implement:1,a one-deep:1,get one:1,write ahead:1,VGA He:1,He wasn’t:1,wasn’t sure:1,sure how:1,he put:1,and taped:1,taped out:1,The one-deep:1,FIFO turned:1,work astonishingly:1,astonishingly well:1,time Video:1,Seven’s VGAs:1,VGAs were:1,fastest around:1,a testament:1,testament to:1,Tom’s ingenuity:1,creativity under:1,under pressure:1,pressure However:1,truly remarkable:1,remarkable part:1,that Paradise’s:1,Paradise’s FIFO:1,FIFO design:1,design turned:1,bear not:1,slightest resemblance:1,Tom’s and:1,well Paradise:1,had stuck:1,stuck a:1,read FIFO:1,VGA allowing:1,read ahead:1,ahead so:1,CPU wanted:1,memory pixels:1,FIFO while:1,CPU was:1,was serviced:1,serviced immediately:1,immediately That:1,That did:1,did indeed:1,indeed help:1,help performance—but:1,performance—but not:1,as Tom’s:1,Tom’s write:1,FIFO What:1,as neat:1,neat a:1,of creative:1,creative design:1,design as:1,could hope:1,find The:1,The scrap:1,scrap of:1,of news:1,chip contained:1,contained almost:1,no actual:1,actual information:1,information but:1,it forced:1,forced Tom:1,Tom to:1,push past:1,limits he:1,had unconsciously:1,unconsciously set:1,in coming:1,his original:1,design And:1,important element:1,great design:1,design whether:1,be hardware:1,hardware software:1,any creative:1,creative endeavor:1,endeavor is:1,Paradise news:1,news triggered:1,triggered in:1,in Tom:1,Tom the:1,have built:1,about your:1,then transcend:1,transcend those:1,those limits:1,limits The:1,about transcending:1,transcending limits:1,even know:1,know you’ve:1,you’ve imposed:1,imposed There’s:1,no formula:1,for success:1,two principles:1,principles can:1,can stand:1,stand you:1,good stead:1,stead simplify:1,simplify and:1,on trying:1,things Generally:1,Generally if:1,code getting:1,getting more:1,complex you’re:1,you’re fine-tuning:1,fine-tuning a:1,a frozen:1,frozen design:1,likely you:1,speed-up with:1,by rethinking:1,rethinking the:1,design A:1,A really:1,design should:1,should bring:1,bring with:1,of immense:1,immense satisfaction:1,satisfaction in:1,everything falls:1,you’re amazed:1,cases just:1,just work:1,properly As:1,rethink the:1,design do:1,by pursuing:1,pursuing whatever:1,whatever ideas:1,ideas occur:1,how off-the-wall:1,off-the-wall they:1,seem Many:1,truly brilliant:1,brilliant design:1,design ideas:1,ideas I’ve:1,of over:1,years sounded:1,sounded like:1,like nonsense:1,nonsense at:1,didn’t fit:1,fit my:1,my preconceived:1,preconceived view:1,world Often:1,Often such:1,such ideas:1,ideas are:1,fact off-the-wall:1,off-the-wall but:1,the news:1,chip sparked:1,sparked Tom’s:1,Tom’s imagination:1,imagination aggressively:1,aggressively pursuing:1,pursuing seemingly:1,seemingly outlandish:1,outlandish ideas:1,can open:1,open up:1,up new:1,design possibilities:1,you Case:1,The evolution:1,engine VSD:1,VSD The:1,The Toughest:1,Toughest 3-D:1,3-D Challenge:1,of All:1,All I’ve:1,my waking:1,waking hours:1,hours for:1,several months:1,months working:1,Software’s successor:1,successor to:1,suspect I:1,more months:1,The very:1,very best:1,best things:1,happen easily:1,easily nor:1,nor quickly—but:1,quickly—but when:1,happen all:1,the sweat:1,sweat becomes:1,becomes worthwhile:1,worthwhile In:1,graphics Quake:1,DOOM as:1,as DOOM:1,DOOM was:1,predecessor Wolfenstein:1,3-D Quake:1,Quake adds:1,adds true:1,true arbitrary:1,arbitrary 3-D:1,3-D you:1,down lean:1,lean and:1,even fall:1,fall on:1,your side:1,side detailed:1,3-D monsters:1,monsters and:1,players in:1,of DOOM’s:1,DOOM’s sprites:1,sprites Someday:1,Someday I:1,the here:1,opinion the:1,3-D problem:1,all visible:1,determination drawing:1,proper surface:1,relative culling:1,culling discarding:1,discarding non-visible:1,of accelerating:1,accelerating visible:1,determination In:1,the abbreviation:1,abbreviation VSD:1,mean both:1,culling from:1,on Why:1,Why do:1,think VSD:1,3-D challenge:1,challenge Although:1,Although rasterization:1,rasterization issues:1,issues such:1,mapping are:1,are fascinating:1,fascinating and:1,and important:1,important they:1,are tasks:1,tasks of:1,relatively finite:1,finite scope:1,scope and:1,being moved:1,moved into:1,into hardware:1,accelerators appear:1,appear also:1,also they:1,only scale:1,scale with:1,with increases:1,increases in:1,resolution which:1,relatively modest:1,modest In:1,contrast VSD:1,an open-ended:1,open-ended problem:1,approaches currently:1,use Even:1,significantly the:1,VSD done:1,an unsophisticated:1,unsophisticated fashion:1,fashion scales:1,scales directly:1,with scene:1,complexity which:1,increase as:1,square or:1,or cube:1,cube function:1,function so:1,rapidly becomes:1,the limiting:1,limiting factor:1,factor in:1,rendering realistic:1,realistic worlds:1,worlds I:1,expect VSD:1,the increasingly:1,increasingly dominant:1,dominant issue:1,realtime PC:1,PC 3-D:1,3-D over:1,years as:1,3-D worlds:1,worlds become:1,increasingly detailed:1,detailed Already:1,Already a:1,a good-sized:1,good-sized Quake:1,level contains:1,contains on:1,of 10000:1,polygons about:1,a comparable:1,comparable DOOM:1,DOOM level:1,The Structure:1,Structure of:1,Quake Levels:1,Levels Before:1,Before diving:1,diving into:1,into VSD:1,VSD let:1,me note:1,each Quake:1,single huge:1,huge 3-D:1,tree This:1,This BSP:1,tree like:1,any BSP:1,BSP subdivides:1,case along:1,polygons However:1,However unlike:1,tree I:1,62 Quake’s:1,Quake’s BSP:1,tree does:1,store polygons:1,tree nodes:1,rather in:1,empty non-solid:1,non-solid leaves:1,leaves as:1,64.1 Correct:1,Correct drawing:1,order again:1,62 Also:1,because BSP:1,always convex:1,leaves facing:1,facing inward:1,inward the:1,leaf can:1,never obscure:1,obscure one:1,order This:1,general property:1,polyhedra Culling:1,and Visible:1,Surface Determination:1,VSD would:1,ideally work:1,First you:1,would cull:1,cull all:1,frustum view:1,would clip:1,the irrelevant:1,irrelevant portions:1,any polygons:1,partially outside:1,outside Then:1,64.2 wasting:1,wasting no:1,time overdrawing:1,overdrawing pixels:1,pixels multiple:1,times note:1,note how:1,polygon sets:1,64.2 actually:1,drawn Finally:1,Finally in:1,perfect world:1,tests to:1,visible would:1,be free:1,free and:1,possible viewpoints:1,viewpoints giving:1,game a:1,smooth visual:1,visual flow:1,viewpoint Figure:1,viewpoint As:1,happens it:1,frustum or:1,out precisely:1,precisely which:1,pixels need:1,drawn Alas:1,perfect and:1,those tests:1,tests are:1,from free:1,free so:1,real trick:1,to accelerate:1,accelerate or:1,or skip:1,skip various:1,various tests:1,still produce:1,result As:1,62 given:1,BSP it’s:1,and inexpensive:1,inexpensive to:1,order The:1,simplest VSD:1,VSD solution:1,solution which:1,I in:1,fact demonstrated:1,demonstrated earlier:1,simply walk:1,back-to-front clip:1,draw it:1,it’s facing:1,forward and:1,clipped the:1,algorithm Is:1,Is that:1,an adequate:1,adequate solution:1,solution For:1,For relatively:1,simple worlds:1,worlds it:1,perfectly acceptable:1,acceptable It:1,scale very:1,world more:1,more transformations:1,and tests:1,tests have:1,cull polygons:1,will bog:1,bog considerably:1,considerably performance:1,performance down:1,down Nodes:1,Nodes Inside:1,Inside and:1,and Outside:1,Outside the:1,the View:1,View Frustum:1,Frustum Happily:1,Happily there’s:1,problem As:1,earlier each:1,tree represents:1,convex subspace:1,subspace with:1,nodes that:1,that bound:1,bound the:1,leaf delimiting:1,delimiting the:1,space Perhaps:1,Perhaps less:1,obvious is:1,tree also:1,a subspace—the:1,subspace—the subspace:1,subspace composed:1,children as:1,64.3 Another:1,pieces created:1,nodes above:1,children then:1,then further:1,further carve:1,carve that:1,that descend:1,descend from:1,E Figure:1,E Since:1,is bounded:1,bounded and:1,convex it:1,frustum If:1,be rejected:1,rejected without:1,any additional:1,additional processing:1,processing Since:1,Since most:1,typically outside:1,frustum many:1,culled almost:1,almost for:1,in huge:1,huge node-subspace:1,node-subspace chunks:1,chunks It’s:1,It’s relatively:1,perfect test:1,for subspace:1,subspace clipping:1,clipping so:1,so instead:1,instead bounding:1,spheres or:1,or boxes:1,often maintained:1,maintained for:1,node specifically:1,for culling:1,culling tests:1,tests So:1,So culling:1,frustum isn’t:1,BSP can:1,draw back-to:1,front What:1,What then:1,problem Overdraw:1,Overdraw The:1,the driving:1,driving technical:1,technical force:1,force behind:1,Quake faced:1,faced when:1,he designed:1,designed Quake:1,complex world:1,world many:1,many scenes:1,scenes have:1,frustum Most:1,or entirely:1,entirely obscured:1,algorithm described:1,earlier requires:1,frustum be:1,drawn often:1,often only:1,be overdrawn:1,overdrawn In:1,a 10000-polygon:1,10000-polygon Quake:1,level it:1,a worst-case:1,worst-case overdraw:1,overdraw level:1,some frames:1,frames each:1,pixel could:1,drawn 10:1,average No:1,No rasterizer:1,such magnitude:1,magnitude and:1,actually necessary:1,show a:1,scene worse:1,will cause:1,between best-case:1,best-case and:1,and worst-case:1,rate can:1,vary wildly:1,wildly as:1,moves around:1,around So:1,keep overdraw:1,overdraw down:1,a manageable:1,manageable level:1,level preferably:1,preferably drawing:1,pixel exactly:1,case As:1,with frustum:1,frustum culling:1,culling it:1,ideal if:1,all invisible:1,invisible polygons:1,no work:1,work It:1,a plus:1,plus if:1,of partially-visible:1,partially-visible polygons:1,a balancing:1,act in:1,a lower-cost:1,lower-cost operation:1,operation than:1,the overdraw:1,otherwise result:1,result When:1,id at:1,of March:1,March 1995:1,1995 John:1,John already:1,already had:1,an engine:1,engine prototyped:1,prototyped and:1,plan in:1,our work:1,of finishing:1,finishing and:1,optimizing that:1,that engine:1,engine If:1,been aware:1,of id’s:1,id’s history:1,history however:1,better John:1,done not:1,only DOOM:1,DOOM but:1,the engines:1,engines for:1,several earlier:1,earlier games:1,had actually:1,done several:1,different versions:1,each engine:1,development once:1,once doing:1,doing four:1,four engines:1,four weeks:1,perhaps 20:1,20 distinct:1,distinct engines:1,engines over:1,a four-year:1,four-year period:1,period John’s:1,John’s tireless:1,tireless pursuit:1,pursuit of:1,better designs:1,designs for:1,Quake’s engine:1,engine from:1,every angle:1,angle he:1,of would:1,would end:1,end only:1,we shipped:1,shipped the:1,the product:1,product By:1,By three:1,three months:1,months after:1,after I:1,arrived only:1,original VSD:1,VSD design:1,was anywhere:1,in sight:1,sight and:1,and John:1,the dictum:1,dictum of:1,of try:1,things farther:1,than I’d:1,it taken:1,taken The:1,The Beam:1,Beam Tree:1,Tree John’s:1,John’s original:1,original Quake:1,Quake design:1,front-to-back using:1,second BSP:1,screen were:1,were already:1,already drawn:1,therefore drawable:1,drawable by:1,polygons Logically:1,Logically you:1,this BSP:1,describing solid:1,64.4 but:1,3-D tree:1,tree of:1,sort known:1,tree A:1,A beam:1,3-D wedges:1,wedges beams:1,beams bounded:1,bounded by:1,by planes:1,planes projecting:1,projecting out:1,from some:1,some center:1,64.5 In:1,In John’s:1,John’s design:1,tree started:1,out consisting:1,single beam:1,beam describing:1,frustum everything:1,everything outside:1,that beam:1,marked solid:1,solid so:1,so nothing:1,nothing would:1,draw there:1,marked empty:1,empty As:1,reached while:1,front-to-back that:1,was converted:1,beam by:1,running planes:1,its edges:1,beam that:1,that intersected:1,intersected empty:1,empty beams:1,beams in:1,was considered:1,considered drawable:1,drawable and:1,solid beam:1,beam This:1,This continued:1,continued until:1,either there:1,tree became:1,became entirely:1,entirely solid:1,solid Once:1,was completed:1,had contributed:1,contributed to:1,tree were:1,drawn Figure:1,3-D beam:1,that determining:1,only checking:1,normal because:1,all beam:1,beam planes:1,planes run:1,viewpoint Also:1,completely described:1,single normal:1,normal generating:1,beam from:1,edge requires:1,viewpoint Finally:1,Finally bounding:1,spheres of:1,nodes can:1,aforementioned bulk:1,bulk culling:1,The early-out:1,beam tree—stopping:1,tree—stopping when:1,tree becomes:1,becomes solid—seems:1,solid—seems appealing:1,to cap:1,cap worst-case:1,performance Unfortunately:1,Unfortunately there:1,still scenes:1,scenes where:1,sky or:1,back wall:1,wall of:1,case all:1,frustum will:1,tested against:1,tree Similar:1,from tiny:1,tiny cracks:1,cracks due:1,to numeric:1,precision limitations:1,limitations Beam-tree:1,Beam-tree clipping:1,fairly time-consuming:1,time-consuming and:1,in scenes:1,with long:1,long view:1,view distances:1,distances such:1,as views:1,views across:1,total cost:1,of beam:1,beam processing:1,slowed Quake’s:1,Quake’s frame:1,crawl So:1,the beam-tree:1,beam-tree approach:1,approach proved:1,from much:1,same malady:1,malady as:1,case was:1,average case:1,didn’t scale:1,increasing level:1,level complexity:1,complexity 3-D:1,3-D Engine:1,Engine du:1,du Jour:1,Jour Once:1,working John:1,John relentlessly:1,relentlessly worked:1,at speeding:1,engine always:1,always trying:1,design rather:1,than tweaking:1,implementation At:1,week and:1,often every:1,every day:1,would walk:1,walk into:1,office and:1,and say:1,say Last:1,Last night:1,sleep so:1,I’d know:1,mind stretched:1,stretched yet:1,yet again:1,again John:1,John tried:1,tried many:1,some success:1,interesting was:1,of wildly:1,wildly different:1,he generated:1,generated some:1,were merely:1,merely discussed:1,discussed others:1,others of:1,in overnight:1,overnight or:1,or weekend-long:1,weekend-long bursts:1,bursts of:1,cases ultimately:1,ultimately discarded:1,discarded or:1,or further:1,further evolved:1,evolved when:1,they turned:1,design criteria:1,criteria well:1,enough Here:1,approaches presented:1,in minimal:1,minimal detail:1,the hopes:1,hopes that:1,like Tom:1,Wilson with:1,Paradise FIFO:1,FIFO your:1,imagination will:1,be sparked:1,sparked Subdividing:1,Subdividing Raycast:1,Raycast Rays:1,Rays are:1,are cast:1,cast in:1,an 8x8:1,8x8 screen-pixel:1,screen-pixel grid:1,grid this:1,efficient operation:1,first intersection:1,found by:1,simply clipping:1,ray into:1,tree starting:1,viewpoint until:1,solid leaf:1,reached If:1,If adjacent:1,rays don’t:1,don’t hit:1,is cast:1,cast halfway:1,rays either:1,either hit:1,or are:1,block around:1,each ray:1,drawn from:1,was hit:1,hit This:1,This scales:1,scales very:1,well being:1,being limited:1,overdraw The:1,is dropouts:1,dropouts it’s:1,fall between:1,between rays:1,rays and:1,and vanish:1,vanish Vertex-Free:1,Vertex-Free Surfaces:1,Surfaces The:1,surface planes:1,The polygons:1,are implicit:1,plane intersections:1,intersections and:1,are extracted:1,extracted from:1,step before:1,small data:1,set planes:1,it’s time-consuming:1,extract polygons:1,The Draw-Buffer:1,Draw-Buffer Like:1,Like a:1,z-buffer but:1,pixel indicating:1,indicating whether:1,drawn yet:1,yet This:1,an inner-loop:1,inner-loop buffer:1,buffer test:1,test extra:1,extra writes:1,all considerable:1,complexity Variations:1,Variations include:1,include testing:1,the draw-buffer:1,draw-buffer a:1,and completely:1,completely skipping:1,skipping fully-occluded:1,fully-occluded bytes:1,branching off:1,each draw-buffer:1,draw-buffer byte:1,256 unrolled:1,unrolled inner:1,drawing 0-8:1,0-8 pixels:1,process possibly:1,possibly taking:1,x86 to:1,perspective floating-point:1,floating-point divide:1,divide in:1,parallel while:1,while 8:1,processed Span-Based:1,Span-Based Drawing:1,are rasterized:1,against that:1,span at:1,pixel remains:1,remains Little:1,Little sorting:1,needed with:1,with front-to-back:1,front-to-back walking:1,walking because:1,any overlap:1,span already:1,nearer This:1,span arithmetic:1,arithmetic also:1,also every:1,polygon still:1,be turned:1,spans Portals:1,Portals The:1,The holes:1,holes where:1,are missing:1,missing on:1,on surfaces:1,are tracked:1,tracked because:1,only through:1,such portals:1,that line-of-sight:1,line-of-sight can:1,can extend:1,extend Drawing:1,Drawing goes:1,goes front-to-back:1,front-to-back and:1,a portal:1,portal is:1,encountered polygons:1,and portals:1,portals behind:1,it are:1,are clipped:1,limits until:1,until no:1,or portals:1,portals remain:1,remain visible:1,visible Applied:1,recursively this:1,allows drawing:1,of portal:1,portal clipping:1,clipping Breakthrough:1,Breakthrough In:1,end John:1,John decided:1,of second-order:1,second-order structure:1,structure reflecting:1,reflecting information:1,information already:1,implicitly contained:1,he tackled:1,tackled the:1,of extracting:1,extracting visibility:1,visibility information:1,tree He:1,He spent:1,week on:1,a byproduct:1,byproduct devising:1,devising a:1,perfect DOOM:1,DOOM 2-D:1,visibility architecture:1,architecture whereby:1,whereby a:1,linear walk:1,a DOOM:1,DOOM BSP:1,tree produces:1,produces zero-overdraw:1,zero-overdraw 2-D:1,visibility Doing:1,Doing the:1,3-D turned:1,complex problem:1,problem though:1,the week:1,week John:1,was frustrated:1,frustrated by:1,the increasing:1,increasing complexity:1,and persistent:1,persistent glitches:1,glitches in:1,visibility code:1,code Although:1,getting closer:1,working it:1,taking more:1,more tweaking:1,tweaking and:1,simple clean:1,clean design:1,design didn’t:1,be falling:1,falling out:1,out When:1,left work:1,work one:1,one Friday:1,Friday John:1,was preparing:1,preparing to:1,approach working:1,properly over:1,the weekend:1,weekend When:1,in on:1,on Monday:1,Monday John:1,broken through:1,other side—and:1,side—and also:1,who hadn’t:1,hadn’t had:1,had much:1,much sleep:1,sleep He:1,worked all:1,all weekend:1,weekend on:1,it working:1,working reasonably:1,with insights:1,insights into:1,into how:1,finish it:1,off At:1,At 330:1,330 Monday:1,Monday morning:1,morning as:1,he lay:1,lay in:1,in bed:1,bed thinking:1,about portals:1,of precalculating:1,storing in:1,runtime just:1,just drawing:1,leaves back-to-front:1,back-to-front for:1,whatever leaf:1,viewpoint happens:1,in ignoring:1,ignoring all:1,other leaves:1,leaves entirely:1,entirely Size:1,Size was:1,concern initially:1,initially a:1,a raw:1,raw uncompressed:1,uncompressed potentially:1,was several:1,megabytes in:1,size However:1,PVS could:1,per leaf:1,structure that:1,that shrunk:1,shrunk a:1,with simple:1,simple zero-byte:1,zero-byte compression:1,compression Those:1,Those steps:1,steps along:1,BSP heuristic:1,heuristic to:1,generate fewer:1,fewer leaves:1,leaves choosing:1,next splitter:1,fewest other:1,polygons appears:1,best heuristic:1,heuristic and:1,and sealing:1,sealing the:1,levels so:1,BSPer can:1,can remove:1,outside surfaces:1,surfaces which:1,seen eventually:1,eventually brought:1,PVS down:1,Kb for:1,a good-size:1,good-size level:1,level In:1,In exchange:1,that 20:1,Kb culling:1,culling leaves:1,leaves outside:1,is speeded:1,up because:1,only leaves:1,considered and:1,culling inside:1,frustum costs:1,costs nothing:1,little overdraw:1,leaf includes:1,includes all:1,some overdraw:1,overdraw typically:1,typically on:1,of 50:1,percent but:1,but ranging:1,ranging up:1,to 150:1,150 percent:1,percent generally:1,generally occurs:1,occurs Better:1,yet precalculating:1,PVS results:1,a leveling:1,leveling of:1,performance worst:1,longer much:1,than best:1,longer extra:1,extra VSD:1,VSD processing—just:1,processing—just more:1,perhaps some:1,extra overdraw—associated:1,overdraw—associated with:1,scenes The:1,time John:1,John showed:1,me his:1,his working:1,working prototype:1,prototype I:1,scene I:1,knew of:1,rate used:1,to grind:1,grind down:1,single digits:1,digits and:1,and spun:1,spun around:1,around smoothly:1,smoothly with:1,no perceptible:1,perceptible slowdown:1,slowdown John:1,says precalculating:1,logical evolution:1,approaches he:1,been considering:1,no moment:1,moment when:1,said Eureka:1,Eureka Nonetheless:1,a breakthrough:1,breakthrough to:1,a brand-new:1,brand-new superior:1,superior design:1,design that:1,a still-in-development:1,still-in-development sorted-edge:1,sorted-edge rasterizer:1,that completely:1,overdraw comes:1,comes remarkably:1,remarkably close:1,to meeting:1,the perfect-world:1,perfect-world specifications:1,specifications we:1,we laid:1,start Simplify:1,and Keep:1,Keep on:1,on Trying:1,Trying New:1,New Things:1,Things What:1,all mean:1,mean Exactly:1,Exactly what:1,said up:1,front Simplify:1,things The:1,other schemes:1,been considered:1,considered although:1,although precalculating:1,discuss another:1,another time:1,fact at:1,a constrained:1,constrained version:1,algorithm Does:1,mean it’s:1,profound Not:1,all All:1,All really:1,really great:1,great designs:1,designs seem:1,seem simple:1,even obvious—once:1,obvious—once they’ve:1,designed But:1,But the:1,getting there:1,there requires:1,requires incredible:1,incredible persistence:1,persistence and:1,try lots:1,different ideas:1,ideas until:1,right one:1,one falls:1,as happened:1,happened here:1,Hecker has:1,a theory:1,end since:1,all reflect:1,underlying state:1,of underlying:1,underlying theory:1,true whether:1,whether you:1,with incremental:1,incremental hyperbolic:1,hyperbolic calculations:1,calculations the:1,numbers do:1,do exactly:1,thing When:1,however my:1,simply time-shifting:1,time-shifting an:1,approach or:1,or matching:1,matching hardware:1,hardware capabilities:1,capabilities better:1,or caching:1,astonishing difference:1,difference My:1,friend Terje:1,Mathisen likes:1,all programming:1,an exercise:1,in caching:1,did No:1,fast he:1,he made:1,made his:1,his VSD:1,VSD calculations:1,calculations they:1,as precalculating:1,and looking:1,his most:1,most inspired:1,inspired move:1,to yank:1,yank himself:1,code mindset:1,mindset and:1,and realize:1,precalculate in:1,effect cache:1,The hardest:1,hardest thing:1,step outside:1,a familiar:1,familiar pretty:1,good solution:1,different better:1,solution The:1,best ways:1,ways I:1,new wacky:1,wacky things:1,things and:1,always try:1,simplify One:1,John’s goals:1,goals is:1,each 3-D:1,game than:1,previous game:1,game on:1,he learns:1,learns more:1,more he:1,he should:1,things better:1,code So:1,far it:1,him Learn:1,Learn Now:1,Now Pay:1,Pay Forward:1,Forward There’s:1,one other:1,thing I’d:1,mention before:1,I close:1,chapter Much:1,written has:1,Journal As:1,As far:1,can remember:1,remember DDJ:1,DDJ has:1,has epitomized:1,epitomized the:1,the attitude:1,that sharing:1,sharing programming:1,programming information:1,Thing I:1,to leap:1,leap ahead:1,ahead in:1,their development:1,development because:1,of Hendrix’s:1,Hendrix’s Tiny:1,Tiny C:1,or Stevens:1,Stevens D-Flat:1,D-Flat or:1,by browsing:1,browsing through:1,through DDJ:1,s annual:1,annual collections:1,collections Me:1,Me for:1,one Understandably:1,Understandably most:1,most companies:1,companies understandably:1,understandably view:1,view sharing:1,potential profit:1,profit lost—but:1,lost—but that’s:1,makes DDJ:1,DDJ so:1,so valuable:1,valuable to:1,programming community:1,community It:1,spirit that:1,Software is:1,is allowing:1,describe in:1,pages which:1,also appeared:1,DDJ special:1,special issues:1,issues how:1,even before:1,before Quake:1,Quake has:1,has shipped:1,shipped That’s:1,That’s also:1,also why:1,why id:1,placed the:1,full source:1,although you:1,just recompile:1,recompile the:1,and sell:1,sell it:1,full-blown successful:1,game works:1,works Check:1,Check wolfsrc.txt:1,wolfsrc.txt in:1,above-mentioned directory:1,used So:1,So remember:1,it’s legally:1,legally possible:1,possible sharing:1,information benefits:1,benefits us:1,us all:1,run You:1,pay forward:1,forward the:1,the debt:1,debt for:1,gain here:1,and elsewhere:1,elsewhere by:1,by sharing:1,sharing what:1,know whenever:1,article or:1,or posting:1,the Net:1,Net None:1,us learns:1,learns in:1,vacuum we:1,all stand:1,stand on:1,the shoulders:1,shoulders of:1,of giants:1,giants such:1,as Wirth:1,Wirth and:1,and Knuth:1,Knuth and:1,and thousands:1,of others:1,others Lend:1,Lend your:1,your shoulders:1,shoulders to:1,future Chapter:1,65 3-D:1,Clipping and:1,Other Thoughts:1,Thoughts Determining:1,Determining What’s:1,What’s Inside:1,Inside Your:1,Your Field:1,Field of:1,of View:1,View Our:1,I’m concerned:1,of explanation:1,explanation three:1,three anecdotes:1,anecdotes Anecdote:1,first In:1,the introduction:1,books Frank:1,Frank Herbert:1,Herbert author:1,of Dune:1,Dune told:1,told how:1,how he:1,had once:1,once been:1,been approached:1,approached by:1,friend who:1,who claimed:1,claimed he:1,he the:1,the friend:1,friend had:1,killer idea:1,idea for:1,an SF:1,SF story:1,story and:1,and offered:1,offered to:1,tell it:1,to Herbert:1,Herbert In:1,return Herbert:1,Herbert had:1,to agree:1,story he’d:1,he’d split:1,the money:1,money from:1,story with:1,this fellow:1,fellow Herbert’s:1,Herbert’s response:1,response was:1,that ideas:1,dozen he:1,had more:1,more story:1,story ideas:1,ideas than:1,ever write:1,write in:1,lifetime The:1,writing not:1,ideas Anecdote:1,second I’ve:1,been programming:1,micros for:1,decade and:1,and until:1,until about:1,year ago:1,had never—not:1,never—not once:1,once had:1,anyone offer:1,offer to:1,to sell:1,sell me:1,a technical:1,technical idea:1,idea In:1,year it’s:1,it’s happened:1,happened multiple:1,times generally:1,generally via:1,via unsolicited:1,unsolicited email:1,email along:1,of Herbert’s:1,Herbert’s tale:1,tale This:1,This trend:1,trend toward:1,toward selling:1,selling ideas:1,ideas is:1,one symptom:1,symptom of:1,I’ve noticed:1,noticed more:1,more among:1,among programmers:1,programmers over:1,few years—an:1,years—an attitude:1,attitude of:1,which software:1,patents are:1,obvious manifestation—a:1,manifestation—a desire:1,think something:1,something up:1,up without:1,breaking a:1,a sweat:1,sweat then:1,then let:1,let someone:1,else’s hard:1,work make:1,make you:1,you money:1,money It’s:1,that says:1,my ideas:1,ideas alone:1,alone set:1,set me:1,me apart:1,apart Sorry:1,Sorry it:1,world Ideas:1,Ideas are:1,dozen in:1,programming too:1,too I:1,a lifetime’s:1,lifetime’s worth:1,of article:1,software ideas:1,ideas written:1,written neatly:1,neatly in:1,a notebook:1,notebook and:1,know several:1,several truly:1,truly original:1,original thinkers:1,thinkers who:1,more yet:1,yet Folks:1,Folks it’s:1,ideas it’s:1,it’s design:1,design implementation:1,especially hard:1,difference Virtually:1,Virtually every:1,every idea:1,idea I’ve:1,I’ve encountered:1,graphics was:1,was invented:1,invented decades:1,decades ago:1,ago You:1,You think:1,think you:1,clever graphics:1,graphics idea:1,idea Sutherland:1,Sutherland Sproull:1,Sproull Schumacker:1,Schumacker Catmull:1,Catmull Smith:1,Smith Blinn:1,Blinn Glassner:1,Glassner Kajiya:1,Kajiya Heckbert:1,Heckbert or:1,or Teller:1,Teller probably:1,probably thought:1,your idea:1,idea years:1,ago I’m:1,I’m serious—spend:1,serious—spend a:1,few weeks:1,weeks reading:1,reading through:1,at what’s:1,what’s already:1,been invented:1,published If:1,they thought:1,important enough:1,enough they:1,they wrote:1,paper about:1,or tried:1,to commercialize:1,commercialize it:1,do was:1,was try:1,to charge:1,charge people:1,people for:1,idea itself:1,A closely:1,related point:1,the astonishing:1,astonishing lack:1,of gratitude:1,gratitude some:1,some programmers:1,programmers show:1,and sense:1,of community:1,community that:1,that went:1,into building:1,work How:1,How about:1,this Anyone:1,Anyone who:1,thinks they:1,unique idea:1,they want:1,and milk:1,milk for:1,for money:1,money can:1,do so—but:1,so—but first:1,first they:1,and appropriately:1,appropriately compensate:1,compensate all:1,who made:1,the compilers:1,compilers algorithms:1,algorithms programming:1,programming courses:1,courses books:1,books hardware:1,forth that:1,that put:1,a position:1,their brainstorm:1,brainstorm Put:1,a silly:1,silly idea:1,behind software:1,patents is:1,eventually everyone:1,everyone will:1,will own:1,own parts:1,our communal:1,communal knowledge:1,programming will:1,become in:1,part a:1,properly identifying:1,identifying and:1,and compensating:1,compensating each:1,every owner:1,owner of:1,use All:1,do go:1,go down:1,down that:1,that path:1,path I:1,I guarantee:1,a poorer:1,poorer profession:1,profession for:1,of us—except:1,us—except the:1,patent attorneys:1,attorneys I:1,guess Anecdote:1,third A:1,have lunch:1,lunch down:1,by Seattle’s:1,Seattle’s waterfront:1,waterfront with:1,with Neal:1,Neal Stephenson:1,Stephenson the:1,of Snow:1,Snow Crash:1,Crash and:1,The Diamond:1,Diamond Age:1,Age one:1,best SF:1,SF books:1,books I’ve:1,across in:1,As he:1,he talked:1,of networked:1,networked technology:1,he hoped:1,see emerge:1,emerge he:1,he mentioned:1,blocks down:1,street was:1,the pawn:1,pawn shop:1,shop where:1,where Jimi:1,Jimi Hendrix:1,Hendrix bought:1,bought his:1,his first:1,first guitar:1,guitar His:1,His point:1,cheap guitar:1,guitar hadn’t:1,hadn’t been:1,been available:1,available Hendrix’s:1,Hendrix’s unique:1,unique talent:1,talent would:1,have emerged:1,emerged Similarly:1,Similarly he:1,he views:1,views the:1,the networking:1,networking of:1,of society:1,society as:1,get affordable:1,affordable creative:1,creative tools:1,people so:1,much talent:1,talent as:1,possible can:1,be unearthed:1,unearthed and:1,developed Extend:1,Extend that:1,steady flow:1,information circulates:1,circulates so:1,everyone can:1,they’re capable:1,don’t gain:1,gain by:1,by intellectually:1,intellectually impoverishing:1,impoverishing you:1,we both:1,both compete:1,compete and:1,and intentionally:1,intentionally or:1,otherwise share:1,ideas both:1,both our:1,our products:1,products become:1,become better:1,better so:1,market grows:1,grows larger:1,everyone benefits:1,way things:1,things have:1,time So:1,has worked:1,worked remarkably:1,the recent:1,recent signs:1,change make:1,me concerned:1,concerned about:1,our profession:1,profession Things:1,Things aren’t:1,aren’t changing:1,changing everywhere:1,everywhere though:1,though over:1,past year:1,year I’ve:1,I’ve circulated:1,circulated a:1,of info:1,info about:1,and plan:1,on doing:1,can Next:1,Next we’re:1,at 3-D:1,clipping 3-D:1,Clipping Basics:1,Basics Before:1,got deeply:1,deeply into:1,3-D I:1,kept hearing:1,difficult 3-D:1,clipping was:1,was pleasantly:1,pleasantly surprised:1,surprised when:1,to doing:1,quite straightforward:1,straightforward after:1,all At:1,At heart:1,heart 3-D:1,than evaluating:1,evaluating whether:1,intersects a:1,an inside:1,kept and:1,removed or:1,or clipped:1,clipped We:1,easily extend:1,extend this:1,this single:1,operation to:1,clipping working:1,removal In:1,volume or:1,or view:1,away parts:1,visible Sometimes:1,process includes:1,to near:1,far plane:1,restrict the:1,the depth:1,depth of:1,scene Other:1,Other applications:1,applications include:1,include clipping:1,while building:1,building BSP:1,clipping moving:1,to convex:1,convex sectors:1,sectors such:1,as BSP:1,leaves The:1,clipping principles:1,principles I’ll:1,cover apply:1,clipping task:1,task but:1,but clipping:1,specific context:1,discuss clipping:1,clipping below:1,commercial application:1,application you:1,clip every:1,database individually:1,individually As:1,of bounding:1,bounding volumes:1,volumes to:1,cull chunks:1,database that:1,fall entirely:1,frustum without:1,consider each:1,polygon separately:1,separately is:1,important performance:1,performance aspect:1,scene rendering:1,rendering Once:1,done however:1,however you’re:1,still left:1,be entirely:1,frustum In:1,those remaining:1,polygons I’ll:1,I’ll focus:1,I wish:1,wish I’d:1,known when:1,3-D There:1,are plenty:1,up clipping:1,clipping under:1,under various:1,various circumstances:1,circumstances some:1,I’ll mention:1,mention but:1,material covered:1,covered below:1,below will:1,tools you:1,implement functional:1,functional 3-D:1,clipping Intersecting:1,Intersecting a:1,a Line:1,Line Segment:1,Segment with:1,a Plane:1,Plane The:1,fundamental 3-D:1,clipping operation:1,plane There:1,parts to:1,operation determining:1,determining if:1,by intersects:1,clipped calculating:1,intersection Before:1,can intersect:1,first define:1,define how:1,how we’ll:1,The segment:1,the xyz:1,its two:1,two endpoints:1,endpoints this:1,this extends:1,extends well:1,an xyz:1,xyz point:1,point Planes:1,Planes can:1,ways among:1,three points:1,normal or:1,latter definition:1,definition Further:1,Further we’ll:1,we’ll define:1,inside unclipped:1,unclipped side:1,The structures:1,structures for:1,for points:1,points polygons:1,Listing 65.1:1,65.1 Given:1,or intersects:1,plane If:1,inside then:1,outside then:1,it’s entirely:1,we’re likewise:1,likewise done:1,it intersects:1,the clipped:1,clipped portion:1,endpoint on:1,answer this:1,plane each:1,each endpoint:1,endpoint is:1,right tool:1,job As:1,61 dotting:1,dotting any:1,projection of:1,that vector:1,normal Therefore:1,dot it:1,normal Another:1,returns how:1,normal the:1,point lie:1,we slid:1,slid the:1,normal until:1,point Now:1,Now remember:1,our definition:1,normal That:1,distance for:1,plane structure:1,distance at:1,touch the:1,normal a:1,two values:1,values suffices:1,on If:1,distance then:1,plane inside:1,volume being:1,being clipped:1,to if:1,less then:1,is outside:1,clipped After:1,this twice:1,everything necessary:1,categorize our:1,our line:1,segment If:1,both endpoints:1,endpoints are:1,same side:1,plane there’s:1,do because:1,either completely:1,completely inside:1,outside otherwise:1,otherwise it’s:1,step clipping:1,outside vertex:1,vertex with:1,intersection of:1,plane Happily:1,Happily it:1,this From:1,From our:1,earlier tests:1,tests we:1,length from:1,plane measured:1,endpoint that’s:1,endpoint from:1,endpoint with:1,normal minus:1,distance as:1,65.1 We:1,segment again:1,again measured:1,measured as:1,as projected:1,normal that’s:1,the distances:1,distances along:1,outside endpoints:1,endpoints from:1,lengths is:1,remains after:1,after clipping:1,clipping If:1,we scale:1,z lengths:1,that fraction:1,fraction and:1,new clipped:1,clipped endpoint:1,endpoint at:1,intersection Polygon:1,Polygon Clipping:1,Clipping Line:1,Line clipping:1,for wireframe:1,wireframe rendering:1,rendering but:1,is polygon:1,polygon rendering:1,rendering of:1,of solid:1,solid models:1,requires polygon:1,clipping As:1,with line:1,determine if:1,they’re inside:1,inside outside:1,outside or:1,partially inside:1,volume lopping:1,lopping off:1,any vertices:1,and substituting:1,substituting vertices:1,65.2 An:1,An easy:1,to decompose:1,decompose it:1,edge separately:1,separately as:1,segment Let’s:1,Let’s define:1,that wind:1,wind clockwise:1,clockwise around:1,the polygonal:1,implicitly defined:1,vertices Thus:1,Thus an:1,segment described:1,adjacent vertices:1,form its:1,endpoints We’ll:1,We’ll clip:1,polygon by:1,edge individually:1,individually emitting:1,emitting vertices:1,resulting polygon:1,appropriate depending:1,clipping state:1,is inside:1,inside that:1,polygon Then:1,end points:1,different states:1,states one:1,one inside:1,one outside:1,outside we:1,next polygon:1,65.3 Listing:1,Listing 65.2:1,65.2 shows:1,function Figure:1,polygon Believe:1,not this:1,technique applied:1,plane Better:1,planes by:1,above process:1,process once:1,each clip:1,each interation:1,interation trimming:1,trimming away:1,that’s clipped:1,plane One:1,One particularly:1,useful aspect:1,you’re drawing:1,drawing texture:1,mapped polygons:1,polygons texture:1,clipped in:1,as xyz:1,very same:1,same fraction:1,fraction that’s:1,advance x:1,z from:1,inside point:1,coordinates as:1,extra multiply:1,extra add:1,each texture:1,texture coordinate:1,coordinate Clipping:1,the Frustum:1,Frustum Given:1,function it’s:1,frustum set:1,for near:1,far clipping:1,desired next:1,next clip:1,visible polygon:1,turn then:1,whatever polygons:1,polygons emerge:1,core code:1,simple 3-D:1,clipping example:1,move around:1,at polygonal:1,polygonal models:1,models from:1,full code:1,file DDJCLIP.ZIP:1,DDJCLIP.ZIP Figure:1,edge Figure:1,65.3 There:1,65.3 First:1,First floating-point:1,used throughout:1,process While:1,fixed-point doing:1,requires considerable:1,considerable care:1,care regarding:1,regarding range:1,precision Floating-point:1,Floating-point is:1,much easier—and:1,easier—and with:1,Pentium generation:1,processors is:1,generally comparable:1,comparable in:1,in speed:1,fact for:1,some operations:1,as multiplication:1,division when:1,single-precision mode:1,mode floating-point:1,faster Check:1,the February:1,1996 Game:1,interesting discussion:1,discussion along:1,along these:1,lines Second:1,are shifted:1,shifted ever:1,ever so:1,so slightly:1,slightly inward:1,inward from:1,proper positions:1,positions at:1,view This:1,This guarantees:1,never possible:1,visible vertex:1,vertex exactly:1,exactly at:1,the eyepoint:1,eyepoint averting:1,averting the:1,the divide-by-zero:1,vertex would:1,would cause:1,cause when:1,when projected:1,cost Third:1,viewer relative:1,is specified:1,specified via:1,via yaw:1,yaw pitch:1,pitch and:1,and roll:1,roll angles:1,angles successively:1,successively applied:1,order These:1,These angles:1,angles are:1,are accumulated:1,accumulated from:1,frame according:1,to user:1,user input:1,view up:1,up view:1,view right:1,and viewplane:1,normal vectors:1,vectors which:1,which define:1,world coordinate:1,system into:1,viewspace coordinate:1,system those:1,those transformed:1,transformed vectors:1,turn define:1,viewspace See:1,61 for:1,of coordinate:1,and rotation:1,Dam for:1,a broader:1,broader overview:1,overview One:1,One attractive:1,attractive aspect:1,of accumulating:1,accumulating angular:1,angular rotations:1,rotations that:1,then applied:1,system vectors:1,no deterioration:1,matrix over:1,X-Sharp package:1,package in:1,I accumulated:1,accumulated rotations:1,rotations by:1,a cumulative:1,cumulative matrix:1,ever performed:1,performed unfortunately:1,approach caused:1,caused roundoff:1,roundoff error:1,to accumulate:1,accumulate so:1,so objects:1,objects began:1,to warp:1,warp visibly:1,after many:1,many rotations:1,rotations Fourth:1,Fourth Listing:1,65.3 processes:1,processes each:1,each input:1,input polygon:1,a clipped:1,polygon one:1,time It:1,vertices categorizing:1,categorizing whether:1,how they’re:1,they’re clipped:1,then perform:1,test such:1,the Cohen-Sutherland:1,Cohen-Sutherland outcode:1,outcode test:1,test to:1,detect trivial:1,trivial acceptance:1,sometimes trivial:1,rejection the:1,fully outside:1,outside without:1,without ever:1,ever dealing:1,planes actually:1,against as:1,in Line-Segment:1,Line-Segment Clipping:1,Clipping Revisited:1,Revisited Dr:1,January 1996:1,1996 Some:1,Some clipping:1,clipping approaches:1,approaches also:1,also minimize:1,intersection calculations:1,calculations when:1,by multiple:1,planes Further:1,Further Listing:1,65.3 clips:1,clips a:1,polygon against:1,turn generating:1,new output:1,final clipped:1,polygon without:1,any intermediate:1,intermediate representations:1,representations For:1,reading on:1,on advanced:1,advanced clipping:1,clipping techniques:1,techniques see:1,discussion starting:1,page 271:1,271 of:1,Dam Finally:1,Finally clipping:1,worldspace rather:1,The frustum:1,is backtransformed:1,backtransformed from:1,from viewspace:1,viewspace where:1,defined since:1,it exists:1,exists relative:1,viewer to:1,worldspace for:1,purpose Worldspace:1,Worldspace clipping:1,clipping allows:1,transform only:1,those vertices:1,visible rather:1,than transforming:1,transforming all:1,vertices into:1,them However:1,clip in:1,not clear-cut:1,clear-cut and:1,is affected:1,several factors:1,factors Advantages:1,of Viewspace:1,Viewspace Clipping:1,Clipping Although:1,Although viewspace:1,clipping requires:1,requires transforming:1,transforming vertices:1,drawn it:1,has potential:1,worldspace near:1,just additional:1,additional planes:1,tested and:1,using dot:1,products In:1,viewspace near:1,typically planes:1,with constant:1,so testing:1,testing whether:1,is near:1,or far-clipped:1,far-clipped can:1,single z:1,z compare:1,fractional distance:1,or far:1,clip intersection:1,intersection can:1,z subtractions:1,subtractions and:1,divide no:1,no dot:1,needed Similarly:1,degrees so:1,at 45:1,45 degree:1,degree angles:1,angles relative:1,viewplane then:1,then x:1,z along:1,clipping status:1,vertex can:1,determined with:1,comparison far:1,standard dot-product:1,dot-product test:1,test This:1,This lends:1,to outcode-based:1,outcode-based clipping:1,clipping algorithms:1,each compare:1,compare can:1,one outcode:1,outcode bit:1,bit For:1,game 90:1,good field:1,view but:1,of efficient:1,need some:1,other field:1,view Sure:1,Sure All:1,is scale:1,y results:1,the world-to-view:1,world-to-view transformation:1,coordinates lie:1,viewspace that’s:1,that’s normalized:1,normalized such:1,planes extend:1,extend along:1,along lines:1,z The:1,resulting visible:1,visible projected:1,projected points:1,points span:1,range 1:1,1 before:1,before scaling:1,scaling up:1,pixel coordinates:1,coordinates just:1,90-degree field:1,pipeline remains:1,unchanged Better:1,yet there:1,adjustment can:1,matrix I:1,didn’t implement:1,implement normalized:1,65.3 because:1,mechanism without:1,without additional:1,additional complications:1,complications and:1,applications the:1,product which:1,which after:1,all takes:1,only 10-20:1,10-20 cycles:1,sufficient However:1,more frustum:1,frustum clipping:1,clipping you’re:1,doing especially:1,are trivially:1,trivially visible:1,attractive the:1,of normalized:1,clipping become:1,become Further:1,Reading You:1,because fast:1,is central:1,high-performance 3-D:1,3-D there’s:1,learned One:1,reading is:1,is Foley:1,Dam another:1,is Procedural:1,Elements of:1,by David:1,David F:1,F Rogers:1,Rogers Read:1,Read and:1,for world-class:1,world-class clipping:1,clipping And:1,might take:1,how wonderful:1,wonderful it:1,that anyone:1,who’s interested:1,interested can:1,can tap:1,tap into:1,into so:1,much expert:1,expert knowledge:1,price of:1,a book—or:1,book—or on:1,Internet for:1,for free—with:1,free—with no:1,no strings:1,strings attached:1,attached Our:1,place right:1,now isn’t:1,66 Quake’s:1,Quake’s Hidden-Surface:1,Hidden-Surface Removal:1,Removal Struggling:1,Struggling with:1,with Z-Order:1,Z-Order Solutions:1,Solutions to:1,the Hidden:1,Hidden Surface:1,Surface Problem:1,Problem Okay:1,I admit:1,I’m sick:1,sick and:1,and tired:1,rock Admittedly:1,Admittedly it’s:1,while about:1,was last:1,last excited:1,excited to:1,hear anything:1,the Cars:1,Cars or:1,or Boston:1,Boston and:1,never particularly:1,particularly excited:1,excited in:1,place about:1,about Bob:1,Bob Seger:1,Seger or:1,or Queen:1,Queen to:1,of Elvis:1,Elvis so:1,things haven’t:1,haven’t changed:1,changed But:1,knew something:1,something was:1,was up:1,found myself:1,myself changing:1,station on:1,the Allman:1,Allman Brothers:1,Brothers and:1,and Steely:1,Steely Dan:1,and Pink:1,Pink Floyd:1,Floyd and:1,and God:1,God help:1,Beatles just:1,just stuff:1,like Hello:1,Hello Goodbye:1,Goodbye and:1,I’ll Cry:1,Cry Instead:1,Instead though:1,though not:1,not Ticket:1,Ticket to:1,to Ride:1,Ride or:1,or A:1,A Day:1,Day in:1,Life I’m:1,far gone:1,gone It:1,take long:1,was I’d:1,been hearing:1,hearing the:1,same songs:1,songs for:1,a quarter-century:1,quarter-century and:1,was bored:1,bored I:1,I tell:1,of explaining:1,explaining why:1,drove back:1,from dinner:1,dinner the:1,other night:1,night the:1,radio in:1,car was:1,was tuned:1,tuned for:1,time ever:1,ever to:1,a station:1,station whose:1,whose slogan:1,slogan is:1,no alternative:1,alternative Now:1,a 10-year-old:1,10-year-old who:1,who worships:1,worships the:1,Beatles and:1,been raised:1,raised on:1,steady diet:1,diet of:1,of oldies:1,oldies She:1,She loves:1,loves melodies:1,melodies catchy:1,catchy songs:1,songs and:1,good singers:1,singers none:1,rock station:1,station So:1,radio the:1,first word:1,word out:1,was Yuck:1,Yuck What:1,did surprise:1,surprise me:1,after listening:1,while she:1,know Dad:1,Dad it’s:1,actually kind:1,interesting Apart:1,from giving:1,clue as:1,of music:1,music I:1,can expect:1,hear blasting:1,blasting through:1,our house:1,house when:1,when she’s:1,she’s a:1,teenager her:1,her quick:1,quick uptake:1,uptake on:1,on alternative:1,rock versus:1,versus my:1,my decades-long:1,decades-long devotion:1,devotion to:1,the music:1,music of:1,my youth:1,youth reminded:1,of something:1,to forget:1,forget as:1,we become:1,become older:1,older and:1,more set:1,our ways:1,It reminded:1,an open:1,open mind:1,be willing:1,willing better:1,yet eager:1,things Programmers:1,Programmers tend:1,become attached:1,to familiar:1,familiar approaches:1,are inclined:1,inclined to:1,currently doing:1,job adequately:1,programming there:1,always alternatives:1,alternatives and:1,considering Not:1,needed any:1,any reminding:1,reminding considering:1,the ever-evolving:1,ever-evolving nature:1,Quake Creative:1,Creative Flux:1,Flux and:1,and Hidden:1,Surfaces Back:1,64 I:1,creative flux:1,flux that:1,that led:1,led to:1,John Carmack’s:1,Carmack’s decision:1,decision to:1,PVS of:1,possible viewpoint:1,game we’re:1,we’re developing:1,developing here:1,here at:1,Software The:1,PVS meant:1,time searching:1,database to:1,PVS from:1,from back-to-front:1,back-to-front getting:1,the ordering:1,ordering courtesy:1,correct scene:1,scene drawn:1,no searching:1,all letting:1,drawing perform:1,final stage:1,of hidden-surface:1,HSR This:1,terrific idea:1,road for:1,Quake’s design:1,design Drawing:1,Drawing Moving:1,Moving Objects:1,Objects For:1,thing there:1,sort and:1,objects properly:1,single technical:1,technical question:1,question I’ve:1,been asked:1,asked most:1,months so:1,a moving:1,moving model:1,model can:1,can span:1,leaves with:1,are touched:1,touched varying:1,varying as:1,model moves:1,moves that:1,multiple models:1,leaf means:1,means there’s:1,in correctly:1,correctly sorted:1,wrote Chapter:1,64 we:1,were drawing:1,sprites such:1,as explosions:1,explosions moveable:1,moveable BSP:1,monsters by:1,each into:1,leaves it:1,touched then:1,appropriate parts:1,parts as:1,BSP leaf:1,leaf was:1,reached in:1,traversal However:1,this didn’t:1,didn’t solve:1,sorting multiple:1,multiple moving:1,also left:1,left some:1,some ugly:1,ugly sorting:1,sorting problems:1,models John:1,John solved:1,solved the:1,sorting issue:1,for sprites:1,a startlingly:1,startlingly low-tech:1,low-tech way:1,way We:1,now z-buffer:1,z-buffer them:1,is before:1,its distance:1,distance or:1,pixel currently:1,currently on:1,screen drawing:1,one First:1,basic world:1,world walls:1,walls ceilings:1,like No:1,No z-buffer:1,z-buffer testing:1,testing is:1,involved at:1,world visible:1,determination is:1,see soon:1,soon however:1,do fill:1,values actually:1,actually 1/z:1,below for:1,world pixels:1,pixels Z-filling:1,Z-filling is:1,faster process:1,than z-buffering:1,z-buffering the:1,no reads:1,compares are:1,involved just:1,just writes:1,values Once:1,and z-filling:1,z-filling of:1,done we:1,models with:1,get perfect:1,perfect sorting:1,all around:1,around Performance:1,Performance Impact:1,Impact Whenever:1,the questions:1,questions inevitably:1,inevitably are:1,are What’s:1,footprint and:1,and what’s:1,impact Well:1,footprint at:1,is 128K:1,128K not:1,not trivial:1,trivial but:1,deal for:1,requires 8:1,MB to:1,impact is:1,for z-filling:1,z-filling the:1,and roughly:1,roughly 20:1,percent with:1,of variation:1,variation for:1,return we:1,perfectly sorted:1,sorted world:1,additional effects:1,as particle:1,particle explosions:1,and smoke:1,smoke because:1,z-buffer lets:1,us flawlessly:1,flawlessly sort:1,sort such:1,such effects:1,effects into:1,world All:1,z-buffer vastly:1,also simplified:1,bit at:1,acceptable memory:1,cost Leveling:1,Leveling and:1,and Improving:1,Improving Performance:1,Quake architecture:1,architecture the:1,first without:1,without z-buffer:1,z-buffer reads:1,compares but:1,but filling:1,polygons z:1,drawn atop:1,world using:1,using full:1,full z-buffering:1,z-buffering Thus:1,discussed how:1,objects For:1,drawing equation:1,equation that:1,itself where:1,never moves:1,moves As:1,64 we’re:1,both raw:1,performance That:1,speed between:1,the slowest-drawing:1,slowest-drawing scene:1,scene to:1,as small:1,small as:1,does little:1,little good:1,average 30:1,second if:1,if 10:1,the scenes:1,scenes draw:1,at 5:1,5 fps:1,fps because:1,the jerkiness:1,jerkiness in:1,those scenes:1,scenes will:1,extremely obvious:1,obvious by:1,highly objectionable:1,objectionable It:1,average 15:1,fps 100:1,average drawing:1,important step:1,toward both:1,more level:1,it eliminated:1,identify visible:1,polygons a:1,slow step:1,step that:1,that tended:1,scenes Nonetheless:1,Nonetheless in:1,some spots:1,real game:1,game levels:1,PVS contains:1,contains five:1,visible together:1,back-to-front HSR:1,HSR approach:1,approach this:1,this created:1,created hot:1,rate bogged:1,bogged down:1,down visibly:1,visibly as:1,as hundreds:1,drawn back-to:1,front most:1,those immediately:1,immediately getting:1,getting overdrawn:1,overdrawn by:1,nearer polygons:1,polygons Raw:1,Raw performance:1,general was:1,also reduced:1,reduced by:1,typical 50:1,50 overdraw:1,overdraw resulting:1,from drawing:1,drawing everything:1,PVS So:1,although drawing:1,PVS back-to-front:1,back-to-front as:1,stage worked:1,over previous:1,previous designs:1,designs it:1,not ideal:1,ideal Surely:1,Surely John:1,John thought:1,thought there’s:1,to leverage:1,leverage the:1,PVS than:1,than back-to-front:1,drawing And:1,indeed there:1,is Sorted:1,The ideal:1,ideal final:1,stage for:1,would reject:1,reject all:1,PVS that:1,actually invisible:1,visible pixels:1,drawn exactly:1,once all:1,course One:1,although certainly:1,zero cost:1,front-to-back maintaining:1,a region:1,currently occluded:1,occluded portions:1,that region:1,region before:1,it That:1,sounds promising:1,promising but:1,fact nothing:1,tree approach:1,64 an:1,have considerable:1,and serious:1,serious leveling:1,leveling problems:1,problems We:1,better if:1,stage from:1,polygon level:1,span level:1,a sorted-spans:1,In essence:1,essence this:1,approach consists:1,turning each:1,then sorting:1,spans against:1,other until:1,until only:1,66.2 This:1,sound a:1,like z-buffering:1,z-buffering which:1,simply too:1,it’s fine:1,for smaller:1,smaller moving:1,objects as:1,earlier but:1,are crucial:1,crucial differences:1,differences Figure:1,generation Figure:1,generation By:1,z-buffering only:1,only visible:1,out pixel:1,pixel although:1,although all:1,be rasterized:1,rasterized Better:1,sorting that:1,z-buffering does:1,does at:1,pixel becomes:1,a per-span:1,per-span operation:1,operation with:1,with sorted:1,the coherence:1,coherence implicit:1,list each:1,only against:1,against some:1,clipped only:1,few spans:1,overlaps horizontally:1,Although complex:1,scenes still:1,than simple:1,simple scenes:1,scenes the:1,case isn’t:1,tree or:1,back-to-front approaches:1,approaches because:1,overdraw or:1,or scanning:1,hidden pixels:1,because complexity:1,complexity is:1,pixel resolution:1,because span:1,span coherence:1,coherence tends:1,worst-case sorting:1,a low-level:1,low-level rasterizer:1,rasterizer needs:1,needs a:1,descriptors each:1,each consisting:1,start coordinate:1,the sorted:1,spans approach:1,approach meets:1,original criteria:1,criteria pretty:1,isn’t zero-cost:1,zero-cost it’s:1,not horribly:1,horribly expensive:1,expensive it:1,eliminates both:1,both overdraw:1,overdraw and:1,pixel scanning:1,of obscured:1,obscured portions:1,to level:1,level worst-case:1,performance We:1,We wouldn’t:1,on sorted:1,spans alone:1,alone as:1,our hidden-surface:1,hidden-surface mechanism:1,mechanism but:1,PVS reduces:1,spans can:1,handle quite:1,nicely So:1,So we’ve:1,we’ve found:1,need now:1,we’re on:1,our way:1,way right:1,right Well:1,yes and:1,no Conceptually:1,Conceptually the:1,the sorted-spans:1,it’s surprisingly:1,surprisingly difficult:1,implement with:1,of major:1,major design:1,choices to:1,a subtle:1,subtle mathematical:1,mathematical element:1,element and:1,some tricky:1,tricky gotchas:1,gotchas that:1,I’ll have:1,to defer:1,defer until:1,until Chapter:1,67 Let’s:1,choices first:1,first Edges:1,Edges versus:1,versus Spans:1,first design:1,design choice:1,choice is:1,sort spans:1,spans or:1,or edges:1,edges both:1,which fall:1,general category:1,category of:1,spans Although:1,same both:1,ways a:1,the implementations:1,implementations and:1,implications are:1,different because:1,clipping are:1,different data:1,structures With:1,buckets typically:1,typically with:1,one bucket:1,bucket per:1,bucket for:1,66.2 so:1,each bucket:1,bucket contains:1,spans encountered:1,encountered thus:1,far always:1,always with:1,approach involves:1,generating all:1,all spans:1,span immediately:1,immediately being:1,being sorted:1,sorted clipped:1,appropriate bucket:1,bucket Figure:1,another Figure:1,another With:1,edge-sorting edges:1,buckets according:1,is decomposed:1,decomposed into:1,into edges:1,edges cumulatively:1,cumulatively building:1,scene Once:1,frustum have:1,whole list:1,single top-to-bottom:1,left-to-right pass:1,pass An:1,An active:1,list AEL:1,maintained With:1,line edges:1,AEL active:1,are stepped:1,stepped to:1,new x:1,coordinates edges:1,edges starting:1,AEL and:1,are sorted:1,by current:1,coordinate For:1,a z-sorted:1,z-sorted active:1,active polygon:1,list APL:1,APL is:1,maintained The:1,The x-sorted:1,x-sorted AEL:1,stepped through:1,order As:1,encountered that:1,starts or:1,ends as:1,move left:1,right the:1,the associated:1,associated polygon:1,activated and:1,and sorted:1,66.3 or:1,or deactivated:1,deactivated and:1,and removed:1,66.4 for:1,edge respectively:1,respectively If:1,changed that:1,nearest or:1,ended a:1,is emitted:1,emitted for:1,just stopped:1,stopped being:1,nearest starting:1,polygon first:1,because nearest:1,and ending:1,is recorded:1,recorded in:1,nearest This:1,saved coordinate:1,coordinate later:1,later serves:1,emitted when:1,new nearest:1,polygon ceases:1,ceases to:1,front Don’t:1,didn’t follow:1,follow all:1,edge-sorting to:1,help make:1,little clearer:1,clearer My:1,My thorough:1,thorough discussion:1,topic will:1,67 The:1,edge-sorting are:1,same spans:1,that ultimately:1,ultimately emerge:1,from span-sorting:1,span-sorting the:1,the intermediate:1,intermediate data:1,scene With:1,edge-sorting the:1,are kept:1,kept implicit:1,edges until:1,final set:1,generated so:1,and span:1,span emission:1,emission is:1,edge adds:1,adds or:1,or removes:1,removes a:1,polygon based:1,span state:1,state implied:1,polygons With:1,are immediately:1,immediately made:1,made explicit:1,explicit when:1,when each:1,rasterized and:1,those intermediate:1,intermediate spans:1,then sorted:1,against other:1,other the:1,final spans:1,are explicit:1,explicit at:1,all work:1,done directly:1,with spans:1,spans Both:1,Both span-sorting:1,edge-sorting work:1,been employed:1,employed successfully:1,successfully in:1,in commercial:1,commercial projects:1,projects We’ve:1,We’ve chosen:1,use edge-sorting:1,edge-sorting in:1,Quake partly:1,seems inherently:1,inherently more:1,with excellent:1,excellent horizontal:1,horizontal coherence:1,coherence that:1,for minimal:1,minimal time:1,potentially costly:1,costly sorting:1,sorting into:1,into linked:1,lists that:1,that span-sorting:1,span-sorting can:1,involve A:1,important reason:1,edge-sorting we’re:1,that cuts:1,work involved:1,in sorting:1,and rasterizing:1,rasterizing edges:1,edges nearly:1,nearly in:1,half while:1,while also:1,also shrinking:1,database quite:1,bit due:1,the sharing:1,sharing Figure:1,AEL One:1,One final:1,edge-sorting is:1,no distinction:1,polygons That’s:1,consideration for:1,engines but:1,Quake edge:1,edge clipping:1,clipping transformation:1,transformation projection:1,sorting have:1,become a:1,major bottleneck:1,bottleneck so:1,we’re doing:1,doing everything:1,can to:1,and edge:1,edge counts:1,polygons help:1,that regard:1,regard While:1,handle concave:1,with span-sorting:1,span-sorting that:1,involve significant:1,performance penalties:1,penalties Figure:1,AEL Nonetheless:1,Nonetheless there’s:1,no cut-and-dried:1,cut-and-dried answer:1,answer as:1,which approach:1,end span-sorting:1,edge-sorting amount:1,with In:1,67 I’ll:1,into considerable:1,about edge-sorting:1,edge-sorting complete:1,full implementation:1,implementation I’m:1,the spend:1,chapter laying:1,laying the:1,67 by:1,discussing sorting:1,sorting keys:1,calculation In:1,few forward:1,forward references:1,references to:1,to aspects:1,edge-sorting that:1,yet covered:1,detail my:1,apologies but:1,it’s unavoidable:1,unavoidable and:1,67 Edge-Sorting:1,Edge-Sorting Keys:1,Keys Now:1,know we’re:1,sort edges:1,edges using:1,emit spans:1,polygons nearest:1,viewer the:1,question becomes:1,becomes How:1,we tell:1,are nearest:1,nearest Ideally:1,we’d just:1,edge came:1,along we’d:1,we’d compare:1,its surface’s:1,surface’s key:1,the keys:1,keys of:1,other currently:1,easily tell:1,which polygon:1,was nearest:1,nearest That:1,sounds too:1,too good:1,your world:1,polygons clipped:1,leaves then:1,then BSP:1,BSP walk:1,walk order:1,valid drawing:1,order So:1,you walk:1,BSP back-to-front:1,back-to-front assigning:1,assigning each:1,polygon an:1,an incrementally:1,incrementally higher:1,higher key:1,key as:1,you reach:1,reach it:1,it polygons:1,with higher:1,higher keys:1,are guaranteed:1,with lower:1,lower keys:1,keys This:1,approach Quake:1,Quake used:1,while although:1,now being:1,explain shortly:1,shortly If:1,BSP or:1,or similar:1,similar data:1,structure handy:1,handy or:1,have lots:1,polygons BSPs:1,BSPs don’t:1,don’t handle:1,handle moving:1,polygons very:1,efficiently another:1,accomplish your:1,your objectives:1,objectives would:1,polygons against:1,another before:1,scene assigning:1,assigning appropriate:1,appropriate keys:1,keys based:1,their spatial:1,spatial relationships:1,relationships in:1,viewspace Unfortunately:1,generally an:1,slow task:1,task because:1,polygon There:1,sorts but:1,who’s doing:1,doing general:1,general polygon:1,scenes in:1,PC An:1,sort by:1,viewer in:1,screenspace an:1,that dovetails:1,dovetails nicely:1,excellent spatial:1,spatial coherence:1,edge-sorting As:1,encountered on:1,corresponding polygon’s:1,polygon’s z:1,distance can:1,polygons distances:1,distances and:1,APL accordingly:1,accordingly Getting:1,Getting z:1,distances can:1,be tricky:1,tricky however:1,however Remember:1,z at:1,polygon because:1,because an:1,edge may:1,cause its:1,its polygon:1,APL at:1,z directly:1,polygon’s plane:1,equation but:1,unfortunately this:1,this can’t:1,done very:1,quickly because:1,plane doesn’t:1,doesn’t vary:1,linearly in:1,screenspace however:1,however 1/z:1,1/z does:1,linearly so:1,instead See:1,See Chris:1,Hecker’s 1995:1,1995 series:1,on texture:1,in Game:1,Developer magazine:1,magazine for:1,screenspace linearity:1,linearity and:1,and gradients:1,1/z Another:1,its resolution:1,resolution increases:1,increases with:1,with decreasing:1,decreasing distance:1,distance meaning:1,1/z we’ll:1,have better:1,better depth:1,depth resolution:1,for nearby:1,nearby features:1,features where:1,matters most:1,most The:1,vertices interpolate:1,interpolate it:1,it down:1,down both:1,and interpolate:1,interest Unfortunately:1,requires doing:1,work along:1,and worse:1,worse requires:1,requires division:1,division to:1,1/z step:1,step per:1,span A:1,1/z directly:1,y of:1,interest The:1,The equation:1,equation is:1,is 1/z:1,1/z a/d)x:1,a/d)x b/d)y:1,b/d)y c/d:1,c/d where:1,viewspace z:1,that projects:1,projects to:1,coordinate x:1,y the:1,projection the:1,screen straight:1,straight ahead:1,viewpoint a:1,c is:1,d is:1,viewspace origin:1,origin to:1,normal Division:1,Division is:1,done only:1,c and:1,d are:1,are per-plane:1,per-plane constants:1,constants The:1,full 1/z:1,calculation requires:1,adds all:1,be floating-point:1,avoid range:1,range errors:1,errors That:1,That much:1,much floating-point:1,math sounds:1,sounds expensive:1,expensive but:1,but really:1,really isn’t:1,isn’t especially:1,a plane’s:1,plane’s 1/z:1,in as:1,as six:1,language Where:1,Where That:1,That 1/Z:1,1/Z Equation:1,Equation Comes:1,Comes From:1,From For:1,are interested:1,interested here’s:1,here’s a:1,quick derivation:1,1/z equation:1,equation The:1,are viewspace:1,viewspace coordinates:1,c d:1,d and:1,z are:1,defined above:1,above If:1,we substitute:1,substitute x:1,x x’z:1,x’z and:1,y y’z:1,y’z from:1,projection with:1,y inverted:1,inverted because:1,because y:1,y increases:1,increases upward:1,upward in:1,but downward:1,downward in:1,screenspace and:1,some rearrangement:1,rearrangement we:1,get Quake:1,and Z-Sorting:1,Z-Sorting I:1,Quake no:1,longer uses:1,uses BSP:1,uses 1/z:1,key now:1,now Elegant:1,Elegant as:1,are calculating:1,calculating 1/z:1,clearly slower:1,compare on:1,a BSP-ordered:1,BSP-ordered key:1,key so:1,why have:1,switched Quake:1,to 1/z:1,1/z The:1,polygons Drawing:1,order means:1,means following:1,following certain:1,certain rules:1,rules including:1,split if:1,cross BSP:1,BSP planes:1,splitting increases:1,numbers of:1,edges considerably:1,considerably By:1,By sorting:1,1/z we’re:1,leave polygons:1,unsplit but:1,still get:1,get correct:1,correct drawing:1,drawing overall:1,overall despite:1,added cost:1,sorting Another:1,it solves:1,sorting issues:1,issues I:1,start involving:1,themselves small:1,small BSP:1,trees Sorting:1,order wouldn’t:1,wouldn’t work:1,work here:1,separate BSPs:1,BSPs and:1,work them:1,world BSP’s:1,BSP’s sequence:1,sequence order:1,use z-buffering:1,often large:1,large objects:1,lose the:1,the overdraw-reduction:1,overdraw-reduction benefits:1,benefits that:1,that closed:1,doors provide:1,provide when:1,when drawn:1,list With:1,With sorted:1,simply placed:1,list first:1,first clipping:1,clipping polygons:1,don’t cross:1,any solid:1,solid world:1,world surfaces:1,complications associated:1,with interpenetration:1,interpenetration along:1,world edges:1,sorting takes:1,rest Decisions:1,Decisions Deferred:1,Deferred There:1,a doubt:1,doubt an:1,preceding pages:1,all connect:1,connect together:1,together yet:1,mind The:1,and accompanying:1,accompanying explanation:1,explanation in:1,chapter should:1,should help:1,help if:1,to peek:1,peek ahead:1,as DDJZSORT.ZIP:1,DDJZSORT.ZIP in:1,67 You:1,at Foley:1,Graphics or:1,or Rogers:1,Rogers Procedural:1,Elements for:1,for Computer:1,Graphics As:1,this it’s:1,it’s unclear:1,whether Quake:1,up sorting:1,sorting edges:1,edges by:1,order or:1,or 1/z:1,1/z Actually:1,Actually there’s:1,any form:1,form will:1,final design:1,design Sometimes:1,seems like:1,change graphics:1,play Elvis:1,Elvis on:1,the 50s:1,50s oldies:1,oldies stations:1,stations but:1,hope with:1,more aesthetically:1,aesthetically pleasing:1,pleasing results:1,results and:1,doubt we’ll:1,be considering:1,alternatives right:1,day we:1,we ship:1,ship Chapter:1,67 Sorted:1,Spans in:1,Action Implementing:1,Implementing Independent:1,Sorting for:1,for Rendering:1,Rendering without:1,without Overdraw:1,Overdraw In:1,66 we:1,we dove:1,dove headlong:1,headlong into:1,the intricacies:1,of z-sorted:1,z-sorted actually:1,actually 1/z-sorted:1,spans At:1,were currently:1,currently using:1,using 1/z-sorted:1,was unclear:1,whether we’d:1,we’d switch:1,order Well:1,Well some:1,writing it’s:1,it’s become:1,clear We’re:1,We’re back:1,sorting spans:1,In Robert:1,A Heinlein’s:1,Heinlein’s wonderful:1,wonderful story:1,story The:1,The Man:1,Man Who:1,Who Sold:1,Sold the:1,Moon the:1,the chief:1,chief engineer:1,engineer of:1,Moon rocket:1,rocket project:1,project tries:1,a payload:1,payload of:1,three astronauts:1,astronauts to:1,Moon and:1,back He:1,He starts:1,a four-stage:1,four-stage rocket:1,rocket design:1,but finds:1,finds that:1,job so:1,he adds:1,a fifth:1,stage The:1,stage helps:1,helps but:1,quite enough:1,enough Because:1,Because he:1,he explains:1,explains I’ve:1,in too:1,much dead:1,weight that’s:1,The dead:1,weight is:1,the control:1,control and:1,and safety:1,safety equipment:1,equipment that:1,stage He:1,then tries:1,tries adding:1,adding yet:1,another stage:1,stage only:1,sixth stage:1,stage actually:1,actually results:1,a net:1,net slowdown:1,slowdown In:1,end he:1,the three-person:1,three-person design:1,a one-person:1,one-person spacecraft:1,spacecraft instead:1,instead 1/z-sorted:1,Quake turned:1,moment First:1,note up:1,front that:1,very technical:1,technical and:1,builds heavily:1,on material:1,covered earlier:1,book if:1,already read:1,Chapters 59:1,59 through:1,through 66:1,66 you:1,really should:1,should Make:1,is commercial-quality:1,commercial-quality stuff:1,same sorting:1,sorting technique:1,test version:1,Quake QTEST1.ZIP:1,QTEST1.ZIP that:1,Software placed:1,Internet in:1,early March:1,March 1996:1,1996 This:1,This material:1,material is:1,McCoy true:1,true reports:1,reports from:1,patient if:1,if careful:1,careful rereading:1,rereading and:1,some occasional:1,occasional catch-up:1,catch-up reading:1,reading of:1,of earlier:1,absorb everything:1,everything contained:1,contained herein:1,herein Besides:1,Besides the:1,ultimate reference:1,any design:1,which you’ll:1,in part:1,file DDJZSORT.ZIP:1,DDJZSORT.ZIP on:1,CD-ROM Quake:1,and Sorted:1,Spans As:1,66 Quake:1,uses sorted:1,get zero:1,overdraw while:1,while rendering:1,world thereby:1,thereby both:1,both improving:1,improving overall:1,and leveling:1,leveling frame:1,rates by:1,up scenes:1,scenes that:1,otherwise experience:1,experience heavy:1,heavy overdraw:1,overdraw Our:1,design used:1,used spans:1,we traverse:1,front-to-back relative:1,nodes are:1,visited is:1,a guaranteed:1,guaranteed front-to-back:1,front-to-back sorting:1,simply gave:1,gave each:1,node an:1,an increasing:1,increasing BSP:1,number as:1,was visited:1,visited set:1,each polygon’s:1,polygon’s sort:1,sort key:1,node BSP:1,splitting plane:1,it lay:1,used those:1,those sort:1,keys when:1,when generating:1,spans In:1,earlier designs:1,designs polygons:1,polygons now:1,now are:1,nodes rather:1,than leaves:1,subspaces carved:1,tree Visits:1,Visits to:1,to potentially:1,touch those:1,those leaves:1,each marked-visible:1,marked-visible polygon:1,drawn after:1,after everything:1,its node:1,drawn This:1,less BSP:1,splitting of:1,explained below:1,This worked:1,worked flawlessly:1,flawlessly for:1,but had:1,of downsides:1,downsides First:1,didn’t address:1,sorting small:1,small moving:1,doors those:1,models could:1,BSP tree’s:1,tree’s leaves:1,and assigned:1,assigned sort:1,keys corresponding:1,leaves into:1,they fell:1,fell but:1,sort multiple:1,other Second:1,Second strict:1,strict BSP:1,order requires:1,polygons be:1,leaf This:1,be stretched:1,stretched by:1,putting polygons:1,nodes allowing:1,for larger:1,average but:1,then polygons:1,polygons still:1,still need:1,falls within:1,bounding volume:1,it lies:1,lies The:1,and smaller:1,than if:1,if BSP:1,order weren’t:1,weren’t used—and:1,used—and that:1,turn means:1,means lower:1,lower performance:1,projected more:1,more sorting:1,sorting must:1,more spans:1,spans must:1,drawn We:1,We figured:1,figured that:1,avoid those:1,those BSP:1,splits Quake:1,faster Accordingly:1,Accordingly we:1,from sorting:1,1/z and:1,left our:1,our polygons:1,unsplit Things:1,Things did:1,get faster:1,expected for:1,is descended:1,descended we:1,each node’s:1,node’s bounding:1,it’s inside:1,outside each:1,clipping results:1,be remembered:1,remembered and:1,often allow:1,the avoidance:1,avoidance of:1,all clipping:1,node’s polygons:1,a trivially:1,trivially accepted:1,accepted bounding:1,box are:1,likewise guaranteed:1,be unclipped:1,unclipped and:1,frustum since:1,all lie:1,no further:1,further clipping:1,clipping This:1,This efficient:1,mechanism vanished:1,vanished as:1,we stepped:1,stepped out:1,longer necessarily:1,necessarily confined:1,confined to:1,its node’s:1,volume Second:1,Second sorting:1,1/z isn’t:1,as sorting:1,and comparisons:1,involved rather:1,than integer:1,integer compares:1,compares So:1,So Quake:1,Quake got:1,got faster:1,but like:1,like Heinlein’s:1,Heinlein’s fifth:1,fifth rocket:1,stage there:1,was clear:1,clear evidence:1,evidence of:1,of diminishing:1,diminishing returns:1,returns That:1,That wasn’t:1,the bad:1,bad part:1,part after:1,small speed:1,speed increase:1,increase is:1,our initial:1,initial 1/z:1,sorting proved:1,be unreliable:1,unreliable We:1,We first:1,first ran:1,ran into:1,into problems:1,two forward-facing:1,forward-facing polygons:1,polygons started:1,common edge:1,was hard:1,really in:1,front as:1,additional floating-point:1,to resolve:1,resolve these:1,cases This:1,This fixed:1,fixed the:1,problems for:1,then odd:1,odd cases:1,cases started:1,started popping:1,popping up:1,up where:1,right combination:1,polygon alignments:1,alignments caused:1,caused new:1,new sorting:1,errors We:1,We tinkered:1,tinkered with:1,those too:1,too adding:1,adding more:1,and incurring:1,incurring additional:1,additional slowdowns:1,slowdowns in:1,had everything:1,everything working:1,working smoothly:1,smoothly again:1,again although:1,although by:1,point Quake:1,was back:1,to pretty:1,sorting And:1,then yet:1,another crop:1,errors popped:1,popped up:1,up We:1,have fixed:1,fixed those:1,those errors:1,errors too:1,too we’ll:1,cases shortly:1,shortly However:1,However like:1,sixth rocket:1,the fixes:1,fixes would:1,made Quake:1,Quake slower:1,sorting So:1,we gave:1,gave up:1,sorting works:1,works reliably:1,reliably It’s:1,It’s too:1,too bad:1,bad our:1,our experiment:1,experiment didn’t:1,wasn’t wasted:1,in trying:1,trying what:1,learned quite:1,bit In:1,information provided:1,simple reliable:1,reliable world:1,world ordering:1,ordering mechanism:1,mechanism such:1,more good:1,good than:1,is immediately:1,immediately apparent:1,solid code:1,code Nonetheless:1,Nonetheless sorting:1,1/z can:1,tool used:1,context drawing:1,a Quake:1,world just:1,be such:1,case In:1,fact sorting:1,we’re now:1,now handling:1,handling the:1,sorting of:1,the option:1,option of:1,using BSP:1,drawing multiple:1,multiple independent:1,independent trees:1,trees so:1,set restrictions:1,restrictions on:1,avoid running:1,the types:1,errors we:1,we encountered:1,encountered drawing:1,world Next:1,at another:1,another application:1,which sorting:1,useful one:1,one where:1,move freely:1,freely through:1,space As:1,one right:1,right technique:1,different techniques:1,techniques each:1,one handy:1,right situations:1,situations Often:1,Often a:1,techniques is:1,is beneficial:1,beneficial for:1,combination in:1,Quake of:1,for BSP:1,leaf For:1,three main:1,main types:1,sorting then:1,then discuss:1,discuss a:1,3-D app:1,app built:1,around 1/z:1,sorting Types:1,Types of:1,Sorting As:1,refresher With:1,With 1/z:1,as sets:1,screenspace pixel:1,pixel spans:1,1/z where:1,viewspace as:1,span overlapping:1,overlapping each:1,66 in:1,program we’re:1,our sorting:1,which represent:1,represent spans:1,an implicit:1,implicit form:1,form There:1,sorting each:1,each requiring:1,different implementation:1,of increasing:1,increasing speed:1,and decreasing:1,decreasing complexity:1,complexity they:1,are intersecting:1,intersecting abutting:1,abutting and:1,independent These:1,are names:1,own devising:1,devising I:1,haven’t come:1,standard nomenclature:1,nomenclature in:1,literature Intersecting:1,Intersecting Span:1,Sorting Intersecting:1,can interpenetrate:1,interpenetrate Thus:1,Thus two:1,two spans:1,spans may:1,may cross:1,cross such:1,drawn appropriately:1,appropriately as:1,67.1 Figure:1,sorting Intersecting:1,Intersecting is:1,slowest and:1,complicated type:1,compare 1/z:1,values at:1,detect interpenetration:1,interpenetration and:1,and additional:1,additional work:1,work must:1,necessary Thus:1,Thus although:1,although intersecting:1,intersecting span:1,sorting certainly:1,certainly works:1,works it’s:1,first choice:1,performance Abutting:1,Abutting Span:1,Sorting Abutting:1,continuous surface:1,can butt:1,butt up:1,don’t interpenetrate:1,interpenetrate as:1,67.2 This:1,Quake where:1,objects like:1,like doors:1,doors often:1,often abut:1,abut walls:1,and turns:1,think The:1,an abutting:1,abutting polygon:1,polygon B:1,67.2 it:1,same 1/z:1,polygon it:1,it abuts:1,abuts in:1,case polygon:1,A so:1,so additional:1,when these:1,these ties:1,ties happen:1,happen Of:1,the two-point:1,two-point sorting:1,for intersecting:1,intersecting polygons:1,but we’d:1,something faster:1,faster As:1,for abutting:1,abutting polygons:1,actually quite:1,quite simple:1,simple whichever:1,greater 1/z:1,1/z gradient:1,gradient with:1,x that:1,is whichever:1,is heading:1,heading fastest:1,fastest toward:1,front one:1,one The:1,is identifying:1,identifying when:1,when ties—that:1,ties—that is:1,is abutting:1,abutting polygons—occur:1,polygons—occur due:1,floating-point imprecision:1,imprecision as:1,as fixed-point:1,fixed-point edge-stepping:1,edge-stepping imprecision:1,imprecision that:1,move an:1,edge slightly:1,slightly on:1,screen calculations:1,1/z gradients:1,gradients as:1,discussed last:1,be slightly:1,slightly off:1,off so:1,so most:1,most tie:1,tie cases:1,as near:1,near matches:1,matches not:1,not exact:1,exact matches:1,matches This:1,This imprecision:1,imprecision makes:1,comparisons one:1,an adjust-up:1,adjust-up by:1,epsilon and:1,an adjust-down:1,adjust-down creating:1,a range:1,which near-matches:1,near-matches are:1,considered matches:1,matches Fine-tuning:1,Fine-tuning this:1,this epsilon:1,epsilon to:1,to catch:1,catch all:1,all ties:1,ties without:1,without falsely:1,falsely reporting:1,reporting close-but-not-abutting:1,close-but-not-abutting edges:1,as ties:1,ties proved:1,be troublesome:1,troublesome in:1,epsilon calculations:1,extra comparisons:1,comparisons slowed:1,down Figure:1,sorting I:1,do think:1,that abutting:1,abutting 1/z:1,sorting could:1,made reliable:1,reliable enough:1,for production:1,production use:1,Quake were:1,we share:1,Quake so:1,large polygon:1,polygon mesh:1,mesh When:1,polygon ends:1,an adjacent:1,that shares:1,shares the:1,ended we:1,simply assume:1,sorts relative:1,other active:1,ended because:1,the mesh:1,mesh is:1,is continuous:1,continuous and:1,interpenetration rather:1,1/z sort:1,sort from:1,scratch This:1,This speeds:1,speeds things:1,sorting but:1,sorting error:1,error a:1,string of:1,sorted incorrectly:1,incorrectly pulled:1,pulled in:1,in by:1,one missorted:1,missorted polygon:1,polygon Missorting:1,Missorting is:1,real hazard:1,hazard when:1,nearly perpendicular:1,1/z calculations:1,calculations push:1,of numeric:1,precision especially:1,single-precision floating:1,point Many:1,Many caching:1,schemes are:1,with abutting:1,abutting span:1,because any:1,given pair:1,being noninterpenetrating:1,noninterpenetrating will:1,will sort:1,sort in:1,order throughout:1,throughout a:1,scene However:1,Quake at:1,caching sort:1,sort results:1,were outweighed:1,outweighed by:1,additional overhead:1,caching information:1,every caching:1,caching variant:1,variant we:1,tried actually:1,actually slowed:1,slowed Quake:1,Quake down:1,down Independent:1,Sorting Finally:1,to independent:1,independent span:1,simplest and:1,and fastest:1,type the:1,uses Here:1,Here polygons:1,polygons never:1,intersect or:1,or touch:1,touch any:1,except adjacent:1,they form:1,mesh This:1,single 1/z:1,1/z comparison:1,comparison between:1,overlaps on:1,produce correct:1,correct sorting:1,calculations or:1,or tricky:1,tricky cases:1,about Independent:1,Independent span:1,for scenes:1,actually touch:1,touch each:1,other such:1,space battle:1,battle Next:1,sorting 1/z:1,that demonstrates:1,demonstrates independent:1,sorting This:1,clipping program:1,65 however:1,did hidden:1,HSR by:1,simply z-sorting:1,z-sorting whole:1,whole objects:1,them back-to-front:1,back-to-front while:1,67.1 draws:1,a 1/z-sorted:1,1/z-sorted edge:1,list Consequently:1,Consequently where:1,program worked:1,worked only:1,as object:1,object centers:1,centers correctly:1,correctly described:1,described sorting:1,all combinations:1,of non-intersecting:1,non-intersecting and:1,and non-abutting:1,non-abutting polygons:1,particular Listing:1,67.1 correctly:1,correctly handles:1,handles concave:1,concave polyhedra:1,polyhedra a:1,new L-shaped:1,L-shaped object:1,object the:1,67.1 has:1,illustrate this:1,this capability:1,handle complex:1,complex shapes:1,shapes makes:1,67.1 vastly:1,for real-world:1,real-world applications:1,applications than:1,clipping demo:1,demo from:1,65 By:1,token Listing:1,earlier code:1,The earlier:1,earlier code’s:1,code’s HSR:1,HSR consisted:1,a z-sort:1,z-sort of:1,objects followed:1,order one:1,time Apart:1,simple object:1,object sorter:1,sorter all:1,was needed:1,was backface:1,rasterizer Listing:1,67.1 replaces:1,replaces this:1,simple pipeline:1,pipeline with:1,a three-stage:1,three-stage HSR:1,HSR process:1,process After:1,After backface:1,culling the:1,list by:1,of AddPolygonEdges:1,AddPolygonEdges After:1,edges have:1,by ScanEdges:1,ScanEdges with:1,screen being:1,being covered:1,one span:1,span that:1,overdraw Once:1,been generated:1,generated they’re:1,by DrawSpans:1,DrawSpans and:1,complete There’s:1,nothing tricky:1,tricky about:1,about AddPolygonEdges:1,AddPolygonEdges and:1,and DrawSpans:1,DrawSpans as:1,supported texture:1,mapping however:1,spans wouldn’t:1,one global:1,drawing spans:1,particular order:1,order A:1,drawing object:1,that’s originally:1,originally described:1,ScanEdges there:1,no polygon:1,vertices bounding:1,bounding an:1,area but:1,that describes:1,spans outlined:1,outlined by:1,by those:1,edges That:1,mean constantly:1,constantly skipping:1,skipping from:1,one texture:1,another which:1,turn would:1,hurt processor:1,coherency a:1,deal and:1,also incur:1,incur considerable:1,up gradient:1,gradient and:1,perspective calculations:1,calculations each:1,surface was:1,spans hanging:1,hanging off:1,surface before:1,next surface:1,The core:1,complex aspect:1,of 1/z-sorted:1,is ScanEdges:1,ScanEdges where:1,is converted:1,converted into:1,spans describing:1,pixel This:1,line there:1,that intersect:1,intersect the:1,good part:1,of ScanEdges:1,ScanEdges is:1,adding any:1,first appear:1,line scan:1,bottom removing:1,removing edges:1,reach their:1,their bottom:1,bottom on:1,and x-sorting:1,x-sorting the:1,scan can:1,right All:1,is per-scan-line:1,per-scan-line maintenance:1,basically just:1,just linked:1,list insertion:1,insertion deletion:1,deletion and:1,sorting The:1,The heart:1,ScanEdges that:1,processes the:1,right generating:1,surface event:1,event processor:1,event with:1,an associated:1,associated surface:1,surface on:1,current nearest:1,surface if:1,if its:1,currently nearest:1,nearest then:1,the next-nearest:1,next-nearest surface:1,the next-largest:1,next-largest 1/z:1,coordinate where:1,edge intersects:1,line One:1,One handy:1,handy aspect:1,this event-oriented:1,event-oriented processing:1,that leading:1,leading and:1,and trailing:1,edges do:1,be explicitly:1,explicitly paired:1,paired because:1,implicitly paired:1,paired by:1,by pointing:1,track edge:1,edge pairs:1,pairs One:1,One more:1,more element:1,for ScanEdges:1,ScanEdges to:1,work efficiently:1,efficiently Each:1,edge occurs:1,occurs it:1,determined whether:1,whether its:1,nearest at:1,larger 1/z:1,value than:1,active surface:1,surface In:1,for leading:1,leading edges:1,currently topmost:1,topmost surface:1,surface must:1,be known:1,for trailing:1,edges it:1,currently next-to-topmost:1,next-to-topmost surface:1,all currently:1,surfaces starting:1,and progressing:1,farthest surface:1,surface which:1,below is:1,edge event-based:1,event-based stack:1,stack was:1,and illustrated:1,66 Each:1,be 1/z-sorted:1,1/z-sorted into:1,necessary Each:1,stack again:1,necessary As:1,67.1 it:1,fair bit:1,that’s really:1,stack driven:1,by edge:1,edge events:1,events Implementation:1,Implementation Notes:1,Notes Finally:1,few notes:1,notes on:1,67.1 First:1,First you’ll:1,although we:1,frustum in:1,worldspace we:1,we nonetheless:1,nonetheless later:1,later clamp:1,clamp them:1,to valid:1,coordinates before:1,before adding:1,This catches:1,catches any:1,any cases:1,where arithmetic:1,arithmetic imprecision:1,imprecision results:1,in clipped:1,bit outside:1,frustum I’ve:1,only found:1,found such:1,such imprecision:1,imprecision to:1,significant at:1,at very:1,small z:1,distances so:1,so clamping:1,clamping would:1,be unnecessary:1,unnecessary if:1,the slight:1,slight nudge:1,nudge inward:1,inward that:1,we give:1,give the:1,65 However:1,However my:1,has consistently:1,consistently been:1,that relying:1,on worldspace:1,produce valid:1,coordinates 100:1,time leads:1,to sporadic:1,sporadic and:1,and hard-to-debug:1,hard-to-debug errors:1,errors There:1,separate routine:1,67.1 Instead:1,Instead a:1,special background:1,an effectively:1,effectively infinite:1,distance is:1,added so:1,so whenever:1,whenever no:1,are active:1,drawn If:1,If desired:1,desired it’s:1,flag the:1,background specially:1,specially For:1,background could:1,a starfield:1,starfield or:1,a cloudy:1,cloudy sky:1,sky The:1,The edge-processing:1,edge-processing code:1,handling concave:1,as easily:1,easily as:1,handle an:1,case Storage:1,Storage for:1,be allocated:1,allocated in:1,polygon structures:1,structures In:1,fully polished:1,polished implementation:1,implementation vertices:1,vertices would:1,linked together:1,or pointed:1,be dynamically:1,dynamically allocated:1,allocated from:1,pool so:1,polygon wouldn’t:1,contain enough:1,enough space:1,vertices Each:1,field named:1,named state:1,state which:1,is incremented:1,incremented when:1,edge for:1,and decremented:1,decremented when:1,reached A:1,activated by:1,state increments:1,is deactivated:1,deactivated by:1,state decrements:1,decrements to:1,another guard:1,against arithmetic:1,arithmetic problems:1,case quantization:1,quantization during:1,from floating:1,to fixed:1,fixed point:1,point Due:1,this conversion:1,conversion it:1,although rare:1,rare for:1,viewed nearly:1,edge-on to:1,occurs slightly:1,slightly before:1,corresponding leading:1,the span-generation:1,span-generation code:1,will behave:1,behave badly:1,badly if:1,it tries:1,emit a:1,span for:1,yet started:1,started It:1,of fix-up:1,fix-up could:1,careful arithmetic:1,arithmetic but:1,yet found:1,for 1/z-sorted:1,spans Lastly:1,66 Listing:1,to changes:1,y to:1,1/z for:1,for active:1,surfaces each:1,edge needs:1,stack The:1,The natural:1,natural origin:1,for gradient:1,calculations is:1,is xy:1,xy coordinate:1,coordinate 00:1,00 in:1,viewspace However:1,in AddPolygonEdges:1,AddPolygonEdges the:1,origin value:1,the upper-left:1,upper-left corner:1,done so:1,used directly:1,be relative:1,screen Also:1,screen gradients:1,gradients grow:1,grow more:1,more extreme:1,extreme as:1,viewed closer:1,to edge-on:1,edge-on In:1,calculations from:1,from becoming:1,becoming meaningless:1,meaningless or:1,generating errors:1,errors a:1,epsilon is:1,to backface:1,culling so:1,edge-on are:1,culled This:1,This calculation:1,calculation would:1,accurate if:1,were based:1,based directly:1,angle rather:1,a viewing:1,viewing ray:1,normal but:1,root and:1,experience the:1,epsilon used:1,fine Chapter:1,68 Quake’s:1,Quake’s Lighting:1,Lighting Model:1,Model A:1,A Radically:1,Radically Different:1,Different Approach:1,to Lighting:1,Lighting Polygons:1,Polygons It:1,was during:1,college that:1,discovered computer:1,computer games:1,games Not:1,Not Wizardry:1,Wizardry or:1,or Choplifter:1,Choplifter or:1,or Ultima:1,Ultima because:1,those existed:1,existed yet—the:1,yet—the game:1,that hooked:1,hooked me:1,original Star:1,you navigated:1,navigated from:1,one 8x8:1,8x8 quadrant:1,quadrant to:1,in search:1,of starbases:1,starbases occasionally:1,occasionally firing:1,firing phasers:1,phasers or:1,or photon:1,torpedoes This:1,less exciting:1,exciting than:1,sounds after:1,current quadrant:1,quadrant had:1,be reprinted:1,reprinted from:1,scratch along:1,current stats—and:1,stats—and the:1,output device:1,device was:1,10 cps:1,cps printball:1,printball console:1,console A:1,typical game:1,game took:1,hour during:1,which nothing:1,particularly stimulating:1,stimulating ever:1,happened Klingons:1,Klingons appeared:1,appeared periodically:1,periodically but:1,they politely:1,politely waited:1,next move:1,move before:1,attacking and:1,your photon:1,torpedoes never:1,never missed:1,missed so:1,the outcome:1,outcome was:1,never in:1,in doubt:1,doubt but:1,that mattered:1,mattered nothing:1,could detract:1,detract from:1,sheer thrill:1,thrill of:1,a computer-simulated:1,computer-simulated universe:1,universe Then:1,the college:1,college got:1,a PDP-11:1,PDP-11 with:1,four CRT:1,CRT terminals:1,terminals and:1,and suddenly:1,suddenly Star:1,Trek could:1,could redraw:1,redraw in:1,second instead:1,minute Better:1,the recesses:1,recesses of:1,new system:1,time I’d:1,real-world code:1,and excitedly:1,excitedly dove:1,One evening:1,evening as:1,looking through:1,really cute:1,cute girl:1,girl at:1,next terminal:1,terminal asked:1,for help:1,help getting:1,run After:1,had helped:1,helped her:1,her eager:1,know her:1,her better:1,said Want:1,see something:1,something This:1,actual source:1,and proceeded:1,proceeded to:1,page through:1,code describing:1,describing each:1,each subroutine:1,subroutine We:1,We got:1,to talking:1,talking and:1,eventually I:1,worked up:1,the nerve:1,nerve to:1,ask her:1,said sure:1,sure and:1,we ended:1,up having:1,although things:1,things soon:1,soon fell:1,fell apart:1,her two:1,other boyfriends:1,boyfriends I:1,an exact:1,exact count:1,interesting thing:1,was her:1,her response:1,to asking:1,asking her:1,said It’s:1,It’s about:1,time When:1,she meant:1,meant she:1,said I’ve:1,been trying:1,me out:1,all evening—but:1,evening—but it:1,took you:1,you forever:1,forever You:1,You didn’t:1,didn’t actually:1,actually think:1,that Star:1,did you:1,you Actually:1,had thought:1,that experience:1,experience and:1,had reinforced:1,reinforced countless:1,countless times:1,times since:1,since is:1,that we—you:1,we—you me:1,me anyone:1,who programs:1,programs because:1,they love:1,love it:1,it who:1,free if:1,if necessary—are:1,necessary—are a:1,a breed:1,breed apart:1,apart We’re:1,We’re different:1,and luckily:1,luckily so:1,so while:1,while everyone:1,is worrying:1,about downsizing:1,downsizing we’re:1,hottest industries:1,industries in:1,world And:1,biggest reason:1,reason we’re:1,good situation:1,situation isn’t:1,isn’t intelligence:1,intelligence or:1,or hard:1,or education:1,education although:1,although those:1,those help:1,help it’s:1,actually like:1,stuff It’s:1,seen far:1,people start:1,treat programming:1,programming like:1,job forgetting:1,forgetting the:1,the joy:1,joy of:1,and burn:1,burn out:1,out So:1,So keep:1,eye on:1,feel about:1,getting stale:1,stale it’s:1,learn something:1,new there’s:1,interesting programming:1,sorts to:1,done Follow:1,Follow your:1,your interests—and:1,interests—and don’t:1,don’t forget:1,forget to:1,fun The:1,The Lighting:1,Lighting Conundrum:1,Conundrum I:1,years working:1,on Quake’s:1,engine John:1,faced several:1,several fundamental:1,issues while:1,while architecting:1,architecting Quake:1,Quake I’ve:1,chapters about:1,those issues:1,issues including:1,including eliminating:1,eliminating non-visible:1,polygons quickly:1,quickly via:1,and improving:1,inserting potentially:1,out only:1,about another:1,another equally:1,equally crucial:1,crucial design:1,design issue:1,issue how:1,we developed:1,developed our:1,our lighting:1,lighting approach:1,itself the:1,ceilings Monsters:1,Monsters and:1,using completely:1,different rendering:1,rendering code:1,overriding factor:1,factor A:1,primary goal:1,goal for:1,world on:1,as precise:1,precise as:1,possible getting:1,getting everything:1,everything right:1,right so:1,polygons textures:1,and sophisticated:1,be pegged:1,pegged in:1,place with:1,visible shifting:1,shifting or:1,or distortion:1,distortion under:1,conditions for:1,maximum player:1,player immersion—all:1,immersion—all with:1,course As:1,the twin:1,twin goals:1,and rock-solid:1,rock-solid complex:1,lighting proved:1,achieve with:1,with traditional:1,traditional lighting:1,approaches ultimately:1,ultimately a:1,a dramatically:1,dramatically different:1,was required:1,required Gouraud:1,do realistic:1,realistic lighting:1,polygon pipelines:1,pipelines is:1,is Gouraud:1,shading also:1,as smooth:1,smooth shading:1,shading Gouraud:1,shading involves:1,vertex by:1,by applying:1,applying all:1,relevant world:1,world lighting:1,lighting linearly:1,values down:1,then linearly:1,polygon across:1,span If:1,If texture:1,is desired:1,desired and:1,are texture:1,mapped in:1,pixel’s corresponding:1,corresponding texture:1,map location:1,location texel:1,texel is:1,determined and:1,the interpolated:1,texel to:1,final lit:1,lit pixel:1,pixel Texels:1,Texels are:1,generally taken:1,taken from:1,32x32 or:1,or 64x64:1,texture that’s:1,that’s tiled:1,tiled repeatedly:1,repeatedly across:1,reasons performance:1,texture sits:1,sits nicely:1,cache database:1,less artwork:1,artwork The:1,The interpolated:1,lighting can:1,can consist:1,value or:1,separate red:1,blue values:1,values RGB:1,RGB lighting:1,lighting produces:1,sophisticated results:1,results such:1,as colored:1,colored lights:1,lights but:1,best suited:1,to RGB:1,modes Games:1,Games like:1,like Quake:1,Quake that:1,are targeted:1,targeted at:1,at palettized:1,palettized 256-color:1,modes generally:1,generally use:1,use intensity:1,intensity lighting:1,lighting each:1,lit by:1,table using:1,intensity as:1,the look-up:1,look-up indices:1,indices Gouraud:1,shading allows:1,for decent:1,decent lighting:1,small amount:1,compact data:1,set that’s:1,simple extension:1,model However:1,several important:1,important drawbacks:1,well Problems:1,The quality:1,shading depends:1,average size:1,drawn Linear:1,Linear interpolation:1,interpolation is:1,so highlights:1,highlights can:1,color gradients:1,are monotonic:1,monotonic across:1,for bland:1,bland lighting:1,effects if:1,do spotlights:1,other detailed:1,detailed or:1,or dramatic:1,dramatic lighting:1,effects After:1,After John:1,John brought:1,initial primitive:1,primitive Quake:1,engine up:1,using Gouraud:1,thing he:1,improve lighting:1,lighting quality:1,was adding:1,creating new:1,new polygons:1,polygons wherever:1,wherever a:1,spotlight was:1,was directly:1,directly overhead:1,overhead a:1,vertex added:1,added directly:1,directly underneath:1,underneath the:1,light as:1,68.1 This:1,This produced:1,produced fairly:1,fairly attractive:1,attractive highlights:1,highlights but:1,but simultaneously:1,simultaneously made:1,made evident:1,evident several:1,several problems:1,problems A:1,requires the:1,vertices used:1,world geometry:1,as lighting:1,lighting sample:1,sample points:1,well even:1,close relationship:1,and geometry:1,geometry This:1,This artificial:1,artificial coupling:1,coupling often:1,often forces:1,several polygons:1,polygons purely:1,purely for:1,lighting reasons:1,reasons as:1,the spotlights:1,spotlights mentioned:1,above these:1,these extra:1,polygons increase:1,extra transformations:1,projections that:1,they induce:1,induce can:1,can harm:1,harm performance:1,considerably Similar:1,problems occur:1,occur with:1,with overlapping:1,with shadows:1,shadows where:1,where additional:1,to approximate:1,approximate lighting:1,detail well:1,particular good:1,good shadow:1,edges need:1,need small:1,polygons because:1,gradient between:1,and dark:1,dark gets:1,gets spread:1,across too:1,too wide:1,wide an:1,area Worse:1,of lighting:1,lighting change:1,change across:1,a shadow:1,shadow edge:1,edge can:1,considerably as:1,the geometry:1,edge crosses:1,crosses wider:1,wider polygons:1,polygons stretch:1,stretch and:1,transition between:1,and shadow:1,shadow A:1,related problem:1,lighting discontinuities:1,discontinuities can:1,t-junctions although:1,although ultimately:1,ultimately we:1,add edges:1,eliminate t-junctions:1,t-junctions anyway:1,anyway because:1,otherwise dropouts:1,dropouts can:1,occur along:1,along polygon:1,edges These:1,be eased:1,eased by:1,extra edges:1,that increases:1,load Figure:1,light Figure:1,light Perspective:1,Perspective Correctness:1,Correctness Another:1,isn’t perspective-correct:1,perspective-correct With:1,With Gouraud:1,shading lighting:1,varies linearly:1,linearly across:1,equal increments:1,increments per:1,per pixel—but:1,pixel—but unless:1,is parallel:1,step lighting:1,lighting across:1,polygon properly:1,mapping Lack:1,as visibly:1,visibly wrong:1,wrong for:1,lighting as:1,mapping because:1,because smooth:1,smooth lighting:1,lighting gradients:1,gradients can:1,tolerate considerably:1,more warping:1,warping than:1,the detailed:1,detailed bitmapped:1,bitmapped images:1,images used:1,nonetheless shows:1,shows up:1,mismatch between:1,between Gouraud:1,and orientation:1,being lit:1,lit As:1,polygon turns:1,turns to:1,more on-edge:1,on-edge for:1,lighting warps:1,warps more:1,therefore shifts:1,shifts relative:1,the perspective-texture:1,perspective-texture mapped:1,mapped texels:1,texels it’s:1,it’s shading:1,shading an:1,effect I’ll:1,call viewing:1,variance Lighting:1,Lighting can:1,similarly shift:1,more polygon:1,completely clipped:1,clipped I’ll:1,variance These:1,fairly subtle:1,subtle effects:1,effects more:1,more pronounced:1,pronounced is:1,when Gouraud:1,shading any:1,three vertices:1,vertices Consistent:1,Consistent lighting:1,three lighting:1,values taking:1,taking four:1,shading does:1,hack and:1,reflect any:1,any consistent:1,consistent underlying:1,model If:1,you view:1,view a:1,Gouraud-shaded quad:1,quad head-on:1,head-on then:1,then rotate:1,a pinwheel:1,pinwheel the:1,lighting will:1,will shift:1,the quad:1,quad turns:1,turns as:1,68.2 The:1,lighting shift:1,shift can:1,quite drastic:1,drastic depending:1,are It:1,was rotational:1,that finally:1,finally brought:1,lighting issue:1,issue to:1,Quake We’d:1,We’d look:1,the floors:1,floors which:1,were Gouraud-shaded:1,Gouraud-shaded quads:1,quads then:1,then we’d:1,we’d pivot:1,pivot and:1,would shimmy:1,shimmy and:1,shift especially:1,especially where:1,were spotlights:1,shadows Given:1,the goal:1,of rendering:1,as accurately:1,accurately and:1,and convincingly:1,convincingly as:1,was unacceptable:1,unacceptable The:1,to rotational:1,variance is:1,only triangles:1,triangles but:1,that brings:1,problems It:1,many triangles:1,as quads:1,quads to:1,same scene:1,scene increasing:1,and requiring:1,requiring extra:1,extra rasterization:1,rasterization at:1,cost Triangles:1,Triangles still:1,still don’t:1,provide perspective:1,lighting their:1,their lighting:1,is rotationally:1,invariant but:1,still wrong—just:1,wrong—just wrong:1,wrong in:1,more consistant:1,consistant way:1,way Gouraud-shaded:1,Gouraud-shaded triangles:1,triangles still:1,still result:1,in odd:1,odd lighting:1,lighting patterns:1,patterns and:1,require lots:1,support shadowing:1,shadowing and:1,other lighting:1,detail Finally:1,Finally triangles:1,triangles don’t:1,don’t solve:1,solve clipping:1,or viewing:1,variance Figure:1,orientation Figure:1,orientation Yet:1,another problem:1,may work:1,add extra:1,extra geometry:1,that spotlights:1,shadows show:1,well that’s:1,that’s feasible:1,feasible only:1,for static:1,static lighting:1,lighting Dynamic:1,Dynamic lighting—light:1,lighting—light cast:1,cast by:1,by sources:1,that move—has:1,move—has to:1,whatever geometry:1,world has:1,offer because:1,because its:1,needs are:1,are constantly:1,constantly changing:1,changing These:1,These issues:1,issues led:1,to conclude:1,use Gouraud:1,shading we:1,many small:1,with sufficiently:1,sufficiently finely:1,that complex:1,lighting could:1,the inaccuracies:1,inaccuracies of:1,shading wouldn’t:1,too noticeable:1,noticeable Unfortunately:1,thinking brought:1,brought us:1,larger world:1,much heavier:1,heavier rasterization:1,the worse:1,worse because:1,because Gouraud:1,shading requires:1,additional interpolant:1,interpolant slowing:1,inner rasterization:1,rasterization loop:1,world still:1,than totally:1,totally solid:1,solid because:1,engine would:1,complex worlds:1,worlds we:1,hoped for:1,for in:1,The Quest:1,Quest for:1,for Alternative:1,Alternative Lighting:1,Lighting None:1,isn’t useful:1,general Descent:1,Descent uses:1,uses it:1,to excellent:1,excellent effect:1,fact Quake:1,uses Gouraud:1,entities because:1,these consist:1,motion which:1,helps hide:1,hide the:1,small lighting:1,lighting errors:1,errors However:1,However Gouraud:1,shading didn’t:1,seem capable:1,of meeting:1,meeting our:1,design goals:1,goals for:1,for rendering:1,whole so:1,for alternatives:1,alternatives There:1,many alternative:1,alternative lighting:1,approaches most:1,them higher-quality:1,higher-quality than:1,Gouraud starting:1,with Phong:1,shading in:1,is interpolated:1,interpolated across:1,polygon’s surface:1,to ray-tracing:1,ray-tracing lighting:1,lighting techniques:1,which full:1,full illumination:1,illumination calculations:1,all direct:1,direct and:1,and reflected:1,reflected paths:1,paths from:1,pixel What:1,these approaches:1,approaches have:1,common is:1,they’re slower:1,shading too:1,Quake For:1,For weeks:1,weeks we:1,kicked around:1,and rejected:1,rejected various:1,various possibilities:1,and continued:1,continued working:1,better alternative—until:1,alternative—until the:1,day John:1,into work:1,idea Decoupling:1,Decoupling Lighting:1,Lighting from:1,from Rasterization:1,Rasterization John’s:1,John’s idea:1,idea came:1,him while:1,while was:1,been carved:1,several pieces:1,pieces because:1,spotlight with:1,ugly lighting:1,lighting glitch:1,glitch due:1,a t-junction:1,t-junction He:1,He thought:1,thought to:1,to himself:1,himself that:1,only there:1,treat it:1,surface it:1,would look:1,look better:1,better and:1,draw faster—and:1,faster—and then:1,then he:1,he realized:1,The insight:1,insight was:1,split lighting:1,rasterization into:1,separate steps:1,steps In:1,normal Gouraud-based:1,Gouraud-based rasterizer:1,rasterizer there’s:1,there’s first:1,an off-line:1,built during:1,support additional:1,detail as:1,polygons At:1,At runtime:1,modified if:1,if dynamic:1,shading Quake’s:1,Quake’s approach:1,call surface-based:1,lighting preprocesses:1,preprocesses differently:1,differently and:1,adds an:1,extra rendering:1,rendering step:1,step During:1,During off-line:1,preprocessing a:1,a grid:1,grid called:1,value every:1,16 texels:1,texels horizontally:1,vertically This:1,This lighting:1,casting light:1,light from:1,the nearby:1,nearby lights:1,the grid:1,and summing:1,each grid:1,grid point:1,Quake preprocessor:1,preprocessor filters:1,filters the:1,so shadow:1,a stair-step:1,stair-step appearance:1,appearance a:1,technique suggested:1,suggested by:1,by Billy:1,Zelsnack additional:1,additional preprocessing:1,preprocessing could:1,example Phong:1,make surfaces:1,surfaces appear:1,appear smoothly:1,smoothly curved:1,curved Then:1,Then at:1,texel lit:1,the weighted:1,weighted average:1,average intensities:1,four nearest:1,nearest light:1,map points:1,68.3 If:1,If dynamic:1,modified accordingly:1,accordingly before:1,built Then:1,surface serving:1,input texture:1,lighting performed:1,mapping So:1,does surface-based:1,lighting buy:1,us First:1,First and:1,and foremost:1,foremost it:1,provides consistent:1,consistent perspective-correct:1,lighting eliminating:1,all rotational:1,rotational viewing:1,viewing and:1,variance because:1,space By:1,By lighting:1,we bind:1,bind the:1,an invariant:1,invariant way:1,lighting gets:1,free ride:1,ride through:1,up perfectly:1,perfectly matched:1,matched to:1,texels Surface-based:1,Surface-based lighting:1,lighting also:1,also supports:1,supports good:1,good although:1,perfect detail:1,detail for:1,for overlapping:1,shadows The:1,The 16-texel:1,grid has:1,two feet:1,feet in:1,Quake frame:1,reference and:1,this relatively:1,relatively fine:1,fine resolution:1,resolution together:1,the filtering:1,filtering performed:1,built is:1,support complex:1,complex shadows:1,shadows with:1,with smoothly:1,smoothly fading:1,fading edges:1,edges Additionally:1,Additionally surface-based:1,lighting eliminates:1,eliminates lighting:1,lighting glitches:1,glitches at:1,t-junctions because:1,is unrelated:1,to vertices:1,vertices In:1,short surface-based:1,lighting meets:1,meets all:1,Quake’s visual:1,quality goals:1,goals which:1,perform Size:1,Size and:1,and Speed:1,Speed As:1,good Although:1,surface moving:1,moving lighting:1,and tiling:1,tiling into:1,separate loop:1,loop from:1,from texture:1,mapping allows:1,optimized very:1,very effectively:1,effectively with:1,all variables:1,variables kept:1,The surface-building:1,surface-building inner:1,than interpolating:1,interpolating intensity:1,intensity combining:1,combining it:1,a texel:1,texel and:1,a lit:1,dword write:1,four texels:1,texels In:1,language we:1,to 2.25:1,per lit:1,Quake Similarly:1,which overlaps:1,overlaps an:1,for floating-point:1,floating-point perspective:1,correction with:1,integer pixel:1,in 16-pixel:1,16-pixel bursts:1,bursts has:1,been squeezed:1,squeezed down:1,to 7.5:1,7.5 cycles:1,combined inner:1,loop times:1,for building:1,roughly in:1,pixel It’s:1,It’s certainly:1,Gouraud-shaded perspective-correct:1,mapper that’s:1,that’s somewhat:1,but 10:1,10 cycles/pixel:1,cycles/pixel is:1,do 40:1,40 frames/second:1,frames/second at:1,at 640x400:1,640x400 on:1,a Pentium/100:1,Pentium/100 so:1,lighting are:1,are acceptable:1,acceptable It’s:1,a one-pass:1,one-pass texture:1,mapper that:1,does approximately:1,approximately perspective-correct:1,lighting However:1,hear of:1,or devise:1,devise such:1,an inner:1,isn’t complicated:1,cases which:1,optimize worse:1,worse this:1,the procedural:1,procedural and:1,post-processing techniques:1,shortly Figure:1,map Figure:1,map Moreover:1,Moreover surface-based:1,lighting tends:1,spend more:1,loops because:1,of sides:1,into multiple:1,multiple smaller:1,lighting purposes:1,purposes this:1,this reduces:1,projection that:1,makes polygon:1,polygon spans:1,spans longer:1,longer So:1,lighting stacks:1,up very:1,well indeed—except:1,indeed—except for:1,for caching:1,caching I:1,tile fits:1,fits nicely:1,cache A:1,typical surface:1,surface doesn’t:1,doesn’t Every:1,Every texel:1,unique so:1,resolution something:1,64000 texels:1,texels must:1,single scene:1,number actually:1,actually varies:1,varies quite:1,but 64000:1,64000 is:1,ballpark This:1,Pentium we’re:1,cache once:1,every 32:1,32 texels:1,texels and:1,considerably worse:1,texture access:1,access patterns:1,are such:1,use every:1,given cache:1,before that:1,gets thrown:1,cache Then:1,too when:1,buffer won’t:1,the writes:1,be uncached:1,uncached writes:1,writes that:1,to main:1,get read:1,at texture:1,mapping time:1,time potentially:1,potentially slowing:1,things further:1,further still:1,still All:1,this together:1,together makes:1,and unlit:1,unlit texture:1,never posed:1,posed a:1,problem during:1,Quake thanks:1,Caching When:1,lighting John:1,immediately realized:1,building would:1,be relatively:1,expensive In:1,he assumed:1,assumed it:1,actually turned:1,full assembly-language:1,assembly-language optimization:1,optimization Consequently:1,Consequently his:1,design included:1,included the:1,caching surfaces:1,surface were:1,frame it:1,reused without:1,rebuilt With:1,With surface:1,surface rebuilding:1,rebuilding needed:1,only rarely:1,rarely thanks:1,caching Quake’s:1,Quake’s rasterization:1,rasterization speed:1,the unlit:1,unlit perspective-correct:1,perspective-correct texture-mapping:1,which suffers:1,misses than:1,than Gouraud-shaded:1,Gouraud-shaded tiled:1,tiled texture:1,of larger:1,surface-caching approach:1,somewhat slower:1,but generally:1,generally surface:1,caching provides:1,provides equal:1,equal or:1,so once:1,once surface:1,caching was:1,Quake performance:1,a problem—but:1,problem—but size:1,size became:1,became a:1,concern The:1,for surface:1,caching looked:1,looked forbidding:1,forbidding at:1,first Surfaces:1,Surfaces are:1,large relative:1,to texture:1,tiles because:1,texel of:1,unique Also:1,can contain:1,contain many:1,texels relative:1,pixels actually:1,because due:1,to perspective:1,perspective foreshortening:1,foreshortening distant:1,pixels relative:1,size in:1,in texels:1,texels Surfaces:1,Surfaces associated:1,with partly:1,partly hidden:1,hidden polygons:1,fully built:1,built even:1,though only:1,drawn back:1,front with:1,with overdraw:1,overdraw some:1,some polygons:1,visible but:1,still require:1,require surface:1,caching What:1,this meant:1,meant was:1,cache initially:1,initially looked:1,looked to:1,large on:1,megabytes even:1,at 320x200—too:1,320x200—too much:1,much for:1,game intended:1,MB machine:1,machine Mipmapping:1,Mipmapping To:1,To The:1,The Rescue:1,Rescue Two:1,Two factors:1,factors combined:1,problem First:1,First polygons:1,list with:1,overdraw as:1,discussed a:1,chapters back:1,back so:1,no surface:1,ever built:1,built unless:1,unless at:1,least part:1,visible Second:1,Second surfaces:1,at four:1,four mipmap:1,mipmap levels:1,levels depending:1,on distance:1,distance with:1,each mipmap:1,level having:1,having one-quarter:1,one-quarter as:1,texels as:1,preceding level:1,68.4 For:1,those whose:1,whose heads:1,heads haven’t:1,been basted:1,basted in:1,3-D technology:1,past several:1,years mipmapping:1,is 3-D:1,graphics jargon:1,jargon for:1,that normalizes:1,normalizes the:1,be approximately:1,pixels reducing:1,reducing calculation:1,for distant:1,surfaces containing:1,The mipmap:1,selected to:1,to result:1,a texelpixel:1,ratio approximately:1,approximately between:1,between 11:1,11 and:1,and 12:1,12 so:1,so texels:1,texels map:1,map roughly:1,roughly to:1,to pixels:1,are correspondingly:1,correspondingly smaller:1,smaller As:1,surface texels:1,texels required:1,scene at:1,64000 the:1,actually somewhat:1,somewhat higher:1,higher because:1,of portions:1,are obscured:1,obscured and:1,and viewspace-tilted:1,viewspace-tilted polygons:1,have high:1,high texel-to-pixel:1,texel-to-pixel ratios:1,ratios along:1,axis but:1,lot higher:1,higher Thanks:1,to mipmapping:1,mipmapping and:1,list 600K:1,600K has:1,proven to:1,plenty for:1,320x200 even:1,scenes and:1,640x480 a:1,MB suffices:1,suffices Figure:1,requirements Figure:1,requirements All:1,All mipmapped:1,mipmapped texture:1,tiles are:1,generated as:1,and loaded:1,from disk:1,disk at:1,runtime One:1,making mipmapping:1,mipmapping look:1,good turned:1,be box-filtering:1,box-filtering down:1,next by:1,by averaging:1,averaging four:1,four adjacent:1,using error:1,error diffusion:1,diffusion dithering:1,dithering to:1,the mipmapped:1,mipmapped texels:1,texels Also:1,Also mipmapping:1,a per-surface:1,per-surface basis:1,whole surface:1,selected based:1,viewer of:1,vertex This:1,This led:1,limit surface:1,size to:1,of 256x256:1,256x256 Otherwise:1,Otherwise surfaces:1,as floors:1,floors would:1,would extend:1,extend for:1,for thousands:1,texels all:1,require huge:1,huge amounts:1,space while:1,while displaying:1,of aliasing:1,aliasing in:1,distant regions:1,regions due:1,high texelpixel:1,ratio Two:1,Two Final:1,Final Notes:1,on Surface:1,Caching Dynamic:1,lighting has:1,significant impact:1,caching because:1,because whenever:1,surface changes:1,rebuilt In:1,lighting changes:1,every visible:1,cache provides:1,provides no:1,benefit and:1,rendering runs:1,combined speed:1,This worst-case:1,worst-case slowdown:1,slowdown is:1,is tolerable:1,tolerable but:1,certainly noticeable:1,noticeable so:1,design games:1,caching so:1,change lighting:1,time If:1,could alternate:1,alternate surface:1,surface relighting:1,relighting so:1,change on:1,even frames:1,half on:1,on odd:1,odd frames:1,frames but:1,but large-scale:1,large-scale constant:1,constant relighting:1,relighting is:1,not surface:1,caching’s strongest:1,strongest suit:1,suit Finally:1,Finally Quake:1,Quake barely:1,barely begins:1,tap surface:1,caching’s potential:1,potential All:1,texturing and:1,post-processing effects:1,is shot:1,shot a:1,sprite of:1,of pockmarks:1,pockmarks could:1,be attached:1,wall’s data:1,sprite could:1,surface each:1,is rebuilt:1,rebuilt The:1,for splatters:1,splatters or:1,or graffiti:1,graffiti with:1,with translucency:1,translucency easily:1,easily supported:1,supported These:1,These effects:1,effects would:1,cached and:1,surface so:1,than effects:1,effects done:1,by on-screen:1,on-screen overdraw:1,overdraw every:1,every frame:1,frame Basically:1,handy repository:1,repository for:1,of effects:1,because multiple:1,multiple techniques:1,techniques can:1,be composited:1,composited because:1,it caches:1,reuse without:1,without rebuilding:1,rebuilding and:1,texels constructed:1,constructed in:1,in perspective:1,perspective Chapter:1,Chapter 69:1,69 Surface:1,Caching and:1,and Quake’s:1,Quake’s Triangle:1,Models Probing:1,Probing Hardware-Assisted:1,Hardware-Assisted Surfaces:1,Surfaces and:1,Fast Model:1,Model Animation:1,Animation Without:1,Without Sprites:1,Sprites In:1,70s I:1,a summer:1,summer doing:1,doing contract:1,contract programming:1,programming at:1,a government-funded:1,government-funded installation:1,installation called:1,the Northeast:1,Northeast Solar:1,Solar Energy:1,Energy Center:1,Center NESEC:1,NESEC Those:1,Those were:1,were heady:1,heady times:1,for solar:1,solar energy:1,energy what:1,oil shortages:1,shortages and:1,was lots:1,money being:1,being thrown:1,thrown at:1,at places:1,places like:1,like NESEC:1,NESEC which:1,growing fast:1,fast NESEC:1,was across:1,street from:1,from MIT:1,MIT which:1,good access:1,to resources:1,resources Unfortunately:1,that NESEC:1,a severely:1,severely parking-impaired:1,parking-impaired part:1,world what:1,student population:1,population and:1,and Boston’s:1,Boston’s chronic:1,chronic parking:1,parking shortage:1,shortage The:1,The NESEC:1,NESEC building:1,building did:1,own parking:1,wasn’t nearly:1,nearly big:1,big enough:1,enough because:1,because students:1,students parked:1,parked in:1,every opportunity:1,opportunity The:1,The lot:1,lot was:1,was posted:1,posted and:1,and cars:1,cars periodically:1,periodically got:1,got towed:1,towed but:1,but King:1,King Canute:1,Canute stood:1,stood a:1,better chance:1,chance against:1,the tide:1,tide than:1,than NESEC:1,NESEC did:1,did against:1,student hordes:1,hordes and:1,and late:1,late arrivals:1,arrivals to:1,work often:1,often had:1,to park:1,park blocks:1,and hike:1,hike to:1,their considerable:1,considerable displeasure:1,displeasure Back:1,drove an:1,aging Volvo:1,sedan that:1,was sorely:1,sorely in:1,in need:1,need of:1,a ring:1,ring job:1,job It:1,ran fine:1,but burned:1,burned a:1,a quart:1,quart of:1,oil every:1,every 250:1,250 miles:1,miles so:1,I carried:1,carried a:1,the trunk:1,trunk and:1,level frequently:1,frequently One:1,day walking:1,walking to:1,center a:1,away I:1,I cut:1,cut through:1,the parking:1,car It:1,was low:1,low so:1,I topped:1,topped it:1,off left:1,empty oil:1,oil can:1,can next:1,would see:1,pick it:1,to throw:1,throw out:1,headed toward:1,center I’d:1,I’d gone:1,gone only:1,hundred feet:1,feet when:1,heard footsteps:1,footsteps and:1,and shouting:1,shouting behind:1,a wild-eyed:1,wild-eyed man:1,a business:1,business suit:1,suit came:1,came running:1,running up:1,me screaming:1,screaming It’s:1,It’s bad:1,bad enough:1,you park:1,park in:1,our lot:1,now you’re:1,you’re leaving:1,leaving your:1,your garbage:1,garbage lying:1,lying around:1,around he:1,he yelled:1,yelled Don’t:1,Don’t you:1,you people:1,any sense:1,of decency:1,decency I:1,I told:1,at NESEC:1,NESEC and:1,the can:1,can on:1,he shouted:1,shouted Don’t:1,I repeated:1,repeated my:1,my statements:1,statements calmly:1,calmly and:1,him who:1,worked for:1,where my:1,office was:1,was and:1,said Don’t:1,that again:1,less certainty:1,certainty I:1,kept adding:1,adding detail:1,detail until:1,was telling:1,telling the:1,truth and:1,suddenly said:1,said Oh:1,Oh my:1,my God:1,God turned:1,turned red:1,to apologize:1,apologize profusely:1,profusely A:1,we passed:1,passed in:1,the hallway:1,hallway and:1,didn’t look:1,look me:1,eye The:1,useful outcome:1,outcome that:1,have resulted:1,resulted from:1,his outburst:1,outburst Suppose:1,a student—what:1,student—what would:1,would he:1,have accomplished:1,by yelling:1,yelling at:1,He let:1,let his:1,his emotions:1,emotions overrule:1,overrule his:1,his common:1,result did:1,did something:1,something he:1,he later:1,later wished:1,wished he:1,hadn’t I’ve:1,seen many:1,programmers do:1,thing especially:1,they’re working:1,working long:1,long hours:1,not feeling:1,feeling adequately:1,adequately appreciated:1,appreciated For:1,example some:1,got mail:1,mail from:1,who complained:1,complained bitterly:1,bitterly that:1,although he:1,was critical:1,his company’s:1,company’s success:1,success management:1,management didn’t:1,didn’t appreciate:1,appreciate his:1,his hard:1,and talent:1,talent and:1,could help:1,help him:1,him find:1,job I:1,I suggested:1,suggested several:1,another job:1,also asked:1,tried working:1,working his:1,his problems:1,problems out:1,his employers:1,employers if:1,he really:1,that valuable:1,valuable what:1,what did:1,lose He:1,He admitted:1,admitted he:1,hadn’t and:1,and recently:1,recently he:1,wrote back:1,had talked:1,talked to:1,his boss:1,boss and:1,now he:1,getting paid:1,paid a:1,more money:1,money was:1,getting credit:1,credit for:1,his work:1,just flat-out:1,flat-out happy:1,happy We:1,We programmers:1,of ourselves:1,ourselves as:1,as rational:1,creatures but:1,get angry:1,angry at:1,do like:1,like everyone:1,else we:1,we tend:1,our emotions:1,emotions instead:1,minds It’s:1,It’s my:1,that thinking:1,thinking rationally:1,rationally under:1,under those:1,those circumstances:1,circumstances can:1,difficult but:1,but produces:1,produces better:1,better long-term:1,long-term results:1,results every:1,every time—so:1,time—so if:1,yourself in:1,that situation:1,situation stay:1,stay cool:1,cool and:1,think your:1,and odds:1,happier down:1,road Of:1,course most:1,time programmers:1,are rational:1,creatures and:1,more information:1,spirit let’s:1,makes Quake:1,Quake tick:1,tick starting:1,I’ve recently:1,recently learned:1,about surface:1,Caching with:1,with Hardware:1,Hardware Assistance:1,Assistance In:1,68 I:1,caching technique:1,do detailed:1,detailed high-quality:1,high-quality lighting:1,without lots:1,polygons Since:1,Since writing:1,writing that:1,gone further:1,time working:1,to Rendition’s:1,Rendition’s Verite:1,Verite 3-D:1,3-D accelerator:1,chip So:1,So let:1,me start:1,start off:1,discussing what:1,using surface:1,hardware As:1,caching is:1,lighting information:1,polygon detail:1,detail are:1,stored separately:1,separately with:1,with lighting:1,not tied:1,vertices then:1,then combined:1,combined on:1,demand into:1,into what:1,call surfaces:1,surfaces lit:1,lit textured:1,textured rectangles:1,mapper Building:1,Building surfaces:1,surfaces takes:1,so performance:1,is enhanced:1,enhanced by:1,by caching:1,caching the:1,surfaces from:1,68 3-D:1,accelerators are:1,optimize Gouraud:1,but surface:1,on hardware:1,accelerators with:1,some significant:1,significant quality:1,quality advantages:1,The surface-caching:1,surface-caching architecture:1,Verite version:1,Quake which:1,call VQuake:1,builds surfaces:1,surfaces on:1,demand which:1,then downloaded:1,downloaded to:1,the accelerator’s:1,accelerator’s memory:1,and cached:1,cached there:1,there There:1,of key:1,key differences:1,differences however:1,requirement that:1,surfaces be:1,in 16-bit-per-pixel:1,16-bit-per-pixel bpp:1,bpp format:1,format Downloading:1,Downloading surfaces:1,hit that:1,doesn’t exist:1,version Although:1,Although Verite:1,Verite uses:1,uses DMA:1,DMA to:1,surfaces DMA:1,DMA does:1,fact steal:1,steal performance:1,This cost:1,for 16-bpp:1,surfaces because:1,because twice:1,downloaded Worse:1,still it:1,build 16-bpp:1,as 8-bpp:1,of missing:1,well over:1,over twice:1,expensive in:1,VQuake as:1,Quake Fortunately:1,Fortunately there’s:1,there’s 4:1,on Verite-based:1,Verite-based adapters:1,adapters so:1,cache doesn’t:1,doesn’t miss:1,miss very:1,and VQuake:1,VQuake runs:1,good thanks:1,which by:1,much worth:1,nonetheless true:1,completely straightforward:1,straightforward port:1,surface-caching model:1,as appealing:1,appealing for:1,for software:1,true at:1,high resolutions:1,resolutions where:1,cache increase:1,increase due:1,but available:1,memory decreases:1,decreases due:1,buffer size:1,size Does:1,Does my:1,my recent:1,recent experience:1,experience indicate:1,market moves:1,moves to:1,hardware there’s:1,shading despite:1,issues Not:1,all First:1,all surface:1,does still:1,still work:1,well just:1,as relatively:1,well compared:1,software Second:1,Second there:1,two alternatives:1,alternatives that:1,that preserve:1,without many:1,disadvantages noted:1,above Letting:1,Letting the:1,Card Build:1,Build the:1,the Textures:1,Textures One:1,accelerator card:1,card build:1,textures rather:1,CPU build:1,then download:1,download them:1,eliminates downloading:1,downloading completely:1,completely and:1,accelerator which:1,at such:1,such things:1,things do:1,texel manipulation:1,manipulation Whether:1,CPU or:1,doing more:1,work overall:1,overall but:1,eliminates download:1,download time:1,big help:1,help This:1,approach retains:1,to composite:1,composite other:1,other effects:1,as splatters:1,and dents:1,dents onto:1,onto surfaces:1,token retains:1,lighting performance:1,cache It:1,also requires:1,API and:1,and accelerator:1,accelerator being:1,used allow:1,allow drawing:1,texture which:1,not universally:1,universally true:1,true Neither:1,all APIs:1,APIs or:1,or accelerators:1,accelerators allow:1,allow applications:1,applications enough:1,texture heap:1,heap so:1,efficient surface:1,that favors:1,favors non-caching:1,non-caching approaches:1,approaches A:1,similar option:1,option that:1,wasn’t open:1,open to:1,to us:1,us due:1,time limitations:1,limitations is:1,is downloading:1,downloading 8-bpp:1,accelerator expand:1,expand them:1,stores them:1,texture memory:1,memory Better:1,yet some:1,accelerators support:1,support 8-bpp:1,8-bpp palettized:1,palettized hardware:1,hardware textures:1,textures that:1,are expanded:1,16-bpp on:1,fly during:1,during texturing:1,texturing The:1,The Light:1,Light Map:1,Map as:1,as Alpha:1,Alpha Texture:1,Texture Another:1,Another appealing:1,appealing non-caching:1,non-caching approach:1,doing unlit:1,unlit texture-mapping:1,texture-mapping in:1,pass then:1,then lighting:1,lighting from:1,pass using:1,alpha texture:1,texture In:1,the textured:1,textured polygon:1,first with:1,lighting then:1,is textured:1,textured on:1,map intensity:1,intensity used:1,alpha value:1,brightly to:1,light each:1,texel The:1,The hardware’s:1,hardware’s texture-mapping:1,texture-mapping circuitry:1,both passes:1,passes so:1,lighting comes:1,out perspective-correct:1,perspective-correct and:1,consistent under:1,conditions just:1,The lighting:1,lighting polygons:1,texture polygons:1,represent dynamically:1,changing lighting:1,lighting Two-pass:1,Two-pass lighting:1,only looks:1,footprint other:1,than texture:1,and light:1,map storage:1,storage and:1,and provides:1,provides level:1,not dependent:1,on surface:1,primary downside:1,downside to:1,to two-pass:1,accelerator as:1,as single-pass:1,single-pass drawing:1,The current:1,current crop:1,accelerators is:1,and few:1,are up:1,passes at:1,change soon:1,soon Another:1,Another potential:1,don’t implement:1,implement true:1,true alpha:1,blending Nonetheless:1,Nonetheless as:1,as accelerators:1,accelerators get:1,get better:1,expect two-pass:1,two-pass drawing:1,or three-or-more-pass:1,three-or-more-pass for:1,for adding:1,adding splatters:1,like by:1,by overlaying:1,overlaying sprite:1,sprite polygons:1,also expect:1,expect Gouraud:1,used it’s:1,fast Also:1,Also speedier:1,speedier CPUs:1,and accelerators:1,enable much:1,smaller that:1,polygons become:1,better Gouraud:1,shading looks:1,looks compared:1,lighting The:1,engine you’ll:1,from id:1,Software will:1,be oriented:1,oriented heavily:1,heavily toward:1,toward hardware:1,a tossup:1,tossup whether:1,caching Gouraud:1,or two-pass:1,lighting Drawing:1,Models Most:1,last group:1,book discuss:1,works If:1,closely though:1,though you’ll:1,about drawing:1,the world—the:1,world—the static:1,floors ceilings:1,such There:1,reasons for:1,particular that:1,world renderer:1,renderer working:1,working well:1,drawn However:1,However moving:1,entities such:1,monsters are:1,are essential:1,useful game:1,engine Traditionally:1,Traditionally these:1,these have:1,with sprites:1,sprites but:1,to polygon-based:1,polygon-based models:1,are composed:1,triangles We:1,We didn’t:1,models fast:1,went through:1,through quite:1,of experimentation:1,experimentation and:1,learning in:1,so For:1,our triangle-model:1,triangle-model architecture:1,and present:1,present code:1,one useful:1,useful approach:1,the rapid:1,rapid drawing:1,models Drawing:1,Models Fast:1,Fast We:1,We would:1,have liked:1,liked one:1,one rendering:1,rendering model:1,hence one:1,graphics pipeline:1,Quake this:1,have simplified:1,and tools:1,focus our:1,efforts However:1,tried adding:1,adding polygon:1,to Quake’s:1,Quake’s global:1,table edge:1,edge processing:1,down unacceptably:1,unacceptably This:1,isn’t that:1,that surprising:1,surprising because:1,table was:1,handle 200:1,200 to:1,to 300:1,300 large:1,the 2000:1,2000 to:1,to 3000:1,3000 tiny:1,dozen triangle:1,scene can:1,add Restructuring:1,Restructuring the:1,use trees:1,trees rather:1,than linked:1,lists would:1,have helped:1,helped with:1,larger data:1,basic problem:1,table requires:1,edge per:1,and triangle:1,models have:1,have too:1,too few:1,justify that:1,overhead Also:1,the much:1,larger edge:1,table generated:1,adding triangle:1,models doesn’t:1,doesn’t fit:1,fit well:1,cache Consequently:1,separate drawing:1,models as:1,Figure 69.1:1,69.1 Unlike:1,world pipeline:1,pipeline the:1,the triangle-model:1,triangle-model pipeline:1,most respects:1,respects a:1,traditional one:1,exceptions noted:1,The entire:1,using z-buffering:1,for proper:1,proper visibility:1,triangle model:1,model all:1,are transformed:1,projected first:1,drawn separately:1,separately Triangle:1,Triangle models:1,stored quite:1,quite differently:1,itself Each:1,Each model:1,model consists:1,of front:1,mesh and:1,and contains:1,full set:1,each animation:1,animation frame:1,so animation:1,simply using:1,correct set:1,of coordinates:1,desired frame:1,frame No:1,No interpolation:1,interpolation morphing:1,morphing or:1,other runtime:1,runtime vertex:1,vertex calculations:1,performed Early:1,Early on:1,on we:1,allow lower:1,lower drawing:1,quality for:1,models than:1,speed For:1,and usually:1,usually distant—and:1,distant—and generally:1,generally part:1,a quickly:1,quickly moving:1,moving monster:1,monster that’s:1,that’s trying:1,trying its:1,you in—so:1,in—so the:1,quality benefits:1,add little:1,value Consequently:1,we chose:1,mapping avoiding:1,perspective Mind:1,are perspective-correct:1,perspective-correct at:1,vertices it’s:1,pixels between:1,that suffer:1,suffer slight:1,slight warping:1,warping Trading:1,Trading Subpixel:1,Subpixel Precision:1,Precision for:1,Speed Another:1,Another sacrifice:1,sacrifice at:1,the altar:1,altar of:1,was subpixel:1,subpixel precision:1,precision Before:1,Before each:1,drawn we:1,snap its:1,nearest integer:1,integer screen:1,handle fractional:1,fractional vertex:1,causes some:1,some jumping:1,jumping of:1,triangle edges:1,again is:1,normal gameplay:1,gameplay especially:1,in continuous:1,motion One:1,interesting benefit:1,they let:1,do backface:1,and rejection:1,rejection of:1,of degenerate:1,one operation:1,component used:1,culling returns:1,returns zero:1,zero for:1,for degenerate:1,triangles Conveniently:1,Conveniently that:1,that cross-product:1,cross-product component:1,denominator for:1,texture gradient:1,calculations used:1,triangle so:1,and determine:1,is drawable:1,drawable we:1,we immediately:1,immediately start:1,reciprocal By:1,get around:1,to calculating:1,gradients the:1,completed execution:1,execution effectively:1,cycle required:1,to issue:1,issue it:1,execution pipes:1,process independently:1,independently while:1,executes Finally:1,to Gouraud-shade:1,Gouraud-shade the:1,them look:1,look considerably:1,more 3-D:1,3-D However:1,calculate where:1,relevant light:1,each model:1,even which:1,primary light:1,each model’s:1,model’s lighting:1,level based:1,brightly the:1,floor point:1,point it:1,was standing:1,standing on:1,lit and:1,lighting so:1,all parts:1,model have:1,some illumination:1,and Gouraud:1,Gouraud shading—but:1,shading—but the:1,lighting vector:1,for Gouraud:1,fixed vector:1,vector so:1,always lit:1,lit from:1,direction Somewhat:1,Somewhat surprisingly:1,surprisingly in:1,this looks:1,looks considerably:1,considerably better:1,than pure:1,pure ambient:1,lighting An:1,Didn’t Work:1,Work As:1,implemented triangle:1,models we:1,tried several:1,several ideas:1,ideas that:1,out One:1,One that’s:1,that’s notable:1,notable because:1,seems so:1,so appealing:1,appealing is:1,is caching:1,caching a:1,and reusing:1,reusing it:1,sprite Our:1,thinking was:1,that clipping:1,clipping transforming:1,transforming projecting:1,projecting and:1,a several-hundred-triangle:1,several-hundred-triangle model:1,model was:1,sprite too:1,allow very:1,very many:1,many models:1,once We:1,We wanted:1,dozen simultaneous:1,simultaneous models:1,models so:1,idea was:1,closest models:1,models we’d:1,we’d draw:1,draw into:1,sprite then:1,then reuse:1,reuse that:1,that sprite:1,sprite at:1,model’s new:1,three frames:1,frames amortizing:1,amortizing the:1,drawing cost:1,cost over:1,and boosting:1,boosting overall:1,overall model-drawing:1,model-drawing performance:1,The rendering:1,rendering wouldn’t:1,sprite was:1,was reused:1,reused because:1,and model:1,model moved:1,moved but:1,seem likely:1,that slight:1,slight inaccuracy:1,inaccuracy would:1,noticeable for:1,and largest:1,largest models:1,models As:1,were wrong:1,wrong The:1,The repeated:1,repeated frames:1,were sometimes:1,sometimes painfully:1,painfully visible:1,visible looking:1,looking like:1,like jerky:1,jerky cardboard:1,cardboard cutouts:1,cutouts In:1,they looked:1,looked a:1,sprites used:1,in DOOM—precisely:1,DOOM—precisely the:1,effect we:1,were trying:1,avoid This:1,was especially:1,true if:1,them more:1,than once—and:1,once—and if:1,them only:1,full 3-D:1,rendering plus:1,two sprite:1,sprite renderings:1,renderings every:1,which wasn’t:1,simply doing:1,3-D renderings:1,renderings The:1,The sprite:1,architecture also:1,also introduced:1,introduced considerable:1,considerable code:1,complexity increased:1,increased memory:1,footprint because:1,get hidden:1,surfaces exactly:1,right because:1,because sprites:1,sprites are:1,are unavoidably:1,unavoidably 2-D:1,2-D The:1,sprites dropped:1,dropped sharply:1,sharply as:1,as models:1,models got:1,got closer:1,closer and:1,that’s also:1,also where:1,sprites looked:1,looked worse:1,worse when:1,were reused:1,reused limiting:1,limiting sprites:1,sprites to:1,use at:1,considerable distance:1,distance All:1,All these:1,problems could:1,been worked:1,out reasonably:1,architecture just:1,just had:1,the feeling:1,being fundamentally:1,fundamentally not:1,right approach:1,tried thinking:1,thinking along:1,along different:1,lines An:1,that Did:1,Did Work:1,Work John:1,Carmack had:1,notion that:1,just way:1,much effort:1,effort per:1,the tiny:1,models After:1,all distant:1,just indistinct:1,indistinct blobs:1,pixels suffering:1,suffering heavily:1,heavily from:1,from effects:1,texture aliasing:1,pixel quantization:1,quantization he:1,he reasoned:1,reasoned so:1,work just:1,drawing blobs:1,of approximately:1,equal quality:1,quality The:1,trick was:1,approach We:1,We tossed:1,tossed around:1,around half-formed:1,half-formed ideas:1,ideas like:1,like flood-filling:1,flood-filling the:1,image within:1,its silhouette:1,silhouette or:1,or encoding:1,encoding the:1,of deltas:1,deltas picking:1,picking a:1,visible seed:1,seed point:1,working around:1,model according:1,the deltas:1,deltas The:1,first approach:1,seemed practical:1,practical enough:1,try was:1,vertex replicated:1,replicated to:1,a 2x2:1,2x2 box:1,box with:1,vertices together:1,together forming:1,forming the:1,the approximate:1,approximate shape:1,model Sometimes:1,this worked:1,worked quite:1,quite well:1,were gaps:1,gaps where:1,triangles were:1,were large:1,very erratic:1,erratic However:1,did point:1,end did:1,trick One:1,One morning:1,the office:1,office to:1,that overnight:1,overnight and:1,morning John:1,had designed:1,technique I’ll:1,call subdivision:1,rasterization This:1,technique scans:1,out approximately:1,approximately the:1,triangle with:1,no overhead:1,overhead as:1,First all:1,drawn Ideally:1,Ideally only:1,vertices on:1,drawn but:1,but determining:1,which vertices:1,vertices those:1,are would:1,occasional error:1,error from:1,visible back:1,back vertex:1,the noise:1,noise Once:1,processed one:1,Each triangle:1,triangle that:1,through backface:1,culling is:1,with recursive:1,recursive subdivision:1,subdivision If:1,the triangle’s:1,triangle’s sides:1,sides is:1,pixel long:1,either x:1,or y—that:1,y—that is:1,triangle contains:1,contains any:1,aren’t at:1,at vertices—then:1,vertices—then that:1,split in:1,as nearly:1,possible at:1,at given:1,given integer:1,created at:1,split with:1,with texture:1,are halfway:1,endpoints The:1,same splitting:1,splitting could:1,small triangles—the:1,triangles—the sort:1,that subdivision:1,subdivision works:1,well on—it:1,on—it was:1,was adequate:1,adequate to:1,to flat-shade:1,flat-shade each:1,triangle at:1,light level:1,vertex so:1,The halfway:1,halfway values:1,values can:1,quickly with:1,with shifts:1,shifts This:1,This vertex:1,resulting triangles:1,triangles is:1,recursively in:1,Figure 69.2:1,69.2 There:1,additional details:1,that ensures:1,once except:1,for backside:1,backside vertices:1,basically subdivision:1,rasterization boils:1,boils down:1,to taking:1,triangle splitting:1,splitting a:1,side that:1,one undrawn:1,undrawn pixel:1,and repeating:1,new triangles:1,this shown:1,Listing 69.1:1,69.1 is:1,easily optimized:1,optimized especially:1,a generalized:1,generalized triangle:1,triangle rasterizer:1,rasterizer Subdivision:1,Subdivision rasterization:1,rasterization introduces:1,introduces considerably:1,more error:1,error than:1,than affine:1,doesn’t draw:1,draw exactly:1,triangle shape:1,shape but:1,very hard:1,detect for:1,for triangles:1,contain only:1,pixels We:1,We found:1,rasterizers becomes:1,becomes noticeable:1,noticeable was:1,was surprisingly:1,close 30:1,40 feet:1,the Ogres:1,Ogres and:1,12 feet:1,the Zombies:1,Zombies This:1,typical Quake:1,Quake scene:1,with subdivision:1,rasterization not:1,not affine:1,mapping How:1,much does:1,does subdivision:1,rasterization help:1,performance When:1,John originally:1,originally implemented:1,than doubled:1,doubled triangle-model:1,yet optimized:1,optimized However:1,took it:1,it upon:1,upon myself:1,myself to:1,the mapper:1,mapper so:1,so now:1,now affine:1,percent slower:1,than subdivision:1,rasterization While:1,While 20:1,percent may:1,sound impressive:1,impressive it:1,it includes:1,clipping transform:1,transform projection:1,and backface-culling:1,backface-culling time:1,rasterization difference:1,difference alone:1,alone is:1,percent Besides:1,Besides 20:1,percent overall:1,overall means:1,have 12:1,12 monsters:1,monsters now:1,now where:1,had 10:1,10 before:1,before so:1,we count:1,count subdivision:1,rasterization as:1,clear success:1,success More:1,More Ideas:1,Ideas that:1,that Might:1,Might Work:1,Work Useful:1,Useful as:1,as subdivision:1,rasterization proved:1,be we:1,we by:1,means think:1,we’ve maxed:1,out triangle-model:1,drawing if:1,we spent:1,spent far:1,less design:1,and development:1,on subdivision:1,subdivision than:1,rasterizer so:1,there’s quite:1,found for:1,drawing small:1,triangles For:1,precalculate drawing:1,drawing masks:1,masks or:1,even precompile:1,precompile drawing:1,possible small:1,triangles say:1,say up:1,to 4x4:1,4x4 or:1,or 5x5:1,5x5 and:1,footprint looks:1,looks reasonable:1,reasonable It’s:1,both precalculated:1,precalculated drawing:1,and subdivision:1,rasterization are:1,coordinates none:1,stuff works:1,fixed-point vertices:1,vertices More:1,interesting still:1,the stack-based:1,stack-based rendering:1,rendering described:1,article Time/Space:1,Time/Space Tradeoffs:1,Tradeoffs for:1,for Polygon:1,Polygon Mesh:1,Mesh Rendering:1,Rendering by:1,by Bar-Yehuda:1,Bar-Yehuda and:1,and Gotsman:1,Gotsman in:1,the April:1,April 1996:1,1996 ACM:1,ACM Transactions:1,Transactions on:1,Graphics Unfortunately:1,slow going:1,going but:1,mesh as:1,commands that:1,that place:1,place vertices:1,stack remove:1,remove them:1,draw triangles:1,triangles using:1,stack This:1,in excellent:1,excellent CPU:1,coherency because:1,because rather:1,than indirecting:1,indirecting all:1,pool to:1,retrieve vertex:1,vertex data:1,data all:1,vertices reside:1,tiny stack:1,stack that’s:1,that’s guaranteed:1,cache Local:1,Local variables:1,variables used:1,used while:1,small block:1,block next:1,commands representing:1,accessed sequentially:1,sequentially from:1,so cache:1,cache utilization:1,utilization should:1,high As:1,As processors:1,processors speed:1,than main:1,access cache:1,cache optimizations:1,optimizations of:1,become steadily:1,in improving:1,one best:1,drawing triangle:1,way that’s:1,that’s frustrating:1,frustrating but:1,is it’s:1,it’s these:1,these nearly:1,nearly infinite:1,infinite possibilities:1,possibilities that:1,make 3-D:1,3-D so:1,so interesting:1,interesting not:1,an endless:1,endless varied:1,varied challenge:1,challenge but:1,solution waiting:1,found Chapter:1,Chapter 70:1,70 Quake:1,Quake A:1,A Post-Mortem:1,Post-Mortem and:1,a Glimpse:1,Glimpse into:1,the Future:1,Future Why:1,first group:1,group think:1,this faster:1,faster method:1,going across:1,room It:1,simple They:1,They looked:1,were given:1,given to:1,for materials:1,materials and:1,us they:1,they wanted:1,everything But:1,But they:1,need everything:1,everything They:1,They could:1,way Frederik:1,Frederik Pohl:1,Pohl The:1,The Gold:1,Gold at:1,the Starbow’s:1,Starbow’s End:1,End Eleven:1,Eleven years:1,started the:1,first serious:1,serious graphics:1,graphics article:1,ever wrote:1,wrote with:1,above quote:1,quote The:1,making at:1,programming assumptions:1,on high-level:1,languages or:1,processors had:1,be discarded:1,discarded in:1,the quest:1,maximum x86:1,x86 performance:1,performance While:1,that’s certainly:1,true time:1,microcomputer world:1,have moved:1,moved on:1,and today:1,today there’s:1,important lesson:1,lesson 3-D:1,game programmers:1,programmers can:1,from Frederik:1,Pohl’s words:1,words Nowadays:1,Nowadays CPUs:1,CPUs 3-D:1,hardware 3-D:1,3-D algorithms:1,3-D data:1,structures are:1,are evolving:1,evolving so:1,enemy is:1,now often:1,techniques from:1,last product—and:1,product—and sometimes:1,current product:1,product We:1,We all:1,all feel:1,with techniques:1,already mastered:1,mastered but:1,but leading-edge:1,leading-edge 3-D:1,a delicate:1,delicate balancing:1,act between:1,between performance:1,performance features:1,features particularly:1,with game:1,game designers:1,designers always:1,always wanting:1,wanting to:1,and workflow:1,workflow as:1,see preprocessing:1,preprocessing that:1,performance often:1,often hurts:1,hurts designer:1,productivity that:1,never safe:1,approach until:1,game has:1,has actually:1,actually shipped:1,shipped Change:1,Change is:1,be looking:1,looking to:1,I’ve talked:1,technology elsewhere:1,book However:1,chapters focused:1,areas not:1,not overall:1,structure Moreover:1,Moreover Quake:1,Quake changed:1,in significant:1,significant ways:1,ways between:1,writing of:1,final shipping:1,shipping Then:1,Then after:1,after shipping:1,was ported:1,ported to:1,hardware And:1,the post-Quake:1,post-Quake engine:1,in development:1,development at:1,writing Spring:1,Spring 1997:1,1997 with:1,some promising:1,promising results:1,results So:1,in wrapping:1,wrapping up:1,I’ll recap:1,recap Quake’s:1,structure relatively:1,relatively quickly:1,quickly then:1,then bring:1,you up:1,date on:1,latest developments:1,developments And:1,of Frederik:1,Pohl’s quote:1,quote I’ll:1,and discarded:1,discarded at:1,dozen 3-D:1,developing Quake:1,Quake’s code:1,written from:1,scratch rather:1,using Doom:1,Doom code:1,almost switched:1,final month:1,month as:1,describe later:1,later And:1,And even:1,this early:1,early stage:1,stage Trinity:1,Trinity uses:1,no Quake:1,technology In:1,fact I’ll:1,to coin:1,coin Carmack’s:1,Law as:1,follows Fight:1,Fight code:1,code entropy:1,entropy If:1,assumption throw:1,away your:1,your old:1,old code:1,and rewrite:1,rewrite it:1,scratch Incremental:1,Incremental patching:1,patching and:1,and modifying:1,modifying seems:1,seems easier:1,easier at:1,normal course:1,things in:1,development but:1,but ends:1,being much:1,much harder:1,harder and:1,and producing:1,producing bulkier:1,bulkier markedly:1,markedly inferior:1,inferior code:1,for QuakeWorld:1,QuakeWorld It:1,seem safer:1,safer to:1,modify working:1,the nastiest:1,nastiest bugs:1,bugs arise:1,from unexpected:1,unexpected side:1,and incorrect:1,incorrect assumptions:1,assumptions which:1,which almost:1,always arise:1,arise in:1,in patched-over:1,patched-over code:1,code designed:1,up Do:1,Do the:1,front to:1,code simple:1,simple elegant:1,elegant great—and:1,great—and just:1,plain right:1,it’ll pay:1,off many:1,many times:1,run Before:1,I begin:1,to remind:1,remind you:1,the Doom:1,Doom and:1,material I’m:1,is presented:1,of sharing:1,make our:1,our corner:1,world a:1,for everyone:1,everyone I’d:1,Carmack Quake’s:1,Quake’s architect:1,architect and:1,and lead:1,lead programmer:1,and id:1,Software for:1,for allowing:1,share this:1,technology with:1,with you:1,I encourage:1,share your:1,own insights:1,insights by:1,by posting:1,writing books:1,articles whenever:1,opportunity and:1,so Of:1,course check:1,check with:1,your employer:1,employer first:1,first We’ve:1,We’ve all:1,all benefited:1,benefited greatly:1,shared wisdom:1,people like:1,like Knuth:1,Knuth Foley:1,Dam Jim:1,Jim Blinn:1,Blinn Jim:1,Jim Kajiya:1,Kajiya and:1,and hundreds:1,of others—are:1,others—are you:1,you ready:1,at making:1,own contribution:1,future Preprocessing:1,Preprocessing the:1,World For:1,most part:1,part I’ll:1,discuss Quake’s:1,although I’ll:1,I’ll touch:1,interest For:1,For 3-D:1,rendering purposes:1,purposes Quake:1,Quake consists:1,basic sorts:1,objects the:1,world which:1,never changes:1,changes shape:1,shape or:1,or position:1,potentially moving:1,objects called:1,called entities:1,entities which:1,ways I’ll:1,each separately:1,separately The:1,of brushes:1,brushes which:1,are n-sided:1,n-sided convex:1,polyhedra placed:1,a designer:1,designer using:1,a map:1,map editor:1,editor with:1,a selectable:1,selectable texture:1,texture on:1,completed a:1,preprocessing program:1,program combines:1,combines all:1,all brushes:1,brushes to:1,a skin:1,skin around:1,solid areas:1,interpenetration of:1,polygons just:1,mesh delineating:1,delineating solid:1,areas Once:1,Once this:1,is generating:1,BSP consists:1,called nodes:1,nodes carve:1,carve space:1,top node:1,carves the:1,subspaces and:1,two sets:1,sets splitting:1,node into:1,pieces Each:1,Each subspace:1,then similarly:1,similarly split:1,node each:1,create nodes:1,nodes A:1,A node’s:1,total space:1,space occupied:1,occupied by:1,splits into:1,children continue:1,to subdivide:1,subdivide When:1,only polygon:1,the subspace—the:1,subspace—the polygon:1,polygon whose:1,whose plane:1,plane defines:1,the node—then:1,node—then the:1,two child:1,child subspaces:1,called leaves:1,not divided:1,divided any:1,further The:1,built using:1,current node’s:1,subspace as:1,the heuristic:1,heuristic for:1,for choosing:1,splitters which:1,optimal solution—but:1,solution—but an:1,optimal solution:1,is NP-complete:1,NP-complete and:1,our heuristic:1,heuristic adds:1,adds only:1,15 more:1,splits Polygons:1,not split:1,split all:1,way into:1,leaves rather:1,rather they:1,are placed:1,nodes with:1,are coplanar:1,coplanar one:1,set on:1,back which:1,us reuse:1,reuse the:1,the BSP-walking:1,BSP-walking dot:1,culling as:1,reducing splitting:1,splitting considerably:1,considerably because:1,split only:1,by parent:1,nodes not:1,by child:1,child nodes:1,were split:1,leaves Eliminating:1,Eliminating polygon:1,splits thus:1,thus reducing:1,per level:1,level not:1,only shrinks:1,shrinks Quake’s:1,Quake’s memory:1,footprint but:1,3-D pipeline:1,pipeline producing:1,10 in:1,performance Getting:1,Getting proper:1,proper front-to-back:1,front-to-back drawing:1,complicated with:1,nodes As:1,we walk:1,front-to-back in:1,leaf we:1,we mark:1,after we’ve:1,we’ve recursed:1,recursed and:1,and processed:1,processed everything:1,then process:1,the marked:1,we recurse:1,recurse to:1,polygons behind:1,node So:1,So putting:1,nodes saves:1,saves memory:1,and improves:1,significantly but:1,but loses:1,loses the:1,simply recursing:1,recursing the:1,leaf as:1,of recursing:1,recursing and:1,and marking:1,marking in:1,node processing:1,processing marked:1,then recursing:1,recursing behind:1,node After:1,outer surfaces:1,surfaces of:1,level which:1,see because:1,because levels:1,are sealed:1,sealed spaces:1,spaces are:1,removed so:1,level containing:1,containing all:1,empty space:1,player can:1,move is:1,completely surrounded:1,solid region:1,region This:1,eliminates a:1,many irrelevant:1,irrelevant polygons:1,and reduces:1,step calculating:1,The Potentially:1,Potentially Visible:1,Visible Set:1,Set PVS:1,PVS After:1,calculated The:1,The PVS:1,reduce to:1,a near-minimum:1,near-minimum the:1,drawing from:1,given viewpoint:1,the entities:1,entities that:1,updated over:1,the network:1,network for:1,for multiplayer:1,multiplayer games:1,drawn Calculating:1,expensive Quake:1,levels take:1,to 30:1,30 minutes:1,process on:1,a four-processor:1,four-processor Alpha:1,Alpha and:1,with speedup:1,speedup tweaks:1,tweaks to:1,BSPer the:1,effective of:1,was replacing:1,replacing many:1,many calls:1,to malloc:1,malloc with:1,with stack-based:1,stack-based structures—beware:1,structures—beware of:1,of malloc:1,malloc in:1,in performance-sensitive:1,performance-sensitive code:1,code Quake:1,2 levels:1,are taking:1,hour to:1,process Note:1,includes BSPing:1,BSPing PVS:1,PVS calculations:1,and radiosity:1,later Some:1,Some good:1,news though:1,the nearly:1,nearly two:1,the Alpha:1,Alpha Pentium:1,Pentium Pros:1,Pros have:1,become as:1,that generation:1,of Alphas:1,Alphas so:1,now possible:1,PVS on:1,an affordable:1,affordable machine:1,machine On:1,hand even:1,of BSPing:1,BSPing does:1,does hurt:1,hurt designer:1,productivity John:1,big advocate:1,advocate of:1,moving code:1,the runtime:1,runtime program:1,into utilities:1,utilities and:1,of preprocessing:1,preprocessing for:1,and runtime:1,runtime simplicity:1,even he:1,he thinks:1,thinks that:1,have pushed:1,pushed that:1,it interfered:1,interfered too:1,with workflow:1,workflow The:1,huge amount:1,money can’t:1,can’t buy:1,buy orders:1,than commodity:1,commodity computers:1,getting an:1,an eight-R10000:1,eight-R10000 SGI:1,SGI compute:1,compute server:1,an off-the-shelf:1,off-the-shelf four-processor:1,four-processor Pentium:1,Pro The:1,is manageable:1,manageable because:1,1-bit for:1,the position:1,overall leaf:1,leaf array:1,leaf that’s:1,that’s visible:1,current leaf:1,leaf Most:1,Most leaves:1,are invisible:1,invisible from:1,consists mostly:1,mostly of:1,zeros and:1,and compacts:1,compacts nicely:1,with run-length:1,run-length encoding:1,encoding There:1,two further:1,further interesting:1,points about:1,PVS First:1,Quake PVS:1,PVS does:1,not exclude:1,exclude quite:1,quite as:1,many leaves:1,leaves from:1,from potential:1,potential visibility:1,visibility as:1,could because:1,that precisely:1,precisely describe:1,describe leaf-to-leaf:1,leaf-to-leaf visibility:1,visibility are:1,are quadratic:1,quadratic surfaces:1,and simplicity:1,simplicity planar:1,planar surfaces:1,some slope:1,slope are:1,instead Second:1,PVS describes:1,describes visibility:1,leaf rather:1,specific viewpoint:1,viewpoint this:1,cause two:1,considered John:1,been researching:1,researching the:1,an EVS—an:1,EVS—an exactly:1,exactly visible:1,has concluded:1,a 6-D:1,6-D BSP:1,BSP with:1,with hyperbolic:1,hyperbolic separating:1,separating planes:1,planes could:1,job the:1,problem now:1,he doesn’t:1,the math:1,math to:1,any reasonable:1,reasonable speed:1,speed An:1,interesting extension:1,John calls:1,potentially hearable:1,hearable set:1,set PHS:1,PHS all:1,leaf plus:1,those leaves—in:1,leaves—in other:1,words both:1,the directly:1,directly visible:1,the one-bounce:1,one-bounce visible:1,leaves Of:1,the hearable:1,hearable space:1,space because:1,because sounds:1,sounds could:1,could echo:1,echo or:1,or carry:1,carry further:1,further than:1,does serve:1,serve quite:1,nicely as:1,potentially relevant:1,relevant space—the:1,space—the set:1,player In:1,Quake all:1,all sounds:1,sounds that:1,happen anywhere:1,are heard:1,heard even:1,even through:1,walls if:1,they’re close:1,close enough:1,enough an:1,explosion around:1,corner could:1,well within:1,within hearing:1,hearing and:1,hear so:1,PVS can’t:1,to reject:1,reject that:1,that sound:1,sound but:1,unfortunately an:1,explosion on:1,wall will:1,will sound:1,sound exactly:1,same Not:1,it confusing:1,confusing hearing:1,hearing sounds:1,sounds through:1,walls but:1,modem game:1,game the:1,the bandwidth:1,bandwidth required:1,send all:1,the sounds:1,sounds in:1,level can:1,down considerably:1,considerably In:1,QuakeWorld a:1,a specifically:1,specifically multiplayer:1,multiplayer variant:1,Quake I’ll:1,later John:1,John uses:1,which sounds:1,sounds to:1,bother sending:1,sending and:1,resulting bandwidth:1,bandwidth improvement:1,improvement has:1,to bump:1,bump the:1,of players:1,players from:1,from 16:1,16 to:1,to 32:1,32 Better:1,a sound:1,sound on:1,wall won’t:1,heard unless:1,an opening:1,opening that:1,that permits:1,permits the:1,sound to:1,through In:1,future John:1,John will:1,PVS to:1,determine fully:1,fully audible:1,audible sounds:1,sounds and:1,determine muted:1,muted sounds:1,sounds Also:1,PHS can:1,like explosions:1,explosions that:1,their center:1,center in:1,have portions:1,reach into:1,PVS In:1,PHS is:1,useful as:1,client might:1,be notified:1,notified of:1,of events:1,events The:1,final preprocessing:1,is light:1,map generation:1,generation Each:1,Each light:1,is traced:1,what polygons:1,strikes and:1,cumulative effect:1,all lights:1,lights on:1,map a:1,light values:1,values on:1,a 16-texel:1,grid In:1,2 radiosity:1,radiosity lighting—a:1,lighting—a considerably:1,expensive process:1,highly realistic:1,realistic lighting—is:1,lighting—is performed:1,I’ll save:1,later Passages:1,Passages The:1,The Last-Minute:1,Last-Minute Change:1,Change that:1,Didn’t Happen:1,Happen Earlier:1,we almost:1,almost changed:1,changed 3-D:1,engines again:1,last month:1,month of:1,development Here’s:1,Here’s what:1,happened One:1,alternatives to:1,of portals:1,portals where:1,the focus:1,focus is:1,exist along:1,along leaf:1,leaf faces:1,faces rather:1,more usual:1,usual focus:1,polygons themselves:1,themselves These:1,These empty:1,empty places:1,places are:1,themselves polygons:1,called portals:1,places that:1,that visibility:1,visibility can:1,pass from:1,leaf to:1,another Portals:1,Portals are:1,PVS generator:1,generator to:1,determine visibility:1,other 3-D:1,primary mechanism:1,determining leaf:1,leaf or:1,or sector:1,sector visibility:1,example portals:1,clipping region:1,region to:1,restrict drawing:1,visible through:1,the portal:1,portal Or:1,Quake’s preprocessor:1,preprocessor visibility:1,visibility boundary:1,boundary planes:1,one portal:1,portal to:1,determine visible:1,or leaves:1,leaves Used:1,Used either:1,way portals:1,support more:1,more changeable:1,changeable worlds:1,because unlike:1,PVS the:1,changed on:1,fly The:1,with portal-based:1,portal-based visibility:1,visibility is:1,perform at:1,in complex:1,scenes which:1,many portals:1,portals Since:1,Since those:1,expensive scenes:1,scenes to:1,draw as:1,well portals:1,portals tend:1,to worsen:1,worsen the:1,case However:1,However late:1,development John:1,storing portals:1,database could:1,could readily:1,improved upon:1,upon To:1,clear Quake:1,Quake wasn’t:1,wasn’t using:1,using portals:1,portals at:1,didn’t end:1,them Since:1,aforementioned sets:1,3-D visibility:1,visibility clipping:1,clipping planes:1,planes between:1,between portals—which:1,portals—which he:1,he named:1,named passages:1,passages were:1,were what:1,got used:1,for visibility:1,visibility if:1,he stored:1,stored those:1,those instead:1,generating them:1,them dynamically:1,dynamically from:1,do visibility:1,visibility much:1,standard portals:1,portals This:1,give a:1,significantly tighter:1,tighter polygon:1,set than:1,be based:1,on visibility:1,visibility through:1,the passages:1,passages from:1,viewpoint rather:1,PVS’s approach:1,of visibility:1,considerable help:1,help because:1,designers were:1,were running:1,running right:1,against performance:1,performance limits:1,limits partly:1,PVS’s relatively:1,relatively loose:1,loose polygon:1,set John:1,immediately decided:1,that passages-based:1,passages-based visibility:1,visibility was:1,a sufficiently:1,sufficiently superior:1,superior approach:1,would switch:1,switch Quake:1,that late:1,late stage:1,stage and:1,and within:1,weekend he:1,had implemented:1,had it:1,it working—only:1,working—only to:1,like portals:1,portals it:1,it improved:1,improved best:1,cases but:1,but worsened:1,worsened worst:1,worst cases:1,overall wasn’t:1,win for:1,truth given:1,to shipping:1,shipping John:1,much thankful:1,thankful as:1,as disappointed:1,disappointed that:1,passages didn’t:1,possibilities were:1,were too:1,us not:1,So why:1,why even:1,even bother:1,bother mentioning:1,mentioning this:1,this Partly:1,Partly to:1,not every:1,every interesting:1,interesting idea:1,idea pans:1,pans out:1,did pan:1,it’s instructive:1,many ideas:1,ideas don’t:1,don’t That:1,shouldn’t try:1,try promising:1,promising ideas:1,ideas though:1,though First:1,First some:1,some do:1,do pan:1,which unless:1,try Second:1,Second an:1,be filed:1,away for:1,case It’s:1,It’s quite:1,passages will:1,different context:1,a future:1,future engine:1,engine The:1,more approaches:1,approaches you:1,larger your:1,your toolkit:1,toolkit and:1,the broader:1,broader your:1,your understanding:1,understanding will:1,be when:1,tackle your:1,next project:1,project Drawing:1,World Everything:1,Everything described:1,described so:1,far is:1,step When:1,When Quake:1,actually running:1,view leaf:1,is decompressed:1,decompressed and:1,leaf flagged:1,flagged as:1,as visible:1,visible is:1,frame’s PVS:1,The marking:1,marking is:1,frame’s number:1,leaf this:1,this avoids:1,PVS marking:1,marking each:1,frame All:1,the parent:1,also marked:1,marked this:1,information could:1,as additional:1,additional PVS:1,PVS flags:1,save space:1,is bubbled:1,bubbled up:1,BSP from:1,each visible:1,visible leaf:1,leaf After:1,marked the:1,is walked:1,walked front-to-back:1,front-to-back At:1,box of:1,frustum if:1,clipped then:1,ignored Likewise:1,Likewise if:1,viewpoint leaf:1,ignored If:1,clipped or:1,children so:1,any unnecessary:1,unnecessary clip:1,clip tests:1,tests can:1,avoided The:1,The children:1,recursively When:1,reached polygons:1,leaf are:1,drawable When:1,When recursion:1,finished all:1,drawable are:1,children on:1,are similarly:1,similarly processed:1,recursively The:1,special intermediate:1,intermediate step:1,step between:1,drawing Each:1,its non-horizontal:1,non-horizontal edges:1,global list:1,of potentially:1,by sorting:1,on BSP-walk:1,BSP-walk order:1,are emitted:1,emitted into:1,into span:1,lists linked:1,linked off:1,respective surface:1,surface descriptors:1,descriptors for:1,polygon Taken:1,these spans:1,once resulting:1,in zero:1,overdraw surfaces:1,completely hidden:1,hidden by:1,surfaces generate:1,generate no:1,no spans:1,spans at:1,drawn all:1,there’s texture:1,texture coherency:1,coherency between:1,between spans:1,helpful for:1,for processor:1,coherency and:1,reduce setup:1,setup overhead:1,primary purpose:1,make Quake’s:1,Quake’s performance:1,as level—that:1,level—that is:1,as consistent—as:1,consistent—as possible:1,possible Compared:1,Compared to:1,polygons front-to-back:1,front-to-back the:1,list certainly:1,certainly slows:1,overdraw However:1,However by:1,eliminating overdraw:1,helped considerably:1,Quake there’s:1,perhaps 41:1,41 between:1,between worst:1,worst and:1,case drawing:1,the 101:1,101 or:1,happen with:1,with straight:1,straight polygon:1,drawing Leveling:1,Leveling is:1,because cases:1,game slows:1,being unplayable:1,unplayable dictate:1,dictate game:1,level design:1,the fewer:1,fewer constraints:1,constraints placed:1,on design:1,better A:1,that best:1,case performance:1,be seductively:1,seductively misleading:1,misleading it’s:1,great feeling:1,feeling to:1,scene running:1,at 30:1,even 60:1,second but:1,game runs:1,fps those:1,those best:1,cases are:1,game look:1,look worse:1,worse The:1,an atypical:1,atypical technology:1,for John:1,John it’s:1,extra stage:1,stage in:1,engine it’s:1,well A:1,A Quake:1,of 500:1,500 potentially:1,get placed:1,put 5000:1,5000 polygons:1,list it:1,would quickly:1,quickly bog:1,down due:1,to edge:1,edge sorting:1,sorting link:1,link following:1,and dataset:1,dataset size:1,size Different:1,Different data:1,structures like:1,like using:1,edges rather:1,linear linked:1,list would:1,some degree:1,degree but:1,small window:1,of applicability:1,applicability it:1,was appropriate:1,the degree:1,a Pentium-based:1,Pentium-based game:1,the reduction:1,reduction in:1,in polygons:1,polygons made:1,be poorly:1,poorly suited:1,scenes It:1,It served:1,served well:1,engine but:1,but remains:1,an inelegant:1,inelegant solution:1,end it:1,it feels:1,feels like:1,like there’s:1,better we:1,didn’t hit:1,I’m pragmatic:1,pragmatic above:1,list did:1,job Rasterization:1,Rasterization Once:1,list they:1,they must:1,with perspective-correct:1,involves hundreds:1,of heavily:1,fundamentally pretty:1,screenspace equations:1,equations for:1,1/z s/z:1,s/z and:1,t/z where:1,where s:1,distance are:1,surface Then:1,Then for:1,span these:1,these values:1,divide and:1,and s:1,then calculated:1,as s/z:1,s/z z:1,t/z z:1,z If:1,pixels s:1,likewise calculated:1,calculated every:1,span Then:1,Then each:1,each stretch:1,stretch of:1,by linearly:1,these correctly:1,correctly calculated:1,calculated points:1,This introduces:1,introduces some:1,some slight:1,slight error:1,small ripple:1,ripple well:1,improvement gained:1,perspective-correct math:1,math only:1,To speed:1,is overlapped:1,overlapped with:1,drawing 16:1,pixels taking:1,Pentium’s ability:1,perform floating-point:1,floating-point in:1,FDIV effectively:1,cycle Lighting:1,Lighting Lighting:1,Lighting is:1,less simple:1,explain The:1,doing polygon:1,polygon lighting:1,correct light:1,light at:1,and linearly:1,linearly interpolate:1,points Gouraud:1,has several:1,several disadvantages:1,disadvantages in:1,get detailed:1,without creating:1,lighting isn’t:1,isn’t perspective:1,angle for:1,for polygons:1,polygons other:1,than triangles:1,triangles To:1,To address:1,address these:1,problems Quake:1,uses surface-based:1,lighting instead:1,instead In:1,surface a:1,world polygon:1,that polygon’s:1,memory buffer:1,buffer At:1,surface’s light:1,calculated during:1,during preprocessing:1,preprocessing Lighting:1,Lighting values:1,are linearly:1,linearly interpolated:1,interpolated between:1,light map’s:1,map’s 16-texel:1,points so:1,are smooth:1,but slightly:1,slightly blurry:1,blurry Then:1,screen using:1,mapping described:1,above with:1,the prelit:1,prelit surface:1,texture rather:1,original texture:1,tile No:1,No additional:1,during texture:1,mapping all:1,all lighting:1,created Certainly:1,then texture:1,map from:1,it than:1,do lighting:1,pass However:1,However surface:1,surface buffers:1,buffers are:1,are cached:1,cached for:1,reuse so:1,mapping stage:1,usually needed:1,needed Quake:1,Quake surfaces:1,surfaces tend:1,be big:1,big so:1,so texture:1,is slowed:1,slowed by:1,by cache:1,misses however:1,Quake approach:1,to interpolate:1,interpolate lighting:1,basis which:1,helps speed:1,require additional:1,provide sophisticated:1,lighting On:1,surface-based drawing:1,roughly comparable:1,to tiled:1,tiled Gouraud-shaded:1,Gouraud-shaded texture:1,texture mapping—and:1,mapping—and it:1,better being:1,being perspective:1,correct rotationally:1,invariant and:1,detailed Surface-based:1,Surface-based drawing:1,drawing also:1,support some:1,interesting effects:1,because anything:1,cached as:1,in correct:1,correct perspective:1,perspective For:1,instance paint:1,paint splattered:1,splattered on:1,wall could:1,splatter image:1,sprite into:1,appropriate surface:1,surface would:1,splatter as:1,well Dynamic:1,Dynamic Lighting:1,Lighting Here:1,feature added:1,Quake after:1,after last:1,last year’s:1,year’s Computer:1,Conference CGDC:1,CGDC At:1,time Quake:1,Quake did:1,not support:1,support dynamic:1,is explosions:1,such didn’t:1,didn’t produce:1,produce temporary:1,temporary lighting:1,effects We:1,We hadn’t:1,hadn’t thought:1,thought dynamic:1,add enough:1,game to:1,trouble however:1,however at:1,at CGDC:1,CGDC Billy:1,Zelsnack showed:1,showed us:1,his latest:1,latest 3-D:1,engine which:1,from finished:1,finished at:1,but did:1,have impressive:1,impressive dynamic:1,effects This:1,This caused:1,caused us:1,move dynamic:1,lighting up:1,the priority:1,priority list:1,got back:1,to id:1,spent several:1,several days:1,days making:1,the surface-building:1,surface-building code:1,possible winding:1,winding up:1,at 2.25:1,per texel:1,in anticipation:1,anticipation of:1,adding dynamic:1,course cause:1,cause dynamically:1,to constantly:1,constantly be:1,rebuilt as:1,lighting changed:1,changed A:1,A significant:1,significant drawback:1,makes surface:1,caching worthless:1,worthless for:1,for dynamically:1,not dynamically:1,lit at:1,out fine:1,fine There:1,There things:1,things stayed:1,stayed for:1,several weeks:1,weeks while:1,more critical:1,critical work:1,was uncertain:1,uncertain whether:1,whether dynamic:1,fact make:1,into Quake:1,Quake Then:1,Then one:1,one Saturday:1,Saturday John:1,John suggested:1,I take:1,at adding:1,high-level dynamic:1,lighting code:1,dynamic light:1,project their:1,their sphere:1,sphere of:1,illumination into:1,dynamic contributions:1,contributions into:1,appropriate light:1,and rebuild:1,rebuild the:1,affected surfaces:1,surfaces I:1,would as:1,I finished:1,finished up:1,two A:1,while later:1,bet I:1,get dynamic:1,lighting working:1,and dove:1,code One:1,One hour:1,and nine:1,nine minutes:1,minutes later:1,had dynamic:1,now hard:1,imagine Quake:1,Quake without:1,imagine the:1,implement them:1,them once:1,seen them:1,them done:1,else One:1,Quake’s dynamic:1,how inaccurate:1,inaccurate it:1,is It:1,linear projection:1,projection accounting:1,accounting properly:1,for neither:1,neither surface:1,surface angle:1,angle nor:1,nor lighting:1,lighting falloff:1,falloff with:1,with distance—and:1,distance—and yet:1,yet that’s:1,that’s almost:1,notice unless:1,you specifically:1,specifically look:1,no negative:1,negative impact:1,on gameplay:1,gameplay whatsoever:1,whatsoever Motion:1,Motion and:1,fast action:1,action can:1,can surely:1,surely cover:1,cover for:1,a multitude:1,multitude of:1,graphics sins:1,sins It’s:1,Quake’s lighting:1,is perspective:1,the rasterizer:1,both subpixel:1,subpixel and:1,and subtexel:1,subtexel correct:1,correct Quake:1,Quake worlds:1,worlds are:1,are visually:1,visually very:1,very solid:1,and stable:1,stable This:1,important design:1,design goal:1,goal from:1,start both:1,both as:1,technical pride:1,pride and:1,it greatly:1,player’s sense:1,of immersion:1,immersion Entities:1,Entities So:1,far all:1,all we’ve:1,static unchanging:1,unchanging apart:1,from dynamic:1,lighting world:1,world That’s:1,important foundation:1,foundation but:1,game now:1,add moving:1,objects These:1,These objects:1,objects fall:1,four very:1,different categories:1,categories BSP:1,models polygon:1,models sprites:1,and particles:1,particles BSP:1,BSP Models:1,Models BSP:1,world except:1,move Examples:1,Examples include:1,include doors:1,doors moving:1,moving bridges:1,bridges and:1,and health:1,health and:1,and ammo:1,ammo boxes:1,boxes The:1,way these:1,rendered is:1,clipping their:1,their polygons:1,leaf Then:1,Then these:1,these fragments:1,list just:1,like world:1,and scanned:1,out along:1,world when:1,processed The:1,is front-to-back:1,ordering Each:1,Each BSP:1,model polygon:1,it resides:1,resides allowing:1,allowing it:1,properly versus:1,polygons If:1,If two:1,different BSP:1,leaf however:1,however BSP:1,BSP ordering:1,ordering is:1,longer useful:1,useful so:1,then sort:1,sort those:1,by 1/z:1,1/z calculated:1,polygons plane:1,plane equations:1,equations Interesting:1,Interesting note:1,note We:1,We originally:1,all world:1,reason being:1,then avoid:1,avoid splitting:1,splitting polygons:1,actually intersected:1,intersected rather:1,split them:1,them along:1,of parent:1,nodes This:1,in fewer:1,faster edge:1,rasterization Unfortunately:1,Unfortunately we:1,that precision:1,precision errors:1,errors and:1,and special:1,cases such:1,as seamlessly:1,seamlessly abutting:1,abutting objects:1,objects made:1,get global:1,global 1/z:1,sorting to:1,work completely:1,completely reliably:1,reliably and:1,around these:1,problems slowed:1,were getting:1,getting no:1,extra performance:1,extra code:1,complexity This:1,that 1/z:1,sorting can’t:1,in something:1,a flight:1,flight sim:1,sim where:1,objects never:1,never abut:1,abut but:1,but BSP:1,thing partly:1,it always:1,always works:1,perfectly and:1,it’s simpler:1,sort on:1,on integer:1,integer node:1,and leaf:1,leaf orders:1,orders than:1,on floating-point:1,floating-point 1/z:1,values BSP:1,models take:1,but render:1,render just:1,world again:1,overdraw so:1,so closed:1,doors for:1,example block:1,block drawing:1,of whatever’s:1,whatever’s on:1,side although:1,still necessary:1,transform project:1,door occludes:1,occludes because:1,the PVS—they’re:1,PVS—they’re potentially:1,door opens:1,opens This:1,models most:1,simple structures:1,structures such:1,as boxes:1,boxes which:1,have relatively:1,few polygons:1,cause relatively:1,few edges:1,list Polygon:1,Polygon Models:1,Models and:1,and Z-Buffering:1,Z-Buffering Polygon:1,monsters weapons:1,weapons and:1,and projectiles:1,projectiles consist:1,mesh with:1,with front:1,stretched over:1,For speed:1,small enough:1,generally distant:1,distant enough:1,that affine:1,affine distortion:1,distortion isn’t:1,isn’t visible:1,visible However:1,player’s weapon:1,weapon this:1,caused a:1,probably implement:1,a perspective-correct:1,perspective-correct polygon-model:1,polygon-model rasterizer:1,rasterizer in:1,2 for:1,this specific:1,The triangles:1,also Gouraud:1,Gouraud shaded:1,shaded interestingly:1,interestingly the:1,vector used:1,shade the:1,models is:1,always from:1,no relation:1,relation to:1,actual lights:1,intensity along:1,model’s ambient:1,the brightness:1,brightness of:1,the spot:1,standing above:1,world Even:1,Even this:1,this highly:1,highly inaccurate:1,inaccurate lighting:1,lighting works:1,the Gouraud:1,shading makes:1,makes models:1,models look:1,more three-dimensional:1,three-dimensional and:1,and varying:1,varying the:1,even so:1,so crude:1,crude a:1,way allows:1,allows hiding:1,hiding in:1,in shadows:1,and illumination:1,by explosions:1,and muzzle:1,muzzle flashes:1,flashes One:1,One issue:1,issue with:1,models was:1,handle occlusion:1,occlusion issues:1,issues that:1,of models:1,models were:1,what surfaces:1,surfaces they:1,of We:1,couldn’t add:1,add models:1,per model:1,would overwhelm:1,list Our:1,Our initial:1,initial occlusion:1,occlusion solution:1,solution was:1,sort polygon-model:1,BSP drawing:1,leaf at:1,right points:1,That worked:1,worked reasonably:1,world not:1,not perfectly:1,perfectly though:1,been too:1,some occlusion:1,occlusion error:1,didn’t handle:1,sorting polygon:1,also didn’t:1,didn’t help:1,help the:1,given polygon:1,model sort:1,properly against:1,this turned:1,be z-buffering:1,z-buffering After:1,in for:1,those spans:1,spans This:1,a write-only:1,write-only operation:1,and involves:1,involves no:1,no comparisons:1,comparisons or:1,or overdraw:1,overdraw remember:1,screen exactly:1,once so:1,that expensive—the:1,expensive—the performance:1,10 Then:1,Then polygon:1,z-buffering this:1,a z-compare:1,z-compare at:1,each polygon-model:1,polygon-model pixel:1,no complicated:1,complicated clipping:1,or sorting—and:1,sorting—and occlusion:1,occlusion is:1,all respects:1,respects Polygon:1,models tend:1,to occupy:1,occupy a:1,of z-buffering:1,z-buffering is:1,that high:1,high anyway:1,anyway Opinions:1,Opinions vary:1,vary as:1,the desirability:1,desirability of:1,of z-buffers:1,z-buffers some:1,who favor:1,favor more:1,more analytical:1,analytical approaches:1,to hidden:1,removal claim:1,been seduced:1,z-buffer Maybe:1,Maybe so:1,so but:1,lot there:1,be seduced:1,true as:1,as hardware:1,rendering becomes:1,the norm:1,norm The:1,of particles—thousands:1,particles—thousands of:1,of tiny:1,tiny colored:1,colored rectangles—to:1,rectangles—to Quake:1,Quake illustrated:1,illustrated just:1,how seductive:1,seductive the:1,z-buffer can:1,be it:1,draw properly:1,properly using:1,other occlusion:1,occlusion technique:1,technique Certainly:1,Certainly z-buffering:1,z-buffering by:1,itself can’t:1,serve for:1,removal that’s:1,why we:1,list although:1,PVS would:1,would suffice:1,suffice but:1,but z-buffering:1,z-buffering pretty:1,much means:1,can figure:1,effect you:1,readily insert:1,insert it:1,proper occlusion:1,occlusion and:1,powerful capability:1,capability indeed:1,indeed Supporting:1,Supporting scenes:1,dozen or:1,models of:1,of 300:1,300 to:1,to 500:1,500 polygons:1,polygons each:1,each was:1,major performance:1,performance challenge:1,polygon-model drawing:1,being optimized:1,optimized right:1,last week:1,week before:1,it shipped:1,shipped One:1,One help:1,in allowing:1,allowing more:1,models per:1,scene was:1,PVS we:1,only drew:1,drew those:1,PVS meaning:1,that levels:1,levels could:1,hundred or:1,models without:1,were occluded:1,occluded Note:1,not unique:1,PVS whatever:1,whatever high-level:1,high-level culling:1,culling scheme:1,scheme we:1,had ended:1,using for:1,have provided:1,same benefit:1,benefit for:1,models Also:1,Also model:1,model bounding:1,bounding boxes:1,boxes were:1,to trivially:1,trivially clip:1,weren’t in:1,identify those:1,were unclipped:1,unclipped so:1,sent through:1,special fast:1,fast path:1,biggest breakthrough:1,breakthrough though:1,different sort:1,of rasterizer:1,relatively distant:1,models The:1,The Subdivision:1,Subdivision Rasterizer:1,Rasterizer This:1,This rasterizer:1,rasterizer which:1,subdivision rasterizer:1,rasterizer first:1,first draws:1,model Then:1,takes each:1,each front-facing:1,front-facing triangle:1,and determines:1,determines if:1,side that’s:1,long If:1,does we:1,side into:1,pieces at:1,pixel nearest:1,middle using:1,using adds:1,shifts to:1,side draw:1,split point:1,and process:1,process each:1,two split:1,split triangles:1,triangles recursively:1,to triangles:1,only one-pixel:1,one-pixel sides:1,hence have:1,have nothing:1,draw This:1,is hideously:1,quite ugly:1,ugly due:1,to inaccuracies:1,inaccuracies from:1,from integer:1,integer quantization:1,quantization for:1,100-pixel triangles—but:1,triangles—but it’s:1,say five-pixel:1,five-pixel triangles:1,is indistinguishable:1,accurate rasterization:1,rasterization when:1,is 25:1,25 or:1,or 50:1,away Better:1,subdivider is:1,ridiculously simple—a:1,simple—a few:1,code far:1,far simpler:1,affine rasterizer—and:1,rasterizer—and was:1,an evening:1,evening immediately:1,immediately making:1,of distant:1,models about:1,fast a:1,of conceptual:1,conceptual work:1,The affine:1,rasterizer got:1,got fairly:1,fairly close:1,same performance:1,with further:1,further optimization—in:1,optimization—in the:1,50 slower—but:1,slower—but that:1,took weeks:1,weeks of:1,of difficult:1,programming We:1,We switch:1,rasterizers based:1,model’s distance:1,average triangle:1,triangle size:1,scene most:1,most models:1,away so:1,so subdivision:1,used There:1,undoubtedly faster:1,faster ways:1,ways yet:1,rasterize distant:1,models adequately:1,subdivider was:1,how thinking:1,a radically:1,different direction:1,handsomely Sprites:1,Sprites We:1,eliminate sprites:1,sprites completely:1,completely making:1,making Quake:1,Quake 100:1,100 3-D:1,3-D but:1,but sprites—although:1,sprites—although sometimes:1,sometimes very:1,very visibly:1,visibly 2-D—were:1,2-D—were used:1,few purposes:1,purposes most:1,most noticeably:1,noticeably the:1,the cores:1,cores of:1,of explosions:1,explosions As:1,of CGDC:1,CGDC last:1,year explosions:1,explosions consisted:1,an exploding:1,exploding spray:1,spray of:1,of particles:1,particles discussed:1,wasn’t enough:1,enough visual:1,visual punch:1,punch with:1,that representation:1,representation adding:1,of sprites:1,sprites animating:1,animating an:1,explosion did:1,trick In:1,hindsight we:1,we probably:1,probably should:1,the explosions:1,explosions polygon:1,models rather:1,than sprites:1,sprites it:1,looked about:1,good and:1,few sprites:1,sprites we:1,used didn’t:1,didn’t justify:1,support them:1,them Drawing:1,Drawing a:1,sprite is:1,correction although:1,loop must:1,must detect:1,and skip:1,over transparent:1,transparent pixels:1,perform z-buffering:1,z-buffering Particles:1,Particles The:1,last drawing:1,drawing entity:1,entity type:1,type is:1,is particles:1,particles Each:1,Each particle:1,particle is:1,solid-colored rectangle:1,rectangle scaled:1,z-buffering There:1,There can:1,2000 particles:1,particles in:1,for rocket:1,rocket trails:1,trails explosions:1,like In:1,sense particles:1,particles are:1,very primitive:1,primitive technology:1,technology but:1,allow effects:1,other types:1,of entities:1,entities and:1,other entities:1,example providing:1,a trail:1,trail of:1,of fire:1,fire behind:1,a polygon-model:1,polygon-model lava:1,lava ball:1,ball that:1,that flies:1,flies into:1,air or:1,generating an:1,an expanding:1,expanding cloud:1,cloud around:1,sprite explosion:1,explosion core:1,core How:1,How We:1,We Spent:1,Spent Our:1,Our Summer:1,Summer Vacation:1,Vacation After:1,After Shipping:1,Shipping Quake:1,Quake Since:1,Since shipping:1,summer of:1,of 1996:1,1996 we’ve:1,we’ve extended:1,extended it:1,ways We’ve:1,We’ve worked:1,with Rendition:1,Rendition to:1,port it:1,Verite accelerator:1,chip we’ve:1,to OpenGL:1,OpenGL we’ve:1,Win32 we’ve:1,done QuakeWorld:1,QuakeWorld and:1,we’ve added:1,added features:1,2 I’ll:1,these briefly:1,briefly Verite:1,Quake Verite:1,Quake VQuake:1,VQuake was:1,first hardware-accelerated:1,hardware-accelerated version:1,looks extremely:1,good due:1,eliminates most:1,most pixel:1,pixel aliasing:1,provides good:1,resolutions such:1,as 512x384:1,512x384 and:1,and 640x480:1,640x480 Implementing:1,Implementing VQuake:1,VQuake proved:1,task for:1,reasons The:1,The Verite:1,Verite chip’s:1,chip’s fill:1,rate was:1,was marginal:1,marginal for:1,Quake’s needs:1,Verite contains:1,programmable RISC:1,chip enabling:1,enabling more:1,sophisticated processing:1,processing than:1,than most:1,most 3-D:1,squeeze as:1,of Verite:1,Verite ruled:1,ruled out:1,standard API:1,API such:1,as Direct:1,Direct 3D:1,3D or:1,or OpenGL:1,OpenGL instead:1,instead VQuake:1,uses Rendition’s:1,Rendition’s proprietary:1,proprietary API:1,API Speedy3D:1,Speedy3D with:1,some special:1,special calls:1,and custom:1,custom Verite:1,Verite code:1,Interestingly VQuake:1,to software:1,allow Verite:1,Verite to:1,high pixel:1,processing loads:1,of high-res:1,high-res VQuake:1,builds span:1,lists on:1,CPU just:1,DMAs the:1,descriptors to:1,to onboard:1,draws them:1,because Verite:1,Verite is:1,fully programmable:1,programmable most:1,most accelerators:1,accelerators wouldn’t:1,this architecture:1,architecture Similarly:1,builds lit:1,lit tiled:1,tiled surfaces:1,RAM then:1,DMAs them:1,an onboard:1,onboard surface:1,cache from:1,are texture-mapped:1,texture-mapped In:1,short VQuake:1,like normal:1,normal Quake:1,Quake except:1,specialized processor:1,processor This:1,cache become:1,when hardware:1,involved First:1,the DMAing:1,DMAing is:1,step that’s:1,software slowing:1,down Second:1,Second onboard:1,relatively limited:1,resource 4:1,MB total:1,and textures:1,textures must:1,be 16-bpp:1,16-bpp because:1,do filtering:1,filtering in:1,in RGB:1,modes thus:1,thus eating:1,eating up:1,up twice:1,software version’s:1,version’s 8-bpp:1,8-bpp textures—and:1,textures—and memory:1,memory becomes:1,becomes progressively:1,progressively scarcer:1,scarcer at:1,resolutions especially:1,z-buffer and:1,two 16-bpp:1,16-bpp pages:1,pages Note:1,list helps:1,helps here:1,it filters:1,filters out:1,out spans:1,from polygons:1,fully occluded:1,occluded reducing:1,downloaded Surface:1,Surface caching:1,VQuake usually:1,usually works:1,but response:1,when coming:1,coming around:1,around corners:1,corners into:1,scenes or:1,when spinning:1,spinning can:1,more sluggish:1,sluggish than:1,Quake An:1,caching would:1,passes across:1,span one:1,one tiling:1,tiling the:1,other doing:1,alpha blend:1,blend using:1,light the:1,texture two-pass:1,approach produces:1,produces exactly:1,cache without:1,requiring downloading:1,caching of:1,of large:1,large surfaces:1,very level:1,cache approach:1,Verite didn’t:1,enough fill:1,resolutions It’s:1,that two-pass:1,lighting doesn’t:1,for procedural:1,texturing that:1,does In:1,given MMX:1,MMX and:1,and ever-faster:1,ever-faster CPUs:1,accelerator to:1,process in:1,parallel it:1,increasingly tempting:1,build surfaces:1,with procedural:1,texturing such:1,as bump:1,bump mapping:1,mapping shimmers:1,shimmers and:1,and warps:1,warps this:1,texturing has:1,give accelerated:1,accelerated games:1,games highly:1,highly distinctive:1,distinctive visuals:1,visuals So:1,between surface:1,accelerators depends:1,a game’s:1,game’s needs:1,with surface:1,caching used:1,for special:1,special surfaces:1,lighting used:1,drawing GLQuake:1,GLQuake The:1,current plans:1,plans last:1,last port:1,hardware accelerator:1,accelerator was:1,OpenGL version:1,version GLQuake:1,GLQuake a:1,Win32 application:1,no intention:1,intention of:1,API wars:1,wars currently:1,currently raging:1,raging the:1,the observation:1,observation I:1,that GLQuake:1,GLQuake uses:1,uses two-pass:1,runs very:1,fast chips:1,the 3Dfx:1,3Dfx but:1,rather slowly:1,slowly on:1,current group:1,of accelerators:1,The accelerators:1,accelerators coming:1,out this:1,this year:1,year should:1,all run:1,run GLQuake:1,GLQuake fine:1,fine however:1,however It’s:1,using two-pass:1,the N64:1,N64 port:1,the N64’s:1,N64’s hardware:1,performing both:1,both texture-tiling:1,texture-tiling and:1,and alpha-lighting:1,alpha-lighting in:1,pass which:1,ideal hardware-acceleration:1,hardware-acceleration architecture:1,It’s as:1,good looking:1,than surface:1,build download:1,download and:1,cache surfaces:1,better looking:1,shading We:1,We hope:1,similar capabilities:1,capabilities implemented:1,PC accelerators:1,and exposed:1,exposed by:1,by 3-D:1,3-D APIs:1,APIs in:1,future Dynamic:1,done differently:1,GLQuake than:1,been implemented:1,maps as:1,usual but:1,but current:1,current OpenGL:1,at downloading:1,downloading textures:1,textures when:1,maps are:1,also it:1,affected light:1,maps Instead:1,Instead GLQuake:1,GLQuake simply:1,simply alpha-blends:1,alpha-blends an:1,an approximate:1,approximate sphere:1,sphere around:1,source This:1,requires very:1,no texture:1,texture downloading:1,bonus allows:1,allows dynamic:1,dynamic lights:1,lights to:1,be colored:1,colored so:1,rocket for:1,can cast:1,cast a:1,a yellowish:1,yellowish light:1,light Unlike:1,Unlike Quake:1,Quake or:1,or VQuake:1,VQuake GLQuake:1,GLQuake does:1,set Because:1,Because OpenGL:1,not currently:1,currently very:1,at selecting:1,selecting new:1,new textures:1,textures GLQuake:1,GLQuake sorts:1,sorts polygons:1,by texture:1,texture so:1,given texture:1,texture are:1,drawn together:1,together Once:1,Once texture:1,texture selection:1,selection is:1,faster it:1,draw back-to-front:1,back-to-front with:1,with z-fill:1,z-fill because:1,some hardware:1,do z-fill:1,z-fill faster:1,than z-compare:1,z-compare or:1,front-to-back so:1,z-buffering can:1,can reject:1,reject as:1,possible saving:1,saving display-memory:1,display-memory writes:1,writes GLQuake:1,also avoids:1,do z-buffer:1,z-buffer clearing:1,clearing by:1,by splitting:1,z range:1,range into:1,and alternating:1,alternating between:1,parts from:1,frame at:1,the z-compare:1,z-compare polarity:1,polarity is:1,from greater-than-or-equal:1,greater-than-or-equal to:1,to less-than-or-equal:1,less-than-or-equal so:1,previous frame’s:1,frame’s z:1,frame’s GLQuake:1,GLQuake was:1,very easy:1,develop taking:1,weekend to:1,that leads:1,point OpenGL:1,OpenGL is:1,excellent API:1,API on:1,build tools:1,tools QuakeEd:1,QuakeEd the:1,build levels:1,levels is:1,for OpenGL:1,OpenGL running:1,on Win32:1,Win32 and:1,John needed:1,3-D texture:1,texture editing:1,for modifying:1,modifying model:1,model skins:1,skins he:1,night by:1,building it:1,on OpenGL:1,OpenGL After:1,we finished:1,finished Quake:1,we realized:1,our time:1,on tools:1,tools rather:1,designers productivity:1,productivity is:1,tools they:1,use considering:1,we’d be:1,be foolish:1,foolish not:1,use OpenGL:1,OpenGL which:1,well suited:1,to such:1,such tasks:1,tasks One:1,easier a:1,API can:1,make development:1,development is:1,quickly John:1,two eye-candy:1,eye-candy features:1,to GLQuake:1,GLQuake dynamic:1,dynamic shadows:1,and reflections:1,reflections Dynamic:1,Dynamic shadows:1,shadows were:1,by projecting:1,projecting a:1,model’s silhouette:1,silhouette onto:1,ground plane:1,then alpha-blending:1,alpha-blending that:1,that silhouette:1,world This:1,work properly—for:1,properly—for example:1,standing at:1,a cliff:1,cliff the:1,the shadow:1,shadow sticks:1,sticks out:1,the air—but:1,air—but it:1,was added:1,added in:1,few hours:1,time looks:1,looks terrific:1,terrific Implementing:1,Implementing it:1,properly will:1,run adequately:1,adequately fast:1,fast it’s:1,projecting the:1,the silhouette:1,surfaces it:1,it encounters:1,encounters Reflections:1,Reflections are:1,again were:1,day A:1,A special:1,special texture:1,is designated:1,designated as:1,a mirror:1,surface when:1,encountered while:1,left Then:1,z-range is:1,changed so:1,everything drawn:1,drawn next:1,scene just:1,just drawn:1,second scene:1,drawn this:1,the reflected:1,reflected viewpoint:1,viewpoint behind:1,mirror this:1,mirror to:1,be behind:1,behind any:1,any nearer:1,true scene:1,only drawback:1,approach apart:1,draw two:1,two scenes:1,scenes is:1,z-range change:1,mirror must:1,be against:1,a sealed:1,sealed wall:1,wall with:1,with nothing:1,PVS behind:1,left into:1,the reflection:1,reflection can:1,drawn Note:1,OpenGL stencil:1,stencil buffer:1,buffer would:1,ideal here:1,but while:1,while OpenGL:1,OpenGL accelerators:1,accelerators can:1,be relied:1,support z-buffering:1,and alpha-blending:1,alpha-blending in:1,hardware the:1,yet true:1,of stencil:1,stencil buffers:1,buffers As:1,a marbled:1,marbled texture:1,is blended:1,blended into:1,surface itself:1,itself less:1,than perfectly:1,perfectly reflective:1,reflective and:1,and visible:1,visible enough:1,seem real:1,real Both:1,Both alpha-blending:1,alpha-blending and:1,z-buffering are:1,relatively new:1,PC games:1,games but:1,standard equipment:1,equipment on:1,on accelerators:1,fun seeing:1,what sorts:1,of previously:1,previously very:1,difficult effects:1,hours WinQuake:1,WinQuake I’m:1,spend much:1,the Win32:1,Win32 port:1,Quake most:1,learned doing:1,this consists:1,of tedious:1,tedious details:1,are doubtless:1,doubtless well:1,well covered:1,covered elsewhere:1,elsewhere and:1,and frankly:1,was harder:1,harder than:1,expected and:1,I’m pretty:1,much tired:1,thing However:1,that Win32:1,Win32 is:1,especially now:1,that NT:1,NT is:1,is coming:1,and like:1,best learn:1,Win32 Also:1,Also Internet:1,Internet gaming:1,becoming ever:1,and Win32’s:1,Win32’s built-in:1,built-in TCP/IP:1,TCP/IP support:1,support is:1,big advantage:1,over DOS:1,DOS that:1,that alone:1,alone was:1,was enough:1,convince us:1,port Quake:1,Quake As:1,last comment:1,comment I’d:1,have Windows:1,Windows take:1,of device:1,device configuration:1,configuration and:1,and interfacing—now:1,interfacing—now if:1,get manufacturers:1,manufacturers to:1,write drivers:1,drivers for:1,those devices:1,devices that:1,actually worked:1,worked reliably:1,reliably This:1,as no:1,surprise to:1,to veteran:1,veteran Windows:1,Windows programmers:1,suffered through:1,through years:1,of buggy:1,buggy 2-D:1,2-D Windows:1,Windows drivers:1,drivers but:1,you’re new:1,to Windows:1,Windows programming:1,programming be:1,be prepared:1,work around—or:1,around—or at:1,least document:1,document in:1,your readme:1,readme files—driver:1,files—driver bugs:1,bugs on:1,regular basis:1,basis Still:1,Still when:1,of gaming:1,a networked:1,networked Win32:1,Win32 world:1,already moved:1,Win32 I’d:1,say it’s:1,time QuakeWorld:1,QuakeWorld QuakeWorld:1,Win32 multiplayer-only:1,multiplayer-only version:1,learning experience:1,experience it:1,product but:1,is freely:1,freely distributed:1,distributed on:1,Internet The:1,the multiplayer:1,multiplayer experience:1,experience especially:1,for people:1,people linked:1,linked by:1,by modem:1,modem by:1,reducing actual:1,actual and:1,perceived latency:1,latency Before:1,discuss QuakeWorld:1,QuakeWorld however:1,should discuss:1,Quake’s multiplayer:1,multiplayer code:1,code From:1,beginning Quake:1,was conceived:1,conceived as:1,a client-server:1,client-server app:1,app specifically:1,specifically so:1,have persistent:1,persistent servers:1,servers always:1,always running:1,Internet independent:1,whether anyone:1,anyone was:1,was playing:1,playing on:1,the long-term:1,long-term goal:1,of persistent:1,persistent worlds:1,worlds Also:1,Also client-server:1,client-server architectures:1,architectures tend:1,and robust:1,robust than:1,than peer-to-peer:1,peer-to-peer and:1,have players:1,players come:1,come and:1,go at:1,at will:1,will with:1,client-server Quake:1,is client-server:1,client-server from:1,in single-player:1,single-player mode:1,mode messages:1,messages are:1,are passed:1,passed through:1,through buffers:1,buffers between:1,client code:1,server code:1,and server:1,server would:1,been two:1,two processes:1,processes in:1,fact were:1,support DOS:1,DOS Client-server:1,Client-server turned:1,right decision:1,decision because:1,Quake’s ability:1,support persistent:1,persistent come-and-go-as-you-please:1,come-and-go-as-you-please Internet:1,Internet servers:1,servers with:1,with up:1,16 people:1,people has:1,been instrumental:1,instrumental in:1,the game’s:1,game’s high:1,high visibility:1,visibility in:1,the press:1,press and:1,its lasting:1,lasting popularity:1,popularity However:1,However client-server:1,a cost:1,cost because:1,its pure:1,pure form:1,form latency:1,for clients:1,clients consists:1,trip from:1,client to:1,server and:1,back In:1,Quake orientation:1,orientation changes:1,changes instantly:1,instantly on:1,client short-circuiting:1,short-circuiting the:1,the trip:1,trip to:1,other events:1,events such:1,as motion:1,and firing:1,firing must:1,must make:1,trip before:1,before they:1,client In:1,In peer-to-peer:1,peer-to-peer games:1,games maximum:1,maximum latency:1,latency can:1,the one-way:1,one-way trip:1,trip because:1,each client:1,client is:1,running a:1,a simulation:1,simulation of:1,each peer:1,peer sees:1,sees its:1,own actions:1,actions instantly:1,instantly What:1,that latency:1,the downside:1,of client-server:1,client-server but:1,other respects:1,respects client-server:1,attractive So:1,big task:1,task with:1,latency As:1,the release:1,release of:1,of QTest1:1,QTest1 the:1,last prerelease:1,prerelease of:1,Quake John:1,had smoothed:1,smoothed net:1,net play:1,play considerably:1,by actually:1,actually keeping:1,bit earlier:1,earlier than:1,last server:1,packet and:1,interpolating events:1,events between:1,two packets:1,packets to:1,This meant:1,that events:1,events didn’t:1,didn’t snap:1,whatever packet:1,packet had:1,had arrived:1,arrived last:1,last and:1,got rid:1,of considerable:1,considerable jerking:1,jerking and:1,and stuttering:1,stuttering Unfortunately:1,actually increased:1,increased latency:1,latency because:1,the retarding:1,retarding of:1,time needed:1,the interpolation:1,interpolation possible:1,common tradeoff:1,tradeoff which:1,that reduced:1,latency often:1,for rougher:1,rougher play:1,play Reduced:1,Reduced latency:1,latency also:1,more frustrating:1,frustrating play:1,play It’s:1,latency perceived:1,player but:1,latency introduce:1,introduce the:1,for paradoxes:1,paradoxes that:1,quite distracting:1,distracting and:1,and annoying:1,annoying For:1,player may:1,may see:1,rocket go:1,go by:1,think they’ve:1,they’ve dodged:1,dodged it:1,find themselves:1,themselves exploding:1,exploding a:1,second later:1,difference of:1,opinion between:1,between his:1,his simulation:1,simulation and:1,other simulation:1,simulation is:1,is resolved:1,resolved to:1,his detriment:1,detriment Worse:1,Worse QTest1:1,QTest1 was:1,was prone:1,to frequent:1,frequent hitching:1,hitching over:1,over all:1,best connections:1,connections because:1,was built:1,around reliable:1,reliable packet:1,delivery TCP:1,TCP provided:1,system Whenever:1,a packet:1,packet didn’t:1,arrive there:1,long pause:1,pause waiting:1,the retransmission:1,retransmission After:1,After QTest1:1,QTest1 John:1,fundamentally wrong:1,wrong assumption:1,use unreliable:1,delivery UDP:1,UDP sending:1,sending the:1,relevant portion:1,full state:1,state every:1,time possible:1,possible only:1,PVS can:1,cull most:1,most events:1,events in:1,logic itself:1,itself deal:1,with packets:1,packets that:1,arrive A:1,A reliable:1,reliable sideband:1,sideband was:1,like scores:1,scores not:1,for gameplay:1,gameplay state:1,state However:1,of Carmack’s:1,Law John:1,not rewrite:1,and wound:1,with 8000:1,8000 lines:1,of messy:1,messy code:1,took right:1,until Quake:1,Quake shipped:1,debug For:1,For QuakeWorld:1,QuakeWorld John:1,did rewrite:1,scratch around:1,of unreliable:1,delivery and:1,it wound:1,just 1500:1,1500 lines:1,of clean:1,clean bug-free:1,bug-free code:1,run it’s:1,it’s cheaper:1,rewrite than:1,to patch:1,patch and:1,and modify:1,modify So:1,Quake multiplayer:1,multiplayer performance:1,quite smooth:1,but latency:1,latency was:1,major issue:1,issue often:1,the 250:1,250 to:1,400 ms:1,ms range:1,range for:1,for modem:1,modem players:1,players QuakeWorld:1,QuakeWorld attacked:1,attacked this:1,it reduced:1,latency by:1,by around:1,a server:1,server change:1,Quake server:1,server runs:1,runs 10:1,second batching:1,batching up:1,up inputs:1,inputs in:1,between ticks:1,ticks and:1,and sending:1,sending out:1,out results:1,results after:1,the tick:1,tick By:1,contrast QuakeWorld:1,QuakeWorld servers:1,servers run:1,run immediately:1,immediately whenever:1,a client:1,client sends:1,sends input:1,input knocking:1,knocking up:1,ms off:1,off response:1,although at:1,greater server:1,server processing:1,processing load:1,load A:1,similar anti-latency:1,anti-latency idea:1,wasn’t implemented:1,in QuakeWorld:1,separate thread:1,thread that:1,can send:1,send input:1,input off:1,server as:1,happens instead:1,of incurring:1,incurring up:1,second way:1,which QuakeWorld:1,QuakeWorld attacks:1,attacks latency:1,not interpolating:1,interpolating The:1,The player:1,actually predicted:1,predicted well:1,well ahead:1,packet after:1,client has:1,player unless:1,unless an:1,outside force:1,force intervenes:1,intervenes giving:1,giving very:1,very responsive:1,responsive control:1,control The:1,packet this:1,is jerkier:1,jerkier than:1,Quake again:1,again showing:1,showing that:1,that smoothness:1,smoothness is:1,for latency:1,The player’s:1,player’s prediction:1,prediction may:1,may of:1,course result:1,minor paradox:1,paradox for:1,explosion turns:1,have knocked:1,knocked the:1,player sideways:1,sideways the:1,player’s location:1,location may:1,may suddenly:1,suddenly jump:1,jump without:1,without warning:1,warning as:1,packet arrives:1,arrives with:1,location In:1,latest version:1,QuakeWorld the:1,other players:1,are predicted:1,predicted as:1,with consequently:1,consequently more:1,more frequent:1,frequent paradoxes:1,paradoxes but:1,but smoother:1,smoother more:1,more convincing:1,convincing motion:1,motion Platforms:1,Platforms and:1,and doors:1,doors are:1,not predicted:1,predicted and:1,and consequently:1,consequently are:1,still pretty:1,pretty jerky:1,jerky It:1,course possible:1,to predict:1,predict more:1,more objects:1,objects into:1,future it’s:1,tradeoff of:1,of smoothness:1,smoothness and:1,perceived low:1,low latency:1,the frustration:1,frustration of:1,of paradoxes—and:1,paradoxes—and that’s:1,it’s going:1,stay until:1,until most:1,Internet by:1,than modems:1,modems Quake:1,2 I:1,can’t talk:1,talk in:1,2 as:1,game but:1,can describe:1,describe some:1,interesting technology:1,technology features:1,features The:1,2 rendering:1,engine isn’t:1,from Quake:1,the improvements:1,improvements are:1,are largely:1,largely in:1,in areas:1,areas such:1,as physics:1,physics gameplay:1,gameplay artwork:1,artwork and:1,design The:1,interesting graphics:1,graphics change:1,the preprocessing:1,preprocessing where:1,where John:1,has added:1,added support:1,for radiosity:1,source into:1,light bounced:1,bounced around:1,world realistically:1,realistically This:1,sometimes terrific—it:1,terrific—it makes:1,great glowing:1,glowing light:1,light around:1,around lava:1,lava and:1,and hanging:1,hanging light:1,light panels—but:1,panels—but in:1,cases it’s:1,less spectacular:1,spectacular than:1,that designers:1,designers can:1,placing lots:1,of direct-illumination:1,direct-illumination light:1,sources in:1,a room:1,room so:1,two methods:1,methods can:1,needed Also:1,Also radiosity:1,radiosity is:1,very computationally:1,computationally expensive:1,expensive approximately:1,as BSPing:1,BSPing Most:1,the radiosity:1,radiosity demos:1,demos I’ve:1,seen have:1,rooms and:1,problem goes:1,goes up:1,up tremendously:1,tremendously on:1,whole Quake:1,levels Here’s:1,Here’s another:1,essential without:1,it radiosity:1,radiosity processing:1,be O(polygons:1,O(polygons 2:1,PVS it’s:1,it’s O(polygons*average_potentially_visible_polygons:1,O(polygons*average_potentially_visible_polygons which:1,is over:1,magnitude less:1,and increases:1,increases approximately:1,approximately linearly:1,linearly rather:1,a squared:1,squared function:1,with greater-level:1,greater-level complexity:1,complexity Also:1,moving sky:1,sky texture:1,gone or:1,or will:1,change One:1,One likely:1,likely replacement:1,replacement is:1,an enclosing:1,enclosing texture-mapped:1,texture-mapped box:1,box around:1,world at:1,a virtually:1,virtually infinite:1,distance this:1,allow open:1,open vistas:1,vistas much:1,like Doom:1,Doom a:1,a welcome:1,welcome change:1,the claustrophobic:1,claustrophobic feel:1,Quake Another:1,Another likely:1,likely change:1,shift from:1,from interpreted:1,interpreted Quake-C:1,Quake-C code:1,for game:1,to compiled:1,compiled DLLs:1,DLLs Part:1,the incentive:1,incentive here:1,is performance—interpretation:1,performance—interpretation isn’t:1,isn’t cheap—and:1,cheap—and part:1,is debugging:1,debugging because:1,standard debugger:1,debugger can:1,with DLLs:1,DLLs The:1,is portability:1,portability Quake-C:1,Quake-C program:1,program files:1,completely portable:1,portable to:1,any platform:1,platform Quake:1,Quake runs:1,no modification:1,modification or:1,or recompilation:1,recompilation but:1,but DLLs:1,DLLs compiled:1,compiled for:1,Win32 require:1,real porting:1,run anywhere:1,else Our:1,thinking here:1,no non-console:1,non-console platforms:1,platforms other:1,matter that:1,much anymore:1,anymore and:1,those few:1,few that:1,do notably:1,notably the:1,the Mac:1,Mac and:1,and Linux:1,Linux the:1,the DLLs:1,DLLs can:1,be ported:1,ported along:1,core engine:1,engine code:1,It just:1,easy portability:1,portability to:1,to tiny:1,tiny markets:1,markets to:1,to impose:1,impose a:1,significant development:1,cost on:1,one huge:1,huge market:1,market Consoles:1,Consoles will:1,always require:1,require serious:1,serious porting:1,effort anyway:1,to Win32-specific:1,Win32-specific DLLs:1,DLLs for:1,PC version:1,version won’t:1,won’t make:1,the ease:1,doing console:1,console ports:1,Finally Internet:1,Internet support:1,support will:1,improve in:1,2 Some:1,the QuakeWorld:1,QuakeWorld latency:1,latency improvements:1,improvements will:1,will doubtless:1,doubtless be:1,added but:1,important there:1,new interface:1,interface especially:1,for monitoring:1,monitoring and:1,and joining:1,joining net:1,net games:1,an HTML:1,HTML page:1,page John:1,been interested:1,in moving:1,game core:1,the browser:1,browser take:1,the UI:1,UI makes:1,eliminate menuing:1,menuing and:1,such from:1,2 engine:1,engine Think:1,to browse:1,browse hundreds:1,Quake servers:1,servers from:1,single Web:1,page much:1,can today:1,today with:1,with QSpy:1,QSpy but:1,standard familiar:1,familiar interface:1,easy extensibility:1,extensibility and:1,why John:1,John considers:1,considers this:1,game interface:1,interface of:1,future By:1,way Quake:1,being developed:1,developed as:1,Win32 app:1,app only:1,only no:1,no DOS:1,is planned:1,planned Looking:1,Looking Forward:1,Forward In:1,my address:1,in 1996:1,1996 I:1,bad time:1,start up:1,company aimed:1,at hardware-only:1,hardware-only rasterization:1,rasterization and:1,that leapfrogged:1,leapfrogged the:1,the competition:1,competition It:1,like I:1,was probably:1,year early:1,early because:1,hardware took:1,took longer:1,to ship:1,ship than:1,expected although:1,good living:1,living to:1,made writing:1,writing games:1,hardware vendors:1,vendors could:1,could bundle:1,bundle with:1,their boards:1,boards Now:1,Now though:1,it clearly:1,clearly is:1,By Christmas:1,Christmas 1997:1,1997 there:1,several million:1,million fast:1,fast accelerators:1,accelerators out:1,by Christmas:1,Christmas 1998:1,1998 there:1,be tens:1,millions At:1,time vastly:1,getting access:1,it’s from:1,the convergence:1,convergence of:1,trends that:1,of breakthrough:1,breakthrough real-time:1,real-time games:1,games will:1,will emerge:1,emerge John:1,already working:1,on id’s:1,id’s next:1,Trinity and:1,and targeted:1,targeted around:1,around Christmas:1,Christmas of:1,of 1998:1,1998 Trinity:1,a hardware-only:1,hardware-only engine:1,engine its:1,its baseline:1,baseline system:1,Pro 200-plus:1,200-plus with:1,with MMX:1,MMX 32:1,32 MB:1,MB and:1,an accelerator:1,accelerator capable:1,least 50:1,50 megapixels:1,megapixels and:1,and 300:1,300 K:1,K triangles:1,triangles per:1,with alpha:1,blending and:1,z-buffering The:1,The goals:1,of Trinity:1,Trinity are:1,Quake Quake’s:1,Quake’s primary:1,primary technical:1,technical goals:1,goals were:1,do high-quality:1,high-quality well-lit:1,well-lit complex:1,complex indoor:1,indoor scenes:1,with 6:1,6 degrees:1,of freedom:1,freedom and:1,support client-server:1,client-server Internet:1,Internet play:1,play That:1,start but:1,that Trinity’s:1,Trinity’s goals:1,goals are:1,much less-constrained:1,less-constrained better-connected:1,better-connected worlds:1,Quake Imagine:1,Imagine seeing:1,seeing through:1,through open:1,open landscape:1,landscape from:1,one server:1,server to:1,action on:1,adjacent servers:1,servers in:1,where things:1,things are:1,are heading:1,heading in:1,future A:1,A huge:1,huge graphics:1,graphics challenge:1,challenge for:1,games is:1,is level:1,detail LOD:1,LOD management:1,management If:1,we’re to:1,larger more:1,more open:1,open worlds:1,worlds there:1,more geometry:1,geometry visible:1,time At:1,the push:1,push for:1,greater detail:1,detail that’s:1,progress for:1,past four:1,so will:1,continue people:1,people will:1,start expecting:1,expecting to:1,see real:1,real cracks:1,bumps when:1,they get:1,get close:1,wall not:1,a picture:1,of cracks:1,bumps painted:1,painted on:1,flat wall:1,wall Without:1,Without LOD:1,LOD these:1,trends are:1,in direct:1,direct opposition:1,opposition there’s:1,world larger:1,its surfaces:1,surfaces more:1,detailed at:1,without bringing:1,the renderer:1,its knees:1,knees The:1,draw nearer:1,detail than:1,than farther:1,farther surfaces:1,surfaces In:1,In itself:1,itself that’s:1,hard but:1,without popping:1,popping and:1,and snapping:1,snapping being:1,being visible:1,visible as:1,challenge John:1,has implemented:1,implemented fractal:1,fractal landscapes:1,landscapes with:1,with constantly:1,constantly adjustable:1,adjustable level:1,so new:1,new vertices:1,vertices appear:1,appear as:1,and gradually:1,gradually morph:1,morph to:1,their final:1,final positions:1,positions so:1,no popping:1,popping Trinity:1,already capable:1,displaying oval:1,oval pillars:1,pillars that:1,four sides:1,sides when:1,add vertices:1,polygons smoothly:1,get closer:1,closer such:1,the pillars:1,pillars look:1,look oval:1,oval at:1,times Similarly:1,Similarly polygon:1,which maxed:1,about 5000:1,5000 polygon-model:1,polygons total—for:1,total—for all:1,all models—per:1,models—per scene:1,probably reach:1,reach 6000:1,6000 or:1,or 7000:1,7000 per:1,LOD Trinity:1,Trinity will:1,surely have:1,more moving:1,objects will:1,look far:1,detailed when:1,viewed up:1,close so:1,so LOD:1,LOD for:1,moving polygon:1,models will:1,will definitely:1,definitely be:1,needed One:1,of morphing:1,morphing vertices:1,LOD is:1,shading doesn’t:1,vertex causes:1,major shift:1,shift in:1,in Gouraud:1,shading which:1,all based:1,on lighting:1,vertices Consequently:1,Consequently two-pass:1,and surface:1,caching seem:1,better matches:1,matches for:1,for smoothly:1,smoothly changing:1,changing LOD:1,LOD Some:1,people worry:1,hardware acceleration:1,acceleration will:1,that 3-D:1,3-D programs:1,will no:1,much challenge:1,this brief:1,brief discussion:1,the tightly:1,tightly interconnected:1,interconnected highly:1,detailed worlds:1,worlds toward:1,toward which:1,we’re rapidly:1,rapidly heading:1,heading will:1,you realize:1,challenge and:1,fact greater:1,than they’ve:1,they’ve ever:1,been The:1,that rather:1,than getting:1,getting stuck:1,of established:1,established techniques:1,constantly strive:1,way keep:1,keep learning:1,and changing:1,new approaches—and:1,approaches—and working:1,working your:1,your rear:1,rear end:1,end off—and:1,off—and odds:1,the wave:1,wave of:1,future Afterword:1,Afterword If:1,you’ve followed:1,followed me:1,me this:1,this far:1,far you:1,might agree:1,we’ve come:1,through some:1,rough country:1,country Still:1,Still I’m:1,I’m of:1,the opinion:1,opinion that:1,that hard-won:1,hard-won knowledge:1,knowledge is:1,best knowledge:1,knowledge not:1,it sticks:1,sticks to:1,because winning:1,winning a:1,hard race:1,race makes:1,it easier:1,win the:1,next one:1,one This:1,an unusual:1,unusual book:1,that sense:1,sense In:1,a compilation:1,compilation of:1,fast computer:1,graphics it:1,journal recording:1,recording some:1,discovered and:1,and refined:1,refined that:1,knowledge I:1,didn’t just:1,just sit:1,down one:1,this book—I:1,book—I wrote:1,wrote it:1,it over:1,published its:1,its component:1,component parts:1,parts in:1,many places:1,places It:1,journal of:1,my successes:1,successes and:1,and frustrations:1,frustrations with:1,with side:1,side glances:1,glances of:1,life as:1,happened along:1,another remarkable:1,remarkable thing:1,book You:1,You the:1,the reader:1,reader helped:1,helped me:1,it Perhaps:1,Perhaps not:1,you personally:1,personally but:1,have read:1,read my:1,my articles:1,and columns:1,columns over:1,years sent:1,me notes:1,notes asking:1,asking me:1,me questions:1,questions suggesting:1,suggesting improvements:1,improvements occasionally:1,occasionally by:1,by daring:1,daring me:1,beat them:1,performance game:1,game or:1,sometimes just:1,just dumping:1,dumping remarkable:1,my lap:1,lap Where:1,Where it:1,seemed appropriate:1,appropriate I:1,I dropped:1,dropped in:1,sometimes even:1,correspondents and:1,the richer:1,richer for:1,it Here:1,Here and:1,learned things:1,nothing at:1,graphics For:1,example I’m:1,a doomsayer:1,doomsayer who:1,thinks American:1,American education:1,education lags:1,lags hopelessly:1,hopelessly behind:1,the Western:1,Western world:1,then something:1,something happens:1,happens that:1,me wonder:1,wonder Some:1,one Melvyn:1,Melvyn J:1,J Lafitte:1,Lafitte requesting:1,requesting that:1,I spend:1,columns describing:1,describing fast:1,fast 3-D:1,techniques Melvyn:1,Melvyn hoped:1,hoped that:1,so kind:1,kind as:1,discuss among:1,among other:1,things hidden:1,projection performed:1,and preferably:1,preferably in:1,X Sound:1,familiar Melvyn:1,Melvyn shared:1,shared with:1,surface approach:1,had developed:1,developed His:1,His technique:1,technique involved:1,involved defining:1,defining polygon:1,side Then:1,Then he:1,he explained:1,explained one:1,book to:1,is pointing:1,pointing Better:1,yet he:1,he pointed:1,calculate only:1,perpendicular and:1,component need:1,need actually:1,tested What:1,What Melvyn:1,Melvyn described:1,described is:1,course backface:1,removal a:1,key hidden-surface:1,hidden-surface technique:1,used heavily:1,heavily in:1,X-Sharp In:1,general other:1,other hidden:1,surface techniques:1,techniques must:1,with backface:1,removal but:1,but backface:1,nonetheless important:1,efficient Simply:1,Simply put:1,put Melvyn:1,Melvyn had:1,had devised:1,for himself:1,fundamental techniques:1,techniques of:1,drawing Melvyn:1,Melvyn lives:1,in Moens:1,Moens France:1,France At:1,me Melvyn:1,was 17:1,17 years:1,old Try:1,any American:1,American 17-year-old:1,17-year-old of:1,your acquaintance:1,acquaintance inventing:1,inventing backface:1,removal Try:1,any teenager:1,teenager you:1,know even:1,even using:1,book Not:1,that Melvyn:1,highly technical:1,technical letter:1,English and:1,if Melvyn’s:1,Melvyn’s English:1,English was:1,was something:1,than flawless:1,flawless it:1,perfectly understandable:1,understandable and:1,experience vastly:1,even well-educated:1,well-educated American’s:1,American’s French:1,French Please:1,Please understand:1,understand I:1,believe we:1,we Americans:1,Americans excel:1,excel in:1,ways but:1,to math:1,and foreign:1,foreign languages:1,languages we:1,are becoming:1,a nation:1,nation of:1,of têtes:1,têtes de:1,de pomme:1,pomme de:1,de terre:1,terre Maybe:1,Maybe I:1,worry too:1,much If:1,the glass:1,glass is:1,is half:1,half empty:1,empty well:1,well it’s:1,also half:1,half full:1,full Plainly:1,Plainly something:1,wrote inspired:1,inspired Melvyn:1,Melvyn to:1,is wonderful:1,wonderful whether:1,whether he:1,he realizes:1,realizes it:1,not And:1,been tremendously:1,tremendously gratifying:1,gratifying to:1,to sense:1,letters I:1,have received:1,received the:1,same feeling:1,of remarkably:1,remarkably smart:1,smart people:1,people going:1,and doing:1,doing amazing:1,amazing things:1,things just:1,sheer unadulterated:1,unadulterated fun:1,fun of:1,think I’m:1,I’m exaggerating:1,exaggerating too:1,much well:1,well maybe:1,little when:1,fun is:1,I live:1,live for:1,for I’m:1,glad to:1,you share:1,share that:1,same passion:1,passion Good:1,Good luck:1,luck Thank:1,Thank you:1,you for:1,your input:1,input your:1,all your:1,your kind:1,kind words:1,words Don’t:1,Don’t be:1,be afraid:1,afraid to:1,to attempt:1,attempt the:1,the impossible:1,impossible Simply:1,Simply knowing:1,impossible is:1,useful knowledge—and:1,knowledge—and you:1,the wake:1,wake of:1,some unexpected:1,unexpected success:1,success that:1,not half:1,the things:1,things we:1,call impossible:1,impossible have:1,any right:1,right at:1,to wear:1,wear the:1